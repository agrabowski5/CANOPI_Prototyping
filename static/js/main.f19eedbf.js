/*! For license information please see main.f19eedbf.js.LICENSE.txt */
(()=>{var e={356(e,t,r){e.exports=r(9645).last},418(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.toString=function e(t){if(null==t)return"";if("string"===typeof t)return t;if(Array.isArray(t))return t.map(e).join(",");const r=String(t);return"0"===r&&Object.is(Number(t),-0)?"-0":r}},579(e,t,r){"use strict";e.exports=r(1153)},870(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isObject=function(e){return null!==e&&("object"===typeof e||"function"===typeof e)}},879(e,t,r){var n=r(1847).default;const i=["data"],o=["data"];e.exports=function(){"use strict";var e,t,r;function a(n,i){if(e)if(t){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",a={};e(a),r=i(a),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else t=i;else e=i}return a(["exports"],function(e){var t=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array;function n(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*o-i*n;return a?(e[0]=o*(a=1/a),e[1]=-n*a,e[2]=-i*a,e[3]=r*a,e):null}function i(){var e=new r(9);return r!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function o(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8];return e[0]=a*u-s*c,e[1]=i*c-n*u,e[2]=n*s-i*a,e[3]=s*l-o*u,e[4]=r*u-i*l,e[5]=i*o-r*s,e[6]=o*c-a*l,e[7]=n*l-r*c,e[8]=r*a-n*o,e}function a(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=r[0],A=r[1],f=r[2],p=r[3],m=r[4],g=r[5],y=r[6],_=r[7],v=r[8];return e[0]=h*n+A*a+f*c,e[1]=h*i+A*s+f*u,e[2]=h*o+A*l+f*d,e[3]=p*n+m*a+g*c,e[4]=p*i+m*s+g*u,e[5]=p*o+m*l+g*d,e[6]=y*n+_*a+v*c,e[7]=y*i+_*s+v*u,e[8]=y*o+_*l+v*d,e}function s(){var e=new r(16);return r!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function l(e){var t=new r(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function u(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],A=t[11],f=t[12],p=t[13],m=t[14],g=t[15],y=r*s-n*a,_=r*l-i*a,v=r*c-o*a,x=n*l-i*s,w=n*c-o*s,b=i*c-o*l,B=u*p-d*f,C=u*m-h*f,E=u*g-A*f,S=d*m-h*p,T=d*g-A*p,I=h*g-A*m,F=y*I-_*T+v*S+x*E-w*C+b*B;return F?(e[0]=(s*I-l*T+c*S)*(F=1/F),e[1]=(i*T-n*I-o*S)*F,e[2]=(p*b-m*w+g*x)*F,e[3]=(h*w-d*b-A*x)*F,e[4]=(l*E-a*I-c*C)*F,e[5]=(r*I-i*E+o*C)*F,e[6]=(m*v-f*b-g*_)*F,e[7]=(u*b-h*v+A*_)*F,e[8]=(a*T-s*E+c*B)*F,e[9]=(n*E-r*T-o*B)*F,e[10]=(f*w-p*v+g*y)*F,e[11]=(d*v-u*w-A*y)*F,e[12]=(s*C-a*S-l*B)*F,e[13]=(r*S-n*C+i*B)*F,e[14]=(p*_-f*x-m*y)*F,e[15]=(u*x-d*_+h*y)*F,e):null}function d(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],A=t[10],f=t[11],p=t[12],m=t[13],g=t[14],y=t[15],_=r[0],v=r[1],x=r[2],w=r[3];return e[0]=_*n+v*s+x*d+w*p,e[1]=_*i+v*l+x*h+w*m,e[2]=_*o+v*c+x*A+w*g,e[3]=_*a+v*u+x*f+w*y,e[4]=(_=r[4])*n+(v=r[5])*s+(x=r[6])*d+(w=r[7])*p,e[5]=_*i+v*l+x*h+w*m,e[6]=_*o+v*c+x*A+w*g,e[7]=_*a+v*u+x*f+w*y,e[8]=(_=r[8])*n+(v=r[9])*s+(x=r[10])*d+(w=r[11])*p,e[9]=_*i+v*l+x*h+w*m,e[10]=_*o+v*c+x*A+w*g,e[11]=_*a+v*u+x*f+w*y,e[12]=(_=r[12])*n+(v=r[13])*s+(x=r[14])*d+(w=r[15])*p,e[13]=_*i+v*l+x*h+w*m,e[14]=_*o+v*c+x*A+w*g,e[15]=_*a+v*u+x*f+w*y,e}function h(e,t,r){var n,i,o,a,s,l,c,u,d,h,A,f,p=r[0],m=r[1],g=r[2];return t===e?(e[12]=t[0]*p+t[4]*m+t[8]*g+t[12],e[13]=t[1]*p+t[5]*m+t[9]*g+t[13],e[14]=t[2]*p+t[6]*m+t[10]*g+t[14],e[15]=t[3]*p+t[7]*m+t[11]*g+t[15]):(i=t[1],o=t[2],a=t[3],s=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],A=t[10],f=t[11],e[0]=n=t[0],e[1]=i,e[2]=o,e[3]=a,e[4]=s,e[5]=l,e[6]=c,e[7]=u,e[8]=d,e[9]=h,e[10]=A,e[11]=f,e[12]=n*p+s*m+d*g+t[12],e[13]=i*p+l*m+h*g+t[13],e[14]=o*p+c*m+A*g+t[14],e[15]=a*p+u*m+f*g+t[15]),e}function A(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function f(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[4],a=t[5],s=t[6],l=t[7],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*n,e[5]=a*i+u*n,e[6]=s*i+d*n,e[7]=l*i+h*n,e[8]=c*i-o*n,e[9]=u*i-a*n,e[10]=d*i-s*n,e[11]=h*i-l*n,e}function p(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],l=t[3],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*n,e[1]=a*i-u*n,e[2]=s*i-d*n,e[3]=l*i-h*n,e[8]=o*n+c*i,e[9]=a*n+u*i,e[10]=s*n+d*i,e[11]=l*n+h*i,e}function m(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],a=t[1],s=t[2],l=t[3],c=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*n,e[1]=a*i+u*n,e[2]=s*i+d*n,e[3]=l*i+h*n,e[4]=c*i-o*n,e[5]=u*i-a*n,e[6]=d*i-s*n,e[7]=h*i-l*n,e}function g(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function y(e,r,n){var i,o,a,s=n[0],l=n[1],c=n[2],u=Math.sqrt(s*s+l*l+c*c);return u<t?null:(s*=u=1/u,l*=u,c*=u,i=Math.sin(r),o=Math.cos(r),e[0]=s*s*(a=1-o)+o,e[1]=l*s*a+c*i,e[2]=c*s*a-l*i,e[3]=0,e[4]=s*l*a-c*i,e[5]=l*l*a+o,e[6]=c*l*a+s*i,e[7]=0,e[8]=s*c*a+l*i,e[9]=l*c*a-s*i,e[10]=c*c*a+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function _(e,t){var r=t[0],n=t[1],i=t[2],o=t[4],a=t[5],s=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(o*o+a*a+s*s),e[2]=Math.sqrt(l*l+c*c+u*u),e}function v(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r+r,s=n+n,l=i+i,c=r*a,u=n*a,d=n*s,h=i*a,A=i*s,f=i*l,p=o*a,m=o*s,g=o*l;return e[0]=1-d-f,e[1]=u+g,e[2]=h-m,e[3]=0,e[4]=u-g,e[5]=1-c-f,e[6]=A+p,e[7]=0,e[8]=h+m,e[9]=A-p,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var x=d;function w(){var e=new r(3);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function b(e){var t=new r(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function B(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function C(e,t,n){var i=new r(3);return i[0]=e,i[1]=t,i[2]=n,i}function E(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function S(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function T(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function I(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function F(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function k(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function P(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function M(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function O(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function L(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function D(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function U(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function R(e,t){var r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o)),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o,e}function z(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function N(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[0],s=r[1],l=r[2];return e[0]=i*l-o*s,e[1]=o*a-n*l,e[2]=n*s-i*a,e}function j(e,t,r,n){var i=t[0],o=t[1],a=t[2];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e}function Q(e,t,r){var n=t[0],i=t[1],o=t[2],a=r[3]*n+r[7]*i+r[11]*o+r[15];return e[0]=(r[0]*n+r[4]*i+r[8]*o+r[12])/(a=a||1),e[1]=(r[1]*n+r[5]*i+r[9]*o+r[13])/a,e[2]=(r[2]*n+r[6]*i+r[10]*o+r[14])/a,e}function V(e,t,r){var n=t[0],i=t[1],o=t[2];return e[0]=n*r[0]+i*r[3]+o*r[6],e[1]=n*r[1]+i*r[4]+o*r[7],e[2]=n*r[2]+i*r[5]+o*r[8],e}function H(e,t,r){var n=r[0],i=r[1],o=r[2],a=r[3],s=t[0],l=t[1],c=t[2],u=i*c-o*l,d=o*s-n*c,h=n*l-i*s;return e[0]=s+a*(u+=u)+i*(h+=h)-o*(d+=d),e[1]=l+a*d+o*u-n*h,e[2]=c+a*h+n*d-i*u,e}function G(e){return e[0]=0,e[1]=0,e[2]=0,e}function K(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var W=T,q=I,Z=B;function X(){var e=new r(4);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Y(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function J(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=r*r+n*n+i*i+o*o;return a>0&&(a=1/Math.sqrt(a)),e[0]=r*a,e[1]=n*a,e[2]=i*a,e[3]=o*a,e}function $(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*a,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*a,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*a,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*a,e}function ee(){var e=new r(4);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function te(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function re(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+a*s,e[1]=i*l+o*s,e[2]=o*l-i*s,e[3]=a*l-n*s,e}function ne(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l-o*s,e[1]=i*l+a*s,e[2]=o*l+n*s,e[3]=a*l-i*s,e}w(),X();var ie,oe,ae,se=J,le=(ie=w(),oe=C(1,0,0),ae=C(0,1,0),function(e,t,r){var n=z(t,r);return n<-.999999?(N(ie,oe,t),Z(ie)<1e-6&&N(ie,ae,t),R(ie,ie),function(e,t,r){r*=.5;var n=Math.sin(r);e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r)}(e,ie,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(N(ie,t,r),e[0]=ie[0],e[1]=ie[1],e[2]=ie[2],e[3]=1+n,se(e,e))});function ce(){var e=new r(2);return r!=Float32Array&&(e[0]=0,e[1]=0),e}function ue(e,t){var n=new r(2);return n[0]=e,n[1]=t,n}function de(e,t,r){return e[0]=t,e[1]=r,e}function he(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function Ae(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function fe(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function pe(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function me(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function ge(e,t){return e[0]*t[0]+e[1]*t[1]}ee(),ee(),i();var ye,_e,ve=Ae;function xe(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}ce();var we=function(){if(_e)return ye;function e(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=n}return _e=1,ye=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,n=0;n<8;n++){var i=this.sampleCurveX(r)-e;if(Math.abs(i)<t)return r;var o=this.sampleCurveDerivativeX(r);if(Math.abs(o)<1e-6)break;r-=i/o}var a=0,s=1;for(r=e,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-e)<t));n++)e>i?a=r:s=r,r=.5*(s-a)+a;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},ye}(),be=xe(we);function Be(e,t){this.x=e,this.y=t}function Ce(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Ce(e[r],t[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!Ce(e[r],t[r]))return!1;return!0}return e===t}Be.prototype={clone(){return new Be(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),r=Math.sin(e),n=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=n,this},_rotateAround(e,t){const r=Math.cos(e),n=Math.sin(e),i=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-n*(this.y-t.y),this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Be},Be.convert=function(e){if(e instanceof Be)return e;if(Array.isArray(e))return new Be(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new Be(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};const Ee=Math.PI/180,Se=180/Math.PI;function Te(e){return e*Ee}function Ie(e){return e*Se}const Fe=[[0,0],[1,0],[1,1],[0,1]];function ke(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}function Pe(e,t,r,n){const i=new be(e,t,r,n);return function(e){return i.solve(e)}}const Me=Pe(.25,.1,.25,1);function Oe(e,t,r){return Math.min(r,Math.max(t,e))}function Le(e,t,r){return(r=Oe((r-e)/(t-e),0,1))*r*(3-2*r)}function De(e,t,r){const n=r-t,i=((e-t)%n+n)%n+t;return i===t?r:i}function Ue(e,t,r){if(!e.length)return r(null,[]);let n=e.length;const i=new Array(e.length);let o=null;e.forEach((e,a)=>{t(e,(e,t)=>{e&&(o=e),i[a]=t,0==--n&&r(o,i)})})}let Re=1;function ze(){return Re++}function Ne(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log2(e)))}function je(e,t){e.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function Qe(e,t,r){const n={};for(const i in e)n[i]=t.call(this,e[i],i,e);return n}function Ve(e,t,r){const n={};for(const i in e)t.call(this,e[i],i,e)&&(n[i]=e[i]);return n}function He(e){return Array.isArray(e)?e.map(He):"object"==typeof e&&e?Qe(e,He):e}function Ge(e,t){for(let r=0;r<e.length;r++)if(t.indexOf(e[r])>=0)return!0;return!1}const Ke={};function We(e){Ke[e]||("undefined"!=typeof console&&console.warn(e),Ke[e]=!0)}function qe(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Ze(e){let t=0;for(let r,n,i=0,o=e.length,a=o-1;i<o;a=i++)r=e[i],n=e[a],t+=(n.x-r.x)*(r.y+n.y);return t}function Xe(e){let[t,r,n]=e;const i=Te(r+90),o=Te(n);return{x:t*Math.cos(i)*Math.sin(o),y:t*Math.sin(i)*Math.sin(o),z:t*Math.cos(o),azimuthal:r,polar:n}}function Ye(e){return("undefined"!=typeof self||void 0!==e)&&"undefined"!=typeof WorkerGlobalScope&&(void 0!==e?e:self)instanceof WorkerGlobalScope}function Je(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,r,n,i)=>{const o=n||i;return t[r]=!o||o.toLowerCase(),""}),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let $e=null;function et(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function tt(e,t,r,n){for(;t<r;){const i=t+r>>1;e[i]<n?t=i+1:r=i}return t}function rt(e,t,r,n){for(;t<r;){const i=t+r>>1;e[i]<=n?t=i+1:r=i}return t}function nt(e){return e>0?1/(1.001-e):1+e}function it(e){return e>0?1-1/(1.001-e):-e}function ot(e,t,r){return(e-t.min)*(r.max-r.min)/(t.max-t.min)+r.min}const at={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!at.API_URL)return null;try{const e=new URL(at.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function st(e){return at.API_URL_REGEX.test(e)}function lt(e){return at.API_SPRITE_REGEX.test(e)}let ct,ut,dt,ht,At,ft;function pt(){return null==ct&&(ct=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),ct}const mt={now:()=>void 0!==ht?ht:performance.now(),setNow(e){ht=e},restoreNow(){ht=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:r,height:n}=e;At||(At=document.createElement("canvas"));const i=At.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return(r>At.width||n>At.height)&&(At.width=r,At.height=n),i.clearRect(-t,-t,r+2*t,n+2*t),i.drawImage(e,0,0,r,n),i.getImageData(-t,-t,r+2*t,n+2*t)},resolveURL:e=>(ut||(ut=document.createElement("a")),ut.href=e,ut.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==dt&&(dt=window.matchMedia("(prefers-reduced-motion: reduce)")),dt.matches)},hasCanvasFingerprintNoise(){if(void 0!==ft)return ft;if(!pt())return ft=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let r=0;for(let i=0;i<e.width;++i)t.fillStyle="rgba(".concat(r++,",").concat(r++,",").concat(r++,", 255)"),t.fillRect(i,0,1,1);const n=t.getImageData(0,0,e.width,e.height);r=0;for(let i=0;i<n.data.length;++i)if(i%4!=3&&r++!==n.data[i])return ft=!0,!0;return ft=!1,!1}};function gt(e,t){const r=e.indexOf("?");if(r<0)return"".concat(e,"?").concat(new URLSearchParams(t).toString());const n=new URLSearchParams(e.slice(r));for(const i in t)n.set(i,t[i]);return"".concat(e.slice(0,r),"?").concat(n.toString())}function yt(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{persistentParams:[]};const r=e.indexOf("?");if(r<0)return e;const n=new URLSearchParams,i=new URLSearchParams(e.slice(r));for(const a of t.persistentParams){const e=i.get(a);e&&n.set(a,e)}const o=n.toString();return"".concat(e.slice(0,r)).concat(o.length>0?"?".concat(o):"")}const _t="mapbox-tiles";let vt=500,xt=50;const wt=["language","worldview","jobid"];let bt,Bt;function Ct(){try{return caches}catch(e){}}function Et(){const e=Ct();e&&null==bt&&(bt=e.open(_t))}let St=1/0;const Tt={supported:!1,testSupport:function(e){!kt&&Ft&&(Pt?Ot(e):It=e)}};let It,Ft,kt=!1,Pt=!1;const Mt="undefined"!=typeof self?self:{};function Ot(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Ft),e.isContextLost())return;Tt.supported=!0}catch(e){}e.deleteTexture(t),kt=!0}Mt.document&&(Ft=Mt.document.createElement("img"),Ft.onload=function(){It&&Ot(It),It=null,Pt=!0},Ft.onerror=function(){kt=!0,It=null},Ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Lt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Lt);class Dt extends Error{constructor(e,t,r){401===t&&st(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=r}toString(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}const Ut=Ye()?()=>self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Rt=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Ut())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const r=new AbortController,n=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Ut(),referrerPolicy:e.referrerPolicy,signal:r.signal});let i=!1,o=!1;const a=(s=n.url).indexOf("sku=")>0&&st(s);var s;"json"===e.type&&n.headers.set("Accept","application/json");const l=(r,i,s)=>{if(o)return;if(r&&"SecurityError"!==r.message&&We(r.toString()),i&&s)return c(i);const l=Date.now();fetch(n).then(r=>{if(r.ok){const e=a?r.clone():null;return c(r,e,l)}return t(new Dt(r.statusText,r.status,e.url))}).catch(r=>{"AbortError"!==r.name&&t(new Error("".concat(r.message," ").concat(e.url)))})},c=(r,a,s)=>{("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then(e=>{o||(a&&s&&function(e,t,r){if(Et(),null==bt)return;const n=Je(t.headers.get("Cache-Control")||"");if(n["no-store"])return;const i={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach((e,t)=>i.headers.set(t,e)),n["max-age"]&&i.headers.set("Expires",new Date(r+1e3*n["max-age"]).toUTCString());const o=i.headers.get("Expires");if(!o)return;if(new Date(o).getTime()-r<42e4)return;let a=yt(e.url,{persistentParams:wt});if(206===t.status){const t=e.headers.get("Range");if(!t)return;i.status=200,a=gt(a,{range:t})}!function(e,t){if(void 0===Bt)try{new Response(new ReadableStream),Bt=!0}catch(e){Bt=!1}Bt?t(e.body):e.blob().then(t).catch(e=>We(e.message))}(t,e=>{const r=new Response(200!==(n=t.status)&&404!==n&&[101,103,204,205,304].includes(n)?null:e,i);var n;Et(),null!=bt&&bt.then(e=>e.put(a,r)).catch(e=>We(e.message))})}(n,a,s),i=!0,t(null,e,r.headers))}).catch(e=>{o||t(new Error(e.message))})};return a?function(e,t){if(Et(),null==bt)return t(null);bt.then(r=>{let n=yt(e.url,{persistentParams:wt});const i=e.headers.get("Range");i&&(n=gt(n,{range:i})),r.match(n).then(e=>{const i=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),r=Je(e.headers.get("Cache-Control")||"");return Number(t)>Date.now()&&!r["no-cache"]}(e);r.delete(n).catch(t),i&&r.put(n,e.clone()).catch(t),t(null,e,i)}).catch(t)}).catch(t)}(n,l):l(null,null),{cancel:()=>{o=!0,i||r.abort()}}}(e,t);if(Ye(self)&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(e,t){const r=new XMLHttpRequest;r.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(r.responseType="arraybuffer");for(const n in e.headers)r.setRequestHeader(n,e.headers[n]);return"json"===e.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===e.credentials,r.onerror=()=>{t(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let n=r.response;if("json"===e.type)try{n=JSON.parse(r.response)}catch(e){return t(e)}const i=new Headers;r.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(e=>{const t=e.split(": "),r=t.shift(),n=t.join(": ");i.append(r,n)}),t(null,n,i)}else t(new Dt(r.statusText,r.status,e.url))},r.send(e.body),{cancel:()=>r.abort()}}(e,t)},zt=function(e,t){return Rt(Object.assign(e,{type:"arrayBuffer"}),t)};function Nt(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const jt="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Qt,Vt;Qt=[],Vt=0;const Ht=function(e,t){if(Tt.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),Vt>=at.MAX_PARALLEL_IMAGE_REQUESTS){const r={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Qt.push(r),r}Vt++;let r=!1;const n=()=>{if(!r)for(r=!0,Vt--;Qt.length&&Vt<at.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Qt.shift(),{requestParameters:t,callback:r,cancelled:n}=e;n||(e.cancel=Ht(t,r).cancel)}},i=zt(e,(e,r,i)=>{n(),e?t(e):r&&(self.createImageBitmap?function(e,t){const r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(e=>{t(null,e)}).catch(e=>{t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}(r,(e,r)=>t(e,r,i)):function(e,t){const r=new Image;r.onload=()=>{t(null,r),URL.revokeObjectURL(r.src),r.onload=null,requestAnimationFrame(()=>{r.src=jt})},r.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?URL.createObjectURL(n):jt}(r,(e,r)=>t(e,r,i)))});return{cancel:()=>{i.cancel(),n()}}};var Gt,Kt,Wt,qt={exports:{}},Zt={exports:{}},Xt={exports:{}},Yt=function(){if(Wt)return qt.exports;Wt=1;var e=(Gt||(Gt=1,Zt.exports=function(e,t){var r,n,i,o,a,s,l,c;for(n=e.length-(r=3&e.length),i=t,a=3432918353,s=461845907,c=0;c<n;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,i=27492+(65535&(o=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<15|l>>>17))*s+(((l>>>16)*s&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}),Zt.exports),t=(Kt||(Kt=1,Xt.exports=function(e,t){for(var r,n=e.length,i=t^n,o=0;n>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(o)|(255&e.charCodeAt(++o))<<8|(255&e.charCodeAt(++o))<<16|(255&e.charCodeAt(++o))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++o;switch(n){case 3:i^=(255&e.charCodeAt(o+2))<<16;case 2:i^=(255&e.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}),Xt.exports);return qt.exports=e,qt.exports.murmur3=e,qt.exports.murmur2=t,qt.exports}(),Jt=xe(Yt);class $t{constructor(e){Object.assign(this,(arguments.length<=1?void 0:arguments[1])||{}),this.type=e}}class er extends $t{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super("error",Object.assign({error:e},t))}}function tr(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function rr(e,t,r){if(r&&r[e]){const n=r[e].indexOf(t);-1!==n&&r[e].splice(n,1)}}class nr{on(e,t){return this._listeners=this._listeners||{},tr(e,t,this._listeners),this}off(e,t){return rr(e,t,this._listeners),rr(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},tr(e,t,this._oneTimeListeners),this):new Promise(t=>{this.once(e,t)})}fire(e,t){const r="string"==typeof e?new $t(e,t):e,n=r.type;if(this.listens(n)){r.target=this;const e=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of e)n.call(this,r);const t=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const o of t)rr(n,o,this._oneTimeListeners),o.call(this,r);const i=this._eventedParent;if(i){const e="function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData;Object.assign(r,e),i.fire(r)}}else r instanceof er&&console.error(r.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}class ir{constructor(e){"string"==typeof e?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new ir(e)}static toString(e){return e.iconsetId?"".concat(e.name,"\x1f").concat(e.iconsetId):e.name}static parse(e){const[t,r]=e.split("\x1f");return new ir({name:t,iconsetId:r})}static isEqual(e,t){return e.name===t.name&&e.iconsetId===t.iconsetId}toString(){return ir.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var or,ar={},sr=function(){if(or)return ar;or=1;var e={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return t("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function n(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function i(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{ar.parseCSSColor=function(o){var a,s=o.replace(/ /g,"").toLowerCase();if(s in e)return e[s].slice();if("#"===s[0])return 4===s.length?(a=parseInt(s.substr(1),16))>=0&&a<=4095?[(3840&a)>>4|(3840&a)>>8,240&a|(240&a)>>4,15&a|(15&a)<<4,1]:null:7===s.length&&(a=parseInt(s.substr(1),16))>=0&&a<=16777215?[(16711680&a)>>16,(65280&a)>>8,255&a,1]:null;var l=s.indexOf("("),c=s.indexOf(")");if(-1!==l&&c+1===s.length){var u=s.substr(0,l),d=s.substr(l+1,c-(l+1)).split(","),h=1;switch(u){case"rgba":if(4!==d.length)return null;h=n(d.pop());case"rgb":return 3!==d.length?null:[r(d[0]),r(d[1]),r(d[2]),h];case"hsla":if(4!==d.length)return null;h=n(d.pop());case"hsl":if(3!==d.length)return null;var A=(parseFloat(d[0])%360+360)%360/360,f=n(d[1]),p=n(d[2]),m=p<=.5?p*(f+1):p+f-p*f,g=2*p-m;return[t(255*i(g,m,A+1/3)),t(255*i(g,m,A)),t(255*i(g,m,A-1/3)),h];default:return null}}return null}}catch(e){}return ar}();class lr{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof lr)return e;if("string"!=typeof e)return;const t=sr.parseCSSColor(e);return t?new lr(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}toString(){const[e,t,r,n]=[this.r,this.g,this.b,this.a];return"rgba(".concat(Math.round(255*e),",").concat(Math.round(255*t),",").concat(Math.round(255*r),",").concat(n,")")}toNonPremultipliedRenderColor(e){const{r:t,g:r,b:n,a:i}=this;return new ur(e,t,r,n,i)}toPremultipliedRenderColor(e){const{r:t,g:r,b:n,a:i}=this;return new dr(e,t*i,r*i,n*i,i)}clone(){return new lr(this.r,this.g,this.b,this.a)}}class cr{constructor(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(this.premultiplied=!1,this.premultiplied=o,e){const o=e.image.height,a=o*o;this.premultiplied?(t=0===i?0:t/i*(o-1),r=0===i?0:r/i*(o-1),n=0===i?0:n/i*(o-1)):(t*=o-1,r*=o-1,n*=o-1);const s=Math.floor(t),l=Math.floor(r),c=Math.floor(n),u=Math.ceil(t),d=Math.ceil(r),h=Math.ceil(n),A=t-s,f=r-l,p=n-c,m=e.image.data,g=4*(s+l*a+c*o),y=4*(s+l*a+h*o),_=4*(s+d*a+c*o),v=4*(s+d*a+h*o),x=4*(u+l*a+c*o),w=4*(u+l*a+h*o),b=4*(u+d*a+c*o),B=4*(u+d*a+h*o);if(g<0||B>=m.length)throw new Error("out of range");this.r=hr(hr(hr(m[g],m[y],p),hr(m[_],m[v],p),f),hr(hr(m[x],m[w],p),hr(m[b],m[B],p),f),A)/255*(this.premultiplied?i:1),this.g=hr(hr(hr(m[g+1],m[y+1],p),hr(m[_+1],m[v+1],p),f),hr(hr(m[x+1],m[w+1],p),hr(m[b+1],m[B+1],p),f),A)/255*(this.premultiplied?i:1),this.b=hr(hr(hr(m[g+2],m[y+2],p),hr(m[_+2],m[v+2],p),f),hr(hr(m[x+2],m[w+2],p),hr(m[b+2],m[B+2],p),f),A)/255*(this.premultiplied?i:1),this.a=i}else this.r=t,this.g=r,this.b=n,this.a=i}toArray(){const{r:e,g:t,b:r,a:n}=this;return[255*e,255*t,255*r,n]}toHslaArray(){let{r:e,g:t,b:r,a:n}=this;if(this.premultiplied){if(0===n)return[0,0,0,0];const i=1/n;e*=i,t*=i,r*=i}const i=Math.min(Math.max(e,0),1),o=Math.min(Math.max(t,0),1),a=Math.min(Math.max(r,0),1),s=Math.min(i,o,a),l=Math.max(i,o,a),c=l-s,u=.5*(s+l);if(0===c)return[0,0,100*u,n];const d=u>.5?c/(2-l-s):c/(l+s);let h;switch(l){case i:h=60*((o-a)/c+(o<a?6:0));break;case o:h=60*((a-i)/c+2);break;default:h=60*((i-o)/c+4)}return[h,100*d,100*u,n]}toArray01(){const{r:e,g:t,b:r,a:n}=this;return[e,t,r,n]}toArray01Scaled(e){const{r:t,g:r,b:n}=this;return[t*e,r*e,n*e]}toArray01Linear(){const{r:e,g:t,b:r,a:n}=this;return[Math.pow(e,2.2),Math.pow(t,2.2),Math.pow(r,2.2),n]}}class ur extends cr{constructor(e,t,r,n,i){super(e,t,r,n,i,!1)}}class dr extends cr{constructor(e,t,r,n,i){super(e,t,r,n,i,!0)}}function hr(e,t,r){return e*(1-r)+t*r}function Ar(e,t,r){return e.map((e,n)=>hr(e,t[n],r))}lr.black=new lr(0,0,0,1),lr.white=new lr(1,1,1,1),lr.transparent=new lr(0,0,0,0),lr.red=new lr(1,0,0,1),lr.blue=new lr(0,0,1,1);var fr=Object.freeze({__proto__:null,array:Ar,color:function(e,t,r){return new lr(hr(e.r,t.r,r),hr(e.g,t.g,r),hr(e.b,t.b,r),hr(e.a,t.a,r))},number:hr});class pr extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class mr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[r,n]of t)this.bindings[r]=n}concat(e){return new mr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const gr={kind:"null"},yr={kind:"number"},_r={kind:"string"},vr={kind:"boolean"},xr={kind:"color"},wr={kind:"object"},br={kind:"value"},Br={kind:"collator"},Cr={kind:"formatted"},Er={kind:"resolvedImage"};function Sr(e,t){return{kind:"array",itemType:e,N:t}}function Tr(e){if("array"===e.kind){const t=Tr(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}const Ir=[gr,yr,_r,vr,xr,Cr,wr,Sr(br),Er];function Fr(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Fr(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Ir)if(!Fr(e,t))return null}return"Expected ".concat(Tr(e)," but found ").concat(Tr(t)," instead.")}function kr(e,t){return t.some(t=>t.kind===e.kind)}function Pr(e,t){return t.some(t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e)}function Mr(e,t){return"array"===e.kind&&"array"===t.kind?e.N===t.N&&Mr(e.itemType,t.itemType):e.kind===t.kind}class Or{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Lr{constructor(e,t,r,n,i){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=n,this.textColor=i}}class Dr{constructor(e){this.sections=e}static fromString(e){return new Dr([new Lr(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Dr?e:Dr.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){const r=t.image.getPrimary().id.toString();e.push(["image",r]);continue}e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(r)}return e}}class Ur{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=ir.from(e),this.params=t.params,this.sx=t.sx||1,this.sy=t.sy||1}toString(){return JSON.stringify(this)}static parse(e){let t,r,n,i;try{({id:t,params:r,sx:n,sy:i}=JSON.parse(e)||{})}catch(e){return null}return t?new Ur(t,{params:r,sx:n,sy:i}):null}scaleSelf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.sx*=e,this.sy*=t,this}}class Rr{constructor(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.primaryId=ir.from(e),this.primaryOptions=t,r&&(this.secondaryId=ir.from(r)),this.secondaryOptions=n,this.available=i}toString(){return this.primaryId&&this.secondaryId?"[".concat(this.primaryId.name,",").concat(this.secondaryId.name,"]"):this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ur(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ur(this.secondaryId,this.secondaryOptions):null}static from(e){return"string"==typeof e?Rr.build({name:e}):e}static build(e,t,r,n){return!e||"object"==typeof e&&!("name"in e)?null:new Rr(e,r,t,n)}}function zr(e,t,r,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value [".concat([e,t,r,n].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function Nr(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof lr)return!0;if(e instanceof Or)return!0;if(e instanceof Dr)return!0;if(e instanceof Rr)return!0;if(Array.isArray(e)){for(const t of e)if(!Nr(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Nr(e[t]))return!1;return!0}return!1}function jr(e){if(null===e)return gr;if("string"==typeof e)return _r;if("boolean"==typeof e)return vr;if("number"==typeof e)return yr;if(e instanceof lr)return xr;if(e instanceof Or)return Br;if(e instanceof Dr)return Cr;if(e instanceof Rr)return Er;if(Array.isArray(e)){const t=e.length;let r;for(const n of e){const e=jr(n);if(r){if(r===e)continue;r=br;break}r=e}return Sr(r||br,t)}return wr}function Qr(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Dr||e instanceof Rr||e instanceof lr?e.toString():JSON.stringify(e)}class Vr{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(!Nr(e[1]))return t.error("invalid value");const r=e[1];let n=jr(r);const i=t.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new Vr(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof lr?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Dr?this.value.serialize():this.value}}class Hr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Gr={string:_r,number:yr,boolean:vr,object:wr};class Kr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,n=1;const i=e[0];if("array"===i){let i,o;if(e.length>2){const r=e[1];if("string"!=typeof r||!(r in Gr)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=Gr[r],n++}else i=br;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);o=e[2],n++}r=Sr(i,o)}else r=Gr[i];const o=[];for(;n<e.length;n++){const r=t.parse(e[n],n,br);if(!r)return null;o.push(r)}return new Kr(r,o)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!Fr(this.type,jr(r)))return r;if(t===this.args.length-1)throw new Hr("The expression ".concat(JSON.stringify(this.args[t].serialize())," evaluated to ").concat(Tr(jr(r))," but was expected to be of type ").concat(Tr(this.type),"."))}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){t.push(r.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map(e=>e.serialize()))}}class Wr{constructor(e){this.type=Cr,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");const n=[];let i=!1;for(let o=1;o<=e.length-1;++o){const r=e[o];if(i&&"object"==typeof r&&!Array.isArray(r)){i=!1;let e=null;if(r["font-scale"]&&(e=t.parseObjectValue(r["font-scale"],o,"font-scale",yr),!e))return null;let a=null;if(r["text-font"]&&(a=t.parseObjectValue(r["text-font"],o,"text-font",Sr(_r)),!a))return null;let s=null;if(r["text-color"]&&(s=t.parseObjectValue(r["text-color"],o,"text-color",xr),!s))return null;const l=n[n.length-1];l.scale=e,l.font=a,l.textColor=s}else{const r=t.parse(e[o],o,br);if(!r)return null;const a=r.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:r,scale:null,font:null,textColor:null})}}return new Wr(n)}evaluate(e){return new Dr(this.sections.map(t=>{const r=t.content.evaluate(e);return Mr(jr(r),Er)?new Lr("",r,null,null,null):new Lr(Qr(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class qr{constructor(e,t,r,n){this._imageWarnHistory={},this.type=Er,this.namePrimary=e,this.nameSecondary=t,r&&(this.paramsPrimary=r.params,this.iconsetIdPrimary=r.iconset?r.iconset.id:void 0),n&&(this.paramsSecondary=n.params,this.iconsetIdSecondary=n.iconset?n.iconset.id:void 0)}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");let r=1;const n=[];function i(){if(r<e.length){const i=t.parse(e[r],r++,_r);return i?(n.push({image:i,options:{}}),!0):(t.error(n.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function o(){if(r<e.length){const o=e[r];if(null===(i=o)||"object"!=typeof i||Array.isArray(i))return!0;const a=o.params,s=o.iconset,l=t.concat(r);if(!a&&!s)return r++,!0;if(a){if("object"!=typeof a||a.constructor!==Object)return l.error('Image options "params" should be an object'),!1;const e={},t=l.concat(void 0,"params");for(const r in a){if(!r)return t.error("Image parameter name should be non-empty"),!1;const n=t.concat(void 0,r).parse(a[r],void 0,xr,void 0,{typeAnnotation:"coerce"});if(!n)return!1;e[r]=n}n[n.length-1].options.params=e}if(s){if("object"!=typeof s||s.constructor!==Object)return l.error('Image options "iconset" should be an object'),!1;if(!s.id)return l.error('Image options "iconset" should have an "id" property'),!1;n[n.length-1].options.iconset=s}return r++,!0}var i;return!0}for(let a=0;a<2;a++)if(!i()||!o())return;return new qr(n[0].image,n[1]?n[1].image:void 0,n[0].options,n[1]?n[1].options:void 0)}evaluateParams(e,t){const r={};if(t){for(const n in t)if(t[n])try{r[n]=t[n].evaluate(e)}catch(e){continue}if(0!==Object.keys(r).length)return{params:r}}}evaluate(e){const t={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},r=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,n=Rr.build(t,r,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(n&&e.availableImages){const t=n.getPrimary().id;if(n.available=e.availableImages.some(e=>ir.isEqual(e,t)),n.available){const t=n.getSecondary()?n.getSecondary().id:null;t&&(n.available=e.availableImages.some(e=>ir.isEqual(e,t)))}}return n}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const t in this.paramsPrimary)this.paramsPrimary[t]&&e(this.paramsPrimary[t]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const t in this.paramsSecondary)this.paramsSecondary[t]&&e(this.paramsSecondary[t])}outputDefined(){return!1}serializeOptions(e,t){const r={};if(t&&(r.iconset={id:t}),e){r.params={};for(const t in e)e[t]&&(r.params[t]=e[t].serialize())}return Object.keys(r).length>0?r:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const t=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);t&&e.push(t)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const t=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);t&&e.push(t)}return e}}function Zr(e){return Yr(e)?"string":Jr(e)?"number":$r(e)?"boolean":Array.isArray(e)?"array":null===e?"null":Xr(e)?"object":typeof e}function Xr(e){return null!=e&&!Array.isArray(e)&&"function"!=typeof e&&!(e instanceof String||e instanceof Number||e instanceof Boolean)&&"object"==typeof e}function Yr(e){return"string"==typeof e||e instanceof String}function Jr(e){return"number"==typeof e||e instanceof Number}function $r(e){return"boolean"==typeof e||e instanceof Boolean}const en={"to-boolean":vr,"to-color":xr,"to-number":yr,"to-string":_r};class tn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0],n=[];let i=gr;if("to-array"===r){if(!Array.isArray(e[1]))return null;const r=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error("Expected ".concat(t.expectedType.kind," but found array."));i=Sr(t.expectedType.itemType,r)}else{if(!(r>0&&Nr(e[1][0])))return null;i=Sr(jr(e[1][0]),r)}for(let o=0;o<r;o++){const r=e[1][o];let a;if(Array.isArray(r))a=t.parse(r,void 0,i.itemType);else{const e=Zr(r);if(e!==i.itemType.kind)return t.error("Expected ".concat(i.itemType.kind," but found ").concat(e,"."));a=t.registry.literal.parse(["literal",void 0===r?null:r],t)}if(!a)return null;n.push(a)}}else{if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");i=en[r];for(let r=1;r<e.length;r++){const i=t.parse(e[r],r,br);if(!i)return null;n.push(i)}}return new tn(i,n)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,r;for(const n of this.args){if(t=n.evaluate(e),r=null,t instanceof lr)return t;if("string"==typeof t){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):zr(t[0],t[1],t[2],t[3]),!r))return new lr(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Hr(r||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){let t=null;for(const r of this.args){if(t=r.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new Hr("Could not convert ".concat(JSON.stringify(t)," to number."))}return"formatted"===this.type.kind?Dr.fromString(Qr(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Rr.build(Qr(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(t=>t.evaluate(e)):Qr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Wr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new qr(this.args[0]).serialize();const e="array"===this.type.kind?[]:["to-".concat(this.type.kind)];return this.eachChild(t=>{e.push(t.serialize())}),e}}const rn=["Unknown","Point","LineString","Polygon"];class nn{constructor(e,t,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t,this.iconImageUseTheme=r}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?rn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=lr.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}}class on{constructor(e,t,r,n,i){this.name=e,this.type=t,this._evaluate=r,this.args=n,this._overloadIndex=i}evaluate(e){if(!this._evaluate){const e=on.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const r=e[0],n=on.definitions[r];if(!n)return t.error('Unknown expression "'.concat(r,'". If you wanted a literal array, use ["literal", [...]].'),0);const i=Array.isArray(n)?n[0]:n.type,o=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,a=[];let s=null,l=-1;for(const[c,u]of o){if(Array.isArray(c)&&c.length!==e.length-1)continue;a.push(c),l++,s=new Ci(t.registry,t.path,null,t.scope,void 0,t._scope,t.options,t.iconImageUseTheme);const n=[];let o=!1;for(let t=1;t<e.length;t++){const r=e[t],i=Array.isArray(c)?c[t-1]:c.type,a=s.parse(r,1+n.length,i);if(!a){o=!0;break}n.push(a)}if(!o)if(Array.isArray(c)&&c.length!==n.length)s.error("Expected ".concat(c.length," arguments, but found ").concat(n.length," instead."));else{for(let e=0;e<n.length;e++){const t=Array.isArray(c)?c[e]:c.type,r=n[e];s.concat(e+1).checkSubtype(t,r.type)}if(0===s.errors.length)return new on(r,i,u,n,l)}}if(1===a.length)t.errors.push(...s.errors);else{const r=(a.length?a:o.map(e=>{let[t]=e;return t})).map(an).join(" | "),n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],1+n.length);if(!r)return null;n.push(Tr(r.type))}t.error("Expected arguments of type ".concat(r,", but found (").concat(n.join(", "),") instead."))}return null}static register(e,t){on.definitions=t;for(const r in t)e[r]=on}}function an(e){return Array.isArray(e)?"(".concat(e.map(Tr).join(", "),")"):"(".concat(Tr(e.type),"...)")}class sn{constructor(e,t,r){this.type=Br,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");const n=void 0===r["case-sensitive"]?t.parse(!1,1,vr):t.parseObjectValue(r["case-sensitive"],1,"case-sensitive",vr);if(!n)return null;const i=void 0===r["diacritic-sensitive"]?t.parse(!1,1,vr):t.parseObjectValue(r["diacritic-sensitive"],1,"diacritic-sensitive",vr);if(!i)return null;let o=null;return r.locale&&(o=t.parseObjectValue(r.locale,1,"locale",_r),!o)?null:new sn(n,i,o)}evaluate(e){return new Or(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ln(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:un;for(;n>r;){if(n-r>600){const o=n-r+1,a=t-r+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);ln(e,t,Math.max(r,Math.floor(t-a*l/o+c)),Math.min(n,Math.floor(t+(o-a)*l/o+c)),i)}const o=e[t];let a=r,s=n;for(cn(e,r,t),i(e[n],o)>0&&cn(e,r,n);a<s;){for(cn(e,a,s),a++,s--;i(e[a],o)<0;)a++;for(;i(e[s],o)>0;)s--}0===i(e[r],o)?cn(e,r,s):(s++,cn(e,s,n)),s<=t&&(r=s+1),t<=s&&(n=s-1)}}function cn(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function un(e,t){return e<t?-1:e>t?1:0}function dn(e){let t=0;for(let r,n,i=0,o=e.length,a=o-1;i<o;a=i++)r=e[i],n=e[a],t+=(n.x-r.x)*(r.y+n.y);return t}function hn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function An(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function fn(e,t,r){const n=e[0]-t[0],i=e[1]-t[1],o=e[0]-r[0],a=e[1]-r[1];return n*a-o*i==0&&n*o<=0&&i*a<=0}function pn(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!1;for(let s=0,l=t.length;s<l;s++){const l=t[s];for(let t=0,s=l.length,c=s-1;t<s;c=t++){const s=l[c],u=l[t];if(fn(e,s,u))return r;(o=s)[1]>(i=e)[1]!=(a=u)[1]>i[1]&&i[0]<(a[0]-o[0])*(i[1]-o[1])/(a[1]-o[1])+o[0]&&(n=!n)}}var i,o,a;return n}function mn(e,t,r,n){const i=n[0]-r[0],o=n[1]-r[1],a=(e[0]-r[0])*o-i*(e[1]-r[1]),s=(t[0]-r[0])*o-i*(t[1]-r[1]);return a>0&&s<0||a<0&&s>0}function gn(e,t,r,n){return 0!=(i=[n[0]-r[0],n[1]-r[1]])[0]*(o=[t[0]-e[0],t[1]-e[1]])[1]-i[1]*o[0]&&!(!mn(e,t,r,n)||!mn(r,n,e,t));var i,o}function yn(e){const t=new Be(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new Be(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const n of e[0])t.x>n.x&&(t.x=n.x),t.y>n.y&&(t.y=n.y),r.x<n.x&&(r.x=n.x),r.y<n.y&&(r.y=n.y);return{min:t,max:r}}const _n=8192;function vn(e,t){const r=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(r*i*_n),Math.round(n*i*_n)]}function xn(e,t){for(let r=0;r<t.length;r++)if(pn(e,t[r]))return!0;return!1}function wn(e,t,r){for(const n of r)for(let r=0,i=n.length,o=i-1;r<i;o=r++)if(gn(e,t,n[o],n[r]))return!0;return!1}function bn(e,t){for(let r=0;r<e.length;++r)if(!pn(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(wn(e[r],e[r+1],t))return!1;return!0}function Bn(e,t){for(let r=0;r<t.length;r++)if(bn(e,t[r]))return!0;return!1}function Cn(e,t,r){const n=[];for(let i=0;i<e.length;i++){const o=[];for(let n=0;n<e[i].length;n++){const a=vn(e[i][n],r);hn(t,a),o.push(a)}n.push(o)}return n}function En(e,t,r){const n=[];for(let i=0;i<e.length;i++){const o=Cn(e[i],t,r);n.push(o)}return n}function Sn(e,t,r,n){if(e[0]<r[0]||e[0]>r[2]){const t=.5*n;let i=e[0]-r[0]>t?-n:r[0]-e[0]>t?n:0;0===i&&(i=e[0]-r[2]>t?-n:r[2]-e[0]>t?n:0),e[0]+=i}hn(t,e)}function Tn(e,t,r,n){const i=Math.pow(2,n.z)*_n,o=[n.x*_n,n.y*_n],a=[];if(!e)return a;for(const s of e)for(const e of s){const n=[e.x+o[0],e.y+o[1]];Sn(n,t,r,i),a.push(n)}return a}function In(e,t,r,n){const i=Math.pow(2,n.z)*_n,o=[n.x*_n,n.y*_n],a=[];if(!e)return a;for(const l of e){const e=[];for(const r of l){const n=[r.x+o[0],r.y+o[1]];hn(t,n),e.push(n)}a.push(e)}if(t[2]-t[0]<=i/2){(s=t)[0]=s[1]=1/0,s[2]=s[3]=-1/0;for(const e of a)for(const n of e)Sn(n,t,r,i)}var s;return a}class Fn{constructor(e,t){this.type=vr,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(Nr(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Fn(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Fn(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Fn(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const o=Cn(t.coordinates,n,i),a=Tn(e.geometry(),r,n,i);if(!An(r,n))return!1;for(const e of a)if(!pn(e,o))return!1}if("MultiPolygon"===t.type){const o=En(t.coordinates,n,i),a=Tn(e.geometry(),r,n,i);if(!An(r,n))return!1;for(const e of a)if(!xn(e,o))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const o=Cn(t.coordinates,n,i),a=In(e.geometry(),r,n,i);if(!An(r,n))return!1;for(const e of a)if(!bn(e,o))return!1}if("MultiPolygon"===t.type){const o=En(t.coordinates,n,i),a=In(e.geometry(),r,n,i);if(!An(r,n))return!1;for(const e of a)if(!Bn(e,o))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const kn={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Pn=1/298.257223563,Mn=Pn*(2-Pn),On=Math.PI/180;class Ln{static fromTile(e,t,r){const n=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),i=Math.atan(.5*(Math.exp(n)-Math.exp(-n)))/On;return new Ln(i,r)}static get units(){return kn}constructor(e,t){if(void 0===e)throw new Error("No latitude given.");if(t&&!kn[t])throw new Error("Unknown unit ".concat(t,". Use one of: ").concat(Object.keys(kn).join(", ")));const r=6378.137*On*(t?kn[t]:1),n=Math.cos(e*On),i=1/(1-Mn*(1-n*n)),o=Math.sqrt(i);this.kx=r*o*n,this.ky=r*o*i*(1-Mn)}distance(e,t){const r=Rn(e[0]-t[0])*this.kx,n=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+n*n)}bearing(e,t){const r=Rn(t[0]-e[0])*this.kx;return Math.atan2(r,(t[1]-e[1])*this.ky)/On}destination(e,t,r){const n=r*On;return this.offset(e,Math.sin(n)*t,Math.cos(n)*t)}offset(e,t,r){return[e[0]+t/this.kx,e[1]+r/this.ky]}lineDistance(e){let t=0;for(let r=0;r<e.length-1;r++)t+=this.distance(e[r],e[r+1]);return t}area(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];for(let e=0,i=n.length,o=i-1;e<i;o=e++)t+=Rn(n[e][0]-n[o][0])*(n[e][1]+n[o][1])*(r?-1:1)}return Math.abs(t)/2*this.kx*this.ky}along(e,t){let r=0;if(t<=0)return e[0];for(let n=0;n<e.length-1;n++){const i=e[n],o=e[n+1],a=this.distance(i,o);if(r+=a,r>t)return Un(i,o,(t-(r-a))/a)}return e[e.length-1]}pointToSegmentDistance(e,t,r){let[n,i]=t,o=Rn(r[0]-n)*this.kx,a=(r[1]-i)*this.ky;if(0!==o||0!==a){const t=(Rn(e[0]-n)*this.kx*o+(e[1]-i)*this.ky*a)/(o*o+a*a);t>1?(n=r[0],i=r[1]):t>0&&(n+=o/this.kx*t,i+=a/this.ky*t)}return o=Rn(e[0]-n)*this.kx,a=(e[1]-i)*this.ky,Math.sqrt(o*o+a*a)}pointOnLine(e,t){let r=1/0,n=e[0][0],i=e[0][1],o=0,a=0;for(let s=0;s<e.length-1;s++){let l=e[s][0],c=e[s][1],u=Rn(e[s+1][0]-l)*this.kx,d=(e[s+1][1]-c)*this.ky,h=0;0===u&&0===d||(h=(Rn(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*d)/(u*u+d*d),h>1?(l=e[s+1][0],c=e[s+1][1]):h>0&&(l+=u/this.kx*h,c+=d/this.ky*h)),u=Rn(t[0]-l)*this.kx,d=(t[1]-c)*this.ky;const A=u*u+d*d;A<r&&(r=A,n=l,i=c,o=s,a=h)}return{point:[n,i],index:o,t:Math.max(0,Math.min(1,a))}}lineSlice(e,t,r){let n=this.pointOnLine(r,e),i=this.pointOnLine(r,t);if(n.index>i.index||n.index===i.index&&n.t>i.t){const e=n;n=i,i=e}const o=[n.point],a=n.index+1,s=i.index;!Dn(r[a],o[0])&&a<=s&&o.push(r[a]);for(let l=a+1;l<=s;l++)o.push(r[l]);return Dn(r[s],i.point)||o.push(i.point),o}lineSliceAlong(e,t,r){let n=0;const i=[];for(let o=0;o<r.length-1;o++){const a=r[o],s=r[o+1],l=this.distance(a,s);if(n+=l,n>e&&0===i.length&&i.push(Un(a,s,(e-(n-l))/l)),n>=t)return i.push(Un(a,s,(t-(n-l))/l)),i;n>e&&i.push(s)}return i}bufferPoint(e,t){const r=t/this.ky,n=t/this.kx;return[e[0]-n,e[1]-r,e[0]+n,e[1]+r]}bufferBBox(e,t){const r=t/this.ky,n=t/this.kx;return[e[0]-n,e[1]-r,e[2]+n,e[3]+r]}insideBBox(e,t){return Rn(e[0]-t[0])>=0&&Rn(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]}}function Dn(e,t){return e[0]===t[0]&&e[1]===t[1]}function Un(e,t,r){const n=Rn(t[0]-e[0]);return[e[0]+n*r,e[1]+(t[1]-e[1])*r]}function Rn(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}class zn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e<t?-1:e>t?1:0;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,n=t[e];for(;e>0;){const i=e-1>>1,o=t[i];if(r(n,o)>=0)break;t[e]=o,e=i}t[e]=n}_down(e){const{data:t,compare:r}=this,n=this.length>>1,i=t[e];for(;e<n;){let n=1+(e<<1);const o=n+1;if(o<this.length&&r(t[o],t[n])<0&&(n=o),r(t[n],i)>=0)break;t[e]=t[n],e=n}t[e]=i}}var Nn=8192;function jn(e,t){return t.dist-e.dist}const Qn=100,Vn=50;function Hn(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Gn(e){return e[1]-e[0]+1}function Kn(e,t){const r=e[1]>=e[0]&&e[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function Wn(e,t){if(e[0]>e[1])return[null,null];const r=Gn(e);if(t){if(2===r)return[e,null];const t=Math.floor(r/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===r)return[e,null];const t=Math.floor(r/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function qn(e,t){const r=[1/0,1/0,-1/0,-1/0];if(!Kn(t,e.length))return r;for(let n=t[0];n<=t[1];++n)hn(r,e[n]);return r}function Zn(e){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<e.length;++r)for(let n=0;n<e[r].length;++n)hn(t,e[r][n]);return t}function Xn(e,t,r){if(Hn(e)||Hn(t))return NaN;let n=0,i=0;return e[2]<t[0]&&(n=t[0]-e[2]),e[0]>t[2]&&(n=e[0]-t[2]),e[1]>t[3]&&(i=e[1]-t[3]),e[3]<t[1]&&(i=t[1]-e[3]),r.distance([0,0],[n,i])}function Yn(e){return 360*e-180}function Jn(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function $n(e,t){const r=Math.pow(2,t.z),n=(e.y/Nn+t.y)/r;return[Yn((e.x/Nn+t.x)/r),Jn(n)]}function ei(e,t){const r=[];for(let n=0;n<e.length;++n)r.push($n(e[n],t));return r}function ti(e,t,r){const n=r.pointOnLine(t,e).point;return r.distance(e,n)}function ri(e,t,r,n,i){const o=r.slice(n[0],n[1]+1);let a=1/0;for(let s=t[0];s<=t[1];++s)if(0===(a=Math.min(a,ti(e[s],o,i))))return 0;return a}function ni(e,t,r,n,i){const o=Math.min(i.pointToSegmentDistance(e,r,n),i.pointToSegmentDistance(t,r,n)),a=Math.min(i.pointToSegmentDistance(r,e,t),i.pointToSegmentDistance(n,e,t));return Math.min(o,a)}function ii(e,t,r,n,i){if(!Kn(t,e.length)||!Kn(n,r.length))return NaN;let o=1/0;for(let a=t[0];a<t[1];++a)for(let t=n[0];t<n[1];++t){if(gn(e[a],e[a+1],r[t],r[t+1]))return 0;o=Math.min(o,ni(e[a],e[a+1],r[t],r[t+1],i))}return o}function oi(e,t,r,n,i){if(!Kn(t,e.length)||!Kn(n,r.length))return NaN;let o=1/0;for(let a=t[0];a<=t[1];++a)for(let t=n[0];t<=n[1];++t)if(0===(o=Math.min(o,i.distance(e[a],r[t]))))return o;return o}function ai(e,t,r){if(pn(e,t,!0))return 0;let n=1/0;for(const i of t){const t=i.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(i[0]!==i[t-1]&&0===(n=Math.min(n,r.pointToSegmentDistance(e,i[t-1],i[0]))))return n;if(0===(n=Math.min(n,ti(e,i,r))))return n}return n}function si(e,t,r,n){if(!Kn(t,e.length))return NaN;for(let o=t[0];o<=t[1];++o)if(pn(e[o],r,!0))return 0;let i=1/0;for(let o=t[0];o<t[1];++o)for(const t of r)for(let r=0,a=t.length,s=a-1;r<a;s=r++){if(gn(e[o],e[o+1],t[s],t[r]))return 0;i=Math.min(i,ni(e[o],e[o+1],t[s],t[r],n))}return i}function li(e,t){for(const r of e)for(let e=0;e<=r.length-1;++e)if(pn(r[e],t,!0))return!0;return!1}function ci(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const i=Zn(e),o=Zn(t);if(n!==1/0&&Xn(i,o,r)>=n)return n;if(An(i,o)){if(li(e,t))return 0}else if(li(t,e))return 0;let a=n;for(const s of e)for(let e=0,n=s.length,i=n-1;e<n;i=e++)for(const o of t)for(let t=0,n=o.length,l=n-1;t<n;l=t++){if(gn(s[i],s[e],o[l],o[t]))return 0;a=Math.min(a,ni(s[i],s[e],o[l],o[t],r))}return a}function ui(e,t,r,n,i,o,a){if(null===o||null===a)return;const s=Xn(qn(n,o),qn(i,a),r);s<t&&e.push({dist:s,range1:o,range2:a})}function di(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,o=Math.min(n.distance(e[0],r[0][0]),i);if(0===o)return o;const a=new zn([{dist:0,range1:[0,e.length-1],range2:[0,0]}],jn),s=t?Vn:Qn,l=Zn(r);for(;a.length;){const i=a.pop();if(i.dist>=o)continue;const c=i.range1;if(Gn(c)<=s){if(!Kn(c,e.length))return NaN;if(t){const t=si(e,c,r,n);if(0===(o=Math.min(o,t)))return o}else for(let t=c[0];t<=c[1];++t){const i=ai(e[t],r,n);if(0===(o=Math.min(o,i)))return o}}else{const r=Wn(c,t);if(null!==r[0]){const t=Xn(qn(e,r[0]),l,n);t<o&&a.push({dist:t,range1:r[0],range2:[0,0]})}if(null!==r[1]){const t=Xn(qn(e,r[1]),l,n);t<o&&a.push({dist:t,range1:r[1],range2:[0,0]})}}}return o}function hi(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,a=Math.min(o,i.distance(e[0],r[0]));if(0===a)return a;const s=new zn([{dist:0,range1:[0,e.length-1],range2:[0,r.length-1]}],jn),l=t?Vn:Qn,c=n?Vn:Qn;for(;s.length;){const o=s.pop();if(o.dist>=a)continue;const u=o.range1,d=o.range2;if(Gn(u)<=l&&Gn(d)<=c){if(!Kn(u,e.length)||!Kn(d,r.length))return NaN;if(t&&n?a=Math.min(a,ii(e,u,r,d,i)):t||n?t&&!n?a=Math.min(a,ri(r,d,e,u,i)):!t&&n&&(a=Math.min(a,ri(e,u,r,d,i))):a=Math.min(a,oi(e,u,r,d,i)),0===a)return a}else{const o=Wn(u,t),l=Wn(d,n);ui(s,a,i,e,r,o[0],l[0]),ui(s,a,i,e,r,o[0],l[1]),ui(s,a,i,e,r,o[1],l[0]),ui(s,a,i,e,r,o[1],l[1])}}return a}function Ai(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=qn(e,[0,e.length-1]);for(const a of r)if(!(i!==1/0&&Xn(o,qn(a,[0,a.length-1]),n)>=i)&&(i=Math.min(i,hi(e,t,a,!0,n,i)),0===i))return i;return i}function fi(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=qn(e,[0,e.length-1]);for(const a of r){if(i!==1/0&&Xn(o,Zn(a),n)>=i)continue;const r=di(e,t,a,n,i);if(isNaN(r))return r;if(0===(i=Math.min(i,r)))return i}return i}function pi(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class mi{constructor(e,t){this.type=yr,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'distance' expression requires either one argument, but found ' ".concat(e.length-1," instead."));if(Nr(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(pi(t.features[e].geometry.type))return new mi(t,t.features[e].geometry)}else if("Feature"===t.type){if(pi(t.geometry.type))return new mi(t,t.geometry)}else if(pi(t.type))return new mi(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),r=e.canonicalID();if(null!=t&&null!=r){if("Point"===e.geometryType())return function(e,t,r){const n=[];for(const o of e)for(const e of o)n.push($n(e,t));const i=new Ln(n[0][1],"meters");return"Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type?hi(n,!1,"Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,i):"MultiLineString"===r.type?Ai(n,!1,r.coordinates,i):"Polygon"===r.type||"MultiPolygon"===r.type?fi(n,!1,"Polygon"===r.type?[r.coordinates]:r.coordinates,i):null}(t,r,this.geometries);if("LineString"===e.geometryType())return function(e,t,r){const n=[];for(const o of e){const e=[];for(const r of o)e.push($n(r,t));n.push(e)}const i=new Ln(n[0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return Ai("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n,i);if("MultiLineString"===r.type){let e=1/0;for(let t=0;t<r.coordinates.length;t++){const o=Ai(r.coordinates[t],!0,n,i,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}if("Polygon"===r.type||"MultiPolygon"===r.type){let e=1/0;for(let t=0;t<n.length;t++){const o=fi(n[t],!0,"Polygon"===r.type?[r.coordinates]:r.coordinates,i,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return null}(t,r,this.geometries);if("Polygon"===e.geometryType())return function(e,t,r){const n=[];for(const o of function(e){const t=e.length;if(t<=1)return[e];const r=[];let n,i;for(let o=0;o<t;o++){const t=dn(e[o]);0!==t&&(e[o].area=Math.abs(t),void 0===i&&(i=t<0),i===t<0?(n&&r.push(n),n=[e[o]]):n.push(e[o]))}return n&&r.push(n),r}(e)){const e=[];for(let r=0;r<o.length;++r)e.push(ei(o[r],t));n.push(e)}const i=new Ln(n[0][0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return fi("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n,i);if("MultiLineString"===r.type){let e=1/0;for(let t=0;t<r.coordinates.length;t++){const o=fi(r.coordinates[t],!0,n,i,e);if(isNaN(o))return o;if(0===(e=Math.min(e,o)))return e}return e}return"Polygon"===r.type||"MultiPolygon"===r.type?function(e,t,r){let n=1/0;for(const i of e)for(const e of t){const t=ci(i,e,r,n);if(isNaN(t))return t;if(0===(n=Math.min(n,t)))return n}return n}("Polygon"===r.type?[r.coordinates]:r.coordinates,n,i):null}(t,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function gi(e){if(e instanceof on){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Fn)return!1;if(e instanceof mi)return!1;if(e instanceof bi)return e.featureConstant;let t=!0;return e.eachChild(e=>{t&&!gi(e)&&(t=!1)}),t}function yi(e){if(e instanceof on&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!yi(e)&&(t=!1)}),t}function _i(e,t){if(e instanceof on&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild(e=>{r&&!_i(e,t)&&(r=!1)}),r}function vi(e,t,r){return[e,t,r].filter(Boolean).join("\x1f")}function xi(e,t){switch(e){case"string":return Qr(t);case"number":return+t;case"boolean":return!!t;case"color":return lr.parse(t);case"formatted":return Dr.fromString(Qr(t));case"resolvedImage":return Rr.build(Qr(t))}return t}function wi(e,t,r,n){return void 0!==n&&(e=n*Math.round(e/n)),void 0!==t&&e<t&&(e=t),void 0!==r&&e>r&&(e=r),e}class bi{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.type=e,this.key=t,this.scope=r,this.featureConstant=n}static parse(e,t){let r=t.expectedType;if(null==r&&(r=br),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const n=t.parse(e[1],1);if(!(n instanceof Vr))return t.error("Key name of 'config' expression must be a string literal.");let i,o=!0;const a=Qr(n.value);if(e.length>=3){const r=t.parse(e[2],2);if(!(r instanceof Vr))return t.error("Scope of 'config' expression must be a string literal.");i=Qr(r.value)}if(t.options){const e=vi(a,i,t._scope),r=t.options.get(e);r&&(o=gi(r.value||r.default))}return new bi(r,a,i,o)}evaluate(e){const t=vi(this.key,this.scope,e.scope),r=e.getConfig(t);if(!r)return null;const{type:n,value:i,values:o,minValue:a,maxValue:s,stepValue:l}=r,c=r.default.evaluate(e);let u=c;if(i){const t=e.scope;e.scope=(t||"").split("\x1f").slice(1).join("\x1f"),u=i.evaluate(e),e.scope=t}return n&&(u=xi(n,u)),void 0===u||void 0===a&&void 0===s&&void 0===l||("number"==typeof u?u=wi(u,a,s,l):Array.isArray(u)&&(u=u.map(e=>"number"==typeof e?wi(e,a,s,l):e))),void 0!==i&&void 0!==u&&o&&!o.includes(u)&&(u=c,n&&(u=xi(n,u))),(n&&n!==this.type||void 0!==u&&!Mr(jr(u),this.type))&&(u=xi(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Bi{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new Bi(r,t.scope.get(r)):t.error('Unknown variable "'.concat(r,'". Make sure "').concat(r,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ci{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new mr,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],o=arguments.length>5?arguments[5]:void 0,a=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0;this.registry=e,this.path=t,this.key=t.map(e=>"string"==typeof e?"['".concat(e,"']"):"[".concat(e,"]")).join(""),this.scope=n,this.errors=i,this.expectedType=r,this._scope=o,this.options=a,this.iconImageUseTheme=s}parse(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||r?this.concat(t,null,r,n)._parse(e,i):this._parse(e,i)}parseObjectValue(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.concat(t,r,n,i)._parse(e,o)}_parse(e,t){function r(e,t,r){return"assert"===r?new Kr(t,[e]):"coerce"===r?new tn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n="string"==typeof e[0]?this.registry[e[0]]:void 0;if(n){let i=n.parse(e,this);if(!i)return null;if(this.expectedType){const e=this.expectedType,n=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else i=r(i,e,t.typeAnnotation||"coerce");else i=r(i,e,t.typeAnnotation||"assert")}if(!(i instanceof Vr)&&"resolvedImage"!==i.type.kind&&Ei(i)){const t=new nn(this._scope,this.options,this.iconImageUseTheme);try{i=new Vr(i.type,i.evaluate(t))}catch(e){return this.error(e.message),null}}return i}return tn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}concat(e,t,r,n){let i="number"==typeof e?this.path.concat(e):this.path;i="string"==typeof t?i.concat(t):i;const o=n?this.scope.concat(n):this.scope;return new Ci(this.registry,i,r||null,o,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];const i="".concat(this.key).concat(r.map(e=>"[".concat(e,"]")).join(""));this.errors.push(new pr(i,e))}checkSubtype(e,t){const r=Fr(e,t);return r&&this.error(r),r}}function Ei(e){if(e instanceof Bi)return Ei(e.boundExpression);if(e instanceof on&&"error"===e.name)return!1;if(e instanceof sn)return!1;if(e instanceof Fn)return!1;if(e instanceof mi)return!1;if(e instanceof bi)return!1;const t=e instanceof tn||e instanceof Kr;let r=!0;return e.eachChild(e=>{r=t?r&&Ei(e):r&&e instanceof Vr}),!!r&&gi(e)&&_i(e,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Si(e,t){const r=e.length-1;let n,i,o=0,a=r,s=0;for(;o<=a;)if(s=Math.floor((o+a)/2),n=e[s],i=e[s+1],n<=t){if(s===r||t<i)return s;o=s+1}else{if(!(n>t))throw new Hr("Input is not a number.");a=s-1}return 0}class Ti{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[n,i]of r)this.labels.push(n),this.outputs.push(i)}static parse(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,yr);if(!r)return null;const n=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let o=1;o<e.length;o+=2){const r=1===o?-1/0:e[o],a=e[o+1],s=o,l=o+1;if("number"!=typeof r)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',s);if(n.length&&n[n.length-1][0]>=r)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',s);const c=t.parse(a,l,i);if(!c)return null;i=i||c.type,n.push([r,c])}return new Ti(i,r,n)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;return n>=t[i-1]?r[i-1].evaluate(e):r[Si(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}const Ii=.95047,Fi=1.08883,ki=4/29,Pi=6/29,Mi=3*Pi*Pi,Oi=Pi*Pi*Pi,Li=Math.PI/180,Di=180/Math.PI;function Ui(e){return e>Oi?Math.pow(e,1/3):e/Mi+ki}function Ri(e){return e>Pi?e*e*e:Mi*(e-ki)}function zi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Ni(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function ji(e){const t=Ni(e.r),r=Ni(e.g),n=Ni(e.b),i=Ui((.4124564*t+.3575761*r+.1804375*n)/Ii),o=Ui((.2126729*t+.7151522*r+.072175*n)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-Ui((.0193339*t+.119192*r+.9503041*n)/Fi)),alpha:e.a}}function Qi(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*Ri(t),r=Ii*Ri(r),n=Fi*Ri(n),new lr(zi(3.2404542*r-1.5371385*t-.4985314*n),zi(-.969266*r+1.8760108*t+.041556*n),zi(.0556434*r-.2040259*t+1.0572252*n),e.alpha)}function Vi(e,t,r){const n=t-e;return e+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const Hi={forward:ji,reverse:Qi,interpolate:function(e,t,r){return{l:hr(e.l,t.l,r),a:hr(e.a,t.a,r),b:hr(e.b,t.b,r),alpha:hr(e.alpha,t.alpha,r)}}},Gi={forward:function(e){const{l:t,a:r,b:n}=ji(e),i=Math.atan2(n,r)*Di;return{h:i<0?i+360:i,c:Math.sqrt(r*r+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Li,r=e.c;return Qi({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:Vi(e.h,t.h,r),c:hr(e.c,t.c,r),l:hr(e.l,t.l,r),alpha:hr(e.alpha,t.alpha,r)}}};var Ki=Object.freeze({__proto__:null,hcl:Gi,lab:Hi});class Wi{constructor(e,t,r,n,i){this.type=e,this.operator=t,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[o,a]of i)this.labels.push(o),this.outputs.push(a)}static interpolationFactor(e,t,r,n){let i=0;if("exponential"===e.name)i=qi(t,e.base,r,n);else if("linear"===e.name)i=qi(t,1,r,n);else if("cubic-bezier"===e.name){const o=e.controlPoints;i=new be(o[0],o[1],o[2],o[3]).solve(qi(t,1,r,n))}return i}static parse(e,t){let[r,n,i,...o]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error("Unknown interpolation type ".concat(String(n[0])),1,0);{const e=n.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length-1>3&&(e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,yr),!i)return null;const a=[];let s=null;"interpolate-hcl"===r||"interpolate-lab"===r?s=xr:t.expectedType&&"value"!==t.expectedType.kind&&(s=t.expectedType);for(let l=0;l<o.length;l+=2){const e=o[l],r=o[l+1],n=l+3,i=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(a.length&&a[a.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=t.parse(r,i,s);if(!c)return null;s=s||c.type,a.push([e,c])}return"number"===s.kind||"color"===s.kind||"array"===s.kind&&"number"===s.itemType.kind&&"number"==typeof s.N?new Wi(s,r,n,i,a):t.error("Type ".concat(Tr(s)," is not interpolatable."))}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);const o=Si(t,n),a=Wi.interpolationFactor(this.interpolation,n,t[o],t[o+1]),s=r[o].evaluate(e),l=r[o+1].evaluate(e);return"interpolate"===this.operator?fr[this.type.kind.toLowerCase()](s,l,a):"interpolate-hcl"===this.operator?Gi.reverse(Gi.interpolate(Gi.forward(s),Gi.forward(l),a)):Hi.reverse(Hi.interpolate(Hi.forward(s),Hi.forward(l),a))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const t=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t}}function qi(e,t,r,n){const i=n-r,o=e-r;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}class Zi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const n=t.expectedType;n&&"value"!==n.kind&&(r=n);const i=[];for(const a of e.slice(1)){const e=t.parse(a,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,i.push(e)}const o=n&&i.some(e=>Fr(n,e.type));return new Zi(o?br:r,i)}evaluate(e){let t,r=null,n=0;for(const i of this.args){if(n++,r=i.evaluate(e),r&&r instanceof Rr&&!r.available&&(t||(t=r),r=null,n===this.args.length))return t;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class Xi{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found ".concat(e.length-1," instead."));const r=[];for(let i=1;i<e.length-1;i+=2){const n=e[i];if("string"!=typeof n)return t.error("Expected string, but found ".concat(typeof n," instead."),i);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=t.parse(e[i+1],i+1);if(!o)return null;r.push([n,o])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return n?new Xi(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}class Yi{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,yr),n=t.parse(e[2],2,Sr(t.expectedType||br));return r&&n?new Yi(n.type.itemType,r,n):null}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Hr("Array index out of bounds: negative index");if(t>=r.length)throw new Hr("Array index out of bounds: index exceeds array size");if(t!==Math.floor(t))throw new Hr("Array index must be an integer. Use at-interpolated for fractional indices");return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ji{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,yr),n=t.parse(e[2],2,Sr(t.expectedType||br));return r&&n?new Ji(n.type.itemType,r,n):null}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Hr("Array index out of bounds: ".concat(t," < 0."));if(t>r.length-1)throw new Hr("Array index out of bounds: ".concat(t," > ").concat(r.length-1,"."));if(t===Math.floor(t))return r[t];const n=Math.floor(t),i=Math.ceil(t),o=r[n],a=r[i];if("number"!=typeof o||"number"!=typeof a)throw new Hr("Cannot interpolate between non-number values at index ".concat(t,"."));const s=t-n;return o*(1-s)+a*s}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class $i{constructor(e,t){this.type=vr,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,br),n=t.parse(e[2],2,br);return r&&n?kr(r.type,[vr,_r,yr,gr,br])?new $i(r,n):t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Tr(r.type)," instead")):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!Pr(t,["boolean","string","number","null"]))throw new Hr("Expected first argument to be of type boolean, string, number or null, but found ".concat(Tr(jr(t))," instead."));if(!Pr(r,["string","array"]))throw new Hr("Expected second argument to be of type array or string, but found ".concat(Tr(jr(r))," instead."));return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class eo{constructor(e,t,r){this.type=yr,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,br),n=t.parse(e[2],2,br);if(!r||!n)return null;if(!kr(r.type,[vr,_r,yr,gr,br]))return t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Tr(r.type)," instead"));if(4===e.length){const i=t.parse(e[3],3,yr);return i?new eo(r,n,i):null}return new eo(r,n)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Pr(t,["boolean","string","number","null"]))throw new Hr("Expected first argument to be of type boolean, string, number or null, but found ".concat(Tr(jr(t))," instead."));if(!Pr(r,["string","array"]))throw new Hr("Expected second argument to be of type array or string, but found ".concat(Tr(jr(r))," instead."));if(this.fromIndex){const n=this.fromIndex.evaluate(e);return r.indexOf(t,n)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class to{constructor(e,t,r,n,i,o){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o}static parse(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i={},o=[];for(let l=2;l<e.length-1;l+=2){let a=e[l];const s=e[l+1];Array.isArray(a)||(a=[a]);const c=t.concat(l);if(0===a.length)return c.error("Expected at least one branch label.");for(const e of a){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(r){if(c.checkSubtype(r,jr(e)))return null}else r=jr(e);if(void 0!==i[String(e)])return c.error("Branch labels must be unique.");i[String(e)]=o.length}const u=t.parse(s,l,n);if(!u)return null;n=n||u.type,o.push(u)}const a=t.parse(e[1],1,br);if(!a)return null;const s=t.parse(e[e.length-1],e.length-1,n);return s?"value"!==a.type.kind&&t.concat(1).checkSubtype(r,a.type)?null:new to(r,n,a,i,o,s):null}evaluate(e){const t=this.input.evaluate(e);return(Mr(jr(t),this.inputType)&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],n={};for(const o of t){const e=n[this.cases[o]];void 0===e?(n[this.cases[o]]=r.length,r.push([this.cases[o],[o]])):r[e][1].push(o)}const i=e=>"number"===this.inputType.kind?Number(e):e;for(const[o,a]of r)e.push(1===a.length?i(a[0]):a.map(i)),e.push(this.outputs[o].serialize());return e.push(this.otherwise.serialize()),e}}class ro{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n=[];for(let o=1;o<e.length-1;o+=2){const i=t.parse(e[o],o,vr);if(!i)return null;const a=t.parse(e[o+1],o+1,r);if(!a)return null;n.push([i,a]),r=r||a.type}const i=t.parse(e[e.length-1],e.length-1,r);return i?new ro(r,n,i):null}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(e=>{let[t,r]=e;return r.outputDefined()})&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class no{constructor(e,t,r,n){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,br),n=t.parse(e[2],2,yr);if(!r||!n)return null;if(!kr(r.type,[Sr(br),_r,br]))return t.error("Expected first argument to be of type array or string, but found ".concat(Tr(r.type)," instead"));if(4===e.length){const i=t.parse(e[3],3,yr);return i?new no(r.type,r,n,i):null}return new no(r.type,r,n)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Pr(t,["string","array"]))throw new Hr("Expected first argument to be of type array or string, but found ".concat(Tr(jr(t))," instead."));if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(r,n)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class io{constructor(e,t){this.type=Sr(_r),this.str=e,this.delimiter=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,_r),n=t.parse(e[2],2,_r);return r&&n?new io(r,n):void 0}evaluate(e){const t=this.str.evaluate(e),r=this.delimiter.evaluate(e);return t.split(r)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function oo(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function ao(e,t,r,n){return 0===n.compare(t,r)}function so(e,t,r){const n="=="!==e&&"!="!==e;return class i{constructor(e,t,r){this.type=vr,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const r=e[0];let o=t.parse(e[1],1,br);if(!o)return null;if(!oo(r,o.type))return t.concat(1).error('"'.concat(r,"\" comparisons are not supported for type '").concat(Tr(o.type),"'."));let a=t.parse(e[2],2,br);if(!a)return null;if(!oo(r,a.type))return t.concat(2).error('"'.concat(r,"\" comparisons are not supported for type '").concat(Tr(a.type),"'."));if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot compare types '".concat(Tr(o.type),"' and '").concat(Tr(a.type),"'."));n&&("value"===o.type.kind&&"value"!==a.type.kind?o=new Kr(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new Kr(o.type,[a])));let s=null;if(4===e.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return t.error("Cannot use collator to compare non-string types.");if(s=t.parse(e[3],3,Br),!s)return null}return new i(o,a,s)}evaluate(i){const o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){const t=jr(o),r=jr(a);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new Hr('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(t.kind,", ").concat(r.kind,") instead."))}if(this.collator&&!n&&this.hasUntypedArgument){const e=jr(o),r=jr(a);if("string"!==e.kind||"string"!==r.kind)return t(i,o,a)}return this.collator?r(i,o,a,this.collator.evaluate(i)):t(i,o,a)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild(e=>{t.push(e.serialize())}),t}}}const lo=so("==",function(e,t,r){return t===r},ao),co=so("!=",function(e,t,r){return t!==r},function(e,t,r,n){return!ao(0,t,r,n)}),uo=so("<",function(e,t,r){return t<r},function(e,t,r,n){return n.compare(t,r)<0}),ho=so(">",function(e,t,r){return t>r},function(e,t,r,n){return n.compare(t,r)>0}),Ao=so("<=",function(e,t,r){return t<=r},function(e,t,r,n){return n.compare(t,r)<=0}),fo=so(">=",function(e,t,r){return t>=r},function(e,t,r,n){return n.compare(t,r)>=0});class po{constructor(e,t,r,n,i,o){this.type=_r,this.number=e,this.locale=t,this.currency=r,this.unit=n,this.minFractionDigits=i,this.maxFractionDigits=o}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,yr);if(!r)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let i=null;if(n.locale&&(i=t.parseObjectValue(n.locale,2,"locale",_r),!i))return null;let o=null;if(n.currency&&(o=t.parseObjectValue(n.currency,2,"currency",_r),!o))return null;let a=null;if(n.unit&&(a=t.parseObjectValue(n.unit,2,"unit",_r),!a))return null;let s=null;if(n["min-fraction-digits"]&&(s=t.parseObjectValue(n["min-fraction-digits"],2,"min-fraction-digits",yr),!s))return null;let l=null;return n["max-fraction-digits"]&&(l=t.parseObjectValue(n["max-fraction-digits"],2,"max-fraction-digits",yr),!l)?null:new po(r,i,o,a,s,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class mo{constructor(e){this.type=yr,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error("Expected argument of type string or array, but found ".concat(Tr(r.type)," instead.")):new mo(r):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Hr("Expected value to be of type string or array, but found ".concat(Tr(jr(t))," instead."))}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}function go(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const yo={"==":lo,"!=":co,">":ho,"<":uo,">=":fo,"<=":Ao,array:Kr,at:Yi,"at-interpolated":Ji,boolean:Kr,case:ro,coalesce:Zi,collator:sn,format:Wr,image:qr,in:$i,"index-of":eo,interpolate:Wi,"interpolate-hcl":Wi,"interpolate-lab":Wi,length:mo,let:Xi,literal:Vr,match:to,number:Kr,"number-format":po,object:Kr,slice:no,step:Ti,string:Kr,"to-boolean":tn,"to-color":tn,"to-number":tn,"to-string":tn,var:Bi,within:Fn,distance:mi,config:bi,split:io};function _o(e,t){let[r,n,i,o]=t;r=r.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const a=o?o.evaluate(e):1,s=zr(r,n,i,a);if(s)throw new Hr(s);return new lr(r/255,n/255,i/255,a)}function vo(e,t){let[r,n,i,o]=t;r=r.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const a=o?o.evaluate(e):1,s=function(e,t,r,n){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof r&&r>=0&&r<=100?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid hsla value [".concat([e,t,r,n].join(", "),"]: 'a' must be between 0 and 1."):"Invalid hsla value [".concat(("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", "),"]: 's', and 'l' must be between 0 and 100."):"Invalid hsla value [".concat(("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", "),"]: 'h' must be between 0 and 360.")}(r,n,i,a);if(s)throw new Hr(s);const l="hsla(".concat(r,", ").concat(n,"%, ").concat(i,"%, ").concat(a,")"),c=lr.parse(l);if(!c)throw new Hr("Failed to parse HSLA color: ".concat(l));return c}function xo(e,t){return e in t}function wo(e,t){const r=t[e];return void 0===r?null:r}function bo(e){return{type:e}}function Bo(e){if(e instanceof bi)return new Set([e.key]);let t=new Set;return e.eachChild(e=>{t=new Set([...t,...Bo(e)])}),t}function Co(e){if(e instanceof on&&"is-active-floor"===e.name)return!0;let t=!1;return e.eachChild(e=>{!t&&Co(e)&&(t=!0)}),t}function Eo(e){return{result:"success",value:e}}function So(e){return{result:"error",value:e}}function To(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Io(e){return"data-driven"===e["property-type"]}function Fo(e){return To(e.expression,"measure-light")}function ko(e){return To(e.expression,"zoom")}function Po(e){return!!e.expression&&e.expression.interpolated}function Mo(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Oo(e){return e}function Lo(e,t){const r="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],i=n||!(n||void 0!==e.property),o=e.type||(Po(t)?"exponential":"interval");if(r&&((e=Object.assign({},e)).stops&&(e.stops=e.stops.map(e=>[e[0],lr.parse(e[1])])),e.default=lr.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Ki[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));let a,s,l;if("exponential"===o)a=zo;else if("interval"===o)a=Ro;else if("categorical"===o){a=Uo,s=Object.create(null);for(const t of e.stops)s[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==o)throw new Error('Unknown function type "'.concat(o,'"'));a=No}if(n){const r={},n=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],o=i[0].zoom;void 0===r[o]&&(r[o]={zoom:o,type:e.type,property:e.property,default:e.default,stops:[]},n.push(o)),r[o].stops.push([i[0].value,i[1]])}const i=[];for(const e of n)i.push([r[e].zoom,Lo(r[e],t)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:Wi.interpolationFactor.bind(void 0,o),zoomStops:i.map(e=>e[0]),evaluate:(r,n)=>{let{zoom:o}=r;return zo({stops:i,base:e.base},t,o).evaluate(o,n)}}}if(i){const r="exponential"===o?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:Wi.interpolationFactor.bind(void 0,r),zoomStops:e.stops.map(e=>e[0]),evaluate:r=>{let{zoom:n}=r;return a(e,t,n,s,l)}}}return{kind:"source",evaluate(r,n){const i=n&&n.properties?n.properties[e.property]:void 0;return void 0===i?Do(e.default,t.default):a(e,t,i,s,l)}}}function Do(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function Uo(e,t,r,n,i){return Do(typeof r===i?n[r]:void 0,e.default,t.default)}function Ro(e,t,r){if(!Jr(r))return Do(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];const i=Si(e.stops.map(e=>e[0]),r);return e.stops[i][1]}function zo(e,t,r){const n=void 0!==e.base?e.base:1;if(!Jr(r))return Do(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];const o=Si(e.stops.map(e=>e[0]),r),a=function(e,t,r,n){const i=n-r,o=e-r;return 0===i?0:1===t?o/i:(Math.pow(t,o)-1)/(Math.pow(t,i)-1)}(r,n,e.stops[o][0],e.stops[o+1][0]),s=e.stops[o][1],l=e.stops[o+1][1];let c=fr[t.type]||Oo;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Ki[e.colorSpace];c=(e,r)=>t.reverse(t.interpolate(t.forward(e),t.forward(r),a))}return"function"==typeof s.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=s.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==i)return c(n,i,a)}}:c(s,l,a)}function No(e,t,r){return"color"===t.type?r=lr.parse(r):"formatted"===t.type?r=Dr.fromString(r.toString()):"resolvedImage"===t.type?r=Rr.build(r.toString()):Zr(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),Do(r,e.default,t.default)}on.register(yo,{error:[{kind:"error"},[_r],(e,t)=>{let[r]=t;throw new Hr(r.evaluate(e))}],typeof:[_r,[br],(e,t)=>{let[r]=t;return Tr(jr(r.evaluate(e)))}],"to-rgba":[Sr(yr,4),[xr],(e,t)=>{let[r]=t;return r.evaluate(e).toNonPremultipliedRenderColor(null).toArray()}],"to-hsla":[Sr(yr,4),[xr],(e,t)=>{let[r]=t;return r.evaluate(e).toNonPremultipliedRenderColor(null).toHslaArray()}],rgb:[xr,[yr,yr,yr],_o],rgba:[xr,[yr,yr,yr,yr],_o],hsl:[xr,[yr,yr,yr],vo],hsla:[xr,[yr,yr,yr,yr],vo],has:{type:vr,overloads:[[[_r],(e,t)=>{let[r]=t;return xo(r.evaluate(e),e.properties())}],[[_r,wr],(e,t)=>{let[r,n]=t;return xo(r.evaluate(e),n.evaluate(e))}]]},get:{type:br,overloads:[[[_r],(e,t)=>{let[r]=t;return wo(r.evaluate(e),e.properties())}],[[_r,wr],(e,t)=>{let[r,n]=t;return wo(r.evaluate(e),n.evaluate(e))}]]},"feature-state":[br,[_r],(e,t)=>{let[r]=t;return wo(r.evaluate(e),e.featureState||{})}],properties:[wr,[],e=>e.properties()],"geometry-type":[_r,[],e=>e.geometryType()],worldview:[_r,[],e=>e.globals.worldview||""],"is-active-floor":[vr,bo(_r),(e,t)=>{if(!(e.globals.activeFloors&&e.globals.activeFloors.size>0))return!1;const r=e.globals.activeFloors;return t.some(t=>{const n=t.evaluate(e);return r.has(n)})}],id:[br,[],e=>e.id()],zoom:[yr,[],e=>e.globals.zoom],pitch:[yr,[],e=>e.globals.pitch||0],"distance-from-center":[yr,[],e=>e.distanceFromCenter()],"measure-light":[yr,[_r],(e,t)=>{let[r]=t;return e.measureLight(r.evaluate(e))}],"heatmap-density":[yr,[],e=>e.globals.heatmapDensity||0],"line-progress":[yr,[],e=>e.globals.lineProgress||0],"raster-value":[yr,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[yr,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[yr,[],e=>e.globals.skyRadialProgress||0],accumulated:[br,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[yr,bo(yr),(e,t)=>{let r=0;for(const n of t)r+=n.evaluate(e);return r}],"*":[yr,bo(yr),(e,t)=>{let r=1;for(const n of t)r*=n.evaluate(e);return r}],"-":{type:yr,overloads:[[[yr,yr],(e,t)=>{let[r,n]=t;return r.evaluate(e)-n.evaluate(e)}],[[yr],(e,t)=>{let[r]=t;return-r.evaluate(e)}]]},"/":[yr,[yr,yr],(e,t)=>{let[r,n]=t;return r.evaluate(e)/n.evaluate(e)}],"%":[yr,[yr,yr],(e,t)=>{let[r,n]=t;return r.evaluate(e)%n.evaluate(e)}],ln2:[yr,[],()=>Math.LN2],pi:[yr,[],()=>Math.PI],e:[yr,[],()=>Math.E],"^":[yr,[yr,yr],(e,t)=>{let[r,n]=t;return Math.pow(r.evaluate(e),n.evaluate(e))}],sqrt:[yr,[yr],(e,t)=>{let[r]=t;return Math.sqrt(r.evaluate(e))}],log10:[yr,[yr],(e,t)=>{let[r]=t;return Math.log(r.evaluate(e))/Math.LN10}],ln:[yr,[yr],(e,t)=>{let[r]=t;return Math.log(r.evaluate(e))}],log2:[yr,[yr],(e,t)=>{let[r]=t;return Math.log2(r.evaluate(e))}],sin:[yr,[yr],(e,t)=>{let[r]=t;return Math.sin(r.evaluate(e))}],cos:[yr,[yr],(e,t)=>{let[r]=t;return Math.cos(r.evaluate(e))}],tan:[yr,[yr],(e,t)=>{let[r]=t;return Math.tan(r.evaluate(e))}],asin:[yr,[yr],(e,t)=>{let[r]=t;return Math.asin(r.evaluate(e))}],acos:[yr,[yr],(e,t)=>{let[r]=t;return Math.acos(r.evaluate(e))}],atan:[yr,[yr],(e,t)=>{let[r]=t;return Math.atan(r.evaluate(e))}],min:[yr,bo(yr),(e,t)=>Math.min(...t.map(t=>t.evaluate(e)))],max:[yr,bo(yr),(e,t)=>Math.max(...t.map(t=>t.evaluate(e)))],abs:[yr,[yr],(e,t)=>{let[r]=t;return Math.abs(r.evaluate(e))}],round:[yr,[yr],(e,t)=>{let[r]=t;const n=r.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[yr,[yr],(e,t)=>{let[r]=t;return Math.floor(r.evaluate(e))}],ceil:[yr,[yr],(e,t)=>{let[r]=t;return Math.ceil(r.evaluate(e))}],"filter-==":[vr,[_r,br],(e,t)=>{let[r,n]=t;return e.properties()[r.value]===n.value}],"filter-id-==":[vr,[br],(e,t)=>{let[r]=t;return e.id()===r.value}],"filter-type-==":[vr,[_r],(e,t)=>{let[r]=t;return e.geometryType()===r.value}],"filter-<":[vr,[_r,br],(e,t)=>{let[r,n]=t;const i=e.properties()[r.value],o=n.value;return typeof i==typeof o&&i<o}],"filter-id-<":[vr,[br],(e,t)=>{let[r]=t;const n=e.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[vr,[_r,br],(e,t)=>{let[r,n]=t;const i=e.properties()[r.value],o=n.value;return typeof i==typeof o&&i>o}],"filter-id->":[vr,[br],(e,t)=>{let[r]=t;const n=e.id(),i=r.value;return typeof n==typeof i&&n>i}],"filter-<=":[vr,[_r,br],(e,t)=>{let[r,n]=t;const i=e.properties()[r.value],o=n.value;return typeof i==typeof o&&i<=o}],"filter-id-<=":[vr,[br],(e,t)=>{let[r]=t;const n=e.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[vr,[_r,br],(e,t)=>{let[r,n]=t;const i=e.properties()[r.value],o=n.value;return typeof i==typeof o&&i>=o}],"filter-id->=":[vr,[br],(e,t)=>{let[r]=t;const n=e.id(),i=r.value;return typeof n==typeof i&&n>=i}],"filter-has":[vr,[br],(e,t)=>{let[r]=t;return r.value in e.properties()}],"filter-has-id":[vr,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[vr,[Sr(_r)],(e,t)=>{let[r]=t;return r.value.indexOf(e.geometryType())>=0}],"filter-id-in":[vr,[Sr(br)],(e,t)=>{let[r]=t;return r.value.indexOf(e.id())>=0}],"filter-in-small":[vr,[_r,Sr(br)],(e,t)=>{let[r,n]=t;return n.value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[vr,[_r,Sr(br)],(e,t)=>{let[r,n]=t;return function(e,t,r,n){for(;r<=n;){const i=r+n>>1;if(t[i]===e)return!0;t[i]>e?n=i-1:r=i+1}return!1}(e.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:vr,overloads:[[[vr,vr],(e,t)=>{let[r,n]=t;return r.evaluate(e)&&n.evaluate(e)}],[bo(vr),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:vr,overloads:[[[vr,vr],(e,t)=>{let[r,n]=t;return r.evaluate(e)||n.evaluate(e)}],[bo(vr),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[vr,[vr],(e,t)=>{let[r]=t;return!r.evaluate(e)}],"is-supported-script":[vr,[_r],(e,t)=>{let[r]=t;const n=e.globals&&e.globals.isSupportedScript;return!n||n(r.evaluate(e))}],upcase:[_r,[_r],(e,t)=>{let[r]=t;return r.evaluate(e).toUpperCase()}],downcase:[_r,[_r],(e,t)=>{let[r]=t;return r.evaluate(e).toLowerCase()}],concat:[_r,bo(br),(e,t)=>t.map(t=>Qr(t.evaluate(e))).join("")],"resolved-locale":[_r,[Br],(e,t)=>{let[r]=t;return r.evaluate(e).resolvedLocale()}],random:[yr,[yr,yr,br],(e,t)=>{const[r,n,i]=t.map(t=>t.evaluate(e));if(r>n)return r;if(r===n)return r;let o;if("string"==typeof i)o=function(e){let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}(i);else{if("number"!=typeof i)throw new Hr("Invalid seed input: ".concat(i));o=i}return r+go(o)()*(n-r)}]});class jo{constructor(e,t,r,n,i){this.expression=e,this._warningHistory={},this._scope=r,this._options=n,this._iconImageUseTheme=i,this._evaluator=new nn(r,n,i),this._defaultValue=t?function(e){return"color"===e.type&&(Mo(e.default)||Array.isArray(e.default))?new lr(0,0,0,0):"color"===e.type?lr.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null,this.configDependencies=Bo(e),this.isIndoorDependent=Co(e)}evaluateWithoutErrorHandling(e,t,r,n,i,o,a,s){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,n,i,o,a,s,l){this._evaluator||(this._evaluator=new nn(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this._evaluator.iconImageUseTheme=l||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Hr("Expected value to be one of ".concat(Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", "),", but found ").concat(JSON.stringify(e)," instead."));return e}catch(e){const t=e;return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn('Failed to evaluate expression "'.concat(JSON.stringify(this.expression.serialize()),'". ').concat(t.message))),this._defaultValue}}}function Qo(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in yo}function Vo(e,t,r,n,i){const o=new Ci(yo,[],t?function(e){const t={color:xr,string:_r,number:yr,enum:_r,boolean:vr,formatted:Cr,resolvedImage:Er};return"array"===e.type?Sr(t[e.value]||br,e.length):t[e.type]}(t):void 0,void 0,void 0,r,n,i),a=o.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return a?Eo(new jo(a,t,r,n,i)):So(o.errors)}class Ho{constructor(e,t,r,n){this.kind=e,this._styleExpression=t,this.isLightConstant=r,this.isLineProgressConstant=n,this.isStateDependent="constant"!==e&&!yi(t.expression),this.configDependencies=Bo(t.expression),this.isIndoorDependent=Co(t.expression)}evaluateWithoutErrorHandling(e,t,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,o)}evaluate(e,t,r,n,i,o,a){return this._styleExpression.evaluate(e,t,r,n,i,o,void 0,void 0,a)}}class Go{constructor(e,t,r,n,i,o){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!yi(t.expression),this.isIndoorDependent=Co(t.expression),this.isLightConstant=i,this.isLineProgressConstant=o,this.configDependencies=Bo(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,o)}evaluate(e,t,r,n,i,o){return this._styleExpression.evaluate(e,t,r,n,i,o)}interpolationFactor(e,t,r){return this.interpolationType?Wi.interpolationFactor(this.interpolationType,e,t,r):0}}function Ko(e,t,r,n,i){if("error"===(e=Vo(e,t,r,n,i)).result)return e;const o=e.value.expression,a=gi(o);if(!a&&!Io(t))return So([new pr("","data expressions not supported")]);const s=_i(o,["zoom","pitch","distance-from-center"]);if(!s&&!ko(t))return So([new pr("","zoom expressions not supported")]);const l=_i(o,["measure-light"]);if(!l&&!Fo(t))return So([new pr("","measure-light expression not supported")]);const c=_i(o,["line-progress"]);if(!c&&!function(e){return To(e.expression,"line-progress")}(t))return So([new pr("","line-progress expression not supported")]);const u=t.expression&&t.expression.relaxZoomRestriction,d=qo(o);return d||s||u?d instanceof pr?So([d]):d instanceof Wi&&!Po(t)?So([new pr("",'"interpolate" expressions cannot be used with this property')]):Eo(d?new Go(a&&c?"camera":"composite",e.value,d.labels,d instanceof Wi?d.interpolation:void 0,l,c):new Ho(a&&c?"constant":"source",e.value,l,c)):So([new pr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Wo{constructor(e,t){this._parameters=e,this._specification=t,Object.assign(this,Lo(this._parameters,this._specification))}static deserialize(e){return new Wo(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function qo(e){let t=null;if(e instanceof Xi)t=qo(e.result);else if(e instanceof Zi){for(const r of e.args)if(t=qo(r),t)break}else(e instanceof Ti||e instanceof Wi)&&e.input instanceof on&&"zoom"===e.input.name&&(t=e);return t instanceof pr||e.eachChild(e=>{const r=qo(e);r instanceof pr?t=r:t&&r&&t!==r&&(t=new pr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Zo,Xo,Yo=function(){if(Xo)return Zo;Xo=1,Zo=t;var e=3;function t(t,r,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var o=new Int32Array(this.arrayBuffer);t=o[0],this.d=(r=o[1])+2*(n=o[2]);for(var a=0;a<this.d*this.d;a++){var s=o[e+a],l=o[e+a+1];i.push(s===l?null:o.subarray(s,l))}var c=o[e+i.length+1];this.keys=o.subarray(o[e+i.length],c),this.bboxes=o.subarray(c),this.insert=this._insertReadonly}else{this.d=r+2*n;for(var u=0;u<this.d*this.d;u++)i.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=n,this.scale=r/t,this.uid=0;var d=n/r*t;this.min=-d,this.max=t+d}return t.prototype.insert=function(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(e,t,r,n,i,o){this.cells[i].push(o)},t.prototype.query=function(e,t,r,n,i){var o=this.min,a=this.max;if(e<=o&&t<=o&&a<=r&&a<=n&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(e,t,r,n,this._queryCell,s,{},i),s},t.prototype._queryCell=function(e,t,r,n,i,o,a,s){var l=this.cells[i];if(null!==l)for(var c=this.keys,u=this.bboxes,d=0;d<l.length;d++){var h=l[d];if(void 0===a[h]){var A=4*h;(s?s(u[A+0],u[A+1],u[A+2],u[A+3]):e<=u[A+2]&&t<=u[A+3]&&r>=u[A+0]&&n>=u[A+1])?(a[h]=!0,o.push(c[h])):a[h]=!1}}},t.prototype._forEachCell=function(e,t,r,n,i,o,a,s){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(r),d=this._convertToCellCoord(n),h=l;h<=u;h++)for(var A=c;A<=d;A++){var f=this.d*A+h;if((!s||s(this._convertFromCellCoord(h),this._convertFromCellCoord(A),this._convertFromCellCoord(h+1),this._convertFromCellCoord(A+1)))&&i.call(this,e,t,r,n,f,o,a,s))return}},t.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},t.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,r=e+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var o=new Int32Array(r+n+this.keys.length+this.bboxes.length);o[0]=this.extent,o[1]=this.n,o[2]=this.padding;for(var a=r,s=0;s<t.length;s++){var l=t[s];o[e+s]=a,o.set(l,a),a+=l.length}return o[e+t.length]=a,o.set(this.keys,a),o[e+t.length+1]=a+=this.keys.length,o.set(this.bboxes,a),a+=this.bboxes.length,o.buffer},Zo}(),Jo=xe(Yo);const $o={};function ea(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writable:!1}),$o[t]={klass:e,omit:r.omit||[]}}ea(Object,"Object"),Jo.serialize=function(e,t){const r=e.toArrayBuffer();return t&&t.add(r),{buffer:r}},Jo.deserialize=function(e){return new Jo(e.buffer)},Object.defineProperty(Jo,"name",{value:"Grid"}),ea(Jo,"Grid"),delete Be.prototype.constructor,ea(lr,"Color"),ea(Error,"Error"),ea(Dr,"Formatted"),ea(Lr,"FormattedSection"),ea(Dt,"AJAXError"),ea(Rr,"ResolvedImage"),ea(Wo,"StylePropertyFunction"),ea(jo,"StyleExpression",{omit:["_evaluator"]}),ea(ir,"ImageId"),ea(Ur,"ImageVariant"),ea(Go,"ZoomDependentExpression"),ea(Ho,"ZoomConstantExpression"),ea(on,"CompoundExpression",{omit:["_evaluate"]});for(const iw in yo)$o[yo[iw]._classRegistryKey]||ea(yo[iw],"Expression".concat(iw));function ta(e){return e&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function ra(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(ta(e)||e instanceof ImageBitmap)return t&&t.add(e),e;if(ArrayBuffer.isView(e))return t&&t.add(e.buffer),e;if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const r=[];for(const n of e)r.push(ra(n,t));return r}if(e instanceof Map){const r={$name:"Map",entries:[]};for(const[n,i]of e.entries())r.entries.push(ra(n),ra(i,t));return r}if(e instanceof Set){const t={$name:"Set"};let r=0;for(const n of e.values())t[++r]=ra(n);return t}if("bigint"==typeof e)return{$name:"BigInt",value:e.toString()};if("object"==typeof e){const r=e.constructor,n=r._classRegistryKey;if(!n)throw new Error("Can't serialize object of unregistered class \"".concat(r.name,'".'));const i=r.serialize?r.serialize(e,t):{};if(!r.serialize){for(const r in e)e.hasOwnProperty(r)&&($o[n].omit.indexOf(r)>=0||(i[r]=ra(e[r],t)));e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(i.$name=n),i}throw new Error("can't serialize object of type "+typeof e)}function na(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||ta(e)||e instanceof ImageBitmap||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(na);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=e.entries||[],r=new Map;for(let e=0;e<t.length;e+=2)r.set(na(t[e]),na(t[e+1]));return r}if("Set"===t){const t=new Set;for(const r of Object.keys(e))"$name"!==r&&t.add(na(e[r]));return t}if("BigInt"===t)return BigInt(e.value);const{klass:r}=$o[t];if(!r)throw new Error("Can't deserialize unregistered class \"".concat(t,'".'));if(r.deserialize)return r.deserialize(e);const n=Object.create(r.prototype);for(const i of Object.keys(e))"$name"!==i&&(n[i]=na(e[i]));return n}throw new Error("can't deserialize object of type "+typeof e)}const ia={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,Osage:e=>e>=66736&&e<=66815,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function oa(e){for(const t of e)if(la(t.charCodeAt(0)))return!0;return!1}function aa(e){for(const t of e)if(!sa(t.charCodeAt(0)))return!1;return!0}function sa(e){return!(ia.Arabic(e)||ia["Arabic Supplement"](e)||ia["Arabic Extended-A"](e)||ia["Arabic Presentation Forms-A"](e)||ia["Arabic Presentation Forms-B"](e))}function la(e){return!(746!==e&&747!==e&&(e<4352||!(ia["Bopomofo Extended"](e)||ia.Bopomofo(e)||ia["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||ia["CJK Compatibility Ideographs"](e)||ia["CJK Compatibility"](e)||ia["CJK Radicals Supplement"](e)||ia["CJK Strokes"](e)||!(!ia["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||ia["CJK Unified Ideographs Extension A"](e)||ia["CJK Unified Ideographs"](e)||ia["Enclosed CJK Letters and Months"](e)||ia["Hangul Compatibility Jamo"](e)||ia["Hangul Jamo Extended-A"](e)||ia["Hangul Jamo Extended-B"](e)||ia["Hangul Jamo"](e)||ia["Hangul Syllables"](e)||ia.Hiragana(e)||ia["Ideographic Description Characters"](e)||ia.Kanbun(e)||ia["Kangxi Radicals"](e)||ia["Katakana Phonetic Extensions"](e)||ia.Katakana(e)&&12540!==e||!(!ia["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!ia["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||ia["Unified Canadian Aboriginal Syllabics"](e)||ia["Unified Canadian Aboriginal Syllabics Extended"](e)||ia["Vertical Forms"](e)||ia["Yijing Hexagram Symbols"](e)||ia["Yi Syllables"](e)||ia["Yi Radicals"](e))))}function ca(e){return!(la(e)||function(e){return!!(ia["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||ia["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||ia["Letterlike Symbols"](e)||ia["Number Forms"](e)||ia["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||ia["Control Pictures"](e)&&9251!==e||ia["Optical Character Recognition"](e)||ia["Enclosed Alphanumerics"](e)||ia["Geometric Shapes"](e)||ia["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||ia["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||ia["CJK Symbols and Punctuation"](e)||ia.Katakana(e)||ia["Private Use Area"](e)||ia["CJK Compatibility Forms"](e)||ia["Small Form Variants"](e)||ia["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function ua(e){return ia.Arabic(e)||ia["Arabic Supplement"](e)||ia["Arabic Extended-A"](e)||ia["Arabic Presentation Forms-A"](e)||ia["Arabic Presentation Forms-B"](e)}function da(e){return e>=1424&&e<=2303||ia["Arabic Presentation Forms-A"](e)||ia["Arabic Presentation Forms-B"](e)}function ha(e,t){return!(!t&&da(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||ia.Khmer(e))}function Aa(e){for(const t of e)if(da(t.charCodeAt(0)))return!0;return!1}const fa={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let pa=null,ma=fa.unavailable,ga=null;const ya=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(ma=fa.error),pa&&pa(e)};function _a(){va.fire(new $t("pluginStateChange",{pluginStatus:ma,pluginURL:ga}))}const va=new nr,xa=function(){return ma},wa=function(){if(ma!==fa.deferred||!ga)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ma=fa.loading,_a(),ga&&zt({url:ga},e=>{e?ya(e):(ma=fa.loaded,_a())})},ba={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ma===fa.loaded||null!=ba.applyArabicShaping,isLoading:()=>ma===fa.loading,setState(e){ma=e.pluginStatus,ga=e.pluginURL},isParsing:()=>ma===fa.parsing,isParsed:()=>ma===fa.parsed,getPluginURL:()=>ga};class Ba{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness,this.worldview=t.worldview,this.activeFloors=t.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const r of e)if(!ha(r.charCodeAt(0),t))return!1;return!0}(e,ba.isLoaded())}}class Ca{constructor(e,t,r,n,i){this.property=e,this.value=t,this.expression=function(e,t,r,n,i){if(Mo(e))return new Wo(e,t);if(Qo(e)||Array.isArray(e)&&e.length>0){const o=Ko(e,t,r,n,i);if("error"===o.result)throw new Error(o.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));return o.value}{let r=e;return"string"==typeof e&&"color"===t.type&&(r=lr.parse(e)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>r}}}(void 0===t?e.specification.default:t,e.specification,r,n,i)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r,n){return this.property.possiblyEvaluate(this,e,t,r,n)}}class Ea{constructor(e,t,r,n){this.property=e,this.value=new Ca(e,void 0,t,r,n)}transitioned(e,t){return new Ta(this.property,this.value,t,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Ta(this.property,this.value,null,{},0)}}class Sa{constructor(e,t,r,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=r,this._iconImageUseTheme=n,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return He(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ea(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new Ca(this._values[e].property,null===t?void 0:He(t),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,t){t&&(this._options=t);const r=this._properties.properties;if(e)for(const n in e){const t=e[n];if(n.endsWith("-transition")){const e=n.slice(0,-11);r[e]&&this.setTransition(e,t)}else r.hasOwnProperty(n)&&this.setValue(n,t)}}getTransition(e){return He(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new Ea(this._values[e].property)),this._values[e].transition=He(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r);const n=this.getTransition(t);void 0!==n&&(e["".concat(t,"-transition")]=n)}return e}transitioned(e,t){const r=new Ia(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,t._values[n]);return r}untransitioned(){const e=new Ia(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Ta{constructor(e,t,r,n,i){const o=n.delay||0,a=n.duration||0;i=i||0,this.property=e,this.value=t,this.begin=i+o,this.end=this.begin+a,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const n=e.now||0,i=this.value.possiblyEvaluate(e,t,r),o=this.prior;if(o){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return o.possiblyEvaluate(e,t,r);{const a=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(e,t,r),i,ke(a))}}return i}}class Ia{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const n=new Pa(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Fa{constructor(e,t,r,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=r,this._iconImageUseTheme=n,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return He(this._values[e].value)}setValue(e,t){this._values[e]=new Ca(this._values[e].property,null===t?void 0:He(t),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r)}return e}possiblyEvaluate(e,t,r,n){const i=new Pa(this._properties);for(const o of Object.keys(this._values))i._values[o]=this._values[o].possiblyEvaluate(e,t,r,n);return i}isIndoorDependent(){return this._isIndoorDependent}}class ka{constructor(e,t,r,n){this.property=e,this.value=t,this.parameters=r,this.iconImageUseTheme=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,n){return this.property.evaluate(this.value,this.parameters,e,t,r,n,this.iconImageUseTheme)}}class Pa{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ma{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){const n=fr[this.specification.type];return n?n(e,t,r):e}}class Oa{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,n,i){return"constant"===e.expression.kind||"camera"===e.expression.kind?new ka(this,{kind:"constant",value:e.expression.evaluate(t,null,{},r,n,void 0,i)},t):new ka(this,e.expression,t,i)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new ka(this,{kind:"constant",value:void 0},e.parameters);const n=fr[this.specification.type];return n?new ka(this,{kind:"constant",value:n(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,n,i,o,a){return"constant"===e.kind?e.value:e.evaluate(t,r,n,i,o,void 0,a)}}class La{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){return!!e.expression.evaluate(t,null,{},r,n)}interpolate(){return!1}}class Da{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new Ba(0,{});for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const i=this.defaultPropertyValues[r]=new Ca(n,void 0),o=this.defaultTransitionablePropertyValues[r]=new Ea(n);this.defaultTransitioningPropertyValues[r]=o.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=i.possiblyEvaluate(t)}}}ea(Oa,"DataDrivenProperty"),ea(Ma,"DataConstantProperty"),ea(La,"ColorRampProperty");var Ua=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Ra(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function za(e){if(Array.isArray(e))return e.map(za);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=za(e[r]);return t}return Ra(e)}function Na(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Na(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function ja(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Na(e)||(e=qa(e));const i=e;let o=!0;try{o=function(e){if(!Ha(e))return e;let t=za(e);return Va(t),t=Qa(t),t}(i)}catch(e){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(i,null,2),"\n        "))}let a=null,s=null;if("background"!==n&&"sky"!==n&&"slot"!==n){s=Ua["filter_".concat(n)];const e=Vo(o,s,t,r);if("error"===e.result)throw new Error(e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));a=(t,r,n)=>e.value.evaluate(t,r,{},n)}let l=null,c=null;if(o!==i){const e=Vo(i,s,t,r);if("error"===e.result)throw new Error(e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));l=(t,r,n,i,o)=>e.value.evaluate(t,r,{},n,void 0,void 0,i,o),c=!gi(e.value.expression)}return{filter:a,dynamicFilter:l||void 0,needGeometry:Wa(o),needFeature:!!c}}function Qa(e){if(!Array.isArray(e))return e;const t=function(e){if(Ga.has(e[0]))for(let t=1;t<e.length;t++)if(Ha(e[t]))return!0;return e}(e);return!0===t?t:t.map(e=>Qa(e))}function Va(e){let t=!1;const r=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||Ha(e[n]),r.push(e[n+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||Ha(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||Ha(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}t&&(e.length=0,e.push("any",...r));for(let n=1;n<e.length;n++)Va(e[n])}function Ha(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let r=1;r<e.length;r++)if(Ha(e[r]))return!0;return!1}const Ga=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Ka(e,t){return e<t?-1:e>t?1:0}function Wa(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Wa(e[t]))return!0;return!1}function qa(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Za(e[1],e[2],"=="):"!="===t?Ja(Za(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Za(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(qa))):"all"===t?["all"].concat(e.slice(1).map(qa)):"none"===t?["all"].concat(e.slice(1).map(qa).map(Ja)):"in"===t?Xa(e[1],e.slice(2)):"!in"===t?Ja(Xa(e[1],e.slice(2))):"has"===t?Ya(e[1]):"!has"!==t||Ja(Ya(e[1]));var r}function Za(e,t,r){switch(e){case"$type":return["filter-type-".concat(r),t];case"$id":return["filter-id-".concat(r),t];default:return["filter-".concat(r),e,t]}}function Xa(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Ka)]]:["filter-in-small",e,["literal",t]]}}function Ya(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ja(e){return["!",e]}const $a="\x1f";function es(e,t){return t?"".concat(e).concat($a).concat(t):e}let ts;const rs=()=>ts||(ts=new Da({"icon-size":new Oa(Ua.layout_symbol["icon-size"]),"icon-image":new Oa(Ua.layout_symbol["icon-image"]),"icon-rotate":new Oa(Ua.layout_symbol["icon-rotate"]),"icon-offset":new Oa(Ua.layout_symbol["icon-offset"]),"text-size":new Oa(Ua.layout_symbol["text-size"]),"text-rotate":new Oa(Ua.layout_symbol["text-rotate"]),"text-offset":new Oa(Ua.layout_symbol["text-offset"])}));class ns{constructor(e,t,r,n,i,o){const a=Vo(e,Ua.appearance.condition);if("success"===a.result&&(this.condition=a.value),this.name=t,r){this.properties=new Pa(rs()),this.unevaluatedLayout=new Fa(rs(),n,i,o);for(const e in r)this.unevaluatedLayout.setValue(e,r[e])}}isActive(e){return!(this.condition||!e.isHidden||"hidden"!==this.name)||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,t,r){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,t,r))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),t=this.hasProperty("icon-size"),r=this.hasProperty("icon-offset"),n=this.hasProperty("icon-rotate");return e||t||r||n}hasTextProperties(){const e=this.hasProperty("text-size"),t=this.hasProperty("text-offset"),r=this.hasProperty("text-rotate");return e||t||r}hasProperty(e){return void 0!==this.getUnevaluatedProperty(e).value}}const is="-transition",os=new Set(["fill","line","background","hillshade","raster"]);class as extends nr{constructor(e,t,r,n,i,o){if(super(),this.id=e.id,this.fqid=es(this.id,r),this.type=e.type,this.scope=r,this.lut=n,this.options=i,this.iconImageUseTheme=o,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},"custom"!==e.type){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const t=Vo(this.filter,Ua["filter_".concat(e.type)]);"error"!==t.result&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...t.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||t.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),t.layout&&(this._unevaluatedLayout=new Fa(t.layout,this.scope,i,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),t.paint){this._transitionablePaint=new Sa(t.paint,this.scope,i);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Pa(t.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&os.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const r=this._unevaluatedLayout;r._properties.properties[e]&&(r.setValue(e,t),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...r.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||r.isIndoorDependent(),"visibility"===e&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(e=>{this.appearances.push(new ns(e.condition,e.name,e.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(is)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,t){const r=this._transitionablePaint,n=r._properties.properties;if(e.endsWith(is)){const i=e.slice(0,-11);return n[i]&&r.setTransition(i,t||void 0),!1}if(!n[e])return!1;const i=r._values[e],o=i.value.isDataDriven(),a=i.value;r.setValue(e,t),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...r.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||r.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const s=r._values[e].value,l=s.isDataDriven(),c=e.endsWith("pattern")||"line-dasharray"===e;return l||o||c||this._handleOverridablePaintPropertyUpdate(e,a,s)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t,r){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return 0!==this.appearances.length&&(e.appearances=this.appearances.map(e=>e.serialize())),Ve(e,(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof ka&&Io(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}for(const e of this.appearances)if(!yi(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=ja(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,t,r){return{}}queryRadius(e){}queryIntersectsFeature(e,t,r,n,i,o,a,s,l){}}const ss={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ls{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const cs=new ArrayBuffer(0);class us{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,t){return e._trim(),t&&e.arrayBuffer&&t.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,e.arrayBuffer?t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement:(t.capacity=0,t.arrayBuffer=cs),t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ds(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=0,n=0;return{members:e.map(e=>{const i=ss[e.type].BYTES_PER_ELEMENT,o=r=hs(r,Math.max(t,i)),a=e.components||1;return n=Math.max(n,i),r+=i*a,{name:e.name,type:e.type,components:a,offset:o}}),size:hs(r,Math.max(n,t)),alignment:t}}function hs(e,t){return Math.ceil(e/t)*t}class As extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=r,e}}As.prototype.bytesPerElement=4,ea(As,"StructArrayLayout2i4");class fs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.int16[i+2]=n,e}}fs.prototype.bytesPerElement=6,ea(fs,"StructArrayLayout3i6");class ps extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const o=4*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.int16[o+2]=n,this.int16[o+3]=i,e}}ps.prototype.bytesPerElement=8,ea(ps,"StructArrayLayout4i8");class ms extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ms.prototype.bytesPerElement=4,ea(ms,"StructArrayLayout1f4");class gs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=4*e,o=2*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.float32[o+1]=n,e}}gs.prototype.bytesPerElement=8,ea(gs,"StructArrayLayout2i1f8");class ys extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=4*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.int16[i+2]=n,e}}ys.prototype.bytesPerElement=8,ea(ys,"StructArrayLayout3i8");class _s extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i)}emplace(e,t,r,n,i,o){const a=5*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=i,this.int16[a+4]=o,e}}_s.prototype.bytesPerElement=10,ea(_s,"StructArrayLayout5i10");class vs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,o,a)}emplace(e,t,r,n,i,o,a,s){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.uint8[c+4]=n,this.uint8[c+5]=i,this.uint8[c+6]=o,this.uint8[c+7]=a,this.float32[u+2]=s,e}}vs.prototype.bytesPerElement=12,ea(vs,"StructArrayLayout2i4ub1f12");class xs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.float32[i+0]=t,this.float32[i+1]=r,this.float32[i+2]=n,e}}xs.prototype.bytesPerElement=12,ea(xs,"StructArrayLayout3f12");class ws extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i)}emplace(e,t,r,n,i,o){const a=6*e,s=3*e;return this.uint16[a+0]=t,this.uint16[a+1]=r,this.uint16[a+2]=n,this.uint16[a+3]=i,this.float32[s+2]=o,e}}ws.prototype.bytesPerElement=12,ea(ws,"StructArrayLayout4ui1f12");class bs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const o=4*e;return this.uint16[o+0]=t,this.uint16[o+1]=r,this.uint16[o+2]=n,this.uint16[o+3]=i,e}}bs.prototype.bytesPerElement=8,ea(bs,"StructArrayLayout4ui8");class Bs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,o)}emplace(e,t,r,n,i,o,a){const s=6*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,e}}Bs.prototype.bytesPerElement=12,ea(Bs,"StructArrayLayout6i12");class Cs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l,c,u,d){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,r,n,i,o,a,s,l,c,u,d)}emplace(e,t,r,n,i,o,a,s,l,c,u,d,h){const A=12*e;return this.int16[A+0]=t,this.int16[A+1]=r,this.int16[A+2]=n,this.int16[A+3]=i,this.uint16[A+4]=o,this.uint16[A+5]=a,this.uint16[A+6]=s,this.uint16[A+7]=l,this.int16[A+8]=c,this.int16[A+9]=u,this.int16[A+10]=d,this.int16[A+11]=h,e}}Cs.prototype.bytesPerElement=24,ea(Cs,"StructArrayLayout4i4ui4i24");class Es extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,o)}emplace(e,t,r,n,i,o,a){const s=10*e,l=5*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=n,this.float32[l+2]=i,this.float32[l+3]=o,this.float32[l+4]=a,e}}Es.prototype.bytesPerElement=20,ea(Es,"StructArrayLayout3i3f20");class Ss extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const o=4*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,e}}Ss.prototype.bytesPerElement=16,ea(Ss,"StructArrayLayout4f16");class Ts extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Ts.prototype.bytesPerElement=4,ea(Ts,"StructArrayLayout1ul4");class Is extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=r,e}}Is.prototype.bytesPerElement=4,ea(Is,"StructArrayLayout2ui4");class Fs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l,c,u,d,h){const A=this.length;return this.resize(A+1),this.emplace(A,e,t,r,n,i,o,a,s,l,c,u,d,h)}emplace(e,t,r,n,i,o,a,s,l,c,u,d,h,A){const f=20*e,p=10*e;return this.int16[f+0]=t,this.int16[f+1]=r,this.int16[f+2]=n,this.int16[f+3]=i,this.int16[f+4]=o,this.float32[p+3]=a,this.float32[p+4]=s,this.float32[p+5]=l,this.float32[p+6]=c,this.int16[f+14]=u,this.uint32[p+8]=d,this.uint16[f+18]=h,this.uint16[f+19]=A,e}}Fs.prototype.bytesPerElement=40,ea(Fs,"StructArrayLayout5i4f1i1ul2ui40");class ks extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,o,a)}emplace(e,t,r,n,i,o,a,s){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.int16[l+2]=n,this.int16[l+4]=i,this.int16[l+5]=o,this.int16[l+6]=a,this.int16[l+7]=s,e}}ks.prototype.bytesPerElement=16,ea(ks,"StructArrayLayout3i2i2i16");class Ps extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i)}emplace(e,t,r,n,i,o){const a=4*e,s=8*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=n,this.int16[s+6]=i,this.int16[s+7]=o,e}}Ps.prototype.bytesPerElement=16,ea(Ps,"StructArrayLayout2f1f2i16");class Ms extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,o)}emplace(e,t,r,n,i,o,a){const s=20*e,l=5*e;return this.uint8[s+0]=t,this.uint8[s+1]=r,this.float32[l+1]=n,this.float32[l+2]=i,this.float32[l+3]=o,this.float32[l+4]=a,e}}Ms.prototype.bytesPerElement=20,ea(Ms,"StructArrayLayout2ub4f20");class Os extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=r,this.uint16[i+2]=n,e}}Os.prototype.bytesPerElement=6,ea(Os,"StructArrayLayout3ui6");class Ls extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v){const x=this.length;return this.resize(x+1),this.emplace(x,e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v)}emplace(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x){const w=30*e,b=15*e,B=60*e;return this.int16[w+0]=t,this.int16[w+1]=r,this.int16[w+2]=n,this.float32[b+2]=i,this.float32[b+3]=o,this.uint16[w+8]=a,this.uint16[w+9]=s,this.uint32[b+5]=l,this.uint32[b+6]=c,this.uint32[b+7]=u,this.uint16[w+16]=d,this.uint16[w+17]=h,this.uint16[w+18]=A,this.float32[b+10]=f,this.float32[b+11]=p,this.uint8[B+48]=m,this.uint8[B+49]=g,this.uint8[B+50]=y,this.uint32[b+13]=_,this.int16[w+28]=v,this.uint8[B+58]=x,e}}Ls.prototype.bytesPerElement=60,ea(Ls,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ds extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x,w,b,B,C,E,S,T,I,F,k,P){const M=this.length;return this.resize(M+1),this.emplace(M,e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x,w,b,B,C,E,S,T,I,F,k,P)}emplace(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x,w,b,B,C,E,S,T,I,F,k,P,M){const O=20*e,L=40*e,D=80*e;return this.float32[O+0]=t,this.float32[O+1]=r,this.int16[L+4]=n,this.int16[L+5]=i,this.int16[L+6]=o,this.int16[L+7]=a,this.int16[L+8]=s,this.int16[L+9]=l,this.int16[L+10]=c,this.int16[L+11]=u,this.int16[L+12]=d,this.uint16[L+13]=h,this.uint16[L+14]=A,this.uint16[L+15]=f,this.uint16[L+16]=p,this.uint16[L+17]=m,this.uint16[L+18]=g,this.uint16[L+19]=y,this.uint16[L+20]=_,this.uint16[L+21]=v,this.uint16[L+22]=x,this.uint16[L+23]=w,this.uint16[L+24]=b,this.uint16[L+25]=B,this.uint16[L+26]=C,this.uint16[L+27]=E,this.uint32[O+14]=S,this.float32[O+15]=T,this.float32[O+16]=I,this.float32[O+17]=F,this.float32[O+18]=k,this.uint8[D+76]=P,this.uint16[L+39]=M,e}}Ds.prototype.bytesPerElement=80,ea(Ds,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Us extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,o)}emplace(e,t,r,n,i,o,a){const s=6*e;return this.float32[s+0]=t,this.float32[s+1]=r,this.float32[s+2]=n,this.float32[s+3]=i,this.float32[s+4]=o,this.float32[s+5]=a,e}}Us.prototype.bytesPerElement=24,ea(Us,"StructArrayLayout6f24");class Rs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i)}emplace(e,t,r,n,i,o){const a=5*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=i,this.float32[a+4]=o,e}}Rs.prototype.bytesPerElement=20,ea(Rs,"StructArrayLayout5f20");class zs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,o,a)}emplace(e,t,r,n,i,o,a,s){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=r,this.float32[l+2]=n,this.float32[l+3]=i,this.float32[l+4]=o,this.float32[l+5]=a,this.float32[l+6]=s,e}}zs.prototype.bytesPerElement=28,ea(zs,"StructArrayLayout7f28");class Ns extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l,c,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,r,n,i,o,a,s,l,c,u)}emplace(e,t,r,n,i,o,a,s,l,c,u,d){const h=11*e;return this.float32[h+0]=t,this.float32[h+1]=r,this.float32[h+2]=n,this.float32[h+3]=i,this.float32[h+4]=o,this.float32[h+5]=a,this.float32[h+6]=s,this.float32[h+7]=l,this.float32[h+8]=c,this.float32[h+9]=u,this.float32[h+10]=d,e}}Ns.prototype.bytesPerElement=44,ea(Ns,"StructArrayLayout11f44");class js extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,r,n,i,o,a,s,l)}emplace(e,t,r,n,i,o,a,s,l,c){const u=9*e;return this.float32[u+0]=t,this.float32[u+1]=r,this.float32[u+2]=n,this.float32[u+3]=i,this.float32[u+4]=o,this.float32[u+5]=a,this.float32[u+6]=s,this.float32[u+7]=l,this.float32[u+8]=c,e}}js.prototype.bytesPerElement=36,ea(js,"StructArrayLayout9f36");class Qs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=r,e}}Qs.prototype.bytesPerElement=8,ea(Qs,"StructArrayLayout2f8");class Vs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const o=6*e;return this.uint32[3*e+0]=t,this.uint16[o+2]=r,this.uint16[o+3]=n,this.uint16[o+4]=i,e}}Vs.prototype.bytesPerElement=12,ea(Vs,"StructArrayLayout1ul3ui12");class Hs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Hs.prototype.bytesPerElement=2,ea(Hs,"StructArrayLayout1ui2");class Gs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p){const m=this.length;return this.resize(m+1),this.emplace(m,e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p)}emplace(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m){const g=16*e;return this.float32[g+0]=t,this.float32[g+1]=r,this.float32[g+2]=n,this.float32[g+3]=i,this.float32[g+4]=o,this.float32[g+5]=a,this.float32[g+6]=s,this.float32[g+7]=l,this.float32[g+8]=c,this.float32[g+9]=u,this.float32[g+10]=d,this.float32[g+11]=h,this.float32[g+12]=A,this.float32[g+13]=f,this.float32[g+14]=p,this.float32[g+15]=m,e}}Gs.prototype.bytesPerElement=64,ea(Gs,"StructArrayLayout16f64");class Ks extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,o,a){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i,o,a)}emplace(e,t,r,n,i,o,a,s){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=r,this.uint16[l+2]=n,this.uint16[l+3]=i,this.float32[c+2]=o,this.float32[c+3]=a,this.float32[c+4]=s,e}}Ks.prototype.bytesPerElement=20,ea(Ks,"StructArrayLayout4ui3f20");class Ws extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.int16[1*e+0]=t,e}}Ws.prototype.bytesPerElement=2,ea(Ws,"StructArrayLayout1i2");class qs extends us{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}qs.prototype.bytesPerElement=1,ea(qs,"StructArrayLayout1ub1");class Zs extends ls{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Zs.prototype.size=40;class Xs extends Fs{get(e){return new Zs(this,e)}}ea(Xs,"CollisionBoxArray");class Ys extends ls{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ys.prototype.size=60;class Js extends Ls{get(e){return new Ys(this,e)}}ea(Js,"PlacedSymbolArray");class $s extends ls{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}$s.prototype.size=80;class el extends Ds{get(e){return new $s(this,e)}}ea(el,"SymbolInstanceArray");class tl extends ms{getoffsetX(e){return this.float32[1*e+0]}}ea(tl,"GlyphOffsetArray");class rl extends As{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}ea(rl,"SymbolLineVertexArray");class nl extends ls{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}nl.prototype.size=12;class il extends Vs{get(e){return new nl(this,e)}}ea(il,"FeatureIndexArray");class ol extends Is{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}ea(ol,"FillExtrusionCentroidArray");class al extends ls{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}al.prototype.size=6;class sl extends fs{get(e){return new al(this,e)}}ea(sl,"FillExtrusionWallArray");const ll=ds([{name:"a_pos",components:2,type:"Int16"}],4),cl=ds([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),ul=ds([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class dl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,r,n){let i=this.segments[this.segments.length-1];return e>dl.MAX_VERTEX_ARRAY_LENGTH&&We("Max vertices per segment is ".concat(dl.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(e)),(!i||i.vertexLength+e>dl.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:t,primitiveOffset:r,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i}prepareSegment(e,t,r,n){return this._prepareSegment(e,t.length,r.length,n)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,n){return new dl([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}function hl(e,t){return 256*(e=Oe(Math.floor(e),0,255))+Oe(Math.floor(t),0,255)}dl.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,ea(dl,"SegmentVector");const Al=ds([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),fl=ds([{name:"a_pattern_b",components:4,type:"Uint16"}]),pl=ds([{name:"a_dash",components:4,type:"Uint16"}]);class ml{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,r,n){this.ids.push(gl(e)),this.positions.push(t,r,n)}eachPosition(e,t){const r=gl(e);let n=0,i=this.ids.length-1;for(;n<i;){const e=n+i>>1;this.ids[e]>=r?i=e:n=e+1}for(;this.ids[n]===r;)t(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++}static serialize(e,t){const r=new Float64Array(e.ids),n=new Uint32Array(e.positions);return yl(r,n,0,r.length-1),t&&(t.add(r.buffer),t.add(n.buffer)),{ids:r,positions:n}}static deserialize(e){const t=new ml;let r;t.ids=e.ids,t.positions=e.positions;for(const n of t.ids)n!==r&&t.uniqueIds.push(n),r=n;return t.indexed=!0,t}}function gl(e){const t=+e;return Number.isSafeInteger(t)?t:Jt(String(e))}function yl(e,t,r,n){for(;r<n;){const i=e[r+n>>1];let o=r-1,a=n+1;for(;;){do{o++}while(e[o]<i);do{a--}while(e[a]>i);if(o>=a)break;_l(e,o,a),_l(t,3*o,3*a),_l(t,3*o+1,3*a+1),_l(t,3*o+2,3*a+2)}a-r<n-a?(yl(e,t,r,a),r=a+1):(yl(e,t,a+1,n),n=a)}}function _l(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}ea(ml,"FeaturePositionMap");class vl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}set(e,t,r){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class xl extends vl{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class wl extends vl{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class bl extends vl{constructor(e){super(e),this.current=[0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class Bl extends vl{constructor(e){super(e),this.current=[0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class Cl extends vl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class El extends vl{constructor(e){super(e),this.current=lr.transparent.toPremultipliedRenderColor(null)}set(e,t,r){this.fetchUniformLocation(e,t)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Sl=new Float32Array(16);class Tl extends vl{constructor(e){super(e),this.current=Sl}set(e,t,r){if(this.fetchUniformLocation(e,t)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const Il=new Float32Array(9),Fl=new Float32Array(4);class kl extends vl{constructor(e){super(e),this.current=Fl}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let n=0;n<4;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}function Pl(e){return[hl(255*e.r,255*e.g),hl(255*e.b,255*e.a)]}function Ml(e,t,r,n,i,o,a,s){return!!e&&("composite"===e.kind||"source"===e.kind?"none"===e.evaluate(new Ba(0,{brightness:o,worldview:s}),t,r,i,n,a):"none"===e.value)}class Ol{constructor(e,t,r,n){this.value=e,this.uniformNames=t.map(e=>"u_".concat(e)),this.type=r,this.context=n}setUniform(e,t,r,n,i){const o=n.constantOr(this.value);t.set(e,i,o instanceof lr?o.toPremultipliedRenderColor(this.lutExpression&&"constant"===this.lutExpression.kind&&"none"===this.lutExpression.value?null:this.context.lut):o)}getBinding(e,t){return"color"===this.type?new El(e):new wl(e)}}class Ll{constructor(e,t){this.uniformNames=t.map(e=>"u_".concat(e)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,t){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=t?t.tl.concat(t.br):this.pattern}setUniform(e,t,r,n,i){let o=null;"u_pattern"!==i&&"u_dash"!==i||(o=this.pattern),"u_pattern_b"===i&&(o=this.patternTransition),"u_pixel_ratio"===i&&(o=this.pixelRatio),o&&t.set(e,i,o)}getBinding(e,t){return"u_pattern"===t||"u_pattern_b"===t||"u_dash"===t?new Cl(e):new wl(e)}}class Dl{constructor(e,t,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new n}populatePaintArray(e,t,r,n,i,o,a,s){const l=this.paintVertexArray.length,c="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new Ba(0,{brightness:o,worldview:s}),t,{},i,n,a):"constant"===this.expression.kind&&this.expression.value,u=Ml(this.lutExpression,t,{},n,i,o,a,s);this.paintVertexArray.resize(e),this._setPaintValue(l,e,c,u?null:this.context.lut)}updatePaintArray(e,t,r,n,i,o,a,s){const l="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:a,worldview:s},r,n,void 0,i):"constant"===this.expression.kind&&this.expression.value,c=Ml(this.lutExpression,r,n,i,void 0,a,void 0,s);this._setPaintValue(e,t,l,c?null:this.context.lut)}_setPaintValue(e,t,r,n){if("color"===this.type){const i=Pl(r.toPremultipliedRenderColor(n));for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i[0],i[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ul{constructor(e,t,r,n,i,o){this.expression=e,this.uniformNames=t.map(e=>"u_".concat(e,"_t")),this.type=r,this.useIntegerZoom=n,this.context=i,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(e,t,r,n,i,o,a,s){const l=this.expression.evaluate(new Ba(this.context.zoom,{brightness:o,worldview:s}),t,{},i,n,a),c=this.expression.evaluate(new Ba(this.context.zoom+1,{brightness:o,worldview:s}),t,{},i,n,a),u=Ml(this.lutExpression,t,{},n,i,o,a,s),d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(d,e,l,c,u?null:this.context.lut)}updatePaintArray(e,t,r,n,i,o,a,s){const l=this.expression.evaluate({zoom:this.context.zoom,brightness:a,worldview:s},r,n,void 0,i),c=this.expression.evaluate({zoom:this.context.zoom+1,brightness:a,worldview:s},r,n,void 0,i),u=Ml(this.lutExpression,r,n,i,void 0,a,void 0,s);this._setPaintValue(e,t,l,c,u?null:this.context.lut)}_setPaintValue(e,t,r,n,i){if("color"===this.type){const n=Pl(r.toPremultipliedRenderColor(i)),o=Pl(r.toPremultipliedRenderColor(i));for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n[0],n[1],o[0],o[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,r,n,i){const o=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,a=Oe(this.expression.interpolationFactor(o,this.context.zoom,this.context.zoom+1),0,1);t.set(e,i,a)}getBinding(e,t){return new wl(e)}}class Rl{constructor(e,t,r,n,i){this.expression=e,this.layerId=i,this.paintVertexAttributes=("array"===r?pl:Al).members;for(let o=0;o<t.length;++o);this.paintVertexArray=new n,this.paintTransitionVertexArray=new bs}populatePaintArray(e,t,r,n){const i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,n,i,o,a){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],o)}_setPaintValues(e,t,r,n){if(!n||!r)return;const i=n[r[0]],o=n[r[1]];if(i){if(i){const{tl:r,br:n,pixelRatio:o}=i;for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1],n[0],n[1],o)}if(o){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:r,br:n}=o;for(let i=e;i<t;i++)this.paintTransitionVertexArray.emplace(i,r[0],r[1],n[0],n[1])}}}upload(e){const t=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,t)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,fl.members,t))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class zl{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[],this.context=t;const n=[];for(const i in e.paint._values){const o=e.paint.get(i);if(i.endsWith("-use-theme"))continue;if(!r(i))continue;if(!(o instanceof ka&&Io(o.property.specification)))continue;const a=Ql(i,e.type),s=o.value,l=o.property.specification.type,c=!!o.property.useIntegerZoom,u="line-dasharray"===i||i.endsWith("pattern"),d=e.paint.get("".concat(i,"-use-theme")),h="line-dasharray"===i&&"constant"!==e.layout.get("line-cap").value.kind||d&&"constant"!==d.value.kind;if("constant"!==s.kind||h)if("source"===s.kind||h||u){const t=Gl(i,l,"source");this.binders[i]=u?new Rl(s,a,l,t,e.id):new Dl(s,a,l,t),n.push("/a_".concat(i))}else{const e=Gl(i,l,"composite");this.binders[i]=new Ul(s,a,l,c,t,e),n.push("/z_".concat(i))}else this.binders[i]=u?new Ll(s.value,a):new Ol(s.value,a,l,t),n.push("/u_".concat(i));d&&(this.binders[i].lutExpression=d.value)}this.cacheKey=n.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Dl||t instanceof Ul?t.maxValue:0}populatePaintArrays(e,t,r,n,i,o,a,s){for(const l in this.binders){const c=this.binders[l];c.context=this.context,(c instanceof Dl||c instanceof Ul||c instanceof Rl)&&c.populatePaintArray(e,t,r,n,i,o,a,s)}}setConstantPatternPositions(e,t){for(const r in this.binders){const n=this.binders[r];n instanceof Ll&&n.setConstantPatternPositions(e,t)}}getPatternTransitionVertexBuffer(e){const t=this.binders[e];return t instanceof Rl?t.paintTransitionVertexBuffer:null}updatePaintArrays(e,t,r,n,i,o,a,s,l,c){let u=!1;const d=Object.keys(e),h=0!==d.length&&!s,A=h?d:t.uniqueIds;this.context.lut=i.lut;for(const f in this.binders){const s=this.binders[f];if(s.context=this.context,(s instanceof Dl||s instanceof Ul||s instanceof Rl)&&s.expression&&s.expression.kind&&"constant"!==s.expression.kind&&(!0===s.expression.isStateDependent||!1===s.expression.isLightConstant)){const d=i.paint.get(f);s.expression=d.value;for(const r of A){const i=e[r.toString()];t.eachPosition(r,(e,t,r)=>{const u=n.feature(e);s.updatePaintArray(t,r,u,i,o,a,l,c)})}if(!h)for(const t of r.uniqueIds){const i=e[t.toString()];r.eachPosition(t,(e,t,r)=>{const u=n.feature(e);s.updatePaintArray(t,r,u,i,o,a,l,c)})}u=!0}}return u}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Ol||r instanceof Ll)&&e.push(...r.uniformNames.map(e=>"#define HAS_UNIFORM_".concat(e)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Ol||n instanceof Ll||n instanceof Ul)for(const i of n.uniformNames)t.push({name:i,property:r,binding:n.getBinding(e,i)})}return t}setUniforms(e,t,r,n,i){for(const{name:o,property:a,binding:s}of r)this.binders[a].setUniform(e,s,i,n.get(a),o)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Dl||t instanceof Ul||t instanceof Rl)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer),t instanceof Rl&&t.paintTransitionVertexBuffer&&this._buffers.push(t.paintTransitionVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof Dl||r instanceof Ul||r instanceof Rl)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Dl||t instanceof Ul||t instanceof Rl)&&t.destroy()}}}class Nl{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new zl(n,t,r);this.needsUpload=!1,this._featureMap=new ml,this._featureMapWithoutIds=new ml,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,r,n,i,o,a,s,l){for(const c in this.programConfigurations)this.programConfigurations[c].populatePaintArrays(e,t,n,i,o,a,s,l);void 0!==t.id?this._featureMap.add(t.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,n,i,o,a,s){for(const l of r)this.needsUpload=this.programConfigurations[l.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,l,n,i,o,a||0,s)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const jl={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Ql(e,t){return jl[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}const Vl={"line-pattern":{source:ws,composite:ws},"fill-pattern":{source:ws,composite:ws},"fill-extrusion-pattern":{source:ws,composite:ws},"line-dasharray":{source:bs,composite:bs}},Hl={color:{source:Qs,composite:Ss},number:{source:ms,composite:Qs}};function Gl(e,t,r){const n=Vl[e];return n&&n[r]||Hl[t][r]}ea(Ol,"ConstantBinder"),ea(Ll,"PatternConstantBinder"),ea(Dl,"SourceExpressionBinder"),ea(Rl,"PatternCompositeBinder"),ea(Ul,"CompositeExpressionBinder"),ea(zl,"ProgramConfiguration",{omit:["_buffers"]}),ea(Nl,"ProgramConfigurationSet");const Kl=Nn/Math.PI/2,Wl=5,ql=6,Zl=16383,Xl=64,Yl=[Xl,32,16],Jl=-Kl,$l=Kl;function ec(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Kl;return r=Te(r),[e*Math.sin(r)*n,-t*n,e*Math.cos(r)*n]}function tc(e,t,r){return ec(Math.cos(Te(e)),Math.sin(Te(e)),t,r)}const rc=6371008.8,nc=2*Math.PI*rc;class ic{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(t,")"));if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ic(De(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(e){const t=Math.PI/180,r=this.lat*t,n=e.lat*t,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return rc*Math.acos(Math.min(i,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new oc({lng:this.lng-t,lat:this.lat-e},{lng:this.lng+t,lat:this.lat+e})}toEcef(e){return tc(this.lat,this.lng,Kl+e*Kl/rc)}static convert(e){if(e instanceof ic)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ic(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ic(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class oc{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ic?new ic(e.lng,e.lat):ic.convert(e),this}setSouthWest(e){return this._sw=e instanceof ic?new ic(e.lng,e.lat):ic.convert(e),this}extend(e){const t=this._sw,r=this._ne;let n,i;if(e instanceof ic)n=e,i=e;else{if(!(e instanceof oc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(oc.convert(e)):this.extend(ic.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ic.convert(e)):this;if(n=e._sw,i=e._ne,!n||!i)return this}return t||r?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new ic(n.lng,n.lat),this._ne=new ic(i.lng,i.lat)),this}getCenter(){return new ic((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ic(this.getWest(),this.getNorth())}getSouthEast(){return new ic(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:r}=ic.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(e){if(e)return e instanceof oc?e:new oc(e)}}const ac=0,sc=25.5;function lc(e){return nc*Math.cos(e*Math.PI/180)}function cc(e){return(180+e)/360}function uc(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function dc(e,t){return e/lc(t)}function hc(e){return 360*e-180}function Ac(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function fc(e,t){return e*lc(Ac(t))}const pc=85.051129;function mc(e){return Math.cos(Te(Oe(e,-pc,pc)))}function gc(e,t){const r=Oe(t,ac,sc),n=Math.pow(2,r);return mc(e)*nc/(512*n)}function yc(e){return 1/Math.cos(e*Math.PI/180)}function _c(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=Math.exp(Math.PI*(1-(e.y+t/Nn)/(1<<e.z)*2));return 80150034*r/(r*r+1)/Nn/(1<<e.z)}class vc{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=ic.convert(e);return new vc(cc(r.lng),uc(r.lat),dc(t,r.lat))}toLngLat(){return new ic(hc(this.x),Ac(this.y))}toAltitude(){return fc(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/nc*yc(Ac(this.y))}}function xc(e,t,r,n,i,o,a,s,l){const c=(t+n)/2,u=(r+i)/2,d=new Be(c,u);s(d),function(e,t,r,n,i,o){const a=r-i,s=n-o;return Math.abs((n-t)*a-(r-e)*s)/Math.hypot(a,s)}(d.x,d.y,o.x,o.y,a.x,a.y)>=l?(xc(e,t,r,c,u,o,d,s,l),xc(e,c,u,n,i,d,a,s,l)):e.push(a)}function wc(e,t,r){let n=e[0],i=n.x,o=n.y;t(n);const a=[n];for(let s=1;s<e.length;s++){const l=e[s],{x:c,y:u}=l;t(l),xc(a,i,o,c,u,n,l,t,r),i=c,o=u,n=l}return a}function bc(e,t,r,n){if(n(t,r)){const i=t.add(r)._mult(.5);bc(e,t,i,n),bc(e,i,r,n)}else e.push(r)}function Bc(e,t){let r=e[0];const n=[r];for(let i=1;i<e.length;i++){const o=e[i];bc(n,r,o,t),r=o}return n}const Cc=Math.pow(2,14)-1,Ec=-Cc-1;function Sc(e,t){const r=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=Oe(r,Ec,Cc),e.y=Oe(n,Ec,Cc),(r<e.x||r>e.x+1||n<e.y||n>e.y+1)&&We("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Tc(e,t,r){const n=e.loadGeometry(),i=e.extent,o=Nn/i;if(t&&r&&r.projection.isReprojectedInTileSpace){const o=1<<t.z,{scale:a,x:s,y:l,projection:c}=r,u=e=>{const r=hc((t.x+e.x/i)/o),n=Ac((t.y+e.y/i)/o),u=c.project(r,n);e.x=(u.x*a-s)*i,e.y=(u.y*a-l)*i};for(let t=0;t<n.length;t++)if(1!==e.type)n[t]=wc(n[t],u,1);else{const e=[];for(const r of n[t])r.x<0||r.x>=i||r.y<0||r.y>=i||(u(r),e.push(r));n[t]=e}}for(const a of n)for(const e of a)Sc(e,o);return n}function Ic(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Tc(e):[]}}class Fc{constructor(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(kc,this,t)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos,r=[];let n,i=1,o=0,a=0,s=0;for(;e.pos<t;){if(o<=0){const t=e.readVarint();i=7&t,o=t>>3}if(o--,1===i||2===i)a+=e.readSVarint(),s+=e.readSVarint(),1===i&&(n&&r.push(n),n=[]),n&&n.push(new Be(a,s));else{if(7!==i)throw new Error("unknown command ".concat(i));n&&n.push(n[0].clone())}}return n&&r.push(n),r}bbox(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let r=1,n=0,i=0,o=0,a=1/0,s=-1/0,l=1/0,c=-1/0;for(;e.pos<t;){if(n<=0){const t=e.readVarint();r=7&t,n=t>>3}if(n--,1===r||2===r)i+=e.readSVarint(),o+=e.readSVarint(),i<a&&(a=i),i>s&&(s=i),o<l&&(l=o),o>c&&(c=o);else if(7!==r)throw new Error("unknown command ".concat(r))}return[a,l,s,c]}toGeoJSON(e,t,r){const n=this.extent*Math.pow(2,r),i=this.extent*e,o=this.extent*t,a=this.loadGeometry();function s(e){return[360*(e.x+i)/n-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+o)/n)*Math.PI))-90]}function l(e){return e.map(s)}let c;if(1===this.type){const e=[];for(const r of a)e.push(r[0]);const t=l(e);c=1===e.length?{type:"Point",coordinates:t[0]}:{type:"MultiPoint",coordinates:t}}else if(2===this.type){const e=a.map(l);c=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}}else{if(3!==this.type)throw new Error("unknown feature type");{const e=function(e){const t=e.length;if(t<=1)return[e];const r=[];let n,i;for(let o=0;o<t;o++){const t=Pc(e[o]);0!==t&&(void 0===i&&(i=t<0),i===t<0?(n&&r.push(n),n=[e[o]]):n&&n.push(e[o]))}return n&&r.push(n),r}(a),t=[];for(const r of e)t.push(r.map(l));c=1===t.length?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t}}}const u={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(u.id=this.id),u}}function kc(e,t,r){1===e?t.id=r.readVarint():2===e?function(e,t){const r=e.readVarint()+e.pos;for(;e.pos<r;){const r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(r,t):3===e?t.type=r.readVarint():4===e&&(t._geometry=r.pos)}function Pc(e){let t=0;for(let r,n,i=0,o=e.length,a=o-1;i<o;a=i++)r=e[i],n=e[a],t+=(n.x-r.x)*(r.y+n.y);return t}Fc.types=["Unknown","Point","LineString","Polygon"];class Mc{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Oc,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new Fc(this._pbf,t,this.extent,this._keys,this._values)}}function Oc(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){let t=null;const r=e.readVarint()+e.pos;for(;e.pos<r;){const r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}if(null==t)throw new Error("unknown feature value");return t}(r))}class Lc{constructor(e,t){this.layers=e.readFields(Dc,{},t)}}function Dc(e,t,r){if(3===e){const e=new Mc(r,r.readVarint()+r.pos);e.length&&(t[e.name]=e)}}const Uc="3d_elevation_id",Rc="level";class zc{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(e,t){return this._valid&&e(t(this._geometry)),this}require(e,t,r){return this.get(e,!0,t,r)}optional(e,t,r){return this.get(e,!1,t,r)}success(){return this._valid}get(e,t,r,n){const i=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&void 0!==i&&!Number.isNaN(i)?r(n?n(i):i):t&&(this._valid=!1),this}}class Nc{constructor(e,t){this.featureFunc=e,this.vertexFunc=t}parseFeature(e,t,r){return this.featureFunc(e,t,r)}parseVertex(e,t,r){return this.vertexFunc(e,t,r)}}const jc=new Nc((e,t,r)=>e.reset(t).require(Uc,e=>{r.id=e}).optional("fixed_height_relative",e=>{r.constantHeight=e},Vc.decodeRelativeHeight).geometry(e=>{r.bounds=e},yn).success(),(e,t,r)=>e.reset(t).require(Uc,e=>{r.id=e}).require("elevation_idx",e=>{r.idx=e}).require("extent",e=>{r.extent=e}).require("height_relative",e=>{r.height=e},Vc.decodeRelativeHeight).geometry(e=>{r.position=e},Vc.getPoint).success()),Qc=new Nc((e,t,r)=>e.reset(t).require(Uc,e=>{r.id=e}).optional("fixed_height",e=>{r.constantHeight=e},Vc.decodeMetricHeight).geometry(e=>{r.bounds=e},yn).success(),(e,t,r)=>e.reset(t).require(Uc,e=>{r.id=e}).require("elevation_idx",e=>{r.idx=e}).require("extent",e=>{r.extent=e}).require("height",e=>{r.height=e},Vc.decodeMetricHeight).geometry(e=>{r.position=e},Vc.getPoint).success());class Vc{static getPoint(e){return ue(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?"1.0.1"===e?Qc:void 0:jc}static parse(e){const t=[],r=[],n=e.length,i=new zc;for(let o=0;o<n;o++){const n=e.feature(o),a=n.properties.version,s=Vc.getVersionSchema(a);if(void 0===s){We("Unknown elevation feature version number ".concat(a||"(unknown)"));continue}const l=n.properties.type;if(!l)continue;const c=Fc.types[n.type];if("Point"===c&&"curve_point"===l){const e={};s.parseVertex(i,n,e)&&t.push(e)}else if("Polygon"===c&&"curve_meta"===l){const e={};s.parseFeature(i,n,e)&&r.push(e)}}return{vertices:t,features:r}}}class Hc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,r){const n=ge(t,this.dir);if(Math.abs(n)<1e-6)return!1;const i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,!0}}class Gc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,r){const n=z(t,this.dir);if(Math.abs(n)<1e-6)return!1;const i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,r[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(e,r,n){if(function(e,r){var n=e[0],i=e[1],o=e[2],a=r[0],s=r[1],l=r[2];return Math.abs(n-a)<=t*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(i-s)<=t*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(o-l)<=t*Math.max(1,Math.abs(o),Math.abs(l))}(this.pos,e)||0===r)return n[0]=n[1]=n[2]=0,!1;const[i,o,a]=this.dir,s=this.pos[0]-e[0],l=this.pos[1]-e[1],c=this.pos[2]-e[2],u=i*i+o*o+a*a,d=2*(s*i+l*o+c*a),h=d*d-4*u*(s*s+l*l+c*c-r*r);if(h<0){const e=Math.max(-d/2,0),t=s+i*e,u=l+o*e,h=c+a*e,A=Math.hypot(t,u,h);return n[0]=t*r/A,n[1]=u*r/A,n[2]=h*r/A,!1}{const e=(-d-Math.sqrt(h))/(2*u);if(e<0){const e=Math.hypot(s,l,c);return n[0]=s*r/e,n[1]=l*r/e,n[2]=c*r/e,!1}return n[0]=s+i*e,n[1]=l+o*e,n[2]=c+a*e,!0}}}class Kc{constructor(e,t,r,n,i){this.TL=e,this.TR=t,this.BR=r,this.BL=n,this.horizon=i}static fromInvProjectionMatrix(e,t,r){const n=[-1,1,1],i=[1,1,1],o=[1,-1,1],a=[-1,-1,1],s=Q(n,n,e),l=Q(i,i,e),c=Q(o,o,e),u=Q(a,a,e);return new Kc(s,l,c,u,t/r)}}function Wc(e,t,r){let n=1/0,i=-1/0;const o=[];for(const a of e){W(o,a,t);const e=z(o,r);n=Math.min(n,e),i=Math.max(i,e)}return[n,i]}function qc(e,t){let r=!0;for(let n=0;n<e.planes.length;n++){const i=e.planes[n];let o=0;for(let e=0;e<t.length;e++)o+=+(z(i,t[e])+i[3]>=0);if(0===o)return 0;o!==t.length&&(r=!1)}return r?2:1}function Zc(e,t){for(const r of e.projections){const n=Wc(t,e.points[0],r.axis);if(r.projection[1]<n[0]||r.projection[0]>n[1])return 0}return 1}function Xc(e,t){let r=0;const n=[0,0,0,0];for(let a=0;a<e.length;a++)n[0]=e[a][0],n[1]=e[a][1],n[2]=e[a][2],n[3]=1,(i=n)[0]*(o=t)[0]+i[1]*o[1]+i[2]*o[2]+i[3]*o[3]>=0&&r++;var i,o;return r}class Yc{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=Jc.fromPoints(this.points),this.projections=[],this.frustumEdges=[W([],this.points[2],this.points[3]),W([],this.points[0],this.points[3]),W([],this.points[4],this.points[0]),W([],this.points[5],this.points[1]),W([],this.points[6],this.points[2]),W([],this.points[7],this.points[3])];for(const r of this.frustumEdges){const e=[0,-r[2],r[1]],t=[r[2],0,-r[0]];this.projections.push({axis:e,projection:Wc(this.points,this.points[0],e)}),this.projections.push({axis:t,projection:Wc(this.points,this.points[0],t)})}}static fromInvProjectionMatrix(e,t,r,n){const i=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(r=>{const o=$([],r,e),a=1/o[3]/t*i;return(s=o)[0]=(l=o)[0]*(c=[a,a,n?1/o[3]:a,a])[0],s[1]=l[1]*c[1],s[2]=l[2]*c[2],s[3]=l[3]*c[3],s;var s,l,c}),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{const t=R([],N([],W([],o[e[0]],o[e[1]]),W([],o[e[2]],o[e[1]]))),r=-z(t,o[e[1]]);return t.concat(r)}),s=[];for(let l=0;l<o.length;l++)s.push([o[l][0],o[l][1],o[l][2]]);return new Yc(s,a)}intersectsPrecise(e,t,r){for(let n=0;n<t.length;n++)if(!Xc(e,t[n]))return 0;for(let n=0;n<this.planes.length;n++)if(!Xc(e,this.planes[n]))return 0;for(const n of r)for(const t of this.frustumEdges){const r=N([],n,t),i=B(r);if(0===i)continue;P(r,r,1/i);const o=Wc(this.points,this.points[0],r),a=Wc(e,this.points[0],r);if(o[0]>a[1]||a[0]>o[1])return 0}return 1}containsPoint(e){for(const t of this.planes){const r=t[3];if(z([t[0],t[1],t[2]],e)+r<0)return!1}return!0}}class Jc{static fromPoints(e){const t=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const n of e)F(t,t,n),k(r,r,n);return new Jc(t,r)}static fromTileIdAndHeight(e,t,r){const n=1<<e.canonical.z,i=e.canonical.x,o=e.canonical.y;return new Jc([i/n,o/n,t],[(i+1)/n,(o+1)/n,r])}static applyTransform(e,t){const r=e.getCorners();for(let n=0;n<r.length;++n)Q(r[n],r[n],t);return Jc.fromPoints(r)}static applyTransformFast(e,t){const r=[t[12],t[13],t[14]],n=[...r];for(let i=0;i<3;i++)for(let o=0;o<3;o++){const a=t[4*o+i],s=a*e.min[o],l=a*e.max[o];r[i]+=Math.min(s,l),n[i]+=Math.max(s,l)}return new Jc(r,n)}static projectAabbCorners(e,t){const r=e.getCorners();for(let n=0;n<r.length;++n)Q(r[n],r[n],t);return r}constructor(e,t){this.min=e,this.max=t,this.center=P([],S([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],r=b(this.min),n=b(this.max);for(let i=0;i<t.length;i++)r[i]=t[i]?this.min[i]:this.center[i],n[i]=t[i]?this.center[i]:this.max[i];return n[2]=this.max[2],new Jc(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?qc(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?qc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?Zc(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?Zc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}ea(Jc,"Aabb");class $c{constructor(e,t){this.feature=e,this.metersToTile=t,this.index=0}get(){const e=this.feature.vertices[this.index],t=this.feature.vertexProps[this.index].dir,r=t[1],n=-t[0],i=(e.extent+1)*this.metersToTile;return[new Be(Math.trunc(e.position[0]+r*i),Math.trunc(e.position[1]+n*i)),new Be(Math.trunc(e.position[0]-r*i),Math.trunc(e.position[1]-n*i))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class eu{constructor(e,t,r,n,i,o){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[ce(),ce(),ce(),ce(),ce(),ce(),ce()],this.id=e,this.heightRange={min:r,max:r},this.safeArea=t,this.constantHeight=r,null==this.constantHeight&&(null!=this.constantHeight||0!==n.length)){this.vertices=n,this.edges=i,this.edges=this.edges.filter(e=>{return e.a<this.vertices.length&&e.b<this.vertices.length&&!((t=this.vertices[e.a].position)[0]===(r=this.vertices[e.b].position)[0]&&t[1]===r[1]);var t,r}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const e of this.vertices)this.vertexProps.push({dir:ue(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,e.height),this.heightRange.max=Math.max(this.heightRange.max,e.height);for(const e of this.edges){const t=this.vertices[e.a].position,r=this.vertices[e.b].position,n=Ae(ce(),r,t),i=pe(n),o=fe(ce(),n,1/i);this.edgeProps.push({vec:n,dir:o,len:i});const a=this.vertexProps[e.a].dir,s=this.vertexProps[e.b].dir;he(a,a,o),he(s,s,o)}for(const e of this.vertexProps)0===e.dir[0]&&0===e.dir[1]||me(e.dir,e.dir);this.tessellate(o)}}pointElevation(e){if(null!=this.constantHeight)return this.constantHeight;const t=this.getClosestEdge(e);if(null==t)return 0;const[r,n]=t;return hr(this.vertices[this.edges[r].a].height,this.vertices[this.edges[r].b].height,n)}computeSlopeNormal(e,t){const r=this.getClosestEdge(e);if(!r)return C(0,0,1);const n=r[0],i=this.edges[n],o=this.edgeProps[n].vec,a=C(o[0],o[1],(this.vertices[i.b].height-this.vertices[i.a].height)*t),s=C(a[1],-a[0],0);N(s,s,a);const l=B(s);return l>0?P(s,s,1/l):E(s,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(0===this.edges.length)return;let t=0,r=Number.POSITIVE_INFINITY,n=0;const[i,o,a,s,l,c,u]=this._tmpVec2;de(u,e.x,e.y);const d=new Hc(u,null);for(let h=0;h<this.edges.length;h++){const e=this.edges[h],A=this.edgeProps[h].dir;d.dir=A;const f=this.vertices[e.a].position,p=this.vertices[e.b].position,m=d.intersectsPlane(f,this.vertexProps[e.a].dir,i),g=d.intersectsPlane(p,this.vertexProps[e.b].dir,o);if(!m||!g)continue;Ae(a,o,i),Ae(s,u,i);const y=ge(a,a),_=y>0?ge(s,a)/y:0,v=Oe(_,0,1),x=Math.abs((_-v)*this.edgeProps[h].len);Ae(l,u,f),de(c,A[1],-A[0]);const w=x+Math.abs(ge(l,c));w<r&&(t=h,r=w,n=v)}return[t,n]}tessellate(e){const t=w(),r=w(),n=w(),i=w();for(let o=this.edges.length-1;o>=0;--o){const a=this.edges[o].a,s=this.edges[o].b,{position:l,height:c,extent:u}=this.vertices[a],{position:d,height:h,extent:A}=this.vertices[s],f=this.vertexProps[a].dir,p=this.vertexProps[s].dir;if(E(t,l[0]/e,l[1]/e,c),E(r,d[0]/e,d[1]/e,h),E(n,f[1],-f[0],0),P(n,n,u),E(i,p[1],-p[0],0),P(i,i,A),this.distSqLines(C(t[0]+.5*n[0],t[1]+.5*n[1],t[2]+.5*n[2]),C(r[0]-.5*i[0],r[1]-.5*i[1],r[2]-.5*i[2]),C(t[0]-.5*n[0],t[1]-.5*n[1],t[2]-.5*n[2]),C(r[0]+.5*i[0],r[1]+.5*i[1],r[2]+.5*i[2]))<=.0025000000000000005)continue;const m=this.vertices.length,g=he(ce(),l,d);this.vertices.push({position:fe(g,g,.5),height:.5*(c+h),extent:.5*(u+A)});const y=he(ce(),f,p);this.vertexProps.push({dir:me(y,y)}),this.edges.splice(o,1),this.edgeProps.splice(o,1),this.edges.push({a:a,b:m}),this.edges.push({a:m,b:s});const _=Ae(ce(),this.vertices[m].position,l),v=pe(_),x={vec:_,dir:fe(ce(),_,1/v),len:v};this.edgeProps.push(x),this.edgeProps.push(x)}}distSqLines(e,t,r,n){const i=T(w(),t,e),o=T(w(),n,r),a=T(w(),e,r),s=z(i,i),l=z(i,o),c=z(i,a),u=z(o,o),d=z(o,a),h=s*u-l*l;if(0===h)return L(j(i,r,n,z(a,o)/z(o,o)),e);const A=(s*d-l*c)/h;return L(j(i,e,t,(l*d-c*u)/h),j(o,r,n,A))}}class tu{static parseFrom(e,t){const r=Vc.parse(e);if(!r)return[];let{vertices:n,features:i}=r;const o=1/_c(t);i.sort((e,t)=>e.id-t.id),n.sort((e,t)=>e.id-t.id||e.idx-t.idx),n=n.filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id&&t.idx===e.idx));const a=new Array;let s=0;const l=n.length;for(const c of i){if(c.constantHeight){a.push(new eu(c.id,c.bounds,c.constantHeight));continue}for(;s!==l&&n[s].id<c.id;)s++;if(s===l||n[s].id!==c.id)continue;const e=new Array,t=new Array,r=s;for(;s!==l&&n[s].id===c.id;){const i=n[s];if(e.push({position:i.position,height:i.height,extent:i.extent}),s!==r&&n[s-1].idx===i.idx-1){const e=s-r;t.push({a:e-1,b:e})}s++}a.push(new eu(c.id,c.bounds,void 0,e,t,o))}return a}static getElevationFeature(e,t){if(!t)return;const r=+e.properties[Uc];return Number.isNaN(r)?void 0:t.find(e=>e.id===r)}}class ru{constructor(e,t){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(t)||(this.zScale=Math.pow(2,t.z-e.z),this.xOffset=(e.x*this.zScale-t.x)*Nn,this.yOffset=(e.y*this.zScale-t.y)*Nn)}constantElevation(e,t){if(null!=e.constantHeight)return this.computeBiasedHeight(e.constantHeight,t)}pointElevation(e,t,r){const n=this.constantElevation(t,r);return null!=n?n:(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(t.pointElevation(e),r))}computeBiasedHeight(e,t){return t<=0?e:e+t*Le(0,t,e>=0?e:Math.abs(.5*e))}}ea(eu,"ElevationFeature");class nu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new As,this.indexArray=new Os,this.segments=new dl,this.programConfigurations=new Nl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,"none"!==this.elevationMode&&(this.elevatedLayoutVertexArray=new ms),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,t){}updateAppearances(e,t,r,n){}populate(e,t,r,n){const i=this.layers[0],o=[];let a=null;"circle"===i.type&&(a=i.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:u,sourceLayerIndex:d}of e){const e=this.layers[0]._featureFilter.needGeometry,i=Ic(l,e);if(!this.layers[0]._featureFilter.filter(new Ba(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),i,r))continue;const s=a?a.evaluate(i,{},r):void 0,h={id:c,properties:l.properties,type:l.type,sourceLayerIndex:d,index:u,geometry:e?i.geometry:Tc(l,r,n),patterns:{},sortKey:s};o.push(h)}a&&o.sort((e,t)=>e.sortKey-t.sortKey);let s=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new Bs,s=n.projection);for(const l of o){const{geometry:n,index:i,sourceLayerIndex:o}=l,a=e[i].feature;this.addFeature(l,n,i,t.availableImages,r,s,t.brightness,t.elevationFeatures),t.featureIndex.insert(a,n,i,o,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,t,r,n,i,o,a){this.programConfigurations.updatePaintArrays(e,t,i,r,n,o,a,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ll.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ul.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,cl.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,t,r,n,i,o,a,s){let l;"none"!==this.elevationMode&&(l=tu.getElevationFeature(e,s));for(const c of t)for(const t of c){const r=t.x,n=t.y;if(r<0||r>=Nn||n<0||n>=Nn)continue;if(o){const e=o.projectTilePoint(r,n,i),t=o.upVector(i,r,n);this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t)}const a=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),s=a.vertexLength;if(this.addCircleVertex(r,n,-1,-1),this.addCircleVertex(r,n,1,-1),this.addCircleVertex(r,n,1,1),this.addCircleVertex(r,n,-1,1),"none"!==this.elevationMode){const e=l?l.pointElevation(new Be(r,n)):0;this.hasElevation=this.hasElevation||0!==e;for(let t=0;t<4;t++)this.elevatedLayoutVertexArray.emplaceBack(e)}this.indexArray.emplaceBack(s,s+1,s+2),this.indexArray.emplaceBack(s,s+2,s+3),a.vertexLength+=4,a.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,i,a,void 0,this.worldview)}addCircleVertex(e,t,r,n){this.layoutVertexArray.emplaceBack(2*e+(r+1)/2,2*t+(n+1)/2)}addGlobeExtVertex(e,t){const r=16384;this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,t[0]*r,t[1]*r,t[2]*r)}}function iu(e,t){for(let r=0;r<e.length;r++)if(pu(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(pu(e,t[r]))return!0;return!!lu(e,t)}function ou(e,t,r){return!!pu(e,t)||!!hu(t,e,r)}function au(e,t){if(1===e.length)return fu(t,e[0]);for(let r=0;r<t.length;r++){const n=t[r];for(let t=0;t<n.length;t++)if(pu(e,n[t]))return!0}for(let r=0;r<e.length;r++)if(fu(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(lu(e,t[r]))return!0;return!1}function su(e,t,r){if(e.length>1){if(lu(e,t))return!0;for(let n=0;n<t.length;n++)if(hu(t[n],e,r))return!0}for(let n=0;n<e.length;n++)if(hu(e[n],t,r))return!0;return!1}function lu(e,t){if(0===e.length||0===t.length)return!1;for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++)if(cu(n,i,t[e],t[e+1]))return!0}return!1}function cu(e,t,r,n){return qe(e,r,n)!==qe(t,r,n)&&qe(e,t,r)!==qe(e,t,n)}function uu(e,t,r){return(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x)}function du(e,t,r,n){const i=uu(e,t,n),o=uu(e,t,r);if(Math.sign(i)===Math.sign(o))return;const a=uu(r,n,e),s=a+o-i;return Math.sign(a)!==Math.sign(s)?[a/(a-s),o/(o-i)]:void 0}function hu(e,t,r){const n=r*r;if(1===t.length)return e.distSqr(t[0])<n;for(let i=1;i<t.length;i++)if(Au(e,t[i-1],t[i])<n)return!0;return!1}function Au(e,t,r){const n=t.distSqr(r);if(0===n)return e.distSqr(t);const i=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/n;return e.distSqr(i<0?t:i>1?r:r.sub(t)._mult(i)._add(t))}function fu(e,t){let r,n,i,o=!1;for(let a=0;a<e.length;a++){r=e[a];for(let e=0,a=r.length-1;e<r.length;a=e++)n=r[e],i=r[a],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(o=!o)}return o}function pu(e,t){let r=!1;for(let n=0,i=e.length-1;n<e.length;i=n++){const o=e[n],a=e[i];o.y>t.y!=a.y>t.y&&t.x<(a.x-o.x)*(t.y-o.y)/(a.y-o.y)+o.x&&(r=!r)}return r}function mu(e,t,r,n,i){for(const a of e)if(t<=a.x&&r<=a.y&&n>=a.x&&i>=a.y)return!0;const o=[new Be(t,r),new Be(t,i),new Be(n,i),new Be(n,r)];if(e.length>2)for(const a of o)if(pu(e,a))return!0;for(let a=0;a<e.length-1;a++)if(gu(e[a],e[a+1],o))return!0;return!1}function gu(e,t,r){const n=r[0],i=r[2];if(e.x<n.x&&t.x<n.x||e.x>i.x&&t.x>i.x||e.y<n.y&&t.y<n.y||e.y>i.y&&t.y>i.y)return!1;const o=qe(e,t,r[0]);return o!==qe(e,t,r[1])||o!==qe(e,t,r[2])||o!==qe(e,t,r[3])}function yu(e,t,r,n,i,o){let a=t.y-e.y,s=e.x-t.x;if(o=o||0){const e=a*a+s*s;if(0===e)return!0;const t=Math.sqrt(e);a/=t,s/=t}return!((r.x-e.x)*a+(r.y-e.y)*s-o<0||(n.x-e.x)*a+(n.y-e.y)*s-o<0||(i.x-e.x)*a+(i.y-e.y)*s-o<0)}function _u(e,t,r,n,i,o,a){return!(yu(e,t,n,i,o,a)||yu(t,r,n,i,o,a)||yu(r,e,n,i,o,a)||yu(n,i,e,t,r,a)||yu(i,o,e,t,r,a)||yu(o,n,e,t,r,a))}function vu(e,t,r){const n=t.paint.get(e).value;return"constant"===n.kind?n.value:r.programConfigurations.get(t.id).getMaxValue(e)}function xu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function wu(e,t,r,n,i){if(!t[0]&&!t[1])return e;const o=Be.convert(t)._mult(i);"viewport"===r&&o._rotate(-n);const a=[];for(let s=0;s<e.length;s++)a.push(e[s].sub(o));return a}function bu(e,t,r,n){const i=Be.convert(e)._mult(n);return"viewport"===t&&i._rotate(-r),i}let Bu,Cu;function Eu(e,t,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}ea(nu,"CircleBucket",{omit:["layers"]});class Su{constructor(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Fu(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const t=this.z-e.z;return 0===e.z||e.z<this.z&&e.x===this.x>>t&&e.y===this.y>>t}url(e,t){const r=function(e,t,r){var n=Eu(256*e,256*(t=Math.pow(2,r)-t-1),r),i=Eu(256*(e+1),256*(t+1),r);return n[0]+","+n[1]+","+i[0]+","+i[1]}(this.x,this.y,this.z),n=function(e,t,r){let n,i="";for(let o=e;o>0;o--)n=1<<o-1,i+=(t&n?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class Tu{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Fu(e,t.z,t.z,t.x,t.y)}}class Iu{constructor(e,t,r,n,i){this.overscaledZ=e,this.wrap=t,this.canonical=new Su(r,+n,+i),this.key=0===t&&e===r?this.canonical.key:Fu(t,e,r,n,i)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Iu(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Iu(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Fu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Fu(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Iu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new Iu(t,this.wrap,t,r,n),new Iu(t,this.wrap,t,r+1,n),new Iu(t,this.wrap,t,r,n+1),new Iu(t,this.wrap,t,r+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Iu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Iu(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Tu(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}function Fu(e,t,r,n,i){const o=1<<Math.min(r,22);let a=o*(i%o)+n%o;return e&&r<22&&(a+=o*o*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*a+r)+(t-r)}const ku=[e=>{let t=e.canonical.x-1,r=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,r--),new Iu(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,r=e.wrap;return t===1<<e.canonical.z&&(t=0,r++),new Iu(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>new Iu(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new Iu(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];ea(Su,"CanonicalTileID"),ea(Iu,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Pu=ds([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Mu}=Pu,Ou=ds([{name:"a_pos_3",components:3,type:"Int16"}]);var Lu=ds([{name:"a_pos",type:"Int16",components:2}]);function Du(e){return e*Kl/rc}const Uu=[new Jc([Jl,Jl,Jl],[$l,$l,$l]),new Jc([Jl,Jl,Jl],[0,0,$l]),new Jc([0,Jl,Jl],[$l,0,$l]),new Jc([Jl,0,Jl],[0,$l,$l]),new Jc([0,0,Jl],[$l,$l,$l])];function Ru(e,t,r){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=P([],e._camera.position,e.worldSize),o=[t,r,1,1];$(o,o,e.pixelMatrixInverse),Y(o,o,1/o[3]);const a=R([],W([],o,i)),s=e.globeMatrix,l=[s[12],s[13],s[14]],c=W([],l,i),u=B(c),d=R([],c),h=e.worldSize/(2*Math.PI),A=z(d,a),f=Math.asin(h/u);if(f<Math.acos(A)){if(!n)return null;const e=[],t=[];P(e,a,u/A),R(t,W(t,e,c)),R(a,S(a,c,P(a,t,Math.tan(f)*u)))}const p=[];new Gc(i,a).closestPointOnSphere(l,h,p);const m=R([],et(s,0)),g=R([],et(s,1)),y=R([],et(s,2)),_=z(m,p),v=z(g,p),x=z(y,p),w=Ie(Math.asin(-v/h));let b=Ie(Math.atan2(_,x));b=e.center.lng+function(e,t){const r=(t-e+180)%360-180;return r<-180?r+360:r}(e.center.lng,b);const C=cc(b),E=Oe(uc(w),0,1);return new vc(C,E)}class zu{constructor(e,t,r){this.a=W([],e,r),this.b=W([],t,r),this.center=r;const n=R([],this.a),i=R([],this.b);this.angle=Math.acos(z(n,i))}}function Nu(e,t){if(0===e.angle)return null;let r;return r=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),r<0||r>1?null:function(e,t,r,n){const i=Math.sin(r);return e*(Math.sin((1-n)*r)/i)+t*(Math.sin(n*r)/i)}(e.a[t],e.b[t],e.angle,Oe(r,0,1))+e.center[t]}function ju(e){if(e.z<=1)return Uu[e.z+2*e.y+e.x];const t=Ku(Gu(e));return Jc.fromPoints(t)}function Qu(e,t,r){return P(e,e,1-r),M(e,e,t,r)}function Vu(e,t,r){for(const n of e)Q(n,n,t),P(n,n,r)}function Hu(e,t,r,n){const i=t/e.worldSize,o=e.globeMatrix;if(r.z<=1){const e=ju(r).getCorners();return Vu(e,o,i),Jc.fromPoints(e)}const a=Gu(r,n),s=Ku(a,Kl+Du(e._tileCoverLift));Vu(s,o,i);const l=Number.MAX_VALUE,c=[-l,-l,-l],u=[l,l,l];if(a.contains(e.center)){for(const e of s)F(u,u,e),k(c,c,e);c[2]=0;const t=e.point,r=[t.x*i,t.y*i,0];return F(u,u,r),k(c,c,r),new Jc(u,c)}if(e._tileCoverLift>0){for(const e of s)F(u,u,e),k(c,c,e);return new Jc(u,c)}const d=[o[12]*i,o[13]*i,o[14]*i],h=a.getCenter(),A=Oe(e.center.lat,-pc,pc),f=Oe(h.lat,-pc,pc),p=cc(e.center.lng),m=uc(A);let g=p-cc(h.lng);const y=m-uc(f);g>.5?g-=1:g<-.5&&(g+=1);let _=0;Math.abs(g)>Math.abs(y)?_=g>=0?1:3:(_=y>=0?0:2,M(d,d,[o[4]*i,o[5]*i,o[6]*i],-Math.sin(Te(y>=0?a.getSouth():a.getNorth()))*Kl));const v=s[_],x=s[(_+1)%4],w=new zu(v,x,d),b=[Nu(w,0)||v[0],Nu(w,1)||v[1],Nu(w,2)||v[2]],B=td(e.zoom);if(B>0){const n=function(e,t,r,n,i){let{x:o,y:a,z:s}=e;const l=1/(1<<s);let c=o*l,u=c+l,d=a*l,h=d+l,A=0;const f=(c+u)/2-n;return f>.5?A=-1:f<-.5&&(A=1),c=((c+A)*t-(n*=t))*r+n,u=((u+A)*t-n)*r+n,d=(d*t-(i*=t))*r+i,h=(h*t-i)*r+i,[[c,h,0],[u,h,0],[u,d,0],[c,d,0]]}(r,t,e._pixelsPerMercatorPixel,p,m);for(let e=0;e<s.length;e++)Qu(s[e],n[e],B);const i=S([],n[_],n[(_+1)%4]);P(i,i,.5),Qu(b,i,B)}for(const C of s)F(u,u,C),k(c,c,C);return u[2]=Math.min(v[2],x[2]),F(u,u,b),k(c,c,b),new Jc(u,c)}function Gu(e){let{x:t,y:r,z:n}=e,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const o=1/(1<<n),a=new ic(hc(t*o),r===(1<<n)-1&&i?-90:Ac((r+1)*o)),s=new ic(hc((t+1)*o),0===r&&i?90:Ac(r*o));return new oc(a,s)}function Ku(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Kl;const r=Te(e.getNorth()),n=Te(e.getSouth()),i=Math.cos(r),o=Math.cos(n),a=Math.sin(r),s=Math.sin(n),l=e.getWest(),c=e.getEast();return[ec(o,s,l,t),ec(o,s,c,t),ec(i,a,c,t),ec(i,a,l,t)]}function Wu(e,t,r,n){const i=1<<r.z,o=(e/Nn+r.x)/i;return tc(Ac((t/Nn+r.y)/i),hc(o),n)}function qu(e){let{min:t,max:r}=e;return Zl/Math.max(r[0]-t[0],r[1]-t[1],r[2]-t[2])}const Zu=new Float64Array(16);function Xu(e){const t=qu(e),r=g(Zu,[t,t,t]);return h(r,r,U([],e.min))}function Yu(e){const t=(n=e.min,(r=Zu)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r);var r,n;const i=1/qu(e);return A(t,t,[i,i,i])}function Ju(e){const t=Nn/(2*Math.PI);return e/(2*Math.PI)/t}function $u(e,t){return Nn/(512*Math.pow(2,e))*qu(ju(t))}function ed(e,t,r,n,i){const o=Ju(r),a=[e,t,-r/(2*Math.PI)],s=c(new Float64Array(16));return h(s,s,a),A(s,s,[o,o,o]),f(s,s,Te(-i)),p(s,s,Te(-n)),s}function td(e){return Le(Wl,ql,e)}function rd(e,t){const r=tc(t.lat,t.lng),n=function(e){const t=tc(e._center.lat,e._center.lng);let r=N([],C(0,1,0),t);const n=y([],-e.angle,t);r=Q(r,r,n),y(n,-e._pitch,r);const i=R([],t);return P(i,i,Du(e.cameraToCenterDistance/e.pixelsPerMeter)),Q(i,i,n),S([],t,i)}(e);return a=(i=T([],n,r))[0],s=i[1],l=i[2],c=(o=r)[0],u=o[1],d=o[2],A=(h=Math.sqrt((a*a+s*s+l*l)*(c*c+u*u+d*d)))&&z(i,o)/h,Math.acos(Math.min(Math.max(A,-1),1));var i,o,a,s,l,c,u,d,h,A}function nd(e,t){return rd(e,t)>Math.PI/2*1.01}const id=Te(85),od=Math.cos(id),ad=Math.sin(id),sd=s(),ld=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function cd(e,t,r,n,i,o,a,s,l){if(o&&e.queryGeometry.isAboveHorizon)return!1;o&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=r.projection.upVectorScale(c,r.center.lat,r.worldSize).metersToTile;for(const d of t)for(const t of d){const d=t.add(s),h=i&&r.elevation?r.elevation.exaggeration()*i.getElevationAt(d.x,d.y,!0):0,A=r.projection.projectTilePoint(d.x,d.y,c);if(h>0){const e=r.projection.upVector(c,d.x,d.y);A.x+=e[0]*u*h,A.y+=e[1]*u*h,A.z+=e[2]*u*h}const f=o?d:ud(A.x,A.y,A.z,n),p=o?e.tilespaceRays.map(e=>Ad(e,h)):e.queryGeometry.screenGeometry,m=$([],[A.x,A.y,A.z,1],n);if(!a&&o?l*=m[3]/r.cameraToCenterDistance:a&&!o&&(l*=r.cameraToCenterDistance/m[3]),o){const e=Ac((t.y/Nn+c.y)/(1<<c.z));l/=r.projection.pixelsPerMeter(e,1)/dc(1,e)}if(ou(p,f,l))return!0}return!1}function ud(e,t,r,n){const i=$([],[e,t,r,1],n);return new Be(i[0]/i[3],i[1]/i[3])}const dd=C(0,0,0),hd=C(0,0,1);function Ad(e,t){const r=w();return dd[2]=t,e.intersectsPlane(dd,hd,r),new Be(r[0],r[1])}class fd extends nu{}let pd,md,gd,yd;function _d(e,t,r,n){let{width:i,height:o}=t;if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==i*o*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*o*r);return e.width=i,e.height=o,e.data=n,e}function vd(e,t,r){const{width:n,height:i}=t;n===e.width&&i===e.height||(xd(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},r,null),e.width=n,e.height=i,e.data=t.data)}function xd(e,t,r,n,i,o,a,s){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const l=e.data,c=t.data,u=4===o&&s;for(let d=0;d<i.height;d++){const s=((r.y+d)*e.width+r.x)*o,h=((n.y+d)*t.width+n.x)*o;if(u)for(let e=0;e<i.width;e++){const t=s+e*o+3,r=h+e*o;c[r+0]=255,c[r+1]=255,c[r+2]=255,c[r+3]=l[t]}else if(a)for(let e=0;e<i.width;e++){const t=s+e*o,r=h+e*o,n=new lr(l[t+0]/255,l[t+1]/255,l[t+2]/255,l[t+3]).toNonPremultipliedRenderColor(a).toArray();c[r+0]=n[0],c[r+1]=n[1],c[r+2]=n[2],c[r+3]=n[3]}else for(let e=0;e<i.width*o;e++)c[h+e]=l[s+e]}return t}ea(fd,"HeatmapBucket",{omit:["layers"]});class wd{constructor(e,t){_d(this,e,1,t)}resize(e){vd(this,new wd(e),1)}clone(){return new wd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){xd(e,t,r,n,i,1,null)}}class bd{constructor(e,t){_d(this,e,4,t)}resize(e){vd(this,new bd(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new bd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i,o,a){xd(e,t,r,n,i,4,o,a)}}class Bd{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}function Cd(e){const t={},r=e.resolution||256,n=e.clips?e.clips.length:1,i=e.image||new bd({width:r,height:n}),o=(r,n,o)=>{t[e.evaluationKey]=o;const a=e.expression.evaluate(t),s=a?a.toNonPremultipliedRenderColor(null):null;s&&(i.data[r+n+0]=Math.floor(255*s.r),i.data[r+n+1]=Math.floor(255*s.g),i.data[r+n+2]=Math.floor(255*s.b),i.data[r+n+3]=Math.floor(255*s.a))};if(e.clips)for(let a=0,s=0;a<n;++a,s+=4*r)for(let t=0,n=0;t<r;t++,n+=4){const i=t/(r-1),{start:l,end:c}=e.clips[a];o(s,n,l*(1-i)+c*i)}else for(let a=0,s=0;a<r;a++,s+=4)o(0,s,a/(r-1));return i}ea(wd,"AlphaImage"),ea(bd,"RGBAImage");const Ed=ds([{name:"a_pos",components:2,type:"Int16"}],4),Sd=ds([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Td=ds([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Id=ds([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Fd(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const n=t&&t.length,i=n?t[0]*r:e.length;let o=kd(e,0,i,r,!0);const a=[];if(!o||o.next===o.prev)return a;let s,l,c;if(n&&(o=function(e,t,r,n){const i=[];for(let o=0,a=t.length;o<a;o++){const r=kd(e,t[o]*n,o<a-1?t[o+1]*n:e.length,n,!1);r===r.next&&(r.steiner=!0),i.push(Qd(r))}i.sort(Rd);for(let o=0;o<i.length;o++)r=zd(i[o],r);return r}(e,t,o,r)),e.length>80*r){s=e[0],l=e[1];let t=s,n=l;for(let o=r;o<i;o+=r){const r=e[o],i=e[o+1];r<s&&(s=r),i<l&&(l=i),r>t&&(t=r),i>n&&(n=i)}c=Math.max(t-s,n-l),c=0!==c?32767/c:0}return Md(o,a,r,s,l,c,0),a}function kd(e,t,r,n,i){let o;if(i===function(e,t,r,n){let i=0;for(let o=t,a=r-n;o<r;o+=n)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}(e,t,r,n)>0)for(let a=t;a<r;a+=n)o=$d(a/n|0,e[a],e[a+1],o);else for(let a=r-n;a>=t;a-=n)o=$d(a/n|0,e[a],e[a+1],o);return o&&Wd(o,o.next)&&(eh(o),o=o.next),o}function Pd(e,t){if(!e)return e;t||(t=e);let r,n=e;do{if(r=!1,n.steiner||!Wd(n,n.next)&&0!==Kd(n.prev,n,n.next))n=n.next;else{if(eh(n),n=t=n.prev,n===n.next)break;r=!0}}while(r||n!==t);return t}function Md(e,t,r,n,i,o,a){if(!e)return;!a&&o&&function(e,t,r,n){let i=e;do{0===i.z&&(i.z=jd(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,r=1;do{let n,i=e;e=null;let o=null;for(t=0;i;){t++;let a=i,s=0;for(let e=0;e<r&&(s++,a=a.nextZ,a);e++);let l=r;for(;s>0||l>0&&a;)0!==s&&(0===l||!a||i.z<=a.z)?(n=i,i=i.nextZ,s--):(n=a,a=a.nextZ,l--),o?o.nextZ=n:e=n,n.prevZ=o,o=n;i=a}o.nextZ=null,r*=2}while(t>1)}(i)}(e,n,i,o);let s=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(o?Ld(e,n,i,o):Od(e))t.push(l.i,e.i,c.i),eh(e),e=c.next,s=c.next;else if((e=c)===s){a?1===a?Md(e=Dd(Pd(e),t),t,r,n,i,o,2):2===a&&Ud(e,t,r,n,i,o):Md(Pd(e),t,r,n,i,o,1);break}}}function Od(e){const t=e.prev,r=e,n=e.next;if(Kd(t,r,n)>=0)return!1;const i=t.x,o=r.x,a=n.x,s=t.y,l=r.y,c=n.y,u=Math.min(i,o,a),d=Math.min(s,l,c),h=Math.max(i,o,a),A=Math.max(s,l,c);let f=n.next;for(;f!==t;){if(f.x>=u&&f.x<=h&&f.y>=d&&f.y<=A&&Hd(i,s,o,l,a,c,f.x,f.y)&&Kd(f.prev,f,f.next)>=0)return!1;f=f.next}return!0}function Ld(e,t,r,n){const i=e.prev,o=e,a=e.next;if(Kd(i,o,a)>=0)return!1;const s=i.x,l=o.x,c=a.x,u=i.y,d=o.y,h=a.y,A=Math.min(s,l,c),f=Math.min(u,d,h),p=Math.max(s,l,c),m=Math.max(u,d,h),g=jd(A,f,t,r,n),y=jd(p,m,t,r,n);let _=e.prevZ,v=e.nextZ;for(;_&&_.z>=g&&v&&v.z<=y;){if(_.x>=A&&_.x<=p&&_.y>=f&&_.y<=m&&_!==i&&_!==a&&Hd(s,u,l,d,c,h,_.x,_.y)&&Kd(_.prev,_,_.next)>=0)return!1;if(_=_.prevZ,v.x>=A&&v.x<=p&&v.y>=f&&v.y<=m&&v!==i&&v!==a&&Hd(s,u,l,d,c,h,v.x,v.y)&&Kd(v.prev,v,v.next)>=0)return!1;v=v.nextZ}for(;_&&_.z>=g;){if(_.x>=A&&_.x<=p&&_.y>=f&&_.y<=m&&_!==i&&_!==a&&Hd(s,u,l,d,c,h,_.x,_.y)&&Kd(_.prev,_,_.next)>=0)return!1;_=_.prevZ}for(;v&&v.z<=y;){if(v.x>=A&&v.x<=p&&v.y>=f&&v.y<=m&&v!==i&&v!==a&&Hd(s,u,l,d,c,h,v.x,v.y)&&Kd(v.prev,v,v.next)>=0)return!1;v=v.nextZ}return!0}function Dd(e,t){let r=e;do{const n=r.prev,i=r.next.next;!Wd(n,i)&&qd(n,r,r.next,i)&&Yd(n,i)&&Yd(i,n)&&(t.push(n.i,r.i,i.i),eh(r),eh(r.next),r=e=i),r=r.next}while(r!==e);return Pd(r)}function Ud(e,t,r,n,i,o){let a=e;do{let e=a.next.next;for(;e!==a.prev;){if(a.i!==e.i&&Gd(a,e)){let s=Jd(a,e);return a=Pd(a,a.next),s=Pd(s,s.next),Md(a,t,r,n,i,o,0),void Md(s,t,r,n,i,o,0)}e=e.next}a=a.next}while(a!==e)}function Rd(e,t){let r=e.x-t.x;return 0===r&&(r=e.y-t.y,0===r)&&(r=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function zd(e,t){const r=function(e,t){let r=t;const n=e.x,i=e.y;let o,a=-1/0;if(Wd(e,r))return r;do{if(Wd(e,r.next))return r.next;if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const e=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=n&&e>a&&(a=e,o=r.x<r.next.x?r:r.next,e===n))return o}r=r.next}while(r!==t);if(!o)return null;const s=o,l=o.x,c=o.y;let u=1/0;r=o;do{if(n>=r.x&&r.x>=l&&n!==r.x&&Vd(i<c?n:a,i,l,c,i<c?a:n,i,r.x,r.y)){const t=Math.abs(i-r.y)/(n-r.x);Yd(r,e)&&(t<u||t===u&&(r.x>o.x||r.x===o.x&&Nd(o,r)))&&(o=r,u=t)}r=r.next}while(r!==s);return o}(e,t);if(!r)return t;const n=Jd(r,e);return Pd(n,n.next),Pd(r,r.next)}function Nd(e,t){return Kd(e.prev,e,t.prev)<0&&Kd(t.next,e,e.next)<0}function jd(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Qd(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function Vd(e,t,r,n,i,o,a,s){return(i-a)*(t-s)>=(e-a)*(o-s)&&(e-a)*(n-s)>=(r-a)*(t-s)&&(r-a)*(o-s)>=(i-a)*(n-s)}function Hd(e,t,r,n,i,o,a,s){return!(e===a&&t===s)&&Vd(e,t,r,n,i,o,a,s)}function Gd(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&qd(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(Yd(e,t)&&Yd(t,e)&&function(e,t){let r=e,n=!1;const i=(e.x+t.x)/2,o=(e.y+t.y)/2;do{r.y>o!=r.next.y>o&&r.next.y!==r.y&&i<(r.next.x-r.x)*(o-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(Kd(e.prev,e,t.prev)||Kd(e,t.prev,t))||Wd(e,t)&&Kd(e.prev,e,e.next)>0&&Kd(t.prev,t,t.next)>0)}function Kd(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Wd(e,t){return e.x===t.x&&e.y===t.y}function qd(e,t,r,n){const i=Xd(Kd(e,t,r)),o=Xd(Kd(e,t,n)),a=Xd(Kd(r,n,e)),s=Xd(Kd(r,n,t));return i!==o&&a!==s||!(0!==i||!Zd(e,r,t))||!(0!==o||!Zd(e,n,t))||!(0!==a||!Zd(r,e,n))||!(0!==s||!Zd(r,t,n))}function Zd(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Xd(e){return e>0?1:e<0?-1:0}function Yd(e,t){return Kd(e.prev,e,e.next)<0?Kd(e,t,e.next)>=0&&Kd(e,e.prev,t)>=0:Kd(e,t,e.prev)<0||Kd(e,e.next,t)<0}function Jd(e,t){const r=th(e.i,e.x,e.y),n=th(t.i,t.x,t.y),i=e.next,o=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,o.next=n,n.prev=o,n}function $d(e,t,r,n){const i=th(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function eh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function th(e,t,r){return{i:e,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function rh(e,t){const r=e.length;if(r<=1)return[e];const n=[];let i,o;for(let a=0;a<r;a++){const t=Ze(e[a]);0!==t&&(e[a].area=Math.abs(t),void 0===o&&(o=t<0),o===t<0?(i&&n.push(i),i=[e[a]]):i.push(e[a]))}if(i&&n.push(i),t>1)for(let a=0;a<n.length;a++)n[a].length<=t||(ln(n[a],t,1,n[a].length-1,nh),n[a]=n[a].slice(0,t));return n}function nh(e,t){return t.area-e.area}function ih(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!e)return null;const n="string"==typeof e?Rr.from(e).getPrimary():e.getPrimary(),i="string"==typeof e?null:e.getSecondary();for(const o of[n,i]){if(!o)continue;const e=o.id.toString();t.has(e)||t.set(e,[]),o.scaleSelf(r),t.get(e).push(o)}return{primary:n.toString(),secondary:i?i.toString():null}}function oh(e,t,r,n){const i=n.patternDependencies;let o=!1;for(const a of t){const t=a.paint.get("".concat(e,"-pattern"));t.isConstant()||(o=!0),ih(t.constantOr(null),i,r)&&(o=!0)}return o}function ah(e,t,r,n,i,o){const a=o.patternDependencies;for(const s of t){const t=s.paint.get("".concat(e,"-pattern")).value;if("constant"!==t.kind){let e=t.evaluate({zoom:n},r,{},o.availableImages);e=e&&e.name?e.name:e;const l=ih(e,a,i);if(!l)continue;const{primary:c,secondary:u}=l;c&&(r.patterns[s.id]=[c,u].filter(Boolean))}}return r}class sh{constructor(){this.polygons=new Map}add(e){const t=this.polygons.get(e);for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];t?t.push(...n):this.polygons.set(e,n)}merge(e){for(const[t,r]of e.polygons)this.add(t,...r)}}class lh{constructor(){this.portals=[]}static isOnBorder(e,t){return e<=0&&t<=0||e>=Nn&&t>=Nn}static evaluate(e){if(0===e.length)return new lh;let t=[];for(const s of e)t.push(...s.portals);if(0===t.length)return new lh;for(const s of t){const e=s.va,t=s.vb;(lh.isOnBorder(e.x,t.x)||lh.isOnBorder(e.y,t.y))&&(s.type="border")}const r=t.filter(e=>"unevaluated"!==e.type),n=t.filter(e=>"unevaluated"===e.type);if(0===n.length)return new lh;n.sort((e,t)=>e.hash===t.hash?e.isTunnel===t.isTunnel?0:e.isTunnel?-1:1:e.hash<t.hash?1:-1),t=r.concat(n);let i=r.length,o=i,a=i;do{if(o++,o===t.length||t[i].hash!==t[o].hash){if(o-i==2){a<i&&(t[a]=t[i],t[i]=null);const e=t[a],r=t[o-1];e.type=e.isTunnel!==r.isTunnel?"tunnel":"polygon",e.connection={a:e.connection.a,b:r.connection.a},a++}i=o}}while(i!==t.length);return t.splice(a),t.sort((e,t)=>e.hash<t.hash?1:-1),{portals:t}}}ea(lh,"ElevationPortalGraph"),ea(sh,"ElevationPolygons");class ch{constructor(e,t,r){this.outPositions=e,this.outNormals=t,this.outIndices=r,this.vertexLookup=new Map}addVertex(e,t,r){let n=e[2];null!=r&&(n*=r);const i="".concat(e[0],",").concat(e[1],",").concat(e[2],",").concat(t[0],",").concat(t[1],",").concat(t[2]),o=this.vertexLookup.get(i);if(null!=o)return o;const a=this.outPositions.length;this.vertexLookup.set(i,a);const s=Math.trunc(16384*t[0]),l=Math.trunc(16384*t[1]),c=Math.trunc(16384*t[2]);return this.outPositions.emplaceBack(e[0],e[1],n),this.outNormals.emplaceBack(s,l,c),a}addTriangle(e,t,r){this.outIndices.emplaceBack(e,t,r)}addTriangles(e,t,r){if(0===e.length)return;const n=1===r.length,i=w(),o=w();for(let a=0;a<e.length;a+=3){const s=t[e[a+0]],l=t[e[a+1]],c=t[e[a+2]],u=n?r[0]:r[e[a+1]],d=n?r[0]:r[e[a+2]];E(i,s.x,s.y,n?r[0]:r[e[a+0]]);const h=this.addVertex(i,o);E(i,l.x,l.y,u);const A=this.addVertex(i,o);E(i,c.x,c.y,d);const f=this.addVertex(i,o);this.outIndices.emplaceBack(h,A,f)}}addQuad(e,t,r,n,i,o){const a=this.addVertex(e,i,o),s=this.addVertex(t,i,o),l=this.addVertex(r,i,o),c=this.addVertex(n,i,o);this.addTriangle(a,s,l),this.addTriangle(l,c,a)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class uh{constructor(e,t,r,n){this.unevaluatedPortals=new lh,this.portalPolygons=new sh,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new gs,this.vertexNormals=new ys,this.indexArray=new Os,this.tileToMeters=_c(e),this.bridgeProgramConfigurations=new Nl(t,{zoom:r,lut:n},e=>"fill-tunnel-structure-color"!==e),this.tunnelProgramConfigurations=new Nl(t,{zoom:r,lut:n},e=>"fill-bridge-guard-rail-color"!==e)}addVertices(e,t){const r=this.unevalVertices.length;for(let n=0;n<e.length;n++)this.unevalVertices.push(e[n]),this.unevalHeights.push(t[n]);return r}addTriangles(e,t,r){const n=r?this.unevalTunnelTriangles:this.unevalTriangles;for(const i of e)n.push(i+t)}addRenderableRing(e,t,r,n,i,o){const a=[new Be(i.min.x,i.min.y),new Be(i.max.x,i.min.y),new Be(i.max.x,i.max.y),new Be(i.min.x,i.max.y)];for(let s=0;s<r-1;s++){const r=t+s,l=r+1,c=this.unevalVertices[r],u=this.unevalVertices[l];if(!(c.x>=i.min.x&&c.x<=i.max.x&&c.y>=i.min.y&&c.y<=i.max.y||u.x>=i.min.x&&u.x<=i.max.x&&u.y>=i.min.y&&u.y<=i.max.y||gu(c,u,a)))continue;if(this.isOnBorder(c.x,u.x)||this.isOnBorder(c.y,u.y))continue;const d=uh.computeEdgeHash(this.unevalVertices[r],this.unevalVertices[l]);let h,A=this.vertexHashLookup.get(uh.computePosHash(c));null!=A?h=A.next:(A=this.vertexHashLookup.get(uh.computePosHash(u)),h=null!=A?A.prev:d),this.unevalEdges.push({polygonIdx:e,a:r,b:l,hash:d,portalHash:h,isTunnel:n,type:"unevaluated",featureInfo:o})}}addPortalCandidates(e,t,r,n,i){if(0===t.length)return;this.portalPolygons.add(e,{geometry:t,zLevel:i});const o=t[0];this.vertexHashLookup.clear();let a=uh.computeEdgeHash(o[o.length-2],o[o.length-1]);for(let s=0;s<o.length-1;s++){const t=o[s+0],i=o[s+1],l=ue(i.x-t.x,i.y-t.y),c=pe(l);if(0===c)continue;let u="unevaluated";const d=n.pointElevation(t),h=n.pointElevation(i);Math.abs(d)<.01&&Math.abs(h)<.01?u="entrance":(this.isOnBorder(t.x,i.x)||this.isOnBorder(t.y,i.y))&&(u="border");const A=uh.computeEdgeHash(t,i);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:t,vb:i,vab:l,length:c,hash:A,isTunnel:r,type:u});const f=uh.computePosHash(t);this.vertexHashLookup.set(f,{prev:a,next:A}),a=A}}construct(e){if(0===this.unevalVertices.length)return;const t=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),r=e=>{e.primitiveLength=this.indexArray.length-e.primitiveOffset},n=new ch(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const i=t(),o=t(),a=t(),s=(e,t)=>{e.sort((e,r)=>e.type===t&&r.type!==t?-1:e.type!==t&&r.type===t?1:0);const r=e.findIndex(e=>e.type!==t);return r>=0?r:e.length};let l=0;this.unevalEdges.length>0&&(l=s(this.unevalEdges,"none"),this.constructBridgeStructures(n,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},this.tileToMeters)),r(a);const c=t(),u=t();if(this.unevalEdges.length>0){const e=this.unevalEdges.splice(l),t=s(e,"tunnel")+l;this.unevalEdges.push(...e),this.constructTunnelStructures(n,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},{min:l,max:t})}r(c),n.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),r(u),n.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),r(o),n.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),r(i),this.maskSegments=dl.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength),this.depthSegments=dl.simpleSegment(0,o.primitiveOffset,0,o.primitiveLength),this.renderableBridgeSegments=dl.simpleSegment(0,a.primitiveOffset,0,a.primitiveLength),this.renderableTunnelSegments=dl.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength),this.shadowCasterSegments=dl.simpleSegment(0,i.primitiveOffset,0,i.primitiveLength)}update(e,t,r,n,i,o,a,s){this.bridgeProgramConfigurations.updatePaintArrays(e,t,i,r,n,o,a,s),this.tunnelProgramConfigurations.updatePaintArrays(e,t,i,r,n,o,a,s)}upload(e){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Td.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Id.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,t,r,n,i){const o=(o,a)=>{for(let s=0;s<a.length-1;s++){const l=a[s].featureIndex,c=a[s+1].vertexStart,u=e.feature(l);o.populatePaintArrays(c,u,l,{},r,t,n,void 0,i)}};o(this.bridgeProgramConfigurations,this.bridgeFeatureSections),o(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,t,r,n,i){const o=new Map;for(let a=n;a<i;a++){const n=r[a],i=n.a,s=n.b,l=uh.computePosHash(e[i]),c=uh.computePosHash(e[s]);let u=o.get(l);u||(u={},o.set(l,u));let d=o.get(c);d||(d={},o.set(c,d)),t[i]<=0&&t[s]<=0||(u.to=s,d.from=i)}return o}isTerminalVertex(e,t){const r=uh.computePosHash(this.unevalVertices[e]),n=t.get(r);return!n||!n.from||!n.to}constructBridgeStructures(e,t,r,n,i,o){e.clearVertexLookup();const a=this.computeVertexConnections(t,r,n,i.min,i.max),s=1/o,l=.5*s,c=(e,n)=>E(e,t[n].x,t[n].y,r[n]*s),u=w(),d=w(),h=w(),A=w(),f=w(),p=(e,r)=>{const n=a.get(uh.computePosHash(t[r])),i=n.from,o=n.to;if(!i||!o)return;c(u,i),c(d,r),c(h,o),G(A),K(u,d)||(W(f,d,u),R(A,f)),K(h,d)||(W(f,h,d),S(A,A,R(f,f)));const s=Z(A);return s>0?P(e,A,1/s):void 0};let m=Number.POSITIVE_INFINITY;this.sortSubarray(n,i.min,i.max,(e,t)=>e.featureInfo.featureIndex-t.featureInfo.featureIndex);const g=w(),y=w(),_=w(),v=w(),x=w(),b=w(),B=w(),C=w(),T=w(),I=[w(),w(),w(),w()],F=[w(),w(),w(),w()],k=[{coord:new Be(0,0),height:0},{coord:new Be(0,0),height:0}],M=(e,t)=>e>t;for(let w=i.min;w<i.max;w++){const i=n[w];if(!i.featureInfo.guardRailEnabled)continue;if(!this.prepareEdgePoints(k,t,r,i,M))continue;const[c,u]=k;if(E(g,c.coord.x,c.coord.y,s*c.height),E(y,u.coord.x,u.coord.y,s*u.height),K(g,y))continue;W(_,y,g),R(_,_);const d=p(C,i.a)||_,h=p(T,i.b)||_;E(v,d[1],-d[0],0),R(v,v),E(x,h[1],-h[0],0),R(x,x),N(C,v,d),R(b,C),N(C,x,h),R(B,C),S(I[0],g,P(C,W(C,v,b),l)),S(I[1],g,P(C,S(C,v,b),l)),S(I[2],g,P(C,b,l)),I[3]=g,S(F[0],y,P(C,W(C,x,B),l)),S(F[1],y,P(C,S(C,x,B),l)),S(F[2],y,P(C,B,l)),F[3]=y,m=this.addFeatureSection(i.featureInfo.featureIndex,m,this.bridgeFeatureSections,e);const A=e.addVertex(I[0],v,o),f=e.addVertex(I[1],v,o),O=e.addVertex(F[0],x,o),L=e.addVertex(F[1],x,o);e.addTriangle(A,f,O),e.addTriangle(f,L,O);const D=e.addVertex(I[1],b,o),z=e.addVertex(I[2],b,o),j=e.addVertex(F[1],B,o),Q=e.addVertex(F[2],B,o);e.addTriangle(D,z,j),e.addTriangle(z,Q,j),U(v,v),U(x,x);const V=e.addVertex(I[2],v,o),H=e.addVertex(I[3],v,o),G=e.addVertex(F[2],x,o),q=e.addVertex(F[3],x,o);e.addTriangle(V,H,G),e.addTriangle(H,q,G);const Z=this.isTerminalVertex(i.a,a),X=this.isTerminalVertex(i.b,a);c.height<.01&&Z&&e.addQuad(I[3],I[2],I[1],I[0],U(d,d),o),u.height<.01&&X&&e.addQuad(F[0],F[1],F[2],F[3],h,o)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,t,r,n,i,o){e.clearVertexLookup();let a=Number.POSITIVE_INFINITY;const s=(e,t)=>e.featureInfo.featureIndex-t.featureInfo.featureIndex;this.sortSubarray(n,i.min,i.max,s),this.sortSubarray(n,o.min,o.max,s);const l=e=>R(e,e),c=[{coord:new Be(0,0),height:0},{coord:new Be(0,0),height:0}],u=(e,t)=>e<t,d=w(),h=w(),A=w(),f=w(),p=w();for(let m=i.min;m<i.max;m++){if(!this.prepareEdgePoints(c,t,r,n[m],u))continue;const[i,o]=c,s=l(E(p,-(o.coord.y-i.coord.y),o.coord.x-i.coord.x,0));a=this.addFeatureSection(n[m].featureInfo.featureIndex,a,this.tunnelFeatureSections,e),e.addQuad(E(d,i.coord.x,i.coord.y,i.height),E(h,o.coord.x,o.coord.y,o.height),E(A,o.coord.x,o.coord.y,n[m].isTunnel?-.1:0),E(f,i.coord.x,i.coord.y,n[m].isTunnel?-.1:0),s)}for(let m=o.min;m<o.max;m++){const i=n[m];i.isTunnel&&([i.a,i.b]=[i.b,i.a]);const o=t[i.a],s=t[i.b],c=l(E(p,-(s.y-o.y),s.x-o.x,0));a=this.addFeatureSection(i.featureInfo.featureIndex,a,this.tunnelFeatureSections,e),e.addQuad(E(d,s.x,s.y,0),E(h,o.x,o.y,0),E(A,o.x,o.y,r[i.a]+4),E(f,s.x,s.y,r[i.b]+4),c),e.addQuad(E(d,o.x,o.y,0),E(h,s.x,s.y,0),E(A,s.x,s.y,r[i.b]+4),E(f,o.x,o.y,r[i.a]+4),c)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,t,r,n){e.coord.x=t,e.coord.y=r,e.height=n}prepareEdgePoints(e,t,r,n,i){let o=t[n.a].x,a=t[n.a].y,s=t[n.b].x,l=t[n.b].y,c=r[n.a],u=r[n.b];const d=i(c,0),h=i(u,0);if(d&&h)return this.setElevatedPoint(e[0],o,a,c),this.setElevatedPoint(e[1],s,l,u),!0;if(!d&&!h)return!1;if(d){if(!h){const e=u/(u-c);s=hr(s,o,e),l=hr(l,a,e),u=hr(u,c,e)}}else{const e=c/(c-u);o=hr(o,s,e),a=hr(a,l,e),c=hr(c,u,e)}return this.setElevatedPoint(e[0],o,a,c),this.setElevatedPoint(e[1],s,l,u),!0}prepareEdges(e,t){if(0===t.length)return;t.sort((e,t)=>e.hash===t.hash?t.polygonIdx-e.polygonIdx:t.hash>e.hash?1:-1);let r=0,n=0,i=0,o=t[r].polygonIdx;do{n++,(n===t.length||t[r].hash!==t[n].hash)&&((1==n-r||t[n-1].polygonIdx!==o)&&(i<r&&(t[i]=t[r],t[r]=null),t[i].type="none",i++),r=n,r!==t.length&&(o=t[r].polygonIdx))}while(r!==t.length);if(t.splice(i),0!==t.length&&0!==e.length){t.sort((e,t)=>e.portalHash<t.portalHash?1:-1);let r=0,n=0;for(;r!==t.length&&n!==e.length;){const i=t[r],o=e[n];i.portalHash>o.hash?r++:o.hash>i.portalHash?n++:(i.type=o.type,r++)}}}isOnBorder(e,t){return e<=0&&t<=0||e>=Nn&&t>=Nn}addFeatureSection(e,t,r,n){return e!==t&&(t=e,r.push({featureIndex:e,vertexStart:n.getVertexCount()}),n.clearVertexLookup()),t}sortSubarray(e,t,r,n){const i=e.slice(t,r);i.sort(n),e.splice(t,i.length,...i)}static computeEdgeHash(e,t){return(e.y===t.y&&e.x>t.x||e.y>t.y)&&([e,t]=[t,e]),BigInt(uh.computePosHash(e))<<32n|BigInt(uh.computePosHash(t))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var dh,hh={exports:{}},Ah=(dh||(dh=1,function(e){function t(e,t){return e>t?1:e<t?-1:0}var r=function(e,r){void 0===e&&(e=t),void 0===r&&(r=!1),this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!r},n={size:{configurable:!0}};function i(e,t,r,n,o){var a=o-n;if(a>0){var s=n+Math.floor(a/2),l={key:t[s],data:r[s],parent:e};return l.left=i(l,t,r,n,s),l.right=i(l,t,r,s+1,o),l}return null}function o(e,t,r,n,i){if(!(r>=n)){for(var a=e[r+n>>1],s=r-1,l=n+1;;){do{s++}while(i(e[s],a)<0);do{l--}while(i(e[l],a)>0);if(s>=l)break;var c=e[s];e[s]=e[l],e[l]=c,c=t[s],t[s]=t[l],t[l]=c}o(e,t,r,l,i),o(e,t,l+1,n,i)}}r.prototype.rotateLeft=function(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t},r.prototype.rotateRight=function(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t},r.prototype._splay=function(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}},r.prototype.splay=function(e){for(var t,r,n,i,o;e.parent;)(r=(t=e.parent).parent)&&r.parent?((n=r.parent).left===r?n.left=e:n.right=e,e.parent=n):(e.parent=null,this._root=e),i=e.left,o=e.right,e===t.left?(r&&(r.left===t?(t.right?(r.left=t.right,r.left.parent=r):r.left=null,t.right=r,r.parent=t):(i?(r.right=i,i.parent=r):r.right=null,e.left=r,r.parent=e)),o?(t.left=o,o.parent=t):t.left=null,e.right=t,t.parent=e):(r&&(r.right===t?(t.left?(r.right=t.left,r.right.parent=r):r.right=null,t.left=r,r.parent=t):(o?(r.left=o,o.parent=r):r.left=null,e.right=r,r.parent=e)),i?(t.right=i,i.parent=t):t.right=null,e.left=t,t.parent=e)},r.prototype.replace=function(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)},r.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.insert=function(e,t){var r=this._root,n=null,i=this._compare;if(this._noDuplicates)for(;r;){if(n=r,0===i(r.key,e))return;r=i(r.key,e)<0?r.right:r.left}else for(;r;)n=r,r=i(r.key,e)<0?r.right:r.left;return r={key:e,data:t,left:null,right:null,parent:n},n?i(n.key,r.key)<0?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r},r.prototype.find=function(e){for(var t=this._root,r=this._compare;t;){var n=r(t.key,e);if(n<0)t=t.right;else{if(!(n>0))return t;t=t.left}}return null},r.prototype.contains=function(e){for(var t=this._root,r=this._compare;t;){var n=r(e,t.key);if(0===n)return!0;t=n<0?t.left:t.right}return!1},r.prototype.remove=function(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),t.left)if(t.right){var r=this.minNode(t.right);r.parent!==t&&(this.replace(r,r.right),r.right=t.right,r.right.parent=r),this.replace(t,r),r.left=t.left,r.left.parent=r}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},r.prototype.removeNode=function(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},r.prototype.erase=function(e){var t=this.find(e);if(t){this.splay(t);var r=t.left,n=t.right,i=null;r&&(r.parent=null,i=this.maxNode(r),this.splay(i),this._root=i),n&&(r?i.right=n:this._root=n,n.parent=i),this._size--}},r.prototype.pop=function(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t},r.prototype.next=function(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t},r.prototype.prev=function(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t},r.prototype.forEach=function(e){for(var t=this._root,r=[],n=!1,i=0;!n;)t?(r.push(t),t=t.left):r.length>0?(e(t=r.pop(),i++),t=t.right):n=!0;return this},r.prototype.range=function(e,t,r,n){for(var i=[],o=this._compare,a=this._root;0!==i.length||a;)if(a)i.push(a),a=a.left;else{if(o((a=i.pop()).key,t)>0)break;if(o(a.key,e)>=0&&r.call(n,a))return this;a=a.right}return this},r.prototype.keys=function(){for(var e=this._root,t=[],r=[],n=!1;!n;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),r.push(e.key),e=e.right):n=!0;return r},r.prototype.values=function(){for(var e=this._root,t=[],r=[],n=!1;!n;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),r.push(e.data),e=e.right):n=!0;return r},r.prototype.at=function(e){for(var t=this._root,r=[],n=!1,i=0;!n;)if(t)r.push(t),t=t.left;else if(r.length>0){if(t=r.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.load=function(e,t,r){if(void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===r&&(r=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var n=e.length;return r&&o(e,t,0,n-1,this._compare),this._root=i(null,e,t,0,n),this._size=n,this},r.prototype.min=function(){var e=this.minNode(this._root);return e?e.key:null},r.prototype.max=function(){var e=this.maxNode(this._root);return e?e.key:null},r.prototype.isEmpty=function(){return null===this._root},n.size.get=function(){return this._size},r.createTree=function(e,t,n,i,o){return new r(n,o).load(e,t,i)},Object.defineProperties(r.prototype,n);var a=0,s=1,l=2,c=3,u=0,d=1,h=2,A=3;function f(e,t,r){null===t?(e.inOut=!1,e.otherInOut=!0):(e.isSubject===t.isSubject?(e.inOut=!t.inOut,e.otherInOut=t.otherInOut):(e.inOut=!t.otherInOut,e.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(e.prevInResult=!p(t,r)||t.isVertical()?t.prevInResult:t));var n=p(e,r);e.resultTransition=n?function(e,t){var r,n=!e.inOut,i=!e.otherInOut;switch(t){case u:r=n&&i;break;case d:r=n||i;break;case A:r=n^i;break;case h:r=e.isSubject?n&&!i:i&&!n}return r?1:-1}(e,r):0}function p(e,t){switch(e.type){case a:switch(t){case u:return!e.otherInOut;case d:return e.otherInOut;case h:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case A:return!0}break;case l:return t===u||t===d;case c:return t===h;case s:return!1}return!1}var m=function(e,t,r,n,i){this.left=t,this.point=e,this.otherEvent=r,this.isSubject=n,this.type=i||a,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},g={inResult:{configurable:!0}};function y(e,t){return e[0]===t[0]&&e[1]===t[1]}m.prototype.isBelow=function(e){var t=this.point,r=this.otherEvent.point;return this.left?(t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1])>0:(r[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(r[1]-e[1])>0},m.prototype.isAbove=function(e){return!this.isBelow(e)},m.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},g.inResult.get=function(){return 0!==this.resultTransition},m.prototype.clone=function(){var e=new m(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e},Object.defineProperties(m.prototype,g);var _=11102230246251565e-32,v=134217729,x=(3+8*_)*_;function w(e,t,r,n,i){var o,a,s,l,c=t[0],u=n[0],d=0,h=0;u>c==u>-c?(o=c,c=t[++d]):(o=u,u=n[++h]);var A=0;if(d<e&&h<r)for(u>c==u>-c?(s=o-((a=c+o)-c),c=t[++d]):(s=o-((a=u+o)-u),u=n[++h]),o=a,0!==s&&(i[A++]=s);d<e&&h<r;)u>c==u>-c?(s=o-((a=o+c)-(l=a-o))+(c-l),c=t[++d]):(s=o-((a=o+u)-(l=a-o))+(u-l),u=n[++h]),o=a,0!==s&&(i[A++]=s);for(;d<e;)s=o-((a=o+c)-(l=a-o))+(c-l),c=t[++d],o=a,0!==s&&(i[A++]=s);for(;h<r;)s=o-((a=o+u)-(l=a-o))+(u-l),u=n[++h],o=a,0!==s&&(i[A++]=s);return 0===o&&0!==A||(i[A++]=o),A}function b(e){return new Float64Array(e)}var B=33306690738754716e-32,C=22204460492503146e-32,E=11093356479670487e-47,S=b(4),T=b(8),I=b(12),F=b(16),k=b(4);function P(e,t,r){var n=function(e,t,r,n,i,o){var a=(t-o)*(r-i),s=(e-i)*(n-o),l=a-s;if(0===a||0===s||a>0!=s>0)return l;var c=Math.abs(a+s);return Math.abs(l)>=B*c?l:-function(e,t,r,n,i,o,a){var s,l,c,u,d,h,A,f,p,m,g,y,_,b,B,P,M,O,L=e-i,D=r-i,U=t-o,R=n-o;S[0]=(B=(f=L-(A=(h=v*L)-(h-L)))*(m=R-(p=(h=v*R)-(h-R)))-((b=L*R)-A*p-f*p-A*m))-((g=B-(M=(f=U-(A=(h=v*U)-(h-U)))*(m=D-(p=(h=v*D)-(h-D)))-((P=U*D)-A*p-f*p-A*m)))+(d=B-g))+(d-M),S[1]=(_=b-((y=b+g)-(d=y-b))+(g-d))-((g=_-P)+(d=_-g))+(d-P),S[2]=y-((O=y+g)-(d=O-y))+(g-d),S[3]=O;var z=function(e,t){for(var r=t[0],n=1;n<4;n++)r+=t[n];return r}(0,S),N=C*a;if(z>=N||-z>=N)return z;if(s=e-(L+(d=e-L))+(d-i),c=r-(D+(d=r-D))+(d-i),l=t-(U+(d=t-U))+(d-o),u=n-(R+(d=n-R))+(d-o),0===s&&0===l&&0===c&&0===u)return z;if(N=E*a+x*Math.abs(z),(z+=L*u+R*s-(U*c+D*l))>=N||-z>=N)return z;k[0]=(B=(f=s-(A=(h=v*s)-(h-s)))*(m=R-(p=(h=v*R)-(h-R)))-((b=s*R)-A*p-f*p-A*m))-((g=B-(M=(f=l-(A=(h=v*l)-(h-l)))*(m=D-(p=(h=v*D)-(h-D)))-((P=l*D)-A*p-f*p-A*m)))+(d=B-g))+(d-M),k[1]=(_=b-((y=b+g)-(d=y-b))+(g-d))-((g=_-P)+(d=_-g))+(d-P),k[2]=y-((O=y+g)-(d=O-y))+(g-d),k[3]=O;var j=w(4,S,4,k,T);k[0]=(B=(f=L-(A=(h=v*L)-(h-L)))*(m=u-(p=(h=v*u)-(h-u)))-((b=L*u)-A*p-f*p-A*m))-((g=B-(M=(f=U-(A=(h=v*U)-(h-U)))*(m=c-(p=(h=v*c)-(h-c)))-((P=U*c)-A*p-f*p-A*m)))+(d=B-g))+(d-M),k[1]=(_=b-((y=b+g)-(d=y-b))+(g-d))-((g=_-P)+(d=_-g))+(d-P),k[2]=y-((O=y+g)-(d=O-y))+(g-d),k[3]=O;var Q=w(j,T,4,k,I);k[0]=(B=(f=s-(A=(h=v*s)-(h-s)))*(m=u-(p=(h=v*u)-(h-u)))-((b=s*u)-A*p-f*p-A*m))-((g=B-(M=(f=l-(A=(h=v*l)-(h-l)))*(m=c-(p=(h=v*c)-(h-c)))-((P=l*c)-A*p-f*p-A*m)))+(d=B-g))+(d-M),k[1]=(_=b-((y=b+g)-(d=y-b))+(g-d))-((g=_-P)+(d=_-g))+(d-P),k[2]=y-((O=y+g)-(d=O-y))+(g-d),k[3]=O;var V=w(Q,I,4,k,F);return F[V-1]}(e,t,r,n,i,o,c)}(e[0],e[1],t[0],t[1],r[0],r[1]);return n>0?-1:n<0?1:0}function M(e,t){var r=e.point,n=t.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:function(e,t,r){return e.left!==t.left?e.left?1:-1:0!==P(r,e.otherEvent.point,t.otherEvent.point)?e.isBelow(t.otherEvent.point)?-1:1:!e.isSubject&&t.isSubject?1:-1}(e,t,r)}function O(e,t,r){var n=new m(t,!1,e,e.isSubject),i=new m(t,!0,e.otherEvent,e.isSubject);return y(e.point,e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",e),n.contourId=i.contourId=e.contourId,M(i,e.otherEvent)>0&&(e.otherEvent.left=!0,i.left=!1),e.otherEvent.otherEvent=i,e.otherEvent=n,r.push(i),r.push(n),r}function L(e,t){return e[0]*t[1]-e[1]*t[0]}function D(e,t){return e[0]*t[0]+e[1]*t[1]}function U(e,t,r){var n=function(e,t,r,n){var i=[t[0]-e[0],t[1]-e[1]],o=[n[0]-r[0],n[1]-r[1]];function a(e,t,r){return[e[0]+t*r[0],e[1]+t*r[1]]}var s=[r[0]-e[0],r[1]-e[1]],l=L(i,o),c=l*l,u=D(i,i);if(c>0){var d=L(s,o)/l;if(d<0||d>1)return null;var h=L(s,i)/l;return h<0||h>1?null:0===d||1===d?[a(e,d,i)]:0===h||1===h?[a(r,h,o)]:[a(e,d,i)]}if((c=(l=L(s,i))*l)>0)return null;var A=D(i,s)/u,f=A+D(i,o)/u,p=Math.min(A,f),m=Math.max(A,f);return p<=1&&m>=0?1===p?[a(e,p>0?p:0,i)]:0===m?[a(e,m<1?m:1,i)]:[a(e,p>0?p:0,i),a(e,m<1?m:1,i)]:null}(e.point,e.otherEvent.point,t.point,t.otherEvent.point),i=n?n.length:0;if(0===i)return 0;if(1===i&&(y(e.point,t.point)||y(e.otherEvent.point,t.otherEvent.point)))return 0;if(2===i&&e.isSubject===t.isSubject)return 0;if(1===i)return y(e.point,n[0])||y(e.otherEvent.point,n[0])||O(e,n[0],r),y(t.point,n[0])||y(t.otherEvent.point,n[0])||O(t,n[0],r),1;var o=[],a=!1,u=!1;return y(e.point,t.point)?a=!0:1===M(e,t)?o.push(t,e):o.push(e,t),y(e.otherEvent.point,t.otherEvent.point)?u=!0:1===M(e.otherEvent,t.otherEvent)?o.push(t.otherEvent,e.otherEvent):o.push(e.otherEvent,t.otherEvent),a&&u||a?(t.type=s,e.type=t.inOut===e.inOut?l:c,a&&!u&&O(o[1].otherEvent,o[0].point,r),2):u?(O(o[0],o[1].point,r),3):o[0]!==o[3].otherEvent?(O(o[0],o[1].point,r),O(o[1],o[2].point,r),3):(O(o[0],o[1].point,r),O(o[3].otherEvent,o[2].point,r),3)}function R(e,t){if(e===t)return 0;if(0!==P(e.point,e.otherEvent.point,t.point)||0!==P(e.point,e.otherEvent.point,t.otherEvent.point))return y(e.point,t.point)?e.isBelow(t.otherEvent.point)?-1:1:e.point[0]===t.point[0]?e.point[1]<t.point[1]?-1:1:1===M(e,t)?t.isAbove(e.point)?-1:1:e.isBelow(t.point)?-1:1;if(e.isSubject!==t.isSubject)return e.isSubject?-1:1;var r=e.point,n=t.point;return r[0]===n[0]&&r[1]===n[1]?(r=e.otherEvent.point)[0]===(n=t.otherEvent.point)[0]&&r[1]===n[1]?0:e.contourId>t.contourId?1:-1:1===M(e,t)?1:-1}var z=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function N(e,t,r,n){var i,o=e+1,a=t[e].point,s=t.length;for(o<s&&(i=t[o].point);o<s&&i[0]===a[0]&&i[1]===a[1];){if(!r[o])return o;++o<s&&(i=t[o].point)}for(o=e-1;r[o]&&o>n;)o--;return o}z.prototype.isExterior=function(){return null==this.holeOf};var j=V,Q=V;function V(e,t){if(!(this instanceof V))return new V(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||H,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}function H(e,t){return e<t?-1:e>t?1:0}V.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,r=this.compare,n=t[e];e>0;){var i=e-1>>1,o=t[i];if(r(n,o)>=0)break;t[e]=o,e=i}t[e]=n},_down:function(e){for(var t=this.data,r=this.compare,n=this.length>>1,i=t[e];e<n;){var o=1+(e<<1),a=o+1,s=t[o];if(a<this.length&&r(t[a],s)<0&&(o=a,s=t[a]),r(s,i)>=0)break;t[e]=s,e=o}t[e]=i}},j.default=Q;var G=Math.max,K=Math.min,W=0;function q(e,t,r,n,i,o){var a,s,l,c,u,d;for(a=0,s=e.length-1;a<s;a++)if(c=e[a+1],u=new m(l=e[a],!1,void 0,t),d=new m(c,!1,u,t),u.otherEvent=d,l[0]!==c[0]||l[1]!==c[1]){u.contourId=d.contourId=r,o||(u.isExteriorRing=!1,d.isExteriorRing=!1),M(u,d)>0?d.left=!0:u.left=!0;var h=l[0],A=l[1];i[0]=K(i[0],h),i[1]=K(i[1],A),i[2]=G(i[2],h),i[3]=G(i[3],A),n.push(u),n.push(d)}}var Z=[];function X(e,t,n){"number"==typeof e[0][0][0]&&(e=[e]),"number"==typeof t[0][0][0]&&(t=[t]);var i=function(e,t,r){var n=null;return e.length*t.length==0&&(r===u?n=Z:r===h?n=e:r!==d&&r!==A||(n=0===e.length?t:e)),n}(e,t,n);if(i)return i===Z?null:i;var o=[1/0,1/0,-1/0,-1/0],a=[1/0,1/0,-1/0,-1/0],s=function(e,t,r,n,i){var o,a,s,l,c,u,d=new j(null,M);for(s=0,l=e.length;s<l;s++)for(c=0,u=(o=e[s]).length;c<u;c++)(a=0===c)&&W++,q(o[c],!0,W,d,r,a);for(s=0,l=t.length;s<l;s++)for(c=0,u=(o=t[s]).length;c<u;c++)a=0===c,i===h&&(a=!1),a&&W++,q(o[c],!1,W,d,n,a);return d}(e,t,o,a,n);if(i=function(e,t,r,n,i){var o=null;return(r[0]>n[2]||n[0]>r[2]||r[1]>n[3]||n[1]>r[3])&&(i===u?o=Z:i===h?o=e:i!==d&&i!==A||(o=e.concat(t))),o}(e,t,o,a,n))return i===Z?null:i;for(var l=function(e){var t,r,n=function(e){var t,r,n,i,o=[];for(r=0,n=e.length;r<n;r++)((t=e[r]).left&&t.inResult||!t.left&&t.otherEvent.inResult)&&o.push(t);for(var a=!1;!a;)for(a=!0,r=0,n=o.length;r<n;r++)r+1<n&&1===M(o[r],o[r+1])&&(i=o[r],o[r]=o[r+1],o[r+1]=i,a=!1);for(r=0,n=o.length;r<n;r++)(t=o[r]).otherPos=r;for(r=0,n=o.length;r<n;r++)(t=o[r]).left||(i=t.otherPos,t.otherPos=t.otherEvent.otherPos,t.otherEvent.otherPos=i);return o}(e),i={},o=[],a=function(){if(!i[t]){var e=o.length,r=function(e,t,r){var n=new z;if(null!=e.prevInResult){var i=e.prevInResult,o=i.outputContourId;if(i.resultTransition>0){var a=t[o];if(null!=a.holeOf){var s=a.holeOf;t[s].holeIds.push(r),n.holeOf=s,n.depth=t[o].depth}else t[o].holeIds.push(r),n.holeOf=o,n.depth=t[o].depth+1}else n.holeOf=null,n.depth=t[o].depth}else n.holeOf=null,n.depth=0;return n}(n[t],o,e),a=function(t){i[t]=!0,t<n.length&&n[t]&&(n[t].outputContourId=e)},s=t,l=t;for(r.points.push(n[t].point);a(s),a(s=n[s].otherPos),r.points.push(n[s].point),!((s=N(s,n,i,l))==l||s>=n.length)&&n[s];);o.push(r)}};for(t=0,r=n.length;t<r;t++)a();return o}(function(e,t,n,i,o,a){for(var s,l,c,d=new r(R),A=[],p=Math.min(i[2],o[2]);0!==e.length;){var m=e.pop();if(A.push(m),a===u&&m.point[0]>p||a===h&&m.point[0]>i[2])break;if(m.left){l=s=d.insert(m),s=s!==(c=d.minNode())?d.prev(s):null,l=d.next(l);var g=s?s.key:null;if(f(m,g,a),l&&2===U(m,l.key,e)&&(f(m,g,a),f(l.key,m,a)),s&&2===U(s.key,m,e)){var y=s;f(g,(y=y!==c?d.prev(y):null)?y.key:null,a),f(m,g,a)}}else l=s=d.find(m=m.otherEvent),s&&l&&(s=s!==c?d.prev(s):null,l=d.next(l),d.remove(m),l&&s&&U(s.key,l.key,e))}return A}(s,0,0,o,a,n)),c=[],p=0;p<l.length;p++){var m=l[p];if(m.isExterior()){for(var g=[m.points],y=0;y<m.holeIds.length;y++)g.push(l[m.holeIds[y]].points);c.push(g)}}return c}var Y={UNION:d,DIFFERENCE:h,INTERSECTION:u,XOR:A};e.diff=function(e,t){return X(e,t,h)},e.intersection=function(e,t){return X(e,t,u)},e.operations=Y,e.union=function(e,t){return X(e,t,d)},e.xor=function(e,t){return X(e,t,A)},Object.defineProperty(e,"__esModule",{value:!0})}(hh.exports)),hh.exports);function fh(e,t,r,n){const i=[],o=0===n?(e,t,r,n,i,o)=>{e.push(new Be(o,r+(o-t)/(n-t)*(i-r)))}:(e,t,r,n,i,o)=>{e.push(new Be(t+(o-r)/(i-r)*(n-t),o))};for(const a of e){const e=[];for(const i of a){if(i.length<=2)continue;const a=[];for(let e=0;e<i.length-1;e++){const s=i[e].x,l=i[e].y,c=i[e+1].x,u=i[e+1].y,d=0===n?s:l,h=0===n?c:u;d<t?h>t&&o(a,s,l,c,u,t):d>r?h<r&&o(a,s,l,c,u,r):a.push(i[e]),h<t&&d>=t&&o(a,s,l,c,u,t),h>r&&d<=r&&o(a,s,l,c,u,r)}let s=i[i.length-1];const l=0===n?s.x:s.y;l>=t&&l<=r&&a.push(s),a.length&&(s=a[a.length-1],a[0].x===s.x&&a[0].y===s.y||a.push(a[0]),e.push(a))}e.length&&i.push(e)}return i}function ph(e,t){const r=gh(e),n=gh([t]),i=Ah.intersection(r,n);return null==i?[]:yh(i)}function mh(e,t){const r=65536;let n=gh(e,r);const i=[];for(;t.valid();t.next()){const[e,n]=t.get(),o=e.x*r,a=e.y*r,s=n.x*r,l=n.y*r,c=s-o,u=l-a,d=Math.hypot(c,u);if(0===d)continue;const h=Math.trunc(u/d*3),A=-Math.trunc(c/d*3);i.push([[[o,a],[s,l],[s+h,l+A],[o+h,a+A],[o,a]]])}return i.length>0&&(n=Ah.diff(n,i)),yh(n,1/r)}function gh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[e.map(e=>e.map(e=>[e.x*t,e.y*t]))]}function yh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.map(e=>e.map((e,r)=>{const n=e.map(e=>new Be(e[0]*t,e[1]*t).round());return r>0&&n.reverse(),n}))}class _h{constructor(e,t){this.layoutVertexArray=new As,this.indexArray=new Os,this.lineIndexArray=new Is,this.triangleSegments=new dl,this.lineSegments=new dl,this.programConfigurations=new Nl(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,t&&(this.elevatedLayoutVertexArray=new ms)}update(e,t,r,n,i,o,a,s){this.programConfigurations.updatePaintArrays(e,t,i,r,n,o,a,s)}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Ed.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Sd.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,t,r,n,i,o,a){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,t,r,n,i,o,void 0,a)}}class vh{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new _h(e,!1),this.elevationBufferData=new _h(e,!0),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,t){}updateAppearances(e,t,r,n){}populate(e,t,r,n){this.hasPattern=oh("fill",this.layers,this.pixelRatio,t);const i=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:a,id:s,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Ic(a,e);if(!this.layers[0]._featureFilter.filter(new Ba(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),u,r))continue;const d=i?i.evaluate(u,{},r,t.availableImages):void 0,h={id:s,properties:a.properties,type:a.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Tc(a,r,n),patterns:{},sortKey:d};o.push(h)}i&&o.sort((e,t)=>e.sortKey-t.sortKey);for(const a of o){const{geometry:n,index:i,sourceLayerIndex:o}=a;if(this.hasPattern){const e=ah("fill",this.layers,a,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(a,n,i,r,{},t.availableImages,t.brightness,t.elevationFeatures);t.featureIndex.insert(e[i].feature,n,i,o,this.index)}}update(e,t,r,n,i,o,a){this.bufferData.update(e,t,r,n,i,o,a,this.worldview),this.elevationBufferData.update(e,t,r,n,i,o,a,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,t,r,n,i,o,a,this.worldview)}addFeatures(e,t,r,n,i,o){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,r,n,o,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0;const l=rh(t,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(e,l,n,r,s):this.addGeometry(l,this.bufferData),this.bufferData.populatePaintArrays(e,r,i,o,n,a,this.worldview),this.elevationBufferData.populatePaintArrays(e,r,i,o,n,a,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,t,r,n,i){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(t,r,n,i,this.worldview))}addElevatedRoadFeature(e,t,r,n,i){const o=new Array,a=tu.getElevationFeature(e,i);if(!a)return void this.addGeometry(t,this.bufferData);{const e=this.clipPolygonsToTile(t,1);e.length>0&&o.push({polygons:e,elevationFeature:a,elevationTileID:r})}const s={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},r),featureIndex:n};for(const l of o)if(l.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new uh(l.elevationTileID,this.layers,this.zoom,this.lut));const t=l.elevationFeature.isTunnel();let r=0;e.properties.hasOwnProperty(Rc)&&(r=+e.properties[Rc]);for(const e of l.polygons)this.elevatedStructures.addPortalCandidates(l.elevationFeature.id,e,t,l.elevationFeature,r)}null==l.elevationFeature.constantHeight&&(l.polygons=this.prepareElevatedPolygons(l.polygons,l.elevationFeature,l.elevationTileID));const t=new ru(r,l.elevationTileID);this.addElevatedGeometry(l.polygons,t,l.elevationFeature,"hd-road-base"===this.elevationMode?0:.05,n,s)}}addElevatedGeometry(e,t,r,n,i,o){const a={elevation:r,elevationSampler:t,bias:n,index:i,featureInfo:o},[s,l]=this.addGeometry(e,this.elevationBufferData,a);null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:s,max:l}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,s),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,l))}addGeometry(e,t,r){let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,o=null;r&&(o=r.elevationSampler.constantElevation(r.elevation,r.bias),null!=o&&(n=o,i=o));const a=(e,a,s)=>{if(null!=r)if(a.push(e),null!=o)t.elevatedLayoutVertexArray.emplaceBack(o),s.push(o);else{const o=r.elevationSampler.pointElevation(e,r.elevation,r.bias);t.elevatedLayoutVertexArray.emplaceBack(o),s.push(o),n=Math.min(n,o),i=Math.max(i,o)}};for(const s of e){let e=0;for(const t of s)e+=t.length;const n=t.triangleSegments.prepareSegment(e,t.layoutVertexArray,t.indexArray),i=n.vertexLength,o=[],l=[],c=[],u=[],d=[],h=t.layoutVertexArray.length;for(const f of s){if(0===f.length)continue;f!==s[0]&&l.push(o.length/2);const e=t.lineSegments.prepareSegment(f.length,t.layoutVertexArray,t.lineIndexArray),n=e.vertexLength;r&&d.push(t.layoutVertexArray.length-h),a(f[0],c,u),t.layoutVertexArray.emplaceBack(f[0].x,f[0].y),t.lineIndexArray.emplaceBack(n+f.length-1,n),o.push(f[0].x),o.push(f[0].y);for(let r=1;r<f.length;r++)a(f[r],c,u),t.layoutVertexArray.emplaceBack(f[r].x,f[r].y),t.lineIndexArray.emplaceBack(n+r-1,n+r),o.push(f[r].x),o.push(f[r].y);e.vertexLength+=f.length,e.primitiveLength+=f.length}const A=Fd(o,l);for(let r=0;r<A.length;r+=3)t.indexArray.emplaceBack(i+A[r],i+A[r+1],i+A[r+2]);if(A.length>0&&r&&"hd-road-base"===this.elevationMode){const e=r.elevation.isTunnel(),t=r.elevation.safeArea,n=this.elevatedStructures.addVertices(c,u);this.elevatedStructures.addTriangles(A,n,e);const i=d.length;if(i>0){for(let o=0;o<i-1;o++)this.elevatedStructures.addRenderableRing(r.index,d[o]+n,d[o+1]-d[o],e,t,r.featureInfo);this.elevatedStructures.addRenderableRing(r.index,d[i-1]+n,c.length-d[i-1],e,t,r.featureInfo)}}n.vertexLength+=e,n.primitiveLength+=A.length/3}return[n,i]}prepareElevatedPolygons(e,t,r){const n=1/_c(r),i=[];for(const o of e){const e=mh(o,new $c(t,n));i.push(...e)}return i}clipPolygonsToTile(e,t){const r=-t,n=-t,i=Nn+t,o=Nn+t;let a=0;const s=[],l=[];for(;a<e.length;a++){const t=e[a],c=yn(t);(c.min.x>=r&&c.max.x<=i&&c.min.y>=n&&c.max.y<=o?s:l).push(t)}if(s.length===e.length)return e;const c=[new Be(r,n),new Be(i,n),new Be(i,o),new Be(r,o),new Be(r,n)],u=s;for(const d of l)u.push(...ph(d,c));return u}}let xh,wh,bh,Bh;ea(vh,"FillBucket",{omit:["layers","patternFeatures"]}),ea(_h,"FillBufferData"),ea(uh,"ElevatedStructures");class Ch{constructor(e,t,r,n){if(this.triangleCount=t.length/3,this.min=new Be(0,0),this.max=new Be(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;const[i,o]=[e[0].clone(),e[0].clone()];for(let u=1;u<e.length;++u){const t=e[u];i.x=Math.min(i.x,t.x),i.y=Math.min(i.y,t.y),o.x=Math.max(o.x,t.x),o.y=Math.max(o.y,t.y)}if(n){const e=Math.ceil(Math.max(o.x-i.x,o.y-i.y)/n);r=Math.max(r,e)}if(0===r)return;this.min=i,this.max=o;const a=this.max.sub(this.min);a.x=Math.max(a.x,1),a.y=Math.max(a.y,1);const s=Math.max(a.x,a.y)/r;this.cellsX=Math.max(1,Math.ceil(a.x/s)),this.cellsY=Math.max(1,Math.ceil(a.y/s)),this.xScale=1/s,this.yScale=1/s;const l=[];for(let u=0;u<this.triangleCount;u++){const r=e[t[3*u+0]].sub(this.min),n=e[t[3*u+1]].sub(this.min),i=e[t[3*u+2]].sub(this.min),o=Eh(Math.floor(Math.min(r.x,n.x,i.x)),this.xScale,this.cellsX),a=Eh(Math.floor(Math.max(r.x,n.x,i.x)),this.xScale,this.cellsX),c=Eh(Math.floor(Math.min(r.y,n.y,i.y)),this.yScale,this.cellsY),d=Eh(Math.floor(Math.max(r.y,n.y,i.y)),this.yScale,this.cellsY),h=new Be(0,0),A=new Be(0,0),f=new Be(0,0),p=new Be(0,0);for(let e=c;e<=d;++e){h.y=A.y=e*s,f.y=p.y=(e+1)*s;for(let t=o;t<=a;++t)h.x=f.x=t*s,A.x=p.x=(t+1)*s,(_u(r,n,i,h,A,p)||_u(r,n,i,h,p,f))&&l.push({cellIdx:e*this.cellsX+t,triIdx:u})}}if(0===l.length)return;l.sort((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx);let c=0;for(;c<l.length;){const e=l[c].cellIdx,t={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===e;)++t.len,this.payload.push(l[c++].triIdx);this.cells[e]=t}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,t){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const r=Eh(e.x-this.min.x,this.xScale,this.cellsX),n=Eh(e.y-this.min.y,this.yScale,this.cellsY),i=this.cells[n*this.cellsX+r];if(i){this._lazyInitLookup();for(let e=0;e<i.len;e++){const r=this.payload[i.start+e],n=Math.floor(r/8),o=1<<r%8;if(!(this.lookup[n]&o)&&(this.lookup[n]|=o,t.push(r),t.length===this.triangleCount))return}}}query(e,t,r){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this._lazyInitLookup();const n=Eh(e.x-this.min.x,this.xScale,this.cellsX),i=Eh(t.x-this.min.x,this.xScale,this.cellsX),o=Eh(e.y-this.min.y,this.yScale,this.cellsY),a=Eh(t.y-this.min.y,this.yScale,this.cellsY);for(let s=o;s<=a;s++)for(let e=n;e<=i;e++){const t=this.cells[s*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const n=this.payload[t.start+e],i=Math.floor(n/8),o=1<<n%8;if(!(this.lookup[i]&o)&&(this.lookup[i]|=o,r.push(n),r.length===this.triangleCount))return}}}}function Eh(e,t,r){return Math.max(0,Math.min(r-1,Math.floor(e*t)))}ea(Ch,"TriangleGridIndex");class Sh{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,t){for(const r of this.footprints)t.push({footprint:r,id:e})}updateAppearances(e,t,r,n){}populate(e,t,r,n){const i=[];for(const{feature:o,id:a,index:s,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Ic(o,e);if(!this.layers[0]._featureFilter.filter(new Ba(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),c,r))continue;const u={id:a,properties:o.properties,type:o.type,sourceLayerIndex:l,index:s,geometry:e?c.geometry:Tc(o,r,n),patterns:{}};i.push(u)}for(const o of i){const{geometry:n,index:i,sourceLayerIndex:a}=o;this.addFeature(o,n,i,r,{},t.availableImages,t.brightness),t.featureIndex.insert(e[i].feature,n,i,a,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(e){}update(e,t,r,n,i,o,a){}destroy(){}addFeature(e,t,r,n,i){for(const o of rh(t,2)){const e=[],t=[],r=[],n=new Be(1/0,1/0),i=new Be(-1/0,-1/0);for(const l of o)if(0!==l.length){l!==o[0]&&r.push(t.length/2);for(let r=0;r<l.length;r++)t.push(l[r].x),t.push(l[r].y),e.push(l[r]),n.x=Math.min(n.x,l[r].x),n.y=Math.min(n.y,l[r].y),i.x=Math.max(i.x,l[r].x),i.y=Math.max(i.y,l[r].y)}const a=Fd(t,r),s=new Ch(e,a,8,256);this.footprints.push({vertices:e,indices:a,grid:s,min:n,max:i})}}}ea(Sh,"ClipBucket",{omit:["layers"]});const Th=ds([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Ih=ds([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Fh=ds([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),kh=ds([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ph=ds([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Mh=ds([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Oh=ds([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Lh}=Th,Dh=Number.MAX_SAFE_INTEGER,Uh=Dh-1;function Rh(e,t,r,n){return e.order<t||e.order===Dh||!(e.clipMask&r)||function(e,t){return 0!==t.length&&void 0===t.find(t=>t===e)}(n,e.clipScope)}function zh(e,t){return e.x-t.x||e.y-t.y}function Nh(e,t){return 0===zh(e.min,t.min)&&0===zh(e.max,t.max)}function jh(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Qh(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r].sourceId!==t[r].sourceId||!Nh(e[r],t[r])||e[r].order!==t[r].order||e[r].clipMask!==t[r].clipMask||!Ce(e[r].clipScope,t[r].clipScope))return!1;return!0}function Vh(e,t,r){const n=1/Nn,i=1/(1<<r.canonical.z),o=(t.x*n+r.canonical.x)*i+r.wrap,a=(t.y*n+r.canonical.y)*i;return{min:new Be((e.x*n+r.canonical.x)*i+r.wrap,(e.y*n+r.canonical.y)*i),max:new Be(o,a)}}function Hh(e,t,r){const n=1<<r.canonical.z,i=((t.x-r.wrap)*n-r.canonical.x)*Nn,o=(t.y*n-r.canonical.y)*Nn;return{min:new Be(((e.x-r.wrap)*n-r.canonical.x)*Nn,(e.y*n-r.canonical.y)*Nn),max:new Be(i,o)}}function Gh(e,t,r,n,i,o,a){const s=e.indices,l=e.vertices,c=[];for(let u=n;u<n+i;u+=3){const n=t[r[u+0]+o],i=t[r[u+1]+o],d=t[r[u+2]+o],h=Math.min(n.x,i.x,d.x),A=Math.max(n.x,i.x,d.x),f=Math.min(n.y,i.y,d.y),p=Math.max(n.y,i.y,d.y);c.length=0,e.grid.query(new Be(h,f),new Be(A,p),c);for(let e=0;e<c.length;e++){const t=c[e];if(_u(l[s[3*t+0]],l[s[3*t+1]],l[s[3*t+2]],n,i,d,a))return!0}}return!1}function Kh(e,t,r,n){if(!e||!r)return!1;let i=e.vertices;if(!t.canonical.equals(n.canonical)||t.wrap!==n.wrap){if(r.vertices.length<e.vertices.length)return Kh(r,n,e,t);const o=t.canonical,a=n.canonical,s=Math.pow(2,a.z-o.z);i=e.vertices.map(e=>new Be((e.x+o.x*Nn)*s-a.x*Nn,(e.y+o.y*Nn)*s-a.y*Nn))}return Gh(r,i,e.indices,0,e.indices.length,0,0)}function Wh(e,t,r,n){const i=Math.pow(2,n.z-r.z);return new Be((e+r.x*Nn)*i-n.x*Nn,(t+r.y*Nn)*i-n.y*Nn)}function qh(e,t){const r=[];t.grid.queryPoint(e,r);const n=t.indices,i=t.vertices;for(let o=0;o<r.length;o++){const t=r[o];if(pu([i[n[3*t+0]],i[n[3*t+1]],i[n[3*t+2]]],e))return!0}return!1}const Zh=[new Be(0,0),new Be(Nn,0),new Be(Nn,Nn),new Be(0,Nn)];function Xh(e,t){const r=[];let n=[];if(!t||e.length<2)return[e];if(2===e.length)return gu(e[0],e[1],Zh)?[e]:[];for(let i=0;i<e.length+2;i++){const t=e[i%e.length],o=e[(i+1)%e.length],a=gu(0===i?e[e.length-1]:e[(i-1)%e.length],t,Zh),s=gu(t,o,Zh),l=a||s;l&&n.push(t),l&&s||n.length>0&&(n.length>1&&r.push(n),n=[])}return n.length>1&&r.push(n),r}const Yh=Fc.types,Jh=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],$h=["fill-extrusion-flood-light-ground-radius"],eA=Math.pow(2,13),tA=Math.pow(2,15)-1,rA=new Be(0,1),nA=2147483648,iA=7,oA=450;function aA(e,t,r,n,i,o,a,s){e.emplaceBack((t<<1)+a,(r<<1)+o,(Math.floor(n*eA)<<1)+i,Math.round(s))}function sA(e,t,r){e.emplaceBack(t.x*Nn,t.y*Nn,r?1:0)}function lA(e,t,r,n,i,o){e.emplaceBack(t.x,t.y,(r.x<<1)+n,(r.y<<1)+i,o)}function cA(e,t,r){const n=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*n,r[1]*n,r[2]*n)}class uA{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class dA{constructor(){this.centroidXY=new Be(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Be(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Be(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Be(this.max.x-this.min.x,this.max.y-this.min.y)}}class hA{constructor(){this.acc=new Be(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,r){this.accCount++,this.acc._add(t);let n=!!this.borders;t.x<e.min.x?(e.min.x=t.x,n=!0):t.x>e.max.x&&(e.max.x=t.x,n=!0),t.y<e.min.y?(e.min.y=t.y,n=!0):t.y>e.max.y&&(e.max.y=t.y,n=!0),((0===t.x||t.x===Nn)&&t.x===r.x)!=((0===t.y||t.y===Nn)&&t.y===r.y)&&this.processBorderOverlap(t,r),n&&this.checkBorderIntersection(t,r)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,hr(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Nn!=e.x>Nn&&this.addBorderIntersection(1,hr(t.y,e.y,(Nn-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,hr(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Nn!=e.y>Nn&&this.addBorderIntersection(3,hr(t.x,e.x,(Nn-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x)}}centroid(){return 0===this.accCount?new Be(0,0):new Be(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0):0}}function AA(e,t){const r=e.add(t)._unit(),n=Oe(e.x*r.x+e.y*r.y,-1,1);var i,o,a;return i=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(i)))/4*tA*((o=e).x*(a=t).y-o.y*a.x<0?-1:1)}const fA=[e=>e.x<0,e=>e.x>Nn,e=>e.y<0,e=>e.y>Nn];function pA(e,t,r,n){const i=[4];if(0===n)return i;r._mult(n);const o=e.sub(r),a=t.sub(r),s=[e,t,o,a];for(let l=0;l<4;l++)for(const e of s)if(fA[l](e)){i.push(l);break}return i}class mA{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new _s,this.indexArray=new Os,this.programConfigurations=new Nl(e.layers,{zoom:e.zoom,lut:e.lut},e=>$h.includes(e)),this._segments=new dl,this.hiddenByLandmarkVertexArray=new qs,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new dl}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=e.length;if(i>2){let o=Math.max(0,this._segments.get().length-1);const a=this._segments._prepareSegment(4*i,this.vertexArray.length,2*this._segmentToGroundQuads[o].length);let s;o!==this._segments.get().length-1&&(o++,this._segmentToGroundQuads[o]=[],this._segmentToRegionTriCounts[o]=[0,0,0,0,0]);{const t=e[0],r=e[1];s=AA(t.sub(e[i-1])._perp()._unit(),r.sub(t)._perp()._unit())}for(let l=0;l<i;l++){const c=l===i-1?0:l+1,u=e[l],d=e[c],h=e[c===i-1?0:c+1],A=d.sub(u)._perp()._unit(),f=AA(A,h.sub(d)._perp()._unit()),p=s,m=f;if(xA(u,d,t)||n&&wA(u,t)&&wA(d,t)){s=f;continue}const g=a.vertexLength;lA(this.vertexArray,u,d,1,1,p),lA(this.vertexArray,u,d,1,0,p),lA(this.vertexArray,u,d,0,1,m),lA(this.vertexArray,u,d,0,0,m),a.vertexLength+=4;const y=pA(u,d,A,r);for(const e of y)this._segmentToGroundQuads[o].push({id:g,region:e}),this._segmentToRegionTriCounts[o][e]+=2,a.primitiveLength+=2;s=f}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let r=0;r<t;r++)this._segmentToGroundQuads[r].sort((e,t)=>e.region-t.region);for(let r=0;r<t;r++){const t=this._segmentToGroundQuads[r],n=e[r],i=this._segmentToRegionTriCounts[r];i.reduce((e,t)=>e+t,0);let o=0;for(let e=0;e<=4;e++){const t=i[e];if(0!==t){let r=this.regionSegments[e];r||(r=this.regionSegments[e]=new dl);const i={vertexOffset:n.vertexOffset,primitiveOffset:n.primitiveOffset+o,vertexLength:n.vertexLength,primitiveLength:t};r.get().push(i)}o+=t}for(let e=0;e<t.length;e++){const r=t[e].id;this.indexArray.emplaceBack(r,r+1,r+3),this.indexArray.emplaceBack(r,r+3,r+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,r,n,i,o,a){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,r,n,i,o,void 0,a)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Ih.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),null!=this.groundRadiusArray&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,Fh.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,r,n,i,o,a,s){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,r,n,i,o,a,s)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&nA))}updateHiddenByLandmarkRange(e,t,r){if(!this.hasData())return;const n=t+e;if(0!==t){for(let t=e;t<n;++t)this.hiddenByLandmarkVertexArray.emplace(t,r?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Mh.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class gA{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Os,this.footprintVertices=new As,this.footprintSegments=[],this.layoutVertexArray=new ps,this.centroidVertexArray=new ol,this.wallVertexArray=new sl,this.indexArray=new Os,this.programConfigurations=new Nl(e.layers,{zoom:e.zoom,lut:e.lut},e=>Jh.includes(e)),this.segments=new dl,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.groundEffect=new mA(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,t){}updateAppearances(e,t,r,n){}populate(e,t,r,n){this.features=[],this.hasPattern=oh("fill-extrusion",this.layers,this.pixelRatio,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=_c(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:i,id:o,index:a,sourceLayerIndex:s}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Ic(i,e);if(!this.layers[0]._featureFilter.filter(new Ba(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),l,r))continue;const c={id:o,sourceLayerIndex:s,index:a,geometry:e?l.geometry:Tc(i,r,n),properties:i.properties,type:i.type,patterns:{}},u=this.layoutVertexArray.length,d="Polygon"===Yh[c.type];if(this.hasPattern)this.features.push({featureId:i.id,feature:ah("fill-extrusion",this.layers,c,this.zoom,this.pixelRatio,t)});else if(this.wallMode)for(const o of c.geometry)for(const e of Xh(o,d))this.addFeature(i.id,c,[e],a,r,{},t.availableImages,n,t.brightness);else this.addFeature(i.id,c,c.geometry,a,r,{},t.availableImages,n,t.brightness);t.featureIndex.insert(i,c.geometry,a,s,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,r,n,i,o){for(const{featureId:a,feature:s}of this.features){const e="Polygon"===Yh[s.type],{geometry:l}=s;if(this.wallMode)for(const c of l)for(const l of Xh(c,e))this.addFeature(a,s,[l],s.index,t,r,n,i,o);else this.addFeature(a,s,l,s.index,t,r,n,i,o)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,r,n,i,o,a){this.programConfigurations.updatePaintArrays(e,t,i,r,n,o,a,this.worldview),this.groundEffect.update(e,t,i,r,n,o,a,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Lh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Ph.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Oh.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,kh.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,n,i,o,a,s,l){const c=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,u=[new Be(0,0),new Be(Nn,Nn)],d=s.projection,h="globe"===d.name,A=this.wallMode||"Polygon"===Yh[t.type],f=new hA;f.centroidDataIndex=this.centroidData.length;const p=new dA;p.buildingId=e,t.properties&&t.properties.hasOwnProperty("building_id")&&(p.buildingId=t.properties.building_id);const m=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},i)<=0,g=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},i);let y;if(p.height=g,p.vertexArrayOffset=this.layoutVertexArray.length,p.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Bs),this.wallMode){if(h)return void We("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==r.length)return;y=function(e){const t=e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y,r=function(e){let t=0;const r=e.length;for(let n=0;n<r;n++)t+=(e[(n+1)%r].x-e[n].x)*(e[(n+1)%r].y+e[n].y);return t>=0}(e);r||(e=e.reverse());const n={geometry:[],joinNormals:[],indices:[]},i=[],o=[],a=[];let s=e.length;for(;s>=2&&e[s-1].equals(e[s-2]);)s--;if(s<(t?3:2))return n;let l,c,u,d,h,A=0;for(;A<s-1&&e[A].equals(e[A+1]);)A++;t&&(l=e[s-2],h=e[A].sub(l)._unit()._perp());for(let p=A;p<s;p++){if(u=p===s-1?t?e[A+1]:void 0:e[p+1],u&&e[p].equals(u))continue;h&&(d=h),l&&(c=l),l=e[p],h=u?u.sub(l)._unit()._perp():d,d=d||h;let r=d.add(h);0===r.x&&0===r.y||r._unit();const n=r.x*h.x+r.y*h.y,f=0!==n?1/n:1/0,m=d.x*h.y-d.y*h.x>0;let g="miter";const y=2;"miter"===g&&f>y&&(g="bevel"),"bevel"===g&&(f>100&&(g="flipbevel"),f<y&&(g="miter"));const _=(e,t,r,n)=>{const s=new Be(e.x,e.y),l=new Be(e.x,e.y);s.x+=t.x*n,s.y+=t.y*n,l.x-=t.x*Math.max(r,1),l.y-=t.y*Math.max(r,1),a.push(t),i.push(s),o.push(l)};if("miter"===g)r._mult(f),_(l,r,0,0);else if("flipbevel"===g)r=h.mult(-1),_(l,r,0,0),_(l,r.mult(-1),0,0);else{const e=-Math.sqrt(f*f-1),t=m?e:0,r=m?0:e;c&&_(l,d,t,r),u&&_(l,h,t,r)}}n.geometry=[...i,...o.reverse(),i[0]],n.joinNormals=[...a,...a.reverse(),a[a.length-1]];const f=n.geometry.length-1;for(let p=0;p<f/2;p++)if(p+1<f/2){let e=p,t=p+1,r=f-1-p,i=f-2-p;e=0===e?f-1:e-1,t=0===t?f-1:t-1,r=0===r?f-1:r-1,i=0===i?f-1:i-1,n.indices.push(r),n.indices.push(t),n.indices.push(e),n.indices.push(r),n.indices.push(i),n.indices.push(t)}return n}(r[0]),r=[y.geometry]}const _=(e,t)=>e<(t.length-1)/2||e===t.length-1,v=this.wallMode?[r]:rh(r,500);for(let E=v.length-1;E>=0;E--){const e=v[E];(0===e.length||(x=e[0]).every(e=>e.x<=0)||x.every(e=>e.x>=Nn)||x.every(e=>e.y<=0)||x.every(e=>e.y>=Nn))&&v.splice(E,1)}var x;let w;if(h)w=EA(v,u,i);else{w=[];for(const e of v)w.push({polygon:e,bounds:u})}const b=A?this.edgeRadius:0,B=b>0&&this.zoom<17,C=(e,t)=>{if(0===e.length)return!1;const r=e[e.length-1];return t.x===r.x&&t.y===r.y};for(const{polygon:E,bounds:S}of w){let e=0,t=0;for(const i of E)A&&!i[0].equals(i[i.length-1])&&i.push(i[0]),t+=A?i.length-1:i.length;const r=this.segments.prepareSegment((A?5:4)*t,this.layoutVertexArray,this.indexArray);p.footprintSegIdx<0&&(p.footprintSegIdx=this.footprintSegments.length),p.polygonSegIdx<0&&(p.polygonSegIdx=this.polygonSegments.length);const n={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},o=new uA;if(o.vertexOffset=this.footprintVertices.length,o.indexOffset=3*this.footprintIndices.length,o.ringIndices=[],A){const t=[],n=[];e=r.vertexLength;for(let e=0;e<E.length;e++){const a=E[e];a.length&&0!==e&&n.push(t.length/2);const s=[];let l,u;l=a[1].sub(a[0])._perp()._unit(),o.ringIndices.push(a.length-1);for(let e=1;e<a.length;e++){const n=a[e],o=a[e===a.length-1?1:e+1],c=n.clone();if(b){u=o.sub(n)._perp()._unit();const e=l.add(u)._unit(),t=b*Math.min(4,1/(l.x*e.x+l.y*e.y));c.x+=t*e.x,c.y+=t*e.y,c.x=Math.round(c.x),c.y=Math.round(c.y),l=u}if(!m||0!==b&&!B||C(s,c)||s.push(c),aA(this.layoutVertexArray,c.x,c.y,0,0,1,1,0),this.wallMode){const t=_(e,a);sA(this.wallVertexArray,y.joinNormals[e],!t)}r.vertexLength++,this.footprintVertices.emplaceBack(n.x,n.y),t.push(n.x,n.y),h&&cA(this.layoutVertexExtArray,d.projectTilePoint(c.x,c.y,i),d.upVector(i,c.x,c.y))}m&&(0===b||B)&&(0!==s.length&&C(s,s[0])&&s.pop(),this.groundEffect.addData(s,S,c))}const a=this.wallMode?y.indices:Fd(t,n);for(let i=0;i<a.length;i+=3)this.footprintIndices.emplaceBack(o.vertexOffset+a[i+0],o.vertexOffset+a[i+1],o.vertexOffset+a[i+2]),this.indexArray.emplaceBack(e+a[i],e+a[i+2],e+a[i+1]),r.primitiveLength++;o.indexCount+=a.length,o.vertexCount+=this.footprintVertices.length-o.vertexOffset}for(let a=0;a<E.length;a++){const t=E[a];f.startRing(p,t[0]);let n=t.length>4&&bA(t[t.length-2],t[0],t[1]),o=b?_A(t[t.length-2],t[0],t[1],b):0;const s=[];let l,u,g;u=t[1].sub(t[0])._perp()._unit();let v=!0;for(let a=1,c=0;a<t.length;a++){let A=t[a-1],x=t[a];const w=t[a===t.length-1?1:a+1];if(f.appendEdge(p,x,A),xA(x,A,S)){b&&(u=w.sub(x)._perp()._unit(),v=!v);continue}const B=x.sub(A)._perp(),E=B.x/(Math.abs(B.x)+Math.abs(B.y)),T=B.y>0?1:0,I=A.dist(x);if(c+I>32768&&(c=0),b){g=w.sub(x)._perp()._unit();let e=vA(A,x,w,yA(u,g),b);isNaN(e)&&(e=0);const t=x.sub(A)._unit();A=A.add(t.mult(o))._round(),x=x.add(t.mult(-e))._round(),o=e,u=g,m&&this.zoom>=17&&(C(s,A)||s.push(A),C(s,x)||s.push(x))}const F=r.vertexLength,k=t.length>4&&bA(A,x,w);let P=BA(c,n,v);if(aA(this.layoutVertexArray,A.x,A.y,E,T,0,0,P),aA(this.layoutVertexArray,A.x,A.y,E,T,0,1,P),this.wallMode){const e=_(a-1,t),r=y.joinNormals[a-1];sA(this.wallVertexArray,r,e),sA(this.wallVertexArray,r,e)}if(c+=I,P=BA(c,k,!v),n=k,aA(this.layoutVertexArray,x.x,x.y,E,T,0,0,P),aA(this.layoutVertexArray,x.x,x.y,E,T,0,1,P),this.wallMode){const e=_(a,t),r=y.joinNormals[a];sA(this.wallVertexArray,r,e),sA(this.wallVertexArray,r,e)}if(r.vertexLength+=4,this.indexArray.emplaceBack(F+0,F+1,F+2),this.indexArray.emplaceBack(F+1,F+3,F+2),r.primitiveLength+=2,b){const n=e+(1===a?t.length-2:a-2),i=1===a?e:n+1;if(this.indexArray.emplaceBack(F+1,n,F+3),this.indexArray.emplaceBack(n,i,F+3),r.primitiveLength+=2,void 0===l&&(l=F),!xA(w,t[a],S)){const e=a===t.length-1?l:r.vertexLength;this.indexArray.emplaceBack(F+2,F+3,e),this.indexArray.emplaceBack(F+3,e+1,e),this.indexArray.emplaceBack(F+3,i,e+1),r.primitiveLength+=3}v=!v}if(h){const e=this.layoutVertexExtArray,t=d.projectTilePoint(A.x,A.y,i),r=d.projectTilePoint(x.x,x.y,i),n=d.upVector(i,A.x,A.y),o=d.upVector(i,x.x,x.y);cA(e,t,n),cA(e,t,n),cA(e,r,o),cA(e,r,o)}}A&&(e+=t.length-1),m&&b&&this.zoom>=17&&(0!==s.length&&C(s,s[0])&&s.pop(),this.groundEffect.addData(s,S,c,b>0))}this.footprintSegments.push(o),n.triangleCount=this.indexArray.length-n.triangleArrayOffset,this.polygonSegments.push(n),++p.footprintSegLen,++p.polygonSegLen}if(p.vertexCount=this.layoutVertexArray.length-p.vertexArrayOffset,p.groundVertexCount=this.groundEffect.vertexArray.length-p.groundVertexArrayOffset,0!==p.vertexCount){if(p.centroidXY=f.borders?rA:this.encodeCentroid(f,p),this.centroidData.push(p),f.borders){this.featuresOnBorder.push(f);const e=this.featuresOnBorder.length-1;for(let t=0;t<f.borders.length;t++)f.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,o,a,i,l,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(t,n,o,a,i,l,this.worldview),this.maxHeight=Math.max(this.maxHeight,g)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((t,r)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}splitToSubtiles(){const e=[];for(let a=0;a<this.centroidData.length;a++){const t=this.centroidData[a],r=+(t.min.y+t.max.y>Nn),n=2*r+(+(t.min.x+t.max.x>Nn)^r);for(let i=0;i<t.polygonSegLen;i++){const r=t.polygonSegIdx+i;e.push({centroidIdx:a,subtile:n,polygonSegmentIdx:r,triangleSegmentIdx:this.polygonSegments[r].triangleSegIdx})}}const t=new Os;e.sort((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx);let r=0,n=0,i=0;for(const a of e){if(a.triangleSegmentIdx!==r)break;i++}const o=e.length;for(;n!==e.length;){r=e[n].triangleSegmentIdx;let a=0,s=n,l=n;for(let t=s;t<i&&e[t].subtile===a;t++)l++;for(;s!==i;){const n=e[s];a=n.subtile;const o=this.centroidData[n.centroidIdx].min.clone(),c=this.centroidData[n.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let r=s;r<l;r++){const n=e[r],i=this.polygonSegments[n.polygonSegmentIdx],a=this.centroidData[n.centroidIdx].min,s=this.centroidData[n.centroidIdx].max,l=this.indexArray.uint16;for(let e=i.triangleArrayOffset;e<i.triangleArrayOffset+i.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);u.primitiveLength+=i.triangleCount,o.x=Math.min(o.x,a.x),o.y=Math.min(o.y,a.y),c.x=Math.max(c.x,s.x),c.y=Math.max(c.y,s.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:o,max:c}),s=l;for(let t=s;t<i&&e[t].subtile===e[s].subtile;t++)l++}n=i;for(let t=n;t<o&&e[t].triangleSegmentIdx===e[n].triangleSegmentIdx;t++)i++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,r){const n=new dl;if(this.wallMode){for(const e of this.triangleSubSegments)n.segments.push(e.segment);return n}let i=0,o=0;const a=1<<e.canonical.z;if(t){const r=t.getMinMaxForTile(e);r&&(i=r.min,o=r.max)}o+=this.maxHeight;const s=e.toUnwrapped();let l;const c=[s.canonical.x/a+s.wrap,s.canonical.y/a],u=[(s.canonical.x+1)/a+s.wrap,(s.canonical.y+1)/a],d=(e,t,r)=>[e[0]*(1-r[0])+t[0]*r[0],e[1]*(1-r[1])+t[1]*r[1]],h=[],A=[];for(const f of this.triangleSubSegments){h[0]=f.min.x/Nn,h[1]=f.min.y/Nn,A[0]=f.max.x/Nn,A[1]=f.max.y/Nn;const e=d(c,u,h),t=d(c,u,A);if(0===new Jc([e[0],e[1],i],[t[0],t[1],o]).intersectsPrecise(r)){l&&(n.segments.push(l),l=void 0);continue}const a=f.segment;l&&l.vertexOffset!==a.vertexOffset&&(n.segments.push(l),l=void 0),l?(l.vertexLength+=a.vertexLength,l.primitiveLength+=a.primitiveLength):l={vertexOffset:a.vertexOffset,primitiveLength:a.primitiveLength,vertexLength:a.vertexLength,primitiveOffset:a.primitiveOffset,sortKey:void 0,vaos:{}}}return l&&n.segments.push(l),n}encodeCentroid(e,t){const r=e.centroid(),n=t.span(),i=Math.min(7,Math.round(n.x*this.tileToMeter/10)),o=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new Be(Oe(r.x,1,Nn-1)<<3|i,Oe(r.y,1,Nn-1)<<3|o)}encodeBorderCentroid(e){if(!e.borders)return new Be(0,0);const t=e.borders,r=Number.MAX_VALUE;if(t[0][0]!==r||t[1][0]!==r){const e=t[0][0]!==r?0:1;return new Be(6|(t[0][0]!==r?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==r?2:3;return new Be((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==r?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=2147483647,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,n=e.flags&nA?rA:e.centroidXY,i=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==n.y||i!==n.x){for(let e=t;e<r;++e)this.centroidVertexArray.emplace(e,n.x,n.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t,r){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());if(Qh(this.activeReplacements,n))return;if(this.activeReplacements=n,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const o of this.centroidData)o.flags&=2147483647;const i=[];for(const o of this.activeReplacements){if(o.order<r)continue;const t=Math.max(1,Math.pow(2,o.footprintTileId.canonical.z-e.canonical.z));if(o.footprint.buildingIds)for(const e of this.centroidData)e.flags&nA||o.min.x>e.max.x||e.min.x>o.max.x||o.min.y>e.max.y||e.min.y>o.max.y||o.footprint.buildingIds.has(e.buildingId)&&(e.flags|=nA);else for(const r of this.centroidData)if(!(r.flags&nA||o.min.x>r.max.x||r.min.x>o.max.x||o.min.y>r.max.y||r.min.y>o.max.y))for(let n=0;n<r.footprintSegLen;n++){const a=this.footprintSegments[r.footprintSegIdx+n];if(i.length=0,SA(this.footprintVertices,a.vertexOffset,a.vertexCount,o.footprintTileId.canonical,e.canonical,i),Gh(o.footprint,i,this.footprintIndices.uint16,a.indexOffset,a.indexCount,-a.vertexOffset,-t)){r.flags|=nA;break}}}for(const o of this.centroidData)this.writeCentroidToBuffer(o);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,r){let n=!1;for(let i=0;i<r.footprintSegLen;i++){const o=this.footprintSegments[r.footprintSegIdx+i];let a=0;for(const r of o.ringIndices){for(let i=a,s=r+a-1;i<r+a;s=i++){const r=this.footprintVertices.int16[2*(i+o.vertexOffset)+0],a=this.footprintVertices.int16[2*(i+o.vertexOffset)+1],l=this.footprintVertices.int16[2*(s+o.vertexOffset)+1];a>t!=l>t&&e<(this.footprintVertices.int16[2*(s+o.vertexOffset)+0]-r)*(t-a)/(l-a)+r&&(n=!n)}a=r}}return n}getHeightAtTileCoord(e,t){let r=Number.NEGATIVE_INFINITY,n=!0;const i=4*(e+Nn)*Nn+(t+Nn);if(this.partLookup.hasOwnProperty(i)){const e=this.partLookup[i];return e?{height:e.height,hidden:!!(e.flags&nA)}:void 0}for(const o of this.centroidData)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||o.height<=r||this.footprintContainsPoint(e,t,o)&&(r=o.height,this.partLookup[i]=o,n=!!(o.flags&nA));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:n};this.partLookup[i]=void 0}}function yA(e,t){const r=e.add(t)._unit();return e.x*r.x+e.y*r.y}function _A(e,t,r,n){const i=t.sub(e)._perp()._unit(),o=r.sub(t)._perp()._unit();return vA(e,t,r,yA(i,o),n)}function vA(e,t,r,n,i){const o=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(r)/3,i*o/n)}function xA(e,t,r){return e.x<r[0].x&&t.x<r[0].x||e.x>r[1].x&&t.x>r[1].x||e.y<r[0].y&&t.y<r[0].y||e.y>r[1].y&&t.y>r[1].y}function wA(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function bA(e,t,r){if(e.x<0||e.x>=Nn||t.x<0||t.x>=Nn||r.x<0||r.x>=Nn)return!1;const n=r.sub(t),i=n.perp(),o=e.sub(t);return(n.x*o.x+n.y*o.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(o.x*o.x+o.y*o.y))>-.866&&i.x*o.x+i.y*o.y<0}function BA(e,t,r){const n=t?2|e:-3&e;return r?1|n:-2&n}function CA(){const e=Math.PI/32,t=Math.tan(e),r=rc;return r*Math.sqrt(1+2*t*t)-r}function EA(e,t,r){const n=1<<r.z,i=hc(r.x/n),o=hc((r.x+1)/n),a=Ac(r.y/n),s=Ac((r.y+1)/n);return function(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,o=arguments.length>5?arguments[5]:void 0;const a=[];if(!e.length||!r||!n)return a;const s=(e,t)=>{for(const r of e)a.push({polygon:r,bounds:t})},l=Math.ceil(Math.log2(r)),c=Math.ceil(Math.log2(n)),u=l-c,d=[];for(let f=0;f<Math.abs(u);f++)d.push(u>0?0:1);for(let f=0;f<Math.min(l,c);f++)d.push(0),d.push(1);let h=e;if(h=fh(h,t[0].y-i,t[1].y+i,1),h=fh(h,t[0].x-i,t[1].x+i,0),!h.length)return a;const A=[];for(d.length?A.push({polygons:h,bounds:t,depth:0}):s(h,t);A.length;){const e=A.pop(),t=e.depth,r=d[t],n=e.bounds[0],a=e.bounds[1],l=0===r?n.x:n.y,c=0===r?a.x:a.y,u=o?o(r,l,c):.5*(l+c),h=fh(e.polygons,l-i,u+i,r),f=fh(e.polygons,u-i,c+i,r);if(h.length){const e=[n,new Be(0===r?u:a.x,1===r?u:a.y)];d.length>t+1?A.push({polygons:h,bounds:e,depth:t+1}):s(h,e)}if(f.length){const e=[new Be(0===r?u:n.x,1===r?u:n.y),a];d.length>t+1?A.push({polygons:f,bounds:e,depth:t+1}):s(f,e)}}return a}(e,t,Math.ceil((o-i)/11.25),Math.ceil((a-s)/11.25),1,(e,t,i)=>{if(0===e)return.5*(t+i);{const e=Ac((r.y+t/Nn)/n);return(uc(.5*(Ac((r.y+i/Nn)/n)+e))*n-r.y)*Nn}})}function SA(e,t,r,n,i,o){const a=Math.pow(2,n.z-i.z);for(let s=0;s<r;s++){let r=e.int16[2*(s+t)+0],l=e.int16[2*(s+t)+1];r=(r+i.x*Nn)*a-n.x*Nn,l=(l+i.y*Nn)*a-n.y*Nn,o.push(new Be(r,l))}}let TA,IA;ea(gA,"FillExtrusionBucket",{omit:["layers","features"]}),ea(dA,"PartData"),ea(uA,"FootprintSegment"),ea(hA,"BorderCentroidData"),ea(mA,"GroundEffect");class FA extends Be{constructor(e,t,r){super(e,t),this.z=r}}class kA extends FA{constructor(e,t,r,n){super(e,t,r),this.w=n}}function PA(e,t,r,n){const i="x"===r?"y":"x",o=(n-e[r])/(t[r]-e[r]);e[i]=Math.round(e[i]+(t[i]-e[i])*o),e[r]=n,e.hasOwnProperty("z")&&(e.z=hr(e.z,t.z,o)),e.hasOwnProperty("w")&&(e.w=hr(e.w,t.w,o))}function MA(e,t,r,n){const i=r,o=n;for(const a of["x","y"]){let r=e,n=t;r[a]>=n[a]&&(r=t,n=e),r[a]<i&&n[a]>i&&PA(r,n,a,i),r[a]<o&&n[a]>o&&PA(n,r,a,o)}}function OA(e,t,r,n,i,o){const a=[];for(let s=0;s<e.length;s++){const l=e[s];let c;const u=a.length;let d=0;for(let e=0;e<l.length-1;e++){let u=l[e],h=l[e+1],A=0;const f=d;let p,m;o&&(A=Math.hypot(h.x-u.x,h.y-u.y),d+=A,p=u,m=h),u.x<t&&h.x<t||(u.x<t?u=new Be(t,u.y+(t-u.x)/(h.x-u.x)*(h.y-u.y))._round():h.x<t&&(h=new Be(t,u.y+(t-u.x)/(h.x-u.x)*(h.y-u.y))._round()),u.y<r&&h.y<r||(u.y<r?u=new Be(u.x+(r-u.y)/(h.y-u.y)*(h.x-u.x),r)._round():h.y<r&&(h=new Be(u.x+(r-u.y)/(h.y-u.y)*(h.x-u.x),r)._round()),u.x>=n&&h.x>=n||(u.x>=n?u=new Be(n,u.y+(n-u.x)/(h.x-u.x)*(h.y-u.y))._round():h.x>=n&&(h=new Be(n,u.y+(n-u.x)/(h.x-u.x)*(h.y-u.y))._round()),u.y>=i&&h.y>=i||(u.y>=i?u=new Be(u.x+(i-u.y)/(h.y-u.y)*(h.x-u.x),i)._round():h.y>=i&&(h=new Be(u.x+(i-u.y)/(h.y-u.y)*(h.x-u.x),i)._round()),c&&u.equals(c[c.length-1])||(c=[u],a.push(c),o&&o.push({progress:{min:f+DA(p,m,u)*A,max:1},parentIndex:s,prevPoint:p,nextPoint:m})),c.push(h),o&&(o[o.length-1].progress.max=f+DA(p,m,h)*A,o[o.length-1].nextPoint=m)))))}if(o&&d>0)for(let e=u;e<a.length;e++)o[e].progress.min/=d,o[e].progress.max/=d}return a}function LA(e,t,r,n,i){if(e.length<2)return void n.push(e);const o=[];for(;t.valid();){const[r,n]=t.get();for(let t=0;t<e.length-1;t++){const i=e[t],a=e[t+1],s=du(i,a,r,n);if(s){const[e]=s,r=new Be(hr(i.x,a.x,e),hr(i.y,a.y,e));o.push({t:t+e,distance:0,point:r})}}t.next()}if(0===o.length)return void n.push(e);o.sort((e,t)=>e.t-t.t);let a=0,s=0,l=[];for(n.push(l);a!==e.length;){if(s===o.length){for(;a!==e.length;)0!==l.length&&l[l.length-1].equals(e[a])||l.push(e[a]),a++;break}o[s].t<=a?(0!==l.length&&l[l.length-1].equals(o[s].point)||l.push(o[s].point),Math.trunc(o[s].t),s++):(0!==l.length&&l[l.length-1].equals(e[a])||l.push(e[a]),a++)}}function DA(e,t,r){return e.x!==t.x?(r.x-e.x)/(t.x-e.x):e.y!==t.y?(r.y-e.y)/(t.y-e.y):0}function UA(e,t){return e.x*t.x+e.y*t.y}function RA(e,t){if(1===e.length){let r=0;const n=t[r++];let i;for(;!i||n.equals(i);)if(i=t[r++],!i)return 1/0;for(;r<t.length;r++){const o=t[r],a=e[0],s=i.sub(n),l=o.sub(n),c=a.sub(n),u=UA(s,s),d=UA(s,l),h=UA(l,l),A=UA(c,s),f=UA(c,l),p=u*h-d*d,m=(h*A-d*f)/p,g=(u*f-d*A)/p,y=n.z*(1-m-g)+i.z*m+o.z*g;if(isFinite(y))return y}return 1/0}{let e=1/0;for(const r of t)e=Math.min(e,r.z);return e}}function zA(e,t,r){let n=1/0;au(r,t)&&(n=RA(r,t[0]));for(let i=0;i<t.length;i++){const o=t[i],a=e[i];for(let e=0;e<o.length-1;e++){const t=o[e],i=[t,o[e+1],a[e+1],a[e],t];iu(r,i)&&(n=Math.min(n,RA(r,i)))}}return n!==1/0&&n}function NA(e,t,r,n,i,o,a,s,l,c,u){return"globe"===e.projection.name?function(e,t,r,n,i,o,a,s,l,c,u){const d=[],h=[],A=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,f=[0,0,0,1],p=[0,0,0,1],m=(e,t,r,n)=>{e[0]=t,e[1]=r,e[2]=n,e[3]=1},g=CA();r>0&&(r+=g),n+=g;for(const y of t){const t=[],g=[];for(const d of y){const h=d.x+i.x,y=d.y+i.y,_=e.projection.projectTilePoint(h,y,u),v=e.projection.upVector(u,d.x,d.y);let x=r,w=n;if(a){const e=jA(h,y,r,n,a,s,l,c);x+=e.base,w+=e.top}0!==r?m(f,_.x+v[0]*A*x,_.y+v[1]*A*x,_.z+v[2]*A*x):m(f,_.x,_.y,_.z),m(p,_.x+v[0]*A*w,_.y+v[1]*A*w,_.z+v[2]*A*w),Q(f,f,o),Q(p,p,o),t.push(new FA(f[0],f[1],f[2])),g.push(new FA(p[0],p[1],p[2]))}d.push(t),h.push(g)}return[d,h]}(e,t,r,n,i,o,a,s,l,c,u):a?function(e,t,r,n,i,o,a,s,l){const c=[],u=[],d=[0,0,0,1];for(const h of e){const e=[],A=[];for(const c of h){const u=c.x+n.x,h=c.y+n.y,f=jA(u,h,t,r,o,a,s,l);d[0]=u,d[1]=h,d[2]=f.base,d[3]=1,$(d,d,i),d[3]=Math.max(d[3],1e-5);const p=new FA(d[0]/d[3],d[1]/d[3],d[2]/d[3]);d[0]=u,d[1]=h,d[2]=f.top,d[3]=1,$(d,d,i),d[3]=Math.max(d[3],1e-5);const m=new FA(d[0]/d[3],d[1]/d[3],d[2]/d[3]);e.push(p),A.push(m)}c.push(e),u.push(A)}return[c,u]}(t,r,n,i,o,a,s,l,c):function(e,t,r,n,i){const o=[],a=[],s=i[8]*t,l=i[9]*t,c=i[10]*t,u=i[11]*t,d=i[8]*r,h=i[9]*r,A=i[10]*r,f=i[11]*r;for(const p of e){const e=[],t=[];for(const r of p){const o=r.x+n.x,a=r.y+n.y,p=i[0]*o+i[4]*a+i[12],m=i[1]*o+i[5]*a+i[13],g=i[2]*o+i[6]*a+i[14],y=i[3]*o+i[7]*a+i[15],_=p+s,v=m+l,x=g+c,w=Math.max(y+u,1e-5),b=p+d,B=m+h,C=g+A,E=Math.max(y+f,1e-5);e.push(new FA(_/w,v/w,x/w)),t.push(new FA(b/E,B/E,C/E))}o.push(e),a.push(t)}return[o,a]}(t,r,n,i,o)}function jA(e,t,r,n,i,o,a,s){const l=a*i.getElevationAt(e,t,!0,!0),c=0!==o[0],u=c?0===o[1]?a*(o[0]/iA-oA):a*function(e,t,r){const n=Math.floor(t[0]/8),i=Math.floor(t[1]/8),o=10*(t[0]-8*n),a=10*(t[1]-8*i),s=e.getElevationAt(n,i,!0,!0),l=e.getMeterToDEM(r),c=Math.floor(.5*(o*l-1)),u=Math.floor(.5*(a*l-1)),d=e.tileCoordToPixel(n,i),h=2*c+1,A=2*u+1,f=function(e,t,r,n,i){return[e.getElevationAtPixel(t,r,!0),e.getElevationAtPixel(t+i,r,!0),e.getElevationAtPixel(t,r+i,!0),e.getElevationAtPixel(t+n,r+i,!0)]}(e,d.x-c,d.y-u,h,A),p=Math.abs(f[0]-f[1]),m=Math.abs(f[2]-f[3]),g=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*l*(p+m)/h),_=Math.min(.25,.5*l*g/A);return s+Math.max(y*o,_*a)}(i,o,s):l;return{base:l+(0===r?-1:r),top:c?Math.max(u+n,l+r+2):l+n}}class QA{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class VA{constructor(){this.tasks={},this.taskQueue=[],je(["process"],this),this.invoker=new QA(this.process),this.nextId=0}add(e,t){const r=this.nextId++,n=function(e){let{type:t,isSymbolTile:r,zoom:n}=e;return n=n||0,"message"===t?0:"maybePrepare"!==t||r?"parseTile"!==t||r?"parseTile"===t&&r?300-n:"maybePrepare"===t&&r?400-n:500:200-n:100-n}(t);if(0===n){try{e()}finally{}return null}return this.tasks[r]={fn:e,metadata:t,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(e=>!!this.tasks[e]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let n=0;n<this.taskQueue.length;n++){const r=this.tasks[this.taskQueue[n]];r.priority<t&&(t=r.priority,e=n)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class HA{constructor(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.cancelCallbacks={},je(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new VA}send(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0;const a=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=o,this.callbacks[a]=r);const s=new Set;return this.target.postMessage({id:a,type:e,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:ra(t,s)},s),{cancel:()=>{r&&delete this.callbacks[a],this.target.postMessage({id:a,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const t=e.data;if(!t)return;const r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e.cancel()}else if(t.mustQueue||Ye(self)){const e=this.callbacks[r],n=this.scheduler.add(()=>this.processTask(r,t),e&&e.metadata||{type:"message"});n&&(this.cancelCallbacks[r]=n)}else this.processTask(r,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(na(t.error)):r(null,na(t.data)))}else{const r=new Set,n=t.hasCallback?(t,n)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?ra(t):null,data:ra(n,r)},r)}:()=>{},i=na(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,i,n);else if(this.parent.getWorkerSource){const e=t.type.split("."),{source:r,scope:o}=i;this.parent.getWorkerSource(t.sourceMapId,e[0],r,o)[e[1]](i,n)}else n(new Error("Could not find function ".concat(t.type)))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var GA={workerUrl:"",workerClass:null,workerParams:void 0};const KA="mapboxgl_preloaded_worker_pool";class WA{constructor(e){this.active={},this.name=e}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:WA.workerCount;if(!this.workers)for(this.workers=[];this.workers.length<t;){const t=(r="".concat(this.name||"","WorkerPool: ").concat(e,"-").concat(this.workers.length),null!=GA.workerClass?new GA.workerClass:new self.Worker(GA.workerUrl,Object.assign({name:r},GA.workerParams)));this.workers.push(t)}var r;return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[KA]}numActive(){return Object.keys(this.active).length}}WA.workerCount=2;class qA{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Worker",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:WA.workerCount;this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ze();const i=this.workerPool.acquire(this.id,n);for(let o=0;o<i.length;o++){const e=new qA.Actor(i[o],t,this.id);e.name="".concat(r," ").concat(o),this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,t,r){Ue(this.actors,(r,n)=>{r.send(e,t,n)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let ZA,XA;function YA(){return ZA||(ZA=new WA),ZA}qA.Actor=HA;const JA=4096;class $A{constructor(e){this.module=e,this.memoryStack=this.module.malloc(JA),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const t=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>JA?-1:(new Int32Array(this.module.heap32.buffer,t,e.length).set(e),t)}createFloatArray(e){const t=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>JA?-1:(new Float32Array(this.module.heapF32.buffer,t,e.length).set(e),t)}readStringBuffer(e){let t="";for(;0!==this.module.heapU8[e];)t+=String.fromCharCode(this.module.heapU8[e]),++e;return t}setStyle(e){const t=e.normalScale;this.module.setStyle(t[0],t[1],t[2],e.tileToMeters)}setAOOptions(e,t){this.module.setAOOptions(e?1:0,t)}setMetricOptions(e,t){this.module.setMetricOptions(e?1:0,t)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,t){this.module.setFacadeOptions(e,t?1:0)}setFauxFacadeOptions(e,t,r){this.module.setFauxFacadeOptions(e?1:0,t?1:0,r)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,t){this.memoryStackNextFree=this.memoryStack;for(const a of e){const e=this.createIntArray(a.ringIndices),t=this.createFloatArray(a.coordinates);if(-1===e||-1===t)return"building_gen: Out of stack memory: ".concat(this.memoryStackNextFree-this.memoryStack,"/4096");this.module.addFeature(a.id,a.sourceId,a.minHeight,a.height,a.roofType,t,e,a.ringIndices.length-1)}for(const a of t){let e;e=a.entrances?JSON.parse(a.entrances):[];const t=this.createFloatArray(e),r=this.createFloatArray(a.coordinates);if(-1===t||-1===r)return"building_gen: Out of stack memory: ".concat(this.memoryStackNextFree-this.memoryStack,"/4096");this.module.addFacade(a.sourceId,a.crossPerc,a.distanceToRoad,t,e.length,r,a.coordinates.length)}if(!this.module.generateMesh()){const e=this.module.getLastError();return this.readStringBuffer(e)}const r=this.module.getMeshCount(),n=new Array(r);for(let a=0;a<r;a++){const e=this.module.getPositionsPtr(a),t=this.module.getPositionsLength(a),r=new Float32Array(this.module.heapF32.buffer,e,t),i=this.module.getNormalsPtr(a),o=this.module.getNormalsLength(a),s=new Float32Array(this.module.heapF32.buffer,i,o),l=this.module.getAOPtr(a),c=this.module.getAOLength(a),u=new Float32Array(this.module.heapF32.buffer,l,c),d=this.module.getUVPtr(a),h=this.module.getUVLength(a),A=new Float32Array(this.module.heapF32.buffer,d,h),f=this.module.getFauxFacadePtr(a),p=this.module.getFauxFacadeLength(a),m=new Uint8Array(this.module.heapU8.buffer,f,p),g=this.module.getIndicesPtr(a),y=this.module.getIndicesLength(a),_=new Int16Array(this.module.heap16.buffer,g,y),v=this.module.getBuildingPart(a);n[a]={positions:r,normals:s,ao:u,uv:A,isFauxFacade:m,indices:_,buildingPart:v}}const i=this.module.getRingCount(),o=[];for(let a=0;a<i;a++){const e=this.module.getRingPtr(a),t=this.module.getRingLength(a),r=new Float32Array(this.module.heapF32.buffer,e,t);o.push(r)}return{meshes:n,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:o}}}let ef,tf,rf,nf,of,af=null,sf=null,lf=null,cf=null;function uf(){return Ye(self)&&self.worker.dracoUrl?self.worker.dracoUrl:tf||at.DRACO_URL}function df(){if(Ye(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(nf)return nf;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return nf=WebAssembly.validate(e)?at.MESHOPT_SIMD_URL:at.MESHOPT_URL,nf}function hf(){return cf}const Af={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},ff={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},pf={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function mf(e,t,r){const n=r.json.bufferViews.length,i=r.buffers.length;t.bufferView=n,r.json.bufferViews[n]={buffer:i,byteLength:e.byteLength},r.buffers[i]=e}const gf="KHR_draco_mesh_compression";function yf(e,t){const r=e.extensions&&e.extensions[gf];if(!r)return;const n=new rf.Decoder,i=Cf(t,r.bufferView),o=new rf.Mesh;if(!n.DecodeArrayToMesh(i,i.byteLength,o))throw new Error("Failed to decode Draco mesh");const a=t.json.accessors[e.indices],s=Af[a.componentType],l=a.count*s.BYTES_PER_ELEMENT,c=rf._malloc(l);s===Uint16Array?n.GetTrianglesUInt16Array(o,l,c):n.GetTrianglesUInt32Array(o,l,c),mf(rf.memory.buffer.slice(c,c+l),a,t),rf._free(c);for(const u of Object.keys(r.attributes)){const i=n.GetAttributeByUniqueId(o,r.attributes[u]),a=t.json.accessors[e.attributes[u]],s=ff[a.componentType],l=a.count*pf[a.type]*Af[a.componentType].BYTES_PER_ELEMENT,c=rf._malloc(l);n.GetAttributeDataArrayForAllPoints(o,i,rf[s],l,c),mf(rf.memory.buffer.slice(c,c+l),a,t),rf._free(c)}n.destroy(),o.destroy(),delete e.extensions[gf]}const _f="EXT_meshopt_compression";function vf(e,t){if(!e.extensions||!e.extensions[_f])return;const r=e.extensions[_f],n=new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),i=new Uint8Array(r.count*r.byteStride);of.decodeGltfBuffer(i,r.count,r.byteStride,n,r.mode,r.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=i.buffer,delete e.extensions[_f]}const xf=1179937895,wf=new TextDecoder("utf8");function bf(e,t){return new URL(e,t).href}function Bf(e,t,r,n){return fetch(bf(e.uri,n)).then(e=>e.arrayBuffer()).then(e=>{t.buffers[r]=e})}function Cf(e,t){const r=e.json.bufferViews[t];return new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function Ef(e,t,r,n){if(e.uri){const i=bf(e.uri,n);return fetch(i).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>{t.images[r]=e})}if(void 0!==e.bufferView){const n=Cf(t,e.bufferView),i=new Blob([n],{type:e.mimeType});return createImageBitmap(i).then(e=>{t.images[r]=e})}}function Sf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;const n={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===xf){const r=new Uint32Array(e,t);let i=2;const o=(r[i++]>>2)-3,a=r[i++]>>2;if(i++,n.json=JSON.parse(wf.decode(r.subarray(i,i+a))),i+=a,i<o){const o=r[i++];i++;const a=t+(i<<2);n.buffers[0]=e.slice(a,a+o)}}else n.json=JSON.parse(wf.decode(new Uint8Array(e,t)));const{buffers:i,images:o,meshes:a,extensionsUsed:s,bufferViews:l}=n.json;let c=Promise.resolve();if(i){const e=[];for(let t=0;t<i.length;t++){const o=i[t];o.uri?e.push(Bf(o,n,t,r)):n.buffers[t]||(n.buffers[t]=null)}c=Promise.all(e)}return c.then(()=>{const e=[],t=s&&s.includes(gf),i=s&&s.includes(_f);if(t&&e.push(function(){if(!rf)return null!=ef?ef:(ef=function(e){let t,r=null;function n(){t=new Uint8Array(r.buffer)}function i(){throw new Error("Unexpected Draco error.")}const o={a:{a:i,d:function(e,r,n){return t.copyWithin(e,r,r+n)},c:function(e){const i=t.length,o=Math.max(e>>>0,Math.ceil(1.2*i)),a=Math.ceil((o-i)/65536);try{return r.grow(a),n(),!0}catch(e){return!1}},b:i}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,o):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,o))).then(e=>{const{Rb:i,Qb:o,P:a,T:s,X:l,Ja:c,La:u,Qa:d,Va:h,Wa:A,eb:f,jb:p,f:m,e:g,yb:y,zb:_,Ab:v,Bb:x,Db:w,Gb:b}=e.instance.exports;r=g;const B=(()=>{let e=0,r=0,n=0,a=0;return s=>{n&&(i(a),i(e),r+=n,n=e=0),e||(r+=128,e=o(r));const l=s.length+7&-8;let c=e;l>=r&&(n=l,c=a=o(l));for(let e=0;e<s.length;e++)t[c+e]=s[e];return c}})();return n(),m(),{memory:g,_free:i,_malloc:o,Mesh:class{constructor(){this.ptr=a()}destroy(){s(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){p(this.ptr)}DecodeArrayToMesh(e,t,r){const n=B(e),i=u(this.ptr,n,t,r.ptr);return!!l(i)}GetAttributeByUniqueId(e,t){return{ptr:d(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,r){h(this.ptr,e.ptr,t,r)}GetTrianglesUInt32Array(e,t,r){A(this.ptr,e.ptr,t,r)}GetAttributeDataArrayForAllPoints(e,t,r,n,i){f(this.ptr,e.ptr,t.ptr,r,n,i)}},DT_INT8:y(),DT_UINT8:_(),DT_INT16:v(),DT_UINT16:x(),DT_UINT32:w(),DT_FLOAT32:b()}})}(fetch(uf())),ef.then(e=>{rf=e,ef=void 0}))}()),i&&e.push(function(){if(of)return;const e=function(e){let t;const r=WebAssembly.instantiateStreaming(e,{}).then(e=>{t=e.instance,t.exports.__wasm_call_ctors()}),n={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},i={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:r,supported:!0,decodeGltfBuffer(e,r,o,a,s,l){!function(e,t,r,n,i,o,a){const s=e.exports.sbrk,l=n+3&-4,c=s(l*i),u=s(o.length),d=new Uint8Array(e.exports.memory.buffer);d.set(o,u);const h=t(c,n,i,u,o.length);if(0===h&&a&&a(c,l,i),r.set(d.subarray(c,c+n*i)),s(c-s(0)),0!==h)throw new Error("Malformed buffer data: ".concat(h))}(t,t.exports[i[s]],e,r,o,a,t.exports[n[l]])}}}(fetch(df()));return e.ready.then(()=>{of=e})}()),o)for(let a=0;a<o.length;a++)e.push(Ef(o[a],n,a,r));return(e.length?Promise.all(e):Promise.resolve()).then(()=>{if(t&&a)for(const{primitives:e}of a)for(const t of e)yf(t,n);if(i&&a&&l)for(const e of l)vf(e,n);return n})})}function Tf(e){return fetch(e).then(e=>e.arrayBuffer()).then(t=>Sf(t,0,e))}function If(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Ff(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class kf{constructor(e,t,r,n){this.context=e,this.format=r,this.useMipmap=n&&n.useMipmap,this.texture=e.gl.createTexture(),this.update(t,{premultiply:n&&n.premultiply})}update(e,t){const r=e&&e instanceof HTMLVideoElement&&0===e.width?e.videoWidth:e.width,n=e&&e instanceof HTMLVideoElement&&0===e.height?e.videoHeight:e.height,{context:i}=this,{gl:o}=i,{x:a,y:s}=t&&t.position?t.position:{x:0,y:0},l=a+r,c=s+n;!this.size||this.size[0]===l&&this.size[1]===c||(o.bindTexture(o.TEXTURE_2D,null),o.deleteTexture(this.texture),this.texture=o.createTexture(),this.size=null),o.bindTexture(o.TEXTURE_2D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(this.format===o.RGBA8&&(!t||!1!==t.premultiply));const u=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&l>0&&c>0){const e=this.useMipmap?Math.floor(Math.log2(Math.max(l,c)))+1:1;o.texStorage2D(o.TEXTURE_2D,e,this.format,l,c),this.size=[l,c]}this.size&&(u?o.texSubImage2D(o.TEXTURE_2D,0,a,s,If(this.format),Ff(this.format),e):"data"in e&&e.data&&o.texSubImage2D(o.TEXTURE_2D,0,a,s,r,n,If(this.format),Ff(this.format),e.data)),this.useMipmap&&o.generateMipmap(o.TEXTURE_2D)}bind(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap&&!r?e===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,r,n,i){const{context:o}=this,{gl:a}=o;a.bindTexture(a.TEXTURE_2D,this.texture),t!==this.magFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,this.useMipmap?e===a.NEAREST?a.NEAREST_MIPMAP_NEAREST:a.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),this.wrapS=r),n!==this.wrapT&&(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,n),this.wrapT=n),i!==this.compareMode&&(i?(a.texParameteri(a.TEXTURE_2D,a.TEXTURE_COMPARE_MODE,a.COMPARE_REF_TO_TEXTURE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_COMPARE_FUNC,i)):a.texParameteri(a.TEXTURE_2D,a.TEXTURE_COMPARE_MODE,a.NONE),this.compareMode=i)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Pf{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}}const Mf=ds([{name:"a_pos_3f",components:3,type:"Float32"}]),Of=ds([{name:"a_color_3f",components:3,type:"Float32"}]),Lf=ds([{name:"a_color_4f",components:4,type:"Float32"}]),Df=ds([{name:"a_uv_2f",components:2,type:"Float32"}]),Uf=ds([{name:"a_normal_3f",components:3,type:"Float32"}]),Rf=ds([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),zf=ds([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function Nf(e,t){const r=Qf(e.projection,e.zoom,e.width,e.height),n=function(e,t,r,n,i){const o=new ic(r.lng-180*Vf,r.lat),a=new ic(r.lng+180*Vf,r.lat),s=e.project(o.lng,o.lat),l=e.project(a.lng,a.lat),u=-Math.atan2(l.y-s.y,l.x-s.x),h=vc.fromLngLat(r);h.y=Oe(h.y,-1+Vf,1-Vf);const f=h.toLngLat(),p=e.project(f.lng,f.lat),g=vc.fromLngLat(f);g.x+=Vf;const y=g.toLngLat(),_=e.project(y.lng,y.lat),v=Gf(_.x-p.x,_.y-p.y,u),x=vc.fromLngLat(f);x.y+=Vf;const w=x.toLngLat(),b=e.project(w.lng,w.lat),B=Gf(b.x-p.x,b.y-p.y,u),C=Math.abs(v.x)/Math.abs(B.y),E=c([]);m(E,E,-u*(1-(i?0:n)));const S=c([]);return A(S,S,[1,1-(1-C)*n,1]),S[4]=-B.x/B.y*n,m(S,S,u),d(S,E,S),S}(e.projection,0,e.center,r,t),i=jf(e);return A(n,n,[i,i,1]),n}function jf(e){const t=e.projection,r=Qf(e.projection,e.zoom,e.width,e.height),n=Hf(t,e.center),i=Hf(t,ic.convert(t.center));return Math.pow(2,n*r+(1-r)*i)}function Qf(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const o=e.range;if(!o)return 0;const a=Math.min(i,Math.max(r,n)),s=Math.log2(a/1024);return Le(o[0]+s,o[1]+s,t)}const Vf=1/4e4;function Hf(e,t){const r=Oe(t.lat,-pc,pc),n=new ic(t.lng-180*Vf,r),i=new ic(t.lng+180*Vf,r),o=e.project(n.lng,r),a=e.project(i.lng,r),s=vc.fromLngLat(n),l=vc.fromLngLat(i),c=a.x-o.x,u=a.y-o.y,d=l.x-s.x,h=l.y-s.y,A=Math.sqrt((d*d+h*h)/(c*c+u*u));return Math.log2(A)}function Gf(e,t,r){const n=Math.cos(r),i=Math.sin(r);return{x:e*n-t*i,y:e*i+t*n}}function Kf(e,t,r){c(e),m(e,e,Te(t[2])),f(e,e,Te(t[0])),p(e,e,Te(t[1])),A(e,e,r),d(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Wf(e,t,r,n,i,o,a,s){const l=[r[0]-t[0],r[1]-t[1],0],c=[n[0]-t[0],n[1]-t[1],0];if(B(l)<1e-12||B(c)<1e-12)return te(e);const u=N([],l,c);R(u,u),T(c,n,t),l[2]=(o-i)*s,c[2]=(a-i)*s;const d=l;return N(d,l,c),R(d,d),le(e,u,d)}function qf(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=td(t.zoom),i=function(e,t,r){const n=t.worldSize,i=[e[12],e[13],e[14]],o=Ac(i[1]/n),a=hc(i[0]/n),s=c([]),l=dc(1,o)*n,u=dc(1,0)*n*gc(o,t.zoom),f=1/Ju(n);let p=u*f;if(r){const e=Qf(t.projection,t.zoom,t.width,t.height,1024);p=f*t.projection.pixelSpaceConversion(t.center.lat,n,e)}const m=tc(o,a);S(m,m,P([],R([],m),l*p*i[2]));const g=function(e){const t=[e[0],e[1],e[2]];let r=[0,1,0];const n=N([],r,t);return N(r,t,n),0===D(r)&&(r=[0,1,0],N(n,t,r)),R(n,n),R(r,r),R(t,t),[n[0],n[1],n[2],0,r[0],r[1],r[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(m);A(s,s,[p,p,p*l]),h(s,s,[-i[0],-i[1],-i[2]]);const y=d([],t.globeMatrix,g);return d(y,y,s),d(y,y,e),y}(e,t,r);if(n>0){const r=function(e,t){const r=t.worldSize,n=dc(1,0)*r*gc(t.center.lat,t.zoom)/Ju(r),i=dc(1,t.center.lat)*r,o=c([]);p(o,o,Te(t.center.lng)),f(o,o,Te(t.center.lat)),h(o,o,[0,0,Kl]),A(o,o,[n,n,n*i]);const a=t.point;return h(o,o,[-a.x,-a.y,0]),d(o,o,e),d(o,t.globeMatrix,o)}(e,t);return function(e,t,r){const n=(e,t,r)=>{const n=B(e),i=B(t),o=Qu(e,t,r);return P(o,o,1/B(o)*hr(n,i,r))},i=n([e[0],e[1],e[2]],[t[0],t[1],t[2]],r),o=n([e[4],e[5],e[6]],[t[4],t[5],t[6]],r),a=n([e[8],e[9],e[10]],[t[8],t[9],t[10]],r),s=Qu([e[12],e[13],e[14]],[t[12],t[13],t[14]],r);return[i[0],i[1],i[2],0,o[0],o[1],o[2],0,a[0],a[1],a[2],0,s[0],s[1],s[2],1]}(i,r,n)}return i}function Zf(e,t,r,n){const i=Jc.projectAabbCorners(n,r);let o=Number.MAX_VALUE;for(let s=0;s<i.length;++s){const e=i[s];e[0]=(.5*e[0]+.5)*t.width,e[1]=(.5-.5*e[1])*t.height,e[2]<o&&(o=e[2])}const a=function(e){const t=[];let r=0;for(let a=1;a<e.length;a++)(e[a][0]<e[r][0]||e[a][0]===e[r][0]&&e[a][1]<e[r][1])&&(r=a);let n,i=r;const o=new Uint8Array(e.length);do{if(o[i])break;t.push(new Be(e[i][0],e[i][1])),o[i]=1,n=(i+1)%e.length;for(let t=0;t<e.length;t++){if(e[t][0]===e[n][0]&&e[t][1]===e[n][1]||e[t][0]===e[i][0]&&e[t][1]===e[i][1])continue;const r=[e[t][0]-e[i][0],e[t][1]-e[i][1]],o=[e[n][0]-e[i][0],e[n][1]-e[i][1]],a=r[0]*o[1]-r[1]*o[0];(a>0||0===a&&r[0]*o[0]+r[1]*o[1]>=0&&r[0]*r[0]+r[1]*r[1]>o[0]*o[0]+o[1]*o[1])&&(n=t)}i=n}while(i!==r);return t.length>0&&t.push(t[0]),t}(i);if(iu(e,a))return o}const Xf=64,Yf={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Jf(e,t,r,n,i,o,a,s,l){let u=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const f=r.zoom,p=r.project(n),m=gc(n.lat,f),g=1/m;c(e),h(e,e,[p.x+a[0]*g,p.y+a[1]*g,a[2]]);let y=1,_=1;const x=r.worldSize;if(u){if("mercator"===r.projection.name){let e=0;r.elevation&&(e=r.elevation.getAtPointOrZero(new vc(p.x/x,p.y/x),0));const t=$([],[p.x,p.y,e,1],r.projMatrix)[3]/r.cameraToCenterDistance;y=t,_=t*gc(r.center.lat,f)}else if("globe"===r.projection.name){const t=qf(e,r),i=[0,0,0,1];$(i,i,d([],r.projMatrix,t));const o=i[3]/r.cameraToCenterDistance,a=td(f),s=r.projection.pixelsPerMeter(n.lat,x)*gc(n.lat,f),l=r.projection.pixelsPerMeter(r.center.lat,x)*gc(r.center.lat,f);y=o/hr(s,mc(r.center.lat),a),_=o*m/s,y*=l,_*=l}}else y=g;A(e,e,[y,y,_]);const w=[...e],b=t.orientation,B=[];if(Kf(B,[b[0]+(i?i[0]:0),b[1]+(i?i[1]:0),b[2]+(i?i[2]:0)],o),d(e,w,B),s&&r.elevation){let i=0;const o=[];if(l&&r.elevation){i=function(e,t,r,n,i){const o=t.elevation;if(!o)return 0;const a=Jc.projectAabbCorners(r,n),s=dc(1,i.lat)*t.worldSize,l=function(e,t){const r=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const i of n){const n=e[i.corners[0]],o=e[i.corners[1]],a=e[i.corners[2]],s=[o[0]-n[0],o[1]-n[1],t*(o[2]-n[2])],l=N(s,s,[a[0]-n[0],a[1]-n[1],t*(a[2]-n[2])]);R(l,l),i.dotProductWithUp=z(l,r)}return n.sort((e,t)=>e.dotProductWithUp-t.dotProductWithUp),n[0].corners}(a,s),c=a[l[0]],u=a[l[1]],d=a[l[2]],h=a[l[3]],A=o.getAtPointOrZero(new vc(c[0]/t.worldSize,c[1]/t.worldSize),0),f=o.getAtPointOrZero(new vc(u[0]/t.worldSize,u[1]/t.worldSize),0),p=o.getAtPointOrZero(new vc(d[0]/t.worldSize,d[1]/t.worldSize),0),m=o.getAtPointOrZero(new vc(h[0]/t.worldSize,h[1]/t.worldSize),0),g=(A+m)/2,y=(f+p)/2;return g>y?f<p?Wf(e,u,h,c,f,m,A,s):Wf(e,d,c,h,p,A,m,s):A<m?Wf(e,c,u,d,A,f,p,s):Wf(e,h,d,u,m,p,f,s),Math.max(g,y)}(o,r,t.aabb,e,n);const a=d([],v([],o),B);d(e,w,a)}else i=r.elevation.getAtPointOrZero(new vc(p.x/x,p.y/x),0);0!==i&&(e[14]+=i)}}class $f{constructor(e,t,r,n,i){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=t,this.position=null!=r?new ic(r[0],r[1]):new ic(0,0),this.orientation=null!=n?n:[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new Jc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){d(e.globalMatrix,t,e.localMatrix);const r=this.nodeOverrides.get(e.name);if(void 0!==r){const t=[];i=r.orientation,c(n=t),p(n,n,Te(i[1])),m(n,n,Te(i[2])),f(n,n,Te(i[0])),d(e.globalMatrix,e.globalMatrix,t)}var n,i;if(e.meshes)for(const o of e.meshes){const t=Jc.applyTransformFast(o.aabb,e.globalMatrix);this.aabb.encapsulate(t)}if(e.children)for(const o of e.children)this._applyTransformations(o,e.globalMatrix)}computeBoundsAndApplyParent(){const e=c([]);this.aabb=new Jc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(e,t,r,n,i,o){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Jf(this.matrix,this,e.transform,this.position,t,r,n,i,o,a)}upload(e){if(!this.uploaded){for(const t of this.nodes)rp(t,e);for(const e of this.nodes)np(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)ip(e)}}function ep(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new kf(t,e.image,r?t.gl.R8:t.gl.RGBA8,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function tp(e,t,r){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,Mf.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,Uf.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,Df.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?Of:Lf).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,zf.members,!0)),e.segments=dl.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const n=e.material;n.pbrMetallicRoughness.baseColorTexture&&ep(n.pbrMetallicRoughness.baseColorTexture,t),n.pbrMetallicRoughness.metallicRoughnessTexture&&ep(n.pbrMetallicRoughness.metallicRoughnessTexture,t),n.normalTexture&&ep(n.normalTexture,t),n.occlusionTexture&&ep(n.occlusionTexture,t,r),n.emissionTexture&&ep(n.emissionTexture,t)}function rp(e,t,r){if(e.meshes)for(const n of e.meshes)tp(n,t,r);if(e.children)for(const n of e.children)rp(n,t,r)}function np(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)np(t)}function ip(e){if(e.meshes)for(const r of e.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const r of e.children)ip(r)}function op(e,t){const r=e.json.bufferViews[t.bufferView],n=Af[t.componentType];return new n(e.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*(r.byteStride&&r.byteStride!==pf[t.type]*n.BYTES_PER_ELEMENT?r.byteStride/n.BYTES_PER_ELEMENT:pf[t.type]))}function ap(e,t,r,n){const i=Af[t.componentType],o=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(i),a=e.json.bufferViews[t.bufferView],s=a.byteStride?a.byteStride/i.BYTES_PER_ELEMENT:pf[t.type],l=r.float32,c=l.length/r.capacity;for(let u=0,d=0;u<t.count*s;u+=s,d+=c)for(let e=0;e<c;e++)l[d+e]=n[u+e]*o;r._trim()}function sp(e,t,r){const n=e.indices,i=e.attributes,o={};o.indexArray=new Os;const a=t.json.accessors[n],s=a.count/3;o.indexArray.reserve(s);const l=op(t,a);for(let h=0;h<s;h++)o.indexArray.emplaceBack(l[3*h],l[3*h+1],l[3*h+2]);o.indexArray._trim(),o.vertexArray=new xs;const c=t.json.accessors[i.POSITION];o.vertexArray.reserve(c.count);const u=op(t,c);for(let h=0;h<c.count;h++)o.vertexArray.emplaceBack(u[3*h],u[3*h+1],u[3*h+2]);if(o.vertexArray._trim(),o.aabb=new Jc(c.min,c.max),o.centroid=function(e,t){const r=[0,0,0],n=e.length;if(n>0){for(let i=0;i<n;i++){const n=3*e[i];r[0]+=t[n],r[1]+=t[n+1],r[2]+=t[n+2]}r[0]/=n,r[1]/=n,r[2]/=n}return r}(l,u),void 0!==i.COLOR_0){const e=t.json.accessors[i.COLOR_0],r=pf[e.type],n=op(t,e);o.colorArray=3===r?new xs:new Ss,o.colorArray.resize(e.count),ap(t,e,o.colorArray,n)}if(void 0!==i.NORMAL){o.normalArray=new xs;const e=t.json.accessors[i.NORMAL];o.normalArray.resize(e.count);const r=op(t,e);ap(t,e,o.normalArray,r)}if(void 0!==i.TEXCOORD_0&&r.length>0){o.texcoordArray=new Qs;const e=t.json.accessors[i.TEXCOORD_0];o.texcoordArray.resize(e.count);const r=op(t,e);ap(t,e,o.texcoordArray,r)}if(void 0!==i._FEATURE_ID_RGBA4444){const e=t.json.accessors[i._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(o.featureData=op(t,e))}void 0!==i._FEATURE_RGBA4444&&(o.featureData=new Uint32Array(op(t,t.json.accessors[i._FEATURE_RGBA4444]).buffer));const d=e.material;return o.material=function(e,t){const{emissiveFactor:r=[0,0,0],alphaMode:n="OPAQUE",alphaCutoff:i=.5,normalTexture:o,occlusionTexture:a,emissiveTexture:s,doubleSided:l,name:c}=e,{baseColorFactor:u=[1,1,1,1],metallicFactor:d=1,roughnessFactor:h=1,baseColorTexture:A,metallicRoughnessTexture:f}=e.pbrMetallicRoughness||{},p=a?t[a.index]:void 0;if(a&&a.extensions&&a.extensions.KHR_texture_transform&&p){const e=a.extensions.KHR_texture_transform;p.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{name:c,pbrMetallicRoughness:{baseColorFactor:new lr(...u),metallicFactor:d,roughnessFactor:h,baseColorTexture:A?t[A.index]:void 0,metallicRoughnessTexture:f?t[f.index]:void 0},doubleSided:l,emissiveFactor:new lr(...r),alphaMode:n,alphaCutoff:i,normalTexture:o?t[o.index]:void 0,occlusionTexture:p,emissionTexture:s?t[s.index]:void 0,defined:void 0===e.defined}}(void 0!==d?t.json.materials[d]:{defined:!1},r),o}function lp(e,t,r){const{matrix:n,rotation:i,translation:o,scale:a,mesh:s,extras:c,children:u,name:d}=e,h={};if(h.name=d,h.localMatrix=n||function(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=t[3],l=i+i,c=o+o,u=a+a,d=i*l,h=i*c,A=i*u,f=o*c,p=o*u,m=a*u,g=s*l,y=s*c,_=s*u,v=n[0],x=n[1],w=n[2];return e[0]=(1-(f+m))*v,e[1]=(h+_)*v,e[2]=(A-y)*v,e[3]=0,e[4]=(h-_)*x,e[5]=(1-(d+m))*x,e[6]=(p+g)*x,e[7]=0,e[8]=(A+y)*w,e[9]=(p-g)*w,e[10]=(1-(d+f))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}([],i||[0,0,0,1],o||[0,0,0],a||[1,1,1]),h.globalMatrix=l(h.localMatrix),void 0!==s){h.meshes=r[s];const e=h.anchor=[0,0];for(const t of h.meshes){const{min:r,max:n}=t.aabb;e[0]+=r[0]+n[0],e[1]+=r[1]+n[1]}e[0]=Math.floor(e[0]/h.meshes.length/2),e[1]=Math.floor(e[1]/h.meshes.length/2)}if(c&&(c.id&&(h.id=c.id),c.lights&&(h.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.codePointAt(n);return r}(e),r=[],n=t.length/24,i=new Uint16Array(t.buffer),o=new Float32Array(t.buffer);for(let a=0;a<n;a++){const e=i[2*a*6]/30,t=i[2*a*6+1]/30,n=i[2*a*6+10]/100,s=o[6*a+1],l=o[6*a+2],c=o[6*a+3],u=o[6*a+4],d=c-s,h=u-l,A=Math.hypot(d,h);r.push({pos:[s+.5*d,l+.5*h,t],normal:[h/A,-d/A,0],width:A,height:e,depth:n,points:[s,l,c,u]})}return r}(c.lights)),c.MAPBOX_geometry_bloom&&(h.isGeometryBloom=c.MAPBOX_geometry_bloom)),u){const e=[];for(const n of u)e.push(lp(t.json.nodes[n],t,r));h.children=e}return h}function cp(e){if(0===e.vertices.length||0===e.indices.length)return null;const t=new Ch(e.vertices,e.indices,8,256),[r,n]=[t.min.clone(),t.max.clone()];return{vertices:e.vertices,indices:e.indices,grid:t,min:r,max:n}}function up(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const r=t[0];if(!r||!Array.isArray(r)||0===r.length)return null;const n=[];for(const a of r){if(!Array.isArray(a)||2!==a.length)continue;const e=a[0],t=a[1];"number"==typeof e&&"number"==typeof t&&n.push(new Be(e,t))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let i=0;for(let a=0;a<n.length;a++){const e=n[a],t=n[(a+1)%n.length],r=n[(a+2)%n.length];i+=(e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)}i>0&&n.reverse();const o=Fd(n.flatMap(e=>[e.x,e.y]),[]);return 0===o.length?null:{vertices:n,indices:o}}function dp(e,t){const r=[],n=[];let i=0;const o=[];for(const a of e){i=r.length;const e=a.vertexArray.float32,s=a.indexArray.uint16;for(let n=0;n<a.vertexArray.length;n++)o[0]=e[3*n+0],o[1]=e[3*n+1],o[2]=e[3*n+2],Q(o,o,t),r.push(new Be(o[0],o[1]));for(let t=0;t<3*a.indexArray.length;t++)n.push(s[t]+i)}if(n.length%3!=0)return null;for(let a=0;a<n.length;a+=3){const e=r[n[a+0]],t=r[n[a+1]],i=r[n[a+2]];(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)>0&&([n[a+1],n[a+2]]=[n[a+2],n[a+1]])}return{vertices:r,indices:n}}function hp(e){const t=function(e,t){const r=[],n=WebGL2RenderingContext;if(e.json.textures)for(const i of e.json.textures){const o={magFilter:n.LINEAR,minFilter:n.NEAREST,wrapS:n.REPEAT,wrapT:n.REPEAT};void 0!==i.sampler&&Object.assign(o,e.json.samplers[i.sampler]),r.push({image:t[i.source],sampler:o,uploaded:!1})}return r}(e,e.images),r=function(e,t){const r=[];for(const n of e.json.meshes){const i=[];for(const r of n.primitives)i.push(sp(r,e,t));r.push(i)}return r}(e,t),{scenes:n,scene:i,nodes:o}=e.json,a=n?n[i||0].nodes:[...o.keys()],s=[];for(const l of a)s.push(lp(o[l],e,r));return function(e,t,r){const n={},i=new Set;for(let o=0;o<e.length;o++){const e=r[t[o]];if(!e.extras)continue;const a=e.extras["mapbox:footprint:version"],s=e.extras["mapbox:footprint:id"];(a||s)&&i.add(o),"1.0.0"===a&&s&&(n[s]=o)}for(let o=0;o<e.length;o++){if(i.has(o))continue;const a=e[o],s=r[t[o]];if(!s.extras)continue;let l=null;a.id in n&&(l=dp(e[n[a.id]].meshes,a.localMatrix)),l||(l=up(s)),l&&(a.footprint=cp(l))}if(i.size>0){const t=Array.from(i.values()).sort((e,t)=>e-t);for(let r=t.length-1;r>=0;r--)e.splice(t[r],1)}}(s,a,e.json.nodes),s}function Ap(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,r=e.aabb.min[0]-1,n=e.aabb.min[1]-1,i=Xf/(e.aabb.max[0]-r+2),o=Xf/(e.aabb.max[1]-n+2);for(let a=0;a<t.length;a+=3){const s=t[a+2],l=(t[a+0]-r)*i|0,c=(t[a+1]-n)*o|0;s>e.heightmap[c*Xf+l]&&(e.heightmap[c*Xf+l]=s)}}function fp(e,t,r,n,i){r.reserve(r.length+4*e.length),n.reserve(n.length+10*e.length),i.reserve(i.length+10*e.length);let o=n.length;for(const a of e){const e=Math.min(10,Math.max(4,1.3*a.height))*t,s=[-a.normal[1],a.normal[0],0],l=Math.min(.29,.1*a.width/a.depth),c=a.width-2*a.depth*t*(l+.01),u=M([],a.pos,s,c/2),d=M([],a.pos,s,-c/2),h=[u[0],u[1],u[2]+a.height],A=[d[0],d[1],d[2]+a.height],f=M([],a.normal,s,l);P(f,f,e);const p=M([],a.normal,s,-l);P(p,p,e),S(f,u,f),S(p,d,p),u[2]+=.1,d[2]+=.1,n.emplaceBack(f[0],f[1],f[2]),n.emplaceBack(p[0],p[1],p[2]),n.emplaceBack(u[0],u[1],u[2]),n.emplaceBack(d[0],d[1],d[2]),n.emplaceBack(h[0],h[1],h[2]),n.emplaceBack(A[0],A[1],A[2]),n.emplaceBack(u[0],u[1],u[2]),n.emplaceBack(d[0],d[1],d[2]),n.emplaceBack(f[0],f[1],f[2]),n.emplaceBack(p[0],p[1],p[2]);const m=c/e/2;i.emplaceBack(-m-l,-1,m,.8),i.emplaceBack(m+l,-1,m,.8),i.emplaceBack(-m,0,m,1.3),i.emplaceBack(m,0,m,1.3),i.emplaceBack(m+l,-.8,m,.7),i.emplaceBack(m+l,-.8,m,.7),i.emplaceBack(0,0,m,1.3),i.emplaceBack(0,0,m,1.3),i.emplaceBack(m+l,-1.2,m,.8),i.emplaceBack(m+l,-1.2,m,.8),r.emplaceBack(6+o,4+o,8+o),r.emplaceBack(7+o,9+o,5+o),r.emplaceBack(0+o,1+o,2+o),r.emplaceBack(1+o,3+o,2+o),o+=10}}function pp(e,t){const r={};r.indexArray=new Os,r.vertexArray=new xs,r.colorArray=new Ss,fp(e,t,r.indexArray,r.vertexArray,r.colorArray);const n={defined:!0};n.emissiveFactor=lr.black;const i={};return i.baseColorFactor=lr.white,n.pbrMetallicRoughness=i,r.material=n,r.aabb=new Jc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}const mp=ds([{name:"a_pos_3f",components:3,type:"Float32"}]),gp=ds([{name:"a_normal_3",components:3,type:"Int16"}]),yp=ds([{name:"a_centroid_3",components:3,type:"Int16"}]),_p=ds([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),vp=ds([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),xp=ds([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),wp=ds([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),bp=ds([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),Bp=ds([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Cp=Fc.types,Ep=32767;function Sp(e,t){const r=Nn+t;for(const n of e)for(const e of n)if(e.x<-t||e.x>r||e.y<-t||e.y>r)return!1;return!0}function Tp(e){switch(e){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error("Unknown roof shape: ".concat(e))}}class Ip{constructor(){this.layoutVertexArray=new xs,this.layoutAttenuationArray=new Ss,this.layoutColorArray=new Is,this.indexArray=new Os,this.indexArrayForConflation=new Os,this.segmentsBucket=new dl}}class Fp{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new dl,this.entranceBloom=new Ip;const t=66560;this.layoutVertexArray=new xs,this.layoutVertexArray.reserve(t),this.layoutNormalArray=new fs,this.layoutNormalArray.reserve(t),this.layoutCentroidArray=new fs,this.layoutCentroidArray.reserve(t),this.layoutColorArray=new Is,this.layoutColorArray.reserve(t),this.layoutFloodLightDataArray=new Hs,this.layoutFloodLightDataArray.reserve(t),this.layoutAOArray=new qs,this.layoutAOArray.reserve(t),this.indexArray=new Os,this.indexArray.reserve(66560),this.indexArrayForConflation=new Os,this.segmentsBucket=new dl,this.entranceBloom=new Ip,e&&(this.layoutFacadePaintArray=new Is,this.layoutFacadeDataArray=new bs,this.layoutFacadeVerticalRangeArray=new Is)}reserve(e,t,r){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(t),r&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class kp{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Qs,this.footprintsIndices=new Hs,this.footprintsMin=new Be(1/0,1/0),this.footprintsMax=new Be(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new Fp(!1),this.buildingWithFacade=new Fp(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new Nl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.groundEffect=new mA(e),this.groundEffect.groundRadiusArray=new ms,this.hasAppearances=null}updateFootprints(e,t){const r=new Ch([],[],1),n={vertices:[],indices:new Uint32Array(0),grid:r,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};t.push({footprint:n,id:e})}updateAppearances(e,t,r,n){}prepare(){return function(){if(null!=cf||null!=lf)return null;if(null!=sf)return sf;const e=fetch(at.BUILDING_GEN_URL);return sf=function(e){let t,r,n,i,o;function a(){t=new Uint8Array(o.buffer),r=new Int16Array(o.buffer),n=new Int32Array(o.buffer),i=new Float32Array(o.buffer)}function s(){throw new Error("Unexpected BuildingGen error.")}const l=()=>{},c={a:{a:s,f:function(e){const r=t.length,n=Math.max(e>>>0,Math.ceil(1.2*r)),i=Math.ceil((n-r)/65536);try{return o.grow(i),a(),!0}catch(e){return!1}},g:s,b:l,c:l,d:l,e:l}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,c):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,c))).then(e=>{const s=e.instance.exports;return(0,s.g)(),o=s.f,a(),new $A({setStyle:s.h,setAOOptions:s.i,setMetricOptions:s.j,setStructuralOptions:s.k,setFacadeOptions:s.l,setFauxFacadeOptions:s.m,setFacadeClassifierOptions:s.n,addFeature:s.o,addFacade:s.p,generateMesh:s.q,getLastError:s.r,getOuterRingLength:s.s,getMeshCount:s.t,getPositionsPtr:s.u,getPositionsLength:s.v,getNormalsPtr:s.w,getNormalsLength:s.x,getAOPtr:s.y,getAOLength:s.z,getUVPtr:s.A,getUVLength:s.B,getFauxFacadePtr:s.C,getFauxFacadeLength:s.D,getIndicesPtr:s.E,getIndicesLength:s.F,getBuildingPart:s.G,getRingCount:s.H,getRingPtr:s.I,getRingLength:s.J,malloc:s.K,free:s.L,heapU8:t,heap16:r,heap32:n,heapF32:i})})}(e).then(e=>(sf=null,cf=e,cf)).catch(e=>{We("Could not load building-gen"),sf=null,lf=e}),sf}()}populate(e,t,r,n){const i=hf();if(!i)return;const o=_c(r);this.tileToMeter=o,this.brightness=t.brightness,i.setStyle({normalScale:[1,-1,o],tileToMeters:o}),i.setAOOptions(!1,.3),i.setMetricOptions(!1,16),i.setStructuralOptions(!0),i.setFacadeClassifierOptions(3);const a=new Map,s=new Map;let l=0;for(const{feature:m}of e){if("LineString"!==Cp[m.type]){a.set(m.id,m.properties.source_id);continue}const e=this.layers[0]._featureFilter.needGeometry;if(e&&!this.layers[0]._featureFilter.filter(new Ba(this.zoom),m,r))continue;const t=Ic(m,e);if(!e&&!this.layers[0]._featureFilter.filter(new Ba(this.zoom),t,r))continue;const i=e?t.geometry:Tc(m,r,n),o=[];for(const r of i)for(const e of r)o.push(e.x),o.push(e.y);const c={coordinates:o,crossPerc:m.properties.cross_perc,distanceToRoad:m.properties.distance_to_road,entrances:m.properties.entrances,sourceId:0},u=m.properties.source_id;let d=s.get(u);d||(d=[],s.set(u,d)),d.push(c),++l}this.maxHeight=0;const c=new Array,u=new Set,d=e=>{null!=e&&u.add(e)},h=(e,t)=>{null!=e&&c.push({buildingId:e,footprintIndex:t})},A=64*(e.length-l),f=A/2;this.buildingWithFacade.reserve(A,f,!0),this.buildingWithoutFacade.reserve(2*A,2*f,!1),this.footprintsIndices.reserve(16*(e.length-l)),this.footprintsVertices.reserve(8*(e.length-l));for(const{feature:m,id:g,index:y,sourceLayerIndex:_}of e){if("LineString"===Cp[m.type])continue;const e=this.layers[0]._featureFilter.needGeometry;if(e&&!this.layers[0]._featureFilter.filter(new Ba(this.zoom),m,r))continue;let l=null;if(m.properties&&m.properties.hasOwnProperty("building_id")&&(l=m.properties.building_id,u.has(l)))continue;const c=Ic(m,e);if(!e&&!this.layers[0]._featureFilter.filter(new Ba(this.zoom),c,r))continue;const A=e?c.geometry:Tc(m,r,n),f=rh(A,500);let p=!1;for(const t of f)if(1!==t.length){p=!0;break}if(p){d(l);continue}if(!Sp(A,163)){d(l);continue}const v=this.layers[0],x=Tp(v.layout.get("building-roof-shape").evaluate(m,{},r)),w=v.layout.get("building-base").evaluate(m,{},r),b=v.layout.get("building-height").evaluate(m,{},r),B=v.layout.get("building-flood-light-ground-radius").evaluate(m,{},r),C=v.paint.get("building-ambient-occlusion-intensity"),E=B/this.tileToMeter;m.properties["building-part"]="roof";const S=v.paint.get("building-color").evaluate(m,{},this.canonical).toPremultipliedRenderColor(this.lut),T=v.paint.get("building-emissive-strength").evaluate(m,{},this.canonical);m.properties["building-part"]="wall";const I=v.paint.get("building-color").evaluate(m,{},this.canonical).toPremultipliedRenderColor(this.lut),F=v.paint.get("building-emissive-strength").evaluate(m,{},this.canonical);m.properties["building-part"]="window";const k=v.paint.get("building-color").evaluate(m,{},this.canonical).toPremultipliedRenderColor(this.lut),P=v.paint.get("building-emissive-strength").evaluate(m,{},this.canonical);m.properties["building-part"]="door";const M=v.paint.get("building-color").evaluate(m,{},this.canonical).toPremultipliedRenderColor(this.lut),O=v.paint.get("building-emissive-strength").evaluate(m,{},this.canonical);let L=v.layout.get("building-flood-light-wall-radius").evaluate(m,{},r);L=Oe(L,0,2048);const D=L/2048*Ep,U=a.get(g),R=s.get(U)||[],z=0!==R.length&&v.layout.get("building-facade").evaluate(m,{},r);i.setFacadeOptions(4,!0),i.setFauxFacadeOptions(z,!1,1);let N=0,j=0,Q=0,V=0,H=0,G=0,K=0,W=0,q=0,Z=0,X=0;if(z){let e=Math.round(v.layout.get("building-facade-floors").evaluate(m,{},r));if(0===w){e=Math.max(1,e-(R.length>0?1:0));let t=4;if(b>100){const e=[10,13,15];t=e[m.id?m.id%e.length:0]}else b<=10&&(t=3);i.setFacadeOptions(t,!0),H=(b<15?1.3:1.61803)*t/o}else H=w/o;G=b/o,H=Math.min(H,G),Q=v.layout.get("building-facade-unit-width").evaluate(m,{},r)/o,V=(G-H)/e,i.setFauxFacadeOptions(!0,!0,Q);const t=v.layout.get("building-facade-window").evaluate(m,{},r);N=t[0],j=t[1],K=Math.floor(65535*Math.min(1,H/Nn)),W=Math.floor(65535*Math.min(1,G/Nn)),q=Math.floor(255*N)<<8|Math.floor(255*j),Z=Math.floor(65535*Math.min(1,Q/Nn)),X=Math.floor(65535*Math.min(1,V/Nn))}const Y=Array(f.length),J={x:1/0,y:1/0},$={x:-1/0,y:-1/0},ee={x:0,y:0};let te=0;for(let t=0;t<f.length;t++){const e=f[t];if(e.length>0){const r=[],n=Array(e.length+1);n[0]=0;for(let t=0;t<e.length;t++){const i=e[t];for(let e=0;e<i.length;e++){const t=i[i.length-e-1];J.x=Math.min(J.x,t.x),J.y=Math.min(J.y,t.y),$.x=Math.max($.x,t.x),$.y=Math.max($.y,t.y),ee.x+=t.x,ee.y+=t.y,te++,r.push(t.x),r.push(t.y)}n[t+1]=r.length}Y[t]={id:m.id?m.id:0,height:b,minHeight:w,sourceId:0,roofType:x,coordinates:r,ringIndices:n}}}ee.x/=te||1,ee.y/=te||1;const re=i.generateMesh(Y,R);if("string"==typeof re){We("Unable to generate building ".concat(m.id,": ").concat(re)),d(l);continue}if(0===re.meshes.length||0===re.modifiedPolygonRings.length){d(l);continue}const ne=z?this.buildingWithFacade:this.buildingWithoutFacade;let ie=0;for(const t of re.meshes)ie+=t.positions.length/3;const oe=ne.segmentsBucket.prepareSegment(ie,ne.layoutVertexArray,ne.indexArray),ae=[];let se=null,le=0,ce=-1;const ue=ne.layoutVertexArray.length,de=ue+ie;ne.layoutVertexArray.resize(de),ne.layoutCentroidArray.resize(de),ne.layoutNormalArray.resize(de),ne.layoutAOArray.resize(de),ne.layoutColorArray.resize(de),ne.layoutFloodLightDataArray.resize(de),z&&(ne.layoutFacadePaintArray.resize(de),ne.layoutFacadeDataArray.resize(de),ne.layoutFacadeVerticalRangeArray.resize(de));const he=ne.indexArray.length;let Ae=0,fe=ue;for(const t of re.meshes){let e,r;if(1===t.buildingPart)e=S,r=T;else if(0===t.buildingPart)e=I,r=F;else if(2===t.buildingPart)e=k,r=P;else{if(3!==t.buildingPart)continue;e=M,r=O}if(r=Oe(r,0,1),3===t.buildingPart){const e=new Array;for(let o=0;o<t.positions.length;o+=12){const r=t.positions[o+0],n=t.positions[o+1],i=t.positions[o+3],a=t.positions[o+4],s=t.positions[o+2],l=t.positions[o+8]-s,c=1,u=i-r,d=a-n,h=Math.hypot(u,d);e.push({pos:[r+.5*u,n+.5*d,s],normal:[d/h,-u/h,0],width:h,height:l,depth:c,points:[r,n,i,a]})}const r=ne.entranceBloom.segmentsBucket.prepareSegment(10*e.length,ne.entranceBloom.layoutVertexArray,ne.entranceBloom.indexArray),n=ne.entranceBloom.layoutVertexArray.length;le=ne.entranceBloom.indexArray.length,fp(e,.5/this.tileToMeter,ne.entranceBloom.indexArray,ne.entranceBloom.layoutVertexArray,ne.entranceBloom.layoutAttenuationArray);const i=ne.entranceBloom.layoutVertexArray.length-n;ce=ne.entranceBloom.indexArray.length-le;for(let t=0;t<i;t++)ne.entranceBloom.layoutColorArray.emplaceBack(255*M.r<<8|255*M.g,255*M.b<<8|51*O);r.vertexLength+=i,r.primitiveLength+=ce,se={part:t.buildingPart,vertexOffset:n,vertexLength:i}}ne.layoutVertexArray.float32.set(t.positions,3*fe);const n=t.positions.length/3;for(let u=0;u<n;++u){const n=3*u;Ae=Math.max(Ae,t.positions[n+2]);const i=t.normals[n+1]*Ep,o=t.normals[n+2]*Ep,a=3*(fe+u);ne.layoutNormalArray.int16[a]=t.normals[n]*Ep,ne.layoutNormalArray.int16[a+1]=i,ne.layoutNormalArray.int16[a+2]=o;const s=t.ao[u];ne.layoutAOArray.uint8[fe+u]=255*s;const l=1+(s-1)*C,c=255*e.b*l<<8|255*r;ne.layoutColorArray.uint16[2*(fe+u)]=255*e.r*l<<8|255*e.g*l,ne.layoutColorArray.uint16[2*(fe+u)+1]=c}const i=Math.floor(ee.x),o=Math.floor(ee.y),a=Math.floor(b);for(let t=0;t<n;++t){const e=3*(fe+t);ne.layoutCentroidArray.int16[e]=i,ne.layoutCentroidArray.int16[e+1]=o,ne.layoutCentroidArray.int16[e+2]=a}if(ne.layoutFloodLightDataArray.uint16.fill(0===t.buildingPart?D:0,fe,fe+n),z){const e=255*k.r<<8|255*k.g,r=255*k.b<<8|255*P;for(let t=0;t<n;++t){const n=2*(fe+t);ne.layoutFacadePaintArray.uint16[n]=e,ne.layoutFacadePaintArray.uint16[n+1]=r}for(let i=0;i<n;++i)if(t.isFauxFacade[i]){const e=Math.min(65535,Math.floor(t.uv[2*i]*re.outerRingLength));ne.layoutFacadeDataArray.emplace(fe+i,1|e,q,Z,X),ne.layoutFacadeVerticalRangeArray.emplace(fe+i,K,W)}else ne.layoutFacadeDataArray.emplace(fe+i,0,0,0,0),ne.layoutFacadeVerticalRangeArray.emplace(fe+i,0,0)}const s=oe.vertexLength,l=t.indices.length/3,c=ne.indexArray.length;ne.indexArray.resize(c+l);for(let u=0;u<l;++u){const e=3*u,r=3*c+e;ne.indexArray.uint16[r]=s+t.indices[e],ne.indexArray.uint16[r+1]=s+t.indices[e+1],ne.indexArray.uint16[r+2]=s+t.indices[e+2]}1!==t.buildingPart&&0!==t.buildingPart&&2!==t.buildingPart&&3!==t.buildingPart||ae.push({part:t.buildingPart,vertexOffset:fe,vertexLength:t.positions.length/3}),fe+=n,oe.vertexLength+=n,oe.primitiveLength+=t.indices.length/3}this.maxHeight=Math.max(this.maxHeight,Ae);const pe=ne.indexArray.length-he,me=this.footprintsIndices.length,ge=this.footprintsVertices.length,ye=[],_e=new Be(1/0,1/0),ve=new Be(-1/0,-1/0),xe=this.groundEffect.vertexArray.length;for(const t of re.modifiedPolygonRings){const e=[],r=new Be(1/0,1/0),n=new Be(-1/0,-1/0);for(let i=0;i<t.length;i+=2){const o=t.length-i-2;r.x=Math.min(r.x,t[o]),r.y=Math.min(r.y,t[o+1]),n.x=Math.max(n.x,t[o]),n.y=Math.max(n.y,t[o+1]);const a=new Be(t[o],t[o+1]);e.push(a),ye.push(a.x,a.y),this.footprintsVertices.emplaceBack(a.x,a.y)}_e.x=Math.min(_e.x,r.x),_e.y=Math.min(_e.y,r.y),ve.x=Math.max(ve.x,n.x),ve.y=Math.max(ve.y,n.y),this.groundEffect.addData(e,[r,n],E)}const we=this.groundEffect.vertexArray.length-xe;this.groundEffect.groundRadiusArray.reserveForAdditional(we);for(let t=0;t<we;t++)this.groundEffect.groundRadiusArray.emplaceBack(B);(J.x<0||$.x>Nn||J.y<0||$.y>Nn)&&this.featuresOnBorder.push({featureId:m.id,footprintIndex:this.footprints.length});{const e=Fd(ye,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+e.length),this.footprintsIndices.uint16.set(e,me),this.buildingIds.add(null!=l?l:m.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,_e.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,_e.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,ve.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,ve.y);const t={footprintVertexOffset:ge,footprintVertexLength:this.footprintsVertices.length-ge,footprintIndexOffset:me,footprintIndexLength:this.footprintsIndices.length-me,min:_e,max:ve,hiddenFlags:0,indicesOffset:he,indicesLength:pe,bloomIndicesOffset:le,bloomIndicesLength:ce,groundEffectVertexOffset:xe,groundEffectVertexLength:we,hasFauxFacade:z,height:Ae,promoteId:g,feature:c,parts:ae,buildingBloom:se},r=this.footprints.length;void 0!==m.id&&this.featureFootprintLookup.set(m.id,r),h(l,r),this.footprints.push(t)}this.programConfigurations.populatePaintArrays(ne.layoutVertexArray.length,m,y,{},t.availableImages,r,t.brightness),this.groundEffect.addPaintPropertiesData(m,y,{},t.availableImages,r,t.brightness),t.featureIndex.insert(m,A,y,_,this.index,ue)}c.forEach(e=>{let{buildingId:t,footprintIndex:r}=e;u.has(t)&&(this.footprints[r].hiddenFlags|=4)});const p=new Set;this.buildingIds.forEach((e,t,r)=>{u.has(e)||p.add(e)}),this.buildingIds=p,this.groundEffect.prepareBorderSegments()}update(e,t,r,n,i,o,a){this.programConfigurations.updatePaintArrays(e,t,i,r,n,o,a),this.groundEffect.update(e,t,i,r,n,o,a),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return 0===this.buildingWithoutFacade.layoutVertexArray.length&&0===this.buildingWithFacade.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const t=t=>{t.layoutVertexBuffer=e.createVertexBuffer(t.layoutVertexArray,mp.members),t.layoutNormalBuffer=e.createVertexBuffer(t.layoutNormalArray,gp.members),t.layoutCentroidBuffer=e.createVertexBuffer(t.layoutCentroidArray,yp.members),t.layoutFloodLightDataBuffer=e.createVertexBuffer(t.layoutFloodLightDataArray,Bp.members),t.layoutFacadeDataArray&&t.layoutFacadeDataArray.length&&(t.layoutFacadeDataBuffer=e.createVertexBuffer(t.layoutFacadeDataArray,xp.members)),t.layoutFacadeVerticalRangeArray&&t.layoutFacadeVerticalRangeArray.length&&(t.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(t.layoutFacadeVerticalRangeArray,wp.members)),t.entranceBloom.layoutVertexArray.length&&(t.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(t.entranceBloom.layoutVertexArray,mp.members),t.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(t.entranceBloom.layoutAttenuationArray,bp.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(t(this.buildingWithoutFacade),t(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=e=>{e.layoutVertexBuffer&&(e.layoutVertexBuffer.destroy(),e.layoutNormalBuffer.destroy(),e.layoutColorBuffer.destroy(),e.segmentsBucket.destroy(),e.indexBuffer&&e.indexBuffer.destroy(),e.entranceBloom.layoutVertexBuffer&&(e.entranceBloom.layoutVertexBuffer.destroy(),e.entranceBloom.layoutColorBuffer.destroy(),e.entranceBloom.layoutAttenuationBuffer.destroy(),e.entranceBloom.indexBuffer.destroy(),e.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!1;const i=r?t:0,o=0|(r?-1:~t);0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const a of e){const e=this.footprints[a],t=e.hiddenFlags&o|i;e.hiddenFlags!==t&&(e.hiddenFlags=t,n=!0,this.groundEffect.updateHiddenByLandmarkRange(e.groundEffectVertexOffset,e.groundEffectVertexLength,0!==e.hiddenFlags))}return n&&(this.indexArrayForConflationUploaded=!1),n}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const t=e=>{0!==e.indexArray.length&&(e.indexArrayForConflation.resize(e.indexArray.length),e.indexArrayForConflation.uint16.set(e.indexArray.uint16),e.entranceBloom.indexArrayForConflation.resize(e.entranceBloom.indexArray.length),e.entranceBloom.indexArrayForConflation.uint16.set(e.entranceBloom.indexArray.uint16))};t(this.buildingWithoutFacade),t(this.buildingWithFacade);for(const n of this.footprints){const e=n.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,t=n.indicesOffset+n.indicesLength;if(0!==n.hiddenFlags){for(let i=n.indicesOffset;i<t;i++)e.indexArrayForConflation.uint16[3*i+0]=0,e.indexArrayForConflation.uint16[3*i+1]=0,e.indexArrayForConflation.uint16[3*i+2]=0;const r=n.bloomIndicesOffset+n.bloomIndicesLength;for(let t=n.bloomIndicesOffset;t<r;t++)e.entranceBloom.indexArrayForConflation.uint16[3*t+0]=0,e.entranceBloom.indexArrayForConflation.uint16[3*t+1]=0,e.entranceBloom.indexArrayForConflation.uint16[3*t+2]=0}}const r=t=>{0!==t.indexArray.length&&(t.indexBuffer?t.indexBuffer.updateData(t.indexArrayForConflation):t.indexBuffer=e.createIndexBuffer(t.indexArrayForConflation,!0),t.entranceBloom.indexBuffer?t.entranceBloom.indexBuffer.updateData(t.entranceBloom.indexArrayForConflation):t.entranceBloom.indexBuffer=e.createIndexBuffer(t.entranceBloom.indexArrayForConflation,!0))};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const t=t=>{t.layoutColorBuffer?t.layoutColorBuffer.updateData(t.layoutColorArray):t.layoutColorBuffer=e.createVertexBuffer(t.layoutColorArray,_p.members,!0),t.layoutFacadePaintArray&&(t.layoutFacadePaintBuffer?t.layoutFacadePaintBuffer.updateData(t.layoutFacadePaintArray):t.layoutFacadePaintBuffer=e.createVertexBuffer(t.layoutFacadePaintArray,vp.members,!0)),t.entranceBloom.layoutColorBuffer?t.entranceBloom.layoutColorBuffer.updateData(t.entranceBloom.layoutColorArray):t.entranceBloom.layoutColorBuffer=e.createVertexBuffer(t.entranceBloom.layoutColorArray,_p.members,!0)};t(this.buildingWithoutFacade),t(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,t){const r=e.paint.get("building-ambient-occlusion-intensity");for(const n of this.footprints){if(4&n.hiddenFlags)continue;const i=t[n.promoteId],o=n.feature;o.properties["building-part"]="roof";const a=e.paint.get("building-color").evaluate(o,i,this.canonical).toPremultipliedRenderColor(this.lut),s=e.paint.get("building-emissive-strength").evaluate(o,i,this.canonical);o.properties["building-part"]="wall";const l=e.paint.get("building-color").evaluate(o,i,this.canonical).toPremultipliedRenderColor(this.lut),c=e.paint.get("building-emissive-strength").evaluate(o,i,this.canonical);o.properties["building-part"]="window";const u=e.paint.get("building-color").evaluate(o,i,this.canonical).toPremultipliedRenderColor(this.lut),d=e.paint.get("building-emissive-strength").evaluate(o,i,this.canonical);o.properties["building-part"]="door";const h=e.paint.get("building-color").evaluate(o,i,this.canonical).toPremultipliedRenderColor(this.lut),A=e.paint.get("building-emissive-strength").evaluate(o,i,this.canonical),f=n.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const e of n.parts){let t,i=a;1===e.part?(i=a,t=s):0===e.part?(i=l,t=c):2===e.part?(i=u,t=d):3===e.part&&(i=h,t=A),t=Oe(t,0,1);for(let o=0;o<e.vertexLength;o++){const a=e.vertexOffset+o,s=1+(f.layoutAOArray.uint8[a]/255-1)*r;f.layoutColorArray.emplace(a,i.r*s*255<<8|i.g*s*255,i.b*s*255<<8|255*t),n.hasFauxFacade&&f.layoutFacadePaintArray.emplace(a,255*u.r<<8|255*u.g,255*u.b<<8|255*d)}}const p=n.buildingBloom;if(p)for(let e=0;e<p.vertexLength;e++)f.entranceBloom.layoutColorArray.emplace(p.vertexOffset+e,255*h.r<<8|255*h.g,255*h.b<<8|51*A)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,t,r){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());if(Qh(this.activeReplacements,n))return;this.activeReplacements=n;for(const o of this.footprints)o.hiddenFlags&=-2;const i=[];for(const o of this.activeReplacements){if(o.order<=Uh)continue;const t=Math.max(1,Math.pow(2,o.footprintTileId.canonical.z-e.canonical.z));for(const r of this.footprints)r.min.x>o.max.x||r.max.x<o.min.x||r.min.y>o.max.y||r.max.y<o.min.y||(i.length=0,Mp(this.footprintsVertices,r.footprintVertexOffset,r.footprintVertexLength,o.footprintTileId.canonical,e.canonical,i),Gh(o.footprint,i,this.footprintsIndices.uint16,r.footprintIndexOffset,r.footprintIndexLength,0,-t)&&(r.hiddenFlags|=1))}0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(o.groundEffectVertexOffset,o.groundEffectVertexLength,0!==o.hiddenFlags);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(void 0!==e.id){const t=this.featureFootprintLookup.get(e.id);return this.footprints[t]}return null}getHeightAtTileCoord(e,t){let r=Number.NEGATIVE_INFINITY,n=!0;const i=4*(e+Nn)*Nn+(t+Nn);if(this.footprintLookup.hasOwnProperty(i)){const e=this.footprintLookup[i];return e?{height:e.height,hidden:0!==e.hiddenFlags}:void 0}const o=new Be(e,t);for(const a of this.footprints)e>a.max.x||a.min.x>e||t>a.max.y||a.min.y>t||a.height<=r||Pp(o,this.footprintsVertices.float32.subarray(2*a.footprintVertexOffset,2*(a.footprintVertexOffset+a.footprintVertexLength)),this.footprintsIndices.uint16.subarray(a.footprintIndexOffset,a.footprintIndexOffset+a.footprintIndexLength))&&(r=a.height,this.footprintLookup[i]=a,n=0!==a.hiddenFlags);if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:n};this.footprintLookup[i]=void 0}}function Pp(e,t,r){for(let n=0;n<r.length;n+=3){const i=r[n],o=r[n+1],a=r[n+2],s=t[2*i+0],l=t[2*i+1],c=t[2*o+0],u=t[2*o+1],d=t[2*a+0],h=t[2*a+1],A=(s-d)*(e.y-h)-(l-h)*(e.x-d),f=(c-s)*(e.y-l)-(u-l)*(e.x-s);if(A<0!=f<0&&0!==A&&0!==f)continue;const p=(d-c)*(e.y-u)-(h-u)*(e.x-c);if(0===p||p<0==A+f<=0)return!0}return!1}function Mp(e,t,r,n,i,o){const a=Math.pow(2,n.z-i.z);for(let s=0;s<r;s++){let r=e.float32[2*(s+t)+0],l=e.float32[2*(s+t)+1];r=(r+i.x*Nn)*a-n.x*Nn,l=(l+i.y*Nn)*a-n.y*Nn,o.push(new Be(r,l))}}let Op,Lp;ea(kp,"BuildingBucket",{omit:["layers"]}),ea(Fp,"BuildingGeometry"),ea(Ip,"BuildingBloomGeometry");const Dp=ds([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Up=ds([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Rp}=Dp,zp=ds([{name:"a_packed",components:3,type:"Float32"}]),{members:Np}=zp,jp=ds([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Qp}=jp;class Vp{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new wd({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const r=this.getKey(e,t);return this.positions[r]}trim(){const e=this.width,t=this.height=Ne(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,r){const n=[];let i=e.length%2==1?-e[e.length-1]*r:0,o=e[0]*r,a=!0;n.push({left:i,right:o,isDash:a,zeroLength:0===e[0]});let s=e[0];for(let l=1;l<e.length;l++){a=!a;const t=e[l];i=s*r,s+=t,o=s*r,n.push({left:i,right:o,isDash:a,zeroLength:0===t})}return n}addRoundDash(e,t,r){const n=t/2;for(let i=-r;i<=r;i++){const t=this.width*(this.nextRow+r+i);let o=0,a=e[o];for(let s=0;s<this.width;s++){s/a.right>1&&(a=e[++o]);const l=Math.abs(s-a.left),c=Math.abs(s-a.right),u=Math.min(l,c);let d;const h=i/r*(n+1);if(a.isDash){const e=n-Math.abs(h);d=Math.sqrt(u*u+e*e)}else d=n-Math.sqrt(u*u+h*h);this.image.data[t+s]=Math.max(0,Math.min(255,d+128))}}}addRegularDash(e,t){for(let s=e.length-1;s>=0;--s){const t=e[s],r=e[s+1];t.zeroLength?e.splice(s,1):r&&r.isDash===t.isDash&&(r.left=t.left,e.splice(s,1))}const r=e[0],n=e[e.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);const i=this.width*this.nextRow;let o=0,a=e[o];for(let s=0;s<this.width;s++){s/a.right>1&&(a=e[++o]);const r=Math.abs(s-a.left),n=Math.abs(s-a.right),l=Math.min(r,n);this.image.data[i+s]=Math.max(0,Math.min(255,(a.isDash?l:-l)+t+128))}}addDash(e,t){const r=this.getKey(e,t);if(this.positions[r])return this.positions[r];const n="round"===t,i=n?7:0,o=2*i+1;if(this.nextRow+o>this.height)return We("LineAtlas out of space"),null;0===e.length&&e.push(1);let a=0;for(let c=0;c<e.length;c++)e[c]<0&&(We("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),a+=e[c];if(0!==a){const r=this.width/a,o=this.getDashRanges(e,this.width,r);n?this.addRoundDash(o,r,i):this.addRegularDash(o,"square"===t?.5*r:0)}const s=this.nextRow+i;this.nextRow+=o;const l={tl:[s,i],br:[a,0]};return this.positions[r]=l,l}}ea(Vp,"LineAtlas");const Hp=Fc.types,Gp=Math.cos(Math.PI/180*37.5),Kp=Math.cos(Math.PI/180*5);class Wp{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new vs,this.layoutVertexArray2=new xs,this.patternVertexArray=new xs,this.indexArray=new Os,this.programConfigurations=new Nl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new dl,this.maxLineLength=0,this.zOffsetVertexArray=new xs,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Nn/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,t){}updateAppearances(e,t,r,n){}populate(e,t,r,n){this.hasPattern=oh("line",this.layers,this.pixelRatio,t);const i=this.layers[0].layout.get("line-sort-key");this.tileToMeter=_c(r);const o=this.layers[0].layout.get("line-elevation-reference");if("hd-road-markup"===o)this.elevationType="road";else{const e=this.layers[0].layout.get("line-z-offset"),t=e.isConstant()&&!e.constantOr(0);this.elevationType="sea"!==o&&"ground"!==o&&t?"none":"offset","offset"===this.elevationType&&"none"===o&&We("line-elevation-reference: ground is used for the layer ".concat(this.layerIds[0]," because non-zero line-z-offset value was found."))}const a=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope="offset"===this.elevationType&&void 0!==a;const s=[];for(const{feature:d,id:h,index:A,sourceLayerIndex:f}of e){const e=this.layers[0]._featureFilter.needGeometry,o=Ic(d,e);if(!this.layers[0]._featureFilter.filter(new Ba(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),o,r))continue;const a=i?i.evaluate(o,{},r):void 0,l={id:h,properties:d.properties,type:d.type,sourceLayerIndex:f,index:A,geometry:e?o.geometry:Tc(d,r,n),patterns:{},sortKey:a};s.push(l)}i&&s.sort((e,t)=>e.sortKey-t.sortKey);const{lineAtlas:l,featureIndex:c}=t,u=this.addConstantDashes(l);for(const d of s){const{geometry:n,index:i,sourceLayerIndex:o}=d;if(u&&this.addFeatureDashes(d,l),this.hasPattern){const e=ah("line",this.layers,d,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(d,n,i,r,l.positions,t.availableImages,t.brightness,t.elevationFeatures);c.insert(e[i].feature,n,i,o,this.index)}}addConstantDashes(e){let t=!1;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,i=r.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==i.kind)t=!0;else{const t=i.value,r=n.value;if(!r)continue;e.addDash(r,t)}}return t}addFeatureDashes(e,t){const r=this.zoom;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,o=n.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===o.kind)continue;let a,s;if("constant"===i.kind){if(a=i.value,!a)continue}else a=i.evaluate({zoom:r},e);s="constant"===o.kind?o.value:o.evaluate({zoom:r},e),t.addDash(a,s),e.patterns[n.id]=[t.getKey(a,s)]}}update(e,t,r,n,i,o,a,s){this.programConfigurations.updatePaintArrays(e,t,i,r,n,o,a,s)}addFeatures(e,t,r,n,i,o){for(const a of this.patternFeatures)this.addFeature(a,a.geometry,a.index,t,r,n,o,e.elevationFeatures)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Np)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Qp)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Up.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rp),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,t){let r,n;if(t&&t>0?(r="mapbox_clip_start_".concat(t),n="mapbox_clip_end_".concat(t)):(r="mapbox_clip_start",n="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(r)&&e.properties.hasOwnProperty(n))return{start:+e.properties[r],end:+e.properties[n]}}addFeature(e,t,r,n,i,o,a,s){const l=this.layers[0].layout,c=l.get("line-join").evaluate(e,{}),u=l.get("line-cap").evaluate(e,{}),d=l.get("line-miter-limit"),h=l.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const A=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=l.get("line-z-offset").value;const f=this.layers[0].paint.get("line-width").value;if("constant"!==f.kind&&!1===f.isLineProgressConstant&&(this.variableWidthValue=f),"road"===this.elevationType){const r=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,t,n,s,c,u,d,h)){const[i,o]=this.clipRuntimeLinesToTile(t,1);for(let t=0;t<i.length;t++){const r=i[t],a=o[t],s={progress:{min:a.progress.min,max:a.progress.max},nextDir:this.computeSegNextDir(a,r),prevDir:this.computeSegPrevDir(a,r)};this.addLine(r,e,n,c,u,d,h,s,A&&a.parentIndex>0?a.parentIndex:null)}this.fillNonElevatedRoadSegment(r)}}else for(let p=0;p<t.length;p++)this.addLine(t[p],e,n,c,u,d,h,void 0,A&&p>0?p:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,o,n,a,void 0,this.worldview)}computeSegNextDir(e,t){return e.nextPoint.sub(t.at(-2)).unit()}computeSegPrevDir(e,t){return t[1].sub(e.prevPoint).unit()}clipLinesToTile(e,t){return OA(e,-t,-t,Nn+t,Nn+t)}clipRuntimeLinesToTile(e,t){const r=[];return[OA(e,-t,-t,Nn+t,Nn+t,r),r]}addElevatedRoadFeature(e,t,r,n,i,o,a,s){const l=[],c=tu.getElevationFeature(e,n);if(c){const e=this.clipLinesToTile(t,1),n=this.prepareElevatedLines(e,c,r);for(const t of n)l.push({geometry:t,elevation:c,elevationTileID:r,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(0===l.length)return!1;for(const u of l){const t=this.layoutVertexArray.length;this.addLine(u.geometry,e,r,i,o,a,s);const n=new ru(r,u.elevationTileID);if(u.elevation)for(let e=t;e<this.layoutVertexArray.length;e++){const t=new Be(this.layoutVertexArray.int16[6*e]>>1,this.layoutVertexArray.int16[6*e+1]>>1),r=n.pointElevation(t,u.elevation,.05);this.updateHeightRange(r),this.zOffsetVertexArray.emplaceBack(r,0,0)}else this.fillNonElevatedRoadSegment(t)}return!0}prepareElevatedLines(e,t,r){if(null!=t.constantHeight)return e;const n=[],i=1/_c(r);for(const o of e)LA(o,new $c(t,i),0,n);return n}fillNonElevatedRoadSegment(e){for(let t=e;t<this.layoutVertexArray.length;t++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,t,r,n,i,o,a,s,l){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=l?this.lineFeatureClips(t,l):this.lineClips;const c="none"===n;this.patternJoinNone=this.hasPattern&&c,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const u=s&&s.progress.min>0,d=s&&s.progress.max<1;if(this.lineClips){let r={min:this.lineClips.start,max:this.lineClips.end},n=1;if(s){const e=this.lineClips.end-this.lineClips.start;r=function(e,t,r){return{min:ot(e.min,t,r),max:ot(e.max,t,r)}}(s.progress,{min:0,max:1},r),e>0&&(n=(r.max-r.min)/e)}const i=+t.properties.mapbox_clip_feature_len,o=+t.properties.mapbox_clip_seg_len;if(Number.isNaN(i)||Number.isNaN(o)){for(let r=0;r<e.length-1;r++)this.totalDistance+=e[r].dist(e[r+1]);const t=this.totalDistance/(r.max-r.min);this.totalFeatureLength=Number.isFinite(t)?t:0,this.lineClips.start=r.min,this.lineClips.end=r.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=i,this.distance=o*n,this.lineClips.start=r.min,this.lineClips.end=r.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const h="Polygon"===Hp[t.type];let A=e.length;for(;A>=2&&e[A-1].equals(e[A-2]);)A--;let f=0;for(;f<A-1&&e[f].equals(e[f+1]);)f++;if(A<(h?3:2))return;"bevel"===n&&(o=1.05);const p=this.segments.prepareSegment(10*A,this.layoutVertexArray,this.indexArray);let m,g,y,_,v,x,w,b;s&&s.prevDir&&(x=s.prevDir.perp()),s&&s.nextDir&&(w=s.nextDir.perp()),this.e1=this.e2=-1,h&&(m=e[A-2],v=e[f].sub(m)._unit()._perp());for(let B=f;B<A;B++){if(y=B===A-1?h?e[f+1]:void 0:e[B+1],y&&e[B].equals(y))continue;v&&(_=v),m&&(g=m),m=e[B],b=this.evaluateLineProgressFeatures(g?g.dist(m):0),v=y?y.sub(m)._unit()._perp():_,_=_||v;const t=g&&y;let r=t?n:h||c?"butt":i;const s=_.x*v.x+_.y*v.y;if(c){const e=function(e){if(e.patternJoinNone){const t=e.segmentPoints.length/2,r=e.lineSoFar-e.segmentStart;for(let n=0;n<t;++n){const t=e.segmentPoints[2*n+1],i=Math.round(e.segmentPoints[2*n])+.5+.25*t;e.patternVertexArray.emplaceBack(i,r,e.segmentStart),e.patternVertexArray.emplaceBack(i,r,e.segmentStart)}e.segmentPoints.length=0}e.e1=e.e2=-1};if(t&&s<Kp){this.updateDistance(g,m),this.addCurrentVertex(m,_,1,1,p,b),e(this),this.addCurrentVertex(m,v,-1,-1,p,b);continue}if(g){if(!y){this.updateDistance(g,m),this.addCurrentVertex(m,_,1,1,p,b),e(this);continue}r="miter"}}let l=_.add(v);0===l.x&&0===l.y||l._unit();const C=l.x*v.x+l.y*v.y,E=0!==C?1/C:1/0,S=2*Math.sqrt(2-2*C),T=C<Gp&&g&&y,I=_.x*v.y-_.y*v.x>0,F=this.overscaling<=16?15*Nn/(512*this.overscaling):0;if(t&&"round"===r)if(E<a)r="miter";else if(E<=2){const e=qp(m,-10,Nn+10);r="offset"===this.elevationType&&(e||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===r&&E>o&&(r="bevel"),"bevel"===r&&(E>2&&(r="flipbevel"),E<o&&(r="miter")),g&&!("miter"===r&&T)&&this.updateDistance(g,m),"miter"===r)if(T){const e=m.dist(g);if(e>2*F){const t=m.sub(m.sub(g)._mult(F/e)._round());this.updateDistance(g,t),this.addCurrentVertex(t,_,0,0,p,b),g=t}this.updateDistance(g,m),l._mult(E),this.addCurrentVertex(m,l,0,0,p,b);const t=m.dist(y);if(t>2*F){const e=m.add(y.sub(m)._mult(F/t)._round());this.updateDistance(m,e),this.addCurrentVertex(e,v,0,0,p,b),m=e}}else l._mult(E),this.addCurrentVertex(m,l,0,0,p,b);else if("flipbevel"===r){if(E>100)l=v.mult(-1);else{const e=E*_.add(v).mag()/_.sub(v).mag();l._perp()._mult(e*(I?-1:1))}this.addCurrentVertex(m,l,0,0,p,b),this.addCurrentVertex(m,l.mult(-1),0,0,p,b)}else if("bevel"===r||"fakeround"===r){null!=b&&g&&this.addCurrentVertex(m,w||_,-1,-1,p,b);const e=m.dist(g)<=2*F&&"bevel"!==r,t=l.mult(I?1:-1);t._mult(E);const n=v.mult(I?-1:1),i=_.mult(I?-1:1),o=this.evaluateLineProgressFeatures(this.distance);if(null==b&&(this.addHalfVertex(m,t.x,t.y,!1,!I,0,p,o),e||this.addHalfVertex(m,t.x+2*i.x,t.y+2*i.y,!1,I,0,p,o)),"fakeround"===r){const e=Math.round(180*S/Math.PI/20);this.addHalfVertex(m,i.x,i.y,!1,I,0,p,o);for(let t=0;t<e;t++){let r=t/e;if(.5!==r){const e=r-.5;r+=r*e*(r-1)*((1.0904+s*(s*(3.55645-1.43519*s)-3.2452))*e*e+(.848013+s*(.215638*s-1.06021)))}const a=n.sub(i)._mult(r)._add(i)._unit();this.addHalfVertex(m,a.x,a.y,!1,I,0,p,o)}this.addHalfVertex(m,n.x,n.y,!1,I,0,p,o)}e||null!=b||this.addHalfVertex(m,t.x+2*n.x,t.y+2*n.y,!1,I,0,p,o),null!=b&&y&&this.addCurrentVertex(m,x||v,1,1,p,b)}else if("butt"===r)this.addCurrentVertex(m,l,0,0,p,b);else if("square"===r){if(!g){const e=u?0:-1;this.addCurrentVertex(m,l,e,e,p,b)}if(this.addCurrentVertex(m,l,0,0,p,b),g){const e=d?0:1;this.addCurrentVertex(m,l,e,e,p,b)}}else if("round"===r){if(g){const e=!t&&w?w:_;this.addCurrentVertex(m,e,0,0,p,b),!t&&d||this.addCurrentVertex(m,e,1,1,p,b,!0)}if(y){const e=!t&&x?x:v;!t&&u||this.addCurrentVertex(m,e,-1,-1,p,b,!0),this.addCurrentVertex(m,e,0,0,p,b)}}}}addVerticesTo(e,t,r,n,i,o,a,s,l,c){const u=(t.w-e.w)/this.tessellationStep|0;let d=0;const h=this.scaledDistance;if(u>1){this.lineSoFar=e.w;const h=(t.x-e.x)/u,A=(t.y-e.y)/u,f=(t.z-e.z)/u,p=(t.w-e.w)/u;for(let t=1;t<u;++t){e.x+=h,e.y+=A,e.z+=f,this.lineSoFar+=p,d+=p;const t=this.evaluateLineProgressFeatures(this.prevDistance+d);this.scaledDistance=(this.prevDistance+d)/this.totalDistance,this.addHalfVertex(e,r,n,c,!1,a,l,t),this.addHalfVertex(e,i,o,c,!0,-s,l,t)}}this.lineSoFar=t.w,this.scaledDistance=h;const A=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(t,r,n,c,!1,a,l,A),this.addHalfVertex(t,i,o,c,!0,-s,l,A)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&"offset"!==this.elevationType)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):We("line-progress evaluation for ".concat(this.layerIds[0]," requires enabling 'lineMetrics' for the source."));let t=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(t=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),"offset"!==this.elevationType?{zOffset:0,variableWidth:t}:"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:t}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:t}}addCurrentVertex(e,t,r,n,i,o){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const s=t.x+t.y*r,l=t.y-t.x*r,c=t.y*n-t.x,u=-t.y-t.x*n;if(null!=o){const t="offset"===this.elevationType,d=-10,h=Nn+10,A=o.zOffset,f=new kA(e.x,e.y,A,this.lineSoFar),p=!!t&&qp(e,d,h),m=this.lineSoFar,g=this.distance;if(this.currentVertex)if(p){const t=this.currentVertexIsOutside,o=this.currentVertex,p=new kA(e.x,e.y,A,this.lineSoFar);if(MA(o,p,d,h),!qp(p,d,h)){if(t){this.e1=this.e2=-1,this.distance-=o.dist(f),this.lineSoFar=o.w;const e=this.evaluateLineProgressFeatures(o.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(o,s,l,a,!1,r,i,e),this.addHalfVertex(o,c,u,a,!0,-n,i,e),this.prevDistance=this.distance}this.distance=this.prevDistance+o.dist(p),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(o,p,s,l,c,u,r,n,i,a),this.distance=g,this.scaledDistance=this.distance/this.totalDistance}}else{const e=this.currentVertex;if(this.currentVertexIsOutside){MA(e,f,d,h),this.e1=this.e2=-1,this.distance-=e.dist(f),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e.w;const t=this.evaluateLineProgressFeatures(e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(e,s,l,a,!1,r,i,t),this.addHalfVertex(e,c,u,a,!0,-n,i,t),this.prevDistance=this.distance,this.distance=g,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(e,f,s,l,c,u,r,n,i,a)}else p||(this.addHalfVertex(e,s,l,a,!1,r,i,o),this.addHalfVertex(e,c,u,a,!0,-n,i,o));this.currentVertex=f,this.currentVertexIsOutside=p,this.lineSoFar=m}else this.addHalfVertex(e,s,l,a,!1,r,i,o),this.addHalfVertex(e,c,u,a,!0,-n,i,o)}addHalfVertex(e,t,r,n,i,o,a,s){let{x:l,y:c}=e;if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),i||this.segmentPoints.push(this.lineSoFar-this.segmentStart,o)),this.layoutVertexArray.emplaceBack((l<<1)+(n?1:0),(c<<1)+(i?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(0===o?0:o<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const e=hr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,e)}const u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),i?this.e2=u:this.e1=u,null!=s&&this.zOffsetVertexArray.emplaceBack(s.zOffset,s.variableWidth,s.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,t){this.prevDistance=this.distance,this.distance+=e.dist(t),this.updateScaledDistance()}}function qp(e,t,r){return e.x<t||e.x>r||e.y<t||e.y>r}let Zp,Xp;function Yp(e,t,r){return t*(Nn/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}ea(Wp,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Jp=(e,t,r)=>(1-r)*e+r*t;function $p(e,t){return 1/Yp(e,1,t.tileZoom)}function em(e,t,r,n){return e.translatePosMatrix(n||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const tm=e=>{const t=[];rm(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=e.paint.get("line-trim-offset");0===r[0]&&0===r[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER");const n="none"===e.layout.get("line-join").constantOr("miter"),i=!!e.paint.get("line-pattern").constantOr(1);return n&&i&&t.push("LINE_JOIN_NONE"),t};function rm(e){const t=e.paint.get("line-dasharray").value;return"constant"!==t.kind||t.value}let nm;const im=()=>nm||(nm={layout:Zp||(Zp=new Da({"line-cap":new Oa(Ua.layout_line["line-cap"]),"line-join":new Oa(Ua.layout_line["line-join"]),"line-miter-limit":new Ma(Ua.layout_line["line-miter-limit"]),"line-round-limit":new Ma(Ua.layout_line["line-round-limit"]),"line-sort-key":new Oa(Ua.layout_line["line-sort-key"]),"line-z-offset":new Oa(Ua.layout_line["line-z-offset"]),"line-elevation-reference":new Ma(Ua.layout_line["line-elevation-reference"]),"line-cross-slope":new Ma(Ua.layout_line["line-cross-slope"]),visibility:new Ma(Ua.layout_line.visibility),"line-width-unit":new Ma(Ua.layout_line["line-width-unit"])})),paint:Xp||(Xp=new Da({"line-opacity":new Oa(Ua.paint_line["line-opacity"]),"line-color":new Oa(Ua.paint_line["line-color"]),"line-translate":new Ma(Ua.paint_line["line-translate"]),"line-translate-anchor":new Ma(Ua.paint_line["line-translate-anchor"]),"line-width":new Oa(Ua.paint_line["line-width"]),"line-gap-width":new Oa(Ua.paint_line["line-gap-width"]),"line-offset":new Oa(Ua.paint_line["line-offset"]),"line-blur":new Oa(Ua.paint_line["line-blur"]),"line-dasharray":new Oa(Ua.paint_line["line-dasharray"]),"line-pattern":new Oa(Ua.paint_line["line-pattern"]),"line-pattern-cross-fade":new Ma(Ua.paint_line["line-pattern-cross-fade"]),"line-gradient":new La(Ua.paint_line["line-gradient"]),"line-trim-offset":new Ma(Ua.paint_line["line-trim-offset"]),"line-trim-fade-range":new Ma(Ua.paint_line["line-trim-fade-range"]),"line-trim-color":new Ma(Ua.paint_line["line-trim-color"]),"line-emissive-strength":new Oa(Ua.paint_line["line-emissive-strength"]),"line-border-width":new Oa(Ua.paint_line["line-border-width"]),"line-border-color":new Oa(Ua.paint_line["line-border-color"]),"line-occlusion-opacity":new Ma(Ua.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},nm);class om extends Oa{possiblyEvaluate(e,t){return t=new Ba(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition,worldview:t.worldview}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,n){return t=Object.assign({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,n)}}let am;function sm(e,t){return t>0?t+2*e:e}const lm=ds([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),cm=ds([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),um=ds([{name:"a_projected_pos",components:4,type:"Float32"}],4);ds([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dm=ds([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),hm=ds([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),Am=ds([{name:"a_texb",components:2,type:"Uint16"}]),fm=ds([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),pm=ds([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ds([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const mm=ds([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),gm=ds([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ds([{name:"triangle",components:3,type:"Uint16"}]),ds([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ds([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ds([{type:"Float32",name:"offsetX"}]),ds([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var ym=24;function _m(e,t,r){return e.sections.forEach(e=>{e.text=function(e,t,r){const n=t.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),ba.applyArabicShaping&&(e=ba.applyArabicShaping(e)),e}(e.text,t,r)}),e}const vm={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function xm(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function wm(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const bm=4294967296,Bm=1/bm,Cm="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");let Em=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array(16);this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length;for(;this.pos<r;){const r=this.readVarint(),n=r>>3,i=this.pos;this.type=7&r,e(n,t,this),this.pos===i&&this.skip(r)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*bm;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*bm;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let r,n;return n=t[this.pos++],r=127&n,n<128?r:(n=t[this.pos++],r|=(127&n)<<7,n<128?r:(n=t[this.pos++],r|=(127&n)<<14,n<128?r:(n=t[this.pos++],r|=(127&n)<<21,n<128?r:(n=t[this.pos],r|=(15&n)<<28,function(e,t,r){const n=r.buf;let i,o;if(o=n[r.pos++],i=(112&o)>>4,o<128)return Sm(e,i,t);if(o=n[r.pos++],i|=(127&o)<<3,o<128)return Sm(e,i,t);if(o=n[r.pos++],i|=(127&o)<<10,o<128)return Sm(e,i,t);if(o=n[r.pos++],i|=(127&o)<<17,o<128)return Sm(e,i,t);if(o=n[r.pos++],i|=(127&o)<<24,o<128)return Sm(e,i,t);if(o=n[r.pos++],i|=(1&o)<<31,o<128)return Sm(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(r,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return Boolean(this.readVarint())}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Cm?Cm.decode(this.buf.subarray(t,e)):function(e,t,r){let n="",i=t;for(;i<r;){const t=e[i];let o,a,s,l=null,c=t>239?4:t>223?3:t>191?2:1;if(i+c>r)break;1===c?t<128&&(l=t):2===c?(o=e[i+1],128==(192&o)&&(l=(31&t)<<6|63&o,l<=127&&(l=null))):3===c?(o=e[i+1],a=e[i+2],128==(192&o)&&128==(192&a)&&(l=(15&t)<<12|(63&o)<<6|63&a,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(o=e[i+1],a=e[i+2],s=e[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&(l=(15&t)<<18|(63&o)<<12|(63&a)<<6|63&s,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=c}return n}(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readVarint(t));return e}readPackedSVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(e){const t=7&e;if(0===t)for(;this.buf[this.pos++]>127;);else if(2===t)this.pos=this.readVarint()+this.pos;else if(5===t)this.pos+=4;else{if(1!==t)throw new Error("Unimplemented type: ".concat(t));this.pos+=8}}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.dataView=new DataView(e.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Bm),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Bm),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(e,t){let r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(r=~(-e%4294967296),n=~(-e/4294967296),4294967295^r?r=r+1|0:(r=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,r.buf[r.pos]=127&(e>>>=7)}(r,0,t),function(e,t){const r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const t=this.pos;this.pos=function(e,t,r){for(let n,i,o=0;o<t.length;o++){if(n=t.charCodeAt(o),n>55295&&n<57344){if(!i){n>56319||o+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);const r=this.pos-t;r>=128&&Tm(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let r=0;r<t;r++)this.buf[this.pos++]=e[r]}writeRawMessage(e,t){this.pos++;const r=this.pos;e(t,this);const n=this.pos-r;n>=128&&Tm(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n}writeMessage(e,t,r){this.writeTag(e,2),this.writeRawMessage(t,r)}writePackedVarint(e,t){t.length&&this.writeMessage(e,Im,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,Fm,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,Mm,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,km,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,Pm,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,Om,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,Lm,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,Dm,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,Um,t)}writeBytesField(e,t){this.writeTag(e,2),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,5),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,5),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,1),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,1),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,0),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,0),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,2),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,5),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,1),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function Sm(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Tm(e,t,r){const n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(let i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function Im(e,t){for(let r=0;r<e.length;r++)t.writeVarint(e[r])}function Fm(e,t){for(let r=0;r<e.length;r++)t.writeSVarint(e[r])}function km(e,t){for(let r=0;r<e.length;r++)t.writeFloat(e[r])}function Pm(e,t){for(let r=0;r<e.length;r++)t.writeDouble(e[r])}function Mm(e,t){for(let r=0;r<e.length;r++)t.writeBoolean(e[r])}function Om(e,t){for(let r=0;r<e.length;r++)t.writeFixed32(e[r])}function Lm(e,t){for(let r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Dm(e,t){for(let r=0;r<e.length;r++)t.writeFixed64(e[r])}function Um(e,t){for(let r=0;r<e.length;r++)t.writeSFixed64(e[r])}const Rm=3;function zm(e,t,r){t.glyphs=[],1===e&&r.readMessage(Nm,t)}function Nm(e,t,r){if(3===e){const{id:e,bitmap:n,width:i,height:o,left:a,top:s,advance:l}=r.readMessage(jm,{});t.glyphs.push({id:e,bitmap:new wd({width:i+2*Rm,height:o+2*Rm},n),metrics:{width:i,height:o,left:a,top:s,advance:l}})}else 4===e?t.ascender=r.readSVarint():5===e&&(t.descender=r.readSVarint())}function jm(e,t,r){1===e?t.id=r.readVarint():2===e?t.bitmap=r.readBytes():3===e?t.width=r.readVarint():4===e?t.height=r.readVarint():5===e?t.left=r.readSVarint():6===e?t.top=r.readSVarint():7===e&&(t.advance=r.readVarint())}const Qm=Rm,Vm={horizontal:1,vertical:2,horizontalOnly:3};class Hm{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,t){const r=new Hm;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new Hm;return t.image=e,t}}class Gm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t,r){const n=new Gm;for(let i=0;i<e.sections.length;i++){const o=e.sections[i];o.image?n.addImageSection(o,r):n.addTextSection(o,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let r="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n+1)||null,o=e.charCodeAt(n-1)||null;r+=!t&&(i&&ca(i)&&!vm[e[n+1]]||o&&ca(o)&&!vm[e[n-1]])||!vm[e[n]]?e[n]:vm[e[n]]}return r}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&Wm[this.text.charCodeAt(r)];r++)e++;let t=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Wm[this.text.charCodeAt(r)];r--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const r=new Gm;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Hm.forText(e.scale,e.fontStack||t));const r=this.sections.length-1;for(let n=0;n<e.text.length;++n)this.sectionIndex.push(r)}addImageSection(e,t){const r=e.image?e.image.getPrimary():null;if(!r)return void We("Can't add FormattedSection with an empty image.");r.scaleSelf(t);const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(Hm.forImage(r)),this.sectionIndex.push(this.sections.length-1)):We("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Km(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f){let p=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;const m=Gm.fromFeature(e,i,p);d===Vm.vertical&&m.verticalizePunctuation(h);let g=[];const y=function(e,t,r,n,i,o){if(!e)return[];const a=[],s=function(e,t,r,n,i,o){let a=0;for(let s=0;s<e.length();s++){const r=e.getSection(s);a+=Zm(e.getCodePoint(s),r,n,i,t,o)}return a/Math.max(1,Math.ceil(a/r))}(e,t,r,n,i,o),l=e.text.indexOf("\u200b")>=0;let c=0;for(let d=0;d<e.length();d++){const r=e.getSection(d),h=e.getCodePoint(d);if(Wm[h]||(c+=Zm(h,r,n,i,t,o)),d<e.length()-1){const t=!((u=h)<11904||!(ia["Bopomofo Extended"](u)||ia.Bopomofo(u)||ia["CJK Compatibility Forms"](u)||ia["CJK Compatibility Ideographs"](u)||ia["CJK Compatibility"](u)||ia["CJK Radicals Supplement"](u)||ia["CJK Strokes"](u)||ia["CJK Symbols and Punctuation"](u)||ia["CJK Unified Ideographs Extension A"](u)||ia["CJK Unified Ideographs"](u)||ia["Enclosed CJK Letters and Months"](u)||ia["Halfwidth and Fullwidth Forms"](u)||ia.Hiragana(u)||ia["Ideographic Description Characters"](u)||ia["Kangxi Radicals"](u)||ia["Katakana Phonetic Extensions"](u)||ia.Katakana(u)||ia["Vertical Forms"](u)||ia["Yi Radicals"](u)||ia["Yi Syllables"](u)));(qm[h]||t||r.image)&&a.push(Jm(d+1,c,s,a,Ym(h,e.getCodePoint(d+1),t&&l),!1))}}var u;return $m(Jm(e.length(),c,s,a,0,!0))}(m,c,o,t,n,A),{processBidirectionalText:_,processStyledBidirectionalText:v}=ba;if(_&&1===m.sections.length){const e=_(m.toString(),y);for(const t of e){const e=new Gm;e.text=t,e.sections=m.sections;for(let r=0;r<t.length;r++)e.sectionIndex.push(0);g.push(e)}}else if(v){const e=v(m.text,m.sectionIndex,y);for(const t of e){const e=new Gm;e.text=t[0],e.sectionIndex=t[1],e.sections=m.sections,g.push(e)}}else g=function(e,t){const r=[],n=e.text;let i=0;for(const o of t)r.push(e.substring(i,o)),i=o;return i<n.length&&r.push(e.substring(i,n.length)),r}(m,y);const x=[],w={positionedLines:x,text:m.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:d,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(e,t,r,n,i,o,a,s,l,c,u,d){let h=0,A=0,f=0;const p="right"===s?1:"left"===s?0:.5;let m=!1;for(const w of i){const e=w.getSections();for(const r of e){if(r.image)continue;const e=t[r.fontStack];if(e&&(m=void 0!==e.ascender&&void 0!==e.descender,!m))break}if(!m)break}let g=0;for(const w of i){w.trim();const i=w.getMaxScale(),a=(i-1)*ym,s={positionedGlyphs:[],lineOffset:0};e.positionedLines[g]=s;const _=s.positionedGlyphs;let v=0;if(!w.length()){A+=o,++g;continue}let x=0,b=0;for(let o=0;o<w.length();o++){const a=w.getSection(o),s=w.getSectionIndex(o),f=w.getCodePoint(o);let p=a.scale,g=null,B=null,C=null,E=ym,S=0,T=l;T===Vm.vertical&&(12312===(y=f)||12313===y||12316===y||12540===y||12448===y)&&(T=Vm.horizontal);const I=!(T===Vm.horizontal||!u&&!la(f)||u&&(Wm[f]||ua(f)));if(a.image){const t=n.get(a.image.toString());if(!t)continue;C=a.image,e.iconsInText=e.iconsInText||!0,B=t.paddedRect;const r=t.displaySize;p=p*ym/d,g={width:r[0],height:r[1],left:0,top:-Qm,advance:I?r[1]:r[0],localGlyph:!1},S=m?-g.height*p:i*ym-17-r[1]*p,E=g.advance;const o=(I?r[0]:r[1])*p-ym*i;o>0&&o>v&&(v=o)}else{const e=r[a.fontStack];if(!e)continue;e[f]&&(B=e[f]);const n=t[a.fontStack];if(!n)continue;const o=n.glyphs[f];if(!o)continue;if(g=o.metrics,E=8203!==f?ym:0,m){const e=void 0!==n.ascender?Math.abs(n.ascender):0,t=void 0!==n.descender?Math.abs(n.descender):0,r=(e+t)*p;x<r&&(x=r,b=(e-t)/2*p),S=-e*p}else S=(i-p)*ym-17}I?(e.verticalizable=!0,_.push({glyph:f,image:C,x:h,y:A+S,vertical:I,scale:p,localGlyph:g.localGlyph,fontStack:a.fontStack,sectionIndex:s,metrics:g,rect:B}),h+=E*p+c):(_.push({glyph:f,image:C,x:h,y:A+S,vertical:I,scale:p,localGlyph:g.localGlyph,fontStack:a.fontStack,sectionIndex:s,metrics:g,rect:B}),h+=g.advance*p+c)}0!==_.length&&(f=Math.max(h-c,f),m?tg(_,p,v,b,o*i/2):tg(_,p,v,0,o/2)),h=0;const B=o*i+v;s.lineOffset=Math.max(v,a),A+=B,++g}var y;const _=A,{horizontalAlign:v,verticalAlign:x}=eg(a);(function(e,t,r,n,i,o){const a=(t-r)*i,s=-o*n;for(const l of e)for(const e of l.positionedGlyphs)e.x+=a,e.y+=s})(e.positionedLines,p,v,x,f,_),e.top+=-x*_,e.bottom=e.top+_,e.left+=-v*f,e.right=e.left+f,e.hasBaseline=m}(w,t,r,n,g,a,s,l,d,c,h,f),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(x))return w}const Wm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},qm={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Zm(e,t,r,n,i,o){if(t.image){const e=n.get(t.image.toString());return e?e.displaySize[0]*t.scale*ym/o+i:0}{const n=r[t.fontStack],o=n&&n.glyphs[e];return o?o.metrics.advance*t.scale+i:0}}function Xm(e,t,r,n){const i=Math.pow(e-t,2);return n?e<t?i/2:2*i:i+Math.abs(r)*r}function Ym(e,t,r){let n=0;return 10===e&&(n-=1e4),r&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function Jm(e,t,r,n,i,o){let a=null,s=Xm(t,r,i,o);for(const l of n){const e=Xm(t-l.x,r,i,o)+l.badness;e<=s&&(a=l,s=e)}return{index:e,x:t,priorBreak:a,badness:s}}function $m(e){return e?$m(e.priorBreak).concat(e.index):[]}function eg(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function tg(e,t,r,n,i){if(!(t||r||n||i))return;const o=e.length-1,a=e[o],s=(a.x+a.metrics.advance*a.scale)*t;for(let l=0;l<=o;l++)e[l].x-=s,e[l].y+=r+n+i}function rg(e){return void 0!==e.imagePrimary&&void 0!==e.top&&void 0!==e.bottom&&void 0!==e.left&&void 0!==e.right}function ng(e,t,r,n){const{horizontalAlign:i,verticalAlign:o}=eg(n),a=r[0]-e.displaySize[0]*i,s=r[1]-e.displaySize[1]*o;return{imagePrimary:e,imageSecondary:t,top:s,bottom:s+e.displaySize[1],left:a,right:a+e.displaySize[0]}}function ig(e,t,r,n,i,o){const a=e.imagePrimary;let s;if(a.content){const e=a.content,t=a.pixelRatio||1;s=[e[0]/t,e[1]/t,a.displaySize[0]-e[2]/t,a.displaySize[1]-e[3]/t]}const l=t.left*o,c=t.right*o;let u,d,h,A;"width"===r||"both"===r?(A=i[0]+l-n[3],d=i[0]+c+n[1]):(A=i[0]+(l+c-a.displaySize[0])/2,d=A+a.displaySize[0]);const f=t.top*o,p=t.bottom*o;return"height"===r||"both"===r?(u=i[1]+f-n[0],h=i[1]+p+n[2]):(u=i[1]+(f+p-a.displaySize[1])/2,h=u+a.displaySize[1]),{imagePrimary:a,imageSecondary:void 0,top:u,right:d,bottom:h,left:A,collisionPadding:s}}function og(e){return!e.imagePrimary.stretchX}function ag(e){return!e.imagePrimary.stretchY}function sg(e){return{width:e.right-e.left,height:e.bottom-e.top}}const lg=128;function cg(e,t,r){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new Ba(e+1,{worldview:r}))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=n;let o=0;for(;o<t.length&&t[o]<=e;)o++;o=Math.max(0,o-1);let a=o;for(;a<t.length&&t[a]<e+1;)a++;a=Math.min(t.length-1,a);const s=t[o],l=t[a];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:l,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:l,minSize:n.evaluate(new Ba(s,{worldview:r})),maxSize:n.evaluate(new Ba(l,{worldview:r})),interpolationType:i}}}function ug(e,t,r){let{uSize:n,uSizeT:i}=t,{lowerSize:o,upperSize:a}=r;return"source"===e.kind?o/lg:"composite"===e.kind?hr(o/lg,a/lg,i):n}function dg(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=0,i=0;if("constant"===e.kind)i=e.layoutSize*r;else if("source"!==e.kind){const{interpolationType:o,minZoom:a,maxZoom:s}=e,l=o?Oe(Wi.interpolationFactor(o,t,a,s),0,1):0;"camera"===e.kind?i=hr(e.minSize,e.maxSize,l)*r:n=l*r}return{uSizeT:n,uSize:i}}class hg extends Be{constructor(e,t,r,n,i){super(e,t),this.angle=n,this.z=r,void 0!==i&&(this.segment=i)}clone(){return new hg(this.x,this.y,this.z,this.angle,this.segment)}}function Ag(e,t,r,n,i){if(void 0===t.segment)return!0;let o=t,a=t.segment+1,s=0;for(;s>-r/2;){if(a--,a<0)return!1;s-=e[a].dist(o),o=e[a]}s+=e[a].dist(e[a+1]),a++;const l=[];let c=0;for(;s<r/2;){const t=e[a],r=e[a+1];if(!r)return!1;let o=e[a-1].angleTo(t)-t.angleTo(r);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:s,angleDelta:o}),c+=o;s-l[0].distance>n;)c-=l.shift().angleDelta;if(c>i)return!1;a++,s+=t.dist(r)}return!0}function fg(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function pg(e,t,r){return e?.6*t*r:0}function mg(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function gg(e,t,r,n,i,o){const a=pg(r,i,o),s=mg(r,n)*o;let l=0;const c=fg(e)/2;for(let u=0;u<e.length-1;u++){const r=e[u],n=e[u+1],i=r.dist(n);if(l+i>c){const o=(c-l)/i,d=hr(r.x,n.x,o),h=hr(r.y,n.y,o),A=new hg(d,h,0,n.angleTo(r),u);return!a||Ag(e,A,s,a,t)?A:void 0}l+=i}}function yg(e,t,r,n,i,o,a,s,l){const c=pg(n,o,a),u=mg(n,i),d=u*a,h=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-d<t/4&&(t=d+t/4),_g(e,h?t/2*s%t:(u/2+2*o)*a*s%t,t,c,r,d,h,!1,l)}function _g(e,t,r,n,i,o,a,s,l){const c=o/2,u=fg(e);let d=0,h=t-r,A=[];for(let f=0;f<e.length-1;f++){const t=e[f],a=e[f+1],s=t.dist(a),p=a.angleTo(t);for(;h+r<d+s;){h+=r;const m=(h-d)/s,g=hr(t.x,a.x,m),y=hr(t.y,a.y,m);if(g>=0&&g<l&&y>=0&&y<l&&h-c>=0&&h+c<=u){const t=new hg(g,y,0,p,f);n&&!Ag(e,t,o,n,i)||A.push(t)}}d+=s}return s||A.length||a||(A=_g(e,d/2,r,n,i,o,a,!0,l)),A}function vg(e){let t=0,r=0;for(const a of e)t+=a.w*a.h,r=Math.max(r,a.w);e.sort((e,t)=>t.h-e.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let i=0,o=0;for(const a of e)for(let e=n.length-1;e>=0;e--){const t=n[e];if(!(a.w>t.w||a.h>t.h)){if(a.x=t.x,a.y=t.y,o=Math.max(o,a.y+a.h),i=Math.max(i,a.x+a.w),a.w===t.w&&a.h===t.h){const t=n.pop();t&&e<n.length&&(n[e]=t)}else a.h===t.h?(t.x+=a.w,t.w-=a.w):a.w===t.w?(t.y+=a.h,t.h-=a.h):(n.push({x:t.x+a.w,y:t.y,w:t.w-a.w,h:a.h}),t.y+=a.h,t.h-=a.h);break}}return{w:i,h:o,fill:t/(i*o)||0}}ea(hg,"Anchor");const xg=1;class wg{static getImagePositionScale(e,t,r){if(t&&e){const{sx:t,sy:r}=e;return{x:t,y:r}}return{x:r,y:r}}constructor(e,t,r,n){this.paddedRect=e;const{pixelRatio:i,version:o,stretchX:a,stretchY:s,content:l,sdf:c,usvg:u}=t;this.pixelRatio=i,this.stretchX=a,this.stretchY=s,this.content=l,this.version=o,this.padding=r,this.sdf=c,this.usvg=u,this.scale=wg.getImagePositionScale(n,u,i)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function bg(e,t,r){const n=Ur.parse(e),i=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1];return{x:0,y:0,w:(e.data?e.data.width:e.width*r[0])+2*t,h:(e.data?e.data.height:e.height*r[1])+2*t}}(t,r,[n.sx,n.sy]);return{bin:i,imagePosition:new wg(i,t,r,n),imageVariant:n}}class Bg{constructor(e,t,r){const n=new Map,i=new Map;this.haveRenderCallbacks=[];const o=[];this.addImages(e,n,xg,o),this.addImages(t,i,2,o);const{w:a,h:s}=vg(o),l=new bd({width:a||1,height:s||1});for(const[c,u]of e.entries()){const e=n.get(c).paddedRect;bd.copy(u.data,l,{x:0,y:0},{x:e.x+xg,y:e.y+xg},u.data,null,u.sdf)}for(const[c,u]of t.entries()){const e=i.get(c),t=e.paddedRect;let n=e.padding;const o=t.x+n,a=t.y+n,s=u.data.width,d=u.data.height;n=n>1?n-1:n,bd.copy(u.data,l,{x:0,y:0},{x:o,y:a},u.data,r),bd.copy(u.data,l,{x:0,y:d-n},{x:o,y:a-n},{width:s,height:n},r),bd.copy(u.data,l,{x:0,y:0},{x:o,y:a+d},{width:s,height:n},r),bd.copy(u.data,l,{x:s-n,y:0},{x:o-n,y:a},{width:n,height:d},r),bd.copy(u.data,l,{x:0,y:0},{x:o+s,y:a},{width:n,height:d},r),bd.copy(u.data,l,{x:s-n,y:d-n},{x:o-n,y:a-n},{width:n,height:n},r),bd.copy(u.data,l,{x:0,y:d-n},{x:o+s,y:a-n},{width:n,height:n},r),bd.copy(u.data,l,{x:0,y:0},{x:o+s,y:a+d},{width:n,height:n},r),bd.copy(u.data,l,{x:s-n,y:0},{x:o-n,y:a+d},{width:n,height:n},r)}this.lut=r,this.image=l,this.iconPositions=n,this.patternPositions=i}addImages(e,t,r,n){for(const[i,o]of e.entries()){const{bin:e,imagePosition:a,imageVariant:s}=bg(i,o,r);t.set(i,a),n.push(e),o.hasRenderCallback&&this.haveRenderCallbacks.push(s.id)}}patchUpdatedImages(e,t,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(t=>e.hasImage(t,r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const n of e.getUpdatedImages(r)){for(const i of this.iconPositions.keys()){const o=Ur.parse(i);if(ir.isEqual(o.id,n)){const o=e.getImage(n,r);this.patchUpdatedImage(this.iconPositions.get(i),o,t,null)}}for(const i of this.patternPositions.keys()){const o=Ur.parse(i);if(ir.isEqual(o.id,n)){const o=e.getImage(n,r);this.patchUpdatedImage(this.patternPositions.get(i),o,t,this.lut)}}}}patchUpdatedImage(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,o]=e.tl,a=e.sdf;if(this.lut||a){const e={width:t.data.width,height:t.data.height},s=new bd(e);bd.copy(t.data,s,{x:0,y:0},{x:0,y:0},e,n,a),r.update(s,{position:{x:i,y:o}})}else r.update(t.data,{position:{x:i,y:o}})}}ea(wg,"ImagePosition"),ea(Bg,"ImageAtlas");const Cg=1e20;function Eg(e,t,r,n,i,o,a,s,l){for(let c=t;c<t+n;c++)Sg(e,r*o+c,o,i,a,s,l);for(let c=r;c<r+i;c++)Sg(e,c*o+t,1,n,a,s,l)}function Sg(e,t,r,n,i,o,a){o[0]=0,a[0]=-Cg,a[1]=Cg,i[0]=e[t];for(let s=1,l=0,c=0;s<n;s++){i[s]=e[t+s*r];const n=s*s;do{const e=o[l];c=(i[s]-i[e]+n-e*e)/(s-e)/2}while(c<=a[l]&&--l>-1);l++,o[l]=s,a[l]=c,a[l+1]=Cg}for(let s=0,l=0;s<n;s++){for(;a[l+1]<s;)l++;const n=o[l],c=s-n;e[t+s*r]=i[n]+c*c}}const Tg=2,Ig={none:0,ideographs:1,all:2};class Fg{constructor(e,t,r){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=r,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const r=[],n=this.url||at.GLYPHS_URL;for(const i in e)for(const t of e[i])r.push({stack:i,id:t});Ue(r,(e,t)=>{let{stack:r,id:i}=e,o=this.entries[r];o||(o=this.entries[r]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let a=o.glyphs[i];if(void 0!==a)return void t(null,{stack:r,id:i,glyph:a});if(a=this._tinySDF(o,r,i),a)return o.glyphs[i]=a,void t(null,{stack:r,id:i,glyph:a});const s=Math.floor(i/256);if(256*s>65535)return We("glyphs > 65535 not supported"),void t(null,{stack:r,id:i,glyph:a});if(o.ranges[s])return void t(null,{stack:r,id:i,glyph:a});let l=o.requests[s];l||(l=o.requests[s]=[],Fg.loadGlyphRange(r,s,n,this.requestManager,(e,t)=>{if(t){o.ascender=t.ascender,o.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(o.glyphs[+e]=t.glyphs[+e]);o.ranges[s]=!0}for(const r of l)r(e,t);delete o.requests[s]})),l.push((e,n)=>{e?t(e):n&&t(null,{stack:r,id:i,glyph:n.glyphs[i]||null})})},(e,r)=>{if(e)t(e);else if(r){const e={};for(const{stack:t,id:n,glyph:i}of r)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[n]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ig.none&&(this.localGlyphMode===Ig.all?!!this.localFontFamily:!!this.localFontFamily&&(ia["CJK Unified Ideographs"](e)||ia["Hangul Syllables"](e)||ia.Hiragana(e)||ia.Katakana(e)||ia["CJK Symbols and Punctuation"](e)||ia["CJK Unified Ideographs Extension A"](e)||ia["CJK Unified Ideographs Extension B"](e)||ia.Osage(e)))}_tinySDF(e,t,r){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(r))return;let i=e.tinySDF;if(!i){let r="400";/bold/i.test(t)?r="900":/medium/i.test(t)?r="500":/light/i.test(t)&&(r="200"),i=e.tinySDF=new Fg.TinySDF({fontFamily:n,fontWeight:r,fontSize:24*Tg,buffer:3*Tg,radius:8*Tg}),i.fontWeight=r}if(this.localGlyphs[i.fontWeight][r])return this.localGlyphs[i.fontWeight][r];const o=String.fromCodePoint(r),{data:a,width:s,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:d,glyphTop:h,glyphAdvance:A}=i.draw(o);return this.localGlyphs[i.fontWeight][r]={id:r,bitmap:new wd({width:s,height:l},a),metrics:{width:c/Tg,height:u/Tg,left:d/Tg,top:h/Tg-27,advance:A/Tg,localGlyph:!0}}}}Fg.loadGlyphRange=function(e,t,r,n,i){const o=256*t,a=o+255,s=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}","".concat(o,"-").concat(a)),Lt.Glyphs);zt(s,(e,t)=>{if(e)i(e);else if(t){const e={},r=function(e){return new Em(e).readFields(zm,{})}(t);for(const t of r.glyphs)e[t.id]=t;i(null,{glyphs:e,ascender:r.ascender,descender:r.descender})}})},Fg.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:r=8,cutoff:n=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:a="normal",lang:s=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=n,this.radius=r,this.lang=s;const l=this.size=e+4*t,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font="".concat(a," ").concat(o," ").concat(e,"px ").concat(i),u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(e),a=Math.ceil(r),s=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-i))),l=Math.min(this.size-this.buffer,a+Math.ceil(n)),c=s+2*this.buffer,u=l+2*this.buffer,d=Math.max(c*u,0),h=new Uint8ClampedArray(d),A={data:h,width:c,height:u,glyphWidth:s,glyphHeight:l,glyphTop:a,glyphLeft:0,glyphAdvance:t};if(0===s||0===l)return A;const{ctx:f,buffer:p,gridInner:m,gridOuter:g}=this;this.lang&&(f.lang=this.lang),f.clearRect(p,p,s,l),f.fillText(e,p,p+a);const y=f.getImageData(p,p,s,l);g.fill(Cg,0,d),m.fill(0,0,d);for(let _=0;_<l;_++)for(let e=0;e<s;e++){const t=y.data[4*(_*s+e)+3]/255;if(0===t)continue;const r=(_+p)*c+e+p;if(1===t)g[r]=0,m[r]=Cg;else{const e=.5-t;g[r]=e>0?e*e:0,m[r]=e<0?e*e:0}}Eg(g,0,0,c,u,c,this.f,this.v,this.z),Eg(m,p,p,s,l,c,this.f,this.v,this.z);for(let _=0;_<d;_++){const e=Math.sqrt(g[_])-Math.sqrt(m[_]);h[_]=Math.round(255-255*(e/this.radius+this.cutoff))}return A}};const kg=xg;function Pg(e,t){return e+t[1]-t[0]}function Mg(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const o=[],a=e.imagePrimary,s=a.pixelRatio,l=a.paddedRect.w-2*kg,c=a.paddedRect.h-2*kg,u=(e.right-e.left)*i,d=(e.bottom-e.top)*i,h=a.stretchX||[[0,l]],A=a.stretchY||[[0,c]],f=h.reduce(Pg,0),p=A.reduce(Pg,0),m=l-f,g=c-p;let y=0,_=f,v=0,x=p,w=0,b=m,B=0,C=g;if(a.content&&n){const e=a.content;y=Lg(h,0,e[0]),v=Lg(A,0,e[1]),_=Lg(h,e[0],e[2]),x=Lg(A,e[1],e[3]),w=e[0]-y,B=e[1]-v,b=e[2]-e[0]-_,C=e[3]-e[1]-x}const E=(n,o,l,c)=>{const h=Rg(n.stretch-y,_,u,e.left*i),A=zg(n.fixed-w,b,n.stretch,f),m=Rg(o.stretch-v,x,d,e.top*i),g=zg(o.fixed-B,C,o.stretch,p),E=Rg(l.stretch-y,_,u,e.left*i),S=zg(l.fixed-w,b,l.stretch,f),T=Rg(c.stretch-v,x,d,e.top*i),I=zg(c.fixed-B,C,c.stretch,p),F=new Be(h,m),k=new Be(E,m),P=new Be(E,T),M=new Be(h,T),O=new Be(A/s,g/s),L=new Be(S/s,I/s),D=t*Math.PI/180;if(D){const e=Math.sin(D),t=Math.cos(D),r=[t,-e,e,t];F._matMult(r),k._matMult(r),M._matMult(r),P._matMult(r)}const U=n.stretch+n.fixed,R=l.stretch+l.fixed,z=o.stretch+o.fixed,N=c.stretch+c.fixed,j=e.imageSecondary;return{tl:F,tr:k,bl:M,br:P,texPrimary:{x:a.paddedRect.x+kg+U,y:a.paddedRect.y+kg+z,w:R-U,h:N-z},texSecondary:j?{x:j.paddedRect.x+kg+U,y:j.paddedRect.y+kg+z,w:R-U,h:N-z}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:L,minFontScaleX:b/s/u,minFontScaleY:C/s/d,isSDF:r}};if(n&&(a.stretchX||a.stretchY)){const e=Dg(h,m,f),t=Dg(A,g,p);for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++)o.push(E(n,t[e],i,t[e+1]))}}else o.push(E({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return o}function Og(e,t){const r=e.stretchY||[[0,e.paddedRect.h-2*kg]];return t&&(e.stretchX||e.stretchY)?Ug(e.stretchX||[[0,e.paddedRect.w-2*kg]])*Ug(r):1}function Lg(e,t,r){let n=0;for(const i of e)n+=Math.max(t,Math.min(r,i[1]))-Math.max(t,Math.min(r,i[0]));return n}function Dg(e,t,r){const n=[{fixed:-kg,stretch:0}];for(const[i,o]of e){const e=n[n.length-1];n.push({fixed:i-e.stretch,stretch:e.stretch}),n.push({fixed:i-e.stretch,stretch:e.stretch+(o-i)})}return n.push({fixed:t+kg,stretch:r}),n}function Ug(e){return 2*e.length+1}function Rg(e,t,r,n){return e/t*r+n}function zg(e,t,r,n){return e-t*r/n}function Ng(e,t,r,n){const i=t+e.positionedLines[n].lineOffset;return 0===n?r+i/2:r+(i+(t+e.positionedLines[n-1].lineOffset))/2}function jg(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=1/0,i=1/0,o=-1/0,a=-1/0;const s=e[0];for(let A=0;A<s.length;A++){const e=s[A];(!A||e.x<n)&&(n=e.x),(!A||e.y<i)&&(i=e.y),(!A||e.x>o)&&(o=e.x),(!A||e.y>a)&&(a=e.y)}const l=Math.min(o-n,a-i);let c=l/2;const u=new zn([],Qg);if(0===l)return new Be(n,i);for(let A=n;A<o;A+=l)for(let t=i;t<a;t+=l)u.push(new Vg(A+c,t+c,c,e));let d=function(e){let t=0,r=0,n=0;const i=e[0];for(let o=0,a=i.length,s=a-1;o<a;s=o++){const e=i[o],a=i[s],l=e.x*a.y-a.x*e.y;r+=(e.x+a.x)*l,n+=(e.y+a.y)*l,t+=3*l}return new Vg(r/t,n/t,0,e)}(e),h=u.length;for(;u.length;){const n=u.pop();(n.d>d.d||!d.d)&&(d=n,r&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,h)),n.max-d.d<=t||(c=n.h/2,u.push(new Vg(n.p.x-c,n.p.y-c,c,e)),u.push(new Vg(n.p.x+c,n.p.y-c,c,e)),u.push(new Vg(n.p.x-c,n.p.y+c,c,e)),u.push(new Vg(n.p.x+c,n.p.y+c,c,e)),h+=4)}return r&&(console.log("num probes: ".concat(h)),console.log("best distance: ".concat(d.d))),d.p}function Qg(e,t){return t.max-e.max}class Vg{constructor(e,t,r,n){this.p=new Be(e,t),this.h=r,this.d=function(e,t){let r=!1,n=1/0;for(let i=0;i<t.length;i++){const o=t[i];for(let t=0,i=o.length,a=i-1;t<i;a=t++){const i=o[t],s=o[a];i.y>e.y!=s.y>e.y&&e.x<(s.x-i.x)*(e.y-i.y)/(s.y-i.y)+i.x&&(r=!r),n=Math.min(n,Au(e,i,s))}}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}const Hg=Object.keys,Gg=Number.POSITIVE_INFINITY,Kg=Math.sqrt(2);function Wg(e,t,r,n,i){const o=rg(e)&&e.collisionPadding?e.collisionPadding:[0,0,0,0],a={top:e.top-o[1],bottom:e.bottom+o[3],left:e.left-o[0],right:e.right+o[2],scaled:!1};return void 0!==n&&function(e,t){e.top*=t,e.bottom*=t,e.left*=t,e.right*=t,e.scaled=!0}(a,n),r&&function(e,t){if(!t)return;const r=Te(t),n=new Be(e.left,e.top),i=new Be(e.right,e.top),o=new Be(e.left,e.bottom),a=new Be(e.right,e.bottom),s=new Be(0,0);n._rotateAround(r,s),i._rotateAround(r,s),o._rotateAround(r,s),a._rotateAround(r,s),e.left=Math.min(n.x,i.x,o.x,a.x),e.right=Math.max(n.x,i.x,o.x,a.x),e.top=Math.min(n.y,i.y,o.y,a.y),e.bottom=Math.max(n.y,i.y,o.y,a.y)}(a,r),i&&(a.left+=i[0],a.right+=i[0],a.top+=i[1],a.bottom+=i[1]),t?{top:Math.min(t.top,a.top),bottom:Math.max(t.bottom,a.bottom),left:Math.min(t.left,a.left),right:Math.max(t.right,a.right),scaled:t.scaled||a.scaled}:a}function qg(e,t){let[r,n]=t,i=0,o=0;if(n===Gg){r<0&&(r=0);const t=r/Kg;switch(e){case"top-right":case"top-left":o=t-7;break;case"bottom-right":case"bottom-left":o=7-t;break;case"bottom":o=7-r;break;case"top":o=r-7}switch(e){case"top-right":case"bottom-right":i=-t;break;case"top-left":case"bottom-left":i=t;break;case"left":i=r;break;case"right":i=-r}}else{switch(r=Math.abs(r),n=Math.abs(n),e){case"top-right":case"top-left":case"top":o=n-7;break;case"bottom-right":case"bottom-left":case"bottom":o=7-n}switch(e){case"top-right":case"bottom-right":case"right":i=-r;break;case"top-left":case"bottom-left":case"left":i=r}}return[i,o]}function Zg(e,t,r,n,i,o,a,s,l,c,u,d,h,A){const f=e.layers[0],p=f.appearances;if(0===p.length)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const m={iconBBox:null,iconVerticalBBox:null},g={textBBox:null,textVerticalBBox:null},{baseIconRotate:y,baseTextRotate:_,iconScaleFactor:v}=function(e,t,r){const n=e.get("icon-rotate").evaluate(t,{},r),i=e.get("text-rotate").evaluate(t,{},r),[o,a]=e.get("icon-size-scale-range");return{baseIconRotate:n,baseTextRotate:i,iconScaleFactor:Oe(1,o,a)}}(n,i,o);t&&(m.iconBBox=Wg(t,m.iconBBox,y,a),r)&&(m.iconVerticalBBox=Wg(r,m.iconVerticalBBox,y+90,a));const x=dy(d.horizontal);x&&(g.textBBox=Wg(x,g.textBBox,_,1,A)),d.vertical&&(g.textVerticalBBox=Wg(d.vertical,g.textVerticalBBox,_+90,1,A));for(const w of p)w.hasIconProperties()&&Xg(m,e,f,w,i,o,s,y,a,l,t,c,v,u),w.hasTextProperties()&&Yg(g,f,w,i,o,A,_,h,x,d.vertical);return{iconBBox:m.iconBBox,iconVerticalBBox:m.iconVerticalBBox,textBBox:g.textBBox,textVerticalBBox:g.textVerticalBBox}}function Xg(e,t,r,n,i,o,a,s,l,c,u,d,h,A){const{appearanceIconOffset:f,appearanceIconRotate:p,appearanceIconSize:m}=function(e,t,r,n,i,o,a,s){const l=e.hasProperty("icon-offset")?t.getAppearanceValueAndResolveTokens(e,"icon-offset",r,n,[]):null,c=l&&Array.isArray(l)?l:i,u=e.hasProperty("icon-rotate")?t.getAppearanceValueAndResolveTokens(e,"icon-rotate",r,n,[]):null,d="number"==typeof u?u:o,h=e.hasProperty("icon-size")?t.getAppearanceValueAndResolveTokens(e,"icon-size",r,n,[]):null;return{appearanceIconOffset:c,appearanceIconRotate:d,appearanceIconSize:"number"==typeof h?h*s.iconScaleFactor:a}}(n,r,i,o,a,s,l,c);let g=null,y=null,_=null;n.hasProperty("icon-image")?_=function(e,t,r,n,i,o,a){let s=null;const l=t.getAppearanceValueAndResolveTokens(r,"icon-image",n,i,[]);if(l){const t=e.getResolvedImageFromTokens(l),c=r.getUnevaluatedProperty("icon-size"),u=ey(t,cg(e.zoom,c,e.worldview),c,i,e.zoom,n,e.pixelRatio,a,e.worldview);s=o.get(u.iconPrimary.toString())}return s}(t,r,n,i,o,d,h):u&&(_=u.imagePrimary),_&&(g=ng(_,null,f,A),t.allowVerticalPlacement&&(y=ng(_,null,f,A))),g&&(e.iconBBox=Wg(g,e.iconBBox,p,m)),y&&(e.iconVerticalBBox=Wg(y,e.iconVerticalBBox,p+90,m))}function Yg(e,t,r,n,i,o,a,s,l,c){const{appearanceTextOffset:u,appearanceTextRotate:d,appearanceTextSize:h}=function(e,t,r,n,i,o,a){const s=e.hasProperty("text-offset")?t.getAppearanceValueAndResolveTokens(e,"text-offset",r,n,[]):null,l=s&&Array.isArray(s)?[s[0]*ym,s[1]*ym]:i,c=e.hasProperty("text-rotate")?t.getAppearanceValueAndResolveTokens(e,"text-rotate",r,n,[]):null,u="number"==typeof c?c:o,d=e.hasProperty("text-size")?t.getAppearanceValueAndResolveTokens(e,"text-size",r,n,[]):null;return{appearanceTextOffset:l,appearanceTextRotate:u,appearanceTextSize:"number"==typeof d?d:a}}(r,t,n,i,o,a,s),A=h/s;l&&(e.textBBox=Wg(l,e.textBBox,d,A,u)),c&&(e.textVerticalBBox=Wg(c,e.textVerticalBBox,d+90,A,u))}function Jg(e,t,r,n,i,o,a,s,l){if(!t||!t.usvg)return;const c=sg(n),u=sg(i),d="both"!==o&&"width"!==o||!og(n)?1:u.width/c.width,h="both"!==o&&"height"!==o||!ag(n)?1:u.height/c.height;r.scaleSelf(d,h);const A=r.toString();a.set(A,r),s.set(A,t);const{imagePosition:f}=bg(A,t,xg);l.set(A,f)}function $g(e,t,r,n,i,o,a,s,l){if(!e)return;const c=function(e,t,r,n,i,o){if("camera"===e.kind)return e.maxSize;if("composite"===e.kind){const n=t.possiblyEvaluate(new Ba(e.maxZoom,{worldview:o}),r).evaluate(i,{},r),a=t.possiblyEvaluate(new Ba(e.minZoom,{worldview:o}),r).evaluate(i,{},r);return Math.max(n,a)}return t.possiblyEvaluate(new Ba(n,{worldview:o})).evaluate(i,{},r)}(t,r,n,i,o,l);return e.scaleSelf(c*s*a)}function ey(e,t,r,n,i,o,a,s,l){return{iconPrimary:$g(e.getPrimary(),t,r,n,i,o,a,s,l),iconSecondary:$g(e.getSecondary(),t,r,n,i,o,a,s,l)}}function ty(e,t,r){if(!t)return;const n=r.get(e.toString()),i=r.get(t.toString());n&&i&&(n.paddedRect.w===i.paddedRect.w&&n.paddedRect.h===i.paddedRect.h||We("Mismatch in icon variant sizes: ".concat(e.toString()," and ").concat(t.toString())),n.usvg!==i.usvg&&We("Mismatch in icon variant image types: ".concat(e.id," and ").concat(t.id)))}function ry(e,t,r,n){if(!e)return;const i=t.get(r.toString());if(e.imagePrimary=i,n){const r=t.get(n.toString());e.imageSecondary=r}}function ny(e,t){for(const r in e.horizontal)iy(e.horizontal[r],t);iy(e.vertical,t)}function iy(e,t){if(e)for(const r of e.positionedLines)for(const e of r.positionedGlyphs)if(null!==e.image){const r=e.image.toString();e.rect=t.get(r).paddedRect}}function oy(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ay(e,t,r,n,i,o,a,s,l){const c=dy(o.horizontal)||o.vertical,u=r.get("icon-text-fit-padding").evaluate(n,{},i);let d,h=t;return t&&"none"!==l&&(e.allowVerticalPlacement&&o.vertical&&(d=ig(t,o.vertical,l,u,s,a)),c&&(h=ig(t,c,l,u,s,a))),{defaultShapedIcon:h,verticallyShapedIcon:d}}function sy(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x,w,b){let B=a.textMaxSize.evaluate(t,{},h);void 0===B?B=s*a.textScaleFactor:B*=a.textScaleFactor;const C=e.layers[0].layout,E=ym,S=s*a.textScaleFactor/E,T=dy(r.horizontal)||r.vertical;if("none"!==m&&e.appearanceFeatureData&&t.index<e.appearanceFeatureData.length){const r=e.appearanceFeatureData[t.index];r&&(r.textShaping=T,r.iconTextFitPadding=C.get("icon-text-fit-padding").evaluate(t,{},h),r.fontScale=S)}const I="globe"===A.name,F=e.tilePixelRatio*B/E,k=(U=e.overscaling,e.zoom>18&&U>2&&(U>>=1),Math.max(Nn/(512*U),1)*C.get("symbol-spacing")),P=C.get("text-padding")*e.tilePixelRatio,M=C.get("icon-padding")*e.tilePixelRatio,O=Te(C.get("text-max-angle")),L="map"===C.get("icon-rotation-alignment")&&"point"!==_,D=k/2;var U;!1===e.hasAnyIconTextFit&&"none"!==m&&(e.hasAnyIconTextFit=!0);const R=t.properties?+t.properties[Uc]:null,z=R&&e.elevationFeatureIdToIndex?e.elevationFeatureIdToIndex.get(R):65535,N=(s,l,_)=>{if(l.x<0||l.x>=Nn||l.y<0||l.y>=Nn)return;let b=null;if(I){const{x:e,y:t,z:r}=A.projectTilePoint(l.x,l.y,_);b={anchor:new hg(e,t,r,0,void 0),up:A.upVector(_,l.x,l.y)}}!function(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x,w,b,B,C,E,S,T,I,F,k){const P=e.addToLineVertexArray(t,n);let M,O,L,D,U,R,z,N=0,j=0,Q=0,V=0,H=-1,G=-1;const K={};let W=Jt("");const q=r?r.anchor:t,Z="none"!==S;let X=0,Y=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")){const e=l.layout.get("text-offset").evaluate(v,{},B);X=e[0]*ym,Y=e[1]*ym}else X=l.layout.get("text-radial-offset").evaluate(v,{},B)*ym,Y=Gg;if(e.allowVerticalPlacement&&i.vertical){const e=i.vertical;if(f)R=Ay(e),s&&(z=Ay(s));else{const r=l.layout.get("text-rotate").evaluate(v,{},B)+90;L=hy(c,q,t,u,d,h,e,A,r,p,k),s&&(D=hy(c,q,t,u,d,h,s,g,r,null,F))}}if(o){const n=e.iconSizeData,i=l.layout.get("icon-rotate").evaluate(v,{},B),a=Mg(o,i,w,Z,x.iconScaleFactor),A=s?Mg(s,i,w,Z,x.iconScaleFactor):void 0;O=hy(c,q,t,u,d,h,o,g,i,null,I);const f=function(e,t,r,n,i,o,a,s){const l=e.layers[0],c=l.appearances;let u=t.length;if(r&&(u=Math.max(u,r.length)),0===c.length)return u;const[d,h]=n.get("icon-size-scale-range"),A=Oe(1,d,h);for(const f of c){const t=f.getUnevaluatedProperties();if(void 0!==t._values["icon-image"].value){const r=l.getAppearanceValueAndResolveTokens(f,"icon-image",i,o,[]);if(r){const n=e.getResolvedImageFromTokens(r);if(n){const r=t._values["icon-size"],l=ey(n,cg(e.zoom,r,e.worldview),r,o,e.zoom,i,e.pixelRatio,A,e.worldview),c=a.get(l.iconPrimary.toString());u=Math.max(u,Og(c,s))}}}}return u}(e,a,A,l.layout,v,B,e.iconAtlasPositions,Z);N=4*f;let p=null;"source"===n.kind?(p=[lg*l.layout.get("icon-size").evaluate(v,{},B)*x.iconScaleFactor],p[0]>cy&&We("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(ly,'. Reduce your "icon-size".'))):"composite"===n.kind&&(p=[lg*x.compositeIconSizes[0].evaluate(v,{},B)*x.iconScaleFactor,lg*x.compositeIconSizes[1].evaluate(v,{},B)*x.iconScaleFactor],(p[0]>cy||p[1]>cy)&&We("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(ly,'. Reduce your "icon-size".'))),e.addSymbols(e.icon,a,p,_,y,v,void 0,r,t,P.lineStartIndex,P.lineLength,-1,b,B,C,E,e.symbolInstances.length,f),H=e.icon.placedSymbolArray.length-1,A&&(j=4*f,e.addSymbols(e.icon,A,p,_,y,v,Vm.vertical,r,t,P.lineStartIndex,P.lineLength,-1,b,B,C,E,e.symbolInstances.length,f),G=e.icon.placedSymbolArray.length-1)}for(const te in i.horizontal){const n=te,o=i.horizontal[n];M||(W=Jt(o.text),f?U=Ay(o):M=hy(c,q,t,u,d,h,o,A,l.layout.get("text-rotate").evaluate(v,{},B),p,k));const s=1===o.positionedLines.length;if(Q+=uy(e,r,t,o,a,l,f,v,p,P,i.vertical?Vm.horizontal:Vm.horizontalOnly,s?Hg(i.horizontal):[n],K,H,x,b,B,e.symbolInstances.length,C),s)break}i.vertical&&(V+=uy(e,r,t,i.vertical,a,l,f,v,p,P,Vm.vertical,["vertical"],K,G,x,b,B,e.symbolInstances.length,C));let J=-1;const $=(e,t)=>e?Math.max(e,t):t;J=$(U,J),J=$(R,J),J=$(z,J);const ee=J>-1?1:0;e.glyphOffsetArray.length>=65535&&We("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==v.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,v.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,q.x,q.y,q.z,K.right>=0?K.right:-1,K.center>=0?K.center:-1,K.left>=0?K.left:-1,K.vertical>=0?K.vertical:-1,H,G,W,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==L?L:e.collisionBoxArray.length,void 0!==L?L+1:e.collisionBoxArray.length,void 0!==O?O:e.collisionBoxArray.length,void 0!==O?O+1:e.collisionBoxArray.length,D||e.collisionBoxArray.length,D?D+1:e.collisionBoxArray.length,u,Q,V,N,j,ee,0,X,Y,J,0,Z?1:0,T)}(e,l,b,s,r,n,o,i,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,P,y,c,0,M,L,g,t,a,u,d,h,f,p,m,z,v,x,w)};if("line"===_)for(const j of OA(t.geometry,0,0,Nn,Nn)){const t=yg(j,k,O,r.vertical||T,n,E,F,e.overscaling,Nn);for(const r of t)T&&fy(e,T.text,D,r)||N(j,r,h)}else if("line-center"===_){for(const j of t.geometry)if(j.length>1){const e=gg(j,O,r.vertical||T,n,E,F);e&&N(j,e,h)}}else if("Polygon"===t.type)for(const j of rh(t.geometry,0)){const e=jg(j,16);N(j[0],new hg(e.x,e.y,0,0,void 0),h)}else if("LineString"===t.type)for(const j of t.geometry)N(j,new hg(j[0].x,j[0].y,0,0,void 0),h);else if("Point"===t.type)for(const j of t.geometry)for(const e of j)N([e],new hg(e.x,e.y,0,0,void 0),h)}const ly=255,cy=ly*lg;function uy(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y){const _=function(e,t,r,n,i,o,a,s){const l=[];if(0===t.positionedLines.length)return l;const c=n.layout.get("text-rotate").evaluate(o,{})*Math.PI/180,u=function(e){const t=e[0],r=e[1],n=t*r;return n>0?[t,-r]:n<0?[-t,r]:0===t?[r,t]:[r,-t]}(r);let d=Math.abs(t.top-t.bottom);for(const p of t.positionedLines)d-=p.lineOffset;const h=t.positionedLines.length,A=d/h;let f=t.top-r[1];for(let p=0;p<h;++p){const e=t.positionedLines[p];f=Ng(t,A,f,p);for(const n of e.positionedGlyphs){if(!n.rect)continue;const e=n.rect||{};let o=Qm+1,d=!0,h=1,A=0;if(n.image){const e=a.get(n.image.toString());if(!e)continue;if(e.sdf){We("SDF images are not supported in formatted text and will be ignored.");continue}d=!1,h=e.pixelRatio,o=xg/h}const p=(i||s)&&n.vertical,m=n.metrics.advance*n.scale/2,g=n.metrics,y=n.rect;if(null===y)continue;s&&t.verticalizable&&(A=n.image?m-n.metrics.width*n.scale/2:0);const _=i?[n.x+m,n.y]:[0,0];let v=[0,0],x=[0,0],w=!1;i||(p?(x=[n.x+m+u[0],n.y+u[1]-A],w=!0):v=[n.x+m+r[0],n.y+r[1]-A]);const b=y.w*n.scale/(h*(n.localGlyph?Tg:1)),B=y.h*n.scale/(h*(n.localGlyph?Tg:1));let C,E,S,T;if(p){const e=n.y-f,t=new Be(-m,m-e),r=-Math.PI/2,i=new Be(...x);C=new Be(-m+v[0],v[1]),C._rotateAround(r,t)._add(i),C.x+=-e+m,C.y-=(g.left-o)*n.scale;const a=n.image?g.advance*n.scale:ym*n.scale,s=String.fromCodePoint(n.glyph);xm(s)?C.x+=(1-o)*n.scale:wm(s)?C.x+=a-g.height*n.scale+(-o-1)*n.scale:C.x+=n.image||g.width+2*o===y.w&&g.height+2*o===y.h?(a-B)/2:(a-(g.height+2*o)*n.scale)/2,E=new Be(C.x,C.y-b),S=new Be(C.x+B,C.y),T=new Be(C.x+B,C.y-b)}else{const e=(g.left-o)*n.scale-m+v[0],t=(-g.top-o)*n.scale+v[1],r=e+b,i=t+B;C=new Be(e,t),E=new Be(r,t),S=new Be(e,i),T=new Be(r,i)}if(c){let e;e=i?new Be(0,0):w?new Be(u[0],u[1]):new Be(r[0],r[1]),C._rotateAround(c,e),E._rotateAround(c,e),S._rotateAround(c,e),T._rotateAround(c,e)}const I=new Be(0,0),F=new Be(0,0);l.push({tl:C,tr:E,bl:S,br:T,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:_,sectionIndex:n.sectionIndex,isSDF:d,pixelOffsetTL:I,pixelOffsetBR:F,minFontScaleX:0,minFontScaleY:0})}}return l}(0,n,l,o,a,s,i,e.allowVerticalPlacement),v=e.textSizeData;let x=null;"source"===v.kind?(x=[lg*o.layout.get("text-size").evaluate(s,{},m)*f.textScaleFactor],x[0]>cy&&We("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(ly,'. Reduce your "text-size".'))):"composite"===v.kind&&(x=[lg*f.compositeTextSizes[0].evaluate(s,{},m)*f.textScaleFactor,lg*f.compositeTextSizes[1].evaluate(s,{},m)*f.textScaleFactor],(x[0]>cy||x[1]>cy)&&We("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(ly,'. Reduce your "text-size".'))),e.addSymbols(e.text,_,x,l,a,s,u,t,r,c.lineStartIndex,c.lineLength,A,p,m,y,!1,g,_.length);for(const w of d)h[w]=e.text.placedSymbolArray.length-1;return 4*_.length}function dy(e){for(const t in e)return e[t];return null}function hy(e,t,r,n,i,o,a,s,l,c,u){let d,h,A,f;if(d=u?u.top:a.top,h=u?u.bottom:a.bottom,A=u?u.left:a.left,f=u?u.right:a.right,rg(a)&&a.collisionPadding){const e=a.collisionPadding;A-=e[0],d-=e[1],f+=e[2],h+=e[3]}if(l){const e=new Be(A,d),t=new Be(f,d),r=new Be(A,h),n=new Be(f,h),i=Te(l);let o=new Be(0,0);c&&(o=new Be(c[0],c[1])),e._rotateAround(i,o),t._rotateAround(i,o),r._rotateAround(i,o),n._rotateAround(i,o),A=Math.min(e.x,t.x,r.x,n.x),f=Math.max(e.x,t.x,r.x,n.x),d=Math.min(e.y,t.y,r.y,n.y),h=Math.max(e.y,t.y,r.y,n.y)}return e.emplaceBack(t.x,t.y,t.z,r.x,r.y,A,d,f,h,s,n,i,o),e.length-1}function Ay(e){rg(e)&&e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function fy(e,t,r,n){const i=e.compareText;if(t in i){const e=i[t];for(let t=e.length-1;t>=0;t--)if(n.dist(e[t])<r)return!0}else i[t]=[];return i[t].push(n),!1}function py(e,t){const r=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,i=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),o=Math.sin(r)*i/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01));let a=Math.sin(e._pitch)*o+i;const s=i*(1/e._horizonShift);if(!e.elevation||0===e.elevation.exaggeration()){let t=Math.max(e.zoom-17,0);e.isOrthographic&&(t/=10),a*=1+t}return Math.min(1.01*a,s)}function my(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const r=Math.pow(2,-e.z),n=e.x*r,i=(e.x+1)*r,o=e.y*r,a=(e.y+1)*r,s=hc(n),l=hc(i),c=Ac(o),u=Ac(a),d=t.project(s,c),h=t.project(l,c),A=t.project(l,u),f=t.project(s,u);let p=Math.min(d.x,h.x,A.x,f.x),m=Math.min(d.y,h.y,A.y,f.y),g=Math.max(d.x,h.x,A.x,f.x),y=Math.max(d.y,h.y,A.y,f.y);const _=r/16;function v(e,r,n,i,o,a){const s=(n+o)/2,l=(i+a)/2,c=t.project(hc(s),Ac(l)),u=Math.max(0,p-c.x,m-c.y,c.x-g,c.y-y);p=Math.min(p,c.x),g=Math.max(g,c.x),m=Math.min(m,c.y),y=Math.max(y,c.y),u>_&&(v(e,c,n,i,s,l),v(c,r,s,l,o,a))}v(d,h,n,o,i,o),v(h,A,i,o,i,a),v(A,f,i,a,n,a),v(f,d,n,a,n,o),p-=_,m-=_,g+=_,y+=_;const x=1/Math.max(g-p,y-m);return{scale:x,x:p*x,y:m*x,x2:g*x,y2:y*x,projection:t}}function gy(e,t){let{x:r,y:n}=t;return new Be(((r-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*Nn,(n*e.scale-e.y)*Nn)}const yy=c(new Float32Array(16));class _y{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new ic(0,0)}projectTilePoint(e,t,r){return{x:e,y:t,z:0}}locationPoint(e,t,r){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._coordinatePoint(e.locationCoordinate(t,r),n)}pixelsPerMeter(e,t){return dc(1,e)*t}pixelSpaceConversion(e,t,r){return 1}farthestPixelDistance(e){return py(e,e.pixelsPerMeter)}pointCoordinate(e,t,r,n){const i=e.horizonLineFromTop(!1),o=new Be(t,Math.max(i,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(o,n))}pointCoordinate3D(e,t,r){const n=new Be(t,r);if(e.elevation)return e.elevation.pointCoordinate(n);{const t=this.pointCoordinate(e,n.x,n.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,t.x,t.y);const r=e.horizonLineFromTop();return t.y<r}createInversionMatrix(e,t){return yy}createTileMatrix(e,t,r){let n,i,o;const a=r.canonical,s=c(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=my(a,this);n=1,i=l.x+r.wrap*l.scale,o=l.y,A(s,s,[n/l.scale,n/l.scale,e.pixelsPerMeter/t])}else n=t/e.zoomScale(a.z),i=(a.x+Math.pow(2,a.z)*r.wrap)*n,o=a.y*n;return h(s,s,[i,o,0]),A(s,s,[n/Nn,n/Nn,1]),s}upVector(e,t,r){return[0,0,1]}upVectorScale(e,t,r){return{metersToTile:1}}}class vy extends _y{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,r]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(Te(t));this.n=(n+Math.sin(Te(r)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:r,c:n,r0:i}=this,o=Te(e-this.center[0]),a=Te(t),s=Math.sqrt(n-2*r*Math.sin(a))/r;return{x:s*Math.sin(o*r),y:s*Math.cos(o*r)-i,z:0}}unproject(e,t){const{n:r,c:n,r0:i}=this,o=i+t;let a=Math.atan2(e,Math.abs(o))*Math.sign(o);o*r<0&&(a-=Math.PI*Math.sign(e)*Math.sign(o));const s=Te(this.center[0])*r;a=De(a,-Math.PI-s,Math.PI-s);const l=Oe(Ie(a/r)+this.center[0],-180,180),c=Math.asin(Oe((n-(e*e+o*o)*r*r)/(2*r),-1,1)),u=Oe(Ie(c),-pc,pc);return new ic(l,u)}}const xy=1.340264,wy=-.081106,by=893e-6,By=.003796,Cy=Math.sqrt(3)/2;class Ey extends _y{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(Cy*Math.sin(t)),n=r*r,i=n*n*n;return{x:.5*(e*Math.cos(r)/(Cy*(xy+3*wy*n+i*(7*by+9*By*n)))/Math.PI+.5),y:1-.5*(r*(xy+wy*n+i*(by+By*n))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=r*r,i=n*n*n;for(let c,u,d,h=0;h<12&&(u=r*(xy+wy*n+i*(by+By*n))-t,d=xy+3*wy*n+i*(7*by+9*By*n),c=u/d,r=Oe(r-c,-Math.PI/3,Math.PI/3),n=r*r,i=n*n*n,!(Math.abs(c)<1e-12));++h);const o=Cy*e*(xy+3*wy*n+i*(7*by+9*By*n))/Math.cos(r),a=Math.asin(Math.sin(r)/Cy),s=Oe(180*o/Math.PI,-180,180),l=Oe(180*a/Math.PI,-pc,pc);return new ic(s,l)}}class Sy extends _y{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const r=360*(e-.5),n=Oe(360*(.5-t),-pc,pc);return new ic(r,n)}}const Ty=Math.PI/2;function Iy(e){return Math.tan((Ty+e)/2)}class Fy extends _y{constructor(e){super(e),this.center=e.center||[0,30];const[t,r]=this.parallels=e.parallels||[30,30];let n=Te(t),i=Te(r);this.southernCenter=n+i<0,this.southernCenter&&(n=-n,i=-i);const o=Math.cos(n),a=Iy(n);this.n=n===i?Math.sin(n):Math.log(o/Math.cos(i))/Math.log(Iy(i)/a),this.f=o*Math.pow(Iy(n),this.n)/this.n}project(e,t){t=Te(t),this.southernCenter&&(t=-t),e=Te(e-this.center[0]);const r=1e-6,{n:n,f:i}=this;i>0?t<-Ty+r&&(t=-Ty+r):t>Ty-r&&(t=Ty-r);const o=i/Math.pow(Iy(t),n);let a=o*Math.sin(n*e),s=i-o*Math.cos(n*e);return a=.5*(a/Math.PI+.5),s=.5*(s/Math.PI+.5),{x:a,y:this.southernCenter?s:1-s,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:r,f:n}=this,i=n-t,o=Math.sign(i),a=Math.sign(r)*Math.sqrt(e*e+i*i);let s=Math.atan2(e,Math.abs(i))*o;i*r<0&&(s-=Math.PI*Math.sign(e)*o);const l=Oe(Ie(s/r)+this.center[0],-180,180),c=Oe(Ie(2*Math.atan(Math.pow(n/a,1/r))-Ty),-pc,pc);return new ic(l,this.southernCenter?-c:c)}}class ky extends _y{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:cc(e),y:uc(t),z:0}}unproject(e,t){const r=hc(e),n=Ac(t);return new ic(r,n)}}const Py=Te(pc);class My extends _y{project(e,t){const r=(t=Te(t))*t,n=r*r;return{x:.5*((e=Te(e))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=25,i=0,o=r*r;do{o=r*r;const e=o*o;i=(r*(1.007226+o*(.015085+e*(.028874*o-.044475-.005916*e)))-t)/(1.007226+o*(.045255+e*(.259866*o-.311325-.005916*11*e))),r=Oe(r-i,-Py,Py)}while(Math.abs(i)>1e-6&&--n>0);o=r*r;const a=Oe(Ie(e/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),s=Ie(r);return new ic(a,s)}}const Oy=Te(pc);class Ly extends _y{project(e,t){t=Te(t),e=Te(e);const r=Math.cos(t),n=2/Math.PI,i=Math.acos(r*Math.cos(e/2)),o=Math.sin(i)/i,a=.5*(e*n+2*r*Math.sin(e/2)/o)||0,s=.5*(t+Math.sin(t)/o)||0;return{x:.5*(a/Math.PI+.5),y:1-.5*(s/Math.PI+1),z:0}}unproject(e,t){let r=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,i=25;const o=1e-6;let a=0,s=0;do{const i=Math.cos(n),o=Math.sin(n),l=2*o*i,c=o*o,u=i*i,d=Math.cos(r/2),h=Math.sin(r/2),A=2*d*h,f=h*h,p=1-u*d*d,m=p?1/p:0,g=p?Math.acos(i*d)*Math.sqrt(1/p):0,y=.5*(2*g*i*h+2*r/Math.PI)-e,_=.5*(g*o+n)-t,v=.5*m*(u*f+g*i*d*c)+1/Math.PI,x=m*(A*l/4-g*o*h),w=.125*m*(l*h-g*o*u*A),b=.5*m*(c*d+g*f*i)+.5,B=x*w-b*v;a=(_*x-y*b)/B,s=(y*w-_*v)/B,r=Oe(r-a,-Math.PI,Math.PI),n=Oe(n-s,-Oy,Oy)}while((Math.abs(a)>o||Math.abs(s)>o)&&--i>0);return new ic(Ie(r),Ie(n))}}class Dy extends _y{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Te(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:r,cosPhi:n}=this;return{x:Te(e)*n*r+.5,y:-Math.sin(Te(t))/n*r+.5,z:0}}unproject(e,t){const{scale:r,cosPhi:n}=this,i=-(t-.5)/r,o=Oe(Ie((e-.5)/r)/n,-180,180),a=Math.asin(Oe(i*n,-1,1)),s=Oe(Ie(a),-pc,pc);return new ic(o,s)}}class Uy extends ky{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,r){const n=Wu(e,t,r);return Q(n,n,Xu(ju(r))),{x:n[0],y:n[1],z:n[2]}}locationPoint(e,t,r){const n=tc(t.lat,t.lng),i=R([],n),o=r?e._centerAltitude+r:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;M(n,n,i,dc(1,0)*Nn*o);const a=c(new Float64Array(16));return d(a,e.pixelMatrix,e.globeMatrix),Q(n,n,a),new Be(n[0],n[1])}pixelsPerMeter(e,t){return dc(1,0)*t}pixelSpaceConversion(e,t,r){const n=dc(1,e)*t,i=hr(dc(1,45)*t,n,r);return this.pixelsPerMeter(e,t)/i}createTileMatrix(e,t,r){const n=Yu(ju(r.canonical));return d(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,t){const{center:r}=e,n=Xu(ju(t));return p(n,n,Te(r.lng)),f(n,n,Te(r.lat)),A(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,t,r,n){return Ru(e,t,r,!0)||new vc(0,0)}pointCoordinate3D(e,t,r){const n=this.pointCoordinate(e,t,r,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,t){return!Ru(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const r=e.cameraToCenterDistance,n=e._centerAltitude*t,i=e._camera,o=e._camera.forward(),a=S([],P([],o,-r),[0,0,n]),s=e.worldSize/(2*Math.PI),l=[0,0,-s],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),d=P([],i.up(),u),h=P([],i.right(),u*c),A=R([],S([],S([],o,d),h)),f=[];let p;if(new Gc(a,A).closestPointOnSphere(l,s,f)){const t=S([],f,l),r=W([],t,a);p=Math.cos(e.fovAboveCenter)*B(r)}else{const e=W([],a,l),t=W([],l,a);R(t,t);const r=B(e)-s;p=Math.sqrt(r*(r+2*s));const n=Math.acos(p/(s+r))-Math.acos(z(o,t));p*=Math.cos(n)}return 1.01*p}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=td(e.zoom);if(r>0){const n=py(e,dc(1,e.center.lat)*e.worldSize),i=e.worldSize/(2*Math.PI),o=Math.max(e.width,e.height)/e.worldSize*Math.PI;return hr(t,n+i*(1-Math.cos(o)),Math.pow(r,10))}return t}upVector(e,t,r){return Wu(t,r,e,1)}upVectorScale(e){return{metersToTile:Du(qu(ju(e)))}}}function Ry(e){const t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new ky(e);case"equirectangular":return new Sy(e);case"naturalEarth":return new My(e);case"equalEarth":return new Ey(e);case"winkelTripel":return new Ly(e);case"albers":return r?new Dy(e):new vy(e);case"lambertConformalConic":return r?new Dy(e):new Fy(e);case"globe":return new Uy(e)}throw new Error("Invalid projection name: ".concat(e.name))}const zy=Fc.types,Ny=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function jy(e,t,r,n,i,o,a,s,l,c,u,d,h){const A=s?Math.min(cy,Math.round(s[0])):0,f=s?Math.min(cy,Math.round(s[1])):0;e.emplaceBack(t,r,Math.round(32*n),Math.round(32*i),o,a,(A<<1)+(l?1:0),0+(f<<1),16*c,16*u,256*d,256*h)}function Qy(e,t,r){e.emplaceBack(t,r)}function Vy(e,t,r,n,i,o,a){e.emplaceBack(t,r,n,i,o,a)}const Hy=(e,t,r,n)=>{for(let i=0;i<t;i++)e.emplaceBack(r[0],r[1],r[2],n[0],n[1],n[2])};function Gy(e,t,r,n,i){e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i)}function Ky(e){for(const t of e.sections)if(Aa(t.text))return!0;return!1}class Wy{constructor(e){this.layoutVertexArray=new Cs,this.indexArray=new Os,this.programConfigurations=e,this.segments=new dl,this.dynamicLayoutVertexArray=new Ss,this.opacityVertexArray=new Ts,this.placedSymbolArray=new Js,this.iconTransitioningVertexArray=new Is,this.globeExtVertexArray=new Es,this.zOffsetVertexArray=new ms,this.orientationVertexArray=new Us,this.symbolInstanceIndices=[]}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}getIconVertexData(e,t){const r=[],n=this.layoutVertexArray.uint16;for(let i=0;i<t;++i){const t=12*(e+i);r.push(...n.slice(t,t+12))}return r}updateIconVertexData(e,t,r,n,i,o,a,s,l,c,u,d,h){const A=this.layoutVertexArray.uint16,f=12*e;A[f]=t,A[f+1]=r,A[f+2]=n,A[f+3]=i,A[f+4]=o,A[f+5]=a,A[f+6]=s,A[f+7]=l,A[f+8]=c,A[f+9]=u,A[f+10]=d,A[f+11]=h}upload(e,t,r,n,i,o){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lm.members,!!o),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,um.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ny,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Am.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,cm.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||i)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,dm.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,hm.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}ea(Wy,"SymbolBuffers");class qy{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new dl,this.collisionVertexArray=new Ms,this.collisionVertexArrayExt=new Ss}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,fm.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,pm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}ea(qy,"CollisionBuffers");class Zy{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=c([]),this.placementViewportMatrix=c([]);const t=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=cg(this.zoom,t["text-size"],this.worldview),this.iconSizeData=cg(this.zoom,t["icon-size"],this.worldview);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.lut=e.lut,this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(e=>Vm[e]),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const t=this.layers[0].getAppearances();return!(!t||0===t.length)&&t.some(t=>null!=t.getProperty(e))}createArrays(){this.text=new Wy(new Nl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Wy(new Nl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new tl,this.lineVertexArray=new rl,this.symbolInstances=new el}calculateGlyphDependencies(e,t,r,n,i){for(const o of e){const e=o.codePointAt(0);if(void 0===e)break;if(t[e]=!0,n&&i&&e<=65535){const e=vm[o];e&&(t[e.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,t,r,n,i,o){let a=1;const s=e.getUnevaluatedProperties()._values["icon-size"],l=cg(this.zoom,s,this.worldview),c=dg(l,t);if("constant"!==l.kind&&"camera"!==l.kind||(a=c.uSize),"composite"===l.kind){const{minZoom:e,maxZoom:t}=l,o=s.possiblyEvaluate(new Ba(e,{worldview:this.worldview}),n),u=s.possiblyEvaluate(new Ba(t,{worldview:this.worldview}),n),d=o.evaluate(r,{},n,i);a=d+(u.evaluate(r,{},n,i)-d)*c.uSizeT}return"source"===l.kind&&(a=s.possiblyEvaluate(new Ba(this.zoom,{worldview:this.worldview}),n).evaluate(r,{},n,i)),a*o}updateFootprints(e,t){}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Qh(this.activeReplacements,r)&&(this.activeReplacements=r,!0)}getResolvedImageFromTokens(e){return"string"==typeof e?Rr.build(e):e}populate(e,t,r,n){const i=this.layers[0],o=i.layout,a="globe"===this.projection.name,s=o.get("text-font"),l=o.get("text-field"),c=o.get("icon-image"),[u,d]=o.get("icon-size-scale-range"),h=Oe(t.scaleFactor||1,u,d),A=("constant"!==l.value.kind||l.value.value instanceof Dr&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),f="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,p=this.hasAnyAppearanceProperty("icon-image"),m=o.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!A&&!f&&!p)return;const g=t.iconDependencies,y=t.glyphDependencies,_=t.availableImages,v=new Ba(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),x=e=>{const t=e.id.toString();g.has(t)?g.get(t).push(e):g.set(t,[e])};for(const w of e){const{feature:e,id:t,index:l,sourceLayerIndex:c}=w,u=i._featureFilter.needGeometry,d=Ic(e,u);if(!i._featureFilter.filter(v,d,r))continue;if(u||(d.geometry=Tc(e,r,n)),a&&1!==e.type&&r.z<=5){const e=d.geometry,t=.98078528056,n=(e,n)=>z(Wu(e.x,e.y,r,1),Wu(n.x,n.y,r,1))<t;for(let r=0;r<e.length;r++)e[r]=Bc(e[r],n)}let b,B;if(A){const e=i.getValueAndResolveTokens("text-field",d,r,_),t=Dr.factory(e);Ky(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===xa()||this.hasRTLText&&ba.isParsed())&&(b=_m(t,i,d))}if(f){const e=i.getValueAndResolveTokens("icon-image",d,r,_);B=this.getResolvedImageFromTokens(e)}const C=this.layers[0];let E=!1;if(!B&&p){const e=C.getAppearances();for(const t of e)if(t.getProperty("icon-image")){const e=C.getAppearanceValueAndResolveTokens(t,"icon-image",d,r,_);if(e){B=this.getResolvedImageFromTokens(e),E=!0;break}}}if(!b&&!B)continue;const S=this.sortFeaturesByKey?m.evaluate(d,{},r):void 0,T={id:t,text:b,icon:B,index:l,sourceLayerIndex:c,geometry:d.geometry,properties:e.properties,type:zy[e.type],sortKey:S};if(this.features.push(T),this.featureToAppearanceIndex[l]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:t,properties:e.properties,usesAppearanceIconAsPlaceholder:E,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),B){const e=C._unevaluatedLayout._values,{iconPrimary:t,iconSecondary:n}=ey(B,this.iconSizeData,e["icon-size"],r,this.zoom,T,this.pixelRatio,h,this.worldview);x(t),n&&(this.hasAnySecondaryIcon=!0,x(n))}const I=C.getAppearances();if(0!==I.length&&I.forEach(e=>{if(!e.getProperty("icon-image"))return;const t=this.getCombinedIconPrimary(e,C,d,r,_,T,h);t&&x(t)}),b){const e=s.evaluate(d,{},r).join(","),t="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Vm.vertical)>=0;for(const r of b.sections)if(r.image){const e=r.image.getPrimary().scaleSelf(this.pixelRatio),t=e.id.toString(),n=g.get(t)||[];n.push(e),g.set(t,n)}else{const n=oa(b.toString()),i=r.fontStack||e,o=y[i]=y[i]||{};this.calculateGlyphDependencies(r.text,o,t,this.allowVerticalPlacement,n)}}}if("line"===o.get("symbol-placement")&&(this.features=function(e){const t={},r={},n=[];let i=0;function o(t){n.push(e[t]),i++}function a(e,t,i){const o=r[e];return delete r[e],r[t]=o,n[o].geometry[0].pop(),n[o].geometry[0]=n[o].geometry[0].concat(i[0]),o}function s(e,r,i){const o=t[r];return delete t[r],t[e]=o,n[o].geometry[0].shift(),n[o].geometry[0]=i[0].concat(n[o].geometry[0]),o}function l(e,t,r){const n=r?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(n.x,":").concat(n.y)}for(let c=0;c<e.length;c++){const u=e[c],d=u.geometry,h=u.text?u.text.toString():null;if(!h){o(c);continue}const A=l(h,d),f=l(h,d,!0);if(A in r&&f in t&&r[A]!==t[f]){const e=s(A,f,d),i=a(A,f,n[e].geometry);delete t[A],delete r[f],r[l(h,n[i].geometry,!0)]=i,n[e].geometry=null}else A in r?a(A,f,d):f in t?s(A,f,d):(o(c),t[A]=i-1,r[f]=i-1)}return n.filter(e=>e.geometry)}(this.features)),"hd-road-markup"===o.get("symbol-elevation-reference")){if(this.elevationType="road",t.elevationFeatures){!this.elevationFeatures&&t.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const e of t.elevationFeatures)this.elevationFeatureIdToIndex.set(e.id,this.elevationFeatures.length),this.elevationFeatures.push(e)}}else o.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}getCombinedIconPrimary(e,t,r,n,i,o,a){let s,l;const c=e.getUnevaluatedProperties();if(void 0!==c._values["icon-image"].value){const o=t.getAppearanceValueAndResolveTokens(e,"icon-image",r,n,i);s=this.getResolvedImageFromTokens(o)}else{const e=t.getValueAndResolveTokens("icon-image",r,n,i);s=this.getResolvedImageFromTokens(e)}if(s){const e=c._values["icon-size"]||t._unevaluatedLayout._values["icon-size"];l=ey(s,cg(this.zoom,e,this.worldview),e,n,this.zoom,o,this.pixelRatio,a,this.worldview).iconPrimary}return l}updateAppearanceBasedIconTextures(e,t,r,n){if(!this.appearanceFeatureData)return!1;if(!this.icon.layoutVertexArray||0===this.icon.layoutVertexArray.length)return!1;const i=this.layers[0];let o=!1,a=0;const s=i.layout,[l,c]=s.get("icon-size-scale-range"),u=Oe(1,l,c);for(let d=0;d<this.symbolInstances.length;d++){const s=this.symbolInstances.get(d),l=this.featureToAppearanceIndex[s.featureIndex],c=void 0!==l?this.appearanceFeatureData[l]:void 0;if(c&&s.placedIconSymbolIndex>=0){const l=c.id,d=t&&void 0!==l?t[String(l)]:void 0,h={type:"Point",id:c.id,properties:c.properties,geometry:[]},A=this.layers[0].appearances&&this.layers[0].appearances.find(t=>t.isActive({globals:n,feature:h,canonical:e,featureState:d}));if(c.activeAppearance===A){a+=s.numIconVertices;continue}if(A){c.activeAppearance=A;const t=this.getCombinedIconPrimary(A,i,h,e,r,{sortKey:void 0,text:void 0,icon:null,index:s.featureIndex,sourceLayerIndex:s.featureIndex,geometry:[],properties:c.properties,type:"Point",id:c.id},u);if(!t)continue;const l=t.toString(),d=this.iconAtlasPositions&&this.iconAtlasPositions.get(l);if(d){const t=i.getAppearanceValueAndResolveTokens(A,"icon-offset",h,e,r),l=t&&Array.isArray(t)?t:[0,0];let f=ng(d,void 0,l,i.layout.get("icon-anchor").evaluate(h,{},e));const p=i.getAppearanceValueAndResolveTokens(A,"icon-rotate",h,e,r),m="number"==typeof p?p:0,g=d.sdf,y=i.layout.get("icon-text-fit").constantOr("none");"none"!==y&&c.textShaping&&c.iconTextFitPadding&&c.fontScale&&(f=ig(f,c.textShaping,y,c.iconTextFitPadding,l,c.fontScale));const _=this.calculateEffectiveAppearanceIconSize(A,n.zoom,h,e,r,u),v=0,x=1+(Math.min(cy,Math.round(_*lg))<<1),w=Mg(f,m,g,"none"!==y,u);c.isUsingAppearanceVertexData||(c.isUsingAppearanceVertexData=!0,c.layoutBasedVertexData=this.icon.getIconVertexData(a,s.numIconVertices));for(let e=0;e<w.length;++e){const t=w[e],r=c.layoutBasedVertexData[0]||s.tileAnchorX,n=c.layoutBasedVertexData[1]||s.tileAnchorY,i=16*t.pixelOffsetTL.x,o=16*t.pixelOffsetTL.y,l=16*t.pixelOffsetBR.x,u=16*t.pixelOffsetBR.y,d=16*t.minFontScaleX,h=16*t.minFontScaleY;this.icon.updateIconVertexData(a,r,n,Math.round(32*t.tl.x),Math.round(32*t.tl.y),t.texPrimary.x,t.texPrimary.y,v,x,i,o,d,h),this.icon.updateIconVertexData(a+1,r,n,Math.round(32*t.tr.x),Math.round(32*t.tr.y),t.texPrimary.x+t.texPrimary.w,t.texPrimary.y,v,x,l,o,d,h),this.icon.updateIconVertexData(a+2,r,n,Math.round(32*t.bl.x),Math.round(32*t.bl.y),t.texPrimary.x,t.texPrimary.y+t.texPrimary.h,v,x,i,u,d,h),this.icon.updateIconVertexData(a+3,r,n,Math.round(32*t.br.x),Math.round(32*t.br.y),t.texPrimary.x+t.texPrimary.w,t.texPrimary.y+t.texPrimary.h,v,x,l,u,d,h),a+=4}const b=s.numIconVertices-4*w.length;for(let e=0;e<b;++e)this.icon.updateIconVertexData(a+e,0,0,0,0,0,0,0,0,0,0,0,0);o=!0}else a+=s.numIconVertices}else if(c.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(a,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(a+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(a+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(a+3,0,0,0,0,0,0,0,0,0,0,0,0),o=!0),a+=s.numIconVertices,c.activeAppearance=null;else if(c.isUsingAppearanceVertexData){const e=12,t=c.layoutBasedVertexData.length/e;for(let r=0;r<t;++r){const t=r*e;this.icon.updateIconVertexData(a+r,c.layoutBasedVertexData[t+0],c.layoutBasedVertexData[t+1],c.layoutBasedVertexData[t+2],c.layoutBasedVertexData[t+3],c.layoutBasedVertexData[t+4],c.layoutBasedVertexData[t+5],c.layoutBasedVertexData[t+6],c.layoutBasedVertexData[t+7],c.layoutBasedVertexData[t+8],c.layoutBasedVertexData[t+9],c.layoutBasedVertexData[t+10],c.layoutBasedVertexData[t+11])}a+=t,c.isUsingAppearanceVertexData=!1,c.activeAppearance=null,o=!0}else a+=s.numIconVertices,c.activeAppearance=null}}return o}update(e,t,r,n,i,o,a){this.text.programConfigurations.updatePaintArrays(e,t,i,r,n,o,a,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,t,i,r,n,o,a,this.worldview)}updateRoadElevation(e){if("road"!==this.elevationType||!this.elevationFeatures)return;if(this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let t=!1;const r=_c(e),n=1/r;let i=!1,o=!1;for(let a=0;a<this.symbolInstances.length;a++){const e=this.symbolInstances.get(a),s=C(1,0,0),l=C(0,1,0),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:u,numIconVertices:d,numVerticalIconVertices:h}=e,A=c>0||u>0,f=d>0,p=this.elevationFeatures[e.elevationFeatureIndex];if(p){const a=new Be(e.tileAnchorX,e.tileAnchorY),c=.075+p.pointElevation(a);e.zOffset!==c&&(t=!0,e.zOffset=c),0!==c&&(this.hasAnyZOffset=!0);const u=p.computeSlopeNormal(a,n),d=le(ee(),C(0,0,1),u);H(s,s,d),H(l,l,d),s[2]*=r,l[2]*=r,1===s[0]&&0===s[1]&&0===s[2]&&0===l[0]&&1===l[1]&&0===l[2]||(i=i||A,o=o||f)}if(A&&(Hy(this.text.orientationVertexArray,c,s,l),Hy(this.text.orientationVertexArray,u,s,l)),f){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:r}=e;t>=0&&Hy(this.icon.orientationVertexArray,d,s,l),r>=0&&Hy(this.icon.orientationVertexArray,h,s,l)}}i||(this.text.orientationVertexArray=void 0),o||(this.icon.orientationVertexArray=void 0),t&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(e,t,n)=>{r+=t,r>e.length&&e.resize(r);for(let i=-t;i<0;i++)e.emplace(i+r,n)},t=(e,t,r)=>{n+=t,n>e.length&&e.resize(n);for(let i=-t;i<0;i++)e.emplace(i+n,r)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,n=0;for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:o,numIconVertices:a}=r,s=r.zOffset,l=a>0;if((n>0||o>0)&&(e(this.text.zOffsetVertexArray,n,s),e(this.text.zOffsetVertexArray,o,s)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:n}=r;e>=0&&t(this.icon.zOffsetVertexArray,a,s),n>=0&&t(this.icon.zOffsetVertexArray,r.numVerticalIconVertices,s)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,t,r,n,i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),null===this.hasAppearances&&(this.hasAppearances=this.layers.some(e=>e.appearances&&e.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,t,r,n){return!!(e&&t&&r)&&!(!this.icon.layoutVertexArray||0===this.icon.layoutVertexArray.length)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,t,r,n)&&this.icon.layoutVertexBuffer&&null!==this.icon.layoutVertexArray.arrayBuffer&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Ry(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const r=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:n,y:i}of t)this.lineVertexArray.emplaceBack(n,i);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g){const y=e.indexArray,_=e.layoutVertexArray,v=e.globeExtVertexArray,x=e.segments.prepareSegment(4*g,_,y,this.canOverlap?o.sortKey:void 0),w=this.glyphOffsetArray.length,b=x.vertexLength,B=this.allowVerticalPlacement&&a===Vm.vertical?Math.PI/2:0,C=o.text&&o.text.sections;for(let T=0;T<t.length;T++){const{tl:n,tr:i,bl:a,br:c,texPrimary:u,texSecondary:d,pixelOffsetTL:m,pixelOffsetBR:g,minFontScaleX:w,minFontScaleY:b,glyphOffset:E,isSDF:S,sectionIndex:I}=t[T],F=x.vertexLength,k=E[1];if(jy(_,l.x,l.y,n.x,k+n.y,u.x,u.y,r,S,m.x,m.y,w,b),jy(_,l.x,l.y,i.x,k+i.y,u.x+u.w,u.y,r,S,g.x,m.y,w,b),jy(_,l.x,l.y,a.x,k+a.y,u.x,u.y+u.h,r,S,m.x,g.y,w,b),jy(_,l.x,l.y,c.x,k+c.y,u.x+u.w,u.y+u.h,r,S,g.x,g.y,w,b),s){const{x:t,y:r,z:n}=s.anchor,[i,o,a]=s.up;Vy(v,t,r,n,i,o,a),Vy(v,t,r,n,i,o,a),Vy(v,t,r,n,i,o,a),Vy(v,t,r,n,i,o,a),Gy(e.dynamicLayoutVertexArray,t,r,n,B)}else Gy(e.dynamicLayoutVertexArray,l.x,l.y,l.z,B);if(p){const t=d||u;Qy(e.iconTransitioningVertexArray,t.x,t.y),Qy(e.iconTransitioningVertexArray,t.x+t.w,t.y),Qy(e.iconTransitioningVertexArray,t.x,t.y+t.h),Qy(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}y.emplaceBack(F,F+1,F+2),y.emplaceBack(F+1,F+2,F+3),x.vertexLength+=4,x.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(E[0]),T!==t.length-1&&I===t[T+1].sectionIndex||e.programConfigurations.populatePaintArrays(_.length,o,o.index,{},h,A,f,C&&C[I],this.worldview)}const E=g-t.length;0!==E&&this._addNullVertices(E,_,r,s,v,e,p,x,y);const S=s?s.anchor:l;e.placedSymbolArray.emplaceBack(S.x,S.y,S.z,l.x,l.y,w,this.glyphOffsetArray.length-w,b,c,u,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],a,0,0,0,d,0),e.symbolInstanceIndices.push(m)}_addNullVertices(e,t,r,n,i,o,a,s,l){for(let c=0;c<e;c++){for(let s=0;s<4;s++)jy(t,0,0,0,0,0,0,r,!1,0,0,0,0),n?(Vy(i,0,0,0,0,0,0),Gy(o.dynamicLayoutVertexArray,0,0,0,0)):Gy(o.dynamicLayoutVertexArray,0,0,0,0),a&&Qy(o.iconTransitioningVertexArray,0,0);const e=s.vertexLength;l.emplaceBack(e,e+1,e+2),l.emplaceBack(e+1,e+2,e+3),s.vertexLength+=4,s.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,t,r,n,i,o,a){e.emplaceBack(t,r,n,i,o,Math.round(a.x),Math.round(a.y))}_addCollisionDebugVertices(e,t,r,n,i,o,a){const s=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=s.vertexLength,c=a.tileAnchorX,u=a.tileAnchorY;for(let h=0;h<4;h++)r.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,t,e.padding,a.zOffset),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,c,u,new Be(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,c,u,new Be(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,c,u,new Be(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,i,o,c,u,new Be(e.x1,e.y2)),s.vertexLength+=4;const d=r.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),s.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,r,n,i,o){for(let a=n;a<i;a++){const n=r.get(a),i=this.getSymbolInstanceTextSize(e,o,t,a);this._addCollisionDebugVertices(n,i,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(e,t,r,n,i,o){for(let a=n;a<i;a++){const n=r.get(a),i=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._addCollisionDebugVertices(n,i,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,o)}}generateCollisionDebugBuffers(e,t,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new qy(ks,mm.members,Is),this.iconCollisionBox=new qy(ks,mm.members,Is);const n=dg(this.iconSizeData,e),i=dg(this.textSizeData,e,r);for(let o=0;o<this.symbolInstances.length;o++){const r=this.symbolInstances.get(o);this._addTextDebugCollisionBoxes(i,e,t,r.textBoxStartIndex,r.textBoxEndIndex,r),this._addTextDebugCollisionBoxes(i,e,t,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r),this._addIconDebugCollisionBoxes(n,e,t,r.iconBoxStartIndex,r.iconBoxEndIndex,r),this._addIconDebugCollisionBoxes(n,e,t,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r)}}getSymbolInstanceTextSize(e,t,r,n){const i=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n),o=ug(this.textSizeData,e,i)/ym;return this.tilePixelRatio*o}getSymbolInstanceIconSize(e,t,r){const n=this.icon.placedSymbolArray.get(r),i=ug(this.iconSizeData,e,n);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(e,t,r,n){e.emplaceBack(t,-r,-r,n),e.emplaceBack(t,r,-r,n),e.emplaceBack(t,r,r,n),e.emplaceBack(t,-r,r,n)}_updateTextDebugCollisionBoxes(e,t,r,n,i,o,a){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceTextSize(e,o,t,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,n.padding,o.zOffset)}}_updateIconDebugCollisionBoxes(e,t,r,n,i,o,a){for(let s=n;s<i;s++){const n=r.get(s),i=this.getSymbolInstanceIconSize(e,t,o.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,n.padding,o.zOffset)}}updateCollisionDebugBuffers(e,t,r,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=dg(this.iconSizeData,e,n),o=dg(this.textSizeData,e,r);for(let a=0;a<this.symbolInstances.length;a++){const s=this.symbolInstances.get(a);this._updateTextDebugCollisionBoxes(o,e,t,s.textBoxStartIndex,s.textBoxEndIndex,s,r),this._updateTextDebugCollisionBoxes(o,e,t,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s,r),this._updateIconDebugCollisionBoxes(i,e,t,s.iconBoxStartIndex,s.iconBoxEndIndex,s,n),this._updateIconDebugCollisionBoxes(i,e,t,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex,s,n)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,r,n,i,o,a,s,l){const c={};if(t<r){const{x1:r,y1:n,x2:i,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:A}=e.get(t);c.textBox={x1:r,y1:n,x2:i,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.textFeatureIndex=A}if(n<i){const{x1:t,y1:r,x2:i,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:A}=e.get(n);c.verticalTextBox={x1:t,y1:r,x2:i,y2:o,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.verticalTextFeatureIndex=A}if(o<a){const{x1:t,y1:r,x2:n,y2:i,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:A}=e.get(o);c.iconBox={x1:t,y1:r,x2:n,y2:i,padding:a,projectedAnchorX:s,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.iconFeatureIndex=A}if(s<l){const{x1:t,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:A}=e.get(s);c.verticalIconBox={x1:t,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.verticalIconFeatureIndex=A}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const r=e.placedSymbolArray.get(t),n=r.vertexStartIndex+4*r.numGlyphs;for(let i=r.vertexStartIndex;i<n;i+=4)e.indexArray.emplaceBack(i,i+1,i+2),e.indexArray.emplaceBack(i+1,i+2,i+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),n=[],i=[],o=[];for(let a=0;a<this.symbolInstances.length;++a){o.push(a);const e=this.symbolInstances.get(a);n.push(0|Math.round(t*e.tileAnchorX+r*e.tileAnchorY)),i.push(e.featureIndex)}return o.sort((e,t)=>n[e]-n[t]||i[t]-i[e]),o}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:i,verticalPlacedTextSymbolIndex:o,placedIconSymbolIndex:a,verticalPlacedIconSymbolIndex:s}=t;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&i!==n&&i!==r&&this.addIndicesForPlacedSymbol(this.text,i),o>=0&&this.addIndicesForPlacedSymbol(this.text,o),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a),s>=0&&this.addIndicesForPlacedSymbol(this.icon,s)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const t=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let r;return this.elevationFeatures&&t<this.elevationFeatures.length&&(r=this.elevationFeatures[t]),r}}function Xy(e,t){return t.replace(/{([^{}]+)}/g,(t,r)=>r in e?String(e[r]):"")}let Yy,Jy,$y;ea(Zy,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Zy.addDynamicAttributes=Gy;class e_{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:gr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}ea(e_,"FormatSectionOverride",{omit:["defaultValue"]});const t_=()=>$y||($y={layout:Yy||(Yy=new Da({"symbol-placement":new Ma(Ua.layout_symbol["symbol-placement"]),"symbol-spacing":new Ma(Ua.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ma(Ua.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Oa(Ua.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ma(Ua.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Ma(Ua.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Ma(Ua.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Ma(Ua.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ma(Ua.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ma(Ua.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ma(Ua.layout_symbol["icon-rotation-alignment"]),"icon-size":new Oa(Ua.layout_symbol["icon-size"]),"icon-size-scale-range":new Ma(Ua.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Oa(Ua.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Oa(Ua.layout_symbol["icon-text-fit-padding"]),"icon-image":new Oa(Ua.layout_symbol["icon-image"]),"icon-image-use-theme":new Ma({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Oa(Ua.layout_symbol["icon-rotate"]),"icon-padding":new Ma(Ua.layout_symbol["icon-padding"]),"icon-keep-upright":new Ma(Ua.layout_symbol["icon-keep-upright"]),"icon-offset":new Oa(Ua.layout_symbol["icon-offset"]),"icon-anchor":new Oa(Ua.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ma(Ua.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ma(Ua.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ma(Ua.layout_symbol["text-rotation-alignment"]),"text-field":new Oa(Ua.layout_symbol["text-field"]),"text-font":new Oa(Ua.layout_symbol["text-font"]),"text-size":new Oa(Ua.layout_symbol["text-size"]),"text-size-scale-range":new Ma(Ua.layout_symbol["text-size-scale-range"]),"text-max-width":new Oa(Ua.layout_symbol["text-max-width"]),"text-line-height":new Oa(Ua.layout_symbol["text-line-height"]),"text-letter-spacing":new Oa(Ua.layout_symbol["text-letter-spacing"]),"text-justify":new Oa(Ua.layout_symbol["text-justify"]),"text-radial-offset":new Oa(Ua.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ma(Ua.layout_symbol["text-variable-anchor"]),"text-anchor":new Oa(Ua.layout_symbol["text-anchor"]),"text-max-angle":new Ma(Ua.layout_symbol["text-max-angle"]),"text-writing-mode":new Ma(Ua.layout_symbol["text-writing-mode"]),"text-rotate":new Oa(Ua.layout_symbol["text-rotate"]),"text-padding":new Ma(Ua.layout_symbol["text-padding"]),"text-keep-upright":new Ma(Ua.layout_symbol["text-keep-upright"]),"text-transform":new Oa(Ua.layout_symbol["text-transform"]),"text-offset":new Oa(Ua.layout_symbol["text-offset"]),"text-allow-overlap":new Ma(Ua.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ma(Ua.layout_symbol["text-ignore-placement"]),"text-optional":new Ma(Ua.layout_symbol["text-optional"]),visibility:new Ma(Ua.layout_symbol.visibility)})),paint:Jy||(Jy=new Da({"icon-opacity":new Oa(Ua.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Oa(Ua.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Oa(Ua.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Oa(Ua.paint_symbol["text-emissive-strength"]),"icon-color":new Oa(Ua.paint_symbol["icon-color"]),"icon-halo-color":new Oa(Ua.paint_symbol["icon-halo-color"]),"icon-halo-width":new Oa(Ua.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Oa(Ua.paint_symbol["icon-halo-blur"]),"icon-translate":new Ma(Ua.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ma(Ua.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Ma(Ua.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Oa(Ua.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Oa(Ua.paint_symbol["text-occlusion-opacity"]),"text-color":new Oa(Ua.paint_symbol["text-color"],{runtimeType:xr,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Oa(Ua.paint_symbol["text-halo-color"]),"text-halo-width":new Oa(Ua.paint_symbol["text-halo-width"]),"text-halo-blur":new Oa(Ua.paint_symbol["text-halo-blur"]),"text-translate":new Ma(Ua.paint_symbol["text-translate"]),"text-translate-anchor":new Ma(Ua.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Ma(Ua.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Ma(Ua.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Ma(Ua.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Ma(Ua.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Oa(Ua.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},$y);class r_ extends as{constructor(e,t,r,n){super(e,t_(),t,r,n,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=c([]),this.hasOcclusionOpacityProperties=void 0!==e.paint&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){"icon-occlusion-opacity"!==e&&"text-occlusion-opacity"!==e||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,t){super.recalculate(e,t),this.appearances&&this.appearances.forEach(r=>{r.recalculate(e,t,this.iconImageUseTheme)}),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const e=[];for(const t of r)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,t,r,n){return this._saturation===e&&this._contrast===t&&this._brightnessMin===r&&this._brightnessMax===n||(this._colorAdjustmentMatrix=function(e,t,r,n){e=it(e),t=nt(t);const i=s(),o=e/3,a=1-2*o,l=[a,o,o,0,o,a,o,0,o,o,a,0,0,0,0,1],c=.5-.5*t,u=n-r;return d(i,[u,0,0,0,0,u,0,0,0,0,u,0,r,r,r,1],[t,0,0,0,0,t,0,0,0,0,t,0,c,c,c,1]),d(i,i,l),i}(e,t,r,n),this._saturation=e,this._contrast=t,this._brightnessMin=r,this._brightnessMax=n),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,t,r,n){const i=this.layout.get(e).evaluate(t,{},r,n),o=this._unevaluatedLayout._values[e];return o.isDataDriven()||Qo(o.value)||!i?i:Xy(t.properties,i)}getAppearanceValueAndResolveTokens(e,t,r,n,i){const o=e.getProperty(t);if(!o)return;const a=o.evaluate(r,{},n,i),s=e.getUnevaluatedProperties()._values[t];return s.isDataDriven()||Qo(s.value)||!a||"string"!=typeof a?a:Xy(r.properties,a)}createBucket(e){return new Zy(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of t_().paint.overridableProperties){if(!r_.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),r=new e_(t),n=new jo(r,t.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let i=null;i="constant"===t.value.kind||"source"===t.value.kind?new Ho("source",n):new Go("composite",n,t.value.zoomStops,t.value.interpolationType),this.paint._values[e]=new ka(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&r_.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const r=e.get("text-field"),n=t_().paint.properties[t];let i=!1;const o=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof Dr)o(r.value.value.sections);else if("source"===r.value.kind){const e=t=>{i||(t instanceof Vr&&jr(t.value)===Cr?o(t.value.sections):t instanceof Wr?o(t.sections):t.eachChild(e))},t=r.value;t._styleExpression&&e(t._styleExpression.expression)}return i}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,t,r){return{config:new zl(this,{zoom:t,lut:r}),overrideFog:!1}}hasElevation(){return this.layout&&"hd-road-markup"===this.layout.get("symbol-elevation-reference")}}let n_,i_,o_,a_;var s_=ds([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function l_(e,t,r,n,i,s,l,c){const u=[e,t,1,r,n,1,i,s,1],d=[l,c,1],h=o([],u),[A,f,p]=V(d,d,h);return a(u,u,[A,0,0,0,f,0,0,0,p])}function c_(e,t,r,n,i,s,l,c){const u=function(e,t,r,n,i,s,l,c){const u=l_(0,0,1,0,1,1,0,1),d=l_(e,t,r,n,i,s,l,c);return a(d,d,o([],u))}(e,t,r,n,i,s,l,c);return[u[2]/u[8]/Nn,u[5]/u[8]/Nn]}function u_(e){return[e[0],Math.min(Math.max(e[1],-pc),pc)]}class d_ extends nr{constructor(e,t,r,n){super(),this.id=e,this.dispatcher=r,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new $t("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Ht(this.map._requestManager.transformRequest(this.url,Lt.Image),(t,r)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new er(t)):r&&(this.image=r instanceof HTMLImageElement?mt.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Pf(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new $t("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Pf||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],r=e[0][1];for(const i of e)i[1]>r&&(r=i[1]),i[1]<t&&(t=i[1]);const n=(r+t)/2;if(n>pc?this.onNorthPole=!0:n<-pc&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(vc.fromLngLat);this.tileID=function(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(const c of e)t=Math.min(t,c.x),r=Math.min(r,c.y),n=Math.max(n,c.x),i=Math.max(i,c.y);const o=Math.max(n-t,i-r),a=Math.max(0,Math.floor(-Math.log2(o))),s=Math.pow(2,a);let l=Math.floor((t+n)/2*s);return l>1&&(l-=1),new Su(a,l,Math.floor((r+i)/2*s))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new $t("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Pf||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const o in this.tiles){const e=this.tiles[o];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const t=my(new Su(0,0,0),this.map.transform.projection),r=[t.projection.project(this.coordinates[0][0],this.coordinates[0][1]),t.projection.project(this.coordinates[1][0],this.coordinates[1][1]),t.projection.project(this.coordinates[2][0],this.coordinates[2][1]),t.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,r=e[1].y-e[0].y,n=e[2].x-e[1].x,i=e[2].y-e[1].y,o=e[3].x-e[2].x,a=e[3].y-e[2].y,s=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*i-n*r,u=n*a-o*i,d=o*l-s*a,h=s*r-t*l;return c>0&&u>0&&d>0&&h>0||c<0&&u<0&&d<0&&h<0}(r))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const n=my(this.tileID,this.map.transform.projection),[i,s,l,c]=this.coordinates.map(e=>{const t=n.projection.project(e[0],e[1]);return gy(n,t)._round()});this.perspectiveTransform=c_(i.x,i.y,s.x,s.y,l.x,l.y,c.x,c.y);const u=this._boundsArray=new ps;u.emplaceBack(i.x,i.y,0,0),u.emplaceBack(s.x,s.y,Nn,0),u.emplaceBack(c.x,c.y,0,Nn),u.emplaceBack(l.x,l.y,Nn,Nn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(u,s_.members),this.boundsSegments=dl.simpleSegment(0,0,4,2);const d=[],h=[u_((A=this.coordinates)[0]),u_(A[1]),u_(A[2]),u_(A[3])];var A;const[f,p,m,g]=function(e){let t=e[0][0],r=t,n=e[0][1],i=n;for(let o=1;o<e.length;o++)e[o][0]<t?t=e[o][0]:e[o][0]>r&&(r=e[o][0]),e[o][1]<n?n=e[o][1]:e[o][1]>i&&(i=e[o][1]);return[t,n,r-t,i-n]}(h);{const n=new ps,[i,s,l,c]=function(e){let t=e[0].x,r=t,n=e[0].y,i=n;for(let o=1;o<e.length;o++)e[o].x<t?t=e[o].x:e[o].x>r&&(r=e[o].x),e[o].y<n?n=e[o].y:e[o].y>i&&(i=e[o].y);return[t,n,r-t,i-n]}(r),u=e=>[(e.x-i)/l,(e.y-s)/c],[h,A,y,_]=r.map(u),v=function(e,t,r,n,i,s,l,c){const u=l_(0,0,1,0,1,1,0,1);return a(u,u,o([],l_(e,t,r,n,i,s,l,c)))}(h[0],h[1],A[0],A[1],y[0],y[1],_[0],_[1]);this.elevatedGlobePerspectiveTransform=c_(h[0],h[1],A[0],A[1],y[0],y[1],_[0],_[1]);const x=(e,t)=>{d.push(e.lng);const r=Math.round((e.lng-f)/m*Nn),i=Math.round((e.lat-p)/g*Nn),o=u(t),a=V([],[o[0],o[1],1],v),s=Math.round(a[0]/a[2]*Nn),l=Math.round(a[1]/a[2]*Nn);n.emplaceBack(r,i,s,l)},w=r[3].x-r[0].x,b=r[3].y-r[0].y,B=r[2].x-r[1].x,C=r[2].y-r[1].y;for(let e=0;e<65;e++){const n=e/64,i=[r[0].x+n*w,r[0].y+n*b],o=[r[1].x+n*B,r[1].y+n*C],a=o[0]-i[0],s=o[1]-i[1];for(let e=0;e<65;e++){const r=e/64,n={x:i[0]+a*r,y:i[1]+s*r};x(t.projection.unproject(n.x,n.y),n)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(n,s_.members)}{this.maxLongitudeTriangleSize=0;let t=[],r=new Os;const n=(e,n,i)=>{r.emplaceBack(e,n,i);const o=d[e],a=d[n],s=d[i],l=Math.min(Math.min(o,a),s),c=Math.max(Math.max(o,a),s)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),t.push(l+c/2)};for(let e=0;e<64;e++)for(let t=0;t<64;t++){const r=65*e+t,i=r+1,o=r+65,a=o+1;n(r,o,i),n(i,o,a)}[t,r]=function(e,t){const r=Array.from({length:e.length},(e,t)=>t);r.sort((t,r)=>e[t]-e[r]);const n=[],i=new Os;for(let o=0;o<r.length;o++){const a=r[o];n.push(e[a]);const s=3*a,l=s+1;i.emplaceBack(t.uint16[s],t.uint16[l],t.uint16[l+1])}return[n,i]}(t,r),this.elevatedGlobeTrianglesCenterLongitudes=t,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(r)}this.elevatedGlobeSegments=dl.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,m/Nn,0,g/Nn,0,0,p,f,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,r=t.gl;!this._dirty||this.texture instanceof Pf||(this.texture?this.texture.update(this.image):(this.texture=new kf(t,this.image,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const r=this.elevatedGlobeTrianglesCenterLongitudes;let n=(i=e+180)+360*Math.round((r[0]-i)/360);var i;const o=new dl,a=(e,r)=>{o.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:r,sortKey:void 0,vaos:{}})},s=.51*this.maxLongitudeTriangleSize;if(Math.abs(r[0]-n)<=s){const e=rt(r,0,r.length,n+s);return e===r.length||a(e,tt(r,e+1,r.length,n+360-s)-e),o}n<r[0]&&(n+=360);const l=tt(r,0,r.length,n-s);if(l===r.length)return a(0,r.length),o;a(0,l-0);const c=rt(r,l+1,r.length,n+s);return c!==r.length&&a(c,r.length-c),o}}const h_=(Math.pow(256,2)-1)/16907520;class A_ extends as{constructor(e,t,r,n){super(e,{layout:o_||(o_=new Da({visibility:new Ma(Ua.layout_raster.visibility)})),paint:a_||(a_=new Da({"raster-opacity":new Ma(Ua.paint_raster["raster-opacity"]),"raster-color":new La(Ua.paint_raster["raster-color"]),"raster-color-mix":new Ma(Ua.paint_raster["raster-color-mix"]),"raster-color-range":new Ma(Ua.paint_raster["raster-color-range"]),"raster-hue-rotate":new Ma(Ua.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ma(Ua.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ma(Ua.paint_raster["raster-brightness-max"]),"raster-saturation":new Ma(Ua.paint_raster["raster-saturation"]),"raster-contrast":new Ma(Ua.paint_raster["raster-contrast"]),"raster-resampling":new Ma(Ua.paint_raster["raster-resampling"]),"raster-fade-duration":new Ma(Ua.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Ma(Ua.paint_raster["raster-emissive-strength"]),"raster-array-band":new Ma(Ua.paint_raster["raster-array-band"]),"raster-elevation":new Ma(Ua.paint_raster["raster-elevation"]),"raster-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof d_&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[r,n]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(r)&&isNaN(n)||r===this._curRampRange[0]&&n===this._curRampRange[1]||(this.colorRamp=Cd({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:r,end:n}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[r,n])}}let f_,p_,m_,g_,y_;class __ extends as{constructor(e,t,r,n){super(e,{layout:f_||(f_=new Da({visibility:new Ma(Ua["layout_raster-particle"].visibility)})),paint:p_||(p_=new Da({"raster-particle-array-band":new Ma(Ua["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Ma(Ua["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new La(Ua["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Ma(Ua["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Ma(Ua["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Ma(Ua["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Ma(Ua["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Ma(Ua["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this._updateColorRamp(),this.lastInvalidatedAt=mt.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Cd({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=mt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class v_ extends as{constructor(e,t){super(e,{},t,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function x_(e,t,r){const n=[0,0,1],i=te([]);return ne(i,i,r?-Te(e)+Math.PI:Te(e)),re(i,i,-Te(t)),H(n,n,i),R(n,n)}const w_={None:0,Model:1,Symbol:2,FillExtrusion:4};class b_{constructor(e,t,r,n){this.message=(e?"".concat(e,": "):"")+r,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}function B_(e,t){const r=-1===e.indexOf("://");try{return new URL(e,r&&t?"http://example.com":void 0),!0}catch(e){return!1}}class C_{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class E_{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Gs,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const t=16*e,r=this.instancedDataArray.float32;let n=Math.floor(r[t+2]);const i=1.05*(r[t+2]-n);return n/=100,[r[t]%1*1.05,r[t+1]%1*1.05,i,n]}tileCoordinatesForInstance(e){const t=16*e,r=this.instancedDataArray.float32;let n=r[t+0];return n=n>Nn?n-Nn:n,new Be(Math.trunc(n),Math.trunc(r[t+1]))}translationForInstance(e){const t=16*e,r=this.instancedDataArray.float32;return[r[t+4],r[t+5],r[t+6]]}rotationScaleForInstance(e){const t=16*e,r=this.instancedDataArray.float32;return[r[t+7],r[t+8],r[t+9],r[t+10],r[t+11],r[t+12],r[t+13],r[t+14],r[t+15]]}transformForInstance(e){const t=16*e,r=this.instancedDataArray.float32;return[r[t+7],r[t+8],r[t+9],r[t+4],r[t+10],r[t+11],r[t+12],r[t+5],r[t+13],r[t+14],r[t+15],r[t+6],0,0,0,1]}}class S_{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,t){}updateAppearances(e,t,r,n){}populate(e,t,r,n){this.tileToMeter=_c(r);const i=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:o,id:a,index:s,sourceLayerIndex:l}of e){const e=null!=a?a:o.properties&&o.properties.hasOwnProperty("id")?o.properties.id:void 0,c=Ic(o,i);if(!this.layers[0]._featureFilter.filter(new Ba(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),c,r))continue;const u={id:e,sourceLayerIndex:l,index:s,geometry:i?c.geometry:Tc(o,r,n),properties:o.properties,type:o.type,patterns:{}},d=this.addFeature(u,u.geometry,c);d&&t.featureIndex.insert(o,u.geometry,s,l,this.index,this.instancesPerModel[d].instancedDataArray.length,Nn/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,t=this.layers[0].scope;let r=0;for(const n of this.modelUris){const i=e.getModel(n,t);if(!i)continue;const o=this.instancesPerModel[n];if(o){const e=.5*O(i.aabb.max,i.aabb.min)*o.maxScale+o.maxXYTranslationDistance,t=Math.min(Nn,Math.max(e/this.tileToMeter,Nn/32));r=Math.max(t,r)}}return r}update(e,t,r,n){for(const i in this.instancesPerModel){const t=this.instancesPerModel[i];for(const r in e)t.idToFeaturesIndex.hasOwnProperty(r)&&(this.evaluate(t.features[t.idToFeaturesIndex[r]],e[r],t,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];for(const t of r.features){const n=this.layers[0],i=t.feature,o=this.canonical,a=n.paint.get("model-rotation").evaluate(i,{},o),s=n.paint.get("model-scale").evaluate(i,{},o),l=n.paint.get("model-translation").evaluate(i,{},o);K(t.rotation,a)&&K(t.scale,s)&&K(t.translation,l)||(this.evaluate(t,t.featureStates,r,!0),e=!0)}}return e}updateReplacement(e,t,r,n){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Qh(this.activeReplacements,i))return!1;this.activeReplacements=i;let o=!1;for(const a in this.instancesPerModel){const t=this.instancesPerModel[a],i=t.instancedDataArray;for(const a of t.features){const t=a.instancedDataOffset,s=a.instancedDataCount;for(let a=0;a<s;a++){const s=16*(a+t);let l=i.float32[s+0];const c=l>Nn;l=c?l-Nn:l;const u=Math.floor(l),d=Math.floor(i.float32[s+1]);let h=!1;for(const t of this.activeReplacements)if(!Rh(t,r,w_.Model,n)&&!(t.min.x>u||u>t.max.x||t.min.y>d||d>t.max.y)&&(h=qh(Wh(u,d,e.canonical,t.footprintTileId.canonical),t.footprint),h))break;i.float32[s]=h?l+Nn:l,o=o||h!==c}}}return o}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];r.instancedDataArray.length<0||0===r.instancedDataArray.length||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,Rf.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const r in this.instancesPerModel){const e=this.instancesPerModel[r];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(e&&t&&this.modelUris&&this.modelsRequested)for(const r of this.modelUris)t.removeModel(r,"",!0)}addFeature(e,t,r){const n=this.layers[0],i=n.layout.get("model-id").evaluate(r,{},this.canonical);if(!i)return We("modelId is not evaluated for layer ".concat(n.id," and it is not going to get rendered.")),i;(B_(i,!1)||void 0!==this.styleDefinedModelURLs[i])&&(this.modelUris.includes(i)||this.modelUris.push(i)),this.instancesPerModel[i]||(this.instancesPerModel[i]=new E_);const o=this.instancesPerModel[i],a=o.instancedDataArray,s=new C_(r,a.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=Nn||e.y<0||e.y>=Nn)continue;if(0!==this.lookupDim){const t=(this.lookupDim-1)/Nn,r=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[r])continue;this.lookup[r]=1}}this.instanceCount++;const t=a.length;a.resize(t+1),o.instancesEvaluatedElevation.push(0),a.float32[16*t]=e.x,a.float32[16*t+1]=e.y}return s.instancedDataCount=o.instancedDataArray.length-s.instancedDataOffset,s.instancedDataCount>0&&(e.id&&(o.idToFeaturesIndex[e.id]=o.features.length),o.features.push(s),this.evaluate(s,{},o,!1)),i}getModelUris(){return this.modelUris}evaluate(e,t,r,n){const i=this.layers[0],o=e.feature,a=this.canonical,s=e.rotation=i.paint.get("model-rotation").evaluate(o,t,a),l=e.scale=i.paint.get("model-scale").evaluate(o,t,a),c=e.translation=i.paint.get("model-translation").evaluate(o,t,a),u=Object.assign({},i.paint.get("model-color").evaluate(o,t,a));u.a=i.paint.get("model-color-mix-intensity").evaluate(o,t,a);const d=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]);const h=c[0]*c[0]+c[1]*c[1],A=h>0?Math.sqrt(h):0;r.maxScale=Math.max(Math.max(r.maxScale,l[0]),Math.max(l[1],l[2])),r.maxXYTranslationDistance=Math.max(r.maxXYTranslationDistance,A),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),Kf(d,s,l);const f=Math.round(100*u.a)+u.b/1.05;for(let p=0;p<e.instancedDataCount;++p){const t=e.instancedDataOffset+p,i=16*t,o=r.instancedDataArray.float32;let s=0;n&&(s=o[i+6]-r.instancesEvaluatedElevation[t]);const l=0|o[i+1];o[i]=(0|o[i])+u.r/1.05,o[i+1]=l+u.g/1.05,o[i+2]=f,o[i+3]=1/(a.z>10?this.tileToMeter:_c(a,l)),o[i+4]=c[0],o[i+5]=c[1],o[i+6]=c[2]+s,o[i+7]=d[0],o[i+8]=d[1],o[i+9]=d[2],o[i+10]=d[4],o[i+11]=d[5],o[i+12]=d[6],o[i+13]=d[8],o[i+14]=d[9],o[i+15]=d[10],r.instancesEvaluatedElevation[t]=c[2]}}}let T_,I_;ea(S_,"ModelBucket",{omit:["layers"]}),ea(E_,"PerModelAttributes"),ea(C_,"ModelFeature");class F_{constructor(e,t,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=r}static create(e,t,r){const n=r||e.findDEMTileFor(t);if(!n||!n.dem)return;const i=n.dem,o=n.tileID,a=1<<t.canonical.z-o.canonical.z;return new F_(n,i.dim/Nn/a,[(t.canonical.x/a-o.canonical.x)*i.dim,(t.canonical.y/a-o.canonical.y)*i.dim])}tileCoordToPixel(e,t){const r=t*this._scale+this._offset[1];return new Be(Math.floor(e*this._scale+this._offset[0]),Math.floor(r))}getElevationAt(e,t,r,n){const i=e*this._scale+this._offset[0],o=t*this._scale+this._offset[1],a=Math.floor(i),s=Math.floor(o),l=this._dem;return n=!!n,r?hr(hr(l.get(a,s,n),l.get(a,s+1,n),o-s),hr(l.get(a+1,s,n),l.get(a+1,s+1,n),o-s),i-a):l.get(a,s,n)}getElevationAtPixel(e,t,r){return this._dem.get(e,t,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*dc(1,e)*this._dem.stride}}const k_=new Float32Array(262144),P_=new Uint8Array(262144);function M_(e){let t=0;if(e.meshes)for(const r of e.meshes)t=Math.max(t,r.aabb.max[2]);if(e.children)for(const r of e.children)t=Math.max(t,M_(r));return t}function O_(e,t,r){if(e.meshes)for(const n of e.meshes){if(n.aabb.min[0]===1/0)continue;const i=Jc.applyTransform(n.aabb,e.globalMatrix);r.insert(t,i.min[0],i.min[1],i.max[0],i.max[1])}if(e.children)for(const n of e.children)O_(n,t,r)}const L_=["","wall","door","roof","window","lamp","logo"];class D_{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:M_(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Jc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new Jc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.node.meshes)this.node.lightMeshIndex!==e&&(r.transformedAabb=Jc.applyTransformFast(r.aabb,this.node.globalMatrix),t.encapsulate(r.transformedAabb)),e++;this.aabb=t}return this.aabb}}class U_{constructor(e,t,r,n,i,o,a,s){this.id=r,this.layers=e,this.layerIds=this.layers.map(e=>e.fqid),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.modelTraits|=Yf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=Yf.HasMapboxMeshFeatures),i&&(this.modelTraits|=Yf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=o,this.worldview=s,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const l of t)this.nodesInfo.push(new D_(l)),O_(l,a.featureIndexArray.length,a.grid),a.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,a.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,t){for(const r of this.getNodesInfo()){const n=r.node;n.footprint&&t.push({footprint:n.footprint,id:e})}}updateAppearances(e,t,r,n){}update(e){const t=0!==Object.keys(e).length;if(t&&!this.stateDependentLayers.length)return;const r=t?this.stateDependentLayers:this.layers;if(!Ce(e,this.states))for(const n of r)this.evaluate(n,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const r of t){const t=r.node;this.uploaded?this.updatePbrBuffer(t):rp(t,e,!0)}for(const r of t)np(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),t=!0);return t}needsReEvaluation(e,t,r){const n=e.transform.projectionOptions,i=e.style.getBrightness(),o=this.brightness!==i;if(!this.uploaded||this.dirty||n.name!==this.projection.name||R_(r.paint.get("model-color").value,o)||R_(r.paint.get("model-color-mix-intensity").value,o)||R_(r.paint.get("model-roughness").value,o)||R_(r.paint.get("model-emissive-strength").value,o)||R_(r.paint.get("model-height-based-emissive-strength-multiplier").value,o)){this.projection=n,this.brightness=i;const e=this.getNodesInfo();for(const t of e)t.state=null;return!0}return!1}evaluateTransform(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const r=this.getNodesInfo(),n=this.id.canonical;for(const i of r){const e=i.feature;i.evaluatedTranslation=t.paint.get("model-translation").evaluate(e,{},n),i.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},n)}}evaluate(e,t){const r=this.getNodesInfo();for(const n of r){if(!n.node.meshes)continue;const r=n.feature,i=t&&t[r.id];if(Ce(i,n.state))continue;n.state=structuredClone(i);const o=n.node.meshes&&n.node.meshes[0].featureData,a=n.evaluatedColor[2],s=n.evaluatedRMEA[2],l=this.id.canonical;if(n.hasTranslucentParts=!1,o){for(let t=0;t<L_.length;t++){const o=L_[t];o.length&&(r.properties.part=o);const a=e.paint.get("model-color").evaluate(r,i,l).toPremultipliedRenderColor(null),s=e.paint.get("model-color-mix-intensity").evaluate(r,i,l);n.evaluatedColor[t]=[a.r,a.g,a.b,s],n.evaluatedRMEA[t][0]=e.paint.get("model-roughness").evaluate(r,i,l),n.evaluatedRMEA[t][2]=e.paint.get("model-emissive-strength").evaluate(r,i,l),n.evaluatedRMEA[t][3]=a.a,n.emissionHeightBasedParams[t]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(r,i,l),!n.hasTranslucentParts&&a.a<1&&(n.hasTranslucentParts=!0)}delete r.properties.part,N_(n,a!==n.evaluatedColor[2]||s!==n.evaluatedRMEA[2],this.modelTraits)}else n.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(r,i,l);n.evaluatedTranslation=e.paint.get("model-translation").evaluate(r,i,l),n.evaluatedScale=e.paint.get("model-scale").evaluate(r,i,l),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,r,n){const i=e.findDEMTileFor(r);if(i&&(i.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(i.dem&&i.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=i.tileID.overscaledZ;const t=F_.create(e,r,i);if(!t)return;this.modelTraits&Yf.HasMapboxMeshFeatures&&this.updateDEM(e,t,r,n);for(const e of this.getNodesInfo()){const r=e.node;if(!r.footprint||!r.footprint.vertices||!r.footprint.vertices.length)continue;const n=r.footprint.vertices;let i=t.getElevationAt(n[0].x,n[0].y,!0,!0);for(let e=1;e<n.length;e++)i=Math.min(i,t.getElevationAt(n[e].x,n[e].y,!0,!0));r.elevation=i}}this.terrainTile=i.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,r,n){let i=t._dem._modifiedForSources[n];if(void 0===i&&(t._dem._modifiedForSources[n]=[],i=t._dem._modifiedForSources[n]),i.includes(r.canonical))return;const o=t._dem.dim;i.push(r.canonical);let a=!1;for(const s of this.getNodesInfo()){const e=s.node;if(!e.footprint||!e.footprint.grid)continue;const r=e.footprint.grid,n=t.tileCoordToPixel(r.min.x,r.min.y),i=t.tileCoordToPixel(r.max.x,r.max.y),l=Math.min(Math.min(o-i.y,n.x),Math.min(n.y,o-i.x));if(l<0)continue;const c=Oe(l,2,5);let u=Math.max(0,n.x-c),d=Math.max(0,n.y-c),h=Math.min(i.x+c,o-1),A=Math.min(i.y+c,o-1);for(let t=d;t<=A;++t)for(let e=u;e<=h;++e)P_[t*o+e]=255;let f=0,p=0;for(let a=0;a<r.cellsY;++a)for(let e=0;e<r.cellsX;++e){if(!r.cells[a*r.cellsX+e])continue;const n=t.tileCoordToPixel(r.min.x+e/r.xScale,r.min.y+a/r.yScale),i=t.tileCoordToPixel(r.min.x+(e+1)/r.xScale,r.min.y+(a+1)/r.yScale);for(let e=n.y;e<=Math.min(i.y+1,o-1);++e)for(let r=n.x;r<=Math.min(i.x+1,o-1);++r)255===P_[e*o+r]&&(P_[e*o+r]=0,f+=t.getElevationAtPixel(r,e),p++)}const m=f/p;u=Math.max(1,n.x-c),d=Math.max(1,n.y-c),h=Math.min(i.x+c,o-2),A=Math.min(i.y+c,o-2),a=!0;for(let a=d;a<=A;++a)for(let e=u;e<=h;++e)0===P_[a*o+e]&&(k_[a*o+e]=t._dem.set(e,a,m));for(let a=1;a<c;++a){u=Math.max(1,n.x-a),d=Math.max(1,n.y-a),h=Math.min(i.x+a,o-2),A=Math.min(i.y+a,o-2);for(let e=d;e<=A;++e)for(let r=u;r<=h;++r){const n=e*o+r;if(255===P_[n]){let i=0,s=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let n=-1;n<=1;++n){const c=(e+t)*o+r+n;if(P_[c]>=a)continue;const d=k_[c],h=Math.abs(d);h>s&&(i=d,s=h,l=n,u=t)}if(s>.1){const o=1-(a+.5*Math.abs(l*u))/c;let s=t._dem.get(r,e)+i*o;const d=t._dem.get(r+l,e+u),h=t._dem.get(r-l,e-u,!0);(s-d)*(s-h)>0&&(s=(d+h)/2),k_[n]=t._dem.set(r,e,s),P_[n]=a}}}}}a&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=mt.now())}setFilter(e){this.filter=e?ja(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Ba(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)np(t.node),ip(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped());for(const n of this.getNodesInfo()){const e=n.node.footprint;n.hiddenByReplacement=!!e&&!r.find(t=>t.footprint===e)}}getHeightAtTileCoord(e,t){const r=[],n=[0,0,0],i=c([]);for(const o of this.getNodesInfo()){const a=o.node.meshes[0],s=a.transformedAabb;if(e<s.min[0]||t<s.min[1]||e>s.max[0]||t>s.max[1])continue;if(!0===o.node.hidden)return{height:1/0,maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]};u(i,o.node.globalMatrix),n[0]=e,n[1]=t,Q(n,n,i);const l=(n[0]-a.aabb.min[0])/(a.aabb.max[0]-a.aabb.min[0])*Xf|0,c=Math.min(63,(n[1]-a.aabb.min[1])/(a.aabb.max[1]-a.aabb.min[1])*Xf|0)*Xf+Math.min(63,l),d=a.heightmap[c];if(!(d<0&&o.node.footprint)){if(o.hiddenByReplacement)return;return{height:d,maxHeight:o.feature.properties.height,hidden:!1,verticalScale:o.evaluatedScale[2]}}if(o.node.footprint.grid.query(new Be(e,t),new Be(e,t),r),r.length>0)return{height:void 0,maxHeight:o.feature.properties.height,hidden:o.hiddenByReplacement,verticalScale:o.evaluatedScale[2]}}}}function R_(e,t){return e instanceof Ho&&!e.isLightConstant&&t}function z_(e,t,r,n,i,o,a,s){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;r[3]>0&&(l=hr(l,255*r[0],r[3]),c=hr(c,255*r[1],r[3]),u=hr(u,255*r[2],r[3]));const d=l<<8|c,h=u<<8|Math.floor(255*n[3]),A=function(e){const t=Oe(e,0,2);return Math.min(Math.round(.5*t*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],f=Oe(i[0],0,1),p=Oe(i[1],0,1),m=Oe(i[2],0,1),g=Oe(i[3],0,1);let y,_,v,x;if(f!==p&&a!==o&&p!==f){const e=a-o;_=1/(e*(p-f)),v=-(o+e*f)/(e*(p-f));const t=Oe(i[4],-1,1);x=Math.pow(10,t),y=255*m<<8|255*g}else y=65535,_=0,v=1,x=1;if(e.emplaceBack(d,h,A,y,_,v,x),s){const e=s.length;s.clear();for(let t=0;t<e;t++)s.emplaceBack(d,h,A,y,_,v,x)}}function N_(e,t,r){const n=e.node;let i=0;const o=r&Yf.HasMeshoptCompression;for(const a of n.meshes){if(n.lights&&n.lightMeshIndex===i)continue;if(!a.featureData)continue;a.featureArray=new Ks,a.featureArray.reserve(a.featureData.length);let r=t;for(const t of a.featureData){const i=o?65535&t:t>>16&65535,s=o?t>>16&65535:65535&t,l=(15&s)<8?15&s:0,c=e.evaluatedRMEA[l],u=e.evaluatedColor[l],d=e.emissionHeightBasedParams[l];let h;if(r&&2===l&&n.lights&&(h=new Ks,h.resize(10*n.lights.length)),z_(a.featureArray,i,u,c,d,a.aabb.min[2],a.aabb.max[2],h),h&&r){r=!1;const e=n.meshes[n.lightMeshIndex];e.featureArray=h,e.featureArray._trim()}}a.featureArray._trim(),i++}}ea(U_,"Tiled3dModelBucket",{omit:["layers"]}),ea(D_,"Tiled3dModelFeature");const j_=["id","tile","layer","source","sourceLayer","state"];class Q_{constructor(e,t,r,n,i){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=r,this._y=n,this.properties=e?e.properties:{},this.id=i}clone(){const e=new Q_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return void 0===this._geometry&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const t of j_)void 0!==this[t]&&(e[t]=this[t]);return e}}class V_ extends nr{constructor(e,t,r,n){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t,this._modelsInfo=new Map}load(){const e=[];for(const t in this._options.models){const r=this._options.models[t],n=this._modelsInfo.get(t);if(n){const e=n.model;e.position=null!=r.position?new ic(r.position[0],r.position[1]):new ic(0,0),e.orientation=null!=r.orientation?r.orientation:[0,0,0],n.modelSpec=r,V_.applyModelSpecification(e,r),e.computeBoundsAndApplyParent(),this.models.push(e)}else{const n=Tf(this.map._requestManager.transformRequest(r.uri,Lt.Model).url).then(e=>{if(!e)return;const n=hp(e),i=new $f(t,r.uri,r.position,r.orientation,n);V_.applyModelSpecification(i,r),i.computeBoundsAndApplyParent(),this.models.push(i),this._modelsInfo.set(t,{modelSpec:r,model:i})}).catch(e=>{this.fire(new er(new Error("Could not load model ".concat(t," from ").concat(r.uri,": ").concat(e.message))))});e.push(n)}}Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new $t("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this._loaded=!0,this.fire(new er(new Error("Could not load models: ".concat(e.message))))})}static applyModelSpecification(e,t){t.nodeOverrides&&V_.convertNodeOverrides(e,t.nodeOverrides),t.materialOverrides&&V_.convertMaterialOverrides(e,t.materialOverrides),t.nodeOverrideNames&&(e.nodeOverrideNames=[...t.nodeOverrideNames]),t.materialOverrideNames&&(e.materialOverrideNames=[...t.materialOverrideNames]),t.featureProperties&&(e.featureProperties=t.featureProperties)}static convertNodeOverrides(e,t){if(Array.isArray(t)&&t.every(e=>"string"==typeof e)){e.nodeOverrideNames=[];for(const r of t)e.nodeOverrideNames.push(r)}else Object.entries(t).forEach(t=>{let[r,n]=t;const i={orientation:[0,0,0]};if(n.hasOwnProperty("orientation")){const e=n.orientation;e&&(i.orientation=e)}e.nodeOverrides.set(r,i)})}static convertMaterialOverrides(e,t){if(Array.isArray(t)&&t.every(e=>"string"==typeof e)){e.materialOverrideNames=[];for(const r of t)e.materialOverrideNames.push(r)}else Object.entries(t).forEach(t=>{let[r,n]=t;const i={color:new lr(1,1,1),colorMix:0,emissionStrength:0,opacity:1},o=n["model-color"];void 0!==o&&(i.color.r=o[0],i.color.g=o[1],i.color.b=o[2]);const a=n["model-color-mix-intensity"];void 0!==a&&(i.colorMix=a);const s=n["model-emissive-strength"];void 0!==s&&(i.emissionStrength=s);const l=n["model-opacity"];void 0!==l&&(i.opacity=l),e.materialOverrides.set(r,i)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return this._options}setProperty(e,t){return!1}reload(){const e=es(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const t=new Map;for(const r in e){const n=e[r];if(this._modelsInfo.has(r)){const e=this._modelsInfo.get(r);e&&e.modelSpec.uri===n.uri&&t.set(r,e)}}this._modelsInfo=t,this._options.models=e,this._loaded=!1,this.load()}}function H_(e,t,r,n){const i=1<<e.z;t.lat=Ac((n/Nn+e.y)/i),t.lng=hc((r/Nn+e.x)/i)}function G_(e,t,r,n){const i=e.getNodesInfo()[t];if(!i||i.hiddenByReplacement||!i.node.meshes)return;let o=Number.MAX_VALUE;const a=i.node,s=r.tile,l=n.calculatePosMatrix(s.tileID.toUnwrapped(),n.worldSize),c=i.evaluatedScale;let u=0;n.elevation&&a.elevation&&(u=a.elevation*n.elevation.exaggeration()),h(l,l,[(a.anchor?a.anchor[0]:0)*(c[0]-1),(a.anchor?a.anchor[1]:0)*(c[1]-1),u]),A(l,l,c);const f=r.queryGeometry,p=f.isPointQuery()?f.screenBounds:f.screenGeometry,m=function(e){const t=d([],l,e.globalMatrix);d(t,n.expandedFarZProjMatrix,t);for(let r=0;r<e.meshes.length;++r){const i=e.meshes[r];if(r===e.lightMeshIndex)continue;const a=Zf(p,n,t,i.aabb);null!=a&&(o=Math.min(a,o))}if(e.children)for(const r of e.children)m(r)};if(m(a),o===Number.MAX_VALUE)return;const g=new ic(0,0);return H_(s.tileID.canonical,g,i.node.anchor[0],i.node.anchor[1]),{intersectionZ:o,position:g,feature:i.feature}}const K_={circle:class extends as{constructor(e,t,r,n){super(e,{layout:Bu||(Bu=new Da({"circle-sort-key":new Oa(Ua.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Ma(Ua.layout_circle["circle-elevation-reference"]),visibility:new Ma(Ua.layout_circle.visibility)})),paint:Cu||(Cu=new Da({"circle-radius":new Oa(Ua.paint_circle["circle-radius"]),"circle-color":new Oa(Ua.paint_circle["circle-color"]),"circle-blur":new Oa(Ua.paint_circle["circle-blur"]),"circle-opacity":new Oa(Ua.paint_circle["circle-opacity"]),"circle-translate":new Ma(Ua.paint_circle["circle-translate"]),"circle-translate-anchor":new Ma(Ua.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ma(Ua.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ma(Ua.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Oa(Ua.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Oa(Ua.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Oa(Ua.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Ma(Ua.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n)}createBucket(e){return new nu(e)}queryRadius(e){const t=e;return vu("circle-radius",this,t)+vu("circle-stroke-width",this,t)+xu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,n,i,o,a,s){const l=bu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return cd(e,n,o,a,s,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t,r){const n=ld(this);return{config:new zl(this,{zoom:t,lut:r}),defines:n,overrideFog:!1}}is3D(e){return!e&&!!this.layout&&"none"!==this.layout.get("circle-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("circle-elevation-reference")}},heatmap:class extends as{createBucket(e){return new fd(e)}constructor(e,t,r,n){super(e,{layout:pd||(pd=new Da({visibility:new Ma(Ua.layout_heatmap.visibility)})),paint:md||(md=new Da({"heatmap-radius":new Oa(Ua.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Oa(Ua.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ma(Ua.paint_heatmap["heatmap-intensity"]),"heatmap-color":new La(Ua.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ma(Ua.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Cd({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(e){return vu("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,n,i,o,a,s){const l=this.paint.get("heatmap-radius").evaluate(t,r);return cd(e,n,o,a,s,!0,!0,new Be(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t,r){return"heatmap"===e?{config:new zl(this,{zoom:t,lut:r}),overrideFog:!1}:{}}},hillshade:class extends as{constructor(e,t,r,n){super(e,{layout:gd||(gd=new Da({visibility:new Ma(Ua.layout_hillshade.visibility)})),paint:yd||(yd=new Da({"hillshade-illumination-direction":new Ma(Ua.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ma(Ua.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ma(Ua.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ma(Ua.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ma(Ua.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ma(Ua.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Ma(Ua.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t,r){return{overrideFog:!1}}},fill:class extends as{constructor(e,t,r,n){super(e,{layout:xh||(xh=new Da({"fill-sort-key":new Oa(Ua.layout_fill["fill-sort-key"]),visibility:new Ma(Ua.layout_fill.visibility),"fill-elevation-reference":new Ma(Ua.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Oa(Ua.layout_fill["fill-construct-bridge-guard-rail"])})),paint:wh||(wh=new Da({"fill-antialias":new Ma(Ua.paint_fill["fill-antialias"]),"fill-opacity":new Oa(Ua.paint_fill["fill-opacity"]),"fill-color":new Oa(Ua.paint_fill["fill-color"]),"fill-outline-color":new Oa(Ua.paint_fill["fill-outline-color"]),"fill-translate":new Ma(Ua.paint_fill["fill-translate"]),"fill-translate-anchor":new Ma(Ua.paint_fill["fill-translate-anchor"]),"fill-pattern":new Oa(Ua.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Ma(Ua.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Ma(Ua.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Oa(Ua.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Oa(Ua.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Oa(Ua.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(e,t,r){return{config:new zl(this,{zoom:t,lut:r}),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new vh(e)}queryRadius(){return xu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,n,i,o){return!e.queryGeometry.isAboveHorizon&&au(wu(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(e){if(0!==this.paint.get("fill-z-offset").constantOr(1))return!0;const t=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=e?t&&!e:t}hasElevation(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}hasShadowPass(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}},"fill-extrusion":class extends as{constructor(e,t,r,n){super(e,{layout:TA||(TA=new Da({visibility:new Ma(Ua["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Ma(Ua["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:IA||(IA=new Da({"fill-extrusion-opacity":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Oa(Ua["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Oa(Ua["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Oa(Ua["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Oa(Ua["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Oa(Ua["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Oa(Ua["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Oa(Ua["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Oa(Ua["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Ma(Ua["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new gA(e)}queryRadius(){return xu(this.paint.get("fill-extrusion-translate"))}is3D(e){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,r,n,i,o,a,s,l){const c=bu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,r),d=this.paint.get("fill-extrusion-base").evaluate(t,r),h=[0,0],A=s&&o.elevation,f=o.elevation?o.elevation.exaggeration():1,p=e.tile.getBucket(this);if(A&&p instanceof gA){const e=p.centroidVertexArray,t=l+1;t<e.length&&(h[0]=e.geta_centroid_pos0(t),h[1]=e.geta_centroid_pos1(t))}if(0===h[0]&&1===h[1])return!1;"globe"===o.projection.name&&(n=EA([n],[new Be(0,0),new Be(Nn,Nn)],e.tileID.canonical).map(e=>e.polygon).flat());const m=A?s:null,[g,y]=NA(o,n,d,u,c,a,m,h,f,o.center.lat,e.tileID.canonical),_=e.queryGeometry;return zA(g,y,_.isPointQuery()?_.screenBounds:_.screenGeometry)}},building:class extends as{constructor(e,t,r,n){super(e,{layout:Op||(Op=new Da({visibility:new Ma(Ua.layout_building.visibility),"building-facade":new Oa(Ua.layout_building["building-facade"]),"building-facade-floors":new Oa(Ua.layout_building["building-facade-floors"]),"building-facade-unit-width":new Oa(Ua.layout_building["building-facade-unit-width"]),"building-facade-window":new Oa(Ua.layout_building["building-facade-window"]),"building-roof-shape":new Oa(Ua.layout_building["building-roof-shape"]),"building-height":new Oa(Ua.layout_building["building-height"]),"building-base":new Oa(Ua.layout_building["building-base"]),"building-flood-light-wall-radius":new Oa(Ua.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Oa(Ua.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Oa(Ua.layout_building["building-flip-roof-orientation"])})),paint:Lp||(Lp=new Da({"building-opacity":new Ma(Ua.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Ma(Ua.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Ma(Ua.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Ma(Ua.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Ma(Ua.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Ma(Ua.paint_building["building-vertical-scale"]),"building-cast-shadows":new Ma(Ua.paint_building["building-cast-shadows"]),"building-color":new Oa(Ua.paint_building["building-color"]),"building-emissive-strength":new Oa(Ua.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Ma(Ua.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Ma(Ua.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Ma(Ua.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Ma(Ua.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Ma(Ua.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new kp(e)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(e){return!0}queryRadius(e){return 0}queryIntersectsFeature(e,t,r,n,i,o,a,s,l){let c=this.layout.get("building-height").evaluate(t,r);const u=this.layout.get("building-base").evaluate(t,r),d=e.tile.getBucket(this).getFootprint(t);if(d){if(0!==d.hiddenFlags)return!1;c=d.height}const[h,A]=NA(o,n,u,c,new Be(0,0),a,null,[0,0],1,o.center.lat,e.tileID.canonical),f=e.queryGeometry;return zA(h,A,f.isPointQuery()?f.screenBounds:f.screenGeometry)}},line:class extends as{constructor(e,t,r,n){const i=im();super(e,i,t,r,n),i.layout&&(this.layout=new Pa(i.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ti,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=(()=>{if(am)return am;const e=im();return am=new om(e.paint.properties["line-width"].specification),am.useIntegerZoom=!0,am})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Wp(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t,r){const n=tm(this);return{config:new zl(this,{zoom:t,lut:r}),defines:n,overrideFog:!1}}queryRadius(e){const t=e,r=sm(vu("line-width",this,t),vu("line-gap-width",this,t)),n=vu("line-offset",this,t);return r/2+Math.abs(n)+xu(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,n,i,o){if(e.queryGeometry.isAboveHorizon)return!1;const a=wu(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,e.pixelToTileUnitsFactor),s=e.pixelToTileUnitsFactor/2*sm(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),l=this.paint.get("line-offset").evaluate(t,r);return l&&(n=function(e,t){const r=[],n=new Be(0,0);for(let i=0;i<e.length;i++){const o=e[i],a=[];for(let e=0;e<o.length;e++){const r=o[e],i=o[e+1],s=0===e?n:r.sub(o[e-1])._unit()._perp(),l=e===o.length-1?n:i.sub(r)._unit()._perp(),c=s._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),a.push(c._mult(t)._add(r))}r.push(a)}return r}(n,l*e.pixelToTileUnitsFactor)),function(e,t,r){for(let n=0;n<t.length;n++){const i=t[n];if(e.length>=3)for(let t=0;t<i.length;t++)if(pu(e,i[t]))return!0;if(su(e,i,r))return!0}return!1}(a,n,s)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(e){return!this.hasElevatedBuckets||this.layout&&"hd-road-markup"===this.layout.get("line-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("line-elevation-reference")}},symbol:r_,background:class extends as{constructor(e,t,r,n){super(e,{layout:n_||(n_=new Da({visibility:new Ma(Ua.layout_background.visibility)})),paint:i_||(i_=new Da({"background-pitch-alignment":new Ma(Ua.paint_background["background-pitch-alignment"]),"background-color":new Ma(Ua.paint_background["background-color"]),"background-pattern":new Ma(Ua.paint_background["background-pattern"]),"background-opacity":new Ma(Ua.paint_background["background-opacity"]),"background-emissive-strength":new Ma(Ua.paint_background["background-emissive-strength"]),"background-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t,r){return{overrideFog:!1}}is3D(e){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:A_,"raster-particle":__,sky:class extends as{constructor(e,t,r,n){super(e,{layout:m_||(m_=new Da({visibility:new Ma(Ua.layout_sky.visibility)})),paint:g_||(g_=new Da({"sky-type":new Ma(Ua.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ma(Ua.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ma(Ua.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ma(Ua.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ma(Ua.paint_sky["sky-gradient-radius"]),"sky-gradient":new La(Ua.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ma(Ua.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ma(Ua.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ma(Ua.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Cd({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),n=!r,i=e.style.light,o=i.properties.get("position");return n&&"viewport"===i.properties.get("anchor")&&We("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?x_(o.azimuthal,90-o.polar,t):x_(r[0],90-r[1],t)}const r=this.paint.get("sky-gradient-center");return x_(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends as{constructor(e,t,r,n){super(e,{paint:y_||(y_=new Da({}))},t,null)}},model:class extends as{constructor(e,t,r,n){super(e,{layout:T_||(T_=new Da({visibility:new Ma(Ua.layout_model.visibility),"model-id":new Oa(Ua.layout_model["model-id"])})),paint:I_||(I_=new Da({"model-opacity":new Oa(Ua.paint_model["model-opacity"]),"model-rotation":new Oa(Ua.paint_model["model-rotation"]),"model-scale":new Oa(Ua.paint_model["model-scale"]),"model-translation":new Oa(Ua.paint_model["model-translation"]),"model-color":new Oa(Ua.paint_model["model-color"]),"model-color-mix-intensity":new Oa(Ua.paint_model["model-color-mix-intensity"]),"model-type":new Ma(Ua.paint_model["model-type"]),"model-cast-shadows":new Ma(Ua.paint_model["model-cast-shadows"]),"model-receive-shadows":new Ma(Ua.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Ma(Ua.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Oa(Ua.paint_model["model-emissive-strength"]),"model-roughness":new Oa(Ua.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Oa(Ua.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Ma(Ua.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Ma(Ua.paint_model["model-front-cutoff"]),"model-elevation-reference":new Ma(Ua.paint_model["model-elevation-reference"]),"model-color-use-theme":new Oa({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this.layer=e,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new S_(e)}getProgramIds(){return["model"]}is3D(e){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof U_?Nn-1:0}queryRenderedFeatures(e,t,r){const n=t.getSource();if(!(n&&n instanceof V_))return{};const i=n,o={};o[this.id]=[];const a=o[this.id];let s=0;for(const l of i.models){const n=t.getFeatureState(this.sourceLayer,l.id),i={type:"Unknown",id:l.id,properties:l.featureProperties},o=this.paint.get("model-rotation").evaluate(i,n),c=this.paint.get("model-scale").evaluate(i,n),u=this.paint.get("model-translation").evaluate(i,n),h=this.paint.get("model-elevation-reference");let A=[];Jf(A,l,r,l.position,o,c,u,"ground"===h,"ground"===h,!1),"globe"===r.projection.name&&(A=qf(A,r));const f=d([],r.projMatrix,A),p=Zf(e.isPointQuery()?e.screenBounds:e.screenGeometry,r,f,l.aabb);if(null!=p){const e=new Q_(void 0,0,0,0,l.id);e.layer=this.layer,e.properties=structuredClone(l.featureProperties),e.properties.layer=this.id,e.properties.uri=l.uri,e.properties.orientation=l.orientation,e.sourceLayer=this.sourceLayer,e.geometry={type:"Point",coordinates:[l.position.lng,l.position.lat]},e.state=n,e.source=this.source,a.push({featureIndex:s,feature:e,intersectionZ:p})}++s}return o}queryIntersectsFeature(e,t,r,n,i,o){if(!this.modelManager)return!1;const a=this.modelManager,s=e.tile.getBucket(this);if(!(s&&s instanceof S_))return!1;for(const l in s.instancesPerModel){const r=s.instancesPerModel[l],n=void 0!==t.id?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(r.idToFeaturesIndex.hasOwnProperty(n)){const t=r.features[r.idToFeaturesIndex[n]],i=a.getModel(l,this.scope);if(!i)return!1;let c=[];const u=new ic(0,0),h=s.canonical;let A=Number.MAX_VALUE;for(let n=0;n<t.instancedDataCount;++n){const a=16*(t.instancedDataOffset+n),s=r.instancedDataArray.float32,l=[s[a+4],s[a+5],s[a+6]];H_(h,u,Math.floor(s[a]),Math.floor(s[a+1])),Jf(c,i,o,u,t.rotation,t.scale,l,!1,!1,!1),"globe"===o.projection.name&&(c=qf(c,o));const f=d([],o.projMatrix,c),p=e.queryGeometry,m=Zf(p.isPointQuery()?p.screenBounds:p.screenGeometry,o,f,i.aabb);null!=m&&(A=Math.min(m,A))}return A!==Number.MAX_VALUE&&A}}return!1}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof Go}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends as{constructor(e,t,r,n){super(e,{layout:bh||(bh=new Da({"clip-layer-types":new Ma(Ua.layout_clip["clip-layer-types"]),"clip-layer-scope":new Ma(Ua.layout_clip["clip-layer-scope"])})),paint:Bh||(Bh=new Da({}))},t,r,n)}recalculate(e,t){super.recalculate(e,t)}createBucket(e){return new Sh(e)}is3D(e){return!0}}},W_=new lr(0,0,0),q_={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Z_={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},X_={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Y_={PAINT_ORDER_FILL_AND_STROKE:1},J_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},$_={MASK_TYPE_LUMINANCE:1};function ev(e,t,r){1===e&&t.icons.push(function(e,t){return function(e){if(e.usvg_tree.height||(e.usvg_tree.height=e.usvg_tree.width),!e.metadata)return e;const{metadata:t}=e;if(t.content_area){const{content_area:r}=t;null==r.left&&(r.left=0),null==r.top&&(r.top=r.left),null==r.width&&(r.width=e.usvg_tree.width),null==r.height&&(r.height=r.width)}if(t.text_placeholder){const{text_placeholder:e}=t;null==e.top&&(e.top=e.left),null==e.height&&(e.height=e.width)}return t.stretch_x&&t.stretch_x.length&&tv(t,"x"),t.stretch_y&&t.stretch_y.length&&tv(t,"y"),e}(e.readFields(rv,{name:void 0},t))}(r,r.readVarint()+r.pos))}function tv(e,t){const r=[],n=e["stretch_".concat(t)];let i=null;for(let o=0;o<n.length;o++)null===i?i=0===r.length?n[0]:r[r.length-1][1]+n[o]:(r.push([i,i+n[o]]),i=null);e["stretch_".concat(t,"_areas")]=r}function rv(e,t,r){1===e?t.name=r.readString():2===e?t.metadata=function(e,t){return e.readFields(nv,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},t)}(r,r.readVarint()+r.pos):3===e&&(t.usvg_tree=function(e,t){return e.readFields(sv,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},t)}(r,r.readVarint()+r.pos),t.data="usvg_tree")}function nv(e,t,r){1===e?t.stretch_x=r.readPackedVarint():2===e?t.stretch_y=r.readPackedVarint():3===e?t.content_area=iv(r,r.readVarint()+r.pos):4===e?t.variables.push(function(e,t){return e.readFields(av,{name:void 0},t)}(r,r.readVarint()+r.pos)):5===e&&(t.text_placeholder=iv(r,r.readVarint()+r.pos))}function iv(e,t){return e.readFields(ov,{},t)}function ov(e,t,r){1===e?t.left=r.readVarint():2===e?t.width=r.readVarint():3===e?t.top=r.readVarint():4===e&&(t.height=r.readVarint())}function av(e,t,r){1===e?t.name=r.readString():2===e&&(t.rgb_color=pv(r.readVarint()),t.value="rgb_color")}function sv(e,t,r){1===e?t.width=t.height=r.readVarint():2===e?t.height=r.readVarint():3===e?t.children.push(lv(r,r.readVarint()+r.pos)):4===e?t.linear_gradients.push(function(e,t){return e.readFields(gv,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},t)}(r,r.readVarint()+r.pos)):5===e?t.radial_gradients.push(function(e,t){return e.readFields(vv,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},t)}(r,r.readVarint()+r.pos)):7===e?t.clip_paths.push(function(e,t){return e.readFields(xv,{children:[]},t)}(r,r.readVarint()+r.pos)):8===e&&t.masks.push(function(e,t){const r=e.readFields(wv,{left:0,width:20,mask_type:$_.MASK_TYPE_LUMINANCE,children:[]},t);return null==r.height&&(r.height=r.width),null==r.top&&(r.top=r.left),r}(r,r.readVarint()+r.pos))}function lv(e,t){return e.readFields(cv,{},t)}function cv(e,t,r){1===e?(t.group=function(e,t){return e.readFields(uv,{opacity:255,children:[]},t)}(r,r.readVarint()+r.pos),t.node="group"):2===e&&(t.path=function(e,t){return e.readFields(Av,{paint_order:1,commands:[],step:1,diffs:[],rule:q_.PATH_RULE_NON_ZERO},t)}(r,r.readVarint()+r.pos),t.node="path")}function uv(e,t,r){1===e?t.transform=dv(r,r.readVarint()+r.pos):2===e?t.opacity=r.readVarint():5===e?t.clip_path_idx=r.readVarint():6===e?t.mask_idx=r.readVarint():7===e&&t.children.push(lv(r,r.readVarint()+r.pos))}function dv(e,t){return e.readFields(hv,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function hv(e,t,r){1===e?t.sx=r.readFloat():2===e?t.ky=r.readFloat():3===e?t.kx=r.readFloat():4===e?t.sy=r.readFloat():5===e?t.tx=r.readFloat():6===e&&(t.ty=r.readFloat())}function Av(e,t,r){1===e?t.fill=function(e,t){return e.readFields(fv,{rgb_color:W_,paint:"rgb_color",opacity:255},t)}(r,r.readVarint()+r.pos):2===e?t.stroke=function(e,t){return e.readFields(mv,{rgb_color:W_,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},t)}(r,r.readVarint()+r.pos):3===e?t.paint_order=r.readVarint():5===e?r.readPackedVarint(t.commands):6===e?t.step=r.readFloat():7===e?r.readPackedSVarint(t.diffs):8===e&&(t.rule=r.readVarint())}function fv(e,t,r){1===e?(t.rgb_color=pv(r.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=r.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=r.readVarint(),t.paint="radial_gradient_idx"):5===e&&(t.opacity=r.readVarint())}function pv(e){return new lr((e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1)}function mv(e,t,r){1===e?(t.rgb_color=pv(r.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=r.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=r.readVarint(),t.paint="radial_gradient_idx"):5===e?r.readPackedFloat(t.dasharray):6===e?t.dashoffset=r.readFloat():7===e?t.miterlimit=r.readFloat():8===e?t.opacity=r.readVarint():9===e?t.width=r.readFloat():10===e?t.linecap=r.readVarint():11===e&&(t.linejoin=r.readVarint())}function gv(e,t,r){1===e?t.transform=dv(r,r.readVarint()+r.pos):2===e?t.spread_method=r.readVarint():3===e?t.stops.push(yv(r,r.readVarint()+r.pos)):4===e?t.x1=r.readFloat():5===e?t.y1=r.readFloat():6===e?t.x2=r.readFloat():7===e&&(t.y2=r.readFloat())}function yv(e,t){return e.readFields(_v,{offset:0,opacity:255,rgb_color:W_},t)}function _v(e,t,r){1===e?t.offset=r.readFloat():2===e?t.opacity=r.readVarint():3===e&&(t.rgb_color=pv(r.readVarint()))}function vv(e,t,r){1===e?t.transform=dv(r,r.readVarint()+r.pos):2===e?t.spread_method=r.readVarint():3===e?t.stops.push(yv(r,r.readVarint()+r.pos)):4===e?t.cx=r.readFloat():5===e?t.cy=r.readFloat():6===e?t.r=r.readFloat():7===e?t.fx=r.readFloat():8===e?t.fy=r.readFloat():9===e&&(t.fr=r.readFloat())}function xv(e,t,r){1===e?t.transform=dv(r,r.readVarint()+r.pos):2===e?t.clip_path_idx=r.readVarint():3===e&&t.children.push(lv(r,r.readVarint()+r.pos))}function wv(e,t,r){1===e?t.left=t.top=r.readFloat():2===e?t.width=t.height=r.readFloat():3===e?t.top=r.readFloat():4===e?t.height=r.readFloat():5===e?t.mask_type=r.readVarint():6===e?t.mask_idx=r.readVarint():7===e&&t.children.push(lv(r,r.readVarint()+r.pos))}class bv{static calculate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=new Map,n=new Map;if(0===Object.keys(e).length)return r;t.forEach(e=>{n.set(e.name,e.rgb_color||new lr(0,0,0))});for(const[i,o]of Object.entries(e))n.has(i)?r.set(n.get(i).toString(),o):console.warn('Ignoring unknown image variable "'.concat(i,'"'));return r}}function Bv(e){let t=arguments.length>2?arguments[2]:void 0;const r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:255)/255,n=e.toString(),i=t.has(n)?t.get(n).clone():e.clone();return i.a*=r,i.toString()}function Cv(e,t){if(!pt()){const r=document.createElement("canvas");return r.width=e,r.height=t,r}return new OffscreenCanvas(e,t)}let Ev,Sv=null;function Tv(e,t,r,n,i){for(const o of n.children)Iv(e,t,r,o,i)}function Iv(e,t,r,n,i){n.group?(e.save(),function(e,t,r,n,i){const o=null!=n.mask_idx?r.masks[n.mask_idx]:null,a=null!=n.clip_path_idx?r.clip_paths[n.clip_path_idx]:null;if(n.transform&&(t=Rv(n.transform).preMultiplySelf(t)),!function(e,t,r){return 255!==e.opacity||t||r}(n,null!=a,null!=o))return void Tv(e,t,r,n,i);const s=Cv(e.canvas.width,e.canvas.height),l=s.getContext("2d");Tv(l,t,r,n,i),a&&Dv(l,t,r,a),o&&Uv(l,t,r,o,i),e.globalAlpha=n.opacity/255,e.drawImage(s,0,0)}(e,t,r,n.group,i),e.restore()):n.path&&(e.save(),function(e,t,r,n,i){e.setTransform(t),n.paint_order===Y_.PAINT_ORDER_FILL_AND_STROKE?(Fv(e,r,n,i),Pv(e,r,n,i)):(Pv(e,r,n,i),Fv(e,r,n,i))}(e,t,r,n.path,i),e.restore())}function Fv(e,t,r,n){const i=r.fill;if(!i)return;const o=i.opacity/255;switch(e.save(),e.beginPath(),zv(r,e),i.paint){case"rgb_color":e.fillStyle=Bv(i.rgb_color,i.opacity,n);break;case"linear_gradient_idx":{const r=t.linear_gradients[i.linear_gradient_idx];r.transform&&e.setTransform(Rv(r.transform).preMultiplySelf(e.getTransform())),e.fillStyle=Mv(e,r,o,n);break}case"radial_gradient_idx":{const r=t.radial_gradients[i.radial_gradient_idx];r.transform&&e.setTransform(Rv(r.transform).preMultiplySelf(e.getTransform())),e.fillStyle=Ov(e,r,o,n)}}e.fill(kv(r)),e.restore()}function kv(e){return e.rule===q_.PATH_RULE_NON_ZERO?"nonzero":e.rule===q_.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Pv(e,t,r,n){const i=r.stroke;if(!i)return;const o=Nv(r);e.lineWidth=i.width,e.miterLimit=i.miterlimit,e.setLineDash(i.dasharray),e.lineDashOffset=i.dashoffset;const a=i.opacity/255;switch(i.paint){case"rgb_color":e.strokeStyle=Bv(i.rgb_color,i.opacity,n);break;case"linear_gradient_idx":e.strokeStyle=Mv(e,t.linear_gradients[i.linear_gradient_idx],a,n,!0);break;case"radial_gradient_idx":e.strokeStyle=Ov(e,t.radial_gradients[i.radial_gradient_idx],a,n,!0)}switch(i.linejoin){case X_.LINE_JOIN_MITER_CLIP:case X_.LINE_JOIN_MITER:e.lineJoin="miter";break;case X_.LINE_JOIN_ROUND:e.lineJoin="round";break;case X_.LINE_JOIN_BEVEL:e.lineJoin="bevel"}switch(i.linecap){case Z_.LINE_CAP_BUTT:e.lineCap="butt";break;case Z_.LINE_CAP_ROUND:e.lineCap="round";break;case Z_.LINE_CAP_SQUARE:e.lineCap="square"}e.stroke(o)}function Mv(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1===t.stops.length){const e=t.stops[0];return Bv(e.rgb_color,e.opacity*r,n)}const{x1:o,y1:a,x2:s,y2:l}=t;let c=new DOMPoint(o,a),u=new DOMPoint(s,l);if(i){const e=Rv(t.transform);c=e.transformPoint(c),u=e.transformPoint(u)}const d=e.createLinearGradient(c.x,c.y,u.x,u.y);for(const h of t.stops)d.addColorStop(h.offset,Bv(h.rgb_color,h.opacity*r,n));return d}function Ov(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1===t.stops.length){const e=t.stops[0];return Bv(e.rgb_color,e.opacity*r,n)}const o=Rv(t.transform),{fx:a,fy:s,fr:l,cx:c,cy:u,r:d}=t;let h=new DOMPoint(a,s),A=new DOMPoint(c,u),f=l,p=d;if(i){h=o.transformPoint(h),A=o.transformPoint(A);const e=(o.a+o.d)/2;f=l*e,p=t.r*e}const m=e.createRadialGradient(h.x,h.y,f,A.x,A.y,p);for(const g of t.stops)m.addColorStop(g.offset,Bv(g.rgb_color,g.opacity*r,n));return m}function Lv(e,t,r,n){const i=n.transform?Rv(n.transform).preMultiplySelf(t):t,o=Cv(e.canvas.width,e.canvas.height),a=o.getContext("2d");for(const l of n.children)if(l.group)Lv(a,i,r,l.group);else if(l.path){const e=l.path,t=new Path2D;t.addPath(Nv(e),i),a.fill(t,kv(e))}const s=null!=n.clip_path_idx?r.clip_paths[n.clip_path_idx]:null;s&&Dv(a,i,r,s),e.globalCompositeOperation="source-over",e.drawImage(o,0,0)}function Dv(e,t,r,n){const i=Cv(e.canvas.width,e.canvas.height);Lv(i.getContext("2d"),t,r,n),e.globalCompositeOperation="destination-in",e.drawImage(i,0,0)}function Uv(e,t,r,n,i){if(0===n.children.length)return;const o=null!=n.mask_idx?r.masks[n.mask_idx]:null;o&&Uv(e,t,r,o,i);const a=e.canvas.width,s=e.canvas.height,l=Cv(a,s),c=l.getContext("2d"),u=n.width,d=n.height,h=n.left,A=n.top,f=new Path2D,p=new Path2D;p.rect(h,A,u,d),f.addPath(p,t),c.clip(f);for(const y of n.children)Iv(c,t,r,y,i);const m=c.getImageData(0,0,a,s),g=m.data;if(n.mask_type===$_.MASK_TYPE_LUMINANCE)for(let y=0;y<g.length;y+=4)g[y+3]=g[y+3]/255*(.2126*g[y]+.7152*g[y+1]+.0722*g[y+2]);c.putImageData(m,0,0),e.globalCompositeOperation="destination-in",e.drawImage(l,0,0)}function Rv(e){return e?new DOMMatrix([e.sx,e.ky,e.kx,e.sy,e.tx,e.ty]):new DOMMatrix}function zv(e,t){const r=e.step;let n=e.diffs[0]*r,i=e.diffs[1]*r;t.moveTo(n,i);for(let o=0,a=2;o<e.commands.length;o++)switch(e.commands[o]){case J_.PATH_COMMAND_MOVE:n+=e.diffs[a++]*r,i+=e.diffs[a++]*r,t.moveTo(n,i);break;case J_.PATH_COMMAND_LINE:n+=e.diffs[a++]*r,i+=e.diffs[a++]*r,t.lineTo(n,i);break;case J_.PATH_COMMAND_QUAD:{const o=n+e.diffs[a++]*r,s=i+e.diffs[a++]*r;n=o+e.diffs[a++]*r,i=s+e.diffs[a++]*r,t.quadraticCurveTo(o,s,n,i);break}case J_.PATH_COMMAND_CUBIC:{const o=n+e.diffs[a++]*r,s=i+e.diffs[a++]*r,l=o+e.diffs[a++]*r,c=s+e.diffs[a++]*r;n=l+e.diffs[a++]*r,i=c+e.diffs[a++]*r,t.bezierCurveTo(o,s,l,c,n,i);break}case J_.PATH_COMMAND_CLOSE:t.closePath()}return t}function Nv(e){return zv(e,new Path2D)}class jv{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}put(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,t)}delete(e){this.cache.delete(e)}}ea(jv,"LRUCache");class Qv{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new bd(e,e.data)}getFromCache(e,t,r){return this.cacheMap.has(r)||this.cacheMap.set(r,new jv(150)),this.cacheMap.get(r).get(es(e.toString(),t))}setInCache(e,t,r,n){this.cacheDependenciesMap.has(n)||this.cacheDependenciesMap.set(n,new Map),this.cacheMap.has(n)||this.cacheMap.set(n,new jv(150));const i=this.cacheDependenciesMap.get(n),o=es(e.id.toString(),r);i.get(o)||i.set(o,new Set);const a=this.cacheMap.get(n),s=e.toString();i.get(o).add(s),a.put(es(e.toString(),r),t)}removeImagesFromCacheByIds(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.cacheMap.has(r)||!this.cacheDependenciesMap.has(r))return;const n=this.cacheMap.get(r),i=this.cacheDependenciesMap.get(r);for(const o of e){const e=es(o.toString(),t);if(i.has(e)){for(const t of i.get(e))n.delete(t);i.delete(e)}}}rasterize(e,t,r,n){const i=this.getFromCache(e,r,n);if(i)return i.clone();const o=function(e,t){const r=bv.calculate(t.params,e.metadata?e.metadata.variables:[]),n=e.usvg_tree,i=n.width,o=n.height,a=Math.max(1,Math.round(i*t.sx)),s=Math.max(1,Math.round(o*t.sy)),l=new DOMMatrix([a/i,0,0,s/o,0,0]);return null===Sv&&(Sv=Cv(10,10),Ev=Sv.getContext("2d",{willReadFrequently:!0})),Sv.width=a,Sv.height=s,Tv(Ev,l,n,n,r),Ev.getImageData(0,0,a,s)}(t.icon,e),a=Qv._getImage(o);return this.setInCache(e,a,r,n),a.clone()}}class Vv{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const r=this.toIdx(e,t);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Hv(e,t,r,n){let i=0,o=Number.MAX_VALUE;for(let a=0;a<3;a++)if(Math.abs(n[a])<1e-15){if(r[a]<e[a]||r[a]>t[a])return null}else{const s=1/n[a];let l=(e[a]-r[a])*s,c=(t[a]-r[a])*s;if(l>c){const e=l;l=c,c=e}if(l>i&&(i=l),c<o&&(o=c),i>o)return null}return i}function Gv(e,t,r,n,i,o,a,s,l,c,u){const d=n-e,h=i-t,A=o-r,f=a-e,p=s-t,m=l-r,g=u[1]*m-u[2]*p,y=u[2]*f-u[0]*m,_=u[0]*p-u[1]*f,v=d*g+h*y+A*_;if(Math.abs(v)<1e-15)return null;const x=1/v,w=c[0]-e,b=c[1]-t,B=c[2]-r,C=(w*g+b*y+B*_)*x;if(C<0||C>1)return null;const E=b*A-B*h,S=B*d-w*A,T=w*h-b*d,I=(u[0]*E+u[1]*S+u[2]*T)*x;return I<0||C+I>1?null:(f*E+p*S+m*T)*x}function Kv(e,t,r){return(e-t)/(r-t)}function Wv(e,t,r,n,i,o,a,s,l){const c=1<<r,u=o-n,d=a-i,h=(e+1)/c*u+n,A=(t+0)/c*d+i,f=(t+1)/c*d+i;s[0]=(e+0)/c*u+n,s[1]=A,l[0]=h,l[1]=f}class qv{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),r=[];let n=Math.ceil(Math.pow(2,t));const i=1/n,o=(e,t,r,n,i)=>{const o=n?1:0,a=(e+1)*r-o,s=t*r,l=(t+1)*r-o;i[0]=e*r,i[1]=s,i[2]=a,i[3]=l};let a=new Vv(n);const s=[];for(let l=0;l<n*n;l++){o(l%n,Math.floor(l/n),i,!1,s);const t=Xv(s[0],s[1],e),r=Xv(s[2],s[1],e),c=Xv(s[2],s[3],e),u=Xv(s[0],s[3],e);a.minimums.push(Math.min(t,r,c,u)),a.maximums.push(Math.max(t,r,c,u)),a.leaves.push(1)}for(r.push(a),n/=2;n>=1;n/=2){const e=r[r.length-1];a=new Vv(n);for(let t=0;t<n*n;t++){o(t%n,Math.floor(t/n),2,!0,s);const r=e.getElevation(s[0],s[1]),i=e.getElevation(s[2],s[1]),l=e.getElevation(s[2],s[3]),c=e.getElevation(s[0],s[3]),u=e.isLeaf(s[0],s[1]),d=e.isLeaf(s[2],s[1]),h=e.isLeaf(s[2],s[3]),A=e.isLeaf(s[0],s[3]),f=Math.min(r.min,i.min,l.min,c.min),p=Math.max(r.max,i.max,l.max,c.max),m=u&&d&&h&&A;a.maximums.push(p),a.minimums.push(f),a.leaves.push(p-f<=5&&m?1:0)}r.push(a)}return r}(this.dem),r=t.length-1,n=t[r];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(t,0,0,r,0)}raycastRoot(e,t,r,n,i,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Hv([e,t,-100],[r,n,this.maximums[0]*a],i,o)}raycast(e,t,r,n,i,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const s=this.raycastRoot(e,t,r,n,i,o,a);if(null==s)return null;const l=[],c=[],u=[],d=[],h=[{idx:0,t:s,nodex:0,nodey:0,depth:0}];for(;h.length>0;){const{idx:s,t:A,nodex:f,nodey:p,depth:m}=h.pop();if(this.leaves[s]){Wv(f,p,m,e,t,r,n,u,d);const s=1<<m,l=(f+0)/s,c=(f+1)/s,h=(p+0)/s,g=(p+1)/s,y=Xv(l,h,this.dem)*a,_=Xv(c,h,this.dem)*a,v=Xv(c,g,this.dem)*a,x=Xv(l,g,this.dem)*a,w=Gv(u[0],u[1],y,d[0],u[1],_,d[0],d[1],v,i,o),b=Gv(d[0],d[1],v,u[0],d[1],x,u[0],u[1],y,i,o),B=Math.min(null!==w?w:Number.MAX_VALUE,null!==b?b:Number.MAX_VALUE);if(B!==Number.MAX_VALUE)return B;{const e=M([],i,o,A);if(Zv(y,_,x,v,Kv(e[0],u[0],d[0]),Kv(e[1],u[1],d[1]))>=e[2])return A}continue}let g=0;for(let h=0;h<this._siblingOffset.length;h++){Wv((f<<1)+this._siblingOffset[h][0],(p<<1)+this._siblingOffset[h][1],m+1,e,t,r,n,u,d),u[2]=-100,d[2]=this.maximums[this.childOffsets[s]+h]*a;const A=Hv(u,d,i,o);if(null!=A){const e=A;l[h]=e;let t=!1;for(let r=0;r<g&&!t;r++)e>=l[c[r]]&&(c.splice(r,0,h),t=!0);t||(c[g]=h),g++}}for(let e=0;e<g;e++){const t=c[e];h.push({idx:this.childOffsets[s]+t,t:l[t],nodex:(f<<1)+this._siblingOffset[t][0],nodey:(p<<1)+this._siblingOffset[t][1],depth:m+1})}}return null}_addNode(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,r,n,i){if(1===e[n].isLeaf(t,r))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const o=n-1,a=e[o];let s=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],n=2*r+this._siblingOffset[c][1],i=a.getElevation(e,n),o=a.isLeaf(e,n),u=this._addNode(i.min,i.max,o);o&&(s|=1<<c),l||(l=u)}for(let c=0;c<this._siblingOffset.length;c++)s&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*r+this._siblingOffset[c][1],o,l+c)}}function Zv(e,t,r,n,i,o){return hr(hr(e,r,o),hr(t,n,o),i)}function Xv(e,t,r){const n=r.dim,i=Oe(e*n-.5,0,n-1),o=Oe(t*n-.5,0,n-1),a=Math.floor(i),s=Math.floor(o),l=Math.min(a+1,n-1),c=Math.min(s+1,n-1);return Zv(r.get(a,s),r.get(l,s),r.get(a,c),r.get(l,c),i-a,o-s)}const Yv={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Jv(e,t,r){return(256*e*256+256*t+r)/10-1e4}function $v(e,t,r){return 256*e+t+r/256-32768}class ex{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return void We('"'.concat(r,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=t.height;const i=this.dim=t.height-2,o=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=n,this._modifiedForSources={},!n){for(let e=0;e<i;e++)o[this._idx(-1,e)]=o[this._idx(0,e)],o[this._idx(i,e)]=o[this._idx(i-1,e)],o[this._idx(e,-1)]=o[this._idx(e,0)],o[this._idx(e,i)]=o[this._idx(e,i-1)];o[this._idx(-1,-1)]=o[this._idx(0,0)],o[this._idx(i,-1)]=o[this._idx(i-1,0)],o[this._idx(-1,i)]=o[this._idx(0,i-1)],o[this._idx(i,i)]=o[this._idx(i-1,i-1)]}const a="terrarium"===r?$v:Jv;for(let s=0;s<o.length;++s){const e=4*s;this.floatView[s]=a(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=mt.now()}_buildQuadTree(){this._tree=new qv(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=Oe(e,-1,this.dim),t=Oe(t,-1,this.dim));const r=this._idx(e,t);return this.floatView[r]}set(e,t,r){const n=this._idx(e,t),i=this.floatView[n];return this.floatView[n]=r,r-i}static getUnpackVector(e){return Yv[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const r=[0,0,0,0],n=ex.getUnpackVector(t);let i=Math.floor((e+n[3])/n[2]);return r[2]=i%256,i=Math.floor(i/256),r[1]=i%256,i=Math.floor(i/256),r[0]=i,r}getPixels(){return new Bd({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=t*this.dim,i=t*this.dim+this.dim,o=r*this.dim,a=r*this.dim+this.dim;switch(t){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:o=a-1;break;case 1:a=o+1}const s=-t*this.dim,l=-r*this.dim;for(let c=o;c<a;c++)for(let t=n;t<i;t++){const r=4*this._idx(t,c),n=4*this._idx(t+s,c+l);this.pixels[r+0]=e.pixels[n+0],this.pixels[r+1]=e.pixels[n+1],this.pixels[r+2]=e.pixels[n+2],this.pixels[r+3]=e.pixels[n+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function tx(e,t,r){1===e?t.headerLength=r.readFixed32():2===e?t.x=r.readVarint():3===e?t.y=r.readVarint():4===e?t.z=r.readVarint():5===e&&t.layers.push(function(e,t){return e.readFields(ax,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},t)}(r,r.readVarint()+r.pos))}function rx(e,t,r){1===e?(t.delta_filter=function(e,t){return e.readFields(nx,{blockSize:0},t)}(r,r.readVarint()+r.pos),t.filter="delta_filter"):2===e?(r.readVarint(),t.filter="zigzag_filter"):3===e?(r.readVarint(),t.filter="bitshuffle_filter"):4===e&&(r.readVarint(),t.filter="byteshuffle_filter")}function nx(e,t,r){1===e&&(t.blockSize=r.readVarint())}function ix(e,t,r){1===e?(r.readVarint(),t.codec="gzip_data"):2===e?(r.readVarint(),t.codec="jpeg_image"):3===e?(r.readVarint(),t.codec="webp_image"):4===e&&(r.readVarint(),t.codec="png_image")}function ox(e,t,r){let n=0,i=0;1===e?t.firstByte=r.readFixed64():2===e?t.lastByte=r.readFixed64():3===e?t.filters.push(function(e,t){return e.readFields(rx,{},t)}(r,r.readVarint()+r.pos)):4===e?t.codec=function(e,t){return e.readFields(ix,{},t)}(r,r.readVarint()+r.pos):5===e?i=r.readFloat():6===e?n=r.readFloat():7===e?t.bands.push(r.readString()):8===e?t.offset=r.readDouble():9===e&&(t.scale=r.readDouble()),0===t.offset&&(t.offset=i),0===t.scale&&(t.scale=n)}function ax(e,t,r){1===e?t.version=r.readVarint():2===e?t.name=r.readString():3===e?t.units=r.readString():4===e?t.tileSize=r.readVarint():5===e?t.buffer=r.readVarint():6===e?t.pixelFormat=r.readVarint():7===e&&t.dataIndex.push(function(e,t){return e.readFields(ox,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)}(r,r.readVarint()+r.pos))}function sx(e,t,r){if(2===e)!function(e,t,r){e.readFields(lx,r,t)}(r,r.readVarint()+r.pos,t);else if(3===e)throw new Error("Not implemented")}function lx(e,t,r){if(1===e){let e=0;const n=r.readVarint()+r.pos;for(;r.pos<n;)t[e++]=r.readVarint()}}function cx(e,t){if(4!==t.length)throw new Error("Expected data of dimension 4 but got ".concat(t.length,"."));let r=t[3];for(let n=2;n>=1;n--){const i=1===n?1:0,o=2===n?1:0;for(let n=0;n<t[0];n++){const a=t[1]*n;for(let n=i;n<t[1];n++){const i=t[2]*(n+a);for(let n=o;n<t[2];n++){const o=t[3]*(n+i);for(let n=0;n<t[3];n++){const t=o+n;e[t]+=e[t-r]}}}}r*=t[n]}return e}function ux(e){for(let t=0,r=e.length;t<r;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function dx(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const r=e[t],n=e[t+1];e[t]=(240&r)>>4|(61440&r)>>8|(240&n)<<4|61440&n,e[t+1]=15&r|(3840&r)>>4|(15&n)<<8|(3840&n)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const r=e[t],n=e[t+1],i=e[t+2],o=e[t+3];e[t+0]=(192&r)>>6|(192&n)>>4|(192&i)>>2|192&o,e[t+1]=(48&r)>>4|(48&n)>>2|48&i|(48&o)<<2,e[t+2]=(12&r)>>2|12&n|(12&i)<<2|(12&o)<<4,e[t+3]=3&r|(3&n)<<2|(3&i)<<4|(3&o)<<6}return e;default:throw new Error('Invalid pixel format, "'.concat(t,'"'))}}ea(ex,"DEMData"),ea(qv,"DemMinMaxQuadTree",{omit:["dem"]});var hx=Uint8Array,Ax=Uint16Array,fx=Int32Array,px=new hx([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mx=new hx([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gx=new hx([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),yx=function(e,t){for(var r=new Ax(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var i=new fx(r[30]);for(n=1;n<30;++n)for(var o=r[n];o<r[n+1];++o)i[o]=o-r[n]<<5|n;return{b:r,r:i}},_x=yx(px,2),vx=_x.b,xx=_x.r;vx[28]=258,xx[258]=28;for(var wx=yx(mx,0).b,bx=new Ax(32768),Bx=0;Bx<32768;++Bx){var Cx=(43690&Bx)>>1|(21845&Bx)<<1;bx[Bx]=((65280&(Cx=(61680&(Cx=(52428&Cx)>>2|(13107&Cx)<<2))>>4|(3855&Cx)<<4))>>8|(255&Cx)<<8)>>1}var Ex=function(e,t,r){for(var n=e.length,i=0,o=new Ax(t);i<n;++i)e[i]&&++o[e[i]-1];var a,s=new Ax(t);for(i=1;i<t;++i)s[i]=s[i-1]+o[i-1]<<1;a=new Ax(1<<t);var l=15-t;for(i=0;i<n;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],d=s[e[i]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)a[bx[d]>>l]=c;return a},Sx=new hx(288);for(Bx=0;Bx<144;++Bx)Sx[Bx]=8;for(Bx=144;Bx<256;++Bx)Sx[Bx]=9;for(Bx=256;Bx<280;++Bx)Sx[Bx]=7;for(Bx=280;Bx<288;++Bx)Sx[Bx]=8;var Tx=new hx(32);for(Bx=0;Bx<32;++Bx)Tx[Bx]=5;var Ix=Ex(Sx,9),Fx=Ex(Tx,5),kx=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Px=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},Mx=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},Ox=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Lx=function(e,t,r){var n=new Error(t||Ox[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,Lx),!r)throw n;return n},Dx=new hx(0),Ux="undefined"!=typeof TextDecoder&&new TextDecoder;try{Ux.decode(Dx,{stream:!0})}catch(e){}const Rx={gzip_data:"gzip"};class zx extends Error{constructor(e){super(e),this.name="MRTError"}}const Nx={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},jx={uint32:1,uint16:2,uint8:4},Qx={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Vx;class Hx{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const t=this.layers[e];if(!t)throw new zx("Layer '".concat(e,"' not found"));return t}getHeaderLength(e){const t=new Uint8Array(e),r=new DataView(e);if(13!==t[0])throw new zx("File is not a valid MRT.");return r.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),r=this.getHeaderLength(e);if(t.length<r)throw new zx("Expected header with length >= ".concat(r," but got buffer of length ").concat(t.length));const n=new Vx(t.subarray(0,r)).readFields(tx,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==n.x||this.y!==n.y||this.z!==n.z))throw new zx("Invalid attempt to parse header ".concat(n.z,"/").concat(n.x,"/").concat(n.y," for tile ").concat(this.z,"/").concat(this.x,"/").concat(this.y));this.x=n.x,this.y=n.y,this.z=n.z;for(const i of n.layers)this.layers[i.name]=new Gx(i,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],r=this.getLayer(e.layerName);for(let n of e.blockIndices){const i=r.dataIndex[n],o=i.firstByte-e.firstByte,a=i.lastByte-e.firstByte;if(r._blocksInProgress.has(n))continue;const s={layerName:r.name,firstByte:o,lastByte:a,pixelFormat:r.pixelFormat,blockIndex:n,blockShape:[i.bands.length].concat(r.bandShape),buffer:r.buffer,codec:i.codec.codec,filters:i.filters.map(e=>e.filter)};r._blocksInProgress.add(n),t.push(s)}return new Kx(t,()=>{t.forEach(e=>r._blocksInProgress.delete(e.blockIndex))},(e,n)=>{if(t.forEach(e=>r._blocksInProgress.delete(e.blockIndex)),e)throw e;n.forEach(e=>{this.getLayer(e.layerName).processDecodedData(e)})})}}class Gx{constructor(e,t){let{version:r,name:n,units:i,tileSize:o,pixelFormat:a,buffer:s,dataIndex:l}=e;if(this.version=r,1!==this.version)throw new zx("Cannot parse raster layer encoded with MRT version ".concat(r));this.name=n,this.units=i,this.tileSize=o,this.buffer=s,this.pixelFormat=Nx[a],this.dataIndex=l,this.bandShape=[o+2*s,o+2*s,jx[this.pixelFormat]],this._decodedBlocks=new jv(t?t.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return jx[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(e=>{let{bands:t}=e;return t}).flat()}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.put(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[r,n]of this.dataIndex.entries()){for(const[i,o]of n.bands.entries())if(o===e)return{bandIndex:t+i,blockIndex:r,blockBandIndex:i};t+=n.bands.length}break;case"number":for(const[r,n]of this.dataIndex.entries()){if(e>=t&&e<t+n.bands.length)return{bandIndex:e,blockIndex:r,blockBandIndex:e-t};t+=n.bands.length}break;default:throw new zx("Invalid band `".concat(JSON.stringify(e),"`. Expected string or integer."))}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let t=1/0,r=-1/0;const n=[],i=new Set;for(const o of e){const{blockIndex:e}=this.getBlockForBand(o);if(e<0)throw new zx("Invalid band: ".concat(JSON.stringify(o)));const a=this.dataIndex[e];n.includes(e)||n.push(e),i.add(e),t=Math.min(t,a.firstByte),r=Math.max(r,a.lastByte)}if(i.size>this.cacheSize)throw new zx("Number of blocks to decode (".concat(i.size,") exceeds cache size (").concat(this.cacheSize,")."));return{layerName:this.name,firstByte:t,lastByte:r,blockIndices:n}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:r}=this.getBlockForBand(e);if(t<0)throw new zx("Band not found: ".concat(JSON.stringify(e)));const n=this._decodedBlocks.get(t.toString());if(!n)throw new zx("Data for band ".concat(JSON.stringify(e),' of layer "').concat(this.name,'" not decoded.'));const i=this.dataIndex[t],o=this.bandShape.reduce((e,t)=>e*t,1),a=r*o,s=n.subarray(a,a+o);return{data:s,bytes:new Uint8Array(s.buffer).subarray(s.byteOffset,s.byteOffset+s.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:i.offset,scale:i.scale}}}Hx.setPbf=function(e){Vx=e};class Kx{constructor(e,t,r){this.tasks=e,this._onCancel=t,this._onComplete=r,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}Hx.performDecoding=function(e,t){const r=new Uint8Array(e);return Promise.all(t.tasks.map(e=>{const{layerName:t,firstByte:n,lastByte:i,pixelFormat:o,blockShape:a,blockIndex:s,filters:l,codec:c}=e,u=r.subarray(n,i+1),d=new Uint32Array(a[0]*a[1]*a[2]);let h;if("gzip_data"!==c)throw new zx("Unhandled codec: ".concat(c));return h=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((o=function(e){31==e[0]&&139==e[1]&&8==e[2]||Lx(6,"invalid gzip data");var t=e[3],r=10;4&t&&(r+=2+(e[10]|e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(2&t)}(i=e))+8>i.length&&Lx(6,"invalid gzip data"),function(e,t,r){var n=e.length;if(!n||t.f&&!t.l)return r||new hx(0);var i=!r,o=i||2!=t.i,a=t.i;i&&(r=new hx(3*n));var s,l,c=function(e){var t=r.length;if(e>t){var n=new hx(Math.max(2*t,e));n.set(r),r=n}},u=t.f||0,d=t.p||0,h=t.b||0,A=t.l,f=t.d,p=t.m,m=t.n,g=8*n;do{if(!A){u=Px(e,d,1);var y=Px(e,d+1,3);if(d+=3,!y){var _=e[(F=4+((d+7)/8|0))-4]|e[F-3]<<8,v=F+_;if(v>n){a&&Lx(0);break}o&&c(h+_),r.set(e.subarray(F,v),h),t.b=h+=_,t.p=d=8*v,t.f=u;continue}if(1==y)A=Ix,f=Fx,p=9,m=5;else if(2==y){var x=Px(e,d,31)+257,w=Px(e,d+10,15)+4,b=x+Px(e,d+5,31)+1;d+=14;for(var B=new hx(b),C=new hx(19),E=0;E<w;++E)C[gx[E]]=Px(e,d+3*E,7);d+=3*w;var S=kx(C),T=(1<<S)-1,I=Ex(C,S);for(E=0;E<b;){var F,k=I[Px(e,d,T)];if(d+=15&k,(F=k>>4)<16)B[E++]=F;else{var P=0,M=0;for(16==F?(M=3+Px(e,d,3),d+=2,P=B[E-1]):17==F?(M=3+Px(e,d,7),d+=3):18==F&&(M=11+Px(e,d,127),d+=7);M--;)B[E++]=P}}var O=B.subarray(0,x),L=B.subarray(x);p=kx(O),m=kx(L),A=Ex(O,p),f=Ex(L,m)}else Lx(1);if(d>g){a&&Lx(0);break}}o&&c(h+131072);for(var D=(1<<p)-1,U=(1<<m)-1,R=d;;R=d){var z=(P=A[Mx(e,d)&D])>>4;if((d+=15&P)>g){a&&Lx(0);break}if(P||Lx(2),z<256)r[h++]=z;else{if(256==z){R=d,A=null;break}var N=z-254;z>264&&(N=Px(e,d,(1<<(V=px[E=z-257]))-1)+vx[E],d+=V);var j=f[Mx(e,d)&U],Q=j>>4;if(j||Lx(3),d+=15&j,L=wx[Q],Q>3){var V=mx[Q];L+=Mx(e,d)&(1<<V)-1,d+=V}if(d>g){a&&Lx(0);break}o&&c(h+131072);var H=h+N;if(h<L){var G=0-L,K=Math.min(L,H);for(G+h<0&&Lx(3);h<K;++h)r[h]=(void 0)[G+h]}for(;h<H;++h)r[h]=r[h-L]}}t.l=A,t.p=R,t.b=h,t.f=u,A&&(u=1,t.m=p,t.d=f,t.n=m)}while(!u);return h!=r.length&&i?(s=r,(null==(l=h)||l>s.length)&&(l=s.length),new hx(s.subarray(0,l))):r.subarray(0,h)}(i.subarray(o,-8),{i:2},new hx(((r=i)[(n=r.length)-4]|r[n-3]<<8|r[n-2]<<16|r[n-1]<<24)>>>0))));var r,n,i,o;const a=Rx[t];if(!a)throw new Error("Unhandled codec: ".concat(t));const s=new globalThis.DecompressionStream(a);return new Response(new Blob([e]).stream().pipeThrough(s)).arrayBuffer().then(e=>new Uint8Array(e))}(u,c).then(e=>(function(e,t){e.readFields(sx,t)}(new Vx(e),d),new(0,Qx[o])(d.buffer))),h.then(e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":cx(e,a);break;case"zigzag_filter":ux(e);break;case"bitshuffle_filter":dx(e,o);break;default:throw new zx('Unhandled filter "'.concat(l[t],'"'))}return{layerName:t,blockIndex:s,data:e}}).catch(e=>{throw e})}))},ea(Kx,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),ea(Hx,"MapboxRasterTile"),ea(Gx,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Wx{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class qx{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Jo(Nn,16,0),this.featureIndexArray=new il,this.promoteId=t,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i,o);const l=this.grid;for(let c=0;c<t.length;c++){const e=t[c],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const n=e[t];r[0]=Math.min(r[0],n.x),r[1]=Math.min(r[1],n.y),r[2]=Math.max(r[2],n.x),r[3]=Math.max(r[3],n.y)}0!==a&&(r[0]-=a,r[1]-=a,r[2]+=a,r[3]+=a),r[0]<Nn&&r[1]<Nn&&r[2]>=0&&r[3]>=0&&l.insert(s,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Lc(new Em(this.rawTileData)).layers,this.sourceLayerCoder=new Wx(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t){var r=this;const{tilespaceGeometry:n,transform:i,tileTransform:o,pixelPosMatrix:a,availableImages:s,worldview:l}=t;this.loadVTLayers(),this.serializedLayersCache.clear();const c=t.queryRadius?t.queryRadius:0,u=n.bufferedTilespaceBounds,d=this.grid.query(u.min.x,u.min.y,u.max.x,u.max.y,(e,t,r,i)=>mu(n.bufferedTilespaceGeometry,e-c,t-c,r+c,i+c));d.sort(Xx);let h=null;i.elevation&&d.length>0&&(h=F_.create(i.elevation,this.tileID));const A={};let f;for(let p=0;p<d.length;p++){const t=d[p];if(t===f)continue;f=t;const c=this.featureIndexArray.get(t);let u=null;this.is3DTile?this.loadMatchingModelFeature(A,c,e,n,i,l):this.loadMatchingFeature(A,c,e,s,l,function(e,t,s){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return u||(u=Tc(e,r.tileID.canonical,o)),t.queryIntersectsFeature(n,e,s,u,r.z,i,a,h,l)})}return A}loadMatchingFeature(e,t,r,n,i,o){const{featureIndex:a,bucketIndex:s,sourceLayerIndex:l,layoutVertexArrayOffset:c}=t,u=this.bucketLayerIDs[s],d=r.layers,h=Object.keys(d);if(h.length&&!Ge(h,u))return;const A=r.sourceCache,f=this.sourceLayerCoder.decode(l),p=this.vtLayers[f].feature(a),m=this.getId(p,f);for(let g=0;g<u.length;g++){const t=u[g];if(!d[t])continue;const{styleLayer:r,targets:s}=d[t];let l={};void 0!==m&&(l=A.getFeatureState(r.sourceLayer,m));const h=!o||o(p,r,l,c);if(!h)continue;const f=new Q_(p,this.z,this.x,this.y,m);f.tile=this.tileID.canonical,f.state=l;let y=this.serializedLayersCache.get(t);y||(y=r.serialize(),y.id=t,this.serializedLayersCache.set(t,y)),f.source=y.source,f.sourceLayer=y["source-layer"],f.layer=Object.assign({},y),f.layer.paint=Zx(y.paint,r.paint,p,l,n),f.layer.layout=Zx(y.layout,r.layout,p,l,n);let _=!1;for(const e of s){this.updateFeatureProperties(f,e);const{filter:t}=e;if(t)if(p.properties=f.properties,t.needGeometry){const e=Ic(p,!0);if(!t.filter(new Ba(this.tileID.overscaledZ,{worldview:i}),e,this.tileID.canonical))continue}else if(!t.filter(new Ba(this.tileID.overscaledZ,{worldview:i}),p))continue;_=!0,e.targetId&&this.addFeatureVariant(f,e)}_&&this.appendToResult(e,t,a,f,h)}}loadMatchingModelFeature(e,t,r,n,i,o){const{featureIndex:a,bucketIndex:s}=t,l=this.bucketLayerIDs[s],c=r.layers,u=Object.keys(c);if(!u.length||Ge(u,l))for(let d=0;d<l.length;d++){const t=l[d],{styleLayer:s,targets:u}=c[t];if("model"!==s.type)continue;const h=n.tile,A=h.getBucket(s);if(!(A&&A instanceof U_))continue;const f=G_(A,a,n,i);if(!f)continue;const{z:p,x:m,y:g}=h.tileID.canonical,{feature:y,intersectionZ:_,position:v}=f;let x={};void 0!==y.id&&(x=r.sourceCache.getFeatureState(s.sourceLayer,y.id));const w=new Q_({},p,m,g,y.id);w.tile=this.tileID.canonical,w.state=x,w.properties=y.properties,w.geometry={type:"Point",coordinates:[v.lng,v.lat]};let b=this.serializedLayersCache.get(t);b||(b=s.serialize(),b.id=t,this.serializedLayersCache.set(t,b)),w.source=b.source,w.sourceLayer=b["source-layer"],w.layer=Object.assign({},b);let B=!1;for(const e of u){this.updateFeatureProperties(w,e);const{filter:t}=e;if(t)if(y.properties=w.properties,t.needGeometry){if(!t.filter(new Ba(this.tileID.overscaledZ,{worldview:o}),y,this.tileID.canonical))continue}else if(!t.filter(new Ba(this.tileID.overscaledZ,{worldview:o}),y))continue;B=!0,e.targetId&&this.addFeatureVariant(w,e)}B&&this.appendToResult(e,t,a,w,_)}}updateFeatureProperties(e,t,r){if(t.properties){const n={};for(const i in t.properties){const o=t.properties[i].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,r);null!=o&&(n[i]=o)}e.properties=n}}addFeatureVariant(e,t,r){const n={target:t.target,namespace:t.namespace,uniqueFeatureID:t.uniqueFeatureID};t.properties&&(n.properties=e.properties),e.variants=e.variants||{},e.variants[t.targetId]=e.variants[t.targetId]||[],e.variants[t.targetId].push(n)}appendToResult(e,t,r,n,i){let o=e[t];void 0===o&&(o=e[t]=[]),o.push({featureIndex:r,feature:n,intersectionZ:i})}lookupSymbolFeatures(e,t,r,n,i,o){const a={};this.loadVTLayers();for(const s of e)this.loadMatchingFeature(a,{bucketIndex:t,sourceLayerIndex:r,featureIndex:s,layoutVertexArrayOffset:0},n,i,o);return a}loadFeature(e){const{featureIndex:t,sourceLayerIndex:r}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(r),i=this.vtFeatures[n];if(i[t])return i[t];const o=this.vtLayers[n].feature(t);return i[t]=o,o}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;if(this.promoteId){const n=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[t];if(null!=n)if(Array.isArray(n)){if(!this.promoteIdExpression){const e=Vo(n);if("success"!==e.result){const t=e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", ");return void We("Failed to create expression for promoteId: ".concat(t))}this.promoteIdExpression=e.value}r=this.promoteIdExpression.evaluate({zoom:0},e)}else r=e.properties[n];"boolean"==typeof r&&(r=Number(r))}return r}}function Zx(e,t,r,n,i){return Qe(e,(e,o)=>{const a=t instanceof Pa?t.get(o):null;return a&&a.evaluate?a.evaluate(r,n,void 0,i):a})}function Xx(e,t){return t-e}ea(qx,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Yx=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Jx{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const n=r>>4;if(1!==n)throw new Error("Got v".concat(n," data when expected v1."));const i=Yx[15&r];if(!i)throw new Error("Unrecognized array type.");const[o]=new Uint16Array(e,2,1),[a]=new Uint32Array(e,4,1);return new Jx(a,o,i,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,n=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const i=Yx.indexOf(this.ArrayType),o=2*e*this.ArrayType.BYTES_PER_ELEMENT,a=e*this.IndexArrayType.BYTES_PER_ELEMENT,s=(8-a%8)%8;if(i<0)throw new Error("Unexpected typed array class: ".concat(r,"."));n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+s,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+o+a+s),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+a+s,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return $x(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:o,nodeSize:a}=this,s=[0,i.length-1,0],l=[];for(;s.length;){const c=s.pop()||0,u=s.pop()||0,d=s.pop()||0;if(u-d<=a){for(let a=d;a<=u;a++){const s=o[2*a],c=o[2*a+1];s>=e&&s<=r&&c>=t&&c<=n&&l.push(i[a])}continue}const h=d+u>>1,A=o[2*h],f=o[2*h+1];A>=e&&A<=r&&f>=t&&f<=n&&l.push(i[h]),(0===c?e<=A:t<=f)&&(s.push(d),s.push(h-1),s.push(1-c)),(0===c?r>=A:n>=f)&&(s.push(h+1),s.push(u),s.push(1-c))}return l}within(e,t,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:i,nodeSize:o}=this,a=[0,n.length-1,0],s=[],l=r*r;for(;a.length;){const c=a.pop()||0,u=a.pop()||0,d=a.pop()||0;if(u-d<=o){for(let r=d;r<=u;r++)nw(i[2*r],i[2*r+1],e,t)<=l&&s.push(n[r]);continue}const h=d+u>>1,A=i[2*h],f=i[2*h+1];nw(A,f,e,t)<=l&&s.push(n[h]),(0===c?e-r<=A:t-r<=f)&&(a.push(d),a.push(h-1),a.push(1-c)),(0===c?e+r>=A:t+r>=f)&&(a.push(h+1),a.push(u),a.push(1-c))}return s}}function $x(e,t,r,n,i,o){if(i-n<=r)return;const a=n+i>>1;ew(e,t,a,n,i,o),$x(e,t,r,n,a-1,1-o),$x(e,t,r,a+1,i,1-o)}function ew(e,t,r,n,i,o){for(;i>n;){if(i-n>600){const a=i-n+1,s=r-n+1,l=Math.log(a),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(a-c)/a)*(s-a/2<0?-1:1);ew(e,t,r,Math.max(n,Math.floor(r-s*c/a+u)),Math.min(i,Math.floor(r+(a-s)*c/a+u)),o)}const a=t[2*r+o];let s=n,l=i;for(tw(e,t,n,r),t[2*i+o]>a&&tw(e,t,n,i);s<l;){for(tw(e,t,s,l),s++,l--;t[2*s+o]<a;)s++;for(;t[2*l+o]>a;)l--}t[2*n+o]===a?tw(e,t,n,l):(l++,tw(e,t,l,i)),l<=r&&(n=l+1),r<=l&&(i=l-1)}}function tw(e,t,r,n){rw(e,r,n),rw(t,2*r,2*n),rw(t,2*r+1,2*n+1)}function rw(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function nw(e,t,r,n){const i=e-r,o=t-n;return i*i+o*o}e.$=$r,e.A=Ur,e.B=es,e.C=2,e.D=qA,e.E=nr,e.F=wg,e.G=vg,e.H=Xr,e.I=ir,e.J=Ra,e.K=Zr,e.L=Jr,e.M=Po,e.N=Io,e.O=ko,e.P=Be,e.Q=Qo,e.R=Lt,e.S=za,e.T=kf,e.U=Vo,e.V=b_,e.W=Ko,e.X=_i,e.Y=gi,e.Z=yi,e._=on,e.a=function(e){return at.API_CDN_URL_REGEX.test(e)},e.a$=Ac,e.a0=Yr,e.a1=sr,e.a2=Na,e.a3=class extends b_{},e.a4=Mo,e.a5=Fo,e.a6=Ua,e.a7=function(e){const t=e.value;return t?Yr(t)?B_(t,!0)?[]:[new b_(e.key,t,'invalid url "'.concat(t,'"'))]:[new b_(e.key,t,'string expected, "'.concat(Zr(t),'" found'))]:[]},e.a8=Sa,e.a9=Da,e.aA=Oe,e.aB=d,e.aC=$,e.aD=Kl,e.aE=pu,e.aF=cc,e.aG=wc,e.aH=function(e,t){const r={};for(let n=0;n<t.length;n++){const i=t[n];i in e&&(r[i]=e[i])}return r},e.aI=oc,e.aJ=uc,e.aK=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,r,n){const i=this.entries[e]=this.entries[e]||{callbacks:[]};if(i.result){const[e,r]=i.result;return this.scheduler?this.scheduler.add(()=>{n(e,r)},t):n(e,r),()=>{}}return i.callbacks.push(n),i.cancel||(i.cancel=r((r,n)=>{i.result=[r,n];for(const e of i.callbacks)this.scheduler?this.scheduler.add(()=>{e(r,n)},t):e(r,n);setTimeout(()=>delete this.entries[e],3e3)})),()=>{i.result||(i.callbacks=i.callbacks.filter(e=>e!==n),i.callbacks.length||(i.cancel(),delete this.entries[e]))}}},e.aL=function(e,t,r){const n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},t=>{const n=zt(e.request,(e,n,i)=>{e?t(e):n&&t(null,{rawData:n,vectorTile:r?void 0:new Lc(new Em(n)),responseHeaders:new Map(i.entries())})});return()=>{n.cancel(),t()}},t)},e.aM=function(e){return e?{cacheControl:e.get("Cache-Control"),expires:e.get("Expires")}:{cacheControl:void 0,expires:void 0}},e.aN=Dt,e.aO=function(e){St++,St>xt&&(e.getActor().send("enforceCacheSizeLimit",vt),St=0)},e.aP=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log2(e)))},e.aQ=Iu,e.aR=A_,e.aS=__,e.aT=ic,e.aU=d_,e.aV=function(e,t){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let n=0;n<e.length;n++){const t=document.createElement("source");Nt(e[n])||(r.crossOrigin="Anonymous"),t.src=e[n],r.appendChild(t)}return{cancel:()=>{}}},e.aW=Pf,e.aX=V_,e.aY=je,e.aZ=my,e.a_=hc,e.aa=Ma,e.ab=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return Xe(e.expression.evaluate(t))}interpolate(e,t,r){return{x:hr(e.x,t.x,r),y:hr(e.y,t.y,r),z:hr(e.z,t.z,r),azimuthal:hr(e.azimuthal,t.azimuthal,r),polar:hr(e.polar,t.polar,r)}}},e.ac=Ba,e.ad=Go,e.ae=vc,e.af=Q,e.ag=B,e.ah=Le,e.ai=Pa,e.aj=td,e.ak=hr,e.al=Nn,e.am=Ar,e.an=Te,e.ao=lr,e.ap=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,r]=e;const n=Xe([1,t,r]);return{x:n.x,y:n.y,z:n.z}}(e.expression.evaluate(t))}interpolate(e,t,r){return{x:hr(e.x,t.x,r),y:hr(e.y,t.y,r),z:hr(e.z,t.z,r)}}},e.aq=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=new Be(r,r),o=e.sub(i),a=t.add(i),s=[o,new Be(a.x,o.y),a,new Be(o.x,a.y)];return n&&s.push(o.clone()),s},e.ar=function(e,t){const r=[];for(let n=0;n<e.length;n++){const i=De(n-1,-1,e.length-1),o=De(n+1,-1,e.length-1),a=e[n],s=e[o],l=e[i].sub(a).unit(),c=s.sub(a).unit(),u=c.angleWithSep(l.x,l.y),d=l.add(c).unit().mult(-1*t/Math.sin(u/2));r.push(a.add(d))}return r},e.as=gy,e.at=mu,e.au=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return C(((t.x-r)*e.scale-e.x)*Nn,(t.y*e.scale-e.y)*Nn,fc(t.z,t.y))},e.av=W,e.aw=R,e.ax=Gc,e.ay=Yp,e.az=function(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(const o of e)t=Math.min(t,o.x),r=Math.min(r,o.y),n=Math.max(n,o.x),i=Math.max(i,o.y);return{min:new Be(t,r),max:new Be(n,i)}},e.b=function(e){return at.API_FONTS_REGEX.test(e)},e.b$=Wh,e.b0=Os,e.b1=ps,e.b2=ze,e.b3=Xs,e.b4=Zy,e.b5=function(){ba.isLoading()||ba.isLoaded()||"deferred"!==xa()||wa()},e.b6=ja,e.b7=Ic,e.b8=Q_,e.b9=Je,e.bA=c,e.bB=m,e.bC=s,e.bD=function(e,t){const{x:r,y:n}=e.point,i=ed(r,n,e.worldSize/e._pixelsPerMercatorPixel,0,0);return d(i,i,Yu(ju(t)))},e.bE=n,e.bF=G,e.bG=O,e.bH=M,e.bI=N,e.bJ=z,e.bK=dg,e.bL=Vm,e.bM=ug,e.bN=function(e,t,r,n,i){const o=5*t+2;e.float32[o+0]=r,e.float32[o+1]=n,e.float32[o+2]=i},e.bO=Gy,e.bP=ue,e.bQ=fe,e.bR=he,e.bS=ve,e.bT=De,e.bU=function(e,t,n,i){var o=new r(4);return o[0]=e,o[1]=t,o[2]=n,o[3]=i,o},e.bV=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const r=t.getSource().maxzoom,n=1<<r,i=Math.floor(e.x),o=Math.floor((e.x-i)*n),a=Math.floor(e.y*n),s=this.findDEMTileFor(new Iu(r,i,r,o,a));return!(!s||!s.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const n=this._source();if(!n)return t;if(e.y<0||e.y>1)return t;const i=n.getSource().maxzoom,o=1<<i,a=Math.floor(e.x),s=e.x-a,l=new Iu(i,a,i,Math.floor(s*o),Math.floor(e.y*o)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,d=1<<c.tileID.canonical.z,h=(s*d-c.tileID.canonical.x)*u.dim,A=(e.y*d-c.tileID.canonical.y)*u.dim,f=Math.floor(h),p=Math.floor(A);return(r?this.exaggeration():1)*hr(hr(u.get(f,p),u.get(f,p+1),A-p),hr(u.get(f+1,p),u.get(f+1,p+1),A-p),h-f)}static getAtTileOffset(e,t,r,n){const i=1<<e.canonical.z;return n?n.pointElevation(t):r?r.getAtPointOrZero(new vc(e.wrap+(e.canonical.x+t.x/Nn)/i,(e.canonical.y+t.y/Nn)/i)):0}static getAtTileOffsetFunc(e,t,r,n){return(i,o,a)=>{const s=this.getAtTileOffset(e,i,o,a),l=n.upVector(e.canonical,i.x,i.y);return P(l,l,s*n.upVectorScale(e.canonical,t,r).metersToTile),l}}getForTilePoints(e,t,r,n){if(this.isUsingMockSource())return!1;const i=F_.create(this,e,n);return!!i&&(t.forEach(e=>{e[2]=this.exaggeration()*i.getElevationAt(e[0],e[1],r)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const r=t.dem.tree,n=t.tileID,i=1<<e.canonical.z-n.canonical.z;let o=e.canonical.x/i-n.canonical.x,a=e.canonical.y/i-n.canonical.y,s=0;for(let l=0;l<e.canonical.z-n.canonical.z&&!r.leaves[s];l++){o*=2,a*=2;const e=2*Math.floor(a)+Math.floor(o);s=r.childOffsets[s]+e,o%=1,a%=1}return{min:this.exaggeration()*r.minimums[s],max:this.exaggeration()*r.maximums[s]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,r=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const i of e){const e=this.getMinMaxForTile(i.tileID);e&&(r=Math.min(r,e.min),n=Math.max(n,e.max),t=!0)}return t?{min:r,max:n}:null}},e.bW=OA,e.bX=iu,e.bY=ym,e.bZ=Rh,e.b_=w_,e.ba=Wp,e.bb=vh,e.bc=Tc,e.bd=As,e.be=Hs,e.bf=Lu,e.bg=dl,e.bh=Fd,e.bi=s_,e.bj=function(e,t){const r=td(t.zoom);if(0===r)return ju(e);const n=Gu(e),i=Ku(n),o=cc(n.getWest())*t.worldSize,a=cc(n.getEast())*t.worldSize,s=uc(n.getNorth())*t.worldSize,l=uc(n.getSouth())*t.worldSize,c=[o,s,0],d=[a,s,0],h=[o,l,0],A=[a,l,0],f=u([],t.globeMatrix);return Q(c,c,f),Q(d,d,f),Q(h,h,f),Q(A,A,f),i[0]=Qu(i[0],h,r),i[1]=Qu(i[1],A,r),i[2]=Qu(i[2],d,r),i[3]=Qu(i[3],c,r),Jc.fromPoints(i)},e.bk=Xu,e.bl=u,e.bm=Wu,e.bn=Qu,e.bo=fs,e.bp=Ou,e.bq=g,e.br=h,e.bs=Hx,e.bt=Em,e.bu=zt,e.bv=function(e,t){const r=[];for(const n in e)n in t||r.push(n);return r},e.bw=Ue,e.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.by=Ce,e.bz=l,e.c=lt,e.c$=function(e,t,r){let n=0;for(let i=0;i<2;++i){const r=0;e[i]>r&&(n+=(e[i]-r)*(e[i]-r)),t[i]<r&&(n+=(r-t[i])*(r-t[i]))}return n},e.c0=qh,e.c1=eg,e.c2=qg,e.c3=oy,e.c4=Jx,e.c5=P,e.c6=Z,e.c7=te,e.c8=function(e,t,r){r*=.5;var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*s,e[1]=i*l-n*s,e[2]=o*l+a*s,e[3]=a*l-o*s,e},e.c9=re,e.cA=w,e.cB=Yc,e.cC=jf,e.cD=Su,e.cE=Hu,e.cF=function(e,t,r,n,i,o,a,s,l){if("globe"===l.name)return Hu(e,t,new Su(r,n,i),!1);const c=my({z:r,x:n,y:i},l);return new Jc([(o+c.x/c.scale)*t,t*(c.y/c.scale),a],[(o+c.x2/c.scale)*t,t*(c.y2/c.scale),s])},e.cG=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},e.cH=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},e.cI=function(e){const t=Math.round((e+45+360)%360/90)%4;return Fe[t]},e.cJ=pc,e.cK=Y,e.cL=ql,e.cM=function(e){const t=c(new Float64Array(16));d(t,e.pixelMatrix,e.globeMatrix);const r=[0,Jl,0],n=[0,$l,0];return Q(r,r,t),Q(n,n,t),[r[0]>0&&r[0]<=e.width&&r[1]>0&&r[1]<=e.height&&!nd(e,new ic(e.center.lat,90)),n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!nd(e,new ic(e.center.lat,-90))]},e.cN=function(e,t){const{scale:r}=e.tileTransform,n=r*Nn/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return function(e,t,r){var n=t[1],i=t[2],o=t[3],a=r[0],s=r[1];return e[0]=t[0]*a,e[1]=n*a,e[2]=i*s,e[3]=o*s,e}(new Float32Array(4),t.inverseAdjustmentMatrix,[n,n])},e.cO=Qf,e.cP=x,e.cQ=Nf,e.cR=function(e){const t=Nf(e,!0);return n([],[t[0],t[1],t[4],t[5]])},e.cS=A,e.cT=Kc,e.cU=f,e.cV=function(e){const{x:t,y:r}=e.point,{lng:n,lat:i}=e._center;return ed(t,r,e.worldSize,n,i)},e.cW=I,e.cX=Ie,e.cY=Fu,e.cZ=gu,e.c_=Wl,e.ca=et,e.cb=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.cc=v,e.cd=function(e,t,r,n,i){var o=1/Math.tan(t/2);if(e[0]=o/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0){var a=1/(n-i);e[10]=(i+n)*a,e[14]=2*i*n*a}else e[10]=-1,e[14]=-2*n;return e},e.ce=function(e,t,r,n,i,o,a){var s=1/(t-r),l=1/(n-i),c=1/(o-a);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*s,e[13]=(i+n)*l,e[14]=(a+o)*c,e[15]=1,e},e.cf=dc,e.cg=function(e,t,r){e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},e.ch=xl,e.ci=Bl,e.cj=wl,e.ck=bl,e.cl=Tl,e.cm=Ry,e.cn=function(){var e=new r(4);return r!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.co=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=t[3],s=Math.sin(r),l=Math.cos(r);return e[0]=n*l+o*s,e[1]=i*l+a*s,e[2]=n*-s+o*l,e[3]=i*-s+a*l,e},e.cp=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.cq=K,e.cr=function(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)},e.cs=se,e.ct=H,e.cu=Tu,e.cv=3,e.cw=2,e.cx=7,e.cy=6,e.cz=j,e.d=function(e){return at.API_TILEJSON_REGEX.test(e)},e.d$=class{constructor(e,t,r,n){this.context=e,this.format=n,this.size=r,this.texture=e.gl.createTexture();const[i,o,a]=this.size,{gl:s}=e;s.bindTexture(s.TEXTURE_3D,this.texture),e.pixelStoreUnpackFlipY.set(!1),e.pixelStoreUnpack.set(1),e.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in t&&t.data&&s.texImage3D(s.TEXTURE_3D,0,this.format,i,o,a,0,If(this.format),Ff(this.format),t.data)}bind(e,t){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_3D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}},e.d0=function(e){return e*e*e*e*e},e.d1=lc,e.d2=45,e.d3=Cl,e.d4=function(e,t,r){const n=Math.sqrt(e*e+t*t+r*r),i=n>0?Math.acos(r/n)*Se:0;let o=0!==e||0!==t?Math.atan2(-t,-e)*Se+90:0;return o<0&&(o+=360),[n,o,i]},e.d5=C,e.d6=Xe,e.d7=_c,e.d8=S,e.d9=Jc,e.dA=function(e){return e({pluginStatus:ma,pluginURL:ga}),va.on("pluginStateChange",e),e},e.dB=El,e.dC=class extends vl{constructor(e){super(e),this.current=Il}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let n=0;n<9;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},e.dD=ke,e.dE=function(e,t,r){const n=td(r.zoom),i=e.style.map._antialias,o=e.terrain&&e.terrain.exaggeration()>0;return 0===n&&!i&&!o},e.dF=function(e){const t=e.pixelsPerMeter,r=t/dc(1,e.center.lat),n=c(new Float64Array(16));return h(n,n,[e.point.x,e.point.y,0]),A(n,n,[r,r,t]),Float32Array.from(n)},e.dG=Gu,e.dH=function(e){const t=pc-5;e=Oe(e,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(Te(e))),3);return Math.round(r*(Yl.length-1))},e.dI=function(e,t,r,n){const i=t.getNorth(),o=t.getSouth(),s=t.getWest(),l=t.getEast(),c=1<<e.z,u=l-s,d=i-o,h=u/Xl,A=-d/Yl[r],f=[0,h,0,A,0,0,i,s,0];if(e.z>0){const e=180/n;a(f,f,[e/u+1,0,0,0,e/d+1,0,-.5*e/h,.5*e/A,1])}return f[2]=c,f[5]=e.x,f[8]=e.y,f},e.dJ=ju,e.dK=function(e,t,r){const n=c(new Float64Array(16)),i=(t/(1<<e)-.5)*Math.PI*2;return p(n,r.globeMatrix,i),Float32Array.from(n)},e.dL=Bd,e.dM=Du,e.dN=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.dO=i,e.dP=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.dQ=V,e.dR=$u,e.dS=nt,e.dT=it,e.dU=256,e.dV=function(e,t){const r=[0,0,0];return Q(r,r,Xu(ju(t.canonical))),Q(r,r,e),r},e.dW=e=>({u_matrix:new Tl(e),u_texsize:new bl(e),u_pixels_to_tile_units:new kl(e),u_device_pixel_ratio:new wl(e),u_width_scale:new wl(e),u_floor_width_scale:new wl(e),u_image:new xl(e),u_units_to_pixels:new bl(e),u_tile_units_to_pixels:new wl(e),u_alpha_discard_threshold:new wl(e),u_trim_offset:new bl(e),u_trim_fade_range:new bl(e),u_trim_color:new Cl(e),u_zbias_factor:new wl(e),u_tile_to_meter:new wl(e),u_ground_shadow_factor:new Bl(e),u_pattern_transition:new wl(e)}),e.dX=e=>({u_matrix:new Tl(e),u_pixels_to_tile_units:new kl(e),u_device_pixel_ratio:new wl(e),u_width_scale:new wl(e),u_floor_width_scale:new wl(e),u_units_to_pixels:new bl(e),u_dash_image:new xl(e),u_gradient_image:new xl(e),u_image_height:new wl(e),u_texsize:new bl(e),u_tile_units_to_pixels:new wl(e),u_alpha_discard_threshold:new wl(e),u_trim_offset:new bl(e),u_trim_fade_range:new bl(e),u_trim_color:new Cl(e),u_zbias_factor:new wl(e),u_tile_to_meter:new wl(e),u_ground_shadow_factor:new Bl(e)}),e.dY=e=>({u_camera_to_center_distance:new wl(e),u_extrude_scale:new kl(e),u_device_pixel_ratio:new wl(e),u_matrix:new Tl(e),u_inv_rot_matrix:new Tl(e),u_merc_center:new bl(e),u_tile_id:new Bl(e),u_zoom_transition:new wl(e),u_up_dir:new Bl(e),u_emissive_strength:new wl(e)}),e.dZ=Ps,e.d_=gm,e.da=T,e.db=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.dc=Tf,e.dd=hp,e.de=$f,e.df=B_,e.dg=function(e,t){return e.readFields(ev,{icons:[]},t)},e.dh=YA,e.di=Fg,e.dj=Ig,e.dk=Ut,e.dl=ya,e.dm=yt,e.dn=Jt,e.dp=He,e.dq=function(e){const t=e.indexOf($a);return t>=0?e.slice(0,t):e},e.dr=function(e){return e.indexOf($a)>=0},e.ds=function(e){const t=e.lastIndexOf($a);return t>=0?e.slice(t+1):""},e.dt=function(e){const t=[],r=e.id;return void 0===r&&t.push({message:"layers.".concat(r,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(r,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(r,': property "renderingMode" must be either "2d" or "3d"')}),t},e.du=function(e,t,r,n){return"custom"===e.type?new v_(e,t):new K_[e.type](e,t,r,n)},e.dv=Ve,e.dw=function(e){const t=e.indexOf($a);return t>=0?e.slice(t+1):""},e.dx=class extends Q_{constructor(e,t){super(e._vectorTileFeature,e._z,e._x,e._y,e.id),e.state&&(this.state=Object.assign({},e.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=e.source,this.sourceLayer=e.sourceLayer,this.layer=e.layer)}toJSON(){const e=super.toJSON();return e.target=this.target,e.namespace=this.namespace,e}},e.dy=va,e.dz=Rt,e.e=at,e.e$=E,e.e0=ld,e.e1=(e,t,r,n,i,o)=>{const a=e.transform,s="globe"===a.projection.name;let l;if("map"===o.paint.get("circle-pitch-alignment"))if(s){const e=$u(a.zoom,t.canonical)*a._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=a.calculatePixelsToTileUnitsMatrix(r);else l=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(a.projection),u_matrix:e.translatePosMatrix(t.projMatrix,r,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:mt.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:sd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(s){c.u_inv_rot_matrix=n,c.u_merc_center=i,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=td(a.zoom);const e=i[0]*Nn,r=i[1]*Nn;c.u_up_dir=a.projection.upVector(new Su(0,0,0),e,r)}return c},e.e2=tm,e.e3=Rr,e.e4=(e,t,r,n,i,o,a,s,l,c)=>{const u=e.transform,d=u.pitch<15?Jp(.07,.7,Oe((14-u.zoom)/5,0,1)):.07,h="none"===r.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:em(e,t,r,n),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:u.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:i,u_width_scale:o,u_floor_width_scale:a,u_image:0,u_tile_units_to_pixels:$p(t,u),u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:s,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(h?null:r.lut).toArray01(),u_zbias_factor:d,u_tile_to_meter:_c(t.tileID.canonical,0),u_ground_shadow_factor:l,u_pattern_transition:c}},e.e5=(e,t,r,n,i,o,a,s,l,c)=>{const u=e.transform,d=u.calculatePixelsToTileUnitsMatrix(t),h="none"===r.paint.get("line-trim-color-use-theme").constantOr("default"),A=u.pitch<15?Jp(.07,.7,Oe((14-u.zoom)/5,0,1)):.07;return{u_matrix:em(e,t,r,n),u_pixels_to_tile_units:d,u_device_pixel_ratio:o,u_width_scale:a,u_floor_width_scale:s,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:i,u_texsize:rm(r)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$p(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:l,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(h?null:r.lut).toArray01(),u_zbias_factor:A,u_tile_to_meter:_c(t.tileID.canonical,0),u_ground_shadow_factor:c}},e.e6=Ne,e.e7=Cd,e.e8=fc,e.e9=ku,e.eA=function(e,r){var n=2*Math.acos(r[3]),i=Math.sin(n/2);return i>t?(e[0]=r[0]/i,e[1]=r[1]/i,e[2]=r[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},e.eB=H_,e.eC=Jf,e.eD=qf,e.eE=[1,1,1],e.eF=F_,e.eG=X,e.eH=function(e,t,r,n){var i=t[0],o=t[1],a=t[2],s=t[3];return e[0]=i+n*(r[0]-i),e[1]=o+n*(r[1]-o),e[2]=a+n*(r[2]-a),e[3]=s+n*(r[3]-s),e},e.eI=Yf,e.eJ=Is,e.eK=Qs,e.eL=function(e,t,n,i,o,a,s,l,c,u,d,h,A,f,p,m){var g=new r(16);return g[0]=e,g[1]=t,g[2]=n,g[3]=i,g[4]=o,g[5]=a,g[6]=s,g[7]=l,g[8]=c,g[9]=u,g[10]=d,g[11]=h,g[12]=A,g[13]=f,g[14]=p,g[15]=m,g},e.eM=rc,e.eN=js,e.eO=Ns,e.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Be(1/0,1/0),max:new Be(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=Vh(new Be(0,0),new Be(Nn,Nn),e),n=[];if(t&&!jh(r,this._globalClipBounds))return n;for(const i of this._activeRegions){if(i.hiddenByOverlap)continue;if(!jh(r,i))continue;const t=Hh(i.min,i.max,e);n.push({min:t.min,max:t.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId,order:i.order,clipMask:i.clipMask,clipScope:i.clipScope})}return n}setSources(e){this._setSources(e.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const r of e.cache.getVisibleCoordinates()){const n=e.cache.getTile(r).buckets[e.layer];n&&n.updateFootprints(r.toUnwrapped(),t)}return t},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(e){const t=e.getFootprints();if(0===t.length)return;const r=e.getOrder(),n=e.getClipMask(),i=e.getClipScope();for(const o of t){if(!o.footprint)continue;const e=Vh(o.footprint.min,o.footprint.max,o.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:o.id,footprint:o.footprint,order:r,clipMask:n,clipScope:i})}this._sourceIds.push(e.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,t)=>e.priority-t.priority||zh(e.min,t.min)||zh(e.max,t.max)||e.order-t.order||e.clipMask-t.clipMask||function(e,t){const r=(e,t)=>e+t;return e.length-t.length||e.reduce(r,"").localeCompare(t.reduce(r,""))}(e.clipScope,t.clipScope));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0;for(;!e&&t!==this._activeRegions.length;){const r=this._activeRegions[t],n=this._prevRegions[t];e=r.priority!==n.priority||!Nh(r,n)||r.order!==n.order||r.clipMask!==n.clipMask||!Ce(r.clipScope,n.clipScope),this._activeRegions[t].hiddenByOverlap=n.hiddenByOverlap,++t}}if(e){++this._updateTime;for(const t of this._activeRegions)t.order!==Dh&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,t.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,t.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,t.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,t.max.y));const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const r=t[e].priority;for(;e<t.length&&t[e].priority===r;)++e;return e};if(this._sourceIds.length>1){let t=0,r=e(t);for(;t!==r;){let n=t;const i=t;for(;n!==r;){const e=this._activeRegions[n];e.hiddenByOverlap=!1;for(let t=0;t<i;t++){const r=this._activeRegions[t];if(!r.hiddenByOverlap&&e.order===Dh&&jh(e,r)&&(e.hiddenByOverlap=Kh(e.footprint,e.tileId,r.footprint,r.tileId),e.hiddenByOverlap))break}++n}t=r,r=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.eQ=Dh,e.eR=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const r=new As,n=new Os,i=[],o=e+1+2,a=t[0]+1,s=t[0]+1+(1+t.length),l=(e,t,r)=>{let n=e===o-1?e-2:0===e?e:e-1;return n+=r?24575:0,[n,t]};for(let c=0;c<o;++c)r.emplaceBack(...l(c,0,!0));for(let c=0;c<a;++c)for(let e=0;e<o;++e)r.emplaceBack(...l(e,c,(0===e||e===o-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<o;++t)r.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=n.length,a=t[c]+1+2,l=new Os;for(let r=0;r<a-1;r++){const e=r===a-2,i=e?o*(s-t.length+c-r):o;for(let t=0;t<o-1;t++){const a=r*o+t;0===r||e||0===t||t===o-2?(l.emplaceBack(a+1,a,a+i),l.emplaceBack(a+i,a+i+1,a+1)):(n.emplaceBack(a+1,a,a+i),n.emplaceBack(a+i,a+i+1,a+1))}}const u=dl.simpleSegment(0,e,r.length,n.length-e);for(let t=0;t<l.uint16.length;t+=3)n.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const d=dl.simpleSegment(0,e,r.length,n.length-e);i.push({withoutSkirts:u,withSkirts:d})}return{vertices:r,indices:n,segments:i}}_createGrid(e){const t=this._fillGridMeshWithLods(Xl,Yl);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Lu.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new Os;for(let a=0;a<=Xl;a++)t.emplaceBack(0,a+1,a+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const r=new Rs,n=new Rs,i=new Rs,o=new Rs;this._poleSegments=[];for(let a=0,s=0;a<Wl;a++){const e=360/(1<<a);r.emplaceBack(0,-Kl,0,.5,0),n.emplaceBack(0,-Kl,0,.5,1),i.emplaceBack(0,-Kl,0,.5,.5),o.emplaceBack(0,-Kl,0,.5,.5);for(let t=0;t<=Xl;t++){let a=t/Xl,s=0;const l=hr(0,e,a),[c,u,d]=ec(od,ad,l,Kl);r.emplaceBack(c,u,d,a,s),n.emplaceBack(c,u,d,a,1-s);const h=Te(l);a=.5+.5*Math.sin(h),s=.5+.5*Math.cos(h),i.emplaceBack(c,u,d,a,s),o.emplaceBack(c,u,d,a,1-s)}this._poleSegments.push(dl.simpleSegment(s,0,66,64)),s+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(r,Mu,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,Mu,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(i,Mu,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(o,Mu,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.eS=Uh,e.eT=Pe,e.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.eV=Me,e.eW=yc,e.eX=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},e.eY=q,e.eZ=tc,e.e_=D,e.ea=gA,e.eb=CA,e.ec=nA,e.ed=oA,e.ee=iA,e.ef=gc,e.eg=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],o=t[6],a=t[7],s=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=a,e[14]=s}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},e.eh=h_,e.ei=ds,e.ej=Ws,e.ek=256,e.el=Yu,e.em=xs,e.en=p,e.eo=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.ep=Rs,e.eq=go,e.er=zs,e.es=function(e,t,r,n,i){return Oe((e-t)/(r-t)*(i-n)+n,n,i)},e.et=ne,e.eu=function(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],l=t[6],c=t[7],u=t[8],d=u*a-s*c,h=-u*o+s*l,A=c*o-a*l,f=r*d+n*h+i*A;return f?(e[0]=d*(f=1/f),e[1]=(-u*n+i*c)*f,e[2]=(s*n-i*a)*f,e[3]=h*f,e[4]=(u*r-i*l)*f,e[5]=(-s*r+i*o)*f,e[6]=A*f,e[7]=(-c*r+n*l)*f,e[8]=(a*r-n*o)*f,e):null},e.ev=2,e.ew=U,e.ex=ee,e.ey=_,e.ez=function(e,t){var n=new r(3);_(n,t);var i=1/n[0],o=1/n[1],a=1/n[2],s=t[0]*i,l=t[1]*o,c=t[2]*a,u=t[4]*i,d=t[5]*o,h=t[6]*a,A=t[8]*i,f=t[9]*o,p=t[10]*a,m=s+d+p,g=0;return m>0?(g=2*Math.sqrt(m+1),e[3]=.25*g,e[0]=(h-f)/g,e[1]=(A-c)/g,e[2]=(l-u)/g):s>d&&s>p?(g=2*Math.sqrt(1+s-d-p),e[3]=(h-f)/g,e[0]=.25*g,e[1]=(l+u)/g,e[2]=(A+c)/g):d>p?(g=2*Math.sqrt(1+d-s-p),e[3]=(A-c)/g,e[0]=(l+u)/g,e[1]=.25*g,e[2]=(h+f)/g):(g=2*Math.sqrt(1+p-s-d),e[3]=(l-u)/g,e[0]=(A+c)/g,e[1]=(h+f)/g,e[2]=.25*g),e},e.f=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(Number("0x"+t))))},e.f0=function(e){let[t,r,n]=e;const i=Math.hypot(t,r,n),o=Math.atan2(t,n),a=.5*Math.PI-Math.acos(-r/i);return new ic(Ie(o),Ie(a))},e.f1=J,e.f2=Hf,e.f3=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==$e){const t=e.navigator?e.navigator.userAgent:null;$e=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return $e}(e)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},e.f4=function(e,t){vt=e,xt=t},e.f5=nd,e.f6=rd,e.f7=function(e){const t=[0,0,0],r=c(new Float64Array(16));return d(r,e.pixelMatrix,e.globeMatrix),Q(t,t,r),new Be(t[0],t[1])},e.f8=function(){const e=ZA;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(KA),ZA=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.f9=function(){YA().acquire(KA)},e.fA=ex,e.fB=Fc,e.fC=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==xf){const r=new Uint32Array(e,0,7),[,,n,i,o,a]=r;t=r.byteLength+i+o+a+o,(n!==e.byteLength||t>=e.byteLength)&&We("Invalid b3dm header information.")}return Sf(e,t)},e.fD=function(e,t){const r=hp(e);for(const n of r){for(const e of n.meshes)Ap(e);n.lights&&(n.lightMeshIndex=n.meshes.length,n.meshes.push(pp(n.lights,t)))}return r},e.fE=U_,e.fF=Ye,e.fG=HA,e.fH=ba,e.fI=fa,e.fJ=function(e){Et(),null!=bt&&bt.then(t=>{t.keys().then(r=>{for(let n=0;n<r.length-e;n++)t.delete(r[n]).catch(e=>We(e.message))}).catch(e=>We(e.message))}).catch(e=>We(e.message))},e.fa=xa,e.fb=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(ma===fa.deferred||ma===fa.loading||ma===fa.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");ga=mt.resolveURL(e),ma=fa.deferred,pa=t,_a(),r||wa()},e.fc=function(e){nf=mt.resolveURL(e),af||(af=new qA(YA(),new nr)),af.broadcast("setMeshoptUrl",nf)},e.fd=df,e.fe=function(e){tf=mt.resolveURL(e),af||(af=new qA(YA(),new nr)),af.broadcast("setDracoUrl",tf)},e.ff=uf,e.fg=GA,e.fh=function(e){const t=Ct();if(!t)return;const r=t.delete(_t);e&&r.then(()=>e()).catch(e)},e.fi=WA,e.fj=ea,e.fk=wd,e.fl=Tg,e.fm=Wx,e.fn=qx,e.fo=Vp,e.fp=Uc,e.fq="hd_road_elevation",e.fr=tu,e.fs=Qe,e.ft=lh,e.fu=bg,e.fv=xg,e.fw=function(e,t,r,n,i,o,a){let s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,u=arguments.length>10?arguments[10]:void 0;e.createArrays(),e.tilePixelRatio=Nn/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const d=e.layers[0].layout,h=e.layers[0]._unevaluatedLayout._values,A={};A.scaleFactor=s,A.textSizeScaleRange=d.get("text-size-scale-range"),A.iconSizeScaleRange=d.get("icon-size-scale-range");const[f,p]=A.textSizeScaleRange,[m,g]=A.iconSizeScaleRange;A.textScaleFactor=Oe(A.scaleFactor,f,p),A.iconScaleFactor=Oe(A.scaleFactor,m,g);const y=h["text-size"],_=h["icon-size"];if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:r}=e.textSizeData;A.compositeTextSizes=[y.possiblyEvaluate(new Ba(t,{worldview:u}),o),y.possiblyEvaluate(new Ba(r,{worldview:u}),o)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:r}=e.iconSizeData;A.compositeIconSizes=[_.possiblyEvaluate(new Ba(t,{worldview:u}),o),_.possiblyEvaluate(new Ba(r,{worldview:u}),o)]}A.layoutTextSize=y.possiblyEvaluate(new Ba(a+1,{worldview:u}),o),A.layoutIconSize=_.possiblyEvaluate(new Ba(a+1,{worldview:u}),o),A.textMaxSize=y.possiblyEvaluate(new Ba(18,{worldview:u}),o);const v=d.get("symbol-placement"),x="map"===d.get("text-rotation-alignment")&&"point"!==v,w=d.get("text-size");let b=!1;const B=[];for(const C of e.features){const a=d.get("text-font").evaluate(C,{},o).join(","),s=w.evaluate(C,{},o)*A.textScaleFactor,f=A.layoutTextSize.evaluate(C,{},o)*A.textScaleFactor,p=A.layoutIconSize.evaluate(C,{},o)*A.iconScaleFactor,m={horizontal:{},vertical:void 0},g=C.text;let y,_=[0,0];if(g){const n=g.toString(),c=d.get("text-letter-spacing").evaluate(C,{},o)*ym,u=d.get("text-line-height").evaluate(C,{},o)*ym,h=aa(n)?c:0,A=d.get("text-anchor").evaluate(C,{},o),p=d.get("text-variable-anchor");if(!p){const e=d.get("text-radial-offset").evaluate(C,{},o);if(e)_=qg(A,[e*ym,Gg]);else{const e=d.get("text-offset").evaluate(C,{},o);_=[e[0]*ym,e[1]*ym]}}let y=x?"center":d.get("text-justify").evaluate(C,{},o);const w="point"===v,b=w?d.get("text-max-width").evaluate(C,{},o)*ym:1/0,B=o=>{e.allowVerticalPlacement&&oa(n)&&(m.vertical=Km(g,t,r,i,a,b,u,A,o,h,_,Vm.vertical,!0,f,s,l))};if(!x&&p){const e="auto"===y?p.map(e=>oy(e)):[y];let n=!1;for(let o=0;o<e.length;o++){const c=e[o];if(!m.horizontal[c])if(n)m.horizontal[c]=m.horizontal[0];else{const e=Km(g,t,r,i,a,b,u,"center",c,h,_,Vm.horizontal,!1,f,s,l);e&&(m.horizontal[c]=e,n=1===e.positionedLines.length)}}B("left")}else{if("auto"===y&&(y=oy(A)),w||d.get("text-writing-mode").indexOf("horizontal")>=0||!oa(n)){const e=Km(g,t,r,i,a,b,u,A,y,h,_,Vm.horizontal,!1,f,s,l);e&&(m.horizontal[y]=e)}B(w?"left":y)}}let E,S,T,I,F,k,P=!1;const M=d.get("icon-text-fit").evaluate(C,{},o);if(C.icon&&C.icon.hasPrimary()){const t=ey(C.icon,e.iconSizeData,h["icon-size"],o,e.zoom,C,l,A.iconScaleFactor,u);E=t.iconPrimary,T=t.iconSecondary;const r=E.toString();if(S=n.get(r),S&&(F=d.get("icon-offset").evaluate(C,{},o),k=d.get("icon-anchor").evaluate(C,{},o),y=ng(i.get(r),T?i.get(T.toString()):void 0,F,k),P=S.sdf,void 0===e.sdfIcons?e.sdfIcons=S.sdf:e.sdfIcons!==S.sdf&&We("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(S.pixelRatio!==e.pixelRatio||0!==d.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0)),T){const e=T.toString();I=n.get(e)}}b=b||!(!C.icon||!C.icon.hasSecondary());const O=dy(m.horizontal)||m.vertical;e.iconsInText||(e.iconsInText=!!O&&O.iconsInText);const L=f*A.textScaleFactor/ym,{defaultShapedIcon:D,verticallyShapedIcon:U}=ay(e,y,d,C,o,m,L,F,M);"none"!==M&&y&&(og(y)||ag(y))&&(Jg(0,S,E,y,D,M,c,n,i),Jg(0,I,T,y,D,M,c,n,i),U&&(Jg(0,S,E,y,U,M,c,n,i),Jg(0,I,T,y,U,M,c,n,i))),y=D;const{iconBBox:R,iconVerticalBBox:z,textBBox:N,textVerticalBBox:j}=Zg(e,y,U,d,C,o,p,F,A,i,k,m,f,_);B.push({feature:C,shapedTextOrientations:m,shapedText:O,shapedIcon:y,iconPrimary:E,iconSecondary:T,iconOffset:F,iconAnchor:k,verticallyShapedIcon:U,layoutTextSize:f,layoutIconSize:p,textOffset:_,isSDFIcon:P,iconTextFit:M,iconCollisionBounds:R,iconVerticalCollisionBounds:z,textCollisionBounds:N,textVerticalCollisionBounds:j})}return{featureData:B,sizes:A,hasAnySecondaryIcon:b,textAlongLine:x,symbolPlacement:v}},e.fx=Bg,e.fy=function(e,t,r,n,i,o,a,s,l,c){e.iconAtlasPositions=c.iconPositions;const{featureData:u,hasAnySecondaryIcon:d,sizes:h,textAlongLine:A,symbolPlacement:f}=t;for(const p of u){const{shapedIcon:t,verticallyShapedIcon:r,feature:o,shapedTextOrientations:u,shapedText:m,layoutTextSize:g,textOffset:y,isSDFIcon:_,iconPrimary:v,iconSecondary:x,iconTextFit:w,iconOffset:b,iconCollisionBounds:B,iconVerticalCollisionBounds:C,textCollisionBounds:E}=p;ry(t,c.iconPositions,v,x),ry(r,c.iconPositions,v,x),ny(u,c.iconPositions),ty(v,x,c.iconPositions),(m||t)&&sy(e,o,u,t,r,l,h,g,0,y,_,n,i,a,s,d,w,b,A,f,B,C,E)}r&&e.generateCollisionDebugBuffers(o,e.collisionBoxArray,h.textScaleFactor)},e.fz=Lc,e.g=function(e,t){return Rt(Object.assign(e,{method:"GET"}),t)},e.h=function(e){return 0===e.indexOf("mapbox:")},e.i=function(e){return at.API_STYLE_REGEX.test(e)&&!lt(e)},e.j=st,e.k=Tt,e.l=function(e){return decodeURIComponent(atob(e).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},e.m=function(e,t){return Rt(Object.assign(e,{type:"json"}),t)},e.n=Ht,e.o=mt,e.p=function(e,t){return Rt(Object.assign(e,{method:"POST"}),t)},e.q=bd,e.r=pt,e.s=function(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}},e.t=function(){return XA||(XA=new WA("ImageRasterizer")),XA},e.u=function(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()},e.v=function(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e.w=We,e.x=Qv,e.y=er,e.z=$t}),a(["./shared"],function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function r(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const n of e)t+="".concat(r(n),",");return"".concat(t,"]")}let t="{";for(const n of Object.keys(e).sort())t+="".concat(n,":").concat(r(e[n]),",");return"".concat(t,"}")}function n(t){let n="";for(const i of e.bx)n+="/".concat(r(t[i]));return n}class i{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,i,o){this._options=o;for(const r of t)this._layerConfigs[r.id]=r,(this._layers[r.id]=e.du(r,this.scope,null,this._options)).compileFilter(o),this.keyCache[r.id]&&delete this.keyCache[r.id];for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const a=function(e,t){const i={};for(let a=0;a<e.length;a++){const o=e[a];let s=t&&t[o.id];s||("symbol"===o.type?s=o.id:(s=n(o),"line"===o.type&&o.paint&&function e(t){return"string"==typeof t&&"line-progress"===t||(Array.isArray(t)?t.some(e):!(!t||"object"!=typeof t)&&Object.values(t).some(e))}(o.paint["line-width"])&&(s+="/".concat(r(o.paint["line-width"]))))),t&&(t[o.id]=s);let l=i[s];l||(l=i[s]=[]),l.push(o)}const o=[];for(const r in i)o.push(i[r]);return o}(Object.values(this._layerConfigs),this.keyCache);for(const e of a){const t=e.map(e=>this._layers[e.id]),r=t[0];if("none"===r.visibility)continue;const n=r.source||"";let i=this.familiesBySource[n];i||(i=this.familiesBySource[n]={});const o=r.sourceLayer||"_geojsonTileLayer";let a=i[o];a||(a=i[o]=[]),a.push(t)}}}const o=1*e.fl;class a{constructor(t){const r={},n=[];for(const e in t){const i=t[e],a=r[e]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const r=t.metrics.localGlyph?o:1,s={x:0,y:0,w:t.bitmap.width+2*r,h:t.bitmap.height+2*r};n.push(s),a[e]=s}}const{w:i,h:a}=e.G(n),s=new e.fk({width:i||1,height:a||1});for(const l in t){const n=t[l];for(const t in n.glyphs){const i=n.glyphs[+t];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const a=r[l][t],c=i.metrics.localGlyph?o:1;e.fk.copy(i.bitmap,s,{x:0,y:0},{x:a.x+c,y:a.y+c},i.bitmap)}}this.image=s,this.positions=r}}function s(e,t,r){e[t]?r&&(e[t].center=r):e[t]={floorIds:new Set,center:r||[0,0],floors:{}}}function l(e,t,r,n){for(const i of t)s(e,i),e[i].floors[r]=n,e[i].floorIds.add(r)}function c(e){return{id:e.properties.id.toString(),center:e.properties.center.toString().split(";").map(Number)}}function u(e){return{id:e.properties.id.toString(),isDefault:!!e.properties.is_default&&e.properties.is_default,connections:e.properties.connected_floor_ids?new Set(e.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:e.properties.conflicted_floor_ids?new Set(e.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:e.properties.building_ids?new Set(e.properties.building_ids.toString().split(";")):new Set,name:e.properties.name.toString(),zIndex:e.properties.z_index}}function d(e,t){return t.every(t=>e.properties&&null!=e.properties[t])}function h(e){return d(e,["type","id","name"])&&"building"===e.properties.type}function A(e){return d(e,["type","id","name","z_index"])&&"floor"===e.properties.type}e.fj(a,"GlyphAtlas");class f{constructor(t){this.tileID=new e.aQ(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.lut=t.lut,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.request&&t.request.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.aZ(t.tileID.canonical,t.projection),this.projection=t.projection,this.worldview=t.worldview,this.localizableLayerIds=t.localizableLayerIds,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster,this.tessellationStep=t.tessellationStep,this.scaleFactor=t.scaleFactor,this.worldview=t.worldview,this.indoor=t.indoor}parse(t,r,n,i,o,d){this.status="parsing",this.data=t,this.collisionBoxArray=new e.b3;const f=new e.fm(Object.keys(t.layers).sort()),m=new e.fn(this.tileID,this.promoteId);m.bucketLayerIDs=[];const g={},y=new e.fo(256,256),_={featureIndex:m,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:y,availableImages:n,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const r=this.indoor.indoorState.activeFloorsVisible,n=function(t,r,n){const i=function(t,r){if(!t)return e.w("No source layers defined in indoor specification"),r;if(0===t.size)return r;const n=t.difference(r);for(const i of n)e.w("Missing source layer required in indoor specification: ".concat(i));return r.intersection(r)}(r.sourceLayers,new Set(Object.keys(t.layers))),o=r.indoorState,a=function(t,r,n,i){const o=new Set,a=new Set,d=new Set,f=new Map,p={},m=e=>{const t=f.get(e)||new Set;for(const r of o)if((f.get(r)||new Set).has(e)||t.has(r))return!0;return!1};for(const g of r){const r=t.layers[g];if(r)for(let e=0;e<r.length;e++){const t=r.feature(e);if(h(t)){const{id:e,center:r}=c(t);s(p,e,r),o.add(e)}else if(A(t)){const{id:e,isDefault:r,connections:n,conflicts:s,buildings:c,name:h,zIndex:A}=u(t);l(p,c,e,{name:h,zIndex:A}),f.set(e,s),(e===i||n.has(i))&&o.add(e),a.add(e),r&&d.add(e)}}else e.w("indoor source layer not found: ".concat(g))}if(n)for(const e of n)a.has(e)&&(m(e)||o.add(e));for(const e of d)o.has(e)||m(e)||o.add(e);return{buildings:p,activeFloors:o}}(t,i,o.lastActiveFloors,o.selectedFloorId);return n.send("setIndoorData",a),a}(t,this.indoor,o);_.activeFloors=r?n.activeFloors:void 0}const v=[],x=r.familiesBySource[this.source];for(const a in x){const r=t.layers[a];if(!r)continue;let o=!1,s=!1,l=!1;for(const e of x[a])"symbol"===e[0].type?o=!0:s=!0,e[0].is3D()&&"model"!==e[0].type&&(l=!0);if(this.extraShadowCaster&&!l)continue;if(!0===this.isSymbolTile&&!o)continue;if(!1===this.isSymbolTile&&!s)continue;1===r.version&&e.w('Vector tile source "'.concat(this.source,'" layer "').concat(a,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const c=f.encode(a),u=[],d=this.localizableLayerIds&&this.localizableLayerIds.has(a);let h=!1;for(let t=0,n=0;t<r.length;t++){const i=r.feature(t),o=m.getId(i,a),s=i.properties?i.properties.worldview:null;if(d&&this.worldview&&"string"==typeof s)if("all"===s)i.properties.$localized=!0;else{if(!s.split(",").includes(this.worldview))continue;i.properties.$localized=!0,i.properties.worldview=this.worldview}!h&&i.properties&&i.properties.hasOwnProperty(e.fp)&&(h=!0),u.push({feature:i,id:o,index:n,sourceLayerIndex:c}),n++}h&&!_.elevationFeatures&&t.layers.hasOwnProperty(e.fq)&&(_.elevationFeatures=e.fr.parseFrom(t.layers[e.fq],this.canonical));for(const t of x[a]){const r=t[0];if(this.extraShadowCaster&&(!r.is3D()||"model"===r.type))continue;if(void 0!==this.isSymbolTile&&"symbol"===r.type!==this.isSymbolTile)continue;if(r.minzoom&&this.zoom<Math.floor(r.minzoom))continue;if(r.maxzoom&&this.zoom>=r.maxzoom)continue;if("none"===r.visibility)continue;p(t,this.zoom,_.brightness,n,this.worldview);const o=g[r.id]=r.createBucket({index:m.bucketLayerIDs.length,layers:t,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:c,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:i,worldview:this.worldview,localizable:d});m.bucketLayerIDs.push(t.map(t=>e.B(t.id,t.scope)));let a=o.prepare?o.prepare():null;null!=a?(a=a.then(()=>o.populate(u,_,this.tileID.canonical,this.tileTransform)),v.push(a)):o.populate(u,_,this.tileID.canonical,this.tileTransform)}}const w=()=>{let r,i,s,l,c,u;y.trim();const h={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},A=()=>{if(r)return this.status="done",d(r);if(this.extraShadowCaster)this.status="done",d(null,{buckets:Object.values(g).filter(e=>!e.isEmpty()),featureIndex:m,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:_.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(i&&s&&l){const t=new a(i),r=new Map;for(const[n,i]of s.entries()){const{imagePosition:t}=e.fu(n,i,e.fv);r.set(n,t)}const d={};for(const o in g){const a=g[o];a instanceof e.b4&&(p(a.layers,this.zoom,_.brightness,n,this.worldview),d[o]=e.fw(a,i,t.positions,s,r,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,c,this.worldview))}const h={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(o,s,c,()=>{h.iconsPending=!1,v(d,t,h)}),this.rasterizeIfNeeded(o,l,u,()=>{h.patternsPending=!1,v(d,t,h)})}},v=(t,r,i,o)=>{if(i.iconsPending||i.patternsPending)return;const a=new e.fx(s,l,this.lut);for(const l in g){const r=g[l];if(l in t)e.fy(r,t[l],this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,s,a);else if(r.hasPattern&&(r instanceof e.ba||r instanceof e.bb||r instanceof e.ea)){p(r.layers,this.zoom,_.brightness,n,this.worldview);const e=Object.fromEntries(a.patternPositions);r.addFeatures(_,this.tileID.canonical,e,n,this.tileTransform,this.brightness)}}this.status="done",d(null,{buckets:Object.values(g).filter(e=>!e.isEmpty()),featureIndex:m,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:r.image,lineAtlas:y,imageAtlas:a,brightness:_.brightness})};if(!this.extraShadowCaster){const t=e.fs(_.glyphDependencies,e=>Object.keys(e).map(Number));Object.keys(t).length?o.send("getGlyphs",{uid:this.uid,stacks:t},(e,t)=>{r||(r=e,i=t,A())},void 0,!1,h):i={};const n=Array.from(_.iconDependencies.keys()).map(t=>e.I.parse(t));n.length?o.send("getImages",{images:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(e,t)=>{r||(r=e,s=new Map,c=this.updateImageMapAndGetImageTaskQueue(s,t,_.iconDependencies),A())},void 0,!1,h):(s=new Map,c=new Map);const a=Array.from(_.patternDependencies.keys()).map(t=>e.I.parse(t));a.length?o.send("getImages",{images:a,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(e,t)=>{r||(r=e,l=new Map,u=this.updateImageMapAndGetImageTaskQueue(l,t,_.patternDependencies),A())},void 0,!1,h):(l=new Map,u=new Map)}if(_.elevationFeatures&&_.elevationFeatures.length>0){const r=[];for(const t of Object.values(g))if(t instanceof e.bb){const e=t.getUnevaluatedPortalGraph();e&&r.push(e)}const n=e.ft.evaluate(r);for(const i of Object.values(g))if(i instanceof e.bb){const e=t.layers[f.decode(i.sourceLayerIndex)];i.setEvaluatedPortalGraph(n,e,this.tileID.canonical,_.availableImages,_.brightness)}}A()};v.length>0?Promise.allSettled(v).then(w).catch(d):w()}updateParameters(t){this.scaleFactor=t.scaleFactor,this.showCollisionBoxes=t.showCollisionBoxes,this.projection=t.projection,this.brightness=t.brightness,this.tileTransform=e.aZ(t.tileID.canonical,t.projection),this.extraShadowCaster=t.extraShadowCaster,this.lut=t.lut,this.worldview=t.worldview,this.indoor=t.indoor}rasterizeIfNeeded(e,t,r,n){Array.from(t.values()).some(e=>e.usvg)?this.rasterize(e,t,r,n):n()}updateImageMapAndGetImageTaskQueue(e,t,r){const n=new Map;for(const i of t.keys()){const o=r.get(i)||[];for(const r of o){const i=r.toString(),o=t.get(r.id.toString());o.usvg?n.has(i)||(n.set(i,r),e.set(i,Object.assign({},o))):e.set(i,o)}}return n}rasterize(e,t,r,n){this.rasterizeTask=e.send("rasterizeImages",{scope:this.scope,tasks:r},(e,r)=>{if(!e)for(const[n,i]of r.entries()){const e=Object.assign(t.get(n),{data:i});t.set(n,e)}n()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function p(t,r,n,i,o){const a=new e.ac(r,{brightness:n,worldview:o});for(const e of t)e.recalculate(a,i)}class m extends e.E{constructor(t,r,n,i,o,a,s){super(),this.actor=t,this.layerIndex=r,this.availableImages=n,this.availableModels=i,this.loadVectorData=a||e.aL,this.loading={},this.loaded={},this.deduped=new e.aK(t.scheduler),this.isSpriteLoaded=o,this.scheduler=t.scheduler,this.brightness=s}loadTile(r,n){const i=r.uid,o=r&&r.request,a=o&&o.collectResourceTiming,s=this.loading[i]=new f(r);s.abort=this.loadVectorData(r,(l,c)=>{const u=!this.loading[i];if(delete this.loading[i],s.cancelRasterize(),u||l||!c)return s.status="done",u||(this.loaded[i]=s),n(l);const d=c.rawData,h={},A=e.aM(c.responseHeaders);A&&A.expires&&(h.expires=A.expires),A&&A.cacheControl&&(h.cacheControl=A.cacheControl),s.vectorTile=c.vectorTile||new e.fz(new e.bt(d));const f=()=>{s.parse(s.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(e,r)=>{if(e||!r)return n(e);const i={};if(a){const e=t(o);e.length>0&&(i.resourceTiming=JSON.parse(JSON.stringify(e)))}n(null,Object.assign({rawTileData:d.slice(0),responseHeaders:c.responseHeaders},r,h,i))})};this.isSpriteLoaded?f():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(f,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):f()}),this.loaded=this.loaded||{},this.loaded[i]=s})}reloadTile(e,t){const r=this.loaded,n=e.uid;if(r&&r[n]){const i=r[n];i.updateParameters(e);const o=(e,r)=>{const n=i.reloadCallback;n&&(delete i.reloadCallback,i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,n)),t(e,r)};"parsing"===i.status?i.reloadCallback=o:"done"===i.status&&(i.vectorTile?i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,o):o())}else t(null,void 0)}abortTile(e,t){const r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],t()}}class g{loadTile(t,r){const{uid:n,encoding:i,rawImageData:o,padding:a}=t,s=ImageBitmap&&o instanceof ImageBitmap?this.getImageData(o,a):o;r(null,new e.fA(n,s,i,a<1))}reloadTile(e,t){t(null,null)}abortTile(e,t){t()}removeTile(e,t){t()}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const r=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}e.bs.setPbf(e.bt);class y{constructor(t){this._mrt=new e.bs(t.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=t.uid,this.tileID=t.tileID,this.source=t.source}parse(t,r){const n=this._mrt;this.status="parsing",this._entireBuffer=t;try{n.parseHeader(t),this._isHeaderLoaded=!0;const i=[];for(const r in n.layers){const o=n.getLayer(r),a=o.getDataRange(o.getBandList()),s=n.createDecodingTask(a),l=t.slice(a.firstByte,a.lastByte+1),c=e.bs.performDecoding(l,s).then(e=>s.complete(null,e)).catch(e=>s.complete(e,null));i.push(c)}Promise.allSettled(i).then(()=>r(null,n)).catch(e=>r(e))}catch(e){r(e)}}}class _{constructor(e){this.actor=e,this.loading={},this.loaded={}}loadTile(t,r){const n=t.uid,i=t.request,o=this.loading[n]=new y(t),{cancel:a}=e.bu(i,(e,t,i)=>{const a=!this.loading[n];if(delete this.loading[n],a||e||!t)return o.status="done",a||(this.loaded[n]=o),r(e);o.parse(t,(e,t)=>{if(e||!t)return r(e);r(null,t,i)}),this.loaded[n]=o});o.abort=a}reloadTile(e,t){t(null,void 0)}abortTile(e,t){const r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=e.uid;this.loaded[r]&&delete this.loaded[r],t()}decodeRasterArray(t,r){e.bs.performDecoding(t.buffer,t.task).then(e=>r(null,e)).catch(e=>r(e))}}const v=e.fB.prototype.toGeoJSON;class x{constructor(t){this._feature=t,this.extent=e.al,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const r of this._feature.geometry)t.push([new e.P(r[0],r[1])]);return t}{const t=[];for(const r of this._feature.geometry){const n=[];for(const t of r)n.push(new e.P(t[0],t[1]));t.push(n)}return t}}toGeoJSON(e,t,r){return v.call(this,e,t,r)}}class w{constructor(t,r){this.name=t,this.extent=e.al,this.length=r.length,this._jsonFeatures=r}feature(e){return new x(this._jsonFeatures[e])}}class b{constructor(t){this.layers={},this.extent=e.al;for(const e of Object.keys(t))this.layers[e]=new w(e,t[e])}}const B=64/4096,C=128;class E{constructor(){this.features=new Map}clear(){this.features.clear()}load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;for(const r of e){const e=r.id;if(null==e)continue;let n=this.features.get(e);n&&this.updateCache(n,t),r.geometry?(n=T(r),this.updateCache(n,t),this.features.set(e,n)):this.features.delete(e),this.updateCache(n,t)}}updateCache(e,t){for(const{canonical:r,uid:n}of Object.values(t)){const{z:i,x:o,y:a}=r;S(e,Math.pow(2,i),o,a)&&delete t[n]}}getTile(e,t,r){const n=Math.pow(2,e),i=[];for(const o of this.features.values())S(o,n,t,r)&&i.push(P(o,n,t,r));return{features:i}}getFeatures(){return[...this.features.values()]}}function S(e,t,r,n){let{minX:i,minY:o,maxX:a,maxY:s}=e;return i<(r+1+B)/t&&o<(n+1+B)/t&&a>(r-B)/t&&s>(n-B)/t}function T(e){const{id:t,geometry:r,properties:n}=e;if(!r)return;if("GeometryCollection"===r.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:i,coordinates:o}=r,a={id:t,type:1,geometry:[],tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},s=a.geometry;if("Point"===i)I(o,s,a);else if("MultiPoint"===i)for(const l of o)I(l,s,a);else if("LineString"===i)a.type=2,F(o,s,a);else if("MultiLineString"===i)a.type=2,k(o,s,a);else if("Polygon"===i)a.type=3,k(o,s,a,!0);else{if("MultiPolygon"!==i)throw new Error("Input data is not a valid GeoJSON object.");a.type=3;for(const e of o)k(e,s,a,!0)}return a}function I(t,r,n){let[i,o]=t;const a=e.aF(i);let s=e.aJ(o);s=s<0?0:s>1?1:s,r.push(a,s),n.minX=Math.min(n.minX,a),n.minY=Math.min(n.minY,s),n.maxX=Math.max(n.maxX,a),n.maxY=Math.max(n.maxY,s)}function F(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=[];for(const a of e)I(a,o,r);t.push(o),n&&function(e,t){let r=0;for(let n=0,i=e.length,o=i-2;n<i;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===t)for(let n=0,i=e.length;n<i/2;n+=2){const t=e[n],r=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=t,e[i-1-n]=r}}(o,i)}function k(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];for(let i=0;i<e.length;i++)F(e[i],t,r,n,0===i)}function P(t,r,n,i){const{id:o,type:a,geometry:s,tags:l}=t,c=[];if(1===a)!function(t,r,n,i,o){for(let a=0;a<t.length;a+=2){const s=Math.round(e.al*(t[a+0]*r-n)),l=Math.round(e.al*(t[a+1]*r-i));o.push([s,l])}}(s,r,n,i,c);else if(2===a)for(const e of s)M(e,r,n,i,c);else if(3===a)for(const e of s)O(e,r,n,i,c);return{id:o,type:a,geometry:c,tags:l}}function M(t,r,n,i,o){const a=-C,s=e.al+C;let l;for(let c=0;c<t.length-2;c+=2){let u=Math.round(e.al*(t[c+0]*r-n)),d=Math.round(e.al*(t[c+1]*r-i)),h=Math.round(e.al*(t[c+2]*r-n)),A=Math.round(e.al*(t[c+3]*r-i));const f=h-u,p=A-d;u<a&&h<a||(u<a?(d+=Math.round(p*((a-u)/f)),u=a):h<a&&(A=d+Math.round(p*((a-u)/f)),h=a),d<a&&A<a||(d<a?(u+=Math.round(f*((a-d)/p)),d=a):A<a&&(h=u+Math.round(f*((a-d)/p)),A=a),u>=s&&h>=s||(u>=s?(d+=Math.round(p*((s-u)/f)),u=s):h>=s&&(A=d+Math.round(p*((s-u)/f)),h=s),d>=s&&A>=s||(d>=s?(u+=Math.round(f*((s-d)/p)),d=s):A>=s&&(h=u+Math.round(f*((s-d)/p)),A=s),l&&u===l[l.length-1][0]&&d===l[l.length-1][1]||(l=[[u,d]],o.push(l)),l.push([h,A])))))}}function O(t,r,n,i,o){const a=(n-B)/r,s=(i-B)/r,l=(n+1+B)/r,c=(i+1+B)/r;function u(e,t){let r=0;return e<a?r|=1:e>l&&(r|=2),t<s?r|=4:t>c&&(r|=8),r}let d=[];for(let e=1;e<=8;e*=2){let r=t[t.length-2],n=t[t.length-1],i=!(u(r,n)&e);for(let o=0;o<t.length;o+=2){const h=t[o],A=t[o+1],f=!(u(h,A)&e);f!==i&&(8&e?d.push(r+(h-r)*(c-n)/(A-n),c):4&e?d.push(r+(h-r)*(s-n)/(A-n),s):2&e?d.push(l,n+(A-n)*(l-r)/(h-r)):1&e&&d.push(a,n+(A-n)*(a-r)/(h-r))),f&&d.push(h,A),r=h,n=A,i=f}if(!(t=d).length||8===e)break;d=[]}const h=[];for(let A=0;A<d.length;A+=2)h.push([Math.round(e.al*(d[A]*r-n)),Math.round(e.al*(d[A+1]*r-i))]);o.push(h)}function L(t,r){let{name:n,features:i}=t;r.writeStringField(1,n),r.writeVarintField(5,e.al);const o=new Map,a=new Map,s={keys:o,values:a,feature:null};for(const e of i)s.feature=e,r.writeMessage(2,D,s);for(const e of o.keys())r.writeStringField(3,e);for(const e of a.keys())r.writeMessage(4,j,e)}function D(e,t){const r=e.feature;void 0!==r.id&&Number.isSafeInteger(+r.id)&&t.writeVarintField(1,+r.id),r.tags&&t.writeMessage(2,U,e),t.writeVarintField(3,r.type),t.writeMessage(4,N,r)}function U(e,t){let{keys:r,values:n,feature:i}=e;for(const o of Object.keys(i.tags)){let e=i.tags[o];if(null===e)continue;let a=r.get(o);void 0===a&&(a=r.size,r.set(o,a)),t.writeVarint(a);const s=typeof e;"string"!==s&&"boolean"!==s&&"number"!==s&&(e=JSON.stringify(e));let l=n.get(e);void 0===l&&(l=n.size,n.set(e,l)),t.writeVarint(l)}}function R(e,t){return(t<<3)+(7&e)}function z(e){return e<<1^e>>31}function N(e,t){const{geometry:r,type:n}=e;let i=0,o=0;if(1===n){t.writeVarint(R(1,r.length));for(const e of r){const r=e[0]-i,n=e[1]-o;t.writeVarint(z(r)),t.writeVarint(z(n)),i+=r,o+=n}}else for(const a of r){t.writeVarint(R(1,1));const e=a.length-(3===n?1:0);for(let r=0;r<e;r++){1===r&&t.writeVarint(R(2,e-1));const n=a[r][0]-i,s=a[r][1]-o;t.writeVarint(z(n)),t.writeVarint(z(s)),i+=n,o+=s}3===n&&t.writeVarint(R(7,1))}}function j(e,t){const r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}const Q={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},V=Math.fround||(H=new Float32Array(1),e=>(H[0]=+e,H[0]));var H;const G=3,K=5,W=6;class q{constructor(e){this.options=Object.assign(Object.create(Q),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:r,maxZoom:n}=this.options;t&&console.time("total time");const i="prepare ".concat(e.length," points");t&&console.time(i),this.points=e;const o=[];for(let s=0;s<e.length;s++){const t=e[s];if(!t.geometry)continue;const[r,n]=t.geometry.coordinates,i=V(Y(r)),a=V(J(n));o.push(i,a,1/0,s,-1,1),this.options.reduce&&o.push(0)}let a=this.trees[n+1]=this._createTree(o);t&&console.timeEnd(i);for(let s=n;s>=r;s--){const e=+Date.now();a=this.trees[s]=this._createTree(this._cluster(a,s)),t&&console.log("z%d: %d clusters in %dms",s,a.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,i=180;else if(r>i){const e=this.getClusters([r,n,180,o],t),a=this.getClusters([-180,n,i,o],t);return e.concat(a)}const a=this.trees[this._limitZoom(t)],s=a.range(Y(r),J(o),Y(i),J(n)),l=a.data,c=[];for(const u of s){const e=this.stride*u;c.push(l[e+K]>1?Z(l,e,this.clusterProps):this.points[l[e+G]])}return c}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);const o=i.data;if(t*this.stride>=o.length)throw new Error(n);const a=this.options.radius/(this.options.extent*Math.pow(2,r-1)),s=i.within(o[t*this.stride],o[t*this.stride+1],a),l=[];for(const c of s){const t=c*this.stride;o[t+4]===e&&l.push(o[t+K]>1?Z(o,t,this.clusterProps):this.points[o[t+G]])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,r){const n=[];return this._appendLeaves(n,e,t=t||10,r=r||0,0),n}getTile(e,t,r){const n=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:o,radius:a}=this.options,s=a/o,l=(r-s)/i,c=(r+1+s)/i,u={features:[]};return this._addTileFeatures(n.range((t-s)/i,l,(t+1+s)/i,c),n.data,t,r,i,u),0===t&&this._addTileFeatures(n.range(1-s/i,l,1,c),n.data,i,r,i,u),t===i-1&&this._addTileFeatures(n.range(0,l,s/i,c),n.data,-1,r,i,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,n,i){const o=this.getChildren(t);for(const a of o){const t=a.properties;if(t&&t.cluster?i+t.point_count<=n?i+=t.point_count:i=this._appendLeaves(e,t.cluster_id,r,n,i):i<n?i++:e.push(a),e.length===r)break}return i}_createTree(t){const r=new e.c4(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)r.add(t[e],t[e+1]);return r.finish(),r.data=t,r}_addTileFeatures(e,t,r,n,i,o){for(const a of e){const e=a*this.stride,s=t[e+K]>1;let l,c,u;if(s)l=X(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const r=this.points[t[e+G]];l=r.properties;const[n,i]=r.geometry.coordinates;c=Y(n),u=J(i)}const d={type:1,geometry:[[Math.round(this.options.extent*(c*i-r)),Math.round(this.options.extent*(u*i-n))]],tags:l};let h;h=s||this.options.generateId?t[e+G]:this.points[t[e+G]].id,void 0!==h&&(d.id=h),o.features.push(d)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:r,extent:n,reduce:i,minPoints:o}=this.options,a=r/(n*Math.pow(2,t)),s=e.data,l=[],c=this.stride;for(let u=0;u<s.length;u+=c){if(s[u+2]<=t)continue;s[u+2]=t;const r=s[u],n=s[u+1],d=e.within(s[u],s[u+1],a),h=s[u+K];let A=h;for(const e of d){const r=e*c;s[r+2]>t&&(A+=s[r+K])}if(A>h&&A>=o){let e,o=r*h,a=n*h,f=-1;const p=(u/c<<5)+(t+1)+this.points.length;for(const r of d){const n=r*c;if(s[n+2]<=t)continue;s[n+2]=t;const l=s[n+K];o+=s[n]*l,a+=s[n+1]*l,s[n+4]=p,i&&(e||(e=this._map(s,u,!0),f=this.clusterProps.length,this.clusterProps.push(e)),i(e,this._map(s,n)))}s[u+4]=p,l.push(o/A,a/A,1/0,p,-1,A),i&&l.push(f)}else{for(let e=0;e<c;e++)l.push(s[u+e]);if(A>1)for(const e of d){const r=e*c;if(!(s[r+2]<=t)){s[r+2]=t;for(let e=0;e<c;e++)l.push(s[r+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(e[t+K]>1){const n=this.clusterProps[e[t+W]];return r?Object.assign({},n):n}const n=this.points[e[t+G]].properties,i=this.options.map(n);return r&&i===n?Object.assign({},i):i}}function Z(e,t,r){return{type:"Feature",id:e[t+G],properties:X(e,t,r),geometry:{type:"Point",coordinates:[(n=e[t],360*(n-.5)),$(e[t+1])]}};var n}function X(e,t,r){const n=e[t+K],i=n>=1e4?"".concat(Math.round(n/1e3),"k"):n>=1e3?Math.round(n/100)/10+"k":n,o=e[t+W],a=-1===o?{}:Object.assign({},r[o]);return Object.assign(a,{cluster:!0,cluster_id:e[t+G],point_count:n,point_count_abbreviated:i})}function Y(e){return e/360+.5}function J(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function $(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function ee(e,t,r,n){let i=n;const o=t+(r-t>>1);let a,s=r-t;const l=e[t],c=e[t+1],u=e[r],d=e[r+1];for(let h=t+3;h<r;h+=3){const t=te(e[h],e[h+1],l,c,u,d);if(t>i)a=h,i=t;else if(t===i){const e=Math.abs(h-o);e<s&&(a=h,s=e)}}i>n&&(a-t>3&&ee(e,t,a,n),e[a+2]=i,r-a>3&&ee(e,a,r,n))}function te(e,t,r,n,i,o){let a=i-r,s=o-n;if(0!==a||0!==s){const l=((e-r)*a+(t-n)*s)/(a*a+s*s);l>1?(r=i,n=o):l>0&&(r+=a*l,n+=s*l)}return a=e-r,s=t-n,a*a+s*s}function re(e,t,r,n){const i={id:null!==e&&void 0!==e?e:null,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)ne(i,r);else if("Polygon"===t)ne(i,r[0]);else if("MultiLineString"===t)for(const o of r)ne(i,o);else if("MultiPolygon"===t)for(const o of r)ne(i,o[0]);return i}function ne(e,t){for(let r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function ie(e,t,r,n){if(!t.geometry)return;const i=t.geometry.coordinates;if(i&&0===i.length)return;const o=t.geometry.type,a=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2);let s=[],l=t.id;if(r.promoteId?l=t.properties[r.promoteId]:r.generateId&&(l=n||0),"Point"===o)oe(i,s);else if("MultiPoint"===o)for(const c of i)oe(c,s);else if("LineString"===o)ae(i,s,a,!1);else if("MultiLineString"===o){if(r.lineMetrics){for(const r of i)s=[],ae(r,s,a,!1),e.push(re(l,"LineString",s,t.properties));return}se(i,s,a,!1)}else if("Polygon"===o)se(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(const i of t.geometry.geometries)ie(e,{id:l,geometry:i,properties:t.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of i){const t=[];se(e,t,a,!0),s.push(t)}}e.push(re(l,o,s,t.properties))}function oe(e,t){t.push(le(e[0]),ce(e[1]),0)}function ae(e,t,r,n){let i,o,a=0;for(let l=0;l<e.length;l++){const r=le(e[l][0]),s=ce(e[l][1]);t.push(r,s,0),l>0&&(a+=n?(i*s-r*o)/2:Math.sqrt(Math.pow(r-i,2)+Math.pow(s-o,2))),i=r,o=s}const s=t.length-3;t[2]=1,ee(t,0,s,r),t[s+2]=1,t.size=Math.abs(a),t.start=0,t.end=t.size}function se(e,t,r,n){for(let i=0;i<e.length;i++){const o=[];ae(e[i],o,r,n),t.push(o)}}function le(e){return e/360+.5}function ce(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function ue(e,t,r,n,i,o,a,s){if(n/=t,o>=(r/=t)&&a<n)return e;if(a<r||o>=n)return null;const l=[];for(const c of e){const e=c.geometry;let t=c.type;const o=0===i?c.minX:c.minY,a=0===i?c.maxX:c.maxY;if(o>=r&&a<n){l.push(c);continue}if(a<r||o>=n)continue;let u=[];if("Point"===t||"MultiPoint"===t)de(e,u,r,n,i);else if("LineString"===t)he(e,u,r,n,i,!1,s.lineMetrics);else if("MultiLineString"===t)fe(e,u,r,n,i,!1);else if("Polygon"===t)fe(e,u,r,n,i,!0);else if("MultiPolygon"===t)for(const s of e){const e=[];fe(s,e,r,n,i,!0),e.length&&u.push(e)}if(u.length){if(s.lineMetrics&&"LineString"===t){for(const e of u)l.push(re(c.id,t,e,c.tags));continue}"LineString"!==t&&"MultiLineString"!==t||(1===u.length?(t="LineString",u=u[0]):t="MultiLineString"),"Point"!==t&&"MultiPoint"!==t||(t=3===u.length?"Point":"MultiPoint"),l.push(re(c.id,t,u,c.tags))}}return l.length?l:null}function de(e,t,r,n,i){for(let o=0;o<e.length;o+=3){const a=e[o+i];a>=r&&a<=n&&pe(t,e[o],e[o+1],e[o+2])}}function he(e,t,r,n,i,o,a){let s=Ae(e);const l=0===i?me:ge;let c,u,d=e.start;for(let m=0;m<e.length-3;m+=3){const h=e[m],A=e[m+1],f=e[m+2],p=e[m+3],g=e[m+4],y=0===i?h:A,_=0===i?p:g;let v=!1;a&&(c=Math.sqrt(Math.pow(h-p,2)+Math.pow(A-g,2))),y<r?_>r&&(u=l(s,h,A,p,g,r),a&&(s.start=d+c*u)):y>n?_<n&&(u=l(s,h,A,p,g,n),a&&(s.start=d+c*u)):pe(s,h,A,f),_<r&&y>=r&&(u=l(s,h,A,p,g,r),v=!0),_>n&&y<=n&&(u=l(s,h,A,p,g,n),v=!0),!o&&v&&(a&&(s.end=d+c*u),t.push(s),s=Ae(e)),a&&(d+=c)}let h=e.length-3;const A=e[h],f=e[h+1],p=0===i?A:f;p>=r&&p<=n&&pe(s,A,f,e[h+2]),h=s.length-3,o&&h>=3&&(s[h]!==s[0]||s[h+1]!==s[1])&&pe(s,s[0],s[1],s[2]),s.length&&t.push(s)}function Ae(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function fe(e,t,r,n,i,o){for(const a of e)he(a,t,r,n,i,o,!1)}function pe(e,t,r,n){e.push(t,r,n)}function me(e,t,r,n,i,o){const a=(o-t)/(n-t);return pe(e,o,r+(i-r)*a,1),a}function ge(e,t,r,n,i,o){const a=(o-r)/(i-r);return pe(e,t+(n-t)*a,o,1),a}function ye(e,t){const r=[];for(let n=0;n<e.length;n++){const i=e[n],o=i.type;let a;if("Point"===o||"MultiPoint"===o||"LineString"===o)a=_e(i.geometry,t);else if("MultiLineString"===o||"Polygon"===o){a=[];for(const e of i.geometry)a.push(_e(e,t))}else if("MultiPolygon"===o){a=[];for(const e of i.geometry){const r=[];for(const n of e)r.push(_e(n,t));a.push(r)}}r.push(re(i.id,o,a,i.tags))}return r}function _e(e,t){const r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(let n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function ve(e,t){if(e.transformed)return e;const r=1<<e.z,n=e.x,i=e.y;for(const o of e.features){const e=o.geometry,a=o.type;if(o.geometry=[],1===a)for(let s=0;s<e.length;s+=2)o.geometry.push(xe(e[s],e[s+1],t,r,n,i));else for(let s=0;s<e.length;s++){const a=[];for(let o=0;o<e[s].length;o+=2)a.push(xe(e[s][o],e[s][o+1],t,r,n,i));o.geometry.push(a)}}return e.transformed=!0,e}function xe(e,t,r,n,i,o){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-o))]}function we(e,t,r,n,i){const o=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const s of e)be(a,s,o,i);return a}function be(e,t,r,n){const i=t.geometry,o=t.type,a=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===o||"MultiPoint"===o)for(let s=0;s<i.length;s+=3)a.push(i[s],i[s+1]),e.numPoints++,e.numSimplified++;else if("LineString"===o)Be(a,i,e,r,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(let s=0;s<i.length;s++)Be(a,i[s],e,r,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(let s=0;s<i.length;s++){const t=i[s];for(let n=0;n<t.length;n++)Be(a,t[n],e,r,!0,0===n)}if(a.length){let r=t.tags||null;if("LineString"===o&&n.lineMetrics){r={};for(const e in t.tags)r[e]=t.tags[e];r.mapbox_clip_start=i.start/i.size,r.mapbox_clip_end=i.end/i.size}const s={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:r};null!==t.id&&(s.id=t.id),e.features.push(s)}}function Be(e,t,r,n,i,o){const a=n*n;if(n>0&&t.size<(i?a:n))return void(r.numPoints+=t.length/3);const s=[];for(let l=0;l<t.length;l+=3)(0===n||t[l+2]>a)&&(r.numSimplified++,s.push(t[l],t[l+1])),r.numPoints++;i&&function(e,t){let r=0;for(let n=0,i=e.length,o=i-2;n<i;o=n,n+=2)r+=(e[n]-e[o])*(e[n+1]+e[o+1]);if(r>0===t)for(let n=0,i=e.length;n<i/2;n+=2){const t=e[n],r=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=t,e[i-1-n]=r}}(s,o),e.push(s)}const Ce={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Ee{constructor(e,t){const r=(t=this.options=function(e,t){for(const r in t)e[r]=t[r];return e}(Object.create(Ce),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let n=function(e,t){const r=[];if("FeatureCollection"===e.type)for(let n=0;n<e.features.length;n++)ie(r,e.features[n],t,n);else ie(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(e,t){const r=t.buffer/t.extent;let n=e;const i=ue(e,1,-1-r,r,0,-1,2,t),o=ue(e,1,1-r,2+r,0,-1,2,t);return(i||o)&&(n=ue(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=ye(i,1).concat(n)),o&&(n=n.concat(ye(o,-1)))),n}(n,t),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,r,n,i,o,a){const s=[e,t,r,n],l=this.options,c=l.debug;for(;s.length;){n=s.pop(),r=s.pop(),t=s.pop(),e=s.pop();const u=1<<t,d=Se(t,r,n);let h=this.tiles[d];if(!h&&(c>1&&console.time("creation"),h=this.tiles[d]=we(e,t,r,n,l),this.tileCoords.push({z:t,x:r,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));const e="z".concat(t);this.stats[e]=(this.stats[e]||0)+1,this.total++}if(h.source=e,null==i){if(t===l.indexMaxZoom||h.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===i)continue;if(null!=i){const e=i-t;if(r!==o>>e||n!==a>>e)continue}}if(h.source=null,0===e.length)continue;c>1&&console.time("clipping");const A=.5*l.buffer/l.extent,f=.5-A,p=.5+A,m=1+A;let g=null,y=null,_=null,v=null,x=ue(e,u,r-A,r+p,0,h.minX,h.maxX,l),w=ue(e,u,r+f,r+m,0,h.minX,h.maxX,l);e=null,x&&(g=ue(x,u,n-A,n+p,1,h.minY,h.maxY,l),y=ue(x,u,n+f,n+m,1,h.minY,h.maxY,l),x=null),w&&(_=ue(w,u,n-A,n+p,1,h.minY,h.maxY,l),v=ue(w,u,n+f,n+m,1,h.minY,h.maxY,l),w=null),c>1&&console.timeEnd("clipping"),s.push(g||[],t+1,2*r,2*n),s.push(y||[],t+1,2*r,2*n+1),s.push(_||[],t+1,2*r+1,2*n),s.push(v||[],t+1,2*r+1,2*n+1)}}getTile(e,t,r){e=+e,t=+t,r=+r;const n=this.options,{extent:i,debug:o}=n;if(e<0||e>24)return null;const a=1<<e,s=Se(e,t=t+a&a-1,r);if(this.tiles[s])return ve(this.tiles[s],i);o>1&&console.log("drilling down to z%d-%d-%d",e,t,r);let l,c=e,u=t,d=r;for(;!l&&c>0;)c--,u>>=1,d>>=1,l=this.tiles[Se(c,u,d)];return l&&l.source?(o>1&&(console.log("found parent tile z%d-%d-%d",c,u,d),console.time("drilling down")),this.splitTile(l.source,c,u,d,e,t,r),o>1&&console.timeEnd("drilling down"),this.tiles[s]?ve(this.tiles[s],i):null):null}}function Se(e,t,r){return 32*((1<<e)*r+t)+e}function Te(t,r){const n=t.tileID.canonical;if(!this._geoJSONIndex)return void r(null,null);const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return void r(null,null);const o=e=>e.tags&&"3d_elevation_id"in e.tags&&"source"in e.tags&&"elevation"===e.tags.source,a=i.features.filter(e=>o(e));let s={_geojsonTileLayer:i.features};a.length>0&&(s={_geojsonTileLayer:i.features.filter(e=>!o(e)),hd_road_elevation:a});const l=new b(s),c=function(t){const r=new e.bt;for(const e of Object.keys(t))r.writeMessage(3,L,{name:e,features:t[e]});return r.finish()}(s).buffer;r(null,{vectorTile:l,rawData:c})}class Ie extends m{constructor(e,t,r,n,i,o,a){super(e,t,r,n,i,Te,a),o&&(this.loadGeoJSON=o),this._dynamicIndex=new E}loadData(r,n){const i=r&&r.request,o=i&&i.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(r,(a,s)=>{if(a||!s)return n(a);if("object"!=typeof s)return n(new Error("Input data given to '".concat(r.source,"' is not a valid GeoJSON object.")));{try{if(r.filter){const t=e.U(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));s.features=s.features.filter(e=>t.value.evaluate({zoom:0},e))}r.dynamic?("Feature"===s.type&&(s={type:"FeatureCollection",features:[s]}),r.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(s.features,this.loaded),r.cluster&&(s.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=r.cluster?new q(function(t){let{superclusterOptions:r,clusterProperties:n}=t;if(!n||!r)return r;const i={},o={},a={accumulated:null,zoom:0},s={properties:null},l=Object.keys(n);for(const c of l){const[t,r]=n[c],a=e.U(r),s=e.U("string"==typeof t?[t,["accumulated"],["get",c]]:t);i[c]=a.value,o[c]=s.value}return r.map=e=>{s.properties=e;const t={};for(const r of l)t[r]=i[r].evaluate(a,s);return t},r.reduce=(e,t)=>{s.properties=t;for(const r of l)a.accumulated=e[r],e[r]=o[r].evaluate(a,s)},r}(r)).load(s.features):r.dynamic?this._dynamicIndex:function(e,t){return new Ee(e,t)}(s,r.geojsonVtOptions)}catch(e){return n(e)}const a={};if(o){const e=t(i);e&&(a.resourceTiming={},a.resourceTiming[r.source]=JSON.parse(JSON.stringify(e)))}n(null,a)}})}reloadTile(e,t){const r=this.loaded;return r&&r[e.uid]?e.partial?t(null,void 0):super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,r){if(t.request)e.m(t.request,r);else{if("string"!=typeof t.data)return r(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));setTimeout(()=>{try{return r(null,JSON.parse(t.data))}catch(e){return r(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")))}},0)}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class Fe{constructor(t,r,n){this.tileID=new e.aQ(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=r,this.worldview=n}parse(t,r,n,i){this.status="parsing";const o=new e.aQ(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),a=[],s=r.familiesBySource[n.source],l=new e.fn(o,n.promoteId);l.bucketLayerIDs=[],l.is3DTile=!0,e.fC(t).then(t=>{if(!t)return i(new Error("Could not parse tile"));const r=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),u=new e.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const i in s)for(const d of s[i]){const i=d[0];l.bucketLayerIDs.push(d.map(t=>e.B(t.id,t.scope))),i.recalculate(u,[]);const s=e.fD(t,1/e.d7(n.tileID.canonical)),h=new e.fE(d,s,o,r,c,this.brightness,l,this.worldview);r||(h.needsUpload=!0),a.push(h),h.evaluate(i)}this.status="done",i(null,{buckets:a,featureIndex:l,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(e=>i(new Error(e.message)))}}class ke{constructor(e,t,r,n,i,o,a,s){this.actor=e,this.layerIndex=t,this.availableImages=r,this.availableModels=n,this.brightness=a,this.loading={},this.loaded={},this.worldview=s}loadTile(t,r){const n=t.uid,i=this.loading[n]=new Fe(t,this.brightness,this.worldview);e.bu(t.request,(e,o)=>{const a=!this.loading[n];return delete this.loading[n],a||e?(i.status="done",a||(this.loaded[n]=i),r(e)):o&&0!==o.byteLength?void i.parse(o,this.layerIndex,t,(e,t)=>{i.status="done",this.loaded=this.loaded||{},this.loaded[n]=i,e||!t?r(e):r(null,t)}):(i.status="done",this.loaded[n]=i,r())})}reloadTile(e,t){const r=this.loaded,n=e.uid;if(r&&r[n]){const i=r[n];i.projection=e.projection,i.brightness=e.brightness;const o=(r,n)=>{i.reloadCallback&&(delete i.reloadCallback,this.loadTile(e,t)),t(r,n)};"parsing"===i.status?i.reloadCallback=o:"done"===i.status&&this.loadTile(e,t)}}abortTile(e,t){const r=e.uid;this.loading[r]&&delete this.loading[r],t()}removeTile(e,t){const r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],t()}}class Pe{constructor(t){this.self=t,this.actor=new e.fG(t,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new e.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=e.cm({name:"mercator"}),this.workerSourceTypes={vector:m,geojson:Ie,"raster-dem":g,"raster-array":_,"batched-model":ke},this.workerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.fH.isParsed())throw new Error("RTL text plugin already registered.");e.fH.setState({pluginStatus:e.fI.parsed,pluginURL:e.fH.getPluginURL()}),e.fH.applyArabicShaping=t.applyArabicShaping,e.fH.processBidirectionalText=t.processBidirectionalText,e.fH.processStyledBidirectionalText=t.processStyledBidirectionalText;for(const e of this.rtlPluginParsingListeners)e(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.availableModels[e],delete this.workerSources[e],r()}checkIfReady(e,t,r){r()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,r){this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={});const{scope:n,isLoaded:i}=r;if(this.isSpriteLoaded[t][n]=i,this.workerSources[t]&&this.workerSources[t][n])for(const o in this.workerSources[t][n]){const r=this.workerSources[t][n][o];for(const t in r){const n=r[t];n instanceof m&&(n.isSpriteLoaded=i,n.fire(new e.z("isSpriteLoaded")))}}}setImages(e,t,r){this.availableImages[e]||(this.availableImages[e]={});const{scope:n,images:i}=t;if(this.availableImages[e][n]=i,this.workerSources[e]&&this.workerSources[e][n]){for(const t in this.workerSources[e][n]){const r=this.workerSources[e][n][t];for(const e in r)r[e].availableImages=i}r()}else r()}setModels(e,t,r){let{scope:n,models:i}=t;if(this.availableModels[e]||(this.availableModels[e]={}),this.availableModels[e][n]=i,this.workerSources[e]&&this.workerSources[e][n]){for(const t in this.workerSources[e][n]){const r=this.workerSources[e][n][t];for(const e in r)r[e].availableModels=i}r()}else r()}setProjection(t,r){this.projections[t]=e.cm(r)}setBrightness(e,t,r){this.brightness=t,r()}setWorldview(e,t,r){this.worldview=t,r()}setLayers(e,t,r){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),r()}updateLayers(e,t,r){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),r()}loadTile(e,t,r){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,r)}decodeRasterArray(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).decodeRasterArray(t,r)}reloadTile(e,t,r){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,r)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,r)}removeSource(e,t,r){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const n=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,r):r()}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e)}}syncRTLPluginState(t,r,n){if(e.fH.isParsed())n(null,!0);else if(e.fH.isParsing())this.rtlPluginParsingListeners.push(n);else try{e.fH.setState(r);const t=e.fH.getPluginURL();!e.fH.isLoaded()||e.fH.isParsed()||e.fH.isParsing()||null==t||(e.fH.setState({pluginStatus:e.fI.parsing,pluginURL:e.fH.getPluginURL()}),this.self.importScripts(t),e.fH.isParsed()?n(null,!0):this.rtlPluginParsingListeners.push(n))}catch(e){n(e)}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let r=this.availableImages[e][t];return r||(r=[]),r}getAvailableModels(e,t){this.availableModels[e]||(this.availableModels[e]={});let r=this.availableModels[e][t];return r||(r={}),r}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let r=this.layerIndexes[e][t];return r||(r=this.layerIndexes[e][t]=new i,r.scope=t),r}getWorkerSource(e,t,r,n){const i=this.workerSources;return i[e]||(i[e]={}),i[e][n]||(i[e][n]={}),i[e][n][t]||(i[e][n][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),i[e][n][t][r]||(i[e][n][t][r]=new this.workerSourceTypes[t]({send:(t,r,n,i,o,a)=>this.actor.send(t,r,n,e,o,a),scheduler:this.actor.scheduler},this.getLayerIndex(e,n),this.getAvailableImages(e,n),this.getAvailableModels(e,n),this.isSpriteLoaded[e][n],void 0,this.brightness,this.worldview)),i[e][n][t][r]}rasterizeImagesWorker(e,t,r){const n=new Map;for(const[i,{image:o,imageVariant:a}]of t.tasks.entries()){const r=this.imageRasterizer.rasterize(a,o,t.scope,e);n.set(i,r)}r(void 0,n)}removeRasterizedImages(e,t,r){this.imageRasterizer.removeImagesFromCacheByIds(t.imageIds,t.scope,e),r()}enforceCacheSizeLimit(t,r){e.fJ(r)}getWorkerPerformanceMetrics(e,t,r){r(void 0,void 0)}}return e.fF(self)&&(self.worker=new Pe(self)),Pe}),a(["./shared"],function(e){var t="3.17.0";const r={create:"create",load:"load",fullLoad:"fullLoad"},a={mark(e){performance.mark(e)},measure(e,t,r){performance.measure(e,t,r)}};function s(t){const r=t.name.split("?")[0];return e.a(r)&&r.includes("mapbox-gl.js")?"javascript":e.a(r)&&r.includes("mapbox-gl.css")?"css":e.b(r)?"fontRange":e.c(r)?"sprite":e.i(r)?"style":e.d(r)?"tilejson":"other"}var l,c={},u=function(){if(l)return c;function e(e){return!t(e)}function t(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,r=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(r);try{t=new Worker(n),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(n),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var r=t.getImageData(0,0,1,1);return r&&r.width===e.width}()?(void 0===r[n=t&&t.failIfMajorPerformanceCaveat]&&(r[n]=function(t){var r,n=function(t){var r=document.createElement("canvas"),n=Object.create(e.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,r.getContext("webgl2",n)}(t);if(!n)return!1;try{r=n.createShader(n.VERTEX_SHADER)}catch(e){return!1}return!(!r||n.isContextLost())&&(n.shaderSource(r,"void main() {}"),n.compileShader(r),!0===n.getShaderParameter(r,n.COMPILE_STATUS))}(n)),r[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var n}l=1,c.supported=e,c.notSupportedReason=t;var r={};return e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},c}();function d(e,t,r){const n=document.createElement(e);return null!=t&&(n.className=t),r&&r.appendChild(n),n}function h(e,t,r){const n=document.createElementNS("http://www.w3.org/2000/svg",e);for(const i of Object.keys(t))n.setAttributeNS(null,i,String(t[i]));return r&&r.appendChild(n),n}const A="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,f=A&&void 0!==A.userSelect?"userSelect":"WebkitUserSelect";let p;function m(){A&&f&&(p=A[f],A[f]="none")}function g(){A&&f&&(A[f]=p)}function y(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",y,!0)}function _(){window.addEventListener("click",y,!0),window.setTimeout(()=>{window.removeEventListener("click",y,!0)},0)}function v(e,t){const r=e.getBoundingClientRect();return b(e,r,t)}function x(e,t){const r=e.getBoundingClientRect(),n=[];for(let i=0;i<t.length;i++)n.push(b(e,r,t[i]));return n}function w(e){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===e.button&&e.ctrlKey?0:e.button}function b(t,r,n){const i=t.offsetWidth===r.width?1:t.offsetWidth/r.width;return new e.P((n.clientX-r.left)*i,(n.clientY-r.top)*i)}const B="01",C="NO_ACCESS_TOKEN";class E{constructor(e,t,r){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",B,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(r,n){if(!e.h(r))return r;const i=T(r);return i.params.push("sdk=js-".concat(t)),i.path="/styles/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||n)}normalizeGlyphsURL(t,r){if(!e.h(t))return t;const n=T(t);return n.path="/fonts/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||r)}normalizeModelURL(t,r){if(!e.h(t))return t;const n=T(t);return n.path="/models/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||r)}normalizeSourceURL(t,r,n,i){if(!e.h(t))return t;const o=T(t);return o.path="/v4/".concat(o.authority,".json"),o.params.push("secure"),n&&o.params.push("language=".concat(n)),i&&o.params.push("worldview=".concat(i)),this._makeAPIURL(o,this._customAccessToken||r)}normalizeIconsetURL(t,r){const n=T(t);return e.h(t)?(n.path="/styles/v1".concat(n.path,"/iconset.pbf"),this._makeAPIURL(n,this._customAccessToken||r)):I(n)}normalizeSpriteURL(t,r,n,i){const o=T(t);return e.h(t)?(o.path="/styles/v1".concat(o.path,"/sprite").concat(r).concat(n),this._makeAPIURL(o,this._customAccessToken||i)):(o.path+="".concat(r).concat(n),I(o))}normalizeTileURL(t,r,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!e.h(t))return t;const i=T(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(r||n&&"raster"!==i.authority&&512===n?"@2x":"").concat(e.k.supported?".webp":"$1")),"raster"===i.authority?i.path="/".concat(e.e.RASTER_URL_PREFIX).concat(i.path):"rasterarrays"===i.authority?i.path="/".concat(e.e.RASTERARRAYS_URL_PREFIX).concat(i.path):"3dtiles"===i.authority?i.path="/".concat(e.e.TILES3D_URL_PREFIX).concat(i.path):(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path="/".concat(e.e.TILE_URL_VERSION).concat(i.path));const o=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(i.params)||e.e.ACCESS_TOKEN;return e.e.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&i.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(i,o)}canonicalizeTileURL(t,r){const n=T(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let i="mapbox://";n.path.match(/^\/raster\/v1\//)?i+="raster/".concat(n.path.replace("/".concat(e.e.RASTER_URL_PREFIX,"/"),"")):n.path.match(/^\/rasterarrays\/v1\//)?i+="rasterarrays/".concat(n.path.replace("/".concat(e.e.RASTERARRAYS_URL_PREFIX,"/"),"")):i+="tiles/".concat(n.path.replace("/".concat(e.e.TILE_URL_VERSION,"/"),""));let o=n.params;return r&&(o=o.filter(e=>!e.match(/^access_token=/))),o.length&&(i+="?".concat(o.join("&"))),i}canonicalizeTileset(t,r){const n=!!r&&e.h(r),i=[];for(const o of t.tiles||[])e.j(o)?i.push(this.canonicalizeTileURL(o,n)):i.push(o);return i}_makeAPIURL(t,r){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=T(e.e.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==i.path&&(t.path="".concat(i.path).concat(t.path)),!e.e.REQUIRE_ACCESS_TOKEN)return I(t);if(r=r||e.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error("An API access token is required to use Mapbox GL. ".concat(n));if("s"===r[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(n))}return t.params=t.params.filter(e=>-1===e.indexOf("access_token")),t.params.push("access_token=".concat(r||"")),I(t)}}const S=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function T(e){const t=e.match(S);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function I(e){const t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}const F="mapbox.eventData";function k(t){if(!t)return null;const r=t.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(e.l(r[1]))}catch(e){return null}}class P{constructor(e){this.type=e,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=k(e.e.ACCESS_TOKEN);let n="";return n=r&&r.u?e.f(r.u):e.e.ACCESS_TOKEN||"",t?"".concat(F,".").concat(t,":").concat(n):"".concat(F,":").concat(n)}fetchEventData(){const t=e.s("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid"),i=this.getStorageKey("uuidTimestamp");if(t)try{const e=localStorage.getItem(r);e&&(this.eventData=JSON.parse(e));const t=localStorage.getItem(n);t&&(this.anonId=t);const o=localStorage.getItem(i);o&&(this.anonIdTimestamp=Number(o));const a=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<a)&&this.refreshUUID()}catch(t){e.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=e.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=e.s("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid"),i=this.getStorageKey("uuidTimestamp"),o=this.anonId,a=this.anonIdTimestamp;if(t&&o)try{localStorage.setItem(n,o),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData)),a&&localStorage.setItem(i,a.toString())}catch(t){e.w("Unable to write to LocalStorage")}}processRequests(e){}postEvent(t,r,n,i){if(!e.e.EVENTS_URL)return;const o=T(e.e.EVENTS_URL);o.params.push("access_token=".concat(i||e.e.ACCESS_TOKEN||""));const a={event:this.type,created:new Date(t).toISOString()},s=r?Object.assign(a,r):a,l={url:I(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=e.p(l,e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(i)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}class M extends P{constructor(e){super("metrics"),e&&(this.data=e)}postMetricsEvent(t){if(!e.e.EVENTS_URL||!t&&!e.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),e.v(this.anonId)||this.refreshUUID();const r=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:r},t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},e)}}const O=new class extends P{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(t,r){e.e.EVENTS_URL&&e.e.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>e.h(t)||e.j(t))&&this.queueRequest(Date.now(),r)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=k(e.e.ACCESS_TOKEN),i=n?n.u:e.e.ACCESS_TOKEN;let o=i!==this.eventData.tokenU;e.v(this.anonId)||(this.refreshUUID(),o=!0);const a=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(a),r=(a-this.eventData.lastSuccess)/864e5;o=o||r>=1||r<-1||e.getDate()!==t.getDate()}else o=!0;o?this.postEvent(a,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:B,"enabled.telemetry":!1,userId:this.anonId},e=>{e||(this.eventData.lastSuccess=a,this.eventData.tokenU=i)},r):this.processRequests()}},L=O.postTurnstileEvent.bind(O),D=new class extends P{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,r,n,i){this.skuToken=r,this.errorCb=i,e.e.EVENTS_URL&&(n||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(C)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:n,timestamp:i}=this.queue.shift();n&&this.success[n]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),e.v(this.anonId)||this.refreshUUID(),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:B,skuToken:this.skuToken,userId:this.anonId},e=>{e?this.errorCb(e):n&&(this.success[n]=!0)},r))}remove(){this.errorCb=null}},U=D.postMapLoadEvent.bind(D),R=new class extends P{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let r=this.mapInstanceIdMap.get(t);return r||(r=e.u(),this.mapInstanceIdMap.set(t,r)),r}getEventId(e){const t=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,t+1),t}postStyleLoadEvent(t,r){const{map:n,style:i,importedStyles:o}=r;if(!e.e.EVENTS_URL||!t&&!e.e.ACCESS_TOKEN)return;const a=this.getMapInstanceId(n),s={mapInstanceId:a,eventId:this.getEventId(a),style:i};o.length&&(s.importedStyles=o),this.queueRequest({timestamp:Date.now(),payload:s},t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},e)}},z=R.postStyleLoadEvent.bind(R),N=new M({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),j=N.postMetricsEvent.bind(N),Q=new M({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),V=Q.postMetricsEvent.bind(Q),H=new class extends P{constructor(){super("gljs.performance")}postPerformanceEvent(t,r){e.e.EVENTS_URL&&(t||e.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},t)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:o}=this.queue.shift(),a=function(n){const i=performance.getEntriesByType("resource"),o=performance.getEntriesByType("mark"),a=function(e){const t={};if(e)for(const r in e)if("other"!==r)for(const n of e[r]){const e="".concat(r,"ResolveRangeMin"),i="".concat(r,"ResolveRangeMax"),o="".concat(r,"RequestCount"),a="".concat(r,"RequestCachedCount");t[e]=Math.min(t[e]||1/0,n.startTime),t[i]=Math.max(t[i]||-1/0,n.responseEnd);const s=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==n.transferSize&&0===n.transferSize&&s(a),s(o)}return t}(function(e,t){const r={};if(e)for(const n of e){const e=t(n);void 0===r[e]&&(r[e]=[]),r[e].push(n)}return r}(i,s)),l=window.devicePixelRatio,c=navigator.connection||navigator.mozConnection||navigator.webkitConnection,u=c?c.effectiveType:void 0,d={counters:[],metadata:[],attributes:[]},h=(e,t,r)=>{null!=r&&e.push({name:t,value:r.toString()})};for(const e in a)h(d.counters,e,a[e]);if(n.interactionRange[0]!==1/0&&n.interactionRange[1]!==-1/0&&(h(d.counters,"interactionRangeMin",n.interactionRange[0]),h(d.counters,"interactionRangeMax",n.interactionRange[1])),o)for(const e of Object.values(r)){const t=o.find(t=>t.name===e);t&&h(d.counters,e,t.startTime)}return h(d.counters,"visibilityHidden",n.visibilityHidden),h(d.attributes,"style",function(t){if(t)for(const r of t){const t=r.name.split("?")[0];if(e.i(t)){const e=t.split("/").slice(-2);if(2===e.length)return"mapbox://styles/".concat(e[0],"/").concat(e[1])}}}(i)),h(d.attributes,"terrainEnabled",n.terrainEnabled?"true":"false"),h(d.attributes,"fogEnabled",n.fogEnabled?"true":"false"),h(d.attributes,"projection",n.projection),h(d.attributes,"zoom",n.zoom),h(d.metadata,"devicePixelRatio",l),h(d.metadata,"connectionEffectiveType",u),h(d.metadata,"navigatorUserAgent",navigator.userAgent),h(d.metadata,"screenWidth",window.screen.width),h(d.metadata,"screenHeight",window.screen.height),h(d.metadata,"windowWidth",window.innerWidth),h(d.metadata,"windowHeight",window.innerHeight),h(d.metadata,"mapWidth",n.width/l),h(d.metadata,"mapHeight",n.height/l),h(d.metadata,"webglRenderer",n.renderer),h(d.metadata,"webglVendor",n.vendor),h(d.metadata,"sdkVersion",t),h(d.metadata,"sdkIdentifier","mapbox-gl-js"),d}(o);for(const e of a.metadata);for(const e of a.counters);for(const e of a.attributes);this.postEvent(i,a,()=>{},n)}},G=H.postPerformanceEvent.bind(H),K=new class extends P{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,r,n,i){if(!e.e.API_URL||!e.e.SESSION_PATH)return;const o=T(e.e.API_URL+e.e.SESSION_PATH);o.params.push("sku=".concat(r||"")),o.params.push("access_token=".concat(i||e.e.ACCESS_TOKEN||""));const a={url:I(o),headers:{"Content-Type":"text/plain"}};this.pendingRequest=e.g(a,e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(i)})}getSessionAPI(t,r,n,i){this.skuToken=r,this.errorCb=i,e.e.SESSION_PATH&&e.e.API_URL&&(n||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(C)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e)}remove(){this.errorCb=null}},W=K.getSessionAPI.bind(K),q=new Set;function Z(e,t){t?q.add(e):q.delete(e)}class X{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(e){return this._updatedImages[e]?Array.from(this._updatedImages[e].values()):[]}updateImage(t,r){this._updatedImages[r]=this._updatedImages[r]||new Set,this._updatedImages[r].add(e.I.toString(t)),this.setDirty()}resetUpdatedImages(e){this._updatedImages[e]&&this._updatedImages[e].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Y(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class J extends e.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,"raster"!==t&&e.r()&&(this.imageRasterizerDispatcher=new e.D(e.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new e.q({width:1,height:1}))}removeScope(e){this.loaded.delete(e),this.imageProviders.delete(e),this.images.delete(e),this.updatedImages.delete(e),this.callbackDispatchedThisFrame.delete(e),this.patterns.delete(e),this.atlasImage.delete(e);const t=this.atlasTexture.get(e);t&&(t.destroy(),this.atlasTexture.delete(e))}addImageProvider(e,t){this.imageProviders.has(t)||this.imageProviders.set(t,new Map),this.imageProviders.get(t).set(e.id,e)}removeImageProvider(e,t){this.imageProviders.has(t)&&this.imageProviders.get(t).delete(e)}getPendingImageProviders(){const e=[];for(const t of this.imageProviders.values())for(const r of t.values())r.hasPendingRequests()&&e.push(r);return e}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new e.x),this._imageRasterizer}isLoaded(){for(const e of this.loaded.keys())if(!this.loaded.get(e))return!1;return!0}setLoaded(e,t){if(this.loaded.get(t)!==e&&(this.loaded.set(t,e),e)){for(const{ids:e,callback:r}of this.requestors)this._notify(e,t,r);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images.get(t).get(e.toString())}addImage(e,t,r){this._validate(e,r)&&this.images.get(t).set(e.toString(),r)}_validate(t,r){let n=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new e.y(new Error('Image "'.concat(t.name,'" has invalid "stretchX" value')))),n=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new e.y(new Error('Image "'.concat(t.name,'" has invalid "stretchY" value')))),n=!1),this._validateContent(r.content,r)||(this.fire(new e.y(new Error('Image "'.concat(t.name,'" has invalid "content" value')))),n=!1),n}_validateStretch(e,t){if(!e)return!0;let r=0;for(const n of e){if(n[0]<r||n[1]<n[0]||t<n[1])return!1;r=n[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;if(!t.usvg){if(e[0]<0||t.data.width<e[0])return!1;if(e[1]<0||t.data.height<e[1])return!1;if(e[2]<0||t.data.width<e[2])return!1;if(e[3]<0||t.data.height<e[3])return!1}return!(e[2]<e[0]||e[3]<e[1])}updateImage(e,t,r){const n=this.images.get(t).get(e.toString());r.version=n.version+1,this.images.get(t).set(e.toString(),r),this.updatedImages.get(t).add(e),this.removeFromImageRasterizerCache(e,t)}clearUpdatedImages(e){this.updatedImages.get(e).clear()}removeFromImageRasterizerCache(t,r){"raster"!==this.spriteFormat&&(e.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([t],r))}removeImage(e,t){const r=this.images.get(t),n=r.get(e.toString());r.delete(e.toString()),this.patterns.get(t).delete(e.toString()),this.removeFromImageRasterizerCache(e,t),n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(t=>e.I.from(t))}getImages(e,t,r){const n=[],i=[],o=this.imageProviders.get(t);for(const c of e){if(!c.iconsetId){n.push(c);continue}const e=o.get(c.iconsetId);e&&(this.getImage(c,t)?i.push(c):e.addPendingRequest(c))}if(0===n.length)return void this._notify(i,t,r);let a=!0;const s=!!this.loaded.get(t),l=this.images.get(t);if(!s)for(const c of n)l.has(c.toString())||(a=!1);s||a?this._notify(n,t,r):this.requestors.push({ids:n,scope:t,callback:r})}rasterizeImages(e,t){const r=new Map,{tasks:n,scope:i}=e;for(const[o,a]of n.entries()){const e=this.getImage(a.id,i);e&&r.set(o,{image:e,imageVariant:a})}this._rasterizeImages(i,r,t)}_rasterizeImages(t,r,n){if(e.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:r,scope:t},n);else{const e=new Map;for(const[n,{image:i,imageVariant:o}]of r.entries())e.set(n,this.imageRasterizer.rasterize(o,i,t,0));n(void 0,e)}}getUpdatedImages(e){return this.updatedImages.get(e)||new Set}_notify(t,r,n){const i=this.images.get(r),o=new Map;for(const a of t){if(!i.get(a.toString())){if(a.iconsetId)continue;this.fire(new e.z("styleimagemissing",{id:a.name}))}const t=i.get(a.toString());if(!t){e.w('Image "'.concat(a.name,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'));continue}const r={data:t.usvg?null:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,usvg:t.usvg,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)};t.usvg&&Object.assign(r,{width:t.icon.usvg_tree.width,height:t.icon.usvg_tree.height}),o.set(e.I.toString(a),r)}n(null,o)}getPixelSize(e){const{width:t,height:r}=this.atlasImage.get(e);return{width:t,height:r}}getPattern(t,r,n){const i=t.toString(),o=this.patterns.get(r),a=o.get(i),s=this.getImage(t,r);if(!s)return null;if(a){if(a.position.version===s.version)return a.position;a.position.version=s.version}else{if(s.usvg&&!s.data){const o=this.getPatternInFlightId(i,r);if(this.patternsInFlight.has(o))return null;this.patternsInFlight.add(o);const a=new e.A(t).scaleSelf(e.o.devicePixelRatio),l=new Map([[a.toString(),{image:s,imageVariant:a}]]);return this._rasterizeImages(r,l,(e,t)=>this.storePatternImage(a,r,s,n,t)),null}this.storePattern(t,r,s)}return this._updatePatternAtlas(r,n),o.get(i).position}getPatternInFlightId(t,r){return e.B(t,r)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(e,t,r,n,i){const o=e.toString(),a=i?i.get(o):void 0;a&&(r.data=a,this.storePattern(e.id,t,r),this._updatePatternAtlas(t,n),this.patternsInFlight.delete(this.getPatternInFlightId(e.id.toString(),t)))}storePattern(t,r,n){const i={w:n.data.width+2*e.C,h:n.data.height+2*e.C,x:0,y:0},o=new e.F(i,n,e.C);this.patterns.get(r).set(t.toString(),{bin:i,position:o})}destroyAtlasTextures(){for(const e of this.atlasTexture.values())e&&e.destroy();this.atlasTexture.clear()}bind(t,r){const n=t.gl;let i=this.atlasTexture.get(r);i?this.dirty&&(i.update(this.atlasImage.get(r)),this.dirty=!1):(i=new e.T(t,this.atlasImage.get(r),n.RGBA8),this.atlasTexture.set(r,i)),i.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const n=this.patterns.get(t),i=Array.from(n.values()).map(e=>{let{bin:t}=e;return t}),{w:o,h:a}=e.G(i),s=this.atlasImage.get(t);s.resize({width:o||1,height:a||1});const l=this.images.get(t);for(const[c,{bin:u,position:d}]of n.entries()){let t=d.padding;const n=u.x+t,i=u.y+t,o=l.get(c).data,a=o.width,h=o.height;t=t>1?t-1:t,e.q.copy(o,s,{x:0,y:0},{x:n,y:i},{width:a,height:h},r),e.q.copy(o,s,{x:0,y:h-t},{x:n,y:i-t},{width:a,height:t},r),e.q.copy(o,s,{x:0,y:0},{x:n,y:i+h},{width:a,height:t},r),e.q.copy(o,s,{x:a-t,y:0},{x:n-t,y:i},{width:t,height:h},r),e.q.copy(o,s,{x:0,y:0},{x:n+a,y:i},{width:t,height:h},r),e.q.copy(o,s,{x:a-t,y:h-t},{x:n-t,y:i-t},{width:t,height:t},r),e.q.copy(o,s,{x:0,y:h-t},{x:n+a,y:i-t},{width:t,height:t},r),e.q.copy(o,s,{x:0,y:0},{x:n+a,y:i+h},{width:t,height:t},r),e.q.copy(o,s,{x:a-t,y:0},{x:n-t,y:i+h},{width:t,height:t},r)}this.dirty=!0}beginFrame(){for(const e of this.images.keys())this.callbackDispatchedThisFrame.set(e,new Set)}dispatchRenderCallbacks(e,t){const r=this.images.get(t);for(const n of e){if(this.callbackDispatchedThisFrame.get(t).has(n.toString()))continue;this.callbackDispatchedThisFrame.get(t).add(n.toString());const e=r.get(n.toString());Y(e)&&this.updateImage(n,t,e)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function $(t){const r=t.value,n=t.valueSpec,i=t.style,o=t.styleSpec,a=t.key,s=t.arrayElementValidator||xe;if(!Array.isArray(r))return[new e.V(a,r,"array expected, ".concat(e.K(r)," found"))];if(n.length&&r.length!==n.length)return[new e.V(a,r,"array length ".concat(n.length," expected, length ").concat(r.length," found"))];if(n["min-length"]&&r.length<n["min-length"])return[new e.V(a,r,"array length at least ".concat(n["min-length"]," expected, length ").concat(r.length," found"))];let l={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};o.$version<7&&(l.function=n.function),e.H(n.value)&&(l=n.value);let c=[];for(let e=0;e<r.length;e++)c=c.concat(s({array:r,arrayIndex:e,value:r[e],valueSpec:l,style:i,styleSpec:o,key:"".concat(a,"[").concat(e,"]")},!0));return c}function ee(t){const r=t.key,n=t.value,i=t.valueSpec;if(!e.L(n))return[new e.V(r,n,"number expected, ".concat(e.K(n)," found"))];if(n!=n)return[new e.V(r,n,"number expected, NaN found")];if("minimum"in i){let o=i.minimum;if(Array.isArray(i.minimum)&&(o=i.minimum[t.arrayIndex]),n<o)return[new e.V(r,n,"".concat(n," is less than the minimum value ").concat(o))]}if("maximum"in i){let o=i.maximum;if(Array.isArray(i.maximum)&&(o=i.maximum[t.arrayIndex]),n>o)return[new e.V(r,n,"".concat(n," is greater than the maximum value ").concat(o))]}return[]}function te(t){const r=t.key,n=t.value;if(!e.H(n))return[new e.V(r,n,"object expected, ".concat(e.K(n)," found"))];const i=t.valueSpec,o=e.J(n.type);let a,s,l,c={};const u="categorical"!==o&&void 0===n.property,d=!u,h=function(t){const r=t.stops;return Array.isArray(r)&&Array.isArray(r[0])&&e.H(r[0][0])}(n),A=we({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new e.V(t.key,t.value,'identity function may not have a "stops" property')];let r=[];const n=t.value;return r=r.concat($({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:f})),Array.isArray(n)&&0===n.length&&r.push(new e.V(t.key,n,"array must have at least one stop")),r},default:function(e){return xe({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===o&&u&&A.push(new e.V(t.key,t.value,'missing required property "property"')),"identity"===o||n.stops||A.push(new e.V(t.key,t.value,'missing required property "stops"')),"exponential"===o&&i.expression&&!e.M(i)&&A.push(new e.V(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(d&&!e.N(i)?A.push(new e.V(t.key,t.value,"property functions not supported")):u&&!e.O(i)&&A.push(new e.V(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!h||void 0!==n.property||A.push(new e.V(t.key,t.value,'"property" property is required')),A;function f(t){let r=[];const n=t.value,o=t.key;if(!Array.isArray(n))return[new e.V(o,n,"array expected, ".concat(e.K(n)," found"))];if(2!==n.length)return[new e.V(o,n,"array length 2 expected, length ".concat(n.length," found"))];if(h){if(!e.H(n[0]))return[new e.V(o,n,"object expected, ".concat(e.K(n[0])," found"))];const i=n[0];if(void 0===i.zoom)return[new e.V(o,n,"object stop key must have zoom")];if(void 0===i.value)return[new e.V(o,n,"object stop key must have value")];const a=e.J(i.zoom);if("number"!=typeof a)return[new e.V(o,i.zoom,"stop zoom values must be numbers")];if(l&&l>a)return[new e.V(o,i.zoom,"stop zoom values must appear in ascending order")];a!==l&&(l=a,s=void 0,c={}),r=r.concat(we({key:"".concat(o,"[0]"),value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:ee,value:p}}))}else r=r.concat(p({key:"".concat(o,"[0]"),value:n[0],style:t.style,styleSpec:t.styleSpec},n));return e.Q(e.S(n[1]))?r.concat([new e.V("".concat(o,"[1]"),n[1],"expressions are not allowed in function stops.")]):r.concat(xe({key:"".concat(o,"[1]"),value:n[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function p(t,r){const n=e.K(t.value),l=e.J(t.value),u=null!==t.value?t.value:r;if(a){if(n!==a)return[new e.V(t.key,u,"".concat(n," stop domain type must match previous stop domain type ").concat(a))]}else a=n;if("number"!==n&&"string"!==n&&"boolean"!==n&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new e.V(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==n&&"categorical"!==o){let r="number expected, ".concat(n," found");return e.N(i)&&void 0===o&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(t.key,u,r)]}return"categorical"!==o||"number"!==n||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==o&&"number"===n&&"number"==typeof l&&"number"==typeof s&&void 0!==s&&l<s?[new e.V(t.key,u,"stop domain values must appear in ascending order")]:(s=l,"categorical"===o&&l in c?[new e.V(t.key,u,"stop domain values must be unique")]:(c[l]=!0,[])):[new e.V(t.key,u,"integer expected, found ".concat(String(l)))]}}function re(t){const r=("property"===t.expressionContext?e.W:e.U)(e.S(t.value),t.valueSpec);if("error"===r.result)return r.value.map(r=>new e.V("".concat(t.key).concat(r.key),t.value,r.message));const n=r.value.expression||r.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new e.V(t.key,t.value,'Invalid data expression for "'.concat(t.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.Z(n))return[new e.V(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return ne(n,t);if("appearance"===t.expressionContext)return ie(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.X(n,["zoom","feature-state"]))return[new e.V(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e.Y(n))return[new e.V(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ne(t,r){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const e of r.valueSpec.expression.parameters)n.delete(e);if(0===n.size)return[];const i=[];return t instanceof e._&&n.has(t.name)?[new e.V(r.key,r.value,'["'.concat(t.name,'"] expression is not supported in a filter for a ').concat(r.object.type," layer with id: ").concat(r.object.id))]:(t.eachChild(e=>{i.push(...ne(e,r))}),i)}function ie(t,r){const n=new Set;if(r.valueSpec&&r.valueSpec.expression)for(const e of r.valueSpec.expression.parameters)n.add(e);if(0===n.size)return[];const i=[];return t instanceof e._&&!n.has(t.name)?[new e.V(r.key,r.value,'["'.concat(t.name,'"] is not an allowed parameter'))]:(t.eachChild(e=>{i.push(...ie(e,r))}),i)}function oe(t){const r=t.key,n=t.value,i=t.valueSpec,o=[];return Array.isArray(i.values)?-1===i.values.indexOf(e.J(n))&&o.push(new e.V(r,n,"expected one of [".concat(i.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(i.values).indexOf(e.J(n))&&o.push(new e.V(r,n,"expected one of [".concat(Object.keys(i.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),o}function ae(t){return e.a2(e.S(t.value))?re(Object.assign({},t,{expressionContext:"filter",valueSpec:t.styleSpec["filter_".concat(t.layerType||"fill")]})):se(t)}function se(t){const r=t.value,n=t.key;if(!Array.isArray(r))return[new e.V(n,r,"array expected, ".concat(e.K(r)," found"))];if(r.length<1)return[new e.V(n,r,"filter array must have at least 1 element")];const i=t.styleSpec;let o=oe({key:"".concat(n,"[0]"),value:r[0],valueSpec:i.filter_operator});const a=()=>{r.length>=2&&(e.a0(r[1])||o.push(new e.V("".concat(n,"[1]"),r[1],"string expected, ".concat(e.K(r[1])," found"))));for(let t=2;t<r.length;t++)"$type"===e.J(r[1])?o=o.concat(oe({key:"".concat(n,"[").concat(t,"]"),value:r[t],valueSpec:i.geometry_type})):e.a0(r[t])||e.L(r[t])||e.$(r[t])||o.push(new e.V("".concat(n,"[").concat(t,"]"),r[t],"string, number, or boolean expected, ".concat(e.K(r[t])," found.")))};switch(e.J(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===e.J(r[1])&&o.push(new e.V(n,r,'"$type" cannot be use with operator "'.concat(r[0],'"'))),3!==r.length&&o.push(new e.V(n,r,'filter array for operator "'.concat(r[0],'" must have 3 elements'))),a();break;case"==":case"!=":3!==r.length&&o.push(new e.V(n,r,'filter array for operator "'.concat(r[0],'" must have 3 elements'))),a();break;case"in":case"!in":a();break;case"any":case"all":case"none":for(let e=1;e<r.length;e++)o=o.concat(se({key:"".concat(n,"[").concat(e,"]"),value:r[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":2!==r.length?o.push(new e.V(n,r,'filter array for "'.concat(r[0],'" operator must have 2 elements'))):e.a0(r[1])||o.push(new e.V("".concat(n,"[1]"),r[1],"string expected, ".concat(e.K(r[1])," found")))}return o}function le(t,r){const n=t.key,i=t.style,o=t.layer,a=t.styleSpec,s=t.value,l=t.objectKey,c=a["".concat(r,"_").concat(t.layerType)];if(!c)return[];const u=l.match(/^(.*)-use-theme$/);if(u&&c[u[1]])return e.Q(e.S(s))?[].concat(xe({key:n,value:s,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:i,styleSpec:a,expressionContext:"property",propertyType:r,propertyKey:l})):xe({key:n,value:s,valueSpec:{type:"string"},style:i,styleSpec:a});const d=l.match(/^(.*)-transition$/);if("paint"===r&&d&&c[d[1]]&&c[d[1]].transition)return xe({key:n,value:s,valueSpec:a.transition,style:i,styleSpec:a});const h=t.valueSpec||c[l];if(!h)return[new e.a3(n,s,'unknown property "'.concat(l,'"'))];let A;if(e.a0(s)&&e.N(h)&&!h.tokens&&(A=/^{([^}]+)}$/.exec(s))){const t='`{ "type": "identity", "property": '.concat(A?JSON.stringify(A[1]):'"_"'," }`");return[new e.V(n,s,'"'.concat(l,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(t,"."))]}const f=[];if("symbol"===t.layerType)"text-field"!==l||!i||i.glyphs||i.imports||f.push(new e.V(n,s,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.a4(e.S(s))&&"identity"===e.J(s.type)&&f.push(new e.V(n,s,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===r&&o&&o.layout&&o.layout.hasOwnProperty("model-id")&&e.N(h)&&(e.a5(h)||e.O(h))){const t=e.W(e.S(s),h).value,r="expression"in t&&t.expression||"_styleExpression"in t&&t._styleExpression&&t._styleExpression.expression;r&&!e.X(r,["measure-light"])&&("model-emissive-strength"===l&&e.Y(r)&&e.Z(r)||f.push(new e.V(n,s,"".concat(l," does not support measure-light expressions when the model layer source is vector tile or GeoJSON."))))}return f.concat(xe({key:t.key,value:s,valueSpec:h,style:i,styleSpec:a,expressionContext:"property",propertyType:r,propertyKey:l}))}function ce(e){return le(e,"paint")}function ue(e){return le(e,"layout")}function de(t){let r=[];const n=t.value,i=t.key,o=t.style,a=t.styleSpec;if(!e.H(n))return[new e.V(i,n,"object expected")];n.type||n.ref||r.push(new e.V(i,n,'either "type" or "ref" is required'));let s=e.J(n.type);const l=e.J(n.ref);if(n.id){const a=e.J(n.id);for(let s=0;s<t.arrayIndex;s++){const t=o.layers[s];e.J(t.id)===a&&r.push(new e.V(i,n.id,'duplicate layer id "'.concat(a,'", previously used at line ').concat(t.id.__line__)))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in n&&r.push(new e.V(i,n[t],'"'.concat(t,'" is prohibited for ref layers')))}),o.layers.forEach(r=>{e.J(r.id)===l&&(t=r)}),t?t.ref?r.push(new e.V(i,n.ref,"ref cannot reference another ref layer")):s=e.J(t.type):"string"==typeof l&&r.push(new e.V(i,n.ref,'ref layer "'.concat(l,'" not found')))}else if("background"!==s&&"sky"!==s&&"slot"!==s)if(n.source)if(e.a0(n.source)){const t=o.sources&&o.sources[n.source],a=t&&e.J(t.type);t?"vector"===a&&"raster"===s?r.push(new e.V(i,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster"===a&&"raster"!==s?r.push(new e.V(i,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==a||n["source-layer"]?"raster-dem"===a&&"hillshade"!==s?r.push(new e.V(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==a||["raster","raster-particle"].includes(s)?"line"===s&&n.paint&&(n.paint["line-gradient"]||n.paint["line-trim-offset"])&&"geojson"===a&&!t.lineMetrics?r.push(new e.V(i,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires the GeoJSON source to have `lineMetrics` enabled.'))):"raster-particle"===s&&"raster-array"!==a&&r.push(new e.V(i,n.source,'layer "'.concat(n.id,"\" requires a 'raster-array' source."))):r.push(new e.V(i,n.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new e.V(i,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):r.push(new e.V(i,n.source,'source "'.concat(n.source,'" not found')))}else r.push(new e.V("".concat(i,".source"),n.source,'"source" must be a string'));else r.push(new e.V(i,n,'missing required property "source"'));return r=r.concat(we({key:i,value:n,valueSpec:a.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>xe({key:"".concat(i,".type"),value:n.type,valueSpec:a.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:e=>ae(Object.assign({layerType:s},e)),layout:e=>we({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>ue(Object.assign({layerType:s},e))}}),paint:e=>we({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>ce(Object.assign({layerType:s,layer:n},e))}}),appearances(t){const r=$({key:t.key,value:t.value,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:t=>function(t){const{key:r,layer:n,layerType:i}=t,o=e.J(t.value),a=e.J(o.name),s=e.J(o.condition),l=we({key:r,value:o,valueSpec:t.styleSpec.appearance,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{condition:t=>function(t){const r=[];return r.push(...re({key:t.key,value:t.object.condition,valueSpec:e.a6.appearance.condition,expressionContext:"appearance"})),r}(Object.assign({layer:n,layerType:i},t)),properties:t=>function(t){const r=[],{styleSpec:n,layer:i,layerType:o}=t,a=n["paint_".concat(o)],s=n["layout_".concat(o)],l=t.object[t.objectKey];for(const c in l){const n=c in a?"paint":c in s?"layout":void 0;if(!n){r.push(new e.V(t.key,c,'unknown property "'.concat(c,'" for layer type "').concat(o,'"')));continue}const u=Object.assign({},t,{key:"".concat(t.key,".").concat(c),object:l,objectKey:c,layer:i,layerType:o,value:l[c],valueSpec:"paint"===n?a[c]:s[c]});r.push(...le(u,n))}return r}(Object.assign({layer:n,layerType:i},t))}});return"hidden"!==a&&void 0===s&&l.push(new e.V(t.key,"name",'Appearance with name different than "hidden" must have a condition')),l}(Object.assign({layerType:s,layer:n},t))}),i=Array.isArray(t.value)?t.value:[],o=new Set;return i.forEach((i,a)=>{const s=e.J(i.name);if(s)if(o.has(s)){const i=e.J(n.id);r.push(new e.V(t.key,s,'Duplicated appearance name "'.concat(s,'" for layer "').concat(i,'"')))}else o.add(s)}),r}}})),r}function he(t){let{key:r,value:n}=t;return e.a0(n)?[]:[new e.V(r,n,"string expected, ".concat(e.K(n)," found"))]}const Ae={promoteId:function t(r){let{key:n,value:i}=r;if(e.a0(i))return he({key:n,value:i});if(Array.isArray(i)){const t=[],r=e.S(i),o=e.U(r);return"error"===o.result&&o.value.forEach(r=>{t.push(new e.V("".concat(n).concat(r.key),null,"".concat(r.message)))}),e.X(o.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||t.push(new e.V("".concat(n),null,"promoteId expression should be only feature dependent")),t}if(!e.H(i))return[new e.V(n,i,'string, expression or object expected, "'.concat(e.K(i),'" found'))];const o=[];for(const e in i)o.push(...t({key:"".concat(n,".").concat(e),value:i[e]}));return o}};function fe(t){const r=t.value,n=t.key,i=t.styleSpec,o=t.style;if(!e.H(r))return[new e.V(n,r,"object expected, ".concat(e.K(r)," found"))];if(!("type"in r))return[new e.V(n,r,'"type" is required')];const a=e.J(r.type);let s=[];switch(["vector","raster","raster-dem","raster-array"].includes(a)&&("url"in r||"tiles"in r||s.push(new e.a3(n,r,'Either "url" or "tiles" is required.'))),a){case"vector":case"raster":case"raster-dem":case"raster-array":return s=s.concat(we({key:n,value:r,valueSpec:i["source_".concat(a.replace("-","_"))],style:t.style,styleSpec:i,objectElementValidators:Ae})),s;case"geojson":if(s=we({key:n,value:r,valueSpec:i.source_geojson,style:o,styleSpec:i,objectElementValidators:Ae}),"cluster"in r&&"clusterProperties"in r){if(!e.H(r.clusterProperties))return[new e.V("".concat(n,".clusterProperties"),r,"object expected, ".concat(e.K(r)," found"))];for(const t in r.clusterProperties){const i=r.clusterProperties[t];if(!Array.isArray(i))return[new e.V("".concat(n,".clusterProperties.").concat(t),i,"array expected")];const[o,a]=i,l="string"==typeof o?[o,["accumulated"],["get",t]]:o;s.push(...re({key:"".concat(n,".").concat(t,".map"),value:a,expressionContext:"cluster-map"})),s.push(...re({key:"".concat(n,".").concat(t,".reduce"),value:l,expressionContext:"cluster-reduce"}))}}return s;case"video":return we({key:n,value:r,valueSpec:i.source_video,style:o,styleSpec:i});case"image":return we({key:n,value:r,valueSpec:i.source_image,style:o,styleSpec:i});case"canvas":return[new e.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return oe({key:"".concat(n,".type"),value:r.type,valueSpec:{values:pe(i)}})}}function pe(e){return e.source.reduce((t,r)=>{const n=e[r];return"enum"===n.type.type&&(t=t.concat(Object.keys(n.type.values||{}))),t},[])}function me(t){const r=t.value,n=t.styleSpec,i=n.light,o=t.style;if(void 0===r)return[];if(!e.H(r))return[new e.V("light",r,"object expected, ".concat(e.K(r)," found"))];let a=[];for(const s in r){const t=s.match(/^(.*)-transition$/),l=s.match(/^(.*)-use-theme$/);a=a.concat(l&&i[l[1]]?xe({key:s,value:r[s],valueSpec:{type:"string"},style:o,styleSpec:n}):t&&i[t[1]]&&i[t[1]].transition?xe({key:s,value:r[s],valueSpec:n.transition,style:o,styleSpec:n}):i[s]?xe({key:s,value:r[s],valueSpec:i[s],style:o,styleSpec:n}):[new e.V(s,r[s],'unknown property "'.concat(s,'"'))])}return a}function ge(t){const r=t.value;if(!r)return[];const n=t.key;if(!e.H(r))return[new e.V(n,r,"object expected, ".concat(e.K(r)," found"))];let i=[];const o=t.styleSpec,a=o["light-3d"],s=t.style,l=t.style.lights;for(const d of["type","id"])if(!(d in r))return i=i.concat([new e.V(n,r,'missing property "'.concat(d,'"'))]),i;if(!e.a0(r.type))return i=i.concat([new e.V("".concat(n,".type"),r.type,"string expected")]),i;if(l)for(let d=0;d<t.arrayIndex;d++){const t=e.J(r.type),o=l[d];e.J(o.type)===t&&i.push(new e.V(n,r.id,'duplicate light type "'.concat(r.type,'", previously defined at line ').concat(o.id.__line__)))}const c="properties_light_".concat(r.type);if(!(c in o))return i=i.concat([new e.V("".concat(n,".type"),r,"Invalid light type ".concat(r.type))]),i;const u=o[c];for(const d in r)if("properties"===d){const n=r[d];if(!e.H(n))return i=i.concat([new e.V("properties",n,"object expected, ".concat(e.K(n)," found"))]),i;for(const a in n){const l=a.match(/^(.*)-transition$/),c=a.match(/^(.*)-use-theme$/);i=i.concat(c&&u[c[1]]?xe({key:d,value:n[a],valueSpec:{type:"string"},style:s,styleSpec:o}):l&&u[l[1]]&&u[l[1]].transition?xe({key:d,value:r[d],valueSpec:o.transition,style:s,styleSpec:o}):u[a]?xe({key:a,value:n[a],valueSpec:u[a],style:s,styleSpec:o}):[new e.a3(t.key,n[a],'unknown property "'.concat(a,'"'))])}}else i=i.concat(a[d]?xe({key:d,value:r[d],valueSpec:a[d],style:s,styleSpec:o}):[new e.a3(d,r[d],'unknown property "'.concat(d,'"'))]);return i}function ye(t){const r=t.value,n=t.key,i=t.style,o=t.styleSpec,a=o.terrain;if(null==r)return[];if(!e.H(r))return[new e.V("terrain",r,"object expected, ".concat(e.K(r)," found"))];let s=[];for(const l in r){const t=l.match(/^(.*)-transition$/),n=l.match(/^(.*)-use-theme$/);s=s.concat(n&&a[n[1]]?xe({key:l,value:r[l],valueSpec:{type:"string"},style:i,styleSpec:o}):t&&a[t[1]]&&a[t[1]].transition?xe({key:l,value:r[l],valueSpec:o.transition,style:i,styleSpec:o}):a[l]?xe({key:l,value:r[l],valueSpec:a[l],style:i,styleSpec:o}):[new e.a3(l,r[l],'unknown property "'.concat(l,'"'))])}if(r.source)if(e.a0(r.source)){const t=i.sources&&i.sources[r.source],o=t&&e.J(t.type);t?"raster-dem"!==o&&s.push(new e.V("".concat(n,".source"),r.source,"terrain cannot be used with a source of type ".concat(o,', it only be used with a "raster-dem" source type'))):s.push(new e.V("".concat(n,".source"),r.source,'source "'.concat(r.source,'" not found')))}else s.push(new e.V("".concat(n,".source"),r.source,"source must be a string"));else s.push(new e.V(n,r,'terrain is missing required property "source"'));return s}function _e(t){const r=t.value,n=t.style,i=t.styleSpec,o=i.fog;if(void 0===r)return[];if(!e.H(r))return[new e.V("fog",r,"object expected, ".concat(e.K(r)," found"))];let a=[];for(const s in r){const t=s.match(/^(.*)-transition$/),l=s.match(/^(.*)-use-theme$/);a=a.concat(l&&o[l[1]]?xe({key:s,value:r[s],valueSpec:{type:"string"},style:n,styleSpec:i}):t&&o[t[1]]&&o[t[1]].transition?xe({key:s,value:r[s],valueSpec:i.transition,style:n,styleSpec:i}):o[s]?xe({key:s,value:r[s],valueSpec:o[s],style:n,styleSpec:i}):[new e.a3(s,r[s],'unknown property "'.concat(s,'"'))])}return a}const ve={"*":()=>[],array:$,boolean:function(t){const r=t.value,n=t.key;return e.$(r)?[]:[new e.V(n,r,"boolean expected, ".concat(e.K(r)," found"))]},number:ee,color:function(t){let{key:r,value:n}=t;return e.a0(n)?null===e.a1.parseCSSColor(n)?[new e.V(r,n,'color expected, "'.concat(n,'" found'))]:[]:[new e.V(r,n,"color expected, ".concat(e.K(n)," found"))]},enum:oe,filter:ae,function:te,layer:de,object:we,source:fe,model:e.a7,light:me,"light-3d":ge,terrain:ye,fog:_e,string:he,formatted:function(e){return 0===he(e).length?[]:re(e)},resolvedImage:function(e){return 0===he(e).length?[]:re(e)},projection:function(t){const r=t.value,n=t.styleSpec,i=n.projection,o=t.style;if(e.H(r)){let e=[];for(const t in r)e=e.concat(xe({key:t,value:r[t],valueSpec:i[t],style:o,styleSpec:n}));return e}return e.a0(r)?[]:[new e.V("projection",r,"object or string expected, ".concat(e.K(r)," found"))]},import:function(t){const r=t.key,{value:o,styleSpec:a}=t;if(!e.H(o))return[new e.V(r,o,"import must be an object")];const{data:s}=o,l=n(o,i);Object.defineProperty(l,"__line__",{value:o.__line__,enumerable:!1});let c=we(Object.assign({},t,{value:l,valueSpec:a.import}));return""===e.J(l.id)&&c.push(new e.V("".concat(t.key,".id"),l,"import id can't be an empty string")),s&&(c=c.concat(Be(s,a,{key:"".concat(t.key,".data")}))),c},iconset:function(t){const r=t.value,n=t.key,i=t.styleSpec,o=t.style;if(!e.H(r))return[new e.V(n,r,"object expected")];if(!r.type)return[new e.V(n,r,'"type" is required')];const a=e.J(r.type);let s=[];if(s=s.concat(we({key:n,value:r,valueSpec:i["iconset_".concat(a)],style:o,styleSpec:i})),function(e,t){return!("source"!==e||!t.source)}(a,r)){const t=o.sources&&o.sources[r.source],i=t&&e.J(t.type);t?"raster-array"!==i&&s.push(new e.V(n,r.source,"iconset cannot be used with a source of type ".concat(String(i),', it only be used with a "raster-array" source type'))):s.push(new e.V(n,r.source,'source "'.concat(r.source,'" not found')))}return s}};function xe(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=t.value,i=t.valueSpec,o=t.styleSpec;if(i.expression){if(e.a4(e.J(n)))return te(t);if(e.Q(e.S(n)))return re(t)}if(i.type&&ve[i.type]){const e=ve[i.type](t);return!0===r&&e.length>0&&Array.isArray(t.value)?re(t):e}return we(Object.assign({},t,{valueSpec:i.type?o[i.type]:i}))}function we(t){const r=t.key,n=t.value,i=t.valueSpec||{},o=t.objectElementValidators||{},a=t.style,s=t.styleSpec;if(!e.H(n))return[new e.V(r,n,"object expected, ".concat(e.K(n)," found"))];let l=[];for(const c in n){const t=c.split(".")[0];let u;o[t]?u=o[t]:i[t]?u=xe:o["*"]?u=o["*"]:i["*"]&&(u=xe),u?l=l.concat(u({key:(r?"".concat(r,"."):r)+c,value:n[c],valueSpec:i[t]||i["*"],style:a,styleSpec:s,object:n,objectKey:c},n)):l.push(new e.a3(r,n[c],'unknown property "'.concat(c,'"')))}for(const c in i){if(o[c])continue;const t=i[c];t.required&&void 0===t.default&&void 0===n[c]&&l.push(new e.V(r,n,'missing required property "'.concat(c,'"')))}return l}function be(t){let{key:r,value:n}=t;const i=he({key:r,value:n});if(i.length)return i;const o=n;return-1===o.indexOf("{fontstack}")&&i.push(new e.V(r,n,'"glyphs" url must include a "{fontstack}" token')),-1===o.indexOf("{range}")&&i.push(new e.V(r,n,'"glyphs" url must include a "{range}" token')),i}function Be(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.a6;return we({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:t,valueSpec:Object.assign(r.$root,{"*":{type:"*"}}),styleSpec:r,style:t,objectElementValidators:{glyphs:be}})}function Ce(t){return Re(Be(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.a6))}const Ee=e=>Re(fe(e)),Se=e=>Re(me(e)),Te=e=>Re(ge(e)),Ie=e=>Re(ye(e)),Fe=e=>Re(_e(e)),ke=t=>Re(function(t){const r=t.value,n=t.style,i=t.styleSpec,o=i.snow;if(void 0===r)return[];if(!e.H(r))return[new e.V("snow",r,"object expected, ".concat(e.K(r)," found"))];let a=[];for(const s in r){const t=s.match(/^(.*)-transition$/);a=a.concat(t&&o[t[1]]&&o[t[1]].transition?xe({key:s,value:r[s],valueSpec:i.transition,style:n,styleSpec:i}):o[s]?xe({key:s,value:r[s],valueSpec:o[s],style:n,styleSpec:i}):[new e.a3(s,r[s],'unknown property "'.concat(s,'"'))])}return a}(t)),Pe=t=>Re(function(t){const r=t.value,n=t.style,i=t.styleSpec,o=i.rain;if(void 0===r)return[];if(!e.H(r))return[new e.V("rain",r,"object expected, ".concat(e.K(r)," found"))];let a=[];for(const s in r){const t=s.match(/^(.*)-transition$/);a=a.concat(t&&o[t[1]]&&o[t[1]].transition?xe({key:s,value:r[s],valueSpec:i.transition,style:n,styleSpec:i}):o[s]?xe({key:s,value:r[s],valueSpec:o[s],style:n,styleSpec:i}):[new e.a3(s,r[s],'unknown property "'.concat(s,'"'))])}return a}(t)),Me=e=>Re(de(e)),Oe=e=>Re(ae(e)),Le=e=>Re(ce(e)),De=e=>Re(ue(e)),Ue=t=>Re(e.a7(t));function Re(e){return e.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function ze(t,r){let n=!1;if(r&&r.length)for(const i of r)i instanceof e.a3?e.w(i.message):(t.fire(new e.y(new Error(i.message))),n=!0);return n}const Ne=e.a6.light;let je;class Qe extends e.E{constructor(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new e.a8(je||(je=new e.a9({anchor:new e.aa(Ne.anchor),position:new e.ab(Ne.position),color:new e.aa(Ne.color),intensity:new e.aa(Ne.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(Se,e,r)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,n){return(!n||!1!==n.validate)&&ze(this,t.call(Ce,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a6})))}}const Ve=e.a6.terrain;let He=class extends e.E{constructor(t,r,n,i,o){super(),this.scope=n,this._transitionable=new e.a8(new e.a9({source:new e.aa(Ve.source),exaggeration:new e.aa(Ve.exaggeration)}),n,i),this._transitionable.setTransitionOrValue(t,i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r,this.worldview=o}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.ac(t,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const t=this._transitionable._values.exaggeration;if(!t)return null;const r=t.value.expression;if(!r)return null;let n=-1,i=-1,o=1;for(const a of r.zoomStops)o=r.evaluate(new e.ac(a,{worldview:this.worldview})),o>.01?(n=a,i=-1):i=a;return o<.01&&n>0&&i>n?[n,i]:null}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.ad}};const Ge=45,Ke=65,We=.05;function qe(t,r,n,i){const o=e.ah(Ge,Ke,n),[a,s]=Ze(t,i);let l=1-Math.min(1,Math.exp((r-a)/(s-a)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*o*t.alpha}function Ze(e,t){const r=.5/Math.tan(.5*t);return[e.range[0]+r,e.range[1]+r]}function Xe(t,r,n,i,o){const a=e.af([],[r,n,i],o.mercatorFogMatrix);return qe(t,e.ag(a),o.pitch,o._fov)}function Ye(t,r,n,i,o,a,s){const l=[[n,i,0],[o,i,0],[o,a,0],[n,a,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const d of l){const t=e.af([],d,r),n=e.ag(t);c=Math.min(c,n),u=Math.max(u,n)}return[qe(t,c,s.pitch,s._fov),qe(t,u,s.pitch,s._fov)]}const Je=e.a6.fog;class $e extends e.E{constructor(t,r,n,i){super();const o=new e.a9({range:new e.aa(Je.range),color:new e.aa(Je.color),"color-use-theme":new e.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new e.aa(Je["high-color"]),"high-color-use-theme":new e.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new e.aa(Je["space-color"]),"space-color-use-theme":new e.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new e.aa(Je["horizon-blend"]),"star-intensity":new e.aa(Je["star-intensity"]),"vertical-range":new e.aa(Je["vertical-range"])});this._transitionable=new e.a8(o,n,new Map(i)),this.set(t,i),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new e.ai(o),this.scope=n}get state(){const t=this._transform,r="globe"===t.projection.name,n=e.aj(t.zoom),i=this.properties.get("range"),o=[.5,3];return{range:r?[e.ak(o[0],i[0],n),e.ak(o[1],i[1],n)]:i,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Fe,e,r))return;const n=Object.assign({},e);for(const i of Object.keys(Je))void 0===n[i]&&(n[i]=Je[i].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,t)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.ah(Ge,Ke,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(t,r,n){const i=e.ae.fromLngLat(r),o=n.elevation?n.elevation.getAtPointOrZero(i):0;return Xe(t,i.x,i.y,o,n)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Ye(this.state,r,0,0,e.al,e.al,this._transform)}getOpacityForBounds(e,t,r,n,i){return this._transform.projection.supportsFog?Ye(this.state,e,t,r,n,i,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?Ze(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const n of r){const r=t.points[n];let i;if(r[2]>=0)i=r;else{const o=t.points[n-4];i=e.am(o,r,o[2]/(o[2]-r[2]))}if(Xe(this.state,i[0],i[1],0,this._transform)>=We)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,n){return(!n||!1!==n.validate)&&ze(this,t.call(Ce,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a6})))}}let et,tt,rt,nt,it=class extends e.E{constructor(t,r,n,i){super();const o=et||(et=new e.a9({density:new e.aa(e.a6.snow.density),intensity:new e.aa(e.a6.snow.intensity),color:new e.aa(e.a6.snow.color),opacity:new e.aa(e.a6.snow.opacity),vignette:new e.aa(e.a6.snow.vignette),"vignette-color":new e.aa(e.a6.snow["vignette-color"]),"center-thinning":new e.aa(e.a6.snow["center-thinning"]),direction:new e.aa(e.a6.snow.direction),"flake-size":new e.aa(e.a6.snow["flake-size"])}));this._transitionable=new e.a8(o,n,new Map(i)),this.set(t,i),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ai(o),this.scope=n}get state(){const t=this.properties.get("opacity"),r=this.properties.get("color"),n=this.properties.get("direction"),i=e.an(n[0]),o=-Math.max(e.an(n[1]),.01),a=[Math.cos(i)*Math.cos(o),Math.sin(i)*Math.cos(o),Math.sin(o)],s=this.properties.get("vignette"),l=this.properties.get("vignette-color");return l.a=s,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.ao(r.r,r.g,r.b,r.a*t),direction:a,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:l}}get(){return this._transitionable.serialize()}set(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(ke,t,n))return;const i=Object.assign({},t),o=e.a6.snow;for(const e of Object.keys(o))void 0===i[e]&&(i[e]=o[e].default);this._options=i,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,n){return(!n||!1!==n.validate)&&ze(this,t.call(Ce,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a6})))}},ot=class extends e.E{constructor(t,r,n,i){super();const o=tt||(tt=new e.a9({density:new e.aa(e.a6.rain.density),intensity:new e.aa(e.a6.rain.intensity),color:new e.aa(e.a6.rain.color),opacity:new e.aa(e.a6.rain.opacity),vignette:new e.aa(e.a6.rain.vignette),"vignette-color":new e.aa(e.a6.rain["vignette-color"]),"center-thinning":new e.aa(e.a6.rain["center-thinning"]),direction:new e.aa(e.a6.rain.direction),"droplet-size":new e.aa(e.a6.rain["droplet-size"]),"distortion-strength":new e.aa(e.a6.rain["distortion-strength"])}));this._transitionable=new e.a8(o,n,new Map(i)),this.set(t,i),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ai(o),this.scope=n}get state(){const t=this.properties.get("opacity"),r=this.properties.get("color"),n=this.properties.get("direction"),i=e.an(n[0]),o=-Math.max(e.an(n[1]),.01),a=[Math.cos(i)*Math.cos(o),Math.sin(i)*Math.cos(o),Math.sin(o)],s=this.properties.get("vignette-color");return s.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.ao(r.r,r.g,r.b,r.a*t),direction:a,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:s}}get(){return this._transitionable.serialize()}set(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Pe,t,n))return;const i=Object.assign({},t),o=e.a6.rain;for(const e of Object.keys(o))void 0===i[e]&&(i[e]=o[e].default);this._options=i,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,n){return(!n||!1!==n.validate)&&ze(this,t.call(Ce,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a6})))}};class at extends e.E{constructor(t,r,n,i){super(),this.scope=n,this._options=t,this.properties=new e.ai(r),this._transitionable=new e.a8(r,n,new Map(i)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class st{constructor(e,t,r){this.screenBounds=e,this.cameraPoint=r.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=t,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(t,r){let n,i;if(t instanceof e.P||"number"==typeof t[0]){const o=e.P.convert(t);n=[o],i=r.isPointAboveHorizon(o)}else{const o=e.P.convert(t[0]),a=e.P.convert(t[1]),s=o.add(a)._div(2);n=[o,a],i=e.aq(o,a).every(e=>r.isPointAboveHorizon(e))&&r.isPointAboveHorizon(s)}return new st(n,i,r)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.aq(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],i=e.aq(r,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<n.x?i.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?i[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(i[3]=this.cameraPoint)),e.ar(i,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],i=e.aq(r,n,t),o=this.cameraPoint.clone();switch(3*((o.y>r.y)+(o.y>n.y))+((o.x>r.x)+(o.x>n.x))){case 0:i[0]=o,i[4]=o.clone();break;case 1:i.splice(1,0,o);break;case 2:i[1]=o;break;case 3:i.splice(4,0,o);break;case 5:i.splice(2,0,o);break;case 6:i[3]=o;break;case 7:i.splice(3,0,o);break;case 8:i[2]=o}return i}containsTile(t,r,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const o=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/r._pixelsPerMercatorPixel+1,a=n?this._bufferedCameraMercator(o,r):this._bufferedScreenMercator(o,r);let s=t.tileID.wrap+(a.unwrapped?i:0);const l=a.polygon.map(r=>e.as(t.tileTransform,r,s));if(!e.at(l,0,0,e.al,e.al))return;s=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?i:0);const c=this.screenGeometryMercator.polygon.map(r=>e.au(t.tileTransform,r,s)),u=c.map(t=>new e.P(t[0],t[1])),d=r.getFreeCameraOptions().position||new e.ae(0,0,0),h=e.au(t.tileTransform,d,s),A=c.map(t=>{const r=e.av(t,t,h);return e.aw(r,r),new e.ax(h,r)}),f=e.ay(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:A,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(p=e.az(l),p.min.x=e.aA(p.min.x,0,e.al),p.min.y=e.aA(p.min.y,0,e.al),p.max.x=e.aA(p.max.x,0,e.al),p.max.y=e.aA(p.max.y,0,e.al),p),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:f};var p}_bufferedScreenMercator(e,t){const r=ut(e);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._screenRaycastCache[r]=n,n}}_bufferedCameraMercator(e,t){const r=ut(e);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._cameraRaycastCache[r]=n,n}}_projectAndResample(t,r){const n=function(t,r){const n=e.aB([],r.pixelMatrix,r.globeMatrix),i=[0,-e.aD,0,1],o=[0,e.aD,0,1],a=[0,0,0,1];e.aC(i,i,n),e.aC(o,o,n),e.aC(a,a,n);const s=new e.P(i[0]/i[3],i[1]/i[3]),l=new e.P(o[0]/o[3],o[1]/o[3]),c=e.aE(t,s)&&i[3]<a[3],u=e.aE(t,l)&&o[3]<a[3];if(!c&&!u)return null;const d=function(e,t,r){for(let n=1;n<e.length;n++){const i=ct(t.pointCoordinate3D(e[n-1]).x),o=ct(t.pointCoordinate3D(e[n]).x);if(r<0){if(i<o)return{idx:n,t:-i/(o-1-i)}}else if(o<i)return{idx:n,t:(1-i)/(o+1-i)}}return null}(t,r,c?-1:1);if(!d)return null;const{idx:h,t:A}=d;let f=h>1?lt(t.slice(0,h),r):[],p=h<t.length?lt(t.slice(h),r):[];f=f.map(t=>new e.P(ct(t.x),t.y)),p=p.map(t=>new e.P(ct(t.x),t.y));const m=[...f];0===m.length&&m.push(p[p.length-1]);const g=e.ak(m[m.length-1].y,(0===p.length?f[0]:p[0]).y,A);let y;return y=c?[new e.P(0,g),new e.P(0,0),new e.P(1,0),new e.P(1,g)]:[new e.P(1,g),new e.P(1,1),new e.P(0,1),new e.P(0,g)],m.push(...y),0===p.length?m.push(f[0]):m.push(...p),{polygon:m.map(t=>new e.ae(t.x,t.y)),unwrapped:!1}}(t,r);if(n)return n;const i=function(t,r){let n=!1,i=-1/0,o=0;for(let e=0;e<t.length-1;e++)t[e].x>i&&(i=t[e].x,o=e);for(let e=0;e<t.length-1;e++){const r=(o+e)%(t.length-1),i=t[r],a=t[r+1];Math.abs(i.x-a.x)>.5&&(i.x<a.x?(i.x+=1,0===r&&(t[t.length-1].x+=1)):(a.x+=1,r+1===t.length-1&&(t[0].x+=1)),n=!0)}const a=e.aF(r.center.lng);return n&&a<Math.abs(a-1)&&t.forEach(e=>{e.x-=1}),{polygon:t,unwrapped:n}}(lt(t,r).map(t=>new e.P(ct(t.x),t.y)),r);return{polygon:i.polygon.map(t=>new e.ae(t.x,t.y)),unwrapped:i.unwrapped}}}function lt(t,r){return e.aG(t,e=>{const t=r.pointCoordinate3D(e);e.x=t.x,e.y=t.y},1/256)}function ct(e){return e<0?1+e%1:e%1}function ut(e){return 100*e|0}function dt(t,r,i,a,s){const l=function(n,i){if(n)return s(n);if(i){if(t.url&&i.tiles&&t.tiles&&delete t.tiles,i.variants){if(!Array.isArray(i.variants))return s(new Error("variants must be an array"));for(const e of i.variants){if(null==e||"object"!=typeof e||e.constructor!==Object)return s(new Error("variant must be an object"));if(!Array.isArray(e.capabilities))return s(new Error("capabilities must be an array"));if(1===e.capabilities.length&&"meshopt"===e.capabilities[0]){i=Object.assign(i,e);break}}}const n=e.aH(Object.assign({},i,t),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);n.tiles=r.canonicalizeTileset(n,t.url),s(null,n)}},c=function(e,t,r){if(!e)return null;if(!t&&!r)return e;r=r||e.worldview_default;const n=Object.values(e.language||{});if(0===n.length)return null;const i=Object.values(e.worldview||{});if(0===i.length)return null;const o=n.every(e=>e===t),a=i.every(e=>e===r);return o&&a?e:t in(e.language_options||{})||r in(e.worldview_options||{})?null:e.language_options&&e.worldview_options?e:null}(t.data,i,a);return c?e.o.frame(()=>l(null,c)):t.url?e.m(r.transformRequest(r.normalizeSourceURL(t.url,null,i,a),e.R.Source),l):e.o.frame(()=>{const{data:e}=t,r=n(t,o);l(null,r)})}function ht(t,r){const n=Math.pow(2,r.z),i=Math.floor(e.aF(t.getWest())*n),o=Math.floor(e.aJ(t.getNorth())*n),a=Math.ceil(e.aF(t.getEast())*n),s=Math.ceil(e.aJ(t.getSouth())*n);return r.x>=i&&r.x<a&&r.y>=o&&r.y<s}class At{constructor(t,r,n){this.bounds=t?e.aI.convert(this.validateBounds(t)):null,this.minzoom=r||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const r of t)this.extraBounds.push(e.aI.convert(this.validateBounds(r)))}}contains(e){if(e.z>this.maxzoom||e.z<this.minzoom)return!1;if(this.bounds&&!ht(this.bounds,e))return!1;if(!this.extraBounds)return!0;for(const t of this.extraBounds)if(ht(t,e))return!0;return!1}static fromTileJSON(e){if(!e.bounds&&!e.extra_bounds)return null;const t=new At(e.bounds,e.minzoom,e.maxzoom);return t.addExtraBounds(e.extra_bounds),t}}class ft extends e.E{constructor(t,r,n,i){if(super(),this.id=t,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,e.aH(r,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i),this._tileWorkers={},this._deduped=new e.aK}load(t){this._loaded=!1,this.fire(new e.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=dt(this._options,this.map._requestManager,r,n,(i,o)=>{if(this._tileJSONRequest=null,this._loaded=!0,i)r&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(r)),n&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(n)),this.fire(new e.y(i));else if(o){if(Object.assign(this,o),this.hasWorldviews=!!o.worldview_options,o.worldview_default&&(this.worldviewDefault=o.worldview_default),o.vector_layers){this.vectorLayers=o.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const e of o.vector_layers)this.vectorLayerIds.push(e.id),o.worldview&&o.worldview[e.source]&&this.localizableLayerIds.add(e.id)}this.tileBounds=At.fromTileJSON(o),L(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(i)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,r){const n=t.tileID.canonical.url(this.tiles,this.scheme),i=this.map._requestManager.normalizeTileURL(n),o=this.map._requestManager.transformRequest(i,e.R.Tile),a=this.map.style?this.map.style.getLut(this.scope):null,s=a?{image:a.image.clone()}:null,l={request:o,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:s,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&e.h(n)&&(l.localizableLayerIds=this.localizableLayerIds),l.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=r:t.request=t.actor.send("reloadTile",l,c.bind(this));else if(t.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",l,c.bind(this),void 0,!0);else{const r=e.aL.call({deduped:this._deduped},l,(r,n)=>{if(r||!n)c.call(this,r);else{const r=e.aM(n.responseHeaders);l.data={rawData:n.rawData.slice(0),expires:r.expires,cacheControl:r.cacheControl},t.actor&&t.actor.send("loadTile",l,c.bind(this),void 0,!0)}},!0);t.request={cancel:r}}function c(n,i){return delete t.request,t.aborted?r(null):n&&n instanceof e.aN&&404!==n.status?r(n):(i&&i.resourceTiming&&(t.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&t.setExpiryData(i),t.loadVectorData(i,this.map.painter),e.aO(this.dispatcher),r(null,i),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class pt extends e.E{constructor(t,r,n,i){super(),this.id=t,this.dispatcher=n,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},r),Object.assign(this,e.aH(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.z("dataloading",{dataType:"source"}));const r=this.map.getWorldview();this._tileJSONRequest=dt(this._options,this.map._requestManager,null,r,(r,n)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new e.y(r)):n&&(Object.assign(this,n),n.raster_layers&&(this.rasterLayers=n.raster_layers,this.rasterLayerIds=this.rasterLayers.map(e=>e.id)),this.tileBounds=At.fromTileJSON(n),L(n.tiles),this.fire(new e.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,r){const n=e.o.devicePixelRatio>=2,i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);t.request=e.n(this.map._requestManager.transformRequest(i,e.R.Tile),(n,i,o)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(n)return t.state="errored",r(n);if(!i)return r(null);const a=e.aM(o);this.map._refreshExpiredTiles&&t.setExpiryData(a),t.setTexture(i,this.map.painter),t.state="loaded",e.aO(this.dispatcher),r(null)})}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t&&t()}unloadTile(t,r){t.texture&&t.texture instanceof e.T?(t.destroy(!1),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function mt(t,r,n){let[i,o]=t,{scaled:a=!0}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{tileSize:s,buffer:l}=n,{x:c,y:u,z:d}=r;if(!isFinite(c)||!isFinite(u)||!isFinite(d))throw new Error("Invalid MRT header");const h=2**d,A=h*e.aF(i),f=h*e.aJ(o);return function(e,t){let[r,n]=e,{scaled:i=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)throw new Error("bandView is undefined");const{data:o,tileSize:a,buffer:s,offset:l,scale:c,dimension:u}=t;if(r<-s||r>a+s||n<-s||n>a+s)throw new Error("Point (".concat(r,", ").concat(n,") out of bounds for tileSize=").concat(a,", buffer=").concat(s));const d=(n+s)*(a+2*s)+(r+s);if(4294967295===new Uint32Array(o.buffer)[d])return null;let h=[];h=i?[]:new(0,t.data.constructor)(u);for(let A=0;A<u;A++)h[A]=Math.round(1e12*(o[u*d+A]*c+l))/1e12;return h}([Math.min(Math.max(-l,Math.floor((A-c)*s)),s-1+l),Math.min(Math.max(-l,Math.floor((f-u)*s)),s-1+l)],n,{scaled:a})}class gt extends pt{constructor(e,t,r,n){super(e,t,r,n),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},t)}triggerRepaint(e){const t=this.map.painter._terrain,r=this.map.style.getSourceCache(this.id);t&&t.enabled&&r&&t._clearRenderCacheForTile(r.id,e.tileID),this.map.triggerRepaint()}loadTile(t,r){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),i=this.map._requestManager.transformRequest(n,e.R.Tile),o={request:i,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=i,t.actor||(t.actor=this.dispatcher.getActor());const a=(n,i,o)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(n){if("AbortError"===n.name)return;return t.state="errored",r(n)}if(this.map._refreshExpiredTiles&&i){const r=e.aM(o);t.setExpiryData(r)}if(this.partial&&"expired"!==t.state)t.state="empty";else if(!this.partial){if(!i)return r(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=i}r(null)};t.request=this.partial?t.fetchHeader(void 0,a.bind(this)):t.actor.send("loadTile",o,a.bind(this),void 0,!0)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){const r=e.texturePerLayer;if(e.flushAllQueues(),r.size){e.destroy(!1);for(const e of r.values())this.map.painter.saveTileTexture(e)}else e.destroy()}prepareTile(t,r,n,i){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBandForRender(r,n,i,(r,i)=>{if(r)return t.state="errored",this.fire(new e.y(r)),void this.triggerRepaint(t);i&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(n,i,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find(t=>{let{id:r}=t;return r===e}),r=t&&t.fields,n=r&&r.bands&&r.bands;return n?n[0]:0}getTextureDescriptor(t,r,n){if(!t)return;const i=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!i)return;let o=null;r instanceof e.aR?o=r.paint.get("raster-array-band"):r instanceof e.aS&&(o=r.paint.get("raster-particle-array-band"));const a=o||this.getInitialBand(i);if(null==a)return;if(!t.textureDescriptorPerLayer.get(r.id))return void this.prepareTile(t,i,r.id,a);if(t.updateNeeded(r.id,a)&&!n)return;const s=t.textureDescriptorPerLayer.get(r.id);return Object.assign({},s,{texture:t.texturePerLayer.get(r.id)})}getImages(t,r){const n=new Map;for(const i of t)for(const t of r){const[r,o]=t.split("/"),a=i.getLayer(r);if(!a)continue;if(!a.hasBand(o)||!a.hasDataForBand(o))continue;const{bytes:s,tileSize:l,buffer:c}=a.getBandView(o),u=l+2*c,d={data:new e.q({width:u,height:u},s),pixelRatio:2,sdf:!1,usvg:!1,version:0};n.set(t,d)}return n}queryRasterArrayValueByBandId(t,r,n){const i=r._mrt;return new Promise(o=>{const a={},s=new Set;for(const[l,c]of Object.entries(i.layers)){if(n.layerName&&l!==n.layerName)continue;const u={};a[l]=u;for(const{bands:d}of c.dataIndex)for(const h of d)n.bands&&!n.bands.includes(h)||(s.add(e.B(l,h)),r.fetchBand(l,null,h,r=>{e.o.frame(()=>{u[h]=r?null:mt([t.lng,t.lat],i,c.getBandView(h)),s.delete(e.B(l,h)),0===s.size&&o(a)})},!1))}0===s.size&&o(a)})}_loadTileForQuery(t,r){if(this._loadTileLoaded[t.uid])return void r(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(r);this._loadTilePending[t.uid]=[r];const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),i=this.map._requestManager.transformRequest(n,e.R.Tile);t.actor.send("loadTile",{request:i,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(r,n,i)=>{if(r)return this._loadTilePending[t.uid].forEach(e=>e(r,null)),void delete this._loadTilePending[t.uid];if(!n)return this._loadTilePending[t.uid].forEach(e=>e(null,null)),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&n){const r=e.aM(i);t.setExpiryData(r)}t._mrt=n,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(e=>e(null,n)),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]},void 0,!0)}queryRasterArrayValueByAllBands(e,t,r){return new Promise((n,i)=>{this._loadTileForQuery(t,(o,a)=>{o?i(o):n(a?this.queryRasterArrayValueByBandId(e,t,r):null)})})}queryRasterArrayValue(t,r){const n=e.aT.convert(t),i=this.findLoadedParent(n);return i&&i._mrt?r.bands||!this.partial?this.queryRasterArrayValueByBandId(n,i,r):this.queryRasterArrayValueByAllBands(n,i,r):Promise.resolve(null)}findLoadedParent(t){const r=e.ae.fromLngLat(t,this.map.transform.tileSize),n=this.maxzoom+1,i=1<<n,o=Math.floor(r.x),a=Math.floor((r.x-o)*i),s=Math.floor(r.y*i),l=this.map.style.getSourceCache(this.id),c=new e.aQ(n,o,n,a,s);return l.findLoadedParent(c,this.minzoom)}}const yt={vector:ft,raster:pt,"raster-dem":class extends pt{constructor(e,t,r,n){super(e,t,r,n),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(t,r){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function i(e,n){e&&(t.state="errored",r(e)),n&&(t.dem=n,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",r(null))}t.request=e.n(this.map._requestManager.transformRequest(n,e.R.Tile),function(n,o,a){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(n)t.state="errored",r(n);else if(o){const r=e.aM(a);this.map._refreshExpiredTiles&&t.setExpiryData(r);const n=ImageBitmap&&o instanceof ImageBitmap&&e.r(),s=1-(o.width-e.aP(o.width))/2;s<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=n?o:e.o.getImageData(o,s),c={uid:t.uid,tileID:t.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:s};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadTile",c,i.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const r=t.canonical,n=Math.pow(2,r.z),i=(r.x-1+n)%n,o=0===r.x?t.wrap-1:t.wrap,a=(r.x+1+n)%n,s=r.x+1===n?t.wrap+1:t.wrap,l={};return l[new e.aQ(t.overscaledZ,o,r.z,i,r.y).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,s,r.z,a,r.y).key]={backfilled:!1},r.y>0&&(l[new e.aQ(t.overscaledZ,o,r.z,i,r.y-1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,s,r.z,a,r.y-1).key]={backfilled:!1}),r.y+1<n&&(l[new e.aQ(t.overscaledZ,o,r.z,i,r.y+1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,s,r.z,a,r.y+1).key]={backfilled:!1}),l}},"raster-array":gt,geojson:class extends e.E{constructor(t,r,n,i){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(i),this._data=r.data,this._options=Object.assign({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),void 0!==r.minzoom&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const o=e.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*o,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*o,extent:e.al,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:e.al,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*o,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(t){if(!this._options.dynamic)return this.fire(new e.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof t&&("Feature"===t.type&&(t={type:"FeatureCollection",features:[t]}),"FeatureCollection"!==t.type))return this.fire(new e.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof t&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const e=new Map;for(const t of this._data.features)e.set(t.id,t);for(const r of t.features)e.set(r.id,r);this._data.features=[...e.values()]}else this._data=t;return this._updateWorkerData(!0),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,r,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:r},n),this}_updateWorkerData(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.z("dataloading",{dataType:"source"})),this._loaded=!1;const r=Object.assign({append:t},this.workerOptions);r.scope=this.scope;const n=this._data;"string"==typeof n?(r.request=this.map._requestManager.transformRequest(e.o.resolveURL(n),e.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(n),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),r,(r,n)=>{if(this._loaded=!0,this._pendingLoad=null,r)this.fire(new e.y(r));else{const r={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(r.resourceTiming=n.resourceTiming[this.id]),t&&(this._partialReload=!0),this.fire(new e.z("data",r)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(t),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const t=e.B(this.id,this.scope);this.map.style.clearSource(t),this._updateWorkerData()}loadTile(t,r){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const i=this.map.style?this.map.style.getLut(this.scope):null,o=i?{image:i.image.clone()}:null,a=this._partialReload,s={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:o,scope:this.scope,pixelRatio:e.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:a,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};t.request=this.actor.send(n,s,(e,i)=>a&&!i?(t.state="loaded",r(null)):(delete t.request,t.destroy(!1),t.aborted?r(null):e?r(e):(t.loadVectorData(i,this.map.painter,"reloadTile"===n),r(null))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e,t){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(e){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.aU{constructor(e,t,r,n){super(e,t,r,n),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,e.R.Source).url);e.aV(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new e.y(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new e.y(new e.V("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(r.start(0)," and ").concat(r.end(0),"-second mark.")))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.aU,model:e.aX,"batched-model":class extends e.E{constructor(e,t,r,n){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(n)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(t){this._loaded=!1,this.fire(new e.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=dt(this._options,this.map._requestManager,r,n,(i,o)=>{this._tileJSONRequest=null,this._loaded=!0,i?(r&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(r)),n&&2!==n.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(n)),this.fire(new e.y(i))):o&&(Object.assign(this,o),o.bounds&&(this.tileBounds=new At(o.bounds,this.minzoom,this.maxzoom)),L(o.tiles,this.map._requestManager._customAccessToken),this.fire(new e.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,r){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:e.o.devicePixelRatio,promoteId:this.promoteId};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=r;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",i,o.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",i,o.bind(this),void 0,!0);function o(e,n){return t.aborted?r(null):e&&404!==e.status?r(e):(this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadModelData(n,this.map.painter),t.state="loaded",void r(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends e.aU{constructor(t,r,n,i){super(t,r,n,i),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new e.y(new e.V("sources.".concat(t),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.y(new e.V("sources.".concat(t),null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new e.y(new e.V("sources.".concat(t),null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof HTMLCanvasElement||this.fire(new e.y(new e.V("sources.".concat(t),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.y(new e.V("sources.".concat(t),null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(e){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,r,n,i){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=r,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.y(new Error("Missing implementation for ".concat(this.id," custom source")))),this._implementation.loadTile||this.fire(new e.y(new Error("Missing loadTile implementation for ".concat(this.id," custom source")))),this._implementation.bounds&&(this.tileBounds=new At(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,e.aH(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this.map=t,this._loaded=!1,this.fire(new e.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:r,z:n}=e.canonical;return this._implementation.hasTile({x:t,y:r,z:n})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:r,y:n,z:i}=e.tileID.canonical,o=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:r,y:n,z:i},{signal:o.signal})).then(function(r){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===r?(e.state="errored",t(null)):null===r?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(r)?(this.loadTileData(e,r),e.state="loaded",void t(null)):(e.state="errored",t(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}.bind(this)).catch(r=>{"AbortError"!==r.name&&(e.state="errored",t(r))}),e.request.cancel=()=>o.abort()}loadTileData(e,t){e.setTexture(t,this.map.painter)}unloadTile(t,r){if(t.texture&&t.texture instanceof e.T?(t.destroy(!1),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:r,z:n}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:r,z:n})}r&&r()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const t=e.B(this.id,this.scope);this.map.style.clearSource(t)}_update(){this.fire(new e.z("data",{dataType:"source",sourceDataType:"content"}))}}},_t=function(t,r,n,i){const o=new yt[r.type](t,r,n,i);if(o.id!==t)throw new Error("Expected Source id to be ".concat(t," instead of ").concat(o.id));return e.aY(["load","abort","unload","serialize","prepare"],o),o};function vt(e,t){return"".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",":").concat(t.id||"",":").concat(t.layer.id,":").concat(function(e){if("layerId"in e)return"layer:".concat(e.layerId);{const{featuresetId:t,importId:r}=e;return"featureset:".concat(t).concat(r?":import:".concat(r):"")}}(e.target))}function xt(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(e.uniqueFeatureID){const i=vt(e,t,n);if(r.has(i))return!0;r.add(i)}return!1}function wt(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const o=t.sourceCache.transform,a=t.sourceCache.tilesIn(e,t.has3DLayers,i);a.sort(Ct);const s=[];for(const l of a){const e=l.tile.queryRenderedFeatures(t,l,r,n,o,i);Object.keys(e).length&&s.push({wrappedTileID:l.tile.tileID.wrapped().key,queryResults:e})}for(const l in t.layers){const r=t.layers[l];if(r.styleLayer){const i=r.styleLayer.queryRenderedFeatures(e,t.sourceCache,n);Object.keys(i).length&&s.push({wrappedTileID:0,queryResults:i})}}return 0===s.length?{}:function(e){const t={},r={};for(const n of e){const e=n.queryResults,i=n.wrappedTileID,o=r[i]=r[i]||{};for(const r in e){const n=e[r],i=o[r]=o[r]||{},a=t[r]=t[r]||[];for(const e of n)i[e.featureIndex]||(i[e.featureIndex]=!0,a.push(e))}}return t}(s)}function bt(e,t,r,n,i,o){const a={},s=n.queryRenderedSymbols(e),l=[];for(const c of Object.keys(s).map(Number))l.push(i[c]);l.sort(Ct);for(const c of l){const e=c.featureIndex.lookupSymbolFeatures(s[c.bucketInstanceId],c.bucketIndex,c.sourceLayerIndex,t,r,o);for(const t in e){const r=a[t]=a[t]||[],n=e[t];n.sort((e,t)=>{const r=c.featureSortOrder;if(r){const n=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-n}return t.featureIndex-e.featureIndex});for(const e of n)r.push(e)}}return a}function Bt(e,t){const r=e.getRenderableIds().map(t=>e.getTileByID(t)),n=[],i={};for(let o=0;o<r.length;o++){const e=r[o],a=e.tileID.canonical.key;i[a]||(i[a]=!0,e.querySourceFeatures(n,t))}return n}function Ct(e,t){const r=e.tileID,n=t.tileID;return r.overscaledZ-n.overscaledZ||r.canonical.y-n.canonical.y||r.wrap-n.wrap||r.canonical.x-n.canonical.x}function Et(e,t){const r={};if(!t)return r;for(const n of e){const e=n.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)r[t.fqid]=n}}return r}const St=32,Tt=33,It=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,t=0,r=0,i=0,o=0,a=0,s=0;for(1&e?i=o=a=St:t=r=s=St;(e>>=1)>1;){const n=t+i>>1,l=r+o>>1;1&e?(i=t,o=r,t=a,r=s):(t=i,r=o,i=a,o=s),a=n,s=l}const l=4*n;It[l+0]=t,It[l+1]=r,It[l+2]=i,It[l+3]=o}const Ft=new Uint16Array(2178),kt=new Uint8Array(1089),Pt=new Uint16Array(1089);function Mt(e){return 0===e?-.03125:32===e?.03125:0}const Ot={type:2,extent:e.al,loadGeometry:()=>[[new e.P(0,0),new e.P(e.al+1,0),new e.P(e.al+1,e.al+1),new e.P(0,e.al+1),new e.P(0,0)]]};class Lt{constructor(t,r,n,i,o,a){this.tileID=t,this.uid=e.b2(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=o,i&&i.style&&(this._lastUpdatedBrightness=i.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection),this.worldview=a,this._hasAppearances=null}registerFadeDuration(t){const r=t+this.timeAdded;r<e.o.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,n){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Et(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const r=this.buckets[t];if(r instanceof e.b4){if(this.hasSymbolBuckets=!0,!n)break;r.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const r=this.buckets[t];if(r instanceof e.b4&&r.hasRTLText){this.hasRTLText=!0,e.b5();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],n=r.style.getOwnLayer(e);if(!n)continue;const i=n.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,i)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new e.b3}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(e,t,r){e&&(e.resourceTiming&&(this.resourceTiming=e.resourceTiming),this.buckets=Object.assign({},this.buckets,Et(e.buckets,t.style)),e.featureIndex&&(this.latestFeatureIndex=e.featureIndex))}getBucket(e){return this.buckets[e.fqid]}upload(t,r){for(const e in this.buckets){const n=this.buckets[e];if(n.uploadPending()){let e={},i=[],o={zoom:0,pitch:0,brightness:0,worldview:""};if(r){if(r.style){i=r.style.listImages();const t=n.layers[0],o=t.sourceLayer||"_geojsonTileLayer",a=r.style.getLayerSourceCache(t);a&&(e=a._state.getState(o,void 0))}o={zoom:r.transform.zoom||0,pitch:r.transform.pitch||0,brightness:r.style.getBrightness()||0,worldview:r.worldview||""}}n.upload(t,this.tileID.canonical,e,i,o)}}const n=t.gl,i=this.imageAtlas;i&&!i.uploaded&&(this.imageAtlasTexture=new e.T(t,i.image,n.RGBA8,{useMipmap:!!i.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,r){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,r),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const n=t.style.getBrightness();null===this._hasAppearances&&(this._hasAppearances=this.hasAppearances(t)),(this._lastUpdatedBrightness||n||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&n&&Math.abs(this._lastUpdatedBrightness-n)<.001||(this.updateBuckets(t,this._lastUpdatedBrightness!==n),this._lastUpdatedBrightness=n))}evaluateQueryRenderedFeaturePadding(){let e=0;for(const t in this.buckets){const r=this.buckets[t];r.evaluateQueryRenderedFeaturePadding&&(e=Math.max(e,r.evaluateQueryRenderedFeaturePadding()))}return e}queryRenderedFeatures(t,r,n,i,o,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const s=this.evaluateQueryRenderedFeaturePadding(),l=function(t,r){const n=e.bq([],[.5*t.width,.5*-t.height,1]);return e.br(n,n,[1,-1,0]),e.aB(n,n,t.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(n)}(o,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:r,pixelPosMatrix:l,transform:i,availableImages:n,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:s})}querySourceFeatures(t,r){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const i=n.loadVTLayers(),o=r?r.sourceLayer:"",a=i._geojsonTileLayer||i[o];if(!a)return;const s=e.b6(r&&r.filter),{z:l,x:c,y:u}=this.tileID.canonical,d={z:l,x:c,y:u};for(let h=0;h<a.length;h++){const r=a.feature(h);if(s.needGeometry){const t=e.b7(r,!0);if(!s.filter(new e.ac(this.tileID.overscaledZ,{worldview:this.worldview}),t,this.tileID.canonical))continue}else if(!s.filter(new e.ac(this.tileID.overscaledZ,{worldview:this.worldview}),r))continue;const i=n.getId(r,o),A=new e.b8(r,l,c,u,i);A.tile=d,t.push(A)}}loaded(){return"loaded"===this.state||"errored"===this.state}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const r=e.b9(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(r)if(this.expirationTime<r)t=!0;else{const n=this.expirationTime-r;n?this.expirationTime=e+Math.max(n,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(e){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&e&&this.updateBuckets(e)}hasAppearances(e){for(const t in this.buckets)if(e.style.hasLayer(t)&&this.buckets[t].layers.some(e=>e.appearances&&e.appearances.length>0))return!0;return!1}updateBuckets(t,r){if(!this.latestFeatureIndex)return;if(!t.style)return;const n=t.style.listImages(),i=t.style.getBrightness();for(const o in this.buckets){if(!t.style.hasLayer(o))continue;const a=this.buckets[o],s=a.layers[0],l=s.sourceLayer||"_geojsonTileLayer",c=t.style.getLayerSourceCache(s);let u={};c&&(u=c._state.getState(l,void 0));const d=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},h=Object.keys(u).length>0&&!r;a.hasAppearances=a.layers.some(e=>e.appearances&&e.appearances.length>0);const A=h?a.stateDependentLayers:a.layers;if(h&&0!==a.stateDependentLayers.length||r){const e=this.latestFeatureIndex.loadVTLayers();a.update(u,e[l],n,d,A,r,i)}if(h&&0!==a.stateDependentLayers.length||r||a.hasAppearances){const e={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};a.updateAppearances(this.tileID.canonical,u,n,e)}(a instanceof e.ba||a instanceof e.bb)&&t._terrain&&t._terrain.enabled&&c&&a.uploadPending()&&t._terrain._clearRenderCacheForTile(c.id,this.tileID);const f=t&&t.style&&t.style.getOwnLayer(o);f&&(this.queryPadding=Math.max(this.queryPadding,f.queryRadius(a)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.o.now()+t}setTexture(t,r){const n=r.context,i=n.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t):(this.texture=new e.T(n,t,i.RGBA8,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))}setDependencies(e,t){const r={};for(const n of t)r[n]=!0;this.dependencies[e]=r}hasDependency(e,t){for(const r of e){const e=this.dependencies[r];if(e)for(const r of t)if(e[r])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const n=e.bc(Ot,this.tileID.canonical,this.tileTransform)[0],i=new e.bd,o=new e.be;for(let e=0;e<n.length;e++){const{x:t,y:r}=n[e];i.emplaceBack(t,r),o.emplaceBack(e)}o.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(o),this._tileDebugBuffer=t.createVertexBuffer(i,e.bf.members),this._tileDebugSegments=e.bg.simpleSegment(0,0,i.length,o.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const n=e.bc(Ot,this.tileID.canonical,this.tileTransform)[0];let i,o;if(this.isRaster){const t=function(t,r){const n=e.aZ(t,r),i=Math.pow(2,t.z);for(let u=0;u<Tt;u++)for(let o=0;o<Tt;o++){const a=e.a_((t.x+(o+Mt(o))/St)/i),s=e.a$((t.y+(u+Mt(u))/St)/i),l=r.project(a,s),c=u*Tt+o;Ft[2*c+0]=Math.round((l.x*n.scale-n.x)*e.al),Ft[2*c+1]=Math.round((l.y*n.scale-n.y)*e.al)}kt.fill(0),Pt.fill(0);for(let e=2045;e>=0;e--){const t=4*e,r=It[t+0],n=It[t+1],i=It[t+2],o=It[t+3],a=r+i>>1,s=n+o>>1,l=a+s-n,c=s+r-a,u=n*Tt+r,d=o*Tt+i,h=s*Tt+a,A=Math.hypot((Ft[2*u+0]+Ft[2*d+0])/2-Ft[2*h+0],(Ft[2*u+1]+Ft[2*d+1])/2-Ft[2*h+1])>=16;kt[h]=kt[h]||(A?1:0),e<1022&&(kt[h]=kt[h]||kt[(n+c>>1)*Tt+(r+l>>1)]||kt[(o+c>>1)*Tt+(i+l>>1)])}const o=new e.b1,a=new e.b0;let s=0;function l(t,r){const n=r*Tt+t;return 0===Pt[n]&&(o.emplaceBack(Ft[2*n+0],Ft[2*n+1],t*e.al/St,r*e.al/St),Pt[n]=++s),Pt[n]-1}function c(e,t,r,n,i,o){const s=e+r>>1,u=t+n>>1;if(Math.abs(e-i)+Math.abs(t-o)>1&&kt[u*Tt+s])c(i,o,e,t,s,u),c(r,n,i,o,s,u);else{const s=l(e,t),c=l(r,n),u=l(i,o);a.emplaceBack(s,c,u)}}return c(0,0,St,St,St,0),c(St,St,0,0,0,St),{vertices:o,indices:a}}(this.tileID.canonical,r);i=t.vertices,o=t.indices}else{i=new e.b1,o=new e.b0;for(const{x:e,y:r}of n)i.emplaceBack(e,r,0,0);const t=e.bh(i.int16.subarray(0,4*i.length),void 0,4);for(let e=0;e<t.length;e+=3)o.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(i,e.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(o),this._tileBoundsSegments=e.bg.simpleSegment(0,0,i.length,o.length)}_makeGlobeTileDebugBuffers(t,r){const n=r.projection;if(!n||"globe"!==n.name||r.freezeTileCoverage)return;const i=this.tileID.canonical,o=e.bj(i,r),a=e.bk(o),s=e.aj(r.zoom);let l;s>0&&(l=e.bl(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,i,r,a,l,s),this._makeGlobeTileDebugTextBuffer(t,i,r,a,l,s)}_globePoint(t,r,n,i,o,a,s){let l=e.bm(t,r,n);if(a){const o=1<<n.z,c=e.aF(i.center.lng),u=e.aJ(i.center.lat),d=(n.x+.5)/o-c;let h=0;d>.5?h=-1:d<-.5&&(h=1);let A=(t/e.al+n.x)/o+h,f=(r/e.al+n.y)/o;A=(A-c)*i._pixelsPerMercatorPixel+c,f=(f-u)*i._pixelsPerMercatorPixel+u;const p=[A*i.worldSize,f*i.worldSize,0];e.af(p,p,a),l=e.bn(l,p,s)}return e.af(l,l,o)}_makeGlobeTileDebugBorderBuffer(t,r,n,i,o,a){const s=new e.bd,l=new e.be,c=new e.bo,u=(e,t,u,d,h)=>{const A=(u-e)/(h-1),f=(d-t)/(h-1),p=s.length;for(let m=0;m<h;m++){const u=e+m*A,d=t+m*f;s.emplaceBack(u,d);const h=this._globePoint(u,d,r,n,i,o,a);c.emplaceBack(h[0],h[1],h[2]),l.emplaceBack(p+m)}},d=e.al;u(0,0,d,0,16),u(d,0,d,d,16),u(d,d,0,d,16),u(0,d,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(s,e.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.bp.members),this._tileDebugSegments=e.bg.simpleSegment(0,0,s.length,l.length)}_makeGlobeTileDebugTextBuffer(t,r,n,i,o,a){const s=e.al/4,l=new e.bd,c=new e.b0,u=new e.bo,d=25;c.reserve(32),l.reserve(d),u.reserve(d);const h=(e,t)=>d*e+t;for(let e=0;e<d;e++){const t=e*s;for(let e=0;e<d;e++){const c=e*s;l.emplaceBack(c,t);const d=this._globePoint(c,t,r,n,i,o,a);u.emplaceBack(d[0],d[1],d[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const r=h(e,t),n=h(e,t+1),i=h(e+1,t),o=h(e+1,t+1);c.emplaceBack(r,n,i),c.emplaceBack(i,n,o)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(u,e.bp.members),this._tileDebugTextSegments=e.bg.simpleSegment(0,0,d,32)}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const e in this.buckets)this.buckets[e].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof e.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}e.bs.setPbf(e.bt);class Dt extends Lt{constructor(e,t,r,n,i){super(e,t,r,n,i),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(e){return this._mrt&&this._mrt.getLayer(e)}setTexturePerLayer(t,r,n){const i=n.context,o=i.gl;let a=this.texturePerLayer.get(t)||n.getTileTexture(r.width);a&&a instanceof e.T?a.update(r,{premultiply:!1}):a=new e.T(i,r,o.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,a)}flushQueues(e){const t=this._workQueuePerLayer.get(e)||[],r=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()();for(;r.length;)r.pop()()}flushAllQueues(){for(const e of this._workQueuePerLayer.keys()){const t=this._workQueuePerLayer.get(e)||[];for(;t.length;)t.pop()()}for(const e of this._fetchQueuePerLayer.keys()){const t=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()()}}fetchHeader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16384,r=arguments.length>1?arguments[1]:void 0;const n=this._mrt=new e.bs(30),i=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.bu(i,(e,i,o)=>{if(e)r(e);else try{const e=n.getHeaderLength(i);if(e>t)return void(this.request=this.fetchHeader(e,r));n.parseHeader(i),this._isHeaderLoaded=!0;let a=0;for(const t of Object.values(n.layers))a=Math.max(a,t.dataIndex[t.dataIndex.length-1].lastByte);i.byteLength>=a&&(this.entireBuffer=i),r(null,this.entireBuffer||i,o)}catch(e){r(e)}}),this.request}fetchBandForRender(e,t,r,n){this.fetchBand(e,t,r,i=>{if(i)return void n(i);this.updateTextureDescriptor(e,t,r);const o=this.textureDescriptorPerLayer.get(t);n(null,o?o.img:null)})}fetchBand(t,r,n,i){const o=this._mrt;if(!this._isHeaderLoaded||!o)return void i(new Error("Tile header is not ready"));const a=this.actor;if(!a)return void i(new Error("Can't fetch tile band without an actor"));let s;const l=e.B(String(n),e.B(this.tileID.key,t));let c=this._taskQueue.get(l);c?c.add(i):(c=new Set,c.add(i),this._taskQueue.set(l,c));const u=(e,t)=>{s.complete(e,t),e?i(e):(c.forEach(e=>e(null,t)),this._taskQueue.delete(l))},d=(e,t)=>{if(e)return i(e);const n=a.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:t,task:s},u,void 0,!0);if(null!==r){const e=this._workQueuePerLayer.get(r)||[];e.push(()=>{n&&n.cancel(),s.cancel()}),this._workQueuePerLayer.has(r)||this._workQueuePerLayer.set(r,e)}};let h;try{h=o.getLayer(t)}catch(e){if("reloading"===this.state)return;throw e}if(!h)return void i(new Error('Unknown sourceLayer "'.concat(t,'"')));if(h.hasDataForBand(n))return c.forEach(e=>e(null,null)),void this._taskQueue.delete(l);const A=h.getDataRange([n]);if(s=o.createDecodingTask(A),!s||s.tasks.length)if(null!==r&&this.flushQueues(r),this.entireBuffer)d(null,this.entireBuffer.slice(A.firstByte,A.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:"bytes=".concat(A.firstByte,"-").concat(A.lastByte)}}),n=e.bu(t,d);if(null!==r){const e=this._fetchQueuePerLayer.get(r)||[];e.push(()=>{n.cancel(),s.cancel()}),this._fetchQueuePerLayer.has(r)||this._fetchQueuePerLayer.set(r,e)}}}updateNeeded(e,t){return(!this.textureDescriptorPerLayer.get(e)||this.textureDescriptorPerLayer.get(e).band!==t||this.refreshedUponExpiration)&&"errored"!==this.state}updateTextureDescriptor(t,r,n){if(!this._mrt)return;const i=this._mrt.getLayer(t);if(!i||!i.hasBand(n)||!i.hasDataForBand(n))return;const{bytes:o,tileSize:a,buffer:s,offset:l,scale:c}=i.getBandView(n),u=a+2*s,d=new e.q({width:u,height:u},o),h=this.texturePerLayer.get(r);h&&h instanceof e.T&&h.update(d,{premultiply:!1}),this.textureDescriptorPerLayer.set(r,{layer:t,band:n,img:d,buffer:s,offset:l,tileSize:a,format:i.pixelFormat,mix:[c,256*c,65536*c,16777216*c]})}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(super.destroy(t),delete this._mrt,!t)for(const r of this.texturePerLayer.values())r&&r instanceof e.T&&r.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Ut{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){const n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const i={value:t,timeout:void 0};if(void 0!==r&&(i.timeout=setTimeout(()=>{this.remove(e,i)},r)),this.data[n].push(i),this.order.push(n),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const r=e.wrapped().key,n=void 0===t?0:this.data[r].indexOf(t),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const r in this.data)for(const n of this.data[r])e(n.value)||t.push(n);for(const r of t)this.remove(r.value.tileID,r)}}class Rt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,r){const n=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},Object.assign(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const i in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][i]&&delete this.deletedStates[e][n][i]}removeFeatureState(e,t,r){if(null===this.deletedStates[e])return;const n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][r]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(r in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][r]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(e,t){const r=this.state[e]||{},n=this.stateChanges[e]||{},i=this.deletedStates[e];if(null===i)return{};if(void 0!==t){const e=String(t),o=Object.assign({},r[e],n[e]);if(i){const e=i[t];if(null===e)return{};for(const t in e)delete o[t]}return o}const o=Object.assign({},r,n);if(i)for(const a in i)delete o[a];return o}initializeTileState(e,t){e.refreshFeatureState(t)}coalesceChanges(e,t){const r={};for(const n in this.stateChanges){this.state[n]=this.state[n]||{};const e={};for(const t in this.stateChanges[n])this.state[n][t]||(this.state[n][t]={}),Object.assign(this.state[n][t],this.stateChanges[n][t]),e[t]=this.state[n][t];r[n]=e}for(const n in this.deletedStates){this.state[n]=this.state[n]||{};const e={};if(null===this.deletedStates[n])for(const t in this.state[n])e[t]={},this.state[n][t]={};else for(const t in this.deletedStates[n]){if(null===this.deletedStates[n][t])this.state[n][t]={};else if(this.state[n][t])for(const e of Object.keys(this.deletedStates[n][t]))delete this.state[n][t][e];e[t]=this.state[n][t]}r[n]=r[n]||{},Object.assign(r[n],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const n in e)e[n].refreshFeatureState(t)}}class zt extends e.E{constructor(e,t,r){super(),this.id=e,this._onlySymbols=r,t.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new Ut(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Rt,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles)if(!this._tiles[e].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const r=this._tiles[t];r.upload(e,this.map?this.map.painter:void 0),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Nt).map(e=>e.key)}getRenderableIds(t,r){const n=[];for(const e in this._tiles)this._isIdRenderable(+e,t,r)&&n.push(this._tiles[e]);return t?n.sort((t,r)=>{const n=t.tileID,i=r.tileID,o=new e.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),a=new e.P(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-i.overscaledZ||a.y-o.y||a.x-o.x}).map(e=>e.tileID.key):n.map(e=>e.tileID).sort(Nt).map(e=>e.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(r||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(t,r,n,i,o){if(i){if(t.state="errored",404!==i.status)this._source.fire(new e.y(i,{tile:t}));else{if(this._source.fire(new e.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=e.o.now(),"expired"===n&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let a=new Map;o&&o.responseHeaders&&(a=o.responseHeaders),this._source.fire(new e.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:a}))}_backfillDEM(e){const t=this.getRenderableIds();for(let n=0;n<t.length;n++){const i=t[n];if(e.neighboringTiles&&e.neighboringTiles[i]){const t=this.getTileByID(i);r(e,t),r(t,e)}}function r(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let r=t.tileID.canonical.x-e.tileID.canonical.x;const n=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),o=t.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,r,n),e.neighboringTiles&&e.neighboringTiles[o]&&(e.neighboringTiles[o].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,r,n){for(const i in this._tiles){let o=this._tiles[i];if(n[i]||!o.hasData()||o.tileID.overscaledZ<=t||o.tileID.overscaledZ>r)continue;let a=o.tileID;for(;o&&o.tileID.overscaledZ>t+1;){const e=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[e.key],o&&o.hasData()&&(a=e)}let s=a;for(;s.overscaledZ>t;)if(s=s.scaledTo(s.overscaledZ-1),e[s.key]){n[a.key]=a;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=t?r:null}for(let r=e.overscaledZ-1;r>=t;r--){const t=e.scaledTo(r),n=this._getLoadedTile(t);if(n)return n}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const r=Math.ceil(e.width/t)+1,n=Math.ceil(e.height/t)+1,i=Math.floor(r*n*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,i):i,a="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(a)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const r in this._tiles){const n=this._tiles[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),e[n.tileID.key]=n}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,r,n,i,o){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;this.updateCacheSize(t,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const a="batched-model"===this._source.type;let s,l=this._source.maxzoom;const c=this.map&&this.map.painter?this.map.painter._terrain:null;if(c&&c.sourceCache===this&&c.attenuationRange()){const e=c.attenuationRange()[0],t=Math.floor(e)-Math.log2(c.getDemUpscale());l>t&&(l=t)}if(this.used||this.usedForTerrain){if(this._source.tileID)s=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new e.aQ(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y));else if(0!==this.tileCoverLift){const i=t.clone();i.tileCoverLift=this.tileCoverLift,s=i.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:a}),this._source.minzoom<=1&&"globe"===t.projection.name&&(s.push(new e.aQ(1,0,1,0,0)),s.push(new e.aQ(1,0,1,1,0)),s.push(new e.aQ(1,0,1,0,1)),s.push(new e.aQ(1,0,1,1,1)))}else if(s=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:a}),this._source.hasTile){const e=this._source.hasTile.bind(this._source);s=s.filter(t=>e(t))}}else s=[];if(s.length>0&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!jt(this._source.type)){const e=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),l=Math.min(e,this._source.maxzoom);if(a){const e=t.extendTileCover(s,l);for(const t of e)s.push(t)}else if(o){const e=t.extendTileCoverToNearPlane(s,this.transform.getFrustum(l),l);for(const t of e)s.push(t)}else if(this.castsShadows&&i){const e=t.extendTileCover(s,l,i,16);for(const t of e)this._shadowCasterTiles[t.key]=!0,s.push(t)}}const u=this._updateRetainedTiles(s);if(jt(this._source.type)&&0!==s.length){const t={},r={},n=Object.keys(u);for(const o of n){const n=u[o],i=this._tiles[o];if(!i||i.fadeEndTime&&i.fadeEndTime<=e.o.now())continue;const a=this.findLoadedParent(n,Math.max(n.overscaledZ-zt.maxOverzooming,this._source.minzoom));a&&(this._addTile(a.tileID),t[a.tileID.key]=a.tileID),r[o]=n}const i=s[s.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(u[e]||!t.hasData())continue;let n=t.tileID;for(;n.overscaledZ>i;){n=n.scaledTo(n.overscaledZ-1);const i=this._tiles[n.key];if(i&&i.hasData()&&r[n.key]){u[e]=t.tileID;break}}}for(const e in t)u[e]||(this._coveredTiles[e]=!0,u[e]=t[e])}for(const e in u)this._tiles[e].clearFadeHold();const d=e.bv(this._tiles,u);for(const e of d){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const r={},n=e.reduce((e,t)=>Math.min(e,t.overscaledZ),1/0),i=e[0].overscaledZ,o=Math.max(i-zt.maxOverzooming,this._source.minzoom),a=Math.max(i+zt.maxUnderzooming,this._source.minzoom),s={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||n<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,n,a,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],r=this.getTile(e);if(r&&r.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let n=e.wasRequested();for(let i=l.overscaledZ-1;i>=o;--i){const o=l.scaledTo(i);if(r[o.key])break;if(r[o.key]=!0,e=this.getTile(o),!e&&n&&(e=this._addTile(o)),e&&(t[o.key]=o,n=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let r,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}t.push(n.key);const e=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(e),r)break;n=e}for(const e of t)this._loadedParentTiles[e]=r}}_addTile(t){let r=this._tiles[t.key];if(r)return!0!==r.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const n=Boolean(r);if(!n){const e=this.map?this.map.painter:null,n=this._source.tileSize*t.overscaleFactor();r="raster-array"===this._source.type?new Dt(t,n,this.transform.tileZoom,e,this._isRaster):new Lt(t,n,this.transform.tileZoom,e,this._isRaster,this._source.worldview),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r.uses++,this._tiles[t.key]=r,n||this._source.fire(new e.z("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,n){const i=[],o=this.transform;if(!o)return i;const a="globe"===o.projection.name,s=e.aF(o.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(n&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(a){const t=c.tileID.canonical;if(0===t.z){const r=[Math.abs(e.aA(s,...Qt(t,-1))-s),Math.abs(e.aA(s,...Qt(t,1))-s)];u=[0,2*r.indexOf(Math.min(...r))-1]}else{const r=[Math.abs(e.aA(s,...Qt(t,-1))-s),Math.abs(e.aA(s,...Qt(t,0))-s),Math.abs(e.aA(s,...Qt(t,1))-s)];u=[r.indexOf(Math.min(...r))-1]}}else u=[0];for(const e of u){const n=t.containsTile(c,o,r,e);n&&i.push(n)}}return i}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const r=this.getRenderableIds(e,t).map(e=>this._tiles[e].tileID),n="globe"===this.transform.projection.name;for(const i of r)i.projMatrix=this.transform.calculateProjMatrix(i.toUnwrapped()),i.expandedProjMatrix=n?this.transform.calculateProjMatrix(i.toUnwrapped(),!1,!0):i.projMatrix;return r}sortCoordinatesByDistance(e){const t=e.slice(),r=this.transform._camera.position,n=this.transform._camera.forward(),i={};for(const o of t){const e=1/(1<<o.canonical.z);i[o.key]=((o.canonical.x+.5)*e+o.wrap-r[0])*n[0]+((o.canonical.y+.5)*e-r[1])*n[1]-r[2]*n[2]}return t.sort((e,t)=>i[e.key]-i[t.key]),t}hasTransition(){if(this._source.hasTransition())return!0;if(jt(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=e.o.now())return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){const n=this._tiles[e];n&&n.setDependencies(t,r)}reloadTilesForDependencies(e,t){for(const r in this._tiles)this._tiles[r].hasDependency(e,t)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,t))}_preloadTiles(t,r){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,r))};return void this._source.on("data",e)}const n=new Map,i=Array.isArray(t)?t:[t],o=this.map.painter.terrain,a=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize;for(const e of i){const t=e.coveringTiles({tileSize:a,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)n.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}const s=Array.from(n.values());e.bw(s,(e,t)=>{const r=new Lt(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(r,e=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),t(e,r)})},r)}}function Nt(e,t){const r=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function jt(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Qt(e,t){const r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}zt.maxOverzooming=10,zt.maxUnderzooming=3;class Vt{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const r in this.style._mergedLayers){const n=this.style._mergedLayers[r];if("fill-extrusion"===n.type||"building"===n.type)this.layers.push({layer:n,visible:e,visibilityChanged:t});else if("model"===n.type){const r=this.style.getLayerSource(n);r&&"batched-model"===r.type&&this.layers.push({layer:n,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const r=t.layer;let n=!1;"fill-extrusion"===r.type?n=!r.isHidden(e)&&r.paint.get("fill-extrusion-opacity")>0:"building"===r.type?n=!r.isHidden(e)&&r.paint.get("building-opacity")>0:"model"===r.type&&(n=!r.isHidden(e)&&r.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!n&&t.visible,t.visible=n}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const n of this.layers){const e=n.layer,r=this.style.getLayerSourceCache(e);let i=1;"fill-extrusion"===e.type?i=n.visible?e.paint.get("fill-extrusion-vertical-scale"):0:"building"===e.type&&(i=n.visible?e.paint.get("building-vertical-scale"):0);let o=r?r.getTile(t):null;if(!o&&r)for(const n in r._tiles){const e=r._tiles[n];if(t.canonical.isChildOf(e.tileID.canonical)){o=e;break}}this.currentBuildingBuckets.push({bucket:o?o.getBucket(e):null,tileID:o?o.tileID:t,verticalScale:i})}e.hasAnyZOffset=!1;let r=!1;for(let n=0;n<e.symbolInstances.length;n++){const i=e.symbolInstances.get(n),o=i.zOffset,a=this._getHeightAtTileOffset(t,i.tileAnchorX,i.tileAnchorY);i.zOffset=a!==Number.NEGATIVE_INFINITY?a:o,r||o===i.zOffset||(r=!0),e.hasAnyZOffset||0===i.zOffset||(e.hasAnyZOffset=!0)}r&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,n,i){let o=r,a=n;if(t.canonical.z!==i.canonical.z){const s=i.canonical,l=1/(1<<t.canonical.z-s.z);o=(r+t.canonical.x*e.al)*l-s.x*e.al|0,a=(n+t.canonical.y*e.al)*l-s.y*e.al|0}return{tileX:o,tileY:a}}_getHeightAtTileOffset(e,t,r){let n,i;for(let o=0;o<this.layers.length;++o){const a=this.layers[o].layer;if("fill-extrusion"!==a.type&&"building"!==a.type)continue;const{bucket:s,tileID:l,verticalScale:c}=this.currentBuildingBuckets[o];if(!s)continue;const{tileX:u,tileY:d}=this._mapCoordToOverlappingTile(e,t,r,l),h=s.getHeightAtTileCoord(u,d);h&&void 0!==h.height&&(h.hidden?n=h.height:i=Math.max(h.height*c,i||0))}if(void 0!==i)return i;for(let o=0;o<this.layers.length;++o){const i=this.layers[o];if("model"!==i.layer.type||!i.visible)continue;const{bucket:a,tileID:s}=this.currentBuildingBuckets[o];if(!a)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,r,s),u=a.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==n?Math.min(u.maxHeight,n)*u.verticalScale:u.height?u.height*u.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Ht(t,r){const n={};for(const e in t)"ref"!==e&&(n[e]=t[e]);return e.bx.forEach(e=>{e in r&&(n[e]=r[e])}),n}function Gt(e){e=e.slice();const t=Object.create(null);for(let r=0;r<e.length;r++)t[e[r].id]=e[r];for(let r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=Ht(e[r],t[e[r].ref]));return e}const Kt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Wt(e,t,r){r.push({command:Kt.addSource,args:[e,t[e]]})}function qt(e,t,r){t.push({command:Kt.removeSource,args:[e]}),r[e]=!0}function Zt(e,t,r,n){qt(e,r,n),Wt(e,t,r)}function Xt(t,r,n){let i;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!e.by(t[n][i],r[n][i]))return!1;for(i in r[n])if(r[n].hasOwnProperty(i)&&"data"!==i&&!e.by(t[n][i],r[n][i]))return!1;return!0}function Yt(t,r,n,i,o,a){let s;for(s in r=r||{},t=t||{})t.hasOwnProperty(s)&&(e.by(t[s],r[s])||n.push({command:a,args:[i,s,r[s],o]}));for(s in r)r.hasOwnProperty(s)&&!t.hasOwnProperty(s)&&(e.by(t[s],r[s])||n.push({command:a,args:[i,s,r[s],o]}))}function Jt(e){return e.id}function $t(e,t){return e[t.id]=t,e}function er(t,r,n){const i=r.createTileMatrix(t,t.worldSize,n.toUnwrapped());return e.aB(new Float32Array(16),t.projMatrix,i)}function tr(e,t,r){if(t.projection.name===r.projection.name)return e.projMatrix;const n=r.clone();return n.setProjection(t.projection),er(n,t.getProjection(),e)}function rr(e,t,r){return t.name===r.projection.name?e.projMatrix:er(r,t,e)}class nr{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.aA(t,0,1);let r=1,n=this._distances[r];const i=t*this.paddedLength+this.padding;for(;n<i&&r<this._distances.length;)n=this._distances[++r];const o=r-1,a=this._distances[o],s=n-a,l=s>0?(i-a)/s:0;return this.points[o].mult(1-l).add(this.points[r].mult(l))}}class ir{constructor(e,t,r){const n=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(t/r);for(let o=0;o<this.xCellCount*this.yCellCount;o++)n.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)}insertCircle(e,t,r,n){this._forEachCell(t-n,r-n,t+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(r),this.circles.push(n)}_insertBoxCell(e,t,r,n,i,o){this.boxCells[i].push(o)}_insertCircleCell(e,t,r,n,i,o){this.circleCells[i].push(o)}_query(e,t,r,n,i,o){if(r<0||e>this.width||n<0||t>this.height)return!i&&[];const a=[];if(e<=0&&t<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(let e=0;e<this.boxKeys.length;e++)a.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],r=this.circles[3*e+1],n=this.circles[3*e+2];a.push({key:this.circleKeys[e],x1:t-n,y1:r-n,x2:t+n,y2:r+n})}return o?a.filter(o):a}return this._forEachCell(e,t,r,n,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a}_queryCircle(e,t,r,n,i){const o=e-r,a=e+r,s=t-r,l=t+r;if(a<0||o>this.width||l<0||s>this.height)return!n&&[];const c=[];return this._forEachCell(o,s,a,l,this._queryCellCircle,c,{hitTest:n,circle:{x:e,y:t,radius:r},seenUids:{box:{},circle:{}}},i),n?c.length>0:c}query(e,t,r,n,i){return this._query(e,t,r,n,!1,i)}hitTest(e,t,r,n,i){return this._query(e,t,r,n,!0,i)}hitTestCircle(e,t,r,n){return this._queryCircle(e,t,r,!0,n)}_queryCell(e,t,r,n,i,o,a,s){const l=a.seenUids,c=this.boxCells[i];if(null!==c){const i=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=i[c+2]&&t<=i[c+3]&&r>=i[c+0]&&n>=i[c+1]&&(!s||s(this.boxKeys[u]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:i[c],y1:i[c+1],x2:i[c+2],y2:i[c+3]})}}}const u=this.circleCells[i];if(null!==u){const i=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(i[u],i[u+1],i[u+2],e,t,r,n)&&(!s||s(this.circleKeys[c]))){if(a.hitTest)return o.push(!0),!0;{const e=i[u],t=i[u+1],r=i[u+2];o.push({key:this.circleKeys[c],x1:e-r,y1:t-r,x2:e+r,y2:t+r})}}}}}_queryCellCircle(e,t,r,n,i,o,a,s){const l=a.circle,c=a.seenUids,u=this.boxCells[i];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const r=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[r+0],e[r+1],e[r+2],e[r+3])&&(!s||s(this.boxKeys[t])))return o.push(!0),!0}}const d=this.circleCells[i];if(null!==d){const e=this.circles;for(const t of d)if(!c.circle[t]){c.circle[t]=!0;const r=3*t;if(this._circlesCollide(e[r],e[r+1],e[r+2],l.x,l.y,l.radius)&&(!s||s(this.circleKeys[t])))return o.push(!0),!0}}}_forEachCell(e,t,r,n,i,o,a,s){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(r),d=this._convertToYCellCoord(n);for(let h=l;h<=u;h++)for(let l=c;l<=d;l++)if(i.call(this,e,t,r,n,this.xCellCount*l+h,o,a,s))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,r,n,i,o){const a=n-e,s=i-t,l=r+o;return l*l>a*a+s*s}_circleAndRectCollide(e,t,r,n,i,o,a){const s=(o-n)/2,l=Math.abs(e-(n+s));if(l>s+r)return!1;const c=(a-i)/2,u=Math.abs(t-(i+c));if(u>c+r)return!1;if(l<=s||u<=c)return!0;const d=l-s,h=u-c;return d*d+h*h<=r*r}}const or={unknown:0,flipRequired:1,flipNotRequired:2},ar=Math.tan(85*Math.PI/180);function sr(t,r,n,i,o,a,s){const l=e.bC();if(n)if("globe"===a.name){const t=e.bD(o,r);e.aB(l,l,t)}else{const t=e.bE([],s);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],i||e.bB(l,l,o.angle)}else e.aB(l,o.labelPlaneMatrix,t);return l}function lr(e,t,r,n,i,o,a){const s=sr(e,t,r,n,i,o,a);return"globe"===o.name&&r||(s[2]=s[6]=s[10]=s[14]=0),s}function cr(t,r,n,i,o,a,s){if(n){if("globe"===a.name){const l=sr(t,r,n,i,o,a,s);return e.bl(l,l),e.aB(l,t,l),l}{const r=e.bz(t),n=e.bA([]);return n[0]=s[0],n[1]=s[1],n[4]=s[2],n[5]=s[3],e.aB(r,r,n),i||e.bB(r,r,-o.angle),r}}return o.glCoordMatrix}function ur(t,r,n,i){const o=[t,r,n,1];n?e.aC(o,o,i):xr(o,o,i);const a=o[3];return o[0]/=a,o[1]/=a,o[2]/=a,o}function dr(e,t){return Math.min(.5+e/t*.5,1.5)}function hr(e,t){const r=e[0]/e[3],n=e[1]/e[3];return r>=-t[0]&&r<=t[0]&&n>=-t[1]&&n<=t[1]}function Ar(t,r,n,i,o,a,s,l,c,u){let d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1;const h=n.transform,A=i?t.textSizeData:t.iconSizeData,f=e.bK(A,n.transform.zoom,d),p="globe"===h.projection.name,m=[256/n.width*2+1,256/n.height*2+1],g=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;g.clear();let y=null;p&&(y=i?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const _=t.lineVertexArray,v=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,x=n.transform.width/n.transform.height;let w,b=!1;for(let B=0;B<v.length;B++){const i=v.get(B),{numGlyphs:d,writingMode:p}=i;if(p!==e.bL.vertical||b||w===e.bL.horizontal||(b=!0),w=p,(i.hidden||p===e.bL.vertical)&&!b){vr(d,g);continue}b=!1;const C=new e.P(i.tileAnchorX,i.tileAnchorY),E="road"===t.elevationType,S=!!h.elevation||E;let{x:T,y:I,z:F}=h.projection.projectTilePoint(C.x,C.y,u.canonical),k=null;if(S){const e=E?t.getElevationFeatureForText(B):null;k={getElevation:c,elevation:h.elevation,elevationFeature:e};const[r,n,i]=c(C,h.elevation,e);T+=r,I+=n,F+=i}const P=[T,I,F,1];if(e.aC(P,P,r),!hr(P,m)){vr(d,g);continue}const M=P[3],O=dr(n.transform.getCameraToCenterDistance(h.projection),M),L=e.bM(A,f,i),D=s?L/O:L*O,U=ur(T,I,F,o);if(U[3]<=0){vr(d,g);continue}let R={};const z=e.an(t.layers[0].layout.get("text-max-angle")),N=Math.cos(z),j=s?null:k,Q=mr(i,D,!1,l,r,o,a,t.glyphOffsetArray,_,g,y,U,C,R,x,j,h.projection,u,s,N);b=Q.useVertical,j&&Q.needsFlipping&&(R={}),(Q.notEnoughRoom||b||Q.needsFlipping&&mr(i,D,!0,l,r,o,a,t.glyphOffsetArray,_,g,y,U,C,R,x,j,h.projection,u,s,N).notEnoughRoom)&&vr(d,g)}i?(t.text.dynamicLayoutVertexBuffer.updateData(g),y&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(y)):(t.icon.dynamicLayoutVertexBuffer.updateData(g),y&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(y))}function fr(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m){const{lineStartIndex:g,glyphStartIndex:y,segment:_}=s,v=y+s.numGlyphs,x=g+s.lineLength,w=t.getoffsetX(y),b=t.getoffsetX(v-1),B=_r(e*w,r,n,i,o,a,_,g,x,l,c,u,d,h,!0,A,f,p,m);if(!B)return null;const C=_r(e*b,r,n,i,o,a,_,g,x,l,c,u,d,h,!0,A,f,p,m);return C?{first:B,last:C}:null}function pr(t,r,n,i){return t===e.bL.horizontal&&Math.abs(i)>Math.abs(n)?{useVertical:!0}:t===e.bL.vertical?i>0?{needsFlipping:!0}:null:r!==or.unknown&&function(e,t){return 0===e||Math.abs(t/e)>ar}(n,i)?r===or.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function mr(t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v){const x=r/24,w=t.lineOffsetX*x,b=t.lineOffsetY*x,{lineStartIndex:B,glyphStartIndex:C,numGlyphs:E,segment:S,writingMode:T,flipState:I}=t,F=B+t.lineLength,k=t=>{if(d){const[r,n,i]=t.up,o=u.length;e.bN(d,o+0,r,n,i),e.bN(d,o+1,r,n,i),e.bN(d,o+2,r,n,i),e.bN(d,o+3,r,n,i)}const[r,n,i]=t.point;e.bO(u,r,n,i,t.angle)};if(E>1){const e=fr(x,l,w,b,n,h,A,t,c,a,f,m,!1,g,y,_,v);if(!e)return{notEnoughRoom:!0};if(i&&!n){let[r,n,i]=e.first.point,[o,a,l]=e.last.point;[r,n]=ur(r,n,i,s),[o,a]=ur(o,a,l,s);const c=pr(T,I,(o-r)*p,a-n);if(t.flipState=c&&c.needsFlipping?or.flipRequired:or.flipNotRequired,c)return c}k(e.first);for(let t=C+1;t<C+E-1;t++){const e=_r(x*l.getoffsetX(t),w,b,n,h,A,S,B,F,c,a,f,m,!1,!1,g,y,_,v);if(!e)return u.length-=4*(t-C),{notEnoughRoom:!0};k(e)}k(e.last)}else{if(i&&!n){const r=ur(A.x,A.y,0,o),n=B+S+1,i=new e.P(c.getx(n),c.gety(n)),a=ur(i.x,i.y,0,o),s=a[3]>0?a:yr(A,i,r,1,o,void 0,g,y.canonical),l=pr(T,I,(s[0]-r[0])*p,s[1]-r[1]);if(t.flipState=l&&l.needsFlipping?or.flipRequired:or.flipNotRequired,l)return l}const r=_r(x*l.getoffsetX(C),w,b,n,h,A,S,B,F,c,a,f,m,!1,!1,g,y,_,v);if(!r)return{notEnoughRoom:!0};k(r)}return{}}function gr(e,t,r,n,i){const{x:o,y:a,z:s}=n.projectTilePoint(e.x,e.y,t);if(!i)return ur(o,a,s,r);const[l,c,u]=i.getElevation(e,i.elevation,i.elevationFeature);return ur(o+l,a+c,s+u,r)}function yr(t,r,n,i,o,a,s,l){const c=gr(t.sub(r)._unit()._add(t),l,o,s,a);return e.av(c,n,c),e.aw(c,c),e.bH(c,n,c,i)}function _r(t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_){const v=i?t-r:t+r;let x=v>0?1:-1,w=0;i&&(x*=-1,w=Math.PI),x<0&&(w+=Math.PI);let b=l+s+(x>0?0:1)|0,B=o,C=o,E=0,S=0;const T=Math.abs(v),I=[],F=[];let k=a,P=k,M=e.bF([]);const O=()=>yr(P,k,C,T-E+1,d,A,m,g.canonical);for(;E+S<=T;){if(b+=x,b<l||b>=c)return null;if(C=B,P=k,I.push(C),f&&F.push(P),k=new e.P(u.getx(b),u.gety(b)),B=h[b],!B){const e=gr(k,g.canonical,d,m,A);B=e[3]>0?h[b]=e:O()}E+=S;const t=e.av([],B,C),r=e.bG(C,B);if(n&&r>0&&S>0&&e.bJ(M,t)/(S*r)<_)return null;S=r,M=t}p&&A&&(h[b]&&(B=O(),S=e.bG(C,B),M=e.av([],B,C)),h[b]=B);const L=(T-E)/S,D=k.sub(P)._mult(L)._add(P),U=e.bH([],C,M,L);let R=[0,0,1],z=M[0],N=M[1];if(y&&(R=m.upVector(g.canonical,D.x,D.y),0!==R[0]||0!==R[1]||1!==R[2])){const t=[R[2],0,-R[0]],r=e.bI([],R,t);e.aw(t,t),e.aw(r,r),z=e.bJ(M,t),N=e.bJ(M,r)}if(n){const t=e.bI([],R,M);e.aw(t,t),e.bH(U,U,t,n*x)}const j=w+Math.atan2(N,z);return I.push(U),f&&F.push(D),{point:U,angle:j,path:I,tilePath:F,up:R}}function vr(e,t){const r=t.length,n=r+4*e;t.resize(n),t.float32.fill(-1/0,4*r,4*n)}function xr(e,t,r){const n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e[3]=r[3]*n+r[7]*i+r[15],e}const wr=100;class br{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ir(e.width+200,e.height+200,25),n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ir(e.width+200,e.height+200,25);this.transform=e,this.grid=r,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+wr,this.screenBottomBoundary=e.height+wr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(t,r,n,i,o,a,s,l,c,u,d){let h=n.projectedAnchorX,A=n.projectedAnchorY,f=n.projectedAnchorZ;const p=n.tileAnchorX,m=n.tileAnchorY,g=n.elevation,y=n.tileID,_=t.getProjection();if(g&&y){const[e,t,r]=_.upVector(y.canonical,n.tileAnchorX,n.tileAnchorY),i=_.upVectorScale(y.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;h+=e*g*i,A+=t*g*i,f+=r*g*i}const v="globe"===t.projection.name,x="globe"===t.projection.name?e.aj(this.transform.zoom):0;if(y&&v&&x<1&&!a){const t=1<<y.canonical.z,r=e.bP(p,m);e.bQ(r,r,1/e.al),e.bR(r,r,e.bP(y.canonical.x,y.canonical.y)),e.bQ(r,r,1/t),e.bS(r,r,e.bP(i[0],i[1])),r[0]=e.bT(r[0],-.5,.5),e.bQ(r,r,e.al);const n=e.bU(r[0],r[1],e.al/(2*Math.PI),1);e.aC(n,n,o),h=e.ak(h,n[0],x),A=e.ak(A,n[1],x),f=e.ak(f,n[2],x)}const w=this.projectAndGetPerspectiveRatio(u,h,A,f,n.tileID,"globe"===_.name||!!g||this.transform.pitch>0,_),b=c*w.perspectiveRatio,B=(n.x1*r+s.x-n.padding)*b+w.point.x,C=(n.y1*r+s.y-n.padding)*b+w.point.y,E=(n.x2*r+s.x+n.padding)*b+w.point.x,S=(n.y2*r+s.y+n.padding)*b+w.point.y,T=w.perspectiveRatio<=.55||w.occluded;return!this.isInsideGrid(B,C,E,S)||!l&&this.grid.hitTest(B,C,E,S,d)||T?{box:[],offscreen:!1,occluded:w.occluded}:{box:[B,C,E,S],offscreen:this.isOffscreen(B,C,E,S),occluded:!1}}placeCollisionCircles(t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m){const g=[],y=this.transform.elevation,_=t.getProjection(),v="road"===t.elevationType,x=!!y||v,w=e.bV.getAtTileOffsetFunc(m,this.transform.center.lat,this.transform.worldSize,_),b=new e.P(n.tileAnchorX,n.tileAnchorY),B=new e.P(n.tileAnchorX,n.tileAnchorY);let{x:C,y:E,z:S}=_.projectTilePoint(B.x,B.y,m.canonical),T=null;if(x){const e=v?t.getElevationFeatureForText(i):null;T={getElevation:w,elevation:y,elevationFeature:e};const[r,n,o]=w(b,y,e);C+=r,E+=n,S+=o}const I="globe"===_.name,F=this.projectAndGetPerspectiveRatio(l,C,E,S,m,I||!!y||this.transform.pitch>0,_),{perspectiveRatio:k}=F,P=(h?s/k:s*k)/e.bY,M=ur(C,E,S,c),O=n.lineOffsetX*P,L=n.lineOffsetY*P,D=e.an(t.layers[0].layout.get("text-max-angle")),U=Math.cos(D),R=F.signedDistanceFromCamera>0?fr(P,a,O,L,v&&1===n.flipState,M,B,n,o,c,{},x&&!h?T:null,h&&x,_,m,h,U):null;let z=!1,N=!1,j=!0;if(R&&!F.occluded){const t=.5*f*k+p,n=new e.P(-100,-100),i=new e.P(this.screenRightBoundary,this.screenBottomBoundary),o=new nr,{first:a,last:s}=R,l=a.path.length;let c=[];for(let e=l-1;e>=1;e--)c.push(a.path[e]);for(let e=1;e<s.path.length;e++)c.push(s.path[e]);const h=2.5*t;u&&(c=c.map((e,t)=>{let[r,n,i]=e;return x&&!I&&(i=w(t<l-1?a.tilePath[l-1-t]:s.tilePath[t-l+2],y,T.elevationFeature)[2]),ur(r,n,i,u)}),c.some(e=>e[3]<=0)&&(c=[]));let m=[];if(c.length>0){let t=1/0,r=-1/0,o=1/0,a=-1/0;for(const e of c)t=Math.min(t,e[0]),o=Math.min(o,e[1]),r=Math.max(r,e[0]),a=Math.max(a,e[1]);r>=n.x&&t<=i.x&&a>=n.y&&o<=i.y&&(m=[c.map(t=>new e.P(t[0],t[1]))],(t<n.x||r>i.x||o<n.y||a>i.y)&&(m=e.bW(m,n.x,n.y,i.x,i.y)))}for(const e of m){o.reset(e,.25*t);let n=0;n=o.length<=.5*t?1:Math.ceil(o.paddedLength/h)+1;for(let e=0;e<n;e++){const i=e/Math.max(n-1,1),a=o.lerp(i),s=a.x+wr,l=a.y+wr;g.push(s,l,t,0);const c=s-t,u=l-t,h=s+t,f=l+t;if(j=j&&this.isOffscreen(c,u,h,f),N=N||this.isInsideGrid(c,u,h,f),!r&&this.grid.hitTestCircle(s,l,t,A)&&(z=!0,!d))return{circles:[],offscreen:!1,collisionDetected:z,occluded:!1}}}}return{circles:!d&&z||!N?[]:g,offscreen:j,collisionDetected:z,occluded:F.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const r=[];let n=1/0,i=1/0,o=-1/0,a=-1/0;for(const u of t){const t=new e.P(u.x+wr,u.y+wr);n=Math.min(n,t.x),i=Math.min(i,t.y),o=Math.max(o,t.x),a=Math.max(a,t.y),r.push(t)}const s=this.grid.query(n,i,o,a).concat(this.ignoredGrid.query(n,i,o,a)),l={},c={};for(const u of s){const t=u.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const n=[new e.P(u.x1,u.y1),new e.P(u.x2,u.y1),new e.P(u.x2,u.y2),new e.P(u.x1,u.y2)];e.bX(r,n)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,r,n,i){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,r,n,i){const o=t?this.ignoredGrid:this.grid,a={bucketInstanceId:r,featureIndex:n,collisionGroupID:i};for(let s=0;s<e.length;s+=4)o.insertCircle(a,e[s],e[s+1],e[s+2])}projectAndGetPerspectiveRatio(t,r,n,i,o,a,s){const l=[r,n,i,1];let c=!1;if(i||this.transform.pitch>0){if(e.aC(l,l,t),this.fogState&&o&&"globe"!==s.name){const t=function(t,r,n,i,o,a){const s=a.calculateFogTileMatrix(o),l=[r,n,i];return e.af(l,l,s),qe(t,e.ag(l),a.pitch,a._fov)}(this.fogState,r,n,i,o.toUnwrapped(),this.transform);c=t>.9}}else xr(l,l,t);const u=l[3];return{point:new e.P((l[0]/u+1)/2*this.transform.width+wr,(-l[1]/u+1)/2*this.transform.height+wr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(s)/u*.5,1.5),signedDistanceFromCamera:u,occluded:a&&l[2]>u||c}}isOffscreen(e,t,r,n){return r<wr||e>=this.screenRightBoundary||n<wr||t>this.screenBottomBoundary}isInsideGrid(e,t,r,n){return r>=0&&e<this.gridRightBoundary&&n>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.bA([]);return e.br(t,t,[-100,-100,0]),t}}class Br{constructor(e,t,r,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):n&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class Cr{constructor(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new Br(e?e.text:null,t,r,i),this.icon=new Br(e?e.icon:null,t,n,i),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Er{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=r,this.clipped=n}}class Sr{constructor(){this.invProjMatrix=e.bC(),this.viewportMatrix=e.bC(),this.circles=[]}}class Tr{constructor(e,t,r,n,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=i}}class Ir{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Fr(t,r,n,i,o){const{horizontalAlign:a,verticalAlign:s}=e.c1(t),l=-(a-.5)*r,c=-(s-.5)*n,u=e.c2(t,i);return new e.P(l+u[0]*o,c+u[1]*o)}function kr(t,r,n,i,o){const a=new e.P(t,r);return n&&a._rotate(i?o:-o),a}class Pr{constructor(e,t,r,n,i,o){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new br(this.transform,i),this.buildingIndex=o,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Ir(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,r,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const a=n.getBucket(r),s=n.latestFeatureIndex;if(!a||!s||r.fqid!==a.layerIds[0])return;const l=a.layers[0].layout,c=a.layers[0].paint,u=n.collisionBoxArray,d=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),h=n.tileSize/e.al,A=n.tileID.toUnwrapped();this.transform.setProjection(a.projection);const f=(p=n.tileID,m=a.getProjection(),g=this.transform,m.name===this.projection?g.calculateProjMatrix(p.toUnwrapped()):er(g,m,p));var p,m,g;const y="map"===l.get("text-pitch-alignment"),_="map"===l.get("text-rotation-alignment");r.compileFilter(r.options);const v=r.dynamicFilter(),x=r.dynamicFilterNeedsFeature(),w=this.transform.calculatePixelsToTileUnitsMatrix(n),b=lr(f,n.tileID.canonical,y,_,this.transform,a.getProjection(),w);let B=null;const C=a.getProjection().createInversionMatrix(this.transform,n.tileID.canonical);if(y){const t=cr(f,n.tileID.canonical,y,_,this.transform,a.getProjection(),w);B=e.aB([],this.transform.labelPlaneMatrix,t)}let E=null;v&&n.latestFeatureIndex&&(E={unwrappedTileID:A,dynamicFilter:v,dynamicFilterNeedsFeature:x}),this.retainedQueryData[a.bucketInstanceId]=new Tr(a.bucketInstanceId,s,a.sourceLayerIndex,a.index,n.tileID);const[S,T]=a.layers[0].layout.get("text-size-scale-range"),I=e.aA(o,S,T),[F,k]=l.get("icon-size-scale-range"),P=e.aA(o,F,k),M={bucket:a,layout:l,paint:c,posMatrix:f,invMatrix:C,mercatorCenter:[e.aF(this.transform.center.lng),e.aJ(this.transform.center.lat)],textLabelPlaneMatrix:b,labelToScreenMatrix:B,clippingData:E,scale:d,textPixelRatio:h,holdingForFade:n.holdingForFade(),collisionBoxArray:u,partiallyEvaluatedTextSize:e.bK(a.textSizeData,this.transform.zoom,I),partiallyEvaluatedIconSize:e.bK(a.iconSizeData,this.transform.zoom,P),collisionGroup:this.collisionGroups.get(a.sourceID),latestFeatureIndex:n.latestFeatureIndex};if(i)for(const e of a.sortKeyRanges){const{sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:i}=e;t.push({sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:i,parameters:M})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:a.symbolInstances.length,parameters:M})}attemptAnchorPlacement(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v){const{textOffset0:x,textOffset1:w,crossTileID:b}=f,B=[x,w],C=Fr(e,o,a,B,s),E=this.collisionIndex.placeCollisionBox(m,s,t,r,n,i,kr(C.x,C.y,l,c,this.transform.angle),A,u,d,h.predicate);if(y){const e=m.getSymbolInstanceIconSize(v,this.transform.zoom,f.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(m,e,y,r,n,i,kr(C.x,C.y,l,c,this.transform.angle),A,u,d,h.predicate).box.length)return}if(E.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[b]&&this.prevPlacement.placements[b]&&this.prevPlacement.placements[b].text&&(t=this.prevPlacement.variableOffsets[b].anchor),this.variableOffsets[b]={textOffset:B,width:o,height:a,anchor:e,textScale:s,prevAnchor:t},this.markUsedJustification(m,e,f,g),m.allowVerticalPlacement&&(this.markUsedOrientation(m,g,f),this.placedOrientations[b]=g),{shift:C,placedGlyphBoxes:E}}}placeLayerBucketPart(t,r,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const{bucket:a,layout:s,paint:l,posMatrix:c,textLabelPlaneMatrix:u,labelToScreenMatrix:d,clippingData:h,textPixelRatio:A,mercatorCenter:f,invMatrix:p,holdingForFade:m,collisionBoxArray:g,partiallyEvaluatedTextSize:y,partiallyEvaluatedIconSize:_,collisionGroup:v,latestFeatureIndex:x}=t.parameters,w=s.get("text-optional"),b=s.get("icon-optional"),B=s.get("text-allow-overlap"),C=s.get("icon-allow-overlap"),E="map"===s.get("text-rotation-alignment"),S="map"===s.get("icon-rotation-alignment"),T="map"===s.get("text-pitch-alignment"),I=l.get("symbol-z-offset"),F="sea"===s.get("symbol-elevation-reference"),k=s.get("symbol-placement"),[P,M]=s.get("text-size-scale-range"),[O,L]=s.get("icon-size-scale-range"),D=e.aA(o,P,M),U=e.aA(o,O,L),R=s.get("text-variable-anchor"),z=E&&"point"!==k,N=S&&"point"!==k,j=R&&a.hasTextData(),Q=a.hasIconTextFit()&&j&&a.hasIconData();this.transform.setProjection(a.projection);const V=j||z,H=N||Q;let G=B&&(C||!a.hasIconData()||b),K=C&&(B||!a.hasTextData()||w);const W=!I.isConstant();!a.collisionArrays&&g&&a.deserializeCollisionBoxes(g),n&&i&&a.updateCollisionDebugBuffers(this.transform.zoom,g,D,U);const q=(t,i,o)=>{const{crossTileID:l,numVerticalGlyphVertices:g}=t;let S=null;if(h&&h.dynamicFilterNeedsFeature||W){const e=this.retainedQueryData[a.bucketInstanceId];S=x.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0});const r=S.properties?S.properties.worldview:null;if(a.localizable&&a.worldview&&"string"==typeof r)if("all"===r)S.properties.$localized=!0;else{if(!r.split(",").includes(a.worldview))return;S.properties.$localized=!0,S.properties.worldview=a.worldview}}if(h&&!(0,h.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:a.worldview},S,this.retainedQueryData[a.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(h.unwrappedTileID)))return this.placements[l]=new Er(!1,!1,!1,!0),void r.add(l);const k=I.evaluate(S,{});if(r.has(l))return;if(m)return void(this.placements[l]=new Er(!1,!1,!1));let P=!1,M=!1,O=!0,L=!1,D=!1,U=null,z={box:null,offscreen:null,occluded:null},N={box:null},j=null,Q=null,q=null,Z=0,X=0,Y=0;o.textFeatureIndex?Z=o.textFeatureIndex:t.useRuntimeCollisionCircles&&(Z=t.featureIndex),o.verticalTextFeatureIndex&&(X=o.verticalTextFeatureIndex);const J=a.elevationFeatures?a.elevationFeatures[t.elevationFeatureIndex]:void 0,$=r=>{r.tileID=this.retainedQueryData[a.bucketInstanceId].tileID;const n=this.transform.elevation;r.elevation=F?k:k+e.bV.getAtTileOffset(r.tileID,new e.P(r.tileAnchorX,r.tileAnchorY),n,J),r.elevation+=t.zOffset},ee=o.textBox;if(ee){$(ee);const r=r=>{let n=e.bL.horizontal;if(a.allowVerticalPlacement&&!r&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[l];e&&(this.placedOrientations[l]=e,n=e,this.markUsedOrientation(a,n,t))}return n},n=(t,r)=>{if(a.allowVerticalPlacement&&g>0&&o.verticalTextBox){for(const n of a.writingModes)if(n===e.bL.vertical?(z=r(),N=z):z=t(),z&&z.box&&z.box.length)break}else z=t()};if(R){let s=R;if(this.prevPlacement&&this.prevPlacement.variableOffsets[l]){const e=this.prevPlacement.variableOffsets[l];s.indexOf(e.anchor)>0&&(s=s.filter(t=>t!==e.anchor),s.unshift(e.anchor))}const u=(e,r,n)=>{const o=a.getSymbolInstanceTextSize(y,t,this.transform.zoom,i),l=(e.x2-e.x1)*o+2*e.padding,u=(e.y2-e.y1)*o+2*e.padding,d=t.hasIconTextFit&&!C?r:null;d&&$(d);let h={box:[],offscreen:!1,occluded:!1};const m=B?2*s.length:s.length;for(let g=0;g<m;++g){const r=this.attemptAnchorPlacement(s[g%s.length],e,f,p,V,l,u,o,E,T,A,c,v,g>=s.length,t,i,a,n,d,y,_);if(r&&(h=r.placedGlyphBoxes,h&&h.box&&h.box.length)){P=!0,U=r.shift;break}}return h};n(()=>u(ee,o.iconBox,e.bL.horizontal),()=>{const t=o.verticalTextBox;return t&&$(t),a.allowVerticalPlacement&&!(z&&z.box&&z.box.length)&&g>0&&t?u(t,o.verticalIconBox,e.bL.vertical):{box:null,offscreen:null,occluded:null}}),z&&(P=z.box,O=z.offscreen,L=z.occluded);const d=r(!(!z||!z.box));if(!P&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[l];e&&(this.variableOffsets[l]=e,this.markUsedJustification(a,e.anchor,t,d))}}else{const s=(r,n)=>{const o=a.getSymbolInstanceTextSize(y,t,this.transform.zoom,i),s=this.collisionIndex.placeCollisionBox(a,o,r,f,p,V,new e.P(0,0),B,A,c,v.predicate);return s&&s.box&&s.box.length&&(this.markUsedOrientation(a,n,t),this.placedOrientations[l]=n),s};n(()=>s(ee,e.bL.horizontal),()=>{const t=o.verticalTextBox;return a.allowVerticalPlacement&&g>0&&t?($(t),s(t,e.bL.vertical)):{box:null,offscreen:null,occluded:null}}),r(!!(z&&z.box&&z.box.length))}}if(j=z,P=j&&j.box&&j.box.length>0,O=j&&j.offscreen,L=j&&j.occluded,t.useRuntimeCollisionCircles){const r=t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex,i=a.text.placedSymbolArray.get(r),o=e.bM(a.textSizeData,y,i),l=s.get("text-padding");Q=this.collisionIndex.placeCollisionCircles(a,B,i,r,a.lineVertexArray,a.glyphOffsetArray,o,c,u,d,n,T,v.predicate,t.collisionCircleDiameter*o/e.bY,l,this.retainedQueryData[a.bucketInstanceId].tileID),P=B||Q.circles.length>0&&!Q.collisionDetected,O=O&&Q.offscreen,L=Q.occluded}if(o.iconFeatureIndex&&(Y=o.iconFeatureIndex),o.iconBox){const r=r=>{$(r);const n=t.hasIconTextFit&&U?kr(U.x,U.y,E,T,this.transform.angle):new e.P(0,0),i=a.getSymbolInstanceIconSize(_,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(a,i,r,f,p,H,n,C,A,c,v.predicate)};N&&N.box&&N.box.length&&o.verticalIconBox?(q=r(o.verticalIconBox),M=q.box.length>0):(q=r(o.iconBox),M=q.box.length>0),O=O&&q.offscreen,D=q.occluded}const te=w||0===t.numHorizontalGlyphVertices&&0===g,re=b||0===t.numIconVertices;if(te||re?re?te||(M=M&&P):P=M&&P:M=P=M&&P,P&&j&&j.box&&this.collisionIndex.insertCollisionBox(j.box,s.get("text-ignore-placement"),a.bucketInstanceId,N&&N.box&&X?X:Z,v.ID),M&&q&&this.collisionIndex.insertCollisionBox(q.box,s.get("icon-ignore-placement"),a.bucketInstanceId,Y,v.ID),Q&&(P&&this.collisionIndex.insertCollisionCircles(Q.circles,s.get("text-ignore-placement"),a.bucketInstanceId,Z,v.ID),n)){const e=a.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Sr);for(let r=0;r<Q.circles.length;r+=4)t.circles.push(Q.circles[r+0]),t.circles.push(Q.circles[r+1]),t.circles.push(Q.circles[r+2]),t.circles.push(Q.collisionDetected?1:0)}const ne="globe"!==a.projection.name;G=G&&(ne||!L),K=K&&(ne||!D),this.placements[l]=new Er(P||G,M||K,O||a.justReloaded),r.add(l)},Z=this.retainedQueryData[a.bucketInstanceId].tileID;if("offset"===a.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(a,Z),"road"===a.elevationType&&a.updateRoadElevation(Z.canonical),a.updateZOffset(),a.sortFeaturesByY){const t=a.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const r=t[e];q(a.symbolInstances.get(r),r,a.collisionArrays[r])}a.hasAnyZOffset&&e.w("".concat(a.layerIds[0]," layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y"))}else if(a.hasAnyZOffset){const e=a.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const r=e[t];q(a.symbolInstances.get(r),r,a.collisionArrays[r])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)q(a.symbolInstances.get(e),e,a.collisionArrays[e]);if(n&&a.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[a.bucketInstanceId];e.bl(t.invProjMatrix,c),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1}markUsedJustification(t,r,n,i){const{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:s,verticalPlacedTextSymbolIndex:l,crossTileID:c}=n,u=e.c3(r),d=i===e.bL.vertical?l:"left"===u?o:"center"===u?a:"right"===u?s:-1;o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=d>=0&&o!==d?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=d>=0&&a!==d?0:c),s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=d>=0&&s!==d?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=d>=0&&l!==d?0:c)}markUsedOrientation(t,r,n){const i=r===e.bL.horizontal||r===e.bL.horizontalOnly?r:0,o=r===e.bL.vertical?r:0,{leftJustifiedTextSymbolIndex:a,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=n,u=t.text.placedSymbolArray;a>=0&&(u.get(a).placedOrientation=i),s>=0&&(u.get(s).placedOrientation=i),l>=0&&(u.get(l).placedOrientation=i),c>=0&&(u.get(c).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let r=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const n=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},o=t?t.variableOffsets:{},a=t?t.placedOrientations:{};for(const s in this.placements){const e=this.placements[s],t=i[s];t?(this.opacities[s]=new Cr(t,n,e.text,e.icon,null,e.clipped),r=r||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[s]=new Cr(null,n,e.text,e.icon,e.skipFade,e.clipped),r=r||e.text||e.icon)}for(const s in i){const e=i[s];if(!this.opacities[s]){const t=new Cr(e,n,!1,!1);t.isHidden()||(this.opacities[s]=t,r=r||e.text.placed||e.icon.placed)}}for(const s in o)this.variableOffsets[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.variableOffsets[s]=o[s]);for(const s in a)this.placedOrientations[s]||!this.opacities[s]||this.opacities[s].isHidden()||(this.placedOrientations[s]=a[s]);r?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t,r,n){n&&(this.lastReplacementSourceUpdateTime=n.updateTime);const i=new Set;for(const o of t){const t=o.getBucket(e);t&&o.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,i,o,o.collisionBoxArray,r,n,o.tileID,e.scope),"offset"===t.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(t,o.tileID),"road"===t.elevationType&&t.updateRoadElevation(o.tileID.canonical),t.updateZOffset())}}updateBucketOpacities(t,r,n,i,o,a,s,l){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0].layout,u=t.layers[0].paint,d=!!t.layers[0].dynamicFilter(),h=new Cr(null,0,!1,!1,!0),A=c.get("text-allow-overlap"),f=c.get("icon-allow-overlap"),p=c.get("text-variable-anchor"),m="map"===c.get("text-rotation-alignment"),g="map"===c.get("text-pitch-alignment"),y=u.get("symbol-z-offset"),_="sea"===c.get("symbol-elevation-reference"),v=!y.isConstant(),x=new Cr(null,0,A&&(f||!t.hasIconData()||c.get("icon-optional")),f&&(A||!t.hasTextData()||c.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);const w=(e,t,r)=>{for(let n=0;n<t/4;n++)e.opacityVertexArray.emplaceBack(r)};let b=0;a&&t.updateReplacement(s,a);for(let B=0;B<t.symbolInstances.length;B++){const i=t.symbolInstances.get(B),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:u,crossTileID:A,numIconVertices:f,tileAnchorX:C,tileAnchorY:E}=i;let S=null;const T=this.retainedQueryData[t.bucketInstanceId];v&&i&&T&&(S=n.latestFeatureIndex.loadFeature({featureIndex:i.featureIndex,bucketIndex:T.bucketIndex,sourceLayerIndex:T.sourceLayerIndex,layoutVertexArrayOffset:0}));const I=y.evaluate(S,{}),F=r.has(A);let k=this.opacities[A];F?k=h:k||(k=x,this.opacities[A]=k),r.add(A);const P=c>0||u>0,M=f>0,O=this.placedOrientations[A],L=O===e.bL.vertical,D=O===e.bL.horizontal||O===e.bL.horizontalOnly;!P&&!M||k.isHidden()||b++;let U=!1;if((P||M)&&a)for(const r of t.activeReplacements){if(e.bZ(r,o,e.b_.Symbol,l))continue;if(r.min.x>C||C>r.max.x||r.min.y>E||E>r.max.y)continue;const t=e.b$(C,E,s.canonical,r.footprintTileId.canonical);if(U=e.c0(t,r.footprint),U)break}if(P){const e=U?Qr:jr(k.text);w(t.text,c,L?Qr:e),w(t.text,u,D?Qr:e);const r=k.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:s}=i,l=t.text.placedSymbolArray,d=r||L?1:0;n>=0&&(l.get(n).hidden=d),o>=0&&(l.get(o).hidden=d),a>=0&&(l.get(a).hidden=d),s>=0&&(l.get(s).hidden=r||D?1:0);const h=this.variableOffsets[A];h&&this.markUsedJustification(t,h.anchor,i,O);const f=this.placedOrientations[A];f&&(this.markUsedJustification(t,"left",i,f),this.markUsedOrientation(t,f,i))}if(M){const e=U?Qr:jr(k.icon),{placedIconSymbolIndex:r,verticalPlacedIconSymbolIndex:n}=i,o=t.icon.placedSymbolArray,a=k.icon.isHidden()?1:0;r>=0&&(w(t.icon,f,L?Qr:e),o.get(r).hidden=a),n>=0&&(w(t.icon,i.numVerticalIconVertices,D?Qr:e),o.get(n).hidden=a)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const r=t.collisionArrays[B];if(r){let n=new e.P(0,0),o=!0;if(r.textBox||r.verticalTextBox){if(p){const e=this.variableOffsets[A];e?(n=Fr(e.anchor,e.width,e.height,e.textOffset,e.textScale),m&&n._rotate(g?this.transform.angle:-this.transform.angle)):o=!1}d&&(o=!k.clipped),r.textBox&&Mr(t.textCollisionBox.collisionVertexArray,k.text.placed,!o||L,I,_,n.x,n.y),r.verticalTextBox&&Mr(t.textCollisionBox.collisionVertexArray,k.text.placed,!o||D,I,_,n.x,n.y)}const a=o&&Boolean(!D&&r.verticalIconBox);r.iconBox&&Mr(t.iconCollisionBox.collisionVertexArray,k.icon.placed,a,I,_,i.hasIconTextFit?n.x:0,i.hasIconTextFit?n.y:0),r.verticalIconBox&&Mr(t.iconCollisionBox.collisionVertexArray,k.icon.placed,!a,I,_,i.hasIconTextFit?n.x:0,i.hasIconTextFit?n.y:0)}}}if(t.fullyClipped=0===b,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const r=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*r>e}isStale(){return this.stale}setStale(){this.stale=!0}}function Mr(e,t,r,n,i,o,a){e.emplaceBack(t?1:0,r?1:0,o||0,a||0,n,i?1:0),e.emplaceBack(t?1:0,r?1:0,o||0,a||0,n,i?1:0),e.emplaceBack(t?1:0,r?1:0,o||0,a||0,n,i?1:0),e.emplaceBack(t?1:0,r?1:0,o||0,a||0,n,i?1:0)}const Or=Math.pow(2,25),Lr=Math.pow(2,24),Dr=Math.pow(2,17),Ur=Math.pow(2,16),Rr=Math.pow(2,9),zr=Math.pow(2,8),Nr=Math.pow(2,1);function jr(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,r=Math.floor(127*e.opacity);return r*Or+t*Lr+r*Dr+t*Ur+r*Rr+t*zr+r*Nr+t}const Qr=0;class Vr{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,r,n,i,o){const a=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(a,n,e[this._currentTileIndex],this._sortAcrossTiles,o),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,a.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<a.length;){const e=a[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,r,0===e.symbolInstanceStart,o),this._currentPartIndex++,i())return!0}return!1}}class Hr{constructor(e,t,r,n,i,o,a,s,l){this.placement=new Pr(e,i,o,a,s,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(t,r,n,i,o){const a=e.o.now(),s=()=>{const t=e.o.now()-a;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const a=r[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===a.type&&"none"!==a.visibility&&(!a.minzoom||a.minzoom<=l)&&(!a.maxzoom||a.maxzoom>l)){const t=a,r=t.layout.get("symbol-z-elevate"),l=void 0!==t.layout.get("symbol-sort-key").constantOr(1),c=t.layout.get("symbol-z-order"),u="viewport-y"===c||"auto"===c&&!("viewport-y"!==c&&l),d=t.layout.get("text-allow-overlap")||t.layout.get("icon-allow-overlap")||t.layout.get("text-ignore-placement")||t.layout.get("icon-ignore-placement"),h=u&&d,A=this._inProgressLayer=this._inProgressLayer||new Vr(t),f=e.B(a.source,a.scope);if(A.continuePlacement(r||h?i[f]:n[f],this.placement,this._showCollisionBoxes,a,s,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Gr=512/e.al/2;class Kr{constructor(t,r,n){this.tileID=t,this.bucketInstanceId=n,this.index=new e.c4(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const i=t.canonical.x*e.al,o=t.canonical.y*e.al;for(let e=0;e<r.length;e++){const{key:t,crossTileID:n,tileAnchorX:a,tileAnchorY:s}=r.get(e),l=Math.floor((i+a)*Gr),c=Math.floor((o+s)*Gr);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(n)}this.index.finish()}findMatches(t,r,n){const i=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),o=Gr/Math.pow(2,r.canonical.z-this.tileID.canonical.z),a=r.canonical.x*e.al,s=r.canonical.y*e.al;for(let e=0;e<t.length;e++){const r=t.get(e);if(r.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=r,d=Math.floor((a+c)*o),h=Math.floor((s+u)*o),A=this.index.range(d-i,h-i,d+i,h+i).sort((e,t)=>e-t);for(const e of A){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!n.has(t)){n.add(t),r.crossTileID=t;break}}}}}class Wr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class qr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const r in this.indexes){const e=this.indexes[r],n={};for(const r in e){const i=e[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),n[i.tileID.key]=i}this.indexes[r]=n}this.lng=e}addBucket(e,t,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let i=0;i<t.symbolInstances.length;i++)t.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const n=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in r){const o=r[i];o.tileID.isChildOf(e)&&o.findMatches(t.symbolInstances,e,n)}else{const o=r[e.scaledTo(Number(i)).key];o&&o.findMatches(t.symbolInstances,e,n)}}for(let i=0;i<t.symbolInstances.length;i++){const e=t.symbolInstances.get(i);e.crossTileID||(e.crossTileID=r.generate(),n.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Kr(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const r of t.crossTileIDs)this.usedCrossTileIDs[e].delete(r)}removeStaleBuckets(e){let t=!1;for(const r in this.indexes){const n=this.indexes[r];for(const i in n)e[n[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[i]),delete n[i],t=!0)}return t}}class Zr{constructor(){this.layerIndexes={},this.crossTileIDs=new Wr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,r,n){let i=this.layerIndexes[e.fqid];void 0===i&&(i=this.layerIndexes[e.fqid]=new qr);let o=!1;const a={};"globe"!==n.name&&i.handleWrapJump(r);for(const s of t){const t=s.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(s.tileID,t,this.crossTileIDs)&&(o=!0),a[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(a)&&(o=!0),o}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const r in this.layerIndexes)t[r]||delete this.layerIndexes[r]}}const Xr=771;class Yr{constructor(e,t,r,n){this.blendFunction=e,this.blendColor=t.toNonPremultipliedRenderColor(null),this.mask=r,this.blendEquation=n}}Yr.Replace=[1,0,1,0],Yr.disabled=new Yr(Yr.Replace,e.ao.transparent,[!1,!1,!1,!1]),Yr.unblended=new Yr(Yr.Replace,e.ao.transparent,[!0,!0,!0,!0]),Yr.alphaBlended=new Yr([1,Xr,1,Xr],e.ao.transparent,[!0,!0,!0,!0]),Yr.alphaBlendedNonPremultiplied=new Yr([770,Xr,770,Xr],e.ao.transparent,[!0,!0,!0,!0]),Yr.multiply=new Yr([774,0,774,0],e.ao.transparent,[!0,!0,!0,!0]),Yr.additive=new Yr([1,1,1,1],e.ao.transparent,[!0,!0,!0,!0]);class Jr{constructor(e,t,r){this.func=e,this.mask=t,this.range=r}}Jr.ReadOnly=!1,Jr.ReadWrite=!0,Jr.disabled=new Jr(519,Jr.ReadOnly,[0,1]);const $r=7680;class en{constructor(e,t,r,n,i,o){this.test=e,this.ref=t,this.mask=r,this.fail=n,this.depthFail=i,this.pass=o}}en.disabled=new en({func:519,mask:0},0,0,$r,$r,$r);const tn=1029,rn=2305;class nn{constructor(e,t,r){this.enable=e,this.mode=t,this.frontFace=r}}function on(t,r){const n=e.ca(t,3);e.cc(t,r),e.cg(t,3,n)}function an(t,r){const n=e.c7([]);return e.c8(n,n,-r),e.c9(n,n,-t),n}function sn(t,r){const n=[t[0],t[1],0],i=[r[0],r[1],0];if(e.ag(n)>=1e-15){const t=e.aw([],n);e.c5(i,t,e.bJ(i,t)),r[0]=i[0],r[1]=i[1]}const o=e.bI([],r,t);if(e.c6(o)<1e-15)return null;const a=Math.atan2(-o[1],o[0]);return an(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),a)}nn.disabled=new nn(!1,tn,rn),nn.backCCW=new nn(!0,tn,rn),nn.backCW=new nn(!0,tn,2304),nn.frontCW=new nn(!0,1028,2304),nn.frontCCW=new nn(!0,1028,rn);class ln{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const r=t instanceof e.ae?t:new e.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=e.bT(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r,n){if(this.orientation=null,!this.position)return;const i=this.position,o=n||(this._elevation?this._elevation.getAtPointOrZero(e.ae.fromLngLat(t)):0),a=e.ae.fromLngLat(t,o),s=[a.x-i.x,a.y-i.y,a.z-i.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=sn(s,r)}setPitchBearing(t,r){this.orientation=an(e.an(t),e.an(-r))}}class cn{constructor(t,r){this._transform=e.bA([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new e.ae(t[0],t[1],t[2])}get position(){const t=e.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&e.cg(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.c7([]),t&&on(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=an(e,t),on(this._transform,this._orientation)}forward(){const t=e.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const n=new Float64Array(16);return e.bl(n,this.getWorldToCamera(t,r)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,n){const i=this.position;e.c5(i,i,-t);const o=new Float64Array(16);return e.bq(o,[n,n,n]),e.br(o,o,i),o[10]*=r,o}getWorldToCamera(t,r){const n=new Float64Array(16),i=new Float64Array(4),o=this.position;return e.cb(i,this._orientation),e.c5(o,o,-t),e.cc(n,i),e.br(n,n,o),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=r,n[9]*=r,n[10]*=r,n[11]*=r,n}getCameraToClipPerspective(t,r,n,i){const o=new Float64Array(16);return e.cd(o,t,r,n,i),o}getCameraToClipOrthographic(t,r,n,i,o,a){const s=new Float64Array(16);return e.ce(s,t,r,n,i,o,a),s}getDistanceToElevation(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=0===t?0:e.cf(t,r?e.a$(this.position[1]):this.position[1]),i=this.forward();return(n-this.position[2])/i[2]}clone(){return new cn([...this.position],[...this.orientation])}}const un={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class dn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=r,this.right=n}interpolate(t,r,n){return null!=r.top&&null!=t.top&&(this.top=e.ak(t.top,r.top,n)),null!=r.bottom&&null!=t.bottom&&(this.bottom=e.ak(t.bottom,r.bottom,n)),null!=r.left&&null!=t.left&&(this.left=e.ak(t.left,r.left,n)),null!=r.right&&null!=t.right&&(this.right=e.ak(t.right,r.right,n)),this}getCenter(t,r){const n=e.aA((this.left+t-this.right)/2,0,t),i=e.aA((this.top+r-this.bottom)/2,0,r);return new e.P(n,i)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new dn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const hn=15;class An{constructor(t,r,n,i,o,a,s){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=null!==n&&void 0!==n?n:0,this._maxPitch=null!==i&&void 0!==i?i:60,this.setProjection(a),this.setMaxBounds(s),this.width=0,this.height=0,this._center=new e.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new dn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new cn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const e=new An(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e._allowWorldUnderZoom=this._allowWorldUnderZoom,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<hn}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||r)&&this._updateCameraOnTerrain(),(e||r)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=e.cm(this.projectionOptions);const n=this.getProjection(),i=!e.by(r,n);return i&&this._calcMatrices(),this.mercatorFromTransition=!1,i}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.cm({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bT(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=e.cn(),e.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=e.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration(),this._centerAltitudeValidForExaggeration=r.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=r.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(void 0===this._centerAltitudeValidForExaggeration)return;const e=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(e)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let i=0,o=0;for(let a=0;a<r.length;a++){const s=new e.P(r[a][0]*this.width,n+r[a][1]*(this.height-n)),l=t.pointCoordinate(s);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);i+=l[3]*c,o+=c}return 0===o?NaN:i/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*t,n=this._mercatorZfromZoom(e),i=this._mercatorZfromZoom(this._maxZoom),o=Math.max(n-r,i);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}equals(e){const t=this.elevation,r=e.elevation,n=null!=t!=(null!=r)||t&&r&&t.exaggeration()!==r.exaggeration();return this.width===e.width&&this.height===e.height&&this.center.lng===e.center.lng&&this.center.lat===e.center.lat&&this.zoom===e.zoom&&this.bearing===e.bearing&&this.pitch===e.pitch&&this.fov===e.fov&&this.projection.name===e.projection.name&&this._edgeInsets.equals(e.padding)&&!n}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let n;n=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const i=e.ag(e.av([],this._camera.position,n));return e.aA(this._zoomFromMercatorZ(i),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!e.cp(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const n=[t.position.x,t.position.y,t.position.z];e.cq(n,this._camera.position)||(this._setCameraPosition(n),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new ln;return r.position=new e.ae(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!e.cr(t))return!1;e.cs(t,t);const r=e.ct([],[0,0,-1],t),n=e.ct([],[0,-1,0],t);if(n[2]<0)return!1;const i=sn(r,n);return!!i&&(this._camera.orientation=i,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;t[2]=e.aA(t[2],i/n,i/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,r){this._unmodified=!1,this._edgeInsets.interpolate(e,t,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const r=[new e.cu(0,t)];if(this.renderWorldCopies){const n=this.pointCoordinate(new e.P(0,0)),i=this.pointCoordinate(new e.P(this.width,0)),o=this.pointCoordinate(new e.P(this.width,this.height)),a=this.pointCoordinate(new e.P(0,this.height)),s=Math.floor(Math.min(n.x,i.x,o.x,a.x)),l=Math.floor(Math.max(n.x,i.x,o.x,a.x)),c=1;for(let u=s-c;u<=l+c;u++)0!==u&&r.push(new e.cu(u,t))}return r}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,n,i){let o=[];const a=null!=n,s=!a;if(s&&this.zoom<r)return o;if(a&&0===n[0]&&0===n[1])return o;const l=new Set,c=(t,r,n,i,a)=>{const s=e.cY(r,t,n,i,a);l.has(s)||(o.push(new e.aQ(t,r,n,i,a)),l.add(s))};for(let e=0;e<t.length;e++){const o=t[e];if(s&&o.canonical.z!==r)continue;if(a&&void 0!==i&&i>o.canonical.z)continue;const l=o.canonical,u=o.overscaledZ,d=o.wrap,h=1<<l.z,A=l.x+1<h,f=l.x>0,p=l.y+1<h,m=l.y>0,g=o.wrap-(f?0:1),y=o.wrap+(A?0:1),_=f?l.x-1:h-1,v=A?l.x+1:0;if(a)n[0]<0?(c(u,y,l.z,v,l.y),n[1]<0&&p&&(c(u,d,l.z,l.x,l.y+1),c(u,y,l.z,v,l.y+1)),n[1]>0&&m&&(c(u,d,l.z,l.x,l.y-1),c(u,y,l.z,v,l.y-1))):n[0]>0?(c(u,g,l.z,_,l.y),n[1]<0&&p&&(c(u,d,l.z,l.x,l.y+1),c(u,g,l.z,_,l.y+1)),n[1]>0&&m&&(c(u,d,l.z,l.x,l.y-1),c(u,g,l.z,_,l.y-1))):n[1]<0&&p?c(u,d,l.z,l.x,l.y+1):m&&c(u,d,l.z,l.x,l.y-1);else{const e=o.visibleQuadrants;1&e&&(c(u,g,l.z,_,l.y),m&&(c(u,d,l.z,l.x,l.y-1),c(u,g,l.z,_,l.y-1))),2&e&&(c(u,y,l.z,v,l.y),m&&(c(u,d,l.z,l.x,l.y-1),c(u,y,l.z,v,l.y-1))),4&e&&(c(u,g,l.z,_,l.y),p&&(c(u,d,l.z,l.x,l.y+1),c(u,g,l.z,_,l.y+1))),8&e&&(c(u,y,l.z,v,l.y),p&&(c(u,d,l.z,l.x,l.y+1),c(u,y,l.z,v,l.y+1)))}}const u=[];for(const e of o)o.some(t=>e.isChildOf(t))||u.push(e);if(o=u.filter(e=>!t.some(t=>!!(e.overscaledZ<r&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))),s){const e=1<<r,t="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),n=[e*t.x,e*t.y],i=4,a=i*i;o=o.filter(e=>{const t=e.canonical.x+.5-n[0],r=e.canonical.y+.5-n[1];return t*t+r*r<a})}return o}extendTileCoverToNearPlane(t,r,n){const i=[],o=new Set;for(const e of t)o.add(e.key);const a=(t,r,n,a,s)=>{const l=e.cY(r,t,n,a,s);o.has(l)||(i.push(new e.aQ(t,r,n,a,s)),o.add(l))},s=t.reduce((e,t)=>Math.max(e,t.overscaledZ),n),l=1<<n,c=[new e.P(0,0),new e.P(e.al,0),new e.P(e.al,e.al),new e.P(0,e.al)],u=new e.P(0,0),d=new e.P(0,0),h=(t,r)=>{const i=Math.floor(t[0]),o=Math.floor(t[1]),h=(t[0]-i)*e.al,A=(t[1]-o)*e.al,f=Math.floor(r[0]),p=Math.floor(r[1]),m=(r[0]-f)*e.al,g=(r[1]-p)*e.al;for(let y=-1;y<=1;y++){const t=i+y;if(!(t<0||t>=l)){u.x=h-y*e.al,d.x=m-(t-f)*e.al;for(let r=-1;r<=1;r++){const i=o+r;u.y=A-r*e.al,d.y=g-(i-p)*e.al,e.cZ(u,d,c)&&a(s,0,n,t,i)}}}},A=r.points,f=A[e.cv],p=A[e.cw],m=this._projectToGround(f,A[e.cx]),g=this._projectToGround(p,A[e.cy]);return h(f,m),h(p,g),i}_projectToGround(t,r){return e.cz(e.cA(),t,r,t[2]/(t[2]-r[2]))}coveringTiles(t){let r=this.coveringZoomLevel(t);const n=r,i=this.elevation&&this.elevation.exaggeration(),o=i&&!t.isTerrainDEM,a="mercator"===this.projection.name;if(void 0!==t.minzoom&&r<t.minzoom)return[];void 0!==t.maxzoom&&r>t.maxzoom&&(r=t.maxzoom);const s=this.locationCoordinate(this.center),l=this.center.lat,c=1<<r,u=[c*s.x,c*s.y,0],d="globe"===this.projection.name,h=!d,A=e.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,h),f=d?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),p=c*e.cf(1,this.center.lat),m=this._camera.position[2]/e.cf(1,this.center.lat),g=[c*f.x,c*f.y,m*(h?1:p)],y=d||i,_=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),v=this.isLODDisabled(!0)?r:0;let x;if(this._elevation&&t.isTerrainDEM)x=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();x=e?e.max:this._centerAltitude}else x=this._centerAltitude;const w=t.isTerrainDEM?-x:this._elevation?this._elevation.getMinElevationBelowMSL():0,b=this.projection.isReprojectedInTileSpace?e.cC(this):1,B=t=>{const r=1/4e4,n=new e.ae(t.x+r,t.y,t.z),i=new e.ae(t.x,t.y+r,t.z),o=t.toLngLat(),a=n.toLngLat(),s=i.toLngLat(),l=this.locationCoordinate(o),c=this.locationCoordinate(a),u=this.locationCoordinate(s),d=Math.hypot(c.x-l.x,c.y-l.y),h=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(d*h)*b/r},C=t=>{const r=x,n=w;return{aabb:e.cF(this,c,0,0,0,t,n,r,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:r,wrap:t,fullyVisible:!1}},E=[];let S=[];const T=r,I=t.reparseOverscaled?n:r,F=(m-this._centerAltitude)*p,k=e=>{if(!this._elevation||!e.tileID||!a)return;const t=this._elevation.getMinMaxForTile(e.tileID),r=e.aabb;t?(r.min[2]=t.min,r.max[2]=t.max,r.center[2]=(r.min[2]+r.max[2])/2):(e.shouldSplit=M(e),e.shouldSplit||(r.min[2]=r.max[2]=r.center[2]=this._centerAltitude))},P=(e,t)=>{if(.707*t<e)return 1;const r=t/e;return r/(1.4144271570014144+(Math.pow(1.1,r-1.4144271570014144+1)-1)/(1.1-1)-1)},M=t=>{if(t.zoom<v)return!0;if(t.zoom===T)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const r=t.aabb.distanceX(g),i=t.aabb.distanceY(g);let s=F,c=1;if(d){s=t.aabb.distanceZ(g);const r=Math.pow(2,t.zoom),n=e.a$((t.y+1)/r),i=e.a$(t.y/r),o=Math.min(Math.max(l,n),i),a=e.d1(o)/e.d1(l);if(c=o===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,a/this._mercatorScaleRatio),this.zoom<=e.c_&&t.zoom===T-1&&a>=.9)return!0}else if(o&&(s=t.aabb.distanceZ(g)*p),this.projection.isReprojectedInTileSpace&&n<=5){const r=Math.pow(2,t.zoom),n=B(new e.ae((t.x+.5)/r,(t.y+.5)/r));c=n>.85?1:n}if(!a&&!d){const e=Math.sqrt(r*r+i*i+s*s);let n=(1<<T-t.zoom)*_*c;return n*=P(Math.max(s,F),e),e<n}let h=Number.MAX_VALUE,A=0;const f=t.aabb.getCorners(),m=[];for(const n of f){e.av(m,n,g),d||(o?m[2]*=p:m[2]=F);const t=e.bJ(m,this._camera.forward());t<h&&(h=t,A=Math.abs(m[2]))}let y=(1<<T-t.zoom)*_*c;if(y*=P(Math.max(A,F),h),h<y)return!0;const x=t.aabb.closestPoint(u);return x[0]===u[0]&&x[1]===u[1]};if(this.renderWorldCopies)for(let e=1;e<=3;e++)E.push(C(-e)),E.push(C(e));for(E.push(C(0));E.length>0;){const n=E.pop(),i=n.x,s=n.y;let l=n.fullyVisible;const h=()=>"globe"===this.projection.name&&(0===n.y||n.y===(1<<n.zoom)-1);if(!l){let t=y?n.aabb.intersects(A):n.aabb.intersectsFlat(A);if(0===t&&h()){const r=new e.cD(n.zoom,i,s);t=e.cE(this,c,r,!0).intersects(A)}if(0===t)continue;l=2===t}if(n.zoom!==T&&M(n))for(let t=0;t<4;t++){const r=(i<<1)+t%2,u=(s<<1)+(t>>1),h={aabb:a?n.aabb.quadrant(t):e.cF(this,c,n.zoom+1,r,u,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:r,y:u,wrap:n.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};o&&!d&&(h.tileID=new e.aQ(n.zoom+1===T?I:n.zoom+1,n.wrap,n.zoom+1,r,u),k(h)),E.push(h)}else{const o=n.zoom===T?I:n.zoom;if(t.minzoom&&t.minzoom>o)continue;let a=0;if(!l){let r=y?n.aabb.intersectsPrecise(A):n.aabb.intersectsPreciseFlat(A);if(0===r&&h()){const t=new e.cD(n.zoom,i,s);r=e.cE(this,c,t,!0).intersectsPrecise(A)}if(0===r)continue;if(t.calculateQuadrantVisibility)if(A.containsPoint(n.aabb.center))a=15;else for(let e=0;e<4;e++)0!==n.aabb.quadrant(e).intersects(A)&&(a|=1<<e)}const d=u[0]-(.5+i+(n.wrap<<n.zoom))*(1<<r-n.zoom),f=u[1]-.5-s,p=n.tileID?n.tileID:new e.aQ(o,n.wrap,n.zoom,i,s);t.calculateQuadrantVisibility&&(p.visibleQuadrants=a),S.push({tileID:p,distanceSq:d*d+f*f})}}if(this.fogCullDistSq){const r=this.fogCullDistSq,n=this.horizonLineFromTop();S=S.filter(i=>{const o=[0,0,0,1],a=[e.al,e.al,0,1],s=this.calculateFogTileMatrix(i.tileID.toUnwrapped());e.aC(o,o,s),e.aC(a,a,s);const l=e.cG([],o,a),c=e.cH([],o,a),u=e.c$(l,c);if(0===u)return!0;let d=!1;const h=this._elevation;if(h&&u>r&&0!==n){const r=this.calculateProjMatrix(i.tileID.toUnwrapped());let o;t.isTerrainDEM||(o=h.getMinMaxForTile(i.tileID)),o||(o={min:w,max:x});const a=e.cI(this.rotation),s=[a[0]*e.al,a[1]*e.al,o.max];e.af(s,s,r),d=(1-s[1])*this.height*.5<n}return u<r||d})}return S.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log2(e)}project(t){const r=e.aA(t.lat,-e.cJ,e.cJ),n=this.projection.project(t.lng,r);return new e.P(n.x*this.worldSize,n.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let n,i;const o=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;n=(r.x-o.x)/e,i=(r.y-o.y)/e}else{const e=this.pointCoordinate(r),t=this.pointCoordinate(o);n=e.x-t.x,i=e.y-t.y}const a=this.locationCoordinate(t);this.setLocation(new e.ae(a.x-n,a.y-i))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e,t){return this.projection.locationPoint(this,e,t)}locationPoint3D(e,t){return this.projection.locationPoint(this,e,t,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e,t){return this.coordinateLocation(this.pointCoordinate3D(e,t))}locationCoordinate(t,r){const n=r?e.cf(r,t.lat):void 0,i=this.projection.project(t.lng,t.lat);return new e.ae(i.x,i.y,n)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,r){const n=null!=r?r:this._centerAltitude,i=[t.x,t.y,0,1],o=[t.x,t.y,1,1];e.aC(i,i,this.pixelMatrixInverse),e.aC(o,o,this.pixelMatrixInverse);const a=o[3];e.cK(i,i,1/i[3]),e.cK(o,o,1/a);const s=i[2],l=o[2];return{p0:i,p1:o,t:s===l?0:(n-s)/(l-s)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],n=[t.x,t.y,1,1];return e.aC(r,r,this.pixelMatrixInverse),e.aC(n,n,this.pixelMatrixInverse),e.cK(r,r,1/r[3]),e.cK(n,n,1/n[3]),r[2]=e.cf(r[2],this._center.lat)*this.worldSize,n[2]=e.cf(n[2],this._center.lat)*this.worldSize,e.cK(r,r,1/this.worldSize),e.cK(n,n,1/this.worldSize),new e.ax([r[0],r[1],r[2]],e.aw([],e.av([],n,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:n,t:i}=t,o=e.cf(r[2],this._center.lat),a=e.cf(n[2],this._center.lat);return new e.ae(e.ak(r[0],n[0],i)/this.worldSize,e.ak(r[1],n[1],i)/this.worldSize,e.ak(o,a,i))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t,r){if(!this.elevation)return this.pointCoordinate(t,r);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new e.ae(n[0],n[1],n[2]);let i=0,o=this.horizonLineFromTop();if(t.y>o)return this.pointCoordinate(t,r);const a=.02*o,s=t.clone();for(let l=0;l<10&&o-i>a;l++){s.y=e.ak(i,o,.66);const t=this.projection.pointCoordinate3D(this,s.x,s.y);t?(o=s.y,n=t):i=s.y}return n?new e.ae(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.cL)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const n=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,i=[t.x*this.worldSize,t.y*this.worldSize,n+t.toAltitude(),1];return e.aC(i,i,this.pixelMatrix),i[3]>0?new e.P(i[0]/i[3],i[1]/i[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,i=this.width-this._edgeInsets.right,o=this.pointLocation3D(new e.P(r,t)),a=this.pointLocation3D(new e.P(i,t)),s=this.pointLocation3D(new e.P(i,n)),l=this.pointLocation3D(new e.P(r,n));let c=Math.min(o.lng,a.lng,s.lng,l.lng),u=Math.max(o.lng,a.lng,s.lng,l.lng),d=Math.min(o.lat,a.lat,s.lat,l.lat),h=Math.max(o.lat,a.lat,s.lat,l.lat);const A=Math.pow(2,-this.zoom)/16*270,f="globe"===this.projection.name?1:4,p=(t,r,n,i,o)=>{const a=(t+n)/2,s=(r+i)/2,l=new e.P(a,s),{lng:m,lat:g}=this.pointLocation3D(l),y=Math.max(0,c-m,d-g,m-u,g-h);c=Math.min(c,m),u=Math.max(u,m),d=Math.min(d,g),h=Math.max(h,g),(o<f||y>A)&&(p(t,r,a,s,o+1),p(a,s,n,i,o+1))};if(p(r,t,i,t,1),p(i,t,i,n,1),p(i,n,r,n,1),p(r,n,r,t,1),"globe"===this.projection.name){const[t,r]=e.cM(this);t?(h=90,u=180,c=-180):r&&(d=-90,u=180,c=-180)}return new e.aI(new e.aT(c,d),new e.aT(u,h))}_getBoundsRectangular(t,r){const{top:n,left:i}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,a=this.width-this._edgeInsets.right,s=new e.P(i,n),l=new e.P(a,n),c=new e.P(a,o),u=new e.P(i,o);let d=this.pointCoordinate(s,t),h=this.pointCoordinate(l,t);const A=this.pointCoordinate(c,r),f=this.pointCoordinate(u,r),p=(e,t)=>(t.y-e.y)/(t.x-e.x);return d.y>1&&h.y>=0?d=new e.ae((1-f.y)/p(f,d)+f.x,1):d.y<0&&h.y<=1&&(d=new e.ae(-f.y/p(f,d)+f.x,0)),h.y>1&&d.y>=0?h=new e.ae((1-A.y)/p(A,h)+A.x,1):h.y<0&&d.y<=1&&(h=new e.ae(-A.y/p(A,h)+A.x,0)),(new e.aI).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(f)).extend(this.coordinateLocation(A))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce((e,t)=>{if(t.dem){const r=t.dem.tree;e.min=Math.min(e.min,r.minimums[0]),e.max=Math.max(e.max,r.maximums[0])}return e},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.cJ,this.maxLat=e.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.aF(this.minLng)*this.tileSize,this.worldMaxX=e.aF(this.maxLng)*this.tileSize,this.worldMinY=e.aJ(this.maxLat)*this.tileSize,this.worldMaxY=e.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const r=t.key,n=this._distanceTileDataCache;if(n[r])return n[r];const i=t.canonical,o=1/this.height,a=this.cameraWorldSize,s=a/this.zoomScale(i.z),l=(i.x+Math.pow(2,i.z)*t.wrap)*s,c=i.y*s,u=this.point;u.x*=a/this.worldSize,u.y*=a/this.worldSize;const d=this.angle,h=Math.sin(-d),A=-Math.cos(-d);return n[r]={bearing:[h,A],center:[(u.x-l)*o,(u.y-c)*o],scale:s/e.al*o},n[r]}calculateFogTileMatrix(t){const r=t.key,n=this._fogTileMatrixCache;if(n[r])return n[r];const i=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.aB(i,this.worldToFogMatrix,i),n[r]=new Float32Array(i),n[r]}calculateProjMatrix(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t.key;let o;if(o=n?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,o[i])return o[i];const a=this.calculatePosMatrix(t,this.worldSize);let s;return s=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,e.aB(a,s,a),o[i]=new Float32Array(a),o[i]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,n=this._pixelsToTileUnitsCache;if(n[r])return n[r];const i=e.cN(t,this);return n[r]=i,n[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,r=e.bq([],[t,t,t]);return e.aB(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const r=e.cf(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),i=this._camera.forward(),o=e.cf(1,this._center.lat);n[2]/=o,i[2]/=o,e.aw(i,i);const a=t.raycast(n,i,t.exaggeration());if(a){const t=e.bH([],n,i,a),r=new e.ae(t[0],t[1],e.cf(t[2],e.a$(t[1]))),s=(r.z+e.ag([r.x-n[0],r.y-n[1],r.z-n[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(s),this._centerAltitude=r.toAltitude(),this._center=this.coordinateLocation(r),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const r=this._elevation,n=e.cf(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),o=r.getAtPointOrZero(new e.ae(...i)),a=this.pixelsPerMeter/this.worldSize*o,s=this._minimumHeightOverTerrain(),l=i[2]-a;if(l<=s)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),r=[i[0],i[1],t.z-i[2]],n=e.ag(r);r[2]-=(s-l)/this._pixelsPerMercatorPixel;const o=e.ag(r);if(0===o)return;e.c5(r,r,n/o*this._pixelsPerMercatorPixel),this._camera.position=[i[0],i[1],t.z*this._pixelsPerMercatorPixel-r[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const r=this.center;return r.lat=e.aA(r.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(r.lng=e.aA(r.lng,this.minLng,this.maxLng)),this.center=r,void(this._constraining=!1)}const r=this._unmodified,{x:n,y:i}=this.point;let o=0,a=n,s=i;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,d=this.worldMaxY*this.scale;if(i-c<u&&(s=u+c),i+c>d&&(s=d-c),d-u<this.height&&(o=Math.max(o,this.height/(d-u)),s=(d+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,r=this.worldSize/2-(e+t)/2;a=(n+r+this.worldSize)%this.worldSize-r,a-l<e&&(a=e+l),a+l>t&&(a=t-l),t-e<this.width&&(o=Math.max(o,this.width/(t-e)),a=(t+e)/2)}a===n&&s===i||this._allowWorldUnderZoom||(this.center=this.unproject(new e.P(a,s))),o&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r="globe"===this.projection.name,n=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.cf(1,this.center.lat)/e.cf(1,e.d2));const i=e.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,i),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const o="meters"===this.projection.zAxisUnit?n:1,a=this._camera.getWorldToCamera(this.worldSize,o);let s;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let r=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),n=r*this.aspect,i=-n,o=-r;n-=t.x,i-=t.x,r+=t.y,o+=t.y,s=this._camera.getCameraToClipOrthographic(i,n,o,r,this._nearZ,this._farZ),((t,r,n,i)=>{for(let o=0;o<16;o++)t[o]=e.ak(r[o],n[o],i)})(s,s,l,e.d0(this.pitch>=hn?1:this.pitch/hn))}else s=l;const c=e.cP([],l,a);let u=e.cP([],s,a);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),r=e.bA([]);e.br(r,r,[t.x*this.worldSize,t.y*this.worldSize,0]),e.aB(r,r,e.cQ(this)),e.br(r,r,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.aB(u,u,r),e.aB(c,c,r),this.inverseAdjustmentMatrix=e.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.cS([],u,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=u,this.invProjMatrix=e.bl(new Float64Array(16),this.projMatrix),r){const r=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);r[8]=2*-t.x/this.width,r[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.cP([],r,a)}else this.expandedFarZProjMatrix=this.projMatrix;const d=e.bl([],s);this.frustumCorners=e.cT.fromInvProjectionMatrix(d,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const h=new Float32Array(16);e.bA(h),e.cS(h,h,[1,-1,1]),e.cU(h,h,this._pitch),e.bB(h,h,this.angle);const A=e.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.bz(A);const f=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;A[8]=2*-t.x/this.width,A[9]=2*(t.y+f)/this.height,this.skyboxMatrix=e.aB(h,A,h);const p=this.point,m=p.x,g=p.y,y=this.width%2/2,_=this.height%2/2,v=Math.cos(this.angle),x=Math.sin(this.angle),w=m-Math.round(m)+v*y+x*_,b=g-Math.round(g)+v*_+x*y,B=new Float64Array(u);if(e.br(B,B,[w>.5?w-1:w,b>.5?b-1:b,0]),this.alignedProjMatrix=B,u=e.bC(),e.cS(u,u,[this.width/2,-this.height/2,1]),e.br(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.bC(),e.cS(u,u,[1,-1,1]),e.br(u,u,[-1,-1,0]),e.cS(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.aB(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=e.bl(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.cV(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.af(t,t,a),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,n=this._camera.position,i=1/this.height/this._pixelsPerMercatorPixel,o=[t,t,r];e.c5(o,o,i),e.c5(n,n,-1),e.cW(n,n,o);const a=e.bC();e.br(a,a,n),e.cS(a,a,o),this.mercatorFogMatrix=a,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,i)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),n=this.point,i=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-r[0]*i,n.y/this.worldSize-r[1]*i,e/this.worldSize*this._centerAltitude-r[2]*i]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],i=t[2];let o=1;this.projection.wrap&&(this.center=this.center.wrap()),i>0&&(o=Math.min((r-n)/i,1)),this._camera.position=e.bH([],this._camera.position,t,o),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:n,bearing:i}=this._camera.getPitchBearing(),o=e.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,a=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.an(this._maxPitch)),s=Math.max((t[2]-o)/Math.cos(n),a),l=this._zoomFromMercatorZ(s);e.bH(t,t,r,s),this._pitch=e.aA(n,e.an(this.minPitch),e.an(this.maxPitch)),this.angle=e.bT(i,-Math.PI,Math.PI),this._setZoom(e.aA(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,e)*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,n=e.cL,i=0,o=1/0;for(;n-r>1e-6&&n>r;){const e=r+.5*(n-r),a=this.tileSize*Math.pow(2,e),s=this.getCameraToCenterDistance(this.projection,e,a),l=this.scaleZoom(s/(Math.max(0,t)*this.tileSize)),c=Math.abs(e-l);c<o&&(o=c,i=e),e<l?r=e:n=e}return i}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const n=Math.min(t.x,r.x),i=Math.max(t.x,r.x),o=Math.min(t.y,r.y),a=Math.max(t.y,r.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const s=[new e.P(n,o),new e.P(i,a),new e.P(n,a),new e.P(i,o)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of s){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const r=this.rayIntersectionCoordinate(t);if(r.x<l||r.y<0||r.x>c||r.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,r){const n=e.ag(e.av([],this._camera.position,t)),i=this._zoomFromMercatorZ(n)+r;return n-this._mercatorZfromZoom(i)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,r){let[n,i,o]=t;const a=[n,i,o,1];e.aC(a,a,r);const s=a[3]=Math.max(a[3],1e-6);return a[0]/=s,a[1]/=s,a[2]/=s,a}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const i=e.cO(t,r,this.width,this.height,1024),o=t.pixelSpaceConversion(this.center.lat,n,i);let a=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(a=e.ak(1,a,e.d0(this.pitch>=hn?1:this.pitch/hn))),a}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.aB(t,t,this.globeMatrix),t}getFrustum(t){return e.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const fn=(t,r)=>{if(r>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),r<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=t.transform,i=Math.max(Math.abs(n._zoom-(t.minCutoffZoom-1)),1),o=n.isLODDisabled(!1)?e.ah(60,45,n.pitch):e.ah(30,15,n.pitch),a=n._farZ-n._nearZ,s=r*n.height,l=((1-(c=o))*n.cameraToCenterDistance+c*(n._farZ+s))*i;var c;return{shouldRenderCutoff:o<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(l-n._nearZ)/a,(l-s-n._nearZ)/a]}}},pn=2048;class mn{constructor(e,t){this.aabb=e,this.lastCascade=t}}class gn{add(e,t){const r=this.receivers[e.key];void 0!==r?(r.aabb.min[0]=Math.min(r.aabb.min[0],t.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],t.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],t.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],t.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],t.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],t.max[2])):this.receivers[e.key]=new mn(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,r,n){const i=e.d9.fromPoints(t.points);let o=0;for(const a in this.receivers){const t=this.receivers[a];if(!t)continue;if(!i.intersectsAabb(t.aabb))continue;t.aabb.min=i.closestPoint(t.aabb.min),t.aabb.max=i.closestPoint(t.aabb.max);const s=t.aabb.getCorners();for(let i=0;i<n.length;i++){let a=!0;for(const t of s){const o=[t[0]*r,t[1]*r,t[2]];if(e.af(o,o,n[i].matrix),o[0]<-1||o[0]>1||o[1]<-1||o[1]>1){a=!1;break}}if(t.lastCascade=i,o=Math.max(o,i),a)break}}return o+1}}class yn{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new gn,this._depthMode=new Jr(e.context.gl.LEQUAL,Jr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const i=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||i<=0)return;if(this._shadowLayerCount=n.style.order.reduce((e,r)=>{const i=n.style._mergedLayers[r];return e+(i.hasShadowPass()&&!i.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const o=n.context,a=pn,s=pn;if(0===this._cascades.length||pn!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<2;++t){const t=n._shadowMapDebug,r=o.gl,i=o.createFramebuffer(a,s,t?1:0,"texture"),l=new e.T(o,{width:a,height:s,data:null},r.DEPTH_COMPONENT16);if(i.depthAttachment.set(l.texture),t){const t=new e.T(o,{width:a,height:s,data:null},r.RGBA8);i.colorAttachment0.set(t.texture)}this._cascades.push({framebuffer:i,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.cB,scale:0})}}this.shadowDirection=vn(r);let l=0;if(t.elevation){const e=t.elevation,r=[1e4,-1e4];e.visibleDemTiles.filter(e=>e.dem).forEach(e=>{const t=e.dem.tree;r[0]=Math.min(r[0],t.minimums[0]),r[1]=Math.max(r[1],t.maximums[0])}),1e4!==r[0]&&(l=(r[1]-r[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,u=3*c,d=new Float64Array(16);for(let f=0;f<this._cascades.length;++f){const r=this._cascades[f];let n=t.height/50,i=1;0===f?i=c:(n=c,i=u);const[o,a]=wn(t,this.shadowDirection,n,i,pn,l);r.scale=t.scale,r.matrix=o,r.boundingSphereRadius=a,e.bl(d,r.matrix),r.frustum=e.cB.fromInvProjectionMatrix(d,1,0,!0),r.far=i}const h=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[h].far,this._cascades[h].far],this._uniformValues.u_shadow_intensity=i,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=pn,this._uniformValues.u_shadowmap_0=un.ShadowMap0,this._uniformValues.u_shadowmap_1=un.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const A=n.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(A){const r=A.getMinMaxForTile(e);r&&(t=r)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e}drawShadowPass(t,r){if(!this.enabled)return;const n=this.painter,i=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),i.viewport.set([0,0,pn,pn]);for(let o=0;o<this._numCascadesToRender;++o){n.currentShadowCascade=o,i.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),i.clear({color:e.ao.white,depth:1});for(const e of t.order){const i=t._mergedLayers[e];if(!i.hasShadowPass()||i.isHidden(n.transform.zoom))continue;const o=t.getLayerSourceCache(i),a=o?r[o.id]:void 0;("model"===i.type||a&&a.length)&&n.renderLayer(n,o,i,a)}}n.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,t=e.style,r=e.context,n=r.gl,i=t.directionalLight,o=t.ambientLight;if(!i||!o)return;const a=[],s=fn(e,e.longestCutoffRange);s.shouldRenderCutoff&&a.push("RENDER_CUTOFF"),a.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&a.push("NORMAL_OFFSET");const l=xn(t,i,o),c=new Jr(n.LEQUAL,Jr.ReadOnly,e.depthRangeFor3D),u=new en({func:n.EQUAL,mask:255},0,255,n.KEEP,n.KEEP,n.KEEP);for(const d of this._groundShadowTiles){const t=d.toUnwrapped(),i=e.isTileAffectedByFog(d),o=e.getOrCreateProgram("groundShadow",{defines:a,overrideFog:i});this.setupShadows(t,o),e.uploadCommonUniforms(r,o,t,null,s);const h={u_matrix:e.transform.calculateProjMatrix(t),u_ground_shadow_factor:l};o.draw(e,n.TRIANGLES,c,u,Yr.multiply,nn.disabled,h,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,null,e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Yr.unblended:Yr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,n=r.calculatePosMatrix(t,r.worldSize);return e.aB(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(t){const r=e.bz(t);return e.aB(r,this._cascades[this.painter.currentShadowCascade].matrix,t),r}setupShadows(t,r,n){if(!this.enabled)return;const i=this.painter.transform,o=this.painter.context,a=o.gl,s=this._uniformValues,l=new Float64Array(16),c=i.calculatePosMatrix(t,i.worldSize);for(let u=0;u<this._cascades.length;u++)e.aB(l,this._cascades[u].matrix,c),s[0===u?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),o.activeTexture.set(a.TEXTURE0+un.ShadowMap0+u),this._cascades[u].texture.bindExtraParam(a.LINEAR,a.LINEAR,a.CLAMP_TO_EDGE,a.CLAMP_TO_EDGE,a.GREATER);if(this.useNormalOffset=!!n,this.useNormalOffset){const r=e.d7(t.canonical),o=2/i.tileSize*e.al/pn,a=o*this._cascades[0].boundingSphereRadius,l=o*this._cascades[this._cascades.length-1].boundingSphereRadius,c=("vector-tile"===n?1:3)*function(t){const r=e.aA((t-22)/-22,0,1);return.125*(1-r)+4*r}(i.zoom);s.u_shadow_normal_offset=[r,a*c,l*c],s.u_shadow_bias=[1e-4,.0012,.012]}else s.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(o,s)}setupShadowsFromMatrix(t,r){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.enabled)return;const i=this.painter.context,o=i.gl,a=this._uniformValues,s=new Float64Array(16);for(let l=0;l<2;l++)e.aB(s,this._cascades[l].matrix,t),a[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(s),i.activeTexture.set(o.TEXTURE0+un.ShadowMap0+l),this._cascades[l].texture.bindExtraParam(o.LINEAR,o.LINEAR,o.CLAMP_TO_EDGE,o.CLAMP_TO_EDGE,o.GREATER);this.useNormalOffset=n,n?(a.u_shadow_normal_offset=[1,3,3],a.u_shadow_bias=[6e-5,.0012,.012]):a.u_shadow_bias=[36e-5,.0012,.012],r.setShadowUniformValues(i,a)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,n,i){if(i[2]>=0)return{};const o=function(t,r,n){const i=n/(1<<t.canonical.z);return new e.d9([t.canonical.x*i+t.wrap*n,t.canonical.y*i+t.wrap*n,0],[(t.canonical.x+1)*i+t.wrap*n,(t.canonical.y+1)*i+t.wrap*n,r])}(t,r,n).getCorners(),a=r/-i[2];i[0]<0?(e.d8(o[0],o[0],[i[0]*a,0,0]),e.d8(o[3],o[3],[i[0]*a,0,0])):i[0]>0&&(e.d8(o[1],o[1],[i[0]*a,0,0]),e.d8(o[2],o[2],[i[0]*a,0,0])),i[1]<0?(e.d8(o[0],o[0],[0,i[1]*a,0]),e.d8(o[1],o[1],[0,i[1]*a,0])):i[1]>0&&(e.d8(o[2],o[2],[0,i[1]*a,0]),e.d8(o[3],o[3],[0,i[1]*a,0]));const s={};return s.vertices=o,s.planes=[_n(o[1],o[0],o[4]),_n(o[2],o[1],o[5]),_n(o[3],o[2],o[6]),_n(o[0],o[3],o[7])],s}addShadowReceiver(t,r,n){this._receivers.add(t,e.d9.fromTileIdAndHeight(t,r,n))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function _n(t,r,n){const i=e.av([],n,r),o=e.av([],t,r),a=e.bI([],i,o),s=e.ag(a);return 0===s?[0,0,1,0]:(e.c5(a,a,1/s),[a[0],a[1],a[2],-e.bJ(a,r)])}function vn(t){const r=t.properties.get("direction"),n=e.d4(r.x,r.y,r.z);n[2]=e.aA(n[2],0,75);const i=e.d6([n[0],n[1],n[2]]);return e.d5(i.x,i.y,i.z)}function xn(t,r,n){const i="none"===r.properties.get("color-use-theme"),o=r.properties.get("color"),a=r.properties.get("intensity"),s=r.properties.get("direction"),l=[s.x,s.y,s.z],c="none"===n.properties.get("color-use-theme"),u=n.properties.get("color"),d=n.properties.get("intensity"),h=Math.max(e.bJ([0,0,1],l),0),A=[0,0,0];e.c5(A,u.toPremultipliedRenderColor(c?null:t.getLut(r.scope)).toArray01Linear().slice(0,3),d);const f=[0,0,0];return e.c5(f,o.toPremultipliedRenderColor(i?null:t.getLut(n.scope)).toArray01Linear().slice(0,3),h*a),e.db([A[0]>0?A[0]/(A[0]+f[0]):0,A[1]>0?A[1]/(A[1]+f[1]):0,A[2]>0?A[2]/(A[2]+f[2]):0])}function wn(t,r,n,i,o,a){const s=t.zoom,l=t.scale,c=t.worldSize,u=1/c,d=t.aspect,h=Math.sqrt(1+d*d)*Math.tan(.5*t.fovX),A=h*h,f=i-n,p=i+n;let m,g;A>f/p?(m=i,g=i*h):(m=.5*p*(1+A),g=.5*Math.sqrt(f*f+2*(i*i+n*n)*A+p*p*A*A));const y=t.projection.pixelsPerMeter(t.center.lat,c),_=t._camera.getCameraToWorldMercator(),v=[0,0,-m*u];e.af(v,v,_);let x=g*u;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const r=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?y:1),o=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,n,i);o[8]=2*-t.centerOffset.x/t.width,o[9]=2*t.centerOffset.y/t.height;const a=new Float64Array(16);e.cP(a,o,r);const u=new Float64Array(16);e.bl(u,a);const d=e.cB.fromInvProjectionMatrix(u,c,s,!0);for(const n of d.points){const r=((b=n)[0]/=l,b[1]/=l,b[2]=e.cf(b[2],t._center.lat),b);x=Math.max(x,e.c6(e.da([],v,r)))}}var b;x*=o/(o-1);const B=Math.acos(r[2]),C=Math.atan2(-r[0],-r[1]),E=new cn;E.position=v,E.setPitchBearing(B,C);const S=E.getWorldToCamera(c,y),T=x*c,I=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*T),F=E.getCameraToClipOrthographic(-T,T,-T,T,I,(T+a*y)/r[2]),k=new Float64Array(16);e.aB(k,F,S);const P=e.d5(Math.floor(1e6*v[0])/1e6*c,Math.floor(1e6*v[1])/1e6*c,0),M=.5*o,O=[0,0,0];e.af(O,P,k),e.c5(O,O,M);const L=[Math.floor(O[0]),Math.floor(O[1]),Math.floor(O[2])],D=[0,0,0];e.av(D,O,L),e.c5(D,D,-1/M);const U=new Float64Array(16);return e.bA(U),e.br(U,U,D),e.aB(k,U,k),[k,T]}class bn extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,r){return e.dc(this.requestManager.transformRequest(r,e.R.Model).url).then(n=>{if(!n)return;const i=e.dd(n),o=new e.de(t,r,void 0,void 0,i);return o.computeBoundsAndApplyParent(),o}).catch(n=>{if(n&&404===n.status)return null;this.fire(new e.y(new Error("Could not load model ".concat(t," from ").concat(r,": ").concat(n.message))))})}load(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{forceReload:!1};this.models[r]||(this.models[r]={});const i=Object.keys(t),o=[],a=[];for(const e of i){const i=t[e];this.hasURLBeenRequested(i)&&!n.forceReload||(this.modelByURL[i]={modelId:e,scope:r},o.push(this.loadModel(e,i)),a.push(e)),this.models[r][e]||(this.models[r][e]={model:null,numReferences:1})}this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+a.length,Promise.allSettled(o).then(t=>{for(let e=0;e<t.length;e++){const{status:n}=t[e];if("rejected"===n)continue;const{value:i}=t[e];this.models[r][a[e]]||(this.models[r][a[e]]={model:null,numReferences:1}),this.models[r][a[e]].model=i}this.numModelsLoading[r]-=a.length,this.fire(new e.z("data",{dataType:"style"}))}).catch(t=>{this.fire(new e.y(new Error("Could not load models: ".concat(t.message))))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!((arguments.length>2&&void 0!==arguments[2]?arguments[2]:{exactIdMatch:!1}).exactIdMatch?this.getModel(e,t):this.getModelByURL(this.modelUris[t][e]))}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]?this.models[t][e].model:void 0}getModelByURL(e){if(!e)return null;const t=this.modelByURL[e];return t?this.models[t.scope][t.modelId].model:null}hasModelBeenAdded(e,t){return this.models[t]&&void 0!==this.models[t][e]}getModelURIs(e){return this.modelUris[e]||{}}addModel(e,t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const n=this.requestManager.normalizeModelURL(t);if((this.hasModel(e,r,{exactIdMatch:!0})||this.hasModelBeenAdded(e,r))&&this.modelUris[r][e]===n)this.models[r][e].numReferences++;else if(this.hasURLBeenRequested(n)){const{scope:e,modelId:t}=this.modelByURL[n];this.models[e][t].numReferences++}else this.modelUris[r][e]=n,this.load({[e]:this.modelUris[r][e]},r)}addModelURLs(e,t){this.models[t]||(this.models[t]={}),this.modelUris[t]||(this.modelUris[t]={});const r=this.modelUris[t];for(const n in e)r[n]=this.requestManager.normalizeModelURL(e[n])}reloadModels(e){this.load(this.modelUris[e],e,{forceReload:!0})}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const n={};for(const i of t)this.hasModel(i,r,{exactIdMatch:!0})||this.hasURLBeenRequested(i)?this.models[r][i].numReferences++:this.modelUris[r][i]&&!this.hasURLBeenRequested(i)?n[i]=this.modelUris[r][i]:!this.hasURLBeenRequested(i)&&e.df(i,!1)&&(this.modelUris[r][i]=this.requestManager.normalizeModelURL(i),n[i]=this.modelUris[r][i]);this.load(n,r)}hasURLBeenRequested(e){return void 0!==this.modelByURL[e]}removeModel(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.models[t]&&this.models[t][e]&&(this.models[t][e].numReferences--,0===this.models[t][e].numReferences||n)){const n=this.modelUris[t][e];r||delete this.modelUris[t][e],delete this.modelByURL[n];const i=this.models[t][e].model;if(!i)return;delete this.models[t][e],i.destroy()}}destroy(){for(const e of Object.keys(this.models))for(const t of Object.keys(this.models[e])){const r=this.models[e][t].model;delete this.models[e][t],r&&r.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const r in this.models[t])this.models[t][r].model&&this.models[t][r].model.upload(e.context)}}const Bn=e.a6.colorTheme,Cn=new e.a9({data:new e.aa(Bn.data)});function En(t){if(!t.metadata||!t.metadata.content_area)return;const r=e.o.devicePixelRatio,{left:n,top:i,width:o,height:a}=t.metadata.content_area,s=n*r,l=i*r;return[s,l,s+o*r,l+a*r]}function Sn(t){if(t)return t.map(t=>{let[r,n]=t;return[r*e.o.devicePixelRatio,n*e.o.devicePixelRatio]})}class Tn{constructor(e,t,r){this.id=e,this.scope=t,this.sourceCache=r,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(e){this.missingRequests.has(e.name)||this.pendingRequests.has(e.name)||this.pendingRequests.add(e.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const r=this.sourceCache.getVisibleCoordinates();if(0===r.length)return t;const n=this.sourceCache.getSource();if(!(n instanceof gt))return t;const i=r.map(e=>this.sourceCache.getTile(e)),o=n.getImages(i,Array.from(this.pendingRequests));for(const[a,s]of o)t.set(e.I.from({name:a,iconsetId:this.id}),s),this.pendingRequests.delete(a);for(const e of this.pendingRequests)this.missingRequests.add(e);return this.pendingRequests.clear(),t}}const In=(e,t)=>ze(e,t&&t.filter(e=>"source.canvas"!==e.identifier)),Fn=e.aH(Kt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),kn=e.aH(Kt,["setCenter","setZoom","setBearing","setPitch"]),Pn=new Set(["background","sky","slot","custom"]),Mn={version:8,layers:[],sources:{}},On={duration:300,delay:0};class Ln extends e.E{constructor(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=Object.assign({},On),this._buildingIndex=new Vt(this),this.crossTileSymbolIndex=new Zr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=r.styleChanges||new X,this._hasDataDrivenEmissive=!1,this.dispatcher=r.dispatcher?r.dispatcher:new e.D(e.dh(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new J(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new e.di(t._requestManager,r.localFontFamily?e.dj.all:r.localIdeographFontFamily?e.dj.ideographs:e.dj.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new bn(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._indoorDependentLayers=r.indoorDependentLayers?r.indoorDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",e.dk());const n=this;this._rtlTextPluginCallback=Ln.registerForPluginStateChange(t=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(t,r)=>{if(e.dl(t),r&&r.every(e=>e))for(const e in n._sourceCaches){const t=n._sourceCaches[e],r=t.getSource().type;"vector"!==r&&"geojson"!==r||t.reload()}})}),this.on("data",e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const r in this._layers){const e=this._layers[r];e.source===t.id&&this._validateLayer(e)}})}load(e){return e?("string"==typeof e?this.loadURL(e):this.loadJSON(e),this):this}_getGlobalId(t){if(!t)return null;if("string"==typeof t){if(e.h(t))return t;const r=e.dm(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch(e){return r}return r}return"json://".concat(e.dn(JSON.stringify(t)))}_diffStyle(t,r,n){this.globalId=this._getGlobalId(t);const i=(e,t)=>{try{t(null,this.setState(e,n))}catch(e){t(e,!1)}};if("string"==typeof t){const n=this.map._requestManager.normalizeStyleURL(t),o=this.map._requestManager.transformRequest(n,e.R.Style);e.m(o,(t,n)=>{t?this.fire(new e.y(t)):n&&i(n,r)})}else"object"==typeof t&&i(t,r)}loadURL(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.z("dataloading",{dataType:"style"}));const n="boolean"==typeof r.validate?r.validate:!e.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const i=this.importsCache.get(t);if(i)return this._load(i,n);const o=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.m(o,(r,i)=>{if(this._request=null,r)this.fire(new e.y(r));else if(i)return this.importsCache.set(t,i),this._load(i,n)})}loadJSON(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=e.o.frame(()=>{this._request=null,this._load(t,!1!==r.validate)})}loadEmpty(){this.fire(new e.z("dataloading",{dataType:"style"})),this._load(Mn,!1)}_loadImports(t,r,n){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const i=[];for(const e of t){const t=this._createFragmentStyle(e),o=new Promise(e=>{t.once("style.import.load",e),t.once("error",e)}).then(()=>this.mergeAll());if(i.push(o),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const a=e.data||this.importsCache.get(e.url);a?(t.loadJSON(a,{validate:r}),this._isInternalStyle(a)&&(t.globalId=null)):e.url?t.loadURL(e.url,{validate:r}):t.loadEmpty();const s={style:t,id:e.id,config:e.config};if(n){const e=this.fragments.findIndex(e=>{let{id:t}=e;return t===n});this.fragments=this.fragments.slice(0,e).concat(s).concat(this.fragments.slice(e))}else this.fragments.push(s)}return Promise.allSettled(i)}getImportGlobalIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;for(const r of e.fragments)r.style.globalId&&t.add(r.style.globalId),this.getImportGlobalIds(r.style,t);return[...t.values()]}_createFragmentStyle(t){const r=this.scope?e.B(t.id,this.scope):t.id;let n;const i=this._initialConfig&&this._initialConfig[r];(t.config||i)&&(n=Object.assign({},t.config,i));const o=new Ln(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:n,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return o.setEventedParent(this.map,{style:o}),o}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(t,r){if(this._isInternalStyle(t)){const e=Object.assign({},Mn,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(e,r)}if(this.updateConfig(this._config,t.schema),r&&In(this,Ce(t)))return;this._loaded=!0,this.stylesheet=e.dp(t);const n=()=>{for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const e in t.iconsets)this.addIconset(e,t.iconsets[e]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const n=Gt(this.stylesheet.layers);if(this._order=n.map(e=>e.id),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new Qe(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Qe(this.stylesheet.light)),this._layers={};for(const t of n){const r=e.du(t,this.scope,this._styleColorTheme.lut,this.options);0!==r.expressionDependencies.configDependencies.size&&this._configDependentLayers.add(r.fqid),r.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(r.fqid),this._hasAppearances=this._hasAppearances||0!==r.getAppearances().length,r.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r;const n=this.getOwnLayerSourceCache(r),i=!!this.directionalLight&&this.directionalLight.shadowsEnabled();n&&r.canCastShadows()&&i&&(n.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const i=this.stylesheet.terrain;i&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(i,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.z("data",{dataType:"style"}));const o=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then(()=>{this._reloadImports(),this.fire(new e.z(o?"style.load":"style.import.load"))}).catch(t=>{this.fire(new e.y(new Error("Failed to load imports",t))),this.fire(new e.z(o?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new e.z(o?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const i=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(i){const t=this._evaluateColorThemeData(i);this._loadColorTheme(t).then(()=>{n()}).catch(t=>{e.w("Couldn't load color theme from the stylesheet: ".concat(t)),n()})}else this._styleColorTheme.lut=null,n()}isRootStyle(){return 0===this.importDepth}hasAppearances(){return this._hasAppearances||this.fragments.some(e=>e.style.hasAppearances())}mergeAll(){let e,t,r,n,i,o,a,s,l,c;const u={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{if(d.stylesheet){if(null!=d.light&&(e=d.light),d.stylesheet.lights)for(const e of d.stylesheet.lights)"ambient"===e.type&&null!=d.ambientLight&&(t=d.ambientLight),"directional"===e.type&&null!=d.directionalLight&&(r=d.directionalLight);n=this._prioritizeTerrain(n,d.terrain,d.stylesheet.terrain),d.stylesheet.fog&&null!=d.fog&&(i=d.fog),d.stylesheet.snow&&null!=d.snow&&(o=d.snow),d.stylesheet.rain&&null!=d.rain&&(a=d.rain),null!=d.stylesheet.camera&&(c=d.stylesheet.camera),null!=d.stylesheet.projection&&(s=d.stylesheet.projection),null!=d.stylesheet.transition&&(l=d.stylesheet.transition),u[d.scope]=d._styleColorTheme}}),this.light=e,this.ambientLight=t,this.directionalLight=r,this.fog=i,this.snow=o,this.rain=a,this._styleColorThemeForScope=u,null===n?delete this.terrain:this.terrain=n,this.camera=c||{"camera-projection":"perspective"},this.projection=s||{name:"mercator"},this.transition=Object.assign({},On,l),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(e){const t=r=>{for(const e of r.fragments)t(e.style);e(r)};t(this)}_prioritizeTerrain(e,t,r){const n=e&&0===e.drapeRenderMode;return null===r?t&&0===t.drapeRenderMode?t:n?e:null:null!=t&&(!e||n||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)}),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const t={},r={},n={};this.forEachFragmentStyle(i=>{for(const r in i._sourceCaches){const n=e.B(r,i.scope);t[n]=i._sourceCaches[r]}for(const t in i._otherSourceCaches){const n=e.B(t,i.scope);r[n]=i._otherSourceCaches[t]}for(const t in i._symbolSourceCaches){const r=e.B(t,i.scope);n[r]=i._symbolSourceCaches[t]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=n}mergeIndoor(){this.forEachFragmentStyle(t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const r of Object.values(t.stylesheet.indoor)){const n=r,i=e.B(n.sourceId,t.scope);this._mergedIndoor[i]=new Set(n.sourceLayers||[])}})}mergeLayers(){var t=this;const r={},n=[],i={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(t=>{for(const i of t._order){const o=t._layers[i];if("slot"===o.type){const t=e.dq(i);if(r[t])continue;r[t]=[]}o.slot&&r[o.slot]?r[o.slot].push(o):n.push(o)}}),this._mergedOrder=[];let o=-1;const a=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const s of n)if("slot"===s.type){const n=e.dq(s.id);r[n]&&a(r[n]),t._mergedSlots.push(n)}else{const r=e.B(s.id,s.scope);t._mergedOrder.push(r),i[r]=s,s.is3D(!!t.terrain)&&(t._has3DLayers=!0,o=t._mergedOrder.length-1),"circle"===s.type&&(t._hasCircleLayers=!0),"symbol"===s.type&&(t._hasSymbolLayers=!0),"clip"===s.type&&(t._clipLayerPresent=!0)}};if(a(n),this._has3DLayers){const e={};for(let t=0;t<this._mergedOrder.length;++t){const r=this._mergedOrder[t];e[r]=t===o?1:t<o?i[r].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((t,r)=>e[t]-e[r])}this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(t,r,n){const i=Object.assign({},r);for(const e of Object.keys(Bn))void 0===i[e]&&(i[e]=Bn[e].default);const o=new e.a8(Cn,t,new Map(n));return o.setTransitionOrValue(i,n),o.untransitioned().possiblyEvaluate(new e.ac(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((n,i)=>{const o="data:image/png;base64,";if(!t||0===t.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void n();let a=t;a.startsWith(o)||(a=o+a);const s=e.I.from("mapbox-reserved-lut"),l=new Image;l.src=a,l.onerror=()=>{this._styleColorTheme.lutLoading=!1,i(new Error("Failed to load image data"))},l.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void n();this._styleColorTheme.lutLoading=!1;const{width:o,height:a,data:c}=e.o.getImageData(l);if(a>32)return void i(new Error("The height of the image must be less than or equal to 32 pixels."));if(o!==a*a)return void i(new Error("The width of the image must be equal to the height squared."));this.getImage(s)&&this.removeImage(s),this.addImage(s,{data:new e.q({width:o,height:a},c),pixelRatio:1,sdf:!1,usvg:!1,version:0});const u=this.imageManager.getImage(s,this.scope);u?(this._styleColorTheme.lut={image:u.data,data:t},n()):i(new Error("Missing LUT image."))}})}getLut(e){const t=this._styleColorThemeForScope[e];return t?t.lut:null}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,r,n){let i,o,a;const s=e.o.devicePixelRatio>1?"@2x":"";let l=e.m(r.transformRequest(r.normalizeSpriteURL(t,s,".json"),e.R.SpriteJSON),(e,t)=>{l=null,a||(a=e,i=t,u())}),c=e.n(r.transformRequest(r.normalizeSpriteURL(t,s,".png"),e.R.SpriteImage),(e,t)=>{c=null,a||(a=e,o=t,u())});function u(){if(a)n(a);else if(i&&o){const t=e.o.getImageData(o),r={};for(const n in i){const{width:o,height:a,x:s,y:l,sdf:c,pixelRatio:u,stretchX:d,stretchY:h,content:A}=i[n],f=new e.q({width:o,height:a});e.q.copy(t,f,{x:s,y:l},{x:0,y:0},{width:o,height:a},null),r[n]={data:f,pixelRatio:void 0!==u?u:1,sdf:void 0!==c&&c,stretchX:d,stretchY:h,content:A,usvg:!1,version:0}}n(null,r)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,(t,r)=>{if(this._spriteRequest=null,t)this.fire(new e.y(t));else if(r){const t=new Map;for(const n in r)t.set(e.I.from(n),r[n]);this.addImages(t)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.z("data",{dataType:"style"}))})}addIconset(t,r){if("sprite"===r.type)return void this._loadSprite(r.url);const n=this.getOwnSourceCache(r.source);if(!n)return void this.fire(new e.y(new Error('Source "'.concat(r.source,'" as specified by iconset "').concat(t,'" does not exist and cannot be used as an iconset source'))));const i=n.getSource();if("raster-array"!==i.type)return void this.fire(new e.y(new Error('Source "'.concat(r.source,'" as specified by iconset "').concat(t,'" is not a "raster-array" source and cannot be used as an iconset source'))));i.partial=!1;const o=new Tn(t,this.scope,n);this.imageManager.addImageProvider(o,this.scope)}removeIconset(e){this.imageManager.removeImageProvider(e,this.scope)}_loadIconset(t){if(!e.h(t)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(t);const r="auto"===this.map._spriteFormat;var n,i;this._spriteRequest=(i=(n,i)=>{if(this._spriteRequest=null,n)r?this._loadSprite(t):this.fire(new e.y(n));else if(i){const t=new Map;for(const r in i)t.set(e.I.from(r),i[r]);this.addImages(t)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.z("data",{dataType:"style"}))},e.bu((n=this.map._requestManager).transformRequest(n.normalizeIconsetURL(t),e.R.Iconset),(t,r)=>{if(t)return void i(t);const n={},o=e.dg(new e.bt(r));for(const i of o.icons){const t={version:1,pixelRatio:e.o.devicePixelRatio,content:En(i),stretchX:i.metadata?Sn(i.metadata.stretch_x_areas):void 0,stretchY:i.metadata?Sn(i.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:i};n[i.name]=t}i(null,n)}))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const n=t.sourceLayer;n&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(n))&&this.fire(new e.y(new Error('Source layer "'.concat(n,'" does not exist on source "').concat(r.id,'" as specified by style layer "').concat(t.id,'"'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(this.imageManager.hasPatternsInFlight())return!1;if(!this.modelManager.isLoaded())return!1;if(this._styleColorTheme.lutLoading)return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,t)=>{const r=this.fragments[t];return r&&r.style&&(e.data=r.style.serialize()),e})}_serializeSources(){const e={};for(const t in this._sourceCaches){const r=this._sourceCaches[t].getSource();e[r.id]||(e[r.id]=r.serialize())}return e}_serializeLayers(e){const t=[];for(const r of e){const e=this._layers[r];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;if(this.hasSnowTransition())return!0;if(this.hasRainTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const e in this._mergedLayers){const t=this._mergedLayers[e];if(t._transitionablePaint&&t._transitionablePaint._values){const e=t._transitionablePaint._values["line-emissive-strength"];if(e&&e.value&&e.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(e){return e?this.order:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new e.y(new Error("The layer '".concat(t,"' does not exist in the map's style."))))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new e.y(new Error("The source '".concat(t,"' does not exist in the map's style."))))}precompilePrograms(e,t){const r=this.map.painter;if(r)for(let n=e.minzoom||0;n<(e.maxzoom||25.5);n++){const n=e.getProgramIds();if(n)for(const i of n){const n=e.getDefaultProgramParams(i,t.zoom,this._styleColorTheme.lut);n&&(r.style=this,this.fog&&(r._fogVisible=!0,n.overrideFog=!0,r.getOrCreateProgram(i,n)),r._fogVisible=!1,n.overrideFog=!1,r.getOrCreateProgram(i,n),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(n.overrideRtt=!0,r.getOrCreateProgram(i,n)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const n=this._changes.isDirty();let i=!1;if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:r,removedIds:n}=e[t];(r||n)&&(this._updateWorkerLayers(t,r,n),i=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const o={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];o[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const r=this._mergedLayers[e];if("none"!==r.visibility&&r.recalculate(t,this._availableImages),!r.isHidden(t.zoom)){const e=this.getLayerSourceCache(r);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,r.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(r,t)}):this.precompilePrograms(r,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&i&&this.mergeLayers();const a=this.imageManager.getPendingImageProviders();for(const e of a)e.sourceCache.used=!0;for(const s in o){const t=this._mergedSourceCaches[s];o[s]!==t.used&&t.getSource().fire(new e.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),n&&this.fire(new e.z("data",{dataType:"style"}))}updateImageProviders(){const e=this.imageManager.getPendingImageProviders();for(const t of e){const e=t.resolvePendingRequests(),r=this.getFragmentStyle(t.scope);r&&r.addImages(e)}}_updateTilesForChangedImages(){const e={};for(const t in this._mergedSourceCaches){const r=this._mergedSourceCaches[t].getSource().scope;e[r]=e[r]||this._changes.getUpdatedImages(r),0!==e[r].length&&this._mergedSourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e[r])}for(const t in e)this._changes.resetUpdatedImages(t)}_updateWorkerLayers(e,t,r){const n=this.getFragmentStyle(e);n&&this.dispatcher.broadcast("updateLayers",{layers:t?n._serializeLayers(t):[],scope:e,removedIds:r||[],options:n.options})}setState(t,r){if(this._checkLoaded(),In(this,Ce(t)))return!1;(t=e.dp(t)).layers=Gt(t.layers);const n=function(t,r){if(!t)return[{command:Kt.setStyle,args:[r]}];let n=[];try{if(!e.by(t.version,r.version))return[{command:Kt.setStyle,args:[r]}];if(e.by(t.center,r.center)||n.push({command:Kt.setCenter,args:[r.center]}),e.by(t.zoom,r.zoom)||n.push({command:Kt.setZoom,args:[r.zoom]}),e.by(t.bearing,r.bearing)||n.push({command:Kt.setBearing,args:[r.bearing]}),e.by(t.pitch,r.pitch)||n.push({command:Kt.setPitch,args:[r.pitch]}),e.by(t.sprite,r.sprite)||n.push({command:Kt.setSprite,args:[r.sprite]}),e.by(t.glyphs,r.glyphs)||n.push({command:Kt.setGlyphs,args:[r.glyphs]}),e.by(t.imports,r.imports)||function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;r=r||[];const i=(t=t||[]).map(Jt),o=r.map(Jt),a=t.reduce($t,{}),s=r.reduce($t,{}),l=i.slice();let c,u,d,h;for(c=0,u=0;c<i.length;c++)d=i[c],s.hasOwnProperty(d)?u++:(n.push({command:Kt.removeImport,args:[d]}),l.splice(l.indexOf(d,u),1));for(c=0,u=0;c<o.length;c++)d=o[o.length-1-c],l[l.length-1-c]!==d&&(a.hasOwnProperty(d)?(n.push({command:Kt.removeImport,args:[d]}),l.splice(l.lastIndexOf(d,l.length-u),1)):u++,h=l[l.length-c],n.push({command:Kt.addImport,args:[s[d],h]}),l.splice(l.length-c,0,d));for(const A of r){const t=a[A.id];t&&(delete t.data,e.by(t,A)||n.push({command:Kt.updateImport,args:[A.id,A]}))}}(t.imports,r.imports,n),e.by(t.transition,r.transition)||n.push({command:Kt.setTransition,args:[r.transition]}),e.by(t.light,r.light)||n.push({command:Kt.setLight,args:[r.light]}),e.by(t.fog,r.fog)||n.push({command:Kt.setFog,args:[r.fog]}),e.by(t.snow,r.snow)||n.push({command:Kt.setSnow,args:[r.snow]}),e.by(t.rain,r.rain)||n.push({command:Kt.setRain,args:[r.rain]}),e.by(t.projection,r.projection)||n.push({command:Kt.setProjection,args:[r.projection]}),e.by(t.lights,r.lights)||n.push({command:Kt.setLights,args:[r.lights]}),e.by(t.camera,r.camera)||n.push({command:Kt.setCamera,args:[r.camera]}),e.by(t.iconsets,r.iconsets)||function(t,r,n){let i;for(i in r=r||{},t=t||{})t.hasOwnProperty(i)&&(r.hasOwnProperty(i)||n.push({command:Kt.removeIconset,args:[i]}));for(i in r){if(!r.hasOwnProperty(i))continue;const o=r[i];t.hasOwnProperty(i)?e.by(t[i],o)||(n.push({command:Kt.removeIconset,args:[i]}),n.push({command:Kt.addIconset,args:[i,o]})):n.push({command:Kt.addIconset,args:[i,o]})}}(t.iconsets,r.iconsets,n),!e.by(t["color-theme"],r["color-theme"]))return[{command:Kt.setStyle,args:[r]}];const i={},o=[];!function(t,r,n,i){let o;for(o in r=r||{},t=t||{})t.hasOwnProperty(o)&&(r.hasOwnProperty(o)||qt(o,n,i));for(o in r){if(!r.hasOwnProperty(o))continue;const a=r[o];t.hasOwnProperty(o)?e.by(t[o],a)||("geojson"===t[o].type&&"geojson"===a.type&&Xt(t,r,o)?n.push({command:Kt.setGeoJSONSourceData,args:[o,a.data]}):Zt(o,r,n,i)):Wt(o,r,n)}}(t.sources,r.sources,o,i);const a=[];t.layers&&t.layers.forEach(e=>{e.source&&i[e.source]?n.push({command:Kt.removeLayer,args:[e.id]}):a.push(e)});let s=t.terrain;s&&i[s.source]&&(n.push({command:Kt.setTerrain,args:[void 0]}),s=void 0),n=n.concat(o),e.by(s,r.terrain)||n.push({command:Kt.setTerrain,args:[r.terrain]}),function(t,r,n){r=r||[];const i=(t=t||[]).map(Jt),o=r.map(Jt),a=t.reduce($t,{}),s=r.reduce($t,{}),l=i.slice(),c=Object.create(null);let u,d,h,A,f,p,m;for(u=0,d=0;u<i.length;u++)h=i[u],s.hasOwnProperty(h)?d++:(n.push({command:Kt.removeLayer,args:[h]}),l.splice(l.indexOf(h,d),1));for(u=0,d=0;u<o.length;u++)h=o[o.length-1-u],l[l.length-1-u]!==h&&(a.hasOwnProperty(h)?(n.push({command:Kt.removeLayer,args:[h]}),l.splice(l.lastIndexOf(h,l.length-d),1)):d++,p=l[l.length-u],n.push({command:Kt.addLayer,args:[s[h],p]}),l.splice(l.length-u,0,h),c[h]=!0);for(u=0;u<o.length;u++)if(h=o[u],A=a[h],f=s[h],!c[h]&&!e.by(A,f))if(e.by(A.source,f.source)&&e.by(A["source-layer"],f["source-layer"])&&e.by(A.type,f.type)){for(m in Yt(A.layout,f.layout,n,h,null,Kt.setLayoutProperty),Yt(A.paint,f.paint,n,h,null,Kt.setPaintProperty),e.by(A.slot,f.slot)||n.push({command:Kt.setSlot,args:[h,f.slot]}),e.by(A.filter,f.filter)||n.push({command:Kt.setFilter,args:[h,f.filter]}),e.by(A.minzoom,f.minzoom)&&e.by(A.maxzoom,f.maxzoom)||n.push({command:Kt.setLayerZoomRange,args:[h,f.minzoom,f.maxzoom]}),A)A.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?Yt(A[m],f[m],n,h,m.slice(6),Kt.setPaintProperty):e.by(A[m],f[m])||n.push({command:Kt.setLayerProperty,args:[h,m,f[m]]}));for(m in f)f.hasOwnProperty(m)&&!A.hasOwnProperty(m)&&"layout"!==m&&"paint"!==m&&"filter"!==m&&"metadata"!==m&&"minzoom"!==m&&"maxzoom"!==m&&"slot"!==m&&(0===m.indexOf("paint.")?Yt(A[m],f[m],n,h,m.slice(6),Kt.setPaintProperty):e.by(A[m],f[m])||n.push({command:Kt.setLayerProperty,args:[h,m,f[m]]}))}else n.push({command:Kt.removeLayer,args:[h]}),p=l[l.lastIndexOf(h)+1],n.push({command:Kt.addLayer,args:[f,p]})}(a,r.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:Kt.setStyle,args:[r]}]}return n}(this.serialize(),t).filter(e=>!(e.command in kn));if(0===n.length)return!1;const i=n.filter(e=>!(e.command in Fn));if(i.length>0)throw new Error("Unimplemented: ".concat(i.map(e=>e.command).join(", "),"."));const o=[];return n.forEach(e=>{o.push(this[e.command](...e.args))}),r&&Promise.all(o).then(r).catch(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(0===t.size)return this;for(const[r,n]of t.entries()){if(this.getImage(r))return this.fire(new e.y(new Error('An image with the name "'.concat(r.name,'" already exists.'))));this.imageManager.addImage(r,this.scope,n),this._changes.updateImage(r,this.scope)}return this._updateWorkerImages(),this.fire(new e.z("data",{dataType:"style"})),this}addImage(t,r){return this.getImage(t)?this.fire(new e.y(new Error('An image with the name "'.concat(t.name,'" already exists.')))):(this.imageManager.addImage(t,this.scope,r),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.z("data",{dataType:"style"})),this)}updateImage(t,r){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.imageManager.updateImage(t,this.scope,r),n&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.z("data",{dataType:"style"})))}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.z("data",{dataType:"style"})),this):this.fire(new e.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new e.z("data",{dataType:"style"})),this}addModel(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(Ue,"models.".concat(t),r,null,n)||(this.modelManager.addModel(t,r,this.getActualScope()),this.fire(new e.z("data",{dataType:"style"}))),this}hasModel(e){return this.modelManager.hasModel(e,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new e.z("data",{dataType:"style"})),this):this.fire(new e.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error('There is already a source with ID "'.concat(t,'".'));if(!r.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(r).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(Ee,"sources.".concat(t),r,null,n))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const i=_t(t,r,this.dispatcher,this);i.scope=this.scope,i.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i.id),source:i.serialize(),sourceId:i.id}));const o=t=>{const r=(t?"symbol:":"other:")+i.id,n=e.B(r,this.scope),o=this._sourceCaches[r]=new zt(n,i,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[i.id]=o,o.onAdd(this.map)};o(!1),"vector"!==r.type&&"geojson"!==r.type||o(!0),i.onAdd&&i.onAdd(this.map),n.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.y(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(i,'" is using it.'))));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.y(new Error('Source "'.concat(t,'" cannot be removed while terrain is using it.'))));if(this.stylesheet.iconsets){const r=Object.entries(this.stylesheet.iconsets).find(e=>{let[r,n]=e;return"source"===n.type&&n.source===t});if(r)return this.fire(new e.y(new Error('Source "'.concat(t,'" cannot be removed while iconset "').concat(r[0],'" is using it.'))))}const n=this.getOwnSourceCaches(t);for(const i of n){const t=e.dq(i.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(i.id),i.fire(new e.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:i.getSource().id})),i.setEventedParent(null),i.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const r=this.getOwnSourceCache(t);r&&e.push(r.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const r=e[t]._tiles;for(const e in r){const t=r[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const o of t){if(this._validate(Te,"lights",o))return;switch(o.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(o),e.updateTransitions(r)}else this.ambientLight=new at(o,rt||(rt=new e.a9({color:new e.aa(e.a6.properties_light_ambient.color),"color-use-theme":new e.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.aa(e.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(o),e.updateTransitions(r)}else this.directionalLight=new at(o,nt||(nt=new e.a9({direction:new e.ap(e.a6.properties_light_directional.direction),color:new e.aa(e.a6.properties_light_directional.color),"color-use-theme":new e.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.aa(e.a6.properties_light_directional.intensity),"cast-shadows":new e.aa(e.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new e.aa(e.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new e.aa(e.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const n=Object.assign(r,{worldview:this.map.getWorldview()}),i=new e.ac(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const n=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),i=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),o=t.properties.get("intensity"),a=t.properties.get("direction"),s=1-e.d4(a.x,a.y,a.z)[2]/90,l=n(i)*o*s,c=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),u=r.properties.get("intensity"),d=n(c)*u;return Number(((l+d)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(null==t||""===t&&this.isRootStyle())return this;if(e.dr(t)){const r=e.ds(t),n=this.fragments.find(e=>{let{id:t}=e;return t===r});if(!n)return;const i=e.dq(t);return n.style.getFragmentStyle(i)}{const e=this.fragments.find(e=>{let{id:r}=e;return r===t});return e?e.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const r={},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"".concat(e,"::").concat(t)};this._featuresetSelectors={};for(const i in t){const o=this._featuresetSelectors[i]=[];for(const a of t[i].selectors){if(a.featureNamespace){const t=this.getOwnLayer(a.layer);if(!t){e.w("Layer is undefined for selector: ".concat(a.layer));continue}const o=n(t.source,t.sourceLayer);if(o in r&&r[o]!==a.featureNamespace){e.w('"featureNamespace '.concat(a.featureNamespace," of featureset ").concat(i,"'s selector is not associated to the same source, skip this selector"));continue}r[o]=a.featureNamespace}let t;if(a.properties)for(const r in a.properties){const n=e.U(a.properties[r]);"success"===n.result&&(t=t||{},t[r]=n.value)}o.push({layerId:a.layer,namespace:a.featureNamespace,properties:t,uniqueFeatureID:a._uniqueFeatureID})}}}getFeaturesetDescriptors(e){const t=this.getFragmentStyle(e);if(!t||!t.stylesheet.featuresets)return[];const r=[];for(const n in t.stylesheet.featuresets)r.push({featuresetId:n,importId:t.scope?t.scope:void 0});return r}getFeaturesetLayers(t,r){const n=this.getFragmentStyle(r),i=n.stylesheet.featuresets;if(!i||!i[t])return this.fire(new e.y(new Error("The featureset '".concat(t,"' does not exist in the map's style and cannot be queried.")))),[];const o=[];for(const e of i[t].selectors){const t=n.getOwnLayer(e.layer);t&&o.push(t)}return o}getConfigProperty(t,r){const n=this.getFragmentStyle(t);if(!n)return null;const i=e.B(r,n.scope),o=n.options.get(i),a=o?o.value||o.default:null;return a?a.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,r){const n=e.B(t,r);return this._mergedIndoor[n]}setIndoorData(e,t){this.map.indoor.setIndoorData(t)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,r,n){const i=this.getFragmentStyle(t);if(!i)return;const o=i.stylesheet.schema;if(!o||!o[r])return;const a=e.U(n);if("success"!==a.result)return void In(this,a.value);const s=a.value.expression,l=e.B(r,i.scope),c=i.options.get(l);if(!c)return;let u;const{minValue:d,maxValue:h,stepValue:A,type:f,values:p}=o[r],m=e.U(o[r].default);"success"===m.result&&(u=m.value.expression),u?(this.options.set(l,Object.assign({},c,{value:s,default:u,minValue:d,maxValue:h,stepValue:A,type:f,values:p})),this.updateConfigDependencies(r)):this.fire(new e.y(new Error('No schema defined for the config option "'.concat(r,'" in the "').concat(t,'" fragment.'))))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const n=r.stylesheet.schema;if(!n)return null;const i={};for(const o in n){const t=e.B(o,r.scope),n=r.options.get(t),a=n?n.value||n.default:null;i[o]=a?a.serialize():null}return i}setConfig(e,t){const r=this.getFragmentStyle(e);r&&(r.updateConfig(t,r.stylesheet.schema),this.updateConfigDependencies())}getSchema(e){const t=this.getFragmentStyle(e);return t?t.stylesheet.schema:null}setSchema(e,t){const r=this.getFragmentStyle(e);r&&(r.stylesheet.schema=t,r.updateConfig(r._config,t),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const n in r){let i,o;const a=e.U(r[n].default);if("success"===a.result&&(i=a.value.expression),t&&void 0!==t[n]){const r=e.U(t[n]);"success"===r.result&&(o=r.value.expression)}const{minValue:s,maxValue:l,stepValue:c,type:u,values:d}=r[n];if(i){const t=e.B(n,this.scope);this.options.set(t,{default:i,value:o,minValue:s,maxValue:l,stepValue:c,type:u,values:d})}else this.fire(new e.y(new Error('No schema defined for config option "'.concat(n,'".'))))}else this.fire(new e.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;for(const r of e){const e=this.getLayer(r);e&&t(e)&&(e.possiblyEvaluateVisibility(),this._updateLayer(e),this._changes.setDirty())}}updateConfigDependencies(e){this._updateLayers(this._configDependentLayers,t=>!e||t.expressionDependencies.configDependencies.has(e)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(e=>{const t=e._styleColorTheme.colorThemeOverride?e._styleColorTheme.colorThemeOverride:e._styleColorTheme.colorTheme;if(t){const r=e._evaluateColorThemeData(t);(!e._styleColorTheme.lut&&""!==r||e._styleColorTheme.lut&&r!==e._styleColorTheme.lut.data)&&e.setColorTheme(t)}}),this._changes.setDirty()}addLayer(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=t.id;if(this._layers[i])return void this.fire(new e.y(new Error('Layer with id "'.concat(i,'" already exists on this map'))));let o;if("custom"===t.type){if(In(this,e.dt(t)))return;o=e.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof t.source&&(this.addSource(i,t.source),t=e.dp(t),t=Object.assign(t,{source:i})),this._validate(Me,"layers.".concat(i),t,{arrayIndex:-1},n))return;o=e.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}})}const a=e.B(o.source,o.scope);0!==o.expressionDependencies.configDependencies.size&&this._configDependentLayers.add(a),o.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(a);let s=this._order.length;if(r){const t=this._order.indexOf(r);if(-1===t)return void this.fire(new e.y(new Error('Layer with id "'.concat(r,'" does not exist on this map.'))));o.slot===this._layers[r].slot?s=t:e.w('Layer with id "'.concat(r,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(s,0,i),this._layerOrderChanged=!0,this._layers[i]=o;const l=this.getOwnLayerSourceCache(o),c=!!this.directionalLight&&this.directionalLight.shadowsEnabled();l&&o.canCastShadows()&&c&&(l.castsShadows=!0);const u=this._changes.getRemovedLayer(o);if(u&&o.source&&l&&"custom"!==o.type){this._changes.discardLayerRemoval(o);const t=e.B(o.source,o.scope);u.type!==o.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),l.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;if(t===r)return;const i=this._order.indexOf(t);this._order.splice(i,1);let o=this._order.length;if(r){const t=this._order.indexOf(r);if(-1===t)return void this.fire(new e.y(new Error('Layer with id "'.concat(r,'" does not exist on this map.'))));n.slot===this._layers[r].slot?o=t:e.w('Layer with id "'.concat(r,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(o,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),delete this._layers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._indoorDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const n=this.getOwnLayerSourceCache(t);if(n&&n.castsShadows){let e=!1;for(const r in this._layers)if(this._layers[r].source===t.source&&this._layers[r].canCastShadows()){e=!0;break}n.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,r){this._checkLoaded();const n=this._checkLayer(e);n&&(n.minzoom===t&&n.maxzoom===r||(null!=t&&(n.minzoom=t),null!=r&&(n.maxzoom=r),this._updateLayer(n)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(e,t){this._checkLoaded();const r=this._checkLayer(e);r&&r.slot!==t&&(r.slot=t,this._updateLayer(r))}setFilter(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this._checkLayer(t);if(i&&!e.by(i.filter,r))return null==r?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(Oe,"layers.".concat(i.id,".filter"),r,{layerType:i.type},n)||(i.filter=e.dp(r),this._updateLayer(i)))}getFilter(t){const r=this._checkLayer(t);if(r)return e.dp(r.filter)}setLayoutProperty(t,r,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this._checkLayer(t);if(o&&!e.by(o.getLayoutProperty(r),n)){if(null!=n&&(!i||!1!==i.validate)&&In(o,De.call(Ce,{key:"layers.".concat(t,".layout.").concat(r),layerType:o.type,objectKey:r,value:n,styleSpec:e.a6,style:{glyphs:!0,sprite:!0}})))return;o.setLayoutProperty(r,n),0!==o.expressionDependencies.configDependencies.size&&this._configDependentLayers.add(o.fqid),o.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(o.fqid),this._updateLayer(o)}}setLayerProperty(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const i=this._checkLayer(e);i&&("appearances"===t?(i.setAppearances(r),this._changes.setDirty()):i.isPaintProperty(t)?this.setPaintProperty(e,t,r,n):this.setLayoutProperty(e,t,r,n))}getLayoutProperty(e,t){const r=this._checkLayer(e);if(r)return r.getLayoutProperty(t)}setPaintProperty(t,r,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const o=this._checkLayer(t);if(!o)return;if(e.by(o.getPaintProperty(r),n))return;if(null!=n&&(!i||!1!==i.validate)&&In(o,Le.call(Ce,{key:"layers.".concat(t,".paint.").concat(r),layerType:o.type,objectKey:r,value:n,styleSpec:e.a6})))return;const a=o.setPaintProperty(r,n);0!==o.expressionDependencies.configDependencies.size&&this._configDependentLayers.add(o.fqid),o.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(o.fqid),a&&this._updateLayer(o),this._changes.updatePaintProperties(o)}getPaintProperty(e,t){const r=this._checkLayer(e);if(r)return r.getPaintProperty(t)}setFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:n}=t.target,i=this.getFragmentStyle(n),o=i.getFeaturesetLayers(e);for(const{source:a,sourceLayer:s}of o)i.setFeatureState({id:t.id,source:a,sourceLayer:s},r)}else if("layerId"in t.target){const{layerId:e}=t.target,n=this.getLayer(e);this.setFeatureState({id:t.id,source:n.source,sourceLayer:n.sourceLayer},r)}return}const n=t.source,i=t.sourceLayer,o=this._checkSource(n);if(!o)return;const a=o.type;if("geojson"===a&&i)return void this.fire(new e.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===a&&!i)return void this.fire(new e.y(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.y(new Error("The feature id parameter must be provided.")));const s=this.getOwnSourceCaches(n);for(const e of s)e.setFeatureState(i,t.id,r)}removeFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:n}=t.target,i=this.getFragmentStyle(n),o=i.getFeaturesetLayers(e);for(const{source:a,sourceLayer:s}of o)i.removeFeatureState({id:t.id,source:a,sourceLayer:s},r)}else if("layerId"in t.target){const{layerId:e}=t.target,n=this.getLayer(e);this.removeFeatureState({id:t.id,source:n.source,sourceLayer:n.sourceLayer},r)}return}const n=t.source,i=this._checkSource(n);if(!i)return;const o=i.type,a="vector"===o?t.sourceLayer:void 0;if("vector"===o&&!a)return void this.fire(new e.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.y(new Error("A feature id is required to remove its specific state property.")));const s=this.getOwnSourceCaches(n);for(const e of s)e.removeFeatureState(a,t.id,r)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let r;if("featuresetId"in t.target){const{featuresetId:n,importId:i}=t.target,o=this.getFragmentStyle(i),a=o.getFeaturesetLayers(n);for(const{source:s,sourceLayer:l}of a){const n=o.getFeatureState({id:t.id,source:s,sourceLayer:l});if(n&&!r)r=n;else if(!e.by(r,n))return void this.fire(new e.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:e}=t.target,n=this.getLayer(e);r=this.getFeatureState({id:t.id,source:n.source,sourceLayer:n.sourceLayer})}return r}const r=t.source,n=t.sourceLayer,i=this._checkSource(r);if(i){if("vector"!==i.type||n)return void 0===t.id&&this.fire(new e.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(n,t.id);this.fire(new e.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},e=>void 0!==e)}_updateFilteredLayers(e){for(const t of Object.values(this._mergedLayers))e(t)&&this._updateLayer(t)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),n=e.B(t.source,t.scope),i=this._changes.getUpdatedSourceCaches();t.source&&!i[n]&&r&&"raster"!==r.getSource().type&&(this._changes.updateSourceCache(n,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>this._mergedLayers[e].is3D(!!this.terrain),r=this.order,n={},i=[];for(let a=r.length-1;a>=0;a--){const o=r[a];if(t(o)){n[o]=a;for(const t of e){const e=t[o];if(e)for(const t of e)i.push(t)}}}i.sort((e,t)=>t.intersectionZ-e.intersectionZ);const o=[];for(let a=r.length-1;a>=0;a--){const s=r[a];if(t(s))for(let e=i.length-1;e>=0;e--){const t=i[e].feature;if(t.layer&&n[t.layer.id]<a)break;o.push(t),i.pop()}else for(const t of e){const e=t[s];if(e)for(const t of e)o.push(t.feature)}}return o}queryRasterValue(t,r,n){const i=this.getOwnSource(t);return i?"raster-array"!==i.type?(this.fire(new e.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):i.queryRasterArrayValue(r,n):(this.fire(new e.y(new Error('Source with id "'.concat(t,'" does not exist in the style.')))),Promise.resolve(null))}queryRenderedFeatures(t,r,n){let i;r&&!Array.isArray(r)&&r.filter&&(this._validate(Oe,"queryRenderedFeatures.filter",r.filter,null,r),i=e.b6(r.filter));const o={},a=e=>{if(Pn.has(e.type))return;const t=this.getOwnLayerSourceCache(e),r=o[t.id]=o[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};e.is3D(!!this.terrain)&&(r.has3DLayers=!0),r.layers[e.fqid]=r.layers[e.fqid]||{styleLayer:e,targets:[]},r.layers[e.fqid].targets.push({filter:i})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new e.y(new Error("parameters.layers must be an Array."))),[];for(const t of r.layers){const r=this._layers[t];if(!r)return this.fire(new e.y(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be queried for features.")))),[];a(r)}}else for(const e in this._layers)a(this._layers[e]);const s=this._queryRenderedFeatures(t,o,n),l=this._flattenAndSortRenderedFeatures(s),c=[];for(const u of l)e.dw(u.layer.id)===this.scope&&c.push(u);return c}queryRenderedFeatureset(t,r,n){let i;r&&!Array.isArray(r)&&r.filter&&(this._validate(Oe,"queryRenderedFeatures.filter",r.filter,null,r),i=e.b6(r.filter));const o="mock",a=[];if(r&&r.target)a.push(Object.assign({},r,{targetId:o,filter:i}));else{const e=this.getFeaturesetDescriptors();for(const t of e)a.push({targetId:o,filter:i,target:t});for(const{style:t}of this.fragments){const e=t.getFeaturesetDescriptors();for(const t of e)a.push({targetId:o,filter:i,target:t})}}const s=this.queryRenderedTargets(t,a,n),l=[],c=new Set;for(const u of s)for(const t of u.variants[o])xt(t,u,c)||l.push(new e.dx(u,t));return l}queryRenderedTargets(t,r,n){const i={},o=(e,t,r,n)=>{const o=i[t.id]=i[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};if(o.layers[e.fqid]=o.layers[e.fqid]||{styleLayer:e,targets:[]},e.is3D(!!this.terrain)&&(o.has3DLayers=!0),!n)return r.uniqueFeatureID=!1,void o.layers[e.fqid].targets.push(r);o.layers[e.fqid].targets.push(Object.assign({},r,{namespace:n.namespace,properties:n.properties,uniqueFeatureID:n.uniqueFeatureID}))};for(const s of r)if("featuresetId"in s.target){const{featuresetId:t,importId:r}=s.target,n=this.getFragmentStyle(r);if(!n||!n._featuresetSelectors)continue;const i=n._featuresetSelectors[t];if(!i){this.fire(new e.y(new Error("The featureset '".concat(t,"' does not exist in the map's style and cannot be queried for features."))));continue}for(const e of i){const t=n.getOwnLayer(e.layerId);t&&!Pn.has(t.type)&&o(t,n.getOwnLayerSourceCache(t),s,e)}}else if("layerId"in s.target){const{layerId:e}=s.target,t=this.getLayer(e);if(!t||Pn.has(t.type))continue;o(t,this.getLayerSourceCache(t),s)}const a=this._queryRenderedFeatures(t,i,n);return this._flattenAndSortRenderedFeatures(a)}_queryRenderedFeatures(e,t,r){const n=[],i=!!this.map._showQueryGeometry,o=st.createFromScreenPoints(e,r);for(const a in t){const e=wt(o,t[a],this._availableImages,r,i);Object.keys(e).length&&n.push(e)}if(this.placement)for(const a in t){if(!t[a].sourceCache._onlySymbols)continue;const e=bt(o.screenGeometry,t[a],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(e).length&&n.push(e)}return n}querySourceFeatures(e,t){const r=t&&t.filter;r&&this._validate(Oe,"querySourceFeatures.filter",r,null,t);let n=[];const i=this.getOwnSourceCaches(e);for(const o of i)n=n.concat(Bt(o,t));return n}addSourceType(e,t,r){return Ln.getSourceType(e)?r(new Error('A source type called "'.concat(e,'" already exists.'))):(Ln.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this.light.getLight();let o=!1;for(const s in t)if(!e.by(t[s],i[s])){o=!0;break}if(!o)return;const a=this._getTransitionParameters();this.light.setLight(t,r,n),this.light.updateTransitions(a)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===r&&delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let n=t;const i=!("source"in t)||null==t.source;if(1===r){if(this.disableElevatedTerrain)return;if("source"in n&&"object"==typeof n.source){const t="terrain-dem-src";this.addSource(t,n.source),n=e.dp(n),n=Object.assign(n,{source:t})}const t=Object.assign({},n),r={};if(this.terrain&&i){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(r.style=e.serialize())}if(this._validate(Ie,"terrain",t,r))return}if(!this.terrain||this.terrain.scope!==this.scope&&!i||this.terrain&&r!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,r),this.fire(new e.z("data",{dataType:"style"}))}else{const r=this.terrain,i=r.get();for(const t of Object.keys(e.a6.terrain))!n.hasOwnProperty(t)&&e.a6.terrain[t].default&&(n[t]=e.a6.terrain[t].default);for(const n in t)if(!e.by(t[n],i[n])){r.set(t,this.options),this.stylesheet.terrain=t;const n=this._getTransitionParameters({duration:0});r.updateTransitions(n),this.fire(new e.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new $e(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const r=this._getTransitionParameters({duration:0});t.updateTransitions(r)}_createSnow(e){const t=this.snow=new it(e,this.map.transform,this.scope,this.options);this.stylesheet.snow=t.get();const r=this._getTransitionParameters({duration:0});t.updateTransitions(r)}_createRain(e){const t=this.rain=new ot(e,this.map.transform,this.scope,this.options);this.stylesheet.rain=t.get();const r=this._getTransitionParameters({duration:0});t.updateTransitions(r)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!e.by(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const e=this._getTransitionParameters({duration:0});r.updateTransitions(e)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const r=this.snow;if(!e.by(r.get(),t)){r.set(t,this.options),this.stylesheet.snow=r.get();const e=this._getTransitionParameters({duration:0});r.updateTransitions(e)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const r=this.rain;if(!e.by(r.get(),t)){r.set(t,this.options),this.stylesheet.rain=r.get();const e=this._getTransitionParameters({duration:0});r.updateTransitions(e)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const e in this._layers)this._layers[e].lut=this._styleColorTheme.lut;for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void t();const n=this._evaluateColorThemeData(r);this._loadColorTheme(n).then(()=>{this.fire(new e.z("colorthemeset")),t()}).catch(t=>{e.w("Couldn't set color theme: ".concat(t))})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&e.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(e,t){const r=this.getFragmentStyle(e);r&&(r._styleColorTheme.colorThemeOverride=t,r._reloadColorTheme())}_getTransitionParameters(t){return{now:e.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const r of this._mergedOrder)this.isLayerDraped(this._mergedLayers[r])?e.push(r):t.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const r=this.terrain=new He(e,t,this.scope,this.options,this.map.getWorldview());1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const n=this._getTransitionParameters({duration:0});r.updateTransitions(n)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,r,n,i){let o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(o&&!1===o.validate)return!1;const a=Object.assign({},this.serialize());return In(this,t.call(Ce,Object.assign({key:r,style:a,value:n,styleSpec:e.a6},i)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const r of t)r.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}clearLayers(){for(const e in this._mergedLayers){const t=this._mergedLayers[e];t._clear&&t._clear()}}reloadSource(e){const t=this.getSourceCaches(e);for(const r of t)r.resume(),r.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(e=>{e.modelManager.reloadModels(e.scope)})}updateSources(e){let t;this.directionalLight&&(t=vn(this.directionalLight));const r=new Set,n=new Set;for(const i in this._mergedLayers){const e=this._mergedLayers[i];"building"===e.type&&r.add(e.source),e.hasElevation()&&!n.has(e.source)&&n.add(e.source)}for(const i in this._mergedSourceCaches){const o=this._mergedSourceCaches[i],a=n.has(o._source.id);r.has(o._source.id)&&(o._source.reparseOverscaled=!1),o.update(e,void 0,void 0,t,a)}}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,r,n,i,o,a){let s=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!1,c=!1;const u={},d={};for(const p of this._mergedOrder){const t=this._mergedLayers[p];if("symbol"!==t.type)continue;const n=e.B(t.source,t.scope);let i=u[n];if(!i){const e=this.getLayerSourceCache(t);if(!e)continue;const r=e.getRenderableIds(!0).map(t=>e.getTileByID(t));d[n]=r.slice(),i=u[n]=r.sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const o=this.crossTileSymbolIndex.addLayer(t,i,r.center.lng,r.projection);l=l||o}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),s=s||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new e.z("neworder"));const h=Boolean(this.placement&&!r.equals(this.placement.transform)),A=Boolean(this.placement&&(0!==this.placement.lastReplacementSourceUpdateTime&&!a||this.placement.lastReplacementSourceUpdateTime!==a.updateTime)),f=(h||A||l||this.placement&&this.placement.isStale())&&0===i;if((s||!this.pauseablePlacement||f||0!==i&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.o.now(),r.zoom))&&(this.pauseablePlacement=new Hr(r,this._mergedOrder,s||0===i,n,i,o,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,u,d,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.o.now()),c=!0),l&&this.pauseablePlacement.placement.setStale()),c||l){this._buildingIndex.onNewFrame(r.zoom);for(let t=0;t<this._mergedOrder.length;t++){const r=this._mergedLayers[this._mergedOrder[t]];if("symbol"!==r.type)continue;if("none"===r.visibility)continue;const n=this.isLayerClipped(r);this.placement.updateLayerOpacities(r,u[e.B(r.source,r.scope)],t,n?a:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.o.now())}}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==n.findIndex(e=>{let{id:r}=e;return r===t.id}))return void this.fire(new e.y(new Error("Import with id '".concat(t.id,"' already exists in the map's style."))));if(!r)return n.push(t),this._loadImports([t],!0);const i=n.findIndex(e=>{let{id:t}=e;return t===r});return-1===i&&this.fire(new e.y(new Error('Import with id "'.concat(r,'" does not exist on this map.')))),this.stylesheet.imports=n.slice(0,i).concat(t).concat(n.slice(i)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(t);return-1===i?this:"string"==typeof r?(this.setImportUrl(t,r),this):(r.url&&r.url!==n[i].url&&this.setImportUrl(t,r.url),e.by(r.config,n[i].config)||this.setImportConfig(t,r.config,r.data.schema),e.by(r.data,n[i].data)||this.setImportData(t,r.data),this)}moveImport(e,t){this._checkLoaded();let r=this.stylesheet.imports||[];const n=this.getImportIndex(e);if(-1===n)return this;const i=this.getImportIndex(t);if(-1===i)return this;const o=r[n],a=this.fragments[n];return r=r.filter(t=>{let{id:r}=t;return r!==e}),this.fragments=this.fragments.filter(t=>{let{id:r}=t;return r!==e}),this.stylesheet.imports=r.slice(0,i).concat(o).concat(r.slice(i)),this.fragments=this.fragments.slice(0,i).concat(a).concat(this.fragments.slice(i)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const r=this.stylesheet.imports||[],n=this.getImportIndex(e);if(-1===n)return this;r[n].url=t;const i=this.fragments[n];return i.style=this._createFragmentStyle(r[n]),i.style.on("style.import.load",()=>this.mergeAll()),i.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const r=this.getImportIndex(e),n=this.stylesheet.imports||[];return-1===r?this:t?(this.fragments[r].style.setState(t),this._reloadImports(),this):(delete n[r].data,this.setImportUrl(e,n[r].url))}setImportConfig(e,t,r){this._checkLoaded();const n=this.getImportIndex(e),i=this.stylesheet.imports||[];if(-1===n)return this;t?i[n].config=t:delete i[n].config;const o=this.fragments[n];r&&o.style.stylesheet&&(o.style.stylesheet.schema=r);const a=o.style.stylesheet&&o.style.stylesheet.schema;return o.config=t,o.style.updateConfig(t,a),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],r=this.getImportIndex(e);-1!==r&&(t.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(e=>e.id===t);return-1===r&&this.fire(new e.y(new Error("Import '".concat(t,"' does not exist in the map's style and cannot be updated.")))),r}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const r=this._mergedOtherSourceCaches[t];r&&e.push(r.getSource())}return e}getSource(e,t){const r=this.getSourceCache(e,t);return r&&r.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,r){const n=e.B(t,r);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(t){const r=e.B(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const r=e[t];"reload"===r?this.reloadSource(t):"clear"===r&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const r of t){const t=this.getLayer(r);t&&t.updateTransitions(e)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(e){this.stylesheet.glyphs=e,this.glyphManager.setURL(e)}getImages(t,r,n){this.imageManager.getImages(r.images,r.scope,n),this._updateTilesForChangedImages();const i=t=>{if(t){const n=r.images.map(t=>e.I.toString(t));t.setDependencies(r.tileID.key,r.type,n)}},o=e.B(r.source,r.scope);i(this._mergedOtherSourceCaches[o]),i(this._mergedSymbolSourceCaches[o]),r.images.some(e=>e.iconsetId)&&this.fire(new e.z("data",{dataType:"style"}))}rasterizeImages(e,t,r){this.imageManager.rasterizeImages(t,r)}getGlyphs(e,t,r){this.glyphManager.getGlyphs(t.stacks,r)}getResource(t,r,n){return e.dz(r,n)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return 0===r.length?(this.fire(new e.y(new Error("There is no source with ID '".concat(t,"'")))),!1):r.every(e=>e.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(e,t){if(!this._clipLayerPresent&&"fill-extrusion"!==e.type&&"building"!==e.type)return!1;const r="fill-extrusion"===e.type&&("building"===e.sourceLayer||"procedural_buildings"===e.sourceLayer),n="building"===e.type;if(e.is3D(!!this.terrain)){if(r||n||t&&"batched-model"===t.type)return!0;if("model"===e.type)return!0}else if("symbol"===e.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(e=>{e.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ln.getSourceType=function(e){return yt[e]},Ln.setSourceType=function(e,t){yt[e]=t},Ln.registerForPluginStateChange=e.dA;class Dn extends e.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},e.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(e){e===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=e,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(e){this._activeFloorsVisible=e,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(e){for(const[t,r]of Object.entries(e.buildings))if(this._buildings[t])for(const e of r.floorIds)this._buildings[t].floors[e]||(this._buildings[t].floors[e]=r.floors[e]);else this._buildings[t]=r;for(const t of e.activeFloors)this._activeFloors.add(t);this._updateIndoorSelector()}getIndoorTileOptions(e,t){const r=this._style.getIndoorSourceLayers(e,t);return r&&this._indoorState?{sourceLayers:r,indoorState:this._indoorState}:null}_updateUI(t,r,n){const i=function(t,r,n,i){let o=null,a=Number.MAX_SAFE_INTEGER;if(i<16)return null;for(const[s,l]of Object.entries(t)){const t=l.center;if(t){const i=r.distanceTo(e.aT.convert(t));i<a&&n.contains(t)&&(a=i,o=s)}}return o}(this._buildings,r,n,t);i!==this._closestBuildingId&&(this._closestBuildingId=i,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,r=this._closestBuildingId,n=r&&t?t[r]:void 0;if(!n)return void this.fire(new e.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let i=null;for(const e of n.floorIds)if(this._activeFloors&&this._activeFloors.has(e)){i=e;break}const o=Array.from(n.floorIds).map(e=>({id:e,name:n.floors[e].name,zIndex:n.floors[e].zIndex})).sort((e,t)=>t.zIndex-e.zIndex);this.fire(new e.z("selector-update",{selectedFloorId:i,activeFloorsVisible:this._activeFloorsVisible,floors:o}))}_updateActiveFloors(){const e=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:e,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Un="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",Rn="\n#ifdef DUAL_SOURCE_BLENDING\nlayout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;\n#else\nlayout(location=0) out vec4 glFragColor;\n#endif\n#ifdef USE_MRT1\nlayout(location=1) out vec4 out_Target1;\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",zn="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer\n#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib\n#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib\n#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib\n#define DECLARE_MATERIAL_TABLE_INFO\n#endif",Nn="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",jn="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef CLIP_ZERO_TO_ONE\ncoord.z=-1.0+2.0*coord.z; \n#endif\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef CLIP_ZERO_TO_ONE\ncoord.z=-1.0+2.0*coord.z; \n#endif\nint NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;\n#ifdef CLIP_ZERO_TO_ONE\ncoord.z=-1.0+2.0*coord.z; \n#endif\nhighp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif",Qn="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",Vn="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Hn="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Gn="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Kn="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif",Wn="#ifdef RENDER_SHADOWS\nprecision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {\n#ifdef CLIP_ZERO_TO_ONE\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);\n#else\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);\n#endif\nreturn texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;\n#ifdef SHADOWS_SINGLE_CASCADE\nvec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);\n#else\nlight_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const qn=/#include\s+"([^"]+)"/g,Zn=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Xn=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Yn=new Set(["ifdef","ifndef","elif","if","defined"]),Jn=new Set;ai(Un,Jn),ai(zn,Jn),ai(Rn,Jn);const $n={"_prelude_fog.vertex.glsl":Qn,"_prelude_terrain.vertex.glsl":jn,"_prelude_shadow.vertex.glsl":Kn,"_prelude_material_table.vertex.glsl":"#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer\n#define MATERIAL_TABLE_DEBUG 0\nuniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;\n#if MATERIAL_TABLE_DEBUG\nvec4 colorDebug;\n#endif\n};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { \nif (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; \n}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { \niRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;\n#if MATERIAL_TABLE_DEBUG\nconst vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;\n#endif\nuint offset=0u;\n#if MATERIAL_TABLE_DEBUG\nbool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}\n#endif\noffset++;\n#if MATERIAL_TABLE_DEBUG\nuint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}\n#endif\noffset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);\n#if MATERIAL_TABLE_DEBUG\nif(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}\n#endif\nuint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);\n#if MATERIAL_TABLE_DEBUG\nif(keepFinding)\n{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}\n#endif\noffset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;\n#if MATERIAL_TABLE_DEBUG\nif(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}\n#endif\ninfo.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)\n{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}\n#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)\n#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)\n#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)\n#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));\n#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;\n#endif","_prelude_fog.fragment.glsl":Vn,"_prelude_shadow.fragment.glsl":Wn,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif","_prelude_raster_array.glsl":Hn,"_prelude_raster_particle.glsl":Gn},ei={};si("",jn),si(Vn,Qn),si(Wn,Kn),si(Hn,""),si(Gn,"");const ti=si(Rn,zn),ri=Un,ni=["\n#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)\n#extension GL_EXT_blend_func_extended : require\n#endif","precision mediump float;",ri,ti.fragmentSource].join("\n"),ii=["precision highp float;",ri,ti.vertexSource].join("\n");var oi={background:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),building:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nconst float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nin lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;\n#endif\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\n#ifdef FLOOD_LIGHT\nin highp float v_flood_radius;in float v_has_flood_light;\n#endif\nuniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}\n#ifdef BUILDING_FAUX_FACADE\nfloat hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;\n#if 0\nif (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;\n#else\nif (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;\n#endif\nreturn out_color;}\n#endif\nvec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;\n#ifdef BUILDING_FAUX_FACADE\nif (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}\n#endif\nvec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;\n#ifdef RENDER_SHADOWS\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\n#else\nshadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);\n#endif\ncolor.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);\n#ifdef FLOOD_LIGHT\nfloat flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);\n#endif\ncolor.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));\n#endif\ncolor*=u_opacity;\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_pos.z);\n#endif\n#ifdef FEATURE_CUTOUT\ncolor=apply_feature_cutout(color,gl_FragCoord);\n#endif\nglFragColor=color; \n#ifdef DEBUG_SHOW_NORMALS\ncolor.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nout lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#ifdef FLOOD_LIGHT\nout highp float v_flood_radius;out float v_has_flood_light;\n#endif\nconst float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#ifdef BUILDING_FAUX_FACADE\nmat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}\n#endif\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive\nvoid main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive\n#ifdef FLOOD_LIGHT\nv_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);\n#endif\nvec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;\n#ifdef BUILDING_FAUX_FACADE\nv_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}\n#endif\nv_pos=a_pos_3f;\n#ifdef RENDER_CUTOFF\nvec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=v_pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(v_pos);\n#endif\ngl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}'),buildingBloom:si("in vec4 v_color_emissive;\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\nfloat saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;\n#ifdef HAS_ATTRIBUTE_a_bloom_attenuation\nfloat distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);\n#endif\n#ifdef RENDER_CUTOFF\nopacity*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}","in vec3 a_pos_3f;\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\nout vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\n#ifdef HAS_ATTRIBUTE_a_part_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);\n#else\nv_color_emissive=vec4(1.0);\n#endif\ngl_Position=u_matrix*vec4(a_pos_3f,1.0);\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}"),buildingDepth:si("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:si("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:si('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:si("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:si("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;\n#endif\nout float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);\n#ifdef PROJECTION_GLOBE_VIEW\n#ifndef PROJECTED_POS_ON_VIEWPORT\nvec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);\n#endif\n#endif\nvec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:si("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:si("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:si("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:si("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#else\n#ifdef FEATURE_CUTOUT\napply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);\n#endif\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)\n{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nvec3 color=structure_color.xyz;\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,transformed_normal);\n#endif\ncolor=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nv_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef FLIP_Y\nv_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nuniform float u_emissive_strength;\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef APPLY_LUT_ON_GPU\nout_color=applyLUT(u_lutTexture,out_color);\n#endif\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FLIP_Y\nv_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef APPLY_LUT_ON_GPU\nout_color=applyLUT(u_lutTexture,out_color);\n#endif\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\n#ifdef FEATURE_CUTOUT\ncolor=apply_feature_cutout(color,gl_FragCoord);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_material_table.vertex.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {DECLARE_MATERIAL_TABLE_INFO\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);\n#ifdef CLIP_ZERO_TO_ONE\ncutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);\n#else\ncutoff=cutoff_opacity(u_cutoff_params,ground.z);\n#endif\nif (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:si("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_material_table.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef APPLY_LUT_ON_GPU\nout_color=applyLUT(u_lutTexture,out_color);\n#endif\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_material_table.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {DECLARE_MATERIAL_TABLE_INFO\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:si('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:si("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\n#ifdef USE_MRT1\nout_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:si("precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float side_z_offset\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\n#pragma mapbox: define lowp float emissive_strength\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float side_z_offset\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\n#pragma mapbox: initialize lowp float emissive_strength\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#ifdef MULTIPLY_LINE_GRADIENT_COLOR\nout_color*=color;\n#endif\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef DUAL_SOURCE_BLENDING\nglFragColorSrc1=vec4(vec3(0.0),emissive_strength);\n#else\n#ifdef USE_MRT1\nout_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float side_z_offset\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float side_z_offset\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\n#pragma mapbox: initialize lowp float emissive_strength\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nbool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef LINE_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\n#ifdef LINE_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef DUAL_SOURCE_BLENDING\nglFragColorSrc1=vec4(vec3(0.0),emissive_strength);\n#else\n#ifdef USE_MRT1\nout_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize lowp float emissive_strength\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:si("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:si("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:si('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:si('#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nin highp float v_z_offset;\n#endif\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nout_color=applyLUT(u_lutTexture,out_color);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef TERRAIN\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#else\nout_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#define APPEARANCE_ICON 1.0\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef ELEVATED_ROADS\nin vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nout highp float v_z_offset;\n#endif\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;\n#else\nz+=u_pitch_with_map ? z_offset : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\n#ifdef Z_TEST_OCCLUSION\nout_fade_opacity*=occlusion_opacity;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\n#ifdef ELEVATED_ROADS\nvec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\npos=vec3(projected_pos.xy/projected_pos.w+offset,z);\n#endif\n#endif\ngl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#else\n#ifdef RENDER_SHADOWS\nv_z_offset=e;\n#endif\n#endif\n}'),terrainRaster:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nuniform sampler2D u_image1;uniform float u_emissive_texture_available;\n#endif\nin vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nfloat emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nfloat emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:si("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:si('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Nn),skyboxGradient:si('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Nn),skyboxCapture:si("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nuniform sampler2D u_image1;uniform float u_emissive_texture_available;\n#endif\nuniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nfloat emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nfloat emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:si('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:si('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef FLIP_Y\ncoord.y=1.0-coord.y;\n#endif\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;\n#ifdef FLIP_Y\nT=-T;B=-B;\n#endif\nhighp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));\n#ifdef FLIP_Y\nn=normalize(cross(fdx,fdy));\n#else\nn=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\n#ifdef FEATURE_CUTOUT\nfinalColor=apply_feature_cutout(finalColor,gl_FragCoord);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#ifdef CLIP_ZERO_TO_ONE\nv_depth=-1.0+2.0*v_depth; \n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:si("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:si("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:si("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:si("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:si("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:si("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function ai(e,t){const r=e.split("\n");for(let n of r){if(n=n.trimStart(),"#"!==n[0])continue;if(!n.includes("if"))continue;if(n.startsWith("#endif"))continue;const e=n.match(Xn);if(e)for(const r of e)Yn.has(r)||t.add(r)}}function si(e,t){const r=new Set,n=[],i=[];e=e.replace(qn,(e,t)=>(i.push(t),"")),t=t.replace(qn,(e,t)=>(n.push(t),""));let o=new Set(Jn);ai(e,o),ai(t,o);for(const a of[...n,...i])ei[a]||(ei[a]=new Set,ai($n[a],ei[a])),o=new Set([...o,...ei[a]]);return{fragmentSource:e=e.replace(Zn,(e,t,n,i,o)=>(r.add(o),"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(o,"\nin ").concat(n," ").concat(i," ").concat(o,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(o,";\n#endif\n"):"initialize"===t?"\n#ifdef HAS_UNIFORM_u_".concat(o,"\n    ").concat(n," ").concat(i," ").concat(o," = u_").concat(o,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(o,"\n    in ").concat(n," ").concat(i," ").concat(o,";\n#endif\n"):"initialize-attribute"===t?"":void 0)),vertexSource:t=t.replace(Zn,(e,t,n,i,o)=>{const a="MATERIAL_ATTRIBUTE_OFFSET_".concat(o),s="float"===i?"vec2":i,l="GET_ATTRIBUTE_".concat(s,"(a_").concat(o,", materialInfo, ").concat(a,")"),c=o.match(/color/)?"color":s;return"define-attribute-vertex-shader-only"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(o,"\nin ").concat(n," ").concat(i," a_").concat(o,";\n#endif\n"):r.has(o)?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(o,"\nuniform lowp float u_").concat(o,"_t;\n    #if !defined(").concat(a,")\n        in ").concat(n," ").concat(s," a_").concat(o,";\n    #endif\nout ").concat(n," ").concat(i," ").concat(o,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(o,";\n#endif\n"):"initialize"===t?"vec4"===c?"\n#ifndef HAS_UNIFORM_u_".concat(o,"\n    ").concat(o," = a_").concat(o,";\n#else\n    ").concat(n," ").concat(i," ").concat(o," = u_").concat(o,";\n#endif\n"):"\n#if !defined(HAS_UNIFORM_u_".concat(o,")\n    #ifdef ").concat(a,"\n        ").concat(o," = unpack_mix_").concat(c,"(").concat(l,", u_").concat(o,"_t);\n    #else\n        ").concat(o," = unpack_mix_").concat(c,"(a_").concat(o,", u_").concat(o,"_t);\n    #endif\n#else\n    ").concat(n," ").concat(i," ").concat(o," = u_").concat(o,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(o,"\n    in ").concat(n," ").concat(i," a_").concat(o,";\n    out ").concat(n," ").concat(i," ").concat(o,";\n#endif\n"):"initialize-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(o,"\n    ").concat(o," = a_").concat(o,";\n#endif\n"):void 0:"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(o,"\nuniform lowp float u_").concat(o,"_t;\n    #if !defined(").concat(a,")\n        in ").concat(n," ").concat(s," a_").concat(o,";\n    #endif\n#else\nuniform ").concat(n," ").concat(i," u_").concat(o,";\n#endif\n"):"define-instanced"===t?"mat4"===c?"\n#ifdef INSTANCED_ARRAYS\nin vec4 a_".concat(o,"0;\nin vec4 a_").concat(o,"1;\nin vec4 a_").concat(o,"2;\nin vec4 a_").concat(o,"3;\n#else\nuniform ").concat(n," ").concat(i," u_").concat(o,";\n#endif\n"):"\n#ifdef INSTANCED_ARRAYS\nin ".concat(n," ").concat(s," a_").concat(o,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(o,";\n#endif\n"):"initialize-attribute-custom"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(o,"\n    ").concat(n," ").concat(i," ").concat(o," = a_").concat(o,";\n#endif\n"):"vec4"===c?"\n#ifndef HAS_UNIFORM_u_".concat(o,"\n    #ifdef ").concat(a,"\n        ").concat(n," ").concat(i," ").concat(o," = ").concat(l,";\n    #else\n        ").concat(n," ").concat(i," ").concat(o," = a_").concat(o,";\n    #endif\n#else\n    ").concat(n," ").concat(i," ").concat(o," = u_").concat(o,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(o,"\n    #ifdef ").concat(a,"\n        ").concat(n," ").concat(i," ").concat(o," = unpack_mix_").concat(c,"(").concat(l,", u_").concat(o,"_t);\n    #else\n        ").concat(n," ").concat(i," ").concat(o," = unpack_mix_").concat(c,"(a_").concat(o,", u_").concat(o,"_t);\n    #endif\n#else\n    ").concat(n," ").concat(i," ").concat(o," = u_").concat(o,";\n#endif\n")}),usedDefines:o,vertexIncludes:n,fragmentIncludes:i}}class li{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,r,n,i,o,a,s){this.context=e;let l=this.boundPaintVertexBuffers.length!==n.length;for(let u=0;!l&&u<n.length;u++)this.boundPaintVertexBuffers[u]!==n[u]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==a.length;for(let u=0;!c&&u<a.length;u++)this.boundDynamicVertexBuffers[u]!==a[u]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==r||l||c||this.boundIndexBuffer!==i||this.boundVertexOffset!==o)this.freshBind(t,r,n,i,o,a,s);else{e.bindVertexArrayOES.set(this.vao);for(const r of a)r&&(r.bind(),s&&r.instanceCount&&r.setVertexAttribDivisor(e.gl,t,s));i&&i.dynamicDraw&&i.bind()}}freshBind(e,t,r,n,i,o,a){const s=this.context,l=s.gl;this.vao&&this.destroy(),this.vao=s.gl.createVertexArray(),s.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=i,this.boundDynamicVertexBuffers=o,t.enableAttributes(l,e),t.bind(),t.setVertexAttribPointers(l,e,i);for(const c of r)c.enableAttributes(l,e),c.bind(),c.setVertexAttribPointers(l,e,i);for(const c of o)c&&(c.enableAttributes(l,e),c.bind(),c.setVertexAttribPointers(l,e,i),a&&c.instanceCount&&c.setVertexAttribDivisor(l,e,a));n&&n.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ci(t,r){const n=Math.pow(2,r.canonical.z),i=r.canonical.y;return[new e.ae(0,i/n).toLngLat().lat,new e.ae(0,(i+1)/n).toLngLat().lat]}function ui(t,r,n,i,o,a,s){const l=t.context,c=l.gl,u=n.hillshadeFBO;if(!u)return;t.prepareDrawTile();const d=t.isTileAffectedByFog(r),h=[];t.terrain&&t.terrain.renderingToTexture&&"mrt-fallback"===t.emissiveMode&&h.push("USE_MRT1");const A=t.getOrCreateProgram("hillshade",{overrideFog:d,defines:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment0.get());const f=((t,r,n,i)=>{const o=n.paint.get("hillshade-shadow-color"),a="none"===n.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),s=n.paint.get("hillshade-highlight-color"),l="none"===n.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),c=n.paint.get("hillshade-accent-color"),u="none"===n.paint.get("hillshade-accent-color-use-theme").constantOr("default"),d=n.paint.get("hillshade-emissive-strength");let h=e.an(n.paint.get("hillshade-illumination-direction"));if("viewport"===n.paint.get("hillshade-illumination-anchor"))h-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const r=t.style.directionalLight.properties.get("direction"),n=e.d4(r.x,r.y,r.z);h=e.an(n[1])}const A=!t.options.moving;return{u_matrix:i||t.transform.calculateProjMatrix(r.tileID.toUnwrapped(),A),u_image:0,u_latrange:ci(0,r.tileID),u_light:[n.paint.get("hillshade-exaggeration"),h],u_shadow:o.toPremultipliedRenderColor(a?null:n.lut),u_highlight:s.toPremultipliedRenderColor(l?null:n.lut),u_emissive_strength:d,u_accent:c.toPremultipliedRenderColor(u?null:n.lut)}})(t,n,i,t.terrain?r.projMatrix:null);t.uploadCommonUniforms(l,A,r.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:m,tileBoundsSegments:g}=t.getTileBoundsBuffers(n);A.draw(t,c.TRIANGLES,o,a,s,nn.disabled,f,i.id,p,m,g)}function di(t,r,n){if(!r.needsDEMTextureUpload)return;const i=t.context,o=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||t.getTileTexture(n.stride);const a=n.getPixels();r.demTexture?r.demTexture.update(a,{premultiply:!1}):r.demTexture=new e.T(i,a,o.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function hi(t,r,n){const i=t.context,o=i.gl;if(!r.dem)return;const a=r.dem;if(i.activeTexture.set(o.TEXTURE1),di(t,r,a),!r.demTexture)return;r.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE);const s=a.dim;i.activeTexture.set(o.TEXTURE0);let l=r.hillshadeFBO;if(!l){const t=new e.T(i,{width:s,height:s,data:null},o.RGBA8);t.bind(o.LINEAR,o.CLAMP_TO_EDGE),l=r.hillshadeFBO=i.createFramebuffer(s,s,1,"renderbuffer"),l.colorAttachment0.set(t.texture)}i.bindFramebuffer.set(l.framebuffer),i.viewport.set([0,0,s,s]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:d}=t.getMercatorTileBoundsBuffers(),h=[];t.linearFloatFilteringSupported()&&h.push("TERRAIN_DEM_FLOAT_FORMAT"),t.terrain&&t.terrain.renderingToTexture&&"mrt-fallback"===t.emissiveMode&&h.push("USE_MRT1"),t.getOrCreateProgram("hillshadePrepare",{defines:h}).draw(t,o.TRIANGLES,Jr.disabled,en.disabled,Yr.unblended,nn.disabled,((t,r)=>{const n=r.stride,i=e.bC();return e.ce(i,0,e.al,-e.al,0,0,1),e.br(i,i,[0,-e.al,0]),{u_matrix:i,u_image:1,u_dimension:[n,n],u_zoom:t.overscaledZ}})(r.tileID,a),n.id,c,u,d),r.needsHillshadePrepare=!1}class Ai{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class fi extends Ai{getDefault(){return e.ao.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class pi extends Ai{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class mi extends Ai{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class gi extends Ai{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class yi extends Ai{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class _i extends Ai{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class vi extends Ai{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class xi extends Ai{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class wi extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class bi extends Ai{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Bi extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ci extends Ai{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Ei extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class Si extends Ai{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ti extends Ai{getDefault(){return e.ao.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ii extends Ai{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class Fi extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class ki extends Ai{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Pi extends Ai{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let Mi=class extends Ai{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class Oi extends Ai{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Li extends Ai{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Di extends Ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Ui extends Ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ri extends Ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class zi extends Ai{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ni extends Ai{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class ji extends Ai{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class Qi extends Ai{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Vi extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Hi extends Ai{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Gi extends Ai{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Ki extends Gi{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(e,t),this.attachmentPoint=e.gl.COLOR_ATTACHMENT0+r}setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachmentPoint,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Wi extends Gi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class qi extends Gi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Zi extends Wi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Xi=(e,t,r,n)=>({u_matrix:e,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:r,u_emissive_texture_available:n}),Yi=(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:r,u_zoom_transition:i,u_merc_center:o,u_image0:0,u_image1:1,u_frustum_tl:a,u_frustum_tr:s,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:d,u_viewport:h,u_grid_matrix:m?Float32Array.from(m):new Float32Array(9),u_skirt_height:A,u_far_z_cutoff:f,u_emissive_texture_available:p});function Ji(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const $i=new class{constructor(){this.operations={}}newMorphing(e,t,r,n,i){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==r.tileID.key&&(t.queued=r)}else this.operations[e]={startTime:n,phase:0,duration:i,from:t,to:r,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const r=this.operations[t];for(r.phase=(e-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},eo={0:null,1:"TERRAIN_VERTEX_MORPHING"};function to(e,t,r){if(0===t)return 0;const n=t<1&&514===r?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*n}function ro(e,t){const r=1<<e.z;return!t&&(0===e.x||e.x===r-1)||0===e.y||e.y===r-1}function no(e,t){if(!e.style||!e.style.enable3dLights())return;const r=e.context,n=r.gl;r.activeTexture.set(n.TEXTURE1),t?t.bind(n.LINEAR,n.CLAMP_TO_EDGE):e.emptyTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}const io=e=>({u_matrix:e});function oo(t,r,n,i,o){if(o>0){const a=e.o.now(),s=(a-t.timeAdded)/o,l=r?(a-r.timeAdded)/o:-1,c=n.getSource(),u=i.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),d=!r||Math.abs(r.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),h=d&&t.refreshedUponExpiration?1:e.aA(d?s:1-l,0,1);return r?{opacity:1,mix:1-h,isFading:s<1}:{opacity:h,mix:0,isFading:s<1}}return{opacity:1,mix:0,isFading:!1}}class ao extends zt{constructor(e){const t=_t("mock-dem",{type:"raster-dem",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("mock-dem",t,!1),t.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class so extends zt{constructor(e){const t=_t("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,r){if(e.freezeTileCoverage)return;this.transform=e;const n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((t,r)=>{if(t[r.key]="",!this._tiles[r.key]){const t=new Lt(r,this._source.tileSize*r.overscaleFactor(),e.tileZoom,void 0,void 0,this._source.worldview);t.state="loaded",this._tiles[r.key]=t}return t},{});for(const i in this._tiles)i in n||(this.freeFBO(i),this._tiles[i].unloadVectorData(),delete this._tiles[i])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const r=Object.values(t);this.renderCachePool.push(...r),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class lo extends e.aQ{constructor(e,t,r){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=r}}class co extends e.bV{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,i,o]=function(){const t=new e.bd,r=new e.b0,n=131;t.reserve(17161),r.reserve(33800);const i=e.al/128,o=e.al+i/2,a=o+i;for(let l=-i;l<a;l+=i)for(let r=-i;r<a;r+=i){const n=r<0||r>o||l<0||l>o?24575:0,i=e.aA(Math.round(r),0,e.al),a=e.aA(Math.round(l),0,e.al);t.emplaceBack(i+n,a)}const s=(e,t)=>{const i=t*n+e;r.emplaceBack(i+1,i,i+n),r.emplaceBack(i+n,i+n+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)s(t,e);return[0,129].forEach(e=>{for(let t=0;t<130;t++)s(t,e),s(e,t)}),[t,r,32768]}(),a=t.context;this.gridBuffer=a.createVertexBuffer(n,e.bf.members),this.gridIndexBuffer=a.createIndexBuffer(i),this.gridSegments=e.bg.simpleSegment(0,0,n.length,i.length),this.gridNoSkirtSegments=e.bg.simpleSegment(0,0,n.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new so(r.map),this.orthoMatrix=e.bC(),e.ce(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.al,0,e.al,0,1);const s=a.gl;this._overlapStencilMode=new en({func:s.GEQUAL,mask:255},0,255,s.KEEP,s.KEEP,s.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new ao(r.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,n){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const i=t.terrain.properties,o=0===t.terrain.drapeRenderMode,a=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.o.now();const s=t.terrain&&t.terrain.scope,l=i.get("source"),c=o?this._mockSourceCache:t.getSourceCache(l,s);if(!c)return void e.w("Couldn't find terrain source \"".concat(l,'".'));if(this.sourceCache=c,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=a?this.calculateExaggeration(r):i.get("exaggeration"),!r.projection.requiresDraping&&a&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&e.w("Raster DEM source '".concat(this.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));const t=this.getScaledDemTileSize();this.sourceCache.update(r,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),r.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const r=this._previousCameraAltitude,n=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=n;const i=null!=r?n-r:Number.MAX_VALUE;if(Math.abs(i)<2)return this._exaggeration;const o=t.zoom,a=this._style.terrain;if(!this._previousUpdateTimestamp)return a.getExaggeration(o);let s=o-this._previousZoom;const l=this._previousUpdateTimestamp;let c=o;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(o-c)>.5&&(s=.5*(o-c+s)),s*i<0&&(c+=s)),this._evaluationZoom=c;const u=a.getExaggeration(c),d=u===a.getExaggeration(Math.max(0,c-.1));if(d&&Math.abs(u-this._exaggeration)<.01)return u;let h=Math.min(.1,.00375*(this._updateTimestamp-l));return(d||u<.1||Math.abs(s)<1e-4)&&(h=Math.min(.2,4*h)),e.ak(this._exaggeration,u,h)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){"source"===e.dataType&&e.coord?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(e.ae.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const i=this.proxyCoords=r.getIds().map(e=>{const t=r.getTileByID(e).tileID;return t.projMatrix=n.calculateProjMatrix(t.toUnwrapped()),t});!function(t,r){const n=r.transform.pointCoordinate(r.transform.getCameraPoint()),i=new e.P(n.x,n.y);t.sort((t,r)=>{if(r.overscaledZ-t.overscaledZ)return r.overscaledZ-t.overscaledZ;const n=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),o=new e.P(r.canonical.x+(1<<r.canonical.z)*r.wrap,r.canonical.y),a=i.mult(1<<t.canonical.z);return a.x-=.5,a.y-=.5,a.distSqr(n)-a.distSqr(o)})}(i,this.painter);const o=this.proxyToSource||{};this.proxyToSource={},i.forEach(e=>{this.proxyToSource[e.key]={}}),this.terrainTileForTile={};const a=this._style._mergedSourceCaches;for(const e in a){const r=a[e];if(!r.used)continue;if(r!==this.sourceCache&&this.resetTileLookupCache(r.id),this._setupProxiedCoordsForOrtho(r,t[e],o),r.usedForTerrain)continue;const n=t[e];r.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[r.id]=i.map(e=>new lo(e,e.key,this.orthoMatrix)),this._assignTerrainTiles(i),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;const s={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const r=t.tileID.key;r in s||(this._visibleDemTiles.push(t),s[r]=r)}}_assignTerrainTiles(e){this._initializing||e.forEach(e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)})}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const r in this.terrainTileForTile){const n=this.terrainTileForTile[r],i=n.dem;!i||n.demTexture&&!n.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),di(this.painter,n,i))}}_prepareDemTileUniforms(e,t,r,n){if(!t||null==t.demTexture)return!1;const i=e.tileID.canonical,o=Math.pow(2,t.tileID.canonical.z-i.z),a=n||"";return r["u_dem_tl".concat(a)]=[i.x*o%1,i.y*o%1],r["u_dem_scale".concat(a)]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let e=0;const t=this._visibleDemTiles.reduce((t,r)=>{if(!r.dem)return t;const n=r.dem.tree.minimums[0];return n>0&&e++,t+n},0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const n=this._getLoadedAreaMinimum(),i=new e.dL({width:1,height:1},new Float32Array([n]));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(i,{premultiply:!1}):o=this._emptyDEMTexture=new e.T(t,i,r.R32F,{premultiply:!1}),o}setupElevationDraw(t,r,n){const i=this.painter.context,o=i.gl,a={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};a.u_exaggeration=this.exaggeration();let s=null,l=null,c=1;if(n&&n.morphing&&this._useVertexMorphing){const e=n.morphing.srcDemTile,r=n.morphing.dstDemTile;c=n.morphing.phase,e&&r&&(this._prepareDemTileUniforms(t,e,a,"_prev")&&(l=e),this._prepareDemTileUniforms(t,r,a)&&(s=r))}const u=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST;let d=null;var h;if(this.enabled?l&&s?(d=s.demTexture,i.activeTexture.set(o.TEXTURE4),l.demTexture.bind(u(l),o.CLAMP_TO_EDGE),a.u_dem_lerp=c):(s=this.terrainTileForTile[t.tileID.key],d=this._prepareDemTileUniforms(t,s,a)?s.demTexture:this.emptyDEMTexture):d=this.emptyDEMTexture,i.activeTexture.set(o.TEXTURE2),d&&(a.u_dem_size=1===(h=d).size[0]?1:h.size[0]-2,d.bind(u(s),o.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(n&&n.useDepthForOcclusion,r,a),n&&n.useMeterToDem&&s){const t=(1<<s.tileID.canonical.z)*e.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;a.u_meter_to_dem=t}if(n&&n.labelPlaneMatrixInv&&(a.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),r.setTerrainUniformValues(i,a),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,n&&n.useDenormalizedUpVectorScale);r.setGlobeUniformValues(i,e)}}globeUniformValues(t,r,n){const i=t.projection;return{u_tile_tl_up:i.upVector(r,0,0),u_tile_tr_up:i.upVector(r,e.al,0),u_tile_br_up:i.upVector(r,e.al,e.al),u_tile_bl_up:i.upVector(r,0,e.al),u_tile_up_scale:n?e.dM(1):i.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,n=this.painter.context;0!==t.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,r,n,i,o){if("globe"===t.transform.projection.name)!function(t,r,n,i,o){const a=t.context,s=a.gl;let l,c;const u=t.transform,d=e.dE(t,a,u),h=(e,r)=>{if(c===r)return;const n=[eo[r],"PROJECTION_GLOBE_VIEW"];d&&n.push("CUSTOM_ANTIALIASING");const i=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:n,overrideFog:i}),c=r},A=t.colorModeForRenderPass(),f=new Jr(s.LEQUAL,Jr.ReadWrite,t.depthRangeFor3D);$i.update(o);const p=e.dF(u),m=[e.aF(u.center.lng),e.aJ(u.center.lat)],g=t.globeSharedBuffers,y=[u.width*e.o.devicePixelRatio,u.height*e.o.devicePixelRatio],_=Float32Array.from(u.globeMatrix),v={useDenormalizedUpVectorScale:!0};{const u=t.transform,d=to(u.zoom,r.exaggeration(),r.sourceCache._source.tileSize);c=-1;const x=s.TRIANGLES;for(const c of i){const i=n.getTile(c),w=en.disabled,b=r.prevTerrainTileForTile[c.key],B=r.terrainTileForTile[c.key];Ji(b,B)&&$i.newMorphing(c.key,b,B,o,250),no(t,i.emissiveTexture),a.activeTexture.set(s.TEXTURE0),i.texture&&i.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const C=$i.getMorphValuesForProxy(c.key),E=C?1:0;C&&Object.assign(v,{morphing:{srcDemTile:C.from,dstDemTile:C.to,phase:e.dD(C.phase)}});const S=e.dG(c.canonical),T=e.dH(S.getCenter().lat),I=e.dI(c.canonical,S,T,u.worldSize/u._pixelsPerMercatorPixel),F=e.bk(e.dJ(c.canonical)),k="mrt-fallback"===t.emissiveMode?1:0,P=Yi(u.expandedFarZProjMatrix,_,p,F,e.aj(u.zoom),m,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,d,u._farZ,k,I);if(h(c,E),l&&(r.setupElevationDraw(i,l,v),t.uploadCommonUniforms(a,l,c.toUnwrapped()),g)){const[e,r,n]=g.getGridBuffers(T,0!==d);l.draw(t,x,f,w,A,nn.backCCW,P,"globe_raster",e,r,n)}}}if(g&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const o=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];d&&o.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:o});for(const c of i){const{x:i,y:o,z:d}=c.canonical,h=0===o,p=o===(1<<d)-1,[_,x,w,b]=g.getPoleBuffers(d,!1);if(b&&(h||p)){const o=n.getTile(c);no(t,o.emissiveTexture),a.activeTexture.set(s.TEXTURE0),o.texture&&o.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);let g=e.dK(d,i,u);const B=e.bk(e.dJ(c.canonical)),C="mrt-fallback"===t.emissiveMode?1:0,E=(e,r)=>e.draw(t,s.TRIANGLES,f,en.disabled,A,nn.disabled,Yi(u.expandedFarZProjMatrix,g,g,B,0,m,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,y,0,u._farZ,C),"globe_pole_raster",r,w,b);r.setupElevationDraw(o,l,v),t.uploadCommonUniforms(a,l,c.toUnwrapped()),h&&t.renderDefaultNorthPole&&E(l,_),p&&t.renderDefaultSouthPole&&(g=e.cS(e.bC(),g,[1,-1,1]),E(l,x))}}}}(t,r,n,i,o);else{const a=t.context,s=a.gl;let l,c;const u=t.shadowRenderer,d=fn(t,t.longestCutoffRange),h=e=>{if(c===e)return;const r=[];r.push(eo[e]),d.shouldRenderCutoff&&r.push("RENDER_CUTOFF"),u&&(r.push("RENDER_SHADOWS","DEPTH_TEXTURE"),u.useNormalOffset&&r.push("NORMAL_OFFSET")),l=t.getOrCreateProgram("terrainRaster",{defines:r}),c=e},A=t.colorModeForRenderPass(),f=new Jr(s.LEQUAL,Jr.ReadWrite,t.depthRangeFor3D);$i.update(o);const p=t.transform,m=to(p.zoom,r.exaggeration(),r.sourceCache._source.tileSize);let g=[0,0,0];if(u){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(g=xn(t.style,e,r))}{c=-1;const y=s.TRIANGLES,[_,v]=[r.gridIndexBuffer,r.gridSegments];for(const c of i){const i=n.getTile(c),x=en.disabled,w=r.prevTerrainTileForTile[c.key],b=r.terrainTileForTile[c.key];Ji(w,b)&&$i.newMorphing(c.key,w,b,o,250),no(t,i.emissiveTexture),a.activeTexture.set(s.TEXTURE0),i.texture&&i.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE);const B=$i.getMorphValuesForProxy(c.key),C=B?1:0;let E;B&&(E={morphing:{srcDemTile:B.from,dstDemTile:B.to,phase:e.dD(B.phase)}});const S="mrt-fallback"===t.emissiveMode?1:0,T=Xi(c.projMatrix,ro(c.canonical,p.renderWorldCopies)?m/10:m,g,S);if(h(C),!l)continue;r.setupElevationDraw(i,l,E);const I=c.toUnwrapped();u&&u.setupShadows(I,l),t.uploadCommonUniforms(a,l,I,null,d),l.draw(t,y,f,x,A,nn.backCCW,T,"terrain_raster",r.gridBuffer,_,v)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const r=this.painter,n=this.painter.context,i=this.proxySourceCache,o=this.proxiedCoords[i.id],a=this._drapedRenderBatches.shift(),s=r.style.order,l=[];this._updateFBOs("mrt-fallback"===r.emissiveMode);let c=0;for(const u of o){const o=i.getTileByID(u.proxyTileKey),d=i.proxyCachedFBO[u.key]?i.proxyCachedFBO[u.key][t]:void 0,h=void 0!==d?i.renderCache[d]:this.pool[c++],A=void 0!==d;if(o.texture=h.tex,o.emissiveTexture=h.emissiveTex,A&&!h.dirty){l.push(o.tileID);continue}n.bindFramebuffer.set(h.fb.framebuffer);const f=n.gl;let p;f.drawBuffers("mrt-fallback"===r.emissiveMode?[f.COLOR_ATTACHMENT0,f.COLOR_ATTACHMENT1]:[f.COLOR_ATTACHMENT0]),this.renderedToTile=!1,h.dirty&&(n.clear({color:e.ao.transparent,stencil:0}),h.dirty=!1);for(let e=a.start;e<=a.end;++e){const t=r.style._mergedLayers[s[e]];if(t.isHidden(r.transform.zoom))continue;const i=r.style.getLayerSourceCache(t),o=i?this.proxyToSource[u.key][i.id]:[u];if(!o)continue;const a=o;n.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(i?i.id:null)&&(this._setupStencil(h,o,t,i),p=i?i.id:null),r.renderLayer(r,i,t,a)}if(f.drawBuffers([f.COLOR_ATTACHMENT0]),0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=r.style._mergedLayers[s[e]];if(t.isHidden(r.transform.zoom))continue;const i=r.style.getLayerSourceCache(t),o=i?this.proxyToSource[u.key][i.id]:[u];if(!o)continue;const a=o;n.viewport.set([0,0,h.fb.width,h.fb.height]),p!==(i?i.id:null)&&(this._setupStencil(h,o,t,i),p=i?i.id:null),r.renderLayer(r,i,t,a)}this.renderedToTile?(h.dirty=!0,l.push(o.tileID)):A||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,r.width,r.height]),a.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let r=-1,n=t;for(let i=0;i<t;++i)this._style.isLayerDraped(e._mergedLayers[e.order[i]])?r=Math.max(r,i):n=Math.min(n,i);return n>r}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(e=>e.dem).forEach(t=>{e=Math.min(e,t.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(e,t,r){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter(e=>e.dem).map(n=>{const i=n.tileID,o=1<<i.overscaledZ,{x:a,y:s}=i.canonical,l=a/o,c=(a+1)/o,u=s/o,d=(s+1)/o;return{minx:l,miny:u,maxx:c,maxy:d,t:n.dem.tree.raycastRoot(l,u,c,d,e,t,r),tile:n}});n.sort((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE));for(const i of n){if(null==i.t)return null;const n=i.tile.dem.tree.raycast(i.minx,i.miny,i.maxx,i.maxy,e,t,r);if(null!=n)return n}return null}_createFBO(){const t=this.painter.context,r=t.gl,n=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const i=new e.T(t,{width:n[0],height:n[1],data:null},r.RGBA8);i.bind(r.LINEAR,r.CLAMP_TO_EDGE);const o=t.createFramebuffer(n[0],n[1],1,null);let a;return o.colorAttachment0.set(i.texture),this._emissiveTexture&&(a=new e.T(t,{width:n[0],height:n[1],data:null},r.R8),a.bind(r.LINEAR,r.CLAMP_TO_EDGE),o.createColorAttachment(t,1),o.colorAttachment1.set(a.texture)),o.depthAttachment=new Zi(t,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:o,tex:i,emissiveTex:a,dirty:!1}}_updateFBOs(e){if(this._emissiveTexture!==e){for(const t of this.pool)this._updateFBO(t,e);for(const t of this.proxySourceCache.renderCache)this._updateFBO(t,e);this._emissiveTexture=e}}_updateFBO(t,r){const n=t.fb,i=this.painter.context,o=i.gl,a=this.drapeBufferSize;if(r){const r=new e.T(i,{width:a[0],height:a[1],data:null},o.R8);r.bind(o.LINEAR,o.CLAMP_TO_EDGE),t.emissiveTex=r,n.createColorAttachment(i,1),n.colorAttachment1.set(r.texture)}else t.emissiveTex=void 0,n.removeColorAttachment(i,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const t=this._style._mergedLayers[e],r=t.isHidden(this.painter.transform.zoom);return"hillshade"===t.type||"custom"===t.type?!r&&t.shouldRedrape():!r&&t.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof ft){t=!0;break}if(!t)return;const r={};for(let n=0;n<this._style.order.length;++n){const t=this._style._mergedLayers[this._style.order[n]],i=this._style.getLayerSourceCache(t);if(!i||r[i.id])continue;if(t.isHidden(this.painter.transform.zoom)||"line"!==t.type)continue;const o=t.widthExpression(),a=t.emissiveStrengthExpression();if(o instanceof e.ad||a instanceof e.ad){r[i.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][i.id];if(t)for(const e of t)this._clearRenderCacheForTile(i.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r]._source instanceof pt){e=!0;break}if(!e)return;const t={};for(let r=0;r<this._style.order.length;++r){const e=this._style._mergedLayers[this._style.order[r]],n=this._style.getLayerSourceCache(e);if(!n||t[n.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const i=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][n.id];if(e)for(const t of e){const e=oo(n.getTile(t),n.findLoadedParent(t,0),n,this.painter.transform,i);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(n.id,t)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,r=t.length;if(0===r)return;const n=[];this._pendingGroundEffectLayers=[];let i,o=0,a=this._style._mergedLayers[t[o]];for(;!this._style.isLayerDraped(a)&&a.isHidden(this.painter.transform.zoom)&&++o<r;)a=this._style._mergedLayers[t[o]];for(;o<r;++o){const e=this._style._mergedLayers[t[o]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===i&&(i=o):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(o),void 0!==i&&(n.push({start:i,end:o-1}),i=void 0)))}if(void 0!==i&&n.push({start:i,end:o-1}),0!==n.length){const t=n[n.length-1];this._pendingGroundEffectLayers.every(e=>e>t.end)||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let r=0;r<e.length;++r){const n=Object.values(e[r]);t.renderCachePool.push(...n)}}return}this._clearRasterLayersFromRenderCache();const r=this.proxyCoords,n=this._tilesDirty;for(let o=r.length-1;o>=0;o--){const i=r[o];if(t.getTileByID(i.key),void 0!==t.proxyCachedFBO[i.key]){const r=e[i.key],o=this.proxyToSource[i.key];let a=0;for(const e in o){const t=o[e],i=r[e];if(!i||i.length!==t.length||t.some((t,r)=>t!==i[r]||n[e]&&n[e].hasOwnProperty(t.key))){a=-1;break}++a}for(const e in t.proxyCachedFBO[i.key])t.renderCache[t.proxyCachedFBO[i.key][e]].dirty=a<0||a!==Object.values(r).length}}const i=[...this._drapedRenderBatches];i.sort((e,t)=>t.end-t.start-(e.end-e.start));for(const o of i)for(const e of r){if(t.proxyCachedFBO[e.key])continue;let r=t.renderCachePool.pop();void 0===r&&t.renderCache.length<50&&(r=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==r&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][o.start]=r,t.renderCache[r].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,r,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const i=this.painter.context,o=i.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let a;if(r.isTileClipped())a=t.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);a=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+a>255&&(i.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=a,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):en.disabled}_renderTileClippingMasks(e,t){const r=this.painter,n=this.painter.context,i=n.gl;r._tileClippingMaskIDs={},n.setColorMode(Yr.disabled),n.setDepthMode(Jr.disabled);const o=r.getOrCreateProgram("clippingMask");for(const a of e){const e=r._tileClippingMaskIDs[a.key]=--t;o.draw(r,i.TRIANGLES,Jr.disabled,new en({func:i.ALWAYS,mask:0},e,255,i.KEEP,i.KEEP,i.REPLACE),Yr.disabled,nn.disabled,io(a.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const n=[t.x,t.y,1,1];e.aC(n,n,r.pixelMatrixInverse),e.cK(n,n,1/n[3]),n[0]/=r.worldSize,n[1]/=r.worldSize;const i=r._camera.position,o=e.cf(1,r.center.lat),a=[i[0],i[1],i[2]/o,0],s=e.da([],n.slice(0,3),a);e.aw(s,s);const l=this.raycast(a,s,this._exaggeration);return null!==l&&l?(e.bH(a,a,s,l),a[3]=a[2],a[2]*=o,a):null}_setupProxiedCoordsForOrtho(t,r,n){if(t.getSource()instanceof e.aU)return this._setupProxiedCoordsForImageSource(t,r,n);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const i=this.proxiedCoords[t.id]=[],o=this.proxyCoords;for(let e=0;e<o.length;e++){const r=o[e],a=this._findTileCoveringTileID(r,t);if(a){const e=this._createProxiedId(r,a,n[r.key]&&n[r.key][t.id]);i.push(e),this.proxyToSource[r.key][t.id]=[e]}}let a=!1;const s=new Set;for(let e=0;e<r.length;e++){const o=t.getTile(r[e]);if(!o||!o.hasData())continue;const l=this._findTileCoveringTileID(o.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==o.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],r=this._createProxiedId(l.tileID,o,n[l.tileID.key]&&n[l.tileID.key][t.id]);e?e.splice(e.length-1,0,r):this.proxyToSource[l.tileID.key][t.id]=[r];const c=this.proxyToSource[l.tileID.key][t.id];s.has(c)||s.add(c),i.push(r),a=!0}}if(this._sourceTilesOverlap[t.id]=a,a&&this._debugParams.sortTilesHiZFirst)for(const e of s)e.sort((e,t)=>t.overscaledZ-e.overscaledZ)}_setupProxiedCoordsForImageSource(t,r,n){if(!t.getSource().loaded())return;const i=this.proxiedCoords[t.id]=[],o=this.proxyCoords,a=t.getSource(),s=a.tileID;if(!s)return;const l=new e.P(s.x,s.y)._div(1<<s.z),c=a.coordinates.map(e.ae.fromLngLat).reduce((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(t,r)=>{const n=t.wrap+t.canonical.x/(1<<t.canonical.z),i=t.canonical.y/(1<<t.canonical.z),o=e.al/(1<<t.canonical.z),a=r.wrap+r.canonical.x/(1<<r.canonical.z),s=r.canonical.y/(1<<r.canonical.z);return n+o<a+c.min.x||n>a+c.max.x||i+o<s+c.min.y||i>s+c.max.y};for(let e=0;e<o.length;e++){const a=o[e];for(let e=0;e<r.length;e++){const o=t.getTile(r[e]);if(!o||!o.hasData())continue;if(u(a,o.tileID))continue;const s=this._createProxiedId(a,o,n[a.key]&&n[a.key][t.id]),l=this.proxyToSource[a.key][t.id];l?l.push(s):this.proxyToSource[a.key][t.id]=[s],i.push(s)}}}_createProxiedId(t,r,n){let i=this.orthoMatrix;if(n){const e=n.find(e=>e.key===r.tileID.key);if(e)return e}if(r.tileID.key!==t.key){const n=t.canonical.z-r.tileID.canonical.z;let o,a,s;i=e.bC();const l=r.tileID.wrap-t.wrap<<t.overscaledZ;n>0?(o=e.al>>n,a=o*((r.tileID.canonical.x<<n)-t.canonical.x+l),s=o*((r.tileID.canonical.y<<n)-t.canonical.y)):(o=e.al<<-n,a=e.al*(r.tileID.canonical.x-(t.canonical.x+l<<-n)),s=e.al*(r.tileID.canonical.y-(t.canonical.y<<-n))),e.ce(i,0,o,0,o,0,1),e.br(i,i,[a,s,0])}return new lo(r.tileID,t.key,i)}_findTileCoveringTileID(t,r){let n=r.getTile(t);if(n&&n.hasData())return n;const i=this._findCoveringTileCache[r.id],o=i[t.key];if(n=o?r.getTileByID(o):null,n&&n.hasData()||null===o)return n;let a=n?n.tileID:t,s=a.overscaledZ;const l=r.getSource().minzoom,c=[];if(!o){const i=r.getSource().maxzoom;if(t.canonical.z>=i){const n=t.canonical.z-i;r.getSource().reparseOverscaled?(s=Math.max(t.canonical.z+2,r.transform.tileZoom),a=new e.aQ(s,t.wrap,i,t.canonical.x>>n,t.canonical.y>>n)):0!==n&&(s=i,a=new e.aQ(s,t.wrap,i,t.canonical.x>>n,t.canonical.y>>n))}a.key!==t.key&&(c.push(a.key),n=r.getTile(a))}const u=e=>{c.forEach(t=>{i[t]=e}),c.length=0};for(s-=1;s>=l&&(!n||!n.hasData());s--){n&&u(n.tileID.key);const e=a.calculateScaledKey(s);if(n=r.getTileByID(e),n&&n.hasData())break;const t=i[e];if(null===t)break;void 0===t?c.push(e):n=r.getTileByID(t)}return u(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let r=this._tilesDirty[e];r||(r=this._tilesDirty[e]={}),r[t.key]=!0}}function uo(t,r,n){const i=function(t,r,n){const i=e.bJ(r,t),o=e.bJ(n,[.2126,.7152,.0722]),a=(e,t,r)=>(1-r)*e+r*t,s=a(1-.3*Math.min(o,1),1,Math.min(i+1,1));return a(.92,1,Math.asin(e.aA(r[2],-1,1))/Math.PI+.5)*s}(t,[0,0,1],r),o=[0,0,0];e.c5(o,n.slice(0,3),i);const a=[0,0,0];e.c5(a,r.slice(0,3),t[2]);const s=[0,0,0];return e.d8(s,o,a),e.db(s)}const ho=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],Ao=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class fo{static cacheKey(e,t,r,n){const i=[t];n&&i.push(n.cacheKey);for(const o of r)e.usedDefines.has(o)&&i.push(o);return i.join("/")}constructor(t,r,n,i,o,a){const s=t.gl;this.program=s.createProgram(),this.configuration=i,this.name=r,this.fixedDefines=[...a];const l="#version 300 es\n".concat((i?i.defines():[]).concat(a.map(e=>"#define ".concat(e))).join("\n")),c=[l,ni];for(const e of n.fragmentIncludes)c.push($n[e]);c.push(n.fragmentSource);const u=c.join("\n"),d=[l,ii];for(const e of n.vertexIncludes)d.push($n[e]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&n.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&d.push("uniform int u_instanceID;"),d.push(n.vertexSource);let h=d.join("\n");this.forceManualRenderingForInstanceIDShaders&&(h=h.replaceAll("gl_InstanceID","u_instanceID"));const A=s.createShader(s.FRAGMENT_SHADER);if(s.isContextLost())return void(this.failedToCreate=!0);s.shaderSource(A,u),s.compileShader(A),s.attachShader(this.program,A);const f=s.createShader(s.VERTEX_SHADER);s.isContextLost()?this.failedToCreate=!0:(s.shaderSource(f,h),s.compileShader(f),s.attachShader(this.program,f),this.attributes={},s.linkProgram(this.program),s.deleteShader(f),s.deleteShader(A),this.fixedUniforms=o(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=i?i.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(t=>({u_instanceID:new e.ch(t)}))(t)),(a.includes("TERRAIN")||r.includes("symbol")||r.includes("circle"))&&(this.terrainUniforms=(t=>({u_dem:new e.ch(t),u_dem_prev:new e.ch(t),u_dem_tl:new e.ck(t),u_dem_scale:new e.cj(t),u_dem_tl_prev:new e.ck(t),u_dem_scale_prev:new e.cj(t),u_dem_size:new e.cj(t),u_dem_lerp:new e.cj(t),u_exaggeration:new e.cj(t),u_depth:new e.ch(t),u_depth_size_inv:new e.ck(t),u_depth_range_unpack:new e.ck(t),u_occluder_half_size:new e.cj(t),u_occlusion_depth_offset:new e.cj(t),u_meter_to_dem:new e.cj(t),u_label_plane_matrix_inv:new e.cl(t)}))(t)),a.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.ci(t),u_tile_tr_up:new e.ci(t),u_tile_br_up:new e.ci(t),u_tile_bl_up:new e.ci(t),u_tile_up_scale:new e.cj(t)}))(t)),a.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.cl(t),u_fog_range:new e.ck(t),u_fog_color:new e.d3(t),u_fog_horizon_blend:new e.cj(t),u_fog_vertical_limit:new e.ck(t),u_fog_temporal_offset:new e.cj(t),u_frustum_tl:new e.ci(t),u_frustum_tr:new e.ci(t),u_frustum_br:new e.ci(t),u_frustum_bl:new e.ci(t),u_globe_pos:new e.ci(t),u_globe_radius:new e.cj(t),u_globe_transition:new e.cj(t),u_is_globe:new e.ch(t),u_viewport:new e.ck(t)}))(t)),a.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.d3(t)}))(t)),a.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.ci(t),u_lighting_directional_dir:new e.ci(t),u_lighting_directional_color:new e.ci(t),u_ground_radiance:new e.ci(t)}))(t)),a.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.cl(t),u_light_matrix_1:new e.cl(t),u_fade_range:new e.ck(t),u_shadow_normal_offset:new e.ci(t),u_shadow_intensity:new e.cj(t),u_shadow_texel_size:new e.cj(t),u_shadow_map_resolution:new e.cj(t),u_shadow_direction:new e.ci(t),u_shadow_bias:new e.ci(t),u_shadowmap_0:new e.ch(t),u_shadowmap_1:new e.ch(t)}))(t)))}getAttributeLocation(e,t){let r=this.attributes[t];return void 0===r&&(r=this.attributes[t]=e.getAttribLocation(this.program,t)),r}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const r=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const r=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const r=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const r=this.shadowUniforms;e.program.set(this.program);for(const n in t)r[n].set(this.program,n,t[n])}_drawDebugWireframe(t,r,n,i,o,a,s,l,c,u){const d=t.options.wireframe;if(!1===d.terrain&&!1===d.layers2D&&!1===d.layers3D)return;const h=t.context;if(!(()=>!(!d.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!d.layers2D||t._terrain&&t._terrain.renderingToTexture||!ho.includes(this.name))||!(!d.layers3D||!Ao.includes(this.name)))())return;const A=h.gl,f=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,o,h);if(!f)return;const p=[...this.fixedDefines,"DEBUG_WIREFRAME"],m=t.getOrCreateProgram(this.name,{config:this.configuration,defines:p});h.program.set(m.program);const g=(e,t,r)=>{if(t[e]&&r[e])for(const n in t[e])r[e][n]&&r[e][n].set(r.program,n,t[e][n].current)};c&&c.setUniforms(m.program,h,m.binderUniforms,s,{zoom:l}),g("fixedUniforms",this,m),g("terrainUniforms",this,m),g("globeUniforms",this,m),g("fogUniforms",this,m),g("lightsUniforms",this,m),g("shadowUniforms",this,m),f.bind(),h.setColorMode(new Yr([A.ONE,A.ONE_MINUS_SRC_ALPHA,A.ZERO,A.ONE],e.ao.transparent,[!0,!0,!0,!1])),h.setDepthMode(new Jr(r.func===A.LESS?A.LEQUAL:r.func,Jr.ReadOnly,r.range)),h.setStencilMode(en.disabled);const y=3*a.primitiveLength*2,_=3*a.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const e=u||1;for(let t=0;t<e;++t)m.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",t),A.drawElements(A.LINES,y,A.UNSIGNED_SHORT,_)}else u&&u>1?A.drawElementsInstanced(A.LINES,y,A.UNSIGNED_SHORT,_,u):A.drawElements(A.LINES,y,A.UNSIGNED_SHORT,_);o.bind(),h.program.set(this.program),h.setDepthMode(r),h.setStencilMode(n),h.setColorMode(i)}checkUniforms(e,t,r){if(this.fixedDefines.includes(t))for(const n of Object.keys(r))if(!r[n].initialized)throw new Error("Program '".concat(this.name,"', from draw '").concat(e,"': uniform ").concat(n," not set but required by ").concat(t," being defined"))}draw(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p){const m=e.context,g=m.gl;if(this.failedToCreate)return;m.program.set(this.program),m.setDepthMode(r),m.setStencilMode(n),m.setColorMode(i),m.setCullFace(o);for(const[b,B]of this.fixedUniformsEntries)B.set(this.program,b,a[b]);A&&A.setUniforms(this.program,m,this.binderUniforms,d,{zoom:h});const y={[g.POINTS]:1,[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[t];this.checkUniforms(s,"RENDER_SHADOWS",this.shadowUniforms);const _=f||[],v=A?A.getPaintVertexBuffers():[],x=t===g.TRIANGLES&&c,w=p&&p>0?1:void 0;for(const b of u.get()){const o=b.vaos||(b.vaos={});if((o[s]||(o[s]=new li)).bind(m,this,l,v,c,b.vertexOffset,_,w),this.forceManualRenderingForInstanceIDShaders){const e=p||1;for(let r=0;r<e;++r)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",r),c?g.drawElements(t,b.primitiveLength*y,g.UNSIGNED_SHORT,b.primitiveOffset*y*2):g.drawArrays(t,b.vertexOffset,b.vertexLength)}else p&&p>1?g.drawElementsInstanced(t,b.primitiveLength*y,g.UNSIGNED_SHORT,b.primitiveOffset*y*2,p):c?g.drawElements(t,b.primitiveLength*y,g.UNSIGNED_SHORT,b.primitiveOffset*y*2):g.drawArrays(t,b.vertexOffset,b.vertexLength);x&&this._drawDebugWireframe(e,r,n,i,c,b,d,h,A,p)}}}function po(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Math.pow(2,r.tileID.overscaledZ),o=r.tileSize*Math.pow(2,t.transform.tileZoom)/i,a=o*(r.tileID.canonical.x+r.tileID.wrap*i),s=o*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.ay(r,1,t.transform.tileZoom),u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s],u_pattern_transition:n}}const mo={terrain:0,flat:1},go=e.bC(),yo=(t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y)=>{const _=r.style.light,v=_.properties.get("position"),x=[v.x,v.y,v.z],w=e.dO();"viewport"===_.properties.get("anchor")&&(e.dP(w,-r.transform.angle),e.dQ(x,x,w));const b=_.properties.get("color").toPremultipliedRenderColor(null),B=r.transform,C={u_matrix:t,u_lightpos:x,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_vertical_gradient:+n,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:go,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:mo[u],u_base_type:mo[d],u_ao:o,u_edge_radius:a,u_width_scale:s,u_flood_light_color:p,u_vertical_scale:m,u_flood_light_intensity:g,u_ground_shadow_factor:y};return"globe"===B.projection.name&&(C.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],C.u_zoom_transition=h,C.u_inv_rot_matrix=f,C.u_merc_center=A,C.u_up_dir=B.projection.upVector(new e.cD(0,0,0),A[0]*e.al,A[1]*e.al),C.u_height_lift=c),C},_o=(e,t,r,n,i,o)=>({u_matrix:e,u_edge_radius:t,u_width_scale:r,u_vertical_scale:n,u_height_type:mo[i],u_base_type:mo[o]}),vo=(e,t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g)=>{const y=yo(e,t,r,n,i,o,a,s,c,u,d,h,A,f,p,m,1,[0,0,0]),_={u_height_factor:-Math.pow(2,s.overscaledZ)/l.tileSize/8};return Object.assign(y,po(t,l,g),_)},xo=(e,t,r,n,i,o,a,s,l,c,u)=>({u_matrix:t,u_opacity:r,u_ao_pass:n?1:0,u_meter_to_tile:i,u_ao:o,u_flood_light_intensity:a,u_flood_light_color:s,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u,u_dynamic_offset:1}),wo=(e,t,r)=>({u_matrix:e,u_emissive_strength:t,u_ground_shadow_factor:r}),bo=function(e,t,r,n,i){let o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return Object.assign(wo(e,t,i),po(r,n,o))},Bo=(e,t,r,n)=>({u_matrix:e,u_world:r,u_emissive_strength:t,u_ground_shadow_factor:n}),Co=function(e,t,r,n,i,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return Object.assign(bo(e,t,r,n,o,a),{u_world:i})},Eo=(e,t)=>({u_matrix:e,u_ground_shadow_factor:t}),So=(e,t,r,n,i)=>({u_matrix:e,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:r,u_height_scale:n,u_reset_depth:i}),To=(e,t,r,n,i,o,a,s,l)=>({u_matrix:e,u_normal_matrix:t,u_opacity:r,u_faux_facade_ao_intensity:n,u_camera_pos:i,u_tile_to_meter:o,u_facade_emissive_chance:a,u_flood_light_color:s,u_flood_light_intensity:l}),Io=e=>({u_matrix:e}),Fo=e=>({u_matrix:e}),ko=(t,r,n,i,o,a,s,l)=>{const c=e.al/a.tileSize;return{u_matrix:t,u_inv_rot_matrix:r,u_camera_to_center_distance:n.getCameraToCenterDistance(l),u_extrude_scale:[n.pixelsToGLUnits[0]/c,n.pixelsToGLUnits[1]/c],u_zoom_transition:i,u_tile_id:s,u_merc_center:o}},Po=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},Mo=e.bC(),Oo=(t,r,n,i,o,a,s)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.dR(l.zoom,r.canonical)*l._pixelsPerMercatorPixel:e.ay(n,1,a),d={u_matrix:r.projMatrix,u_extrude_scale:u,u_intensity:s,u_inv_rot_matrix:Mo,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){d.u_inv_rot_matrix=i,d.u_merc_center=o,d.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],d.u_zoom_transition=e.aj(l.zoom);const t=o[0]*e.al,n=o[1]*e.al;d.u_up_dir=l.projection.upVector(new e.cD(0,0,0),t,n)}return d};function Lo(e,t,r){let[n,i,o,a]=t,[s,l]=r;if(s===l)return[0,0,0,0];const c=255*(e-1)/(e*(l-s));return[n*c,i*c,o*c,a*c]}function Do(e,t,r){let[n,i]=r;return n===i?0:.5/e+(t-n)*(e-1)/(e*(i-n))}const Uo=(t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x)=>({u_matrix:t,u_normalize_matrix:r,u_globe_matrix:n,u_merc_matrix:i,u_grid_matrix:o,u_tl_parent:a,u_scale_parent:u,u_fade_t:d.mix,u_opacity:d.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:e.dT(h.paint.get("raster-saturation")),u_contrast_factor:e.dS(h.paint.get("raster-contrast")),u_spin_weights:Ro(h.paint.get("raster-hue-rotate")),u_perspective_transform:A,u_raster_elevation:f,u_zoom_transition:s,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:Lo(e.dU,m,y),u_colorization_offset:Do(e.dU,g,y),u_color_ramp:p,u_texture_offset:[v/(_+2*v),_/(_+2*v)],u_texture_res:[_+2*v,_+2*v],u_emissive_strength:x});function Ro(e){e*=Math.PI/180;const t=Math.sin(e),r=Math.cos(e);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const zo=.05,No=(e,t,r,n,i,o,a,s,l,c,u,d)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:n,u_grid_matrix:i,u_tl_parent:o,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:d,u_zoom_transition:a,u_merc_center:s,u_cutoff_params:l}),jo=(e,t,r,n,i,o,a,s,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:n,u_color_ramp:o,u_velocity_res:i,u_max_speed:a,u_uv_offset:s,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[zo,zo]}),Qo=(e,t,r,n,i,o,a,s,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:n,u_max_speed:i,u_speed_factor:o,u_reset_rate:a,u_rand_seed:Math.random(),u_uv_offset:s,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[zo,zo]}),Vo=e.bC(),Ho=(t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x,w,b,B)=>{const C=o.transform,E={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:C.getCameraToCenterDistance(_),u_rotate_symbol:+n,u_aspect_ratio:C.width/C.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:a,u_label_plane_matrix:s,u_coord_matrix:l,u_is_text:+u,u_elevation_from_sea:c?1:0,u_pitch_with_map:+i,u_texsize:d,u_texsize_icon:h,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vo,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Vo,u_up_vector:[0,-1,0],u_color_adj_mat:w,u_icon_transition:b||0,u_gamma_scale:i?o.transform.getCameraToCenterDistance(_)*Math.cos(o.terrain?0:o.transform._pitch):1,u_device_pixel_ratio:e.o.devicePixelRatio,u_is_halo:1,u_scale_factor:B||1,u_ground_shadow_factor:v,u_inv_matrix:e.bl(e.bC(),s),u_normal_scale:x,u_lutTexture:un.LUT};return"globe"===_.name&&(E.u_tile_id=[f.canonical.x,f.canonical.y,1<<f.canonical.z],E.u_zoom_transition=p,E.u_inv_rot_matrix=g,E.u_merc_center=m,E.u_camera_forward=C._camera.forward(),E.u_ecef_origin=e.dV(C.globeMatrix,f.toUnwrapped()),E.u_tile_matrix=Float32Array.from(C.globeMatrix),E.u_up_vector=y),E},Go=(e,t,r,n)=>({u_matrix:e,u_emissive_strength:t,u_opacity:r,u_color:n}),Ko=(t,r,n,i,o,a,s,l,c)=>Object.assign(function(t,r,n,i,o,a){const{width:s,height:l}=i.imageManager.getPixelSize(r),c=Math.pow(2,a.tileID.overscaledZ),u=a.tileSize*Math.pow(2,i.transform.tileZoom)/c,d=u*(a.tileID.canonical.x+a.tileID.wrap*c),h=u*a.tileID.canonical.y;return{u_image:0,u_pattern_tl:n.tl,u_pattern_br:n.br,u_texsize:[s,l],u_pattern_size:n.displaySize,u_pattern_units_to_pixels:o?[i.transform.width,-1*i.transform.height]:[1/e.ay(a,1,i.transform.tileZoom),1/e.ay(a,1,i.transform.tileZoom)],u_pixel_coord_upper:[d>>16,h>>16],u_pixel_coord_lower:[65535&d,65535&h]}}(0,a,s,i,l,c),{u_matrix:t,u_emissive_strength:r,u_opacity:n}),Wo=new Float32Array(e.bA([])),qo=function(t,r,n,i,o,a,s,l,c,u,d,h,A){let f=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[0,0,0],p=arguments.length>14?arguments[14]:void 0,m=arguments.length>15?arguments[15]:void 0,g=arguments.length>16?arguments[16]:void 0;const y=o.style.light,_=y.properties.get("position"),v=[-_.x,-_.y,_.z],x=e.dO();"viewport"===y.properties.get("anchor")&&(e.dP(x,-o.transform.angle),e.dQ(v,v,x));const w="MASK"===d.alphaMode,b=y.properties.get("color").toNonPremultipliedRenderColor(null),B=A.paint.get("model-ambient-occlusion-intensity"),C=A.paint.get("model-color").constantOr(e.ao.white).toNonPremultipliedRenderColor(null);return C.a=A.paint.get("model-color-mix-intensity").constantOr(0),g&&(C.r=g[0],C.g=g[1],C.b=g[2],C.a=g[3]),m&&(C.r=m.color.r,C.g=m.color.g,C.b=m.color.b,C.a=m.colorMix,h=m.emissionStrength,a*=m.opacity),{u_matrix:t,u_lighting_matrix:r,u_normal_matrix:n,u_node_matrix:i||Wo,u_lightpos:v,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[b.r,b.g,b.b],u_camera_pos:f,u_opacity:a,u_baseTextureIsAlpha:0,u_alphaMask:+w,u_alphaCutoff:d.alphaCutoff,u_baseColorFactor:s.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:l.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:c,u_roughnessFactor:u,u_baseColorTexture:un.BaseColor,u_metallicRoughnessTexture:un.MetallicRoughness,u_normalTexture:un.Normal,u_occlusionTexture:un.Occlusion,u_emissionTexture:un.Emission,u_lutTexture:un.LUT,u_color_mix:C.toArray01(),u_aoIntensity:B,u_emissive_strength:h,u_occlusionTextureTransform:p||[0,0,0,0]}},Zo=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wo,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:Wo}},Xo={fillExtrusion:t=>({u_matrix:new e.cl(t),u_lightpos:new e.ci(t),u_lightintensity:new e.cj(t),u_lightcolor:new e.ci(t),u_vertical_gradient:new e.cj(t),u_opacity:new e.cj(t),u_edge_radius:new e.cj(t),u_width_scale:new e.cj(t),u_ao:new e.ck(t),u_height_type:new e.ch(t),u_base_type:new e.ch(t),u_tile_id:new e.ci(t),u_zoom_transition:new e.cj(t),u_inv_rot_matrix:new e.cl(t),u_merc_center:new e.ck(t),u_up_dir:new e.ci(t),u_height_lift:new e.cj(t),u_flood_light_color:new e.ci(t),u_vertical_scale:new e.cj(t),u_flood_light_intensity:new e.cj(t),u_ground_shadow_factor:new e.ci(t)}),fillExtrusionDepth:t=>({u_matrix:new e.cl(t),u_edge_radius:new e.cj(t),u_width_scale:new e.cj(t),u_vertical_scale:new e.cj(t),u_height_type:new e.ch(t),u_base_type:new e.ch(t)}),fillExtrusionPattern:t=>({u_matrix:new e.cl(t),u_lightpos:new e.ci(t),u_lightintensity:new e.cj(t),u_lightcolor:new e.ci(t),u_vertical_gradient:new e.cj(t),u_height_factor:new e.cj(t),u_edge_radius:new e.cj(t),u_width_scale:new e.cj(t),u_ao:new e.ck(t),u_height_type:new e.ch(t),u_base_type:new e.ch(t),u_tile_id:new e.ci(t),u_zoom_transition:new e.cj(t),u_inv_rot_matrix:new e.cl(t),u_merc_center:new e.ck(t),u_up_dir:new e.ci(t),u_height_lift:new e.cj(t),u_image:new e.ch(t),u_texsize:new e.ck(t),u_pixel_coord_upper:new e.ck(t),u_pixel_coord_lower:new e.ck(t),u_tile_units_to_pixels:new e.cj(t),u_opacity:new e.cj(t),u_pattern_transition:new e.cj(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.cl(t),u_opacity:new e.cj(t),u_ao_pass:new e.cj(t),u_meter_to_tile:new e.cj(t),u_ao:new e.ck(t),u_flood_light_intensity:new e.cj(t),u_flood_light_color:new e.ci(t),u_attenuation:new e.cj(t),u_edge_radius:new e.cj(t),u_fb:new e.ch(t),u_fb_size:new e.cj(t),u_dynamic_offset:new e.cj(t)}),fill:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_ground_shadow_factor:new e.ci(t)}),fillPattern:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_image:new e.ch(t),u_texsize:new e.ck(t),u_pixel_coord_upper:new e.ck(t),u_pixel_coord_lower:new e.ck(t),u_tile_units_to_pixels:new e.cj(t),u_ground_shadow_factor:new e.ci(t),u_pattern_transition:new e.cj(t)}),fillOutline:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_world:new e.ck(t),u_ground_shadow_factor:new e.ci(t)}),fillOutlinePattern:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_world:new e.ck(t),u_image:new e.ch(t),u_texsize:new e.ck(t),u_pixel_coord_upper:new e.ck(t),u_pixel_coord_lower:new e.ck(t),u_tile_units_to_pixels:new e.cj(t),u_ground_shadow_factor:new e.ci(t),u_pattern_transition:new e.cj(t)}),building:t=>({u_matrix:new e.cl(t),u_normal_matrix:new e.cl(t),u_opacity:new e.cj(t),u_faux_facade_ao_intensity:new e.cj(t),u_camera_pos:new e.ci(t),u_tile_to_meter:new e.cj(t),u_facade_emissive_chance:new e.cj(t),u_flood_light_color:new e.ci(t),u_flood_light_intensity:new e.cj(t)}),buildingBloom:t=>({u_matrix:new e.cl(t)}),buildingDepth:t=>({u_matrix:new e.cl(t)}),elevatedStructuresDepth:t=>({u_matrix:new e.cl(t),u_depth_bias:new e.cj(t)}),elevatedStructures:t=>({u_matrix:new e.cl(t),u_ground_shadow_factor:new e.ci(t)}),elevatedStructuresDepthReconstruct:t=>({u_matrix:new e.cl(t),u_camera_pos:new e.ci(t),u_depth_bias:new e.cj(t),u_height_scale:new e.cj(t),u_reset_depth:new e.cj(t)}),circle:e.dY,collisionBox:t=>({u_matrix:new e.cl(t),u_inv_rot_matrix:new e.cl(t),u_camera_to_center_distance:new e.cj(t),u_extrude_scale:new e.ck(t),u_zoom_transition:new e.cj(t),u_merc_center:new e.ck(t),u_tile_id:new e.ci(t)}),collisionCircle:t=>({u_matrix:new e.cl(t),u_inv_matrix:new e.cl(t),u_camera_to_center_distance:new e.cj(t),u_viewport_size:new e.ck(t)}),debug:t=>({u_color:new e.dB(t),u_matrix:new e.cl(t),u_overlay:new e.ch(t),u_overlay_scale:new e.cj(t)}),clippingMask:t=>({u_matrix:new e.cl(t)}),heatmap:t=>({u_extrude_scale:new e.cj(t),u_intensity:new e.cj(t),u_matrix:new e.cl(t),u_inv_rot_matrix:new e.cl(t),u_merc_center:new e.ck(t),u_tile_id:new e.ci(t),u_zoom_transition:new e.cj(t),u_up_dir:new e.ci(t)}),heatmapTexture:t=>({u_image:new e.ch(t),u_color_ramp:new e.ch(t),u_opacity:new e.cj(t)}),hillshade:t=>({u_matrix:new e.cl(t),u_image:new e.ch(t),u_latrange:new e.ck(t),u_light:new e.ck(t),u_shadow:new e.dB(t),u_highlight:new e.dB(t),u_emissive_strength:new e.cj(t),u_accent:new e.dB(t)}),hillshadePrepare:t=>({u_matrix:new e.cl(t),u_image:new e.ch(t),u_dimension:new e.ck(t),u_zoom:new e.cj(t)}),line:e.dX,linePattern:e.dW,raster:t=>({u_matrix:new e.cl(t),u_normalize_matrix:new e.cl(t),u_globe_matrix:new e.cl(t),u_merc_matrix:new e.cl(t),u_grid_matrix:new e.dC(t),u_tl_parent:new e.ck(t),u_scale_parent:new e.cj(t),u_fade_t:new e.cj(t),u_opacity:new e.cj(t),u_image0:new e.ch(t),u_image1:new e.ch(t),u_brightness_low:new e.cj(t),u_brightness_high:new e.cj(t),u_saturation_factor:new e.cj(t),u_contrast_factor:new e.cj(t),u_spin_weights:new e.ci(t),u_perspective_transform:new e.ck(t),u_raster_elevation:new e.cj(t),u_zoom_transition:new e.cj(t),u_merc_center:new e.ck(t),u_cutoff_params:new e.d3(t),u_colorization_mix:new e.d3(t),u_colorization_offset:new e.cj(t),u_color_ramp:new e.ch(t),u_texture_offset:new e.ck(t),u_texture_res:new e.ck(t),u_emissive_strength:new e.cj(t)}),rasterParticle:t=>({u_matrix:new e.cl(t),u_normalize_matrix:new e.cl(t),u_globe_matrix:new e.cl(t),u_merc_matrix:new e.cl(t),u_grid_matrix:new e.dC(t),u_tl_parent:new e.ck(t),u_scale_parent:new e.cj(t),u_fade_t:new e.cj(t),u_opacity:new e.cj(t),u_image0:new e.ch(t),u_image1:new e.ch(t),u_raster_elevation:new e.cj(t),u_zoom_transition:new e.cj(t),u_merc_center:new e.ck(t),u_cutoff_params:new e.d3(t)}),rasterParticleTexture:t=>({u_texture:new e.ch(t),u_opacity:new e.cj(t)}),rasterParticleDraw:t=>({u_particle_texture:new e.ch(t),u_particle_texture_side_len:new e.cj(t),u_tile_offset:new e.ck(t),u_velocity:new e.ch(t),u_color_ramp:new e.ch(t),u_velocity_res:new e.ck(t),u_max_speed:new e.cj(t),u_uv_offset:new e.ck(t),u_data_scale:new e.ck(t),u_data_offset:new e.cj(t),u_particle_pos_scale:new e.cj(t),u_particle_pos_offset:new e.ck(t)}),rasterParticleUpdate:t=>({u_particle_texture:new e.ch(t),u_particle_texture_side_len:new e.cj(t),u_velocity:new e.ch(t),u_velocity_res:new e.ck(t),u_max_speed:new e.cj(t),u_speed_factor:new e.cj(t),u_reset_rate:new e.cj(t),u_rand_seed:new e.cj(t),u_uv_offset:new e.ck(t),u_data_scale:new e.ck(t),u_data_offset:new e.cj(t),u_particle_pos_scale:new e.cj(t),u_particle_pos_offset:new e.ck(t)}),symbol:t=>({u_is_size_zoom_constant:new e.ch(t),u_is_size_feature_constant:new e.ch(t),u_size_t:new e.cj(t),u_size:new e.cj(t),u_camera_to_center_distance:new e.cj(t),u_rotate_symbol:new e.ch(t),u_aspect_ratio:new e.cj(t),u_fade_change:new e.cj(t),u_matrix:new e.cl(t),u_label_plane_matrix:new e.cl(t),u_coord_matrix:new e.cl(t),u_is_text:new e.ch(t),u_elevation_from_sea:new e.ch(t),u_pitch_with_map:new e.ch(t),u_texsize:new e.ck(t),u_texsize_icon:new e.ck(t),u_texture:new e.ch(t),u_texture_icon:new e.ch(t),u_gamma_scale:new e.cj(t),u_device_pixel_ratio:new e.cj(t),u_tile_id:new e.ci(t),u_zoom_transition:new e.cj(t),u_inv_rot_matrix:new e.cl(t),u_merc_center:new e.ck(t),u_camera_forward:new e.ci(t),u_tile_matrix:new e.cl(t),u_up_vector:new e.ci(t),u_ecef_origin:new e.ci(t),u_is_halo:new e.ch(t),u_icon_transition:new e.cj(t),u_color_adj_mat:new e.cl(t),u_scale_factor:new e.cj(t),u_ground_shadow_factor:new e.ci(t),u_inv_matrix:new e.cl(t),u_normal_scale:new e.cj(t),u_lutTexture:new e.ch(t)}),background:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_opacity:new e.cj(t),u_color:new e.dB(t)}),backgroundPattern:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_opacity:new e.cj(t),u_image:new e.ch(t),u_pattern_tl:new e.ck(t),u_pattern_br:new e.ck(t),u_texsize:new e.ck(t),u_pattern_size:new e.ck(t),u_pixel_coord_upper:new e.ck(t),u_pixel_coord_lower:new e.ck(t),u_pattern_units_to_pixels:new e.ck(t)}),terrainRaster:t=>({u_matrix:new e.cl(t),u_image0:new e.ch(t),u_image1:new e.ch(t),u_skirt_height:new e.cj(t),u_ground_shadow_factor:new e.ci(t),u_emissive_texture_available:new e.cj(t)}),skybox:t=>({u_matrix:new e.cl(t),u_sun_direction:new e.ci(t),u_cubemap:new e.ch(t),u_opacity:new e.cj(t),u_temporal_offset:new e.cj(t)}),skyboxGradient:t=>({u_matrix:new e.cl(t),u_color_ramp:new e.ch(t),u_center_direction:new e.ci(t),u_radius:new e.cj(t),u_opacity:new e.cj(t),u_temporal_offset:new e.cj(t)}),skyboxCapture:t=>({u_matrix_3f:new e.dC(t),u_sun_direction:new e.ci(t),u_sun_intensity:new e.cj(t),u_color_tint_r:new e.d3(t),u_color_tint_m:new e.d3(t),u_luminance:new e.cj(t)}),globeRaster:t=>({u_proj_matrix:new e.cl(t),u_globe_matrix:new e.cl(t),u_normalize_matrix:new e.cl(t),u_merc_matrix:new e.cl(t),u_zoom_transition:new e.cj(t),u_merc_center:new e.ck(t),u_image0:new e.ch(t),u_image1:new e.ch(t),u_grid_matrix:new e.dC(t),u_skirt_height:new e.cj(t),u_far_z_cutoff:new e.cj(t),u_frustum_tl:new e.ci(t),u_frustum_tr:new e.ci(t),u_frustum_br:new e.ci(t),u_frustum_bl:new e.ci(t),u_globe_pos:new e.ci(t),u_globe_radius:new e.cj(t),u_viewport:new e.ck(t),u_emissive_texture_available:new e.cj(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.ci(t),u_frustum_tr:new e.ci(t),u_frustum_br:new e.ci(t),u_frustum_bl:new e.ci(t),u_horizon:new e.cj(t),u_transition:new e.cj(t),u_fadeout_range:new e.cj(t),u_atmosphere_fog_color:new e.d3(t),u_high_color:new e.d3(t),u_space_color:new e.d3(t),u_temporal_offset:new e.cj(t),u_horizon_angle:new e.cj(t)}),model:t=>({u_matrix:new e.cl(t),u_lighting_matrix:new e.cl(t),u_normal_matrix:new e.cl(t),u_node_matrix:new e.cl(t),u_lightpos:new e.ci(t),u_lightintensity:new e.cj(t),u_lightcolor:new e.ci(t),u_camera_pos:new e.ci(t),u_opacity:new e.cj(t),u_baseColorFactor:new e.d3(t),u_emissiveFactor:new e.d3(t),u_metallicFactor:new e.cj(t),u_roughnessFactor:new e.cj(t),u_baseTextureIsAlpha:new e.ch(t),u_alphaMask:new e.ch(t),u_alphaCutoff:new e.cj(t),u_baseColorTexture:new e.ch(t),u_metallicRoughnessTexture:new e.ch(t),u_normalTexture:new e.ch(t),u_occlusionTexture:new e.ch(t),u_emissionTexture:new e.ch(t),u_lutTexture:new e.ch(t),u_color_mix:new e.d3(t),u_aoIntensity:new e.cj(t),u_emissive_strength:new e.cj(t),u_occlusionTextureTransform:new e.d3(t)}),modelDepth:t=>({u_matrix:new e.cl(t),u_instance:new e.cl(t),u_node_matrix:new e.cl(t)}),groundShadow:t=>({u_matrix:new e.cl(t),u_ground_shadow_factor:new e.ci(t)}),stars:t=>({u_matrix:new e.cl(t),u_up:new e.ci(t),u_right:new e.ci(t),u_intensity_multiplier:new e.cj(t)}),snowParticle:t=>({u_modelview:new e.cl(t),u_projection:new e.cl(t),u_time:new e.cj(t),u_cam_pos:new e.ci(t),u_velocityConeAperture:new e.cj(t),u_velocity:new e.cj(t),u_horizontalOscillationRadius:new e.cj(t),u_horizontalOscillationRate:new e.cj(t),u_boxSize:new e.cj(t),u_billboardSize:new e.cj(t),u_simpleShapeParameters:new e.ck(t),u_screenSize:new e.ck(t),u_thinningCenterPos:new e.ck(t),u_thinningShape:new e.ci(t),u_thinningAffectedRatio:new e.cj(t),u_thinningParticleOffset:new e.cj(t),u_particleColor:new e.d3(t),u_direction:new e.ci(t)}),rainParticle:t=>({u_modelview:new e.cl(t),u_projection:new e.cl(t),u_time:new e.cj(t),u_cam_pos:new e.ci(t),u_texScreen:new e.ch(t),u_velocityConeAperture:new e.cj(t),u_velocity:new e.cj(t),u_boxSize:new e.cj(t),u_rainDropletSize:new e.ck(t),u_distortionStrength:new e.cj(t),u_rainDirection:new e.ci(t),u_color:new e.d3(t),u_screenSize:new e.ck(t),u_thinningCenterPos:new e.ck(t),u_thinningShape:new e.ci(t),u_thinningAffectedRatio:new e.cj(t),u_thinningParticleOffset:new e.cj(t),u_shapeDirectionalPower:new e.cj(t),u_shapeNormalPower:new e.cj(t),u_mode:new e.cj(t)}),vignette:t=>({u_vignetteShape:new e.ci(t),u_vignetteColor:new e.d3(t)}),occlusion:t=>({u_matrix:new e.cl(t),u_anchorPos:new e.ci(t),u_screenSizePx:new e.ck(t),u_occluderSizePx:new e.ck(t),u_color:new e.d3(t)})};class Yo{constructor(e,t,r,n){this.id=Yo.uniqueIdxCounter,Yo.uniqueIdxCounter++,this.context=e;const i=e.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||n||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Yo.uniqueIdxCounter,Yo.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Yo.uniqueIdxCounter=0;const Jo={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class $o{constructor(e,t,r,n,i,o){this.length=t.length,this.attributes=r,this.itemSize=t.bytesPerElement,this.dynamicDraw=n,this.instanceCount=o,this.context=e;const a=e.gl;this.buffer=a.createBuffer(),e.bindVertexBuffer.set(this.buffer),a.bufferData(a.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?a.DYNAMIC_DRAW:a.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let r=0;r<this.attributes.length;r++){const n=t.getAttributeLocation(e,this.attributes[r].name);-1!==n&&e.enableVertexAttribArray(n)}}setVertexAttribPointers(e,t,r){for(let n=0;n<this.attributes.length;n++){const i=this.attributes[n],o=t.getAttributeLocation(e,i.name);-1!==o&&e.vertexAttribPointer(o,i.components,e[Jo[i.type]],!1,this.itemSize,i.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(e,t,r){for(let n=0;n<this.attributes.length;n++){const i=t.getAttributeLocation(e,this.attributes[n].name);-1!==i&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(i,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class ea{constructor(e,t,r,n,i){this.context=e,this.width=t,this.height=r;const o=this.framebuffer=e.gl.createFramebuffer();n>0&&(this.colorAttachment0=new Ki(e,o,0)),n>1&&(this.colorAttachment1=new Ki(e,o,1)),i&&(this.depthAttachmentType=i,this.depthAttachment="renderbuffer"===i?new Wi(e,o):new qi(e,o))}createColorAttachment(e,t){0===t?this.colorAttachment0=new Ki(e,this.framebuffer,0):1===t&&(this.colorAttachment1=new Ki(e,this.framebuffer,1))}removeColorAttachment(e,t){const r=this.context.gl;let n;0===t?(n=this.colorAttachment0.get(),this.colorAttachment0=void 0):1===t&&(n=this.colorAttachment1.get(),this.colorAttachment1=void 0),n&&r.deleteTexture(n)}destroy(){const e=this.context.gl;if(this.colorAttachment0){const t=this.colorAttachment0.get();t&&e.deleteTexture(t)}if(this.colorAttachment1){const t=this.colorAttachment1.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class ta{constructor(e,t){this.gl=e,this.clearColor=new fi(this),this.clearDepth=new pi(this),this.clearStencil=new mi(this),this.colorMask=new gi(this),this.depthMask=new yi(this),this.stencilMask=new _i(this),this.stencilFunc=new vi(this),this.stencilOp=new xi(this),this.stencilTest=new wi(this),this.depthRange=new bi(this),this.depthTest=new Bi(this),this.depthFunc=new Ci(this),this.blend=new Ei(this),this.blendFunc=new Si(this),this.blendColor=new Ti(this),this.blendEquation=new Ii(this),this.cullFace=new Fi(this),this.cullFaceSide=new ki(this),this.frontFace=new Pi(this),this.program=new Mi(this),this.activeTexture=new Oi(this),this.viewport=new Li(this),this.bindFramebuffer=new Di(this),this.bindRenderbuffer=new Ui(this),this.bindTexture=new Ri(this),this.bindVertexBuffer=new zi(this),this.bindElementBuffer=new Ni(this),this.bindVertexArrayOES=new ji(this),this.pixelStoreUnpack=new Qi(this),this.pixelStoreUnpackPremultiplyAlpha=new Vi(this),this.pixelStoreUnpackFlipY=new Hi(this),this.options=t?Object.assign({},t):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=t&&!!t.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=e.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,r){return new Yo(this,e,t,r)}createVertexBuffer(e,t,r,n,i){return new $o(this,e,t,r,n,i)}createRenderbuffer(e,t,r){const n=this.gl,i=n.createRenderbuffer();return this.bindRenderbuffer.set(i),n.renderbufferStorage(n.RENDERBUFFER,e,t,r),this.bindRenderbuffer.set(null),i}createFramebuffer(e,t,r,n){return new ea(this,e,t,r,n)}clear(e){let{color:t,depth:r,stencil:n,colorMask:i}=e;const o=this.gl;let a=0;t&&(a|=o.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(i||[!0,!0,!0,!0])),void 0!==r&&(a|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),void 0!==n&&(a|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),o.clear(a)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.by(t.blendFunction,Yr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let ra;function na(t,r,n,i,o,a,s){const l=t.context,c=l.gl,u=t.transform,d=[e.aF(u.center.lng),e.aJ(u.center.lat)],h=n.layout.get("symbol-placement"),A=n.layout.get("text-variable-anchor"),f="map"===n.layout.get("icon-rotation-alignment"),p="map"===n.layout.get("text-rotation-alignment"),m="point"!==h,g=[];let y=0,_=0;for(let E=0;E<i.length;E++){const l=i[E],h=r.getTile(l),v=h.getBucket(n);if(!v)continue;const x=v.getProjection().createInversionMatrix(u,l.canonical),w=[],b=tr(l,v,u),B=!s&&f&&m,C=s&&p&&m,S=A&&v.hasTextData(),T=v.hasIconTextFit()&&S&&v.hasIconData(),I=B||C||s&&S||T,F="globe"===v.projection.name,k=F?e.aj(u.zoom):0;F&&(w.push("PROJECTION_GLOBE_VIEW"),I&&w.push("PROJECTED_POS_ON_VIEWPORT"));const P=t.getOrCreateProgram("collisionBox",{defines:w});let M=b;0===o[0]&&0===o[1]||(M=t.translatePosMatrix(b,h,o,a));const O=s?v.textCollisionBox:v.iconCollisionBox,L=v.collisionCircleArray;if(L.length>0){const t=e.bC(),r=M;e.cP(t,v.placementInvProjMatrix,u.glCoordMatrix),e.cP(t,t,v.placementViewportMatrix),g.push({circleArray:L,circleOffset:_,transform:r,invTransform:t,projection:v.getProjection()}),y+=L.length/4,_=y}if(!O)continue;t.terrain&&t.terrain.setupElevationDraw(h,P);const D=F?[l.canonical.x,l.canonical.y,1<<l.canonical.z]:[0,0,0];P.draw(t,c.LINES,Jr.disabled,en.disabled,t.colorModeForRenderPass(),nn.disabled,ko(M,x,u,k,d,h,D,v.getProjection()),n.id,O.layoutVertexBuffer,O.indexBuffer,O.segments,null,u.zoom,null,[O.collisionVertexBuffer,O.collisionVertexBufferExt])}if(!s||!g.length)return;const v=t.getOrCreateProgram("collisionCircle"),x=new e.dZ;x.resize(4*y),x._trim();let w=0;for(const e of g)for(let t=0;t<e.circleArray.length/4;t++){const r=4*t,n=e.circleArray[r+0],i=e.circleArray[r+1],o=e.circleArray[r+2],a=e.circleArray[r+3];x.emplace(w++,n,i,o,a,0),x.emplace(w++,n,i,o,a,1),x.emplace(w++,n,i,o,a,2),x.emplace(w++,n,i,o,a,3)}(!ra||ra.length<2*y)&&(ra=function(t){const r=2*t,n=new e.b0;n.resize(r),n._trim();for(let e=0;e<r;e++){const t=6*e;n.uint16[t+0]=4*e+0,n.uint16[t+1]=4*e+1,n.uint16[t+2]=4*e+2,n.uint16[t+3]=4*e+2,n.uint16[t+4]=4*e+3,n.uint16[t+5]=4*e+0}return n}(y));const b=l.createIndexBuffer(ra,!0),B=l.createVertexBuffer(x,e.d_.members,!0);for(const E of g){const r={u_matrix:E.transform,u_inv_matrix:E.invTransform,u_camera_to_center_distance:(C=u).getCameraToCenterDistance(E.projection),u_viewport_size:[C.width,C.height]};v.draw(t,c.TRIANGLES,Jr.disabled,en.disabled,t.colorModeForRenderPass(),nn.disabled,r,n.id,B,b,e.bg.simpleSegment(0,2*E.circleOffset,E.circleArray.length,E.circleArray.length/2),null,u.zoom)}var C;B.destroy(),b.destroy()}const ia=e.bC();function oa(t){const r=t._camera.getWorldToCamera(t.worldSize,1),n=e.aB([],r,t.globeMatrix);e.bl(n,n);const i=[0,0,0],o=[0,1,0,0];return e.aC(o,o,n),i[0]=o[0],i[1]=o[1],i[2]=o[2],e.aw(i,i),i}function aa(t,r){let{width:n,height:i,anchor:o,textOffset:a,textScale:s}=t;const{horizontalAlign:l,verticalAlign:c}=e.c1(o),u=-(l-.5)*n,d=-(c-.5)*i,h=e.c2(o,a);return new e.P((u/s+h[0])*r,(d/s+h[1])*r)}function sa(t,r,n,i,o,a,s,l,c,u){const d=t.text.placedSymbolArray,h=t.text.dynamicLayoutVertexArray,A=t.icon.dynamicLayoutVertexArray,f={},p=t.getProjection(),m=rr(s,p,o),g=o.elevation,y=p.upVectorScale(s.canonical,o.center.lat,o.worldSize).metersToTile;h.clear();for(let _=0;_<d.length;_++){const A=d.get(_),{tileAnchorX:v,tileAnchorY:x,numGlyphs:w}=A,b=A.hidden||!A.crossTileID||t.allowVerticalPlacement&&!A.placedOrientation?null:i[A.crossTileID];if(b){let i=0,d=0,B=0;const C="road"===t.elevationType;if(g||C){const r=C?t.getElevationFeatureForText(_):null,n=e.bV.getAtTileOffset(s,new e.P(v,x),g,r),[o,a,l]=p.upVector(s.canonical,v,x);i=n*o*y,d=n*a*y,B=n*l*y}let[E,S,T,I]=ur(A.projectedAnchorX+i,A.projectedAnchorY+d,A.projectedAnchorZ+B,n?m:a);const F=dr(o.getCameraToCenterDistance(p),I);let k=e.bM(t.textSizeData,c,A)*F/e.bY;n&&(k*=t.tilePixelRatio/l);const P=aa(b,k);n?(({x:E,y:S,z:T}=p.projectTilePoint(v+P.x,x+P.y,s.canonical)),[E,S,T]=ur(E+i,S+d,T+B,a)):(r&&P._rotate(-o.angle),E+=P.x,S+=P.y,T=0);const M=t.allowVerticalPlacement&&A.placedOrientation===e.bL.vertical?Math.PI/2:0;for(let t=0;t<w;t++)e.bO(h,E,S,T,M);u&&A.associatedIconIndex>=0&&(f[A.associatedIconIndex]={x:E,y:S,z:T,angle:M})}else vr(w,h)}if(u){A.clear();const r=t.icon.placedSymbolArray;for(let t=0;t<r.length;t++){const n=r.get(t),{numGlyphs:i}=n,o=f[t];if(n.hidden||!o)vr(i,A);else{const{x:t,y:r,z:n,angle:a}=o;for(let o=0;o<i;o++)e.bO(A,t,r,n,a)}}t.icon.dynamicLayoutVertexBuffer.updateData(A)}t.text.dynamicLayoutVertexBuffer.updateData(h)}function la(t,r,n,i,o,a){let s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};const l=n.paint.get("icon-translate"),c=n.paint.get("text-translate"),u=n.paint.get("icon-translate-anchor"),d=n.paint.get("text-translate-anchor"),h=n.layout.get("icon-rotation-alignment"),A=n.layout.get("text-rotation-alignment"),f=n.layout.get("icon-pitch-alignment"),p=n.layout.get("text-pitch-alignment"),m=n.layout.get("icon-keep-upright"),g=n.layout.get("text-keep-upright"),y=n.paint.get("icon-color-saturation"),_=n.paint.get("icon-color-contrast"),v=n.paint.get("icon-color-brightness-min"),x=n.paint.get("icon-color-brightness-max"),w="sea"===n.layout.get("symbol-elevation-reference"),b="none"===n.layout.get("icon-image-use-theme"),B=t.context,C=B.gl,E=t.transform,S="map"===h,T="map"===A,I="map"===f,F="map"===p,k=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let P=!1;const M=t.depthModeForSublayer(0,Jr.ReadOnly),O=new Jr(t.context.gl.LEQUAL,Jr.ReadOnly,t.depthRangeFor3D),L=[e.aF(E.center.lng),e.aJ(E.center.lat)],D=n.layout.get("text-variable-anchor"),U="globe"===E.projection.name,R=[],z=[0,-1,0];for(const N of i){const i=r.getTile(N),o=i.getBucket(n);if(!o)continue;if("mercator"===o.projection.name&&U)continue;if(o.fullyClipped)continue;const a="globe"===o.projection.name,h=a?e.aj(E.zoom):0,A=rr(N,o.getProjection(),E),f=E.calculatePixelsToTileUnitsMatrix(i),p=D&&o.hasTextData(),j=o.hasIconTextFit()&&p&&o.hasIconData(),Q=o.getProjection().createInversionMatrix(E,N.canonical),V=(1<<i.tileID.canonical.z)*e.al/t.transform.worldSize,H=e=>{let r=[0,0,0];if(e){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(r=xn(t.style,e,n))}return r},G=e=>{E.depthOcclusionForSymbolsAndCircles&&(n.hasOcclusionOpacityProperties||t.terrain)&&(e.push("DEPTH_D24"),e.push("DEPTH_OCCLUSION"))},K=r=>{n.lut&&!b&&(n.lut.texture||(n.lut.texture=new e.d$(t.context,n.lut.image,[n.lut.image.height,n.lut.image.height,n.lut.image.height],B.gl.RGBA8)),B.activeTexture.set(B.gl.TEXTURE0+un.LUT),n.lut.texture&&n.lut.texture.bind(B.gl.LINEAR,B.gl.CLAMP_TO_EDGE),r.push("APPLY_LUT_ON_GPU"))},W=()=>{const r=S&&"point"!==n.layout.get("symbol-placement"),s=[];G(s),K(s);const c=r||j,d="road"===o.elevationType,p=t.shadowRenderer,g=d&&I&&!!p&&p.enabled,b=H(g),B=d&&I&&!t.terrain?O:M,T=n.paint.get("icon-image-cross-fade");t.terrainRenderModeElevated()&&I&&s.push("PITCH_WITH_MAP_TERRAIN"),a&&(s.push("PROJECTION_GLOBE_VIEW"),c&&s.push("PROJECTED_POS_ON_VIEWPORT")),T>0&&o.hasAnySecondaryIcon&&s.push("ICON_TRANSITION"),!o.icon.zOffsetVertexBuffer||d&&t.terrain||s.push("Z_OFFSET"),0===y&&0===_&&0===v&&1===x||s.push("COLOR_ADJUSTMENT"),o.sdfIcons&&s.push("RENDER_SDF"),g&&s.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),d&&I&&!t.terrain&&o.icon.orientationVertexBuffer&&s.push("ELEVATED_ROADS");const F=o.icon.programConfigurations.get(n.id),k=t.getOrCreateProgram("symbol",{config:F,defines:s}),P=i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],D=o.iconSizeData,R=e.bK(D,E.zoom),W=I||!E.isOrthographic,q=sr(A,i.tileID.canonical,I,S,E,o.getProjection(),f),Z=cr(A,i.tileID.canonical,I,S,E,o.getProjection(),f),X=t.translatePosMatrix(Z,i,l,u,!0),Y=t.translatePosMatrix(A,i,l,u),J=c?ia:q,$=S&&!I&&!r;let ee=z;!U&&!E.mercatorFromTransition||S||(ee=oa(E));const te=a?ee:z,re=n.getColorAdjustmentMatrix(y,_,v,x),ne=Ho(D.kind,R,$,I,t,Y,J,X,w,!1,P,[0,0],0,N,h,L,Q,te,o.getProjection(),b,V,re,T,null),ie=i.imageAtlasTexture?i.imageAtlasTexture:null,oe=1!==n.layout.get("icon-size").constantOr(0)||o.iconsNeedLinear,ae=o.sdfIcons||t.options.rotating||t.options.zooming||oe||W?C.LINEAR:C.NEAREST,se=o.sdfIcons&&0!==n.paint.get("icon-halo-width").constantOr(1),le=t.terrain&&I&&r?e.bl(e.bC(),q):ia;if(r&&o.icon){const r=e.bV.getAtTileOffsetFunc(N,E.center.lat,E.worldSize,o.getProjection()),a=lr(A,i.tileID.canonical,I,S,E,o.getProjection(),f),s=n.layout.get("icon-size-scale-range"),l=e.aA(t.scaleFactor,s[0],s[1]);Ar(o,A,t,!1,a,Z,I,m,r,N,l)}return{program:k,buffers:o.icon,uniformValues:ne,atlasTexture:ie,atlasTextureIcon:null,atlasInterpolation:ae,atlasInterpolationIcon:null,isSDF:o.sdfIcons,hasHalo:se,depthMode:B,tile:i,renderWithShadows:g,labelPlaneMatrixInv:le}},q=()=>{const r=T&&"point"!==n.layout.get("symbol-placement"),s=[],l=r||D||j,u="road"===o.elevationType,p=t.shadowRenderer,m=u&&F&&!!p&&p.enabled,y=H(m),_=u&&F&&!t.terrain?O:M;t.terrainRenderModeElevated()&&F&&s.push("PITCH_WITH_MAP_TERRAIN"),a&&(s.push("PROJECTION_GLOBE_VIEW"),l&&s.push("PROJECTED_POS_ON_VIEWPORT")),!o.text.zOffsetVertexBuffer||u&&t.terrain||s.push("Z_OFFSET"),o.iconsInText&&s.push("RENDER_TEXT_AND_SYMBOL"),s.push("RENDER_SDF"),m&&s.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),u&&F&&!t.terrain&&o.text.orientationVertexBuffer&&s.push("ELEVATED_ROADS"),G(s);const v=o.text.programConfigurations.get(n.id),x=t.getOrCreateProgram("symbol",{config:v,defines:s});let b,B=[0,0],S=null;const I=o.textSizeData;o.iconsInText&&(B=i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],S=i.imageAtlasTexture?i.imageAtlasTexture:null,b=F||!E.isOrthographic||t.options.rotating||t.options.zooming||"composite"===I.kind||"camera"===I.kind?C.LINEAR:C.NEAREST);const k=i.glyphAtlasTexture?i.glyphAtlasTexture.size:[0,0],P=n.layout.get("text-size-scale-range"),R=e.aA(t.scaleFactor,P[0],P[1]),K=e.bK(I,E.zoom,R),W=sr(A,i.tileID.canonical,F,T,E,o.getProjection(),f),q=cr(A,i.tileID.canonical,F,T,E,o.getProjection(),f),Z=t.translatePosMatrix(q,i,c,d,!0),X=t.translatePosMatrix(A,i,c,d),Y=l?ia:W,J=T&&!F&&!r;let $=z;!U&&!E.mercatorFromTransition||T||($=oa(E));const ee=Ho(I.kind,K,J,F,t,X,Y,Z,w,!0,k,B,0,N,h,L,Q,a?$:z,o.getProjection(),y,V,null,null,R),te=i.glyphAtlasTexture?i.glyphAtlasTexture:null,re=C.LINEAR,ne=0!==n.paint.get("text-halo-width").constantOr(1),ie=t.terrain&&F&&r?e.bl(e.bC(),W):ia;if(r&&o.text){const r=e.bV.getAtTileOffsetFunc(N,E.center.lat,E.worldSize,o.getProjection()),n=lr(A,i.tileID.canonical,F,T,E,o.getProjection(),f);Ar(o,A,t,!0,n,q,F,g,r,N,R)}return{program:x,buffers:o.text,uniformValues:ee,atlasTexture:te,atlasTextureIcon:S,atlasInterpolation:re,atlasInterpolationIcon:b,isSDF:!0,hasHalo:ne,depthMode:_,tile:i,renderWithShadows:m,labelPlaneMatrixInv:ie}},Z=o.icon.segments.get().length,X=o.text.segments.get().length,Y=Z&&!s.onlyText?W():null,J=X&&!s.onlyIcons?q():null,$=n.paint.get("icon-opacity").constantOr(1),ee=n.paint.get("text-opacity").constantOr(1);if(k&&o.canOverlap){P=!0;const t=$&&!s.onlyText?o.icon.segments.get():[],r=ee&&!s.onlyIcons?o.text.segments.get():[];for(const n of t)R.push({segments:new e.bg([n]),sortKey:n.sortKey,state:Y});for(const n of r)R.push({segments:new e.bg([n]),sortKey:n.sortKey,state:J})}else s.onlyText||R.push({segments:$?o.icon.segments:new e.bg([]),sortKey:0,state:Y}),s.onlyIcons||R.push({segments:ee?o.text.segments:new e.bg([]),sortKey:0,state:J})}P&&R.sort((e,t)=>e.sortKey-t.sortKey);for(const e of R){const r=e.state;if(r)if(t.terrain?t.terrain.setupElevationDraw(r.tile,r.program,{useDepthForOcclusion:E.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:r.labelPlaneMatrixInv}):t.setupDepthForOcclusion(E.depthOcclusionForSymbolsAndCircles,r.program),B.activeTexture.set(C.TEXTURE0),r.atlasTexture&&r.atlasTexture.bind(r.atlasInterpolation,C.CLAMP_TO_EDGE,!0),r.atlasTextureIcon&&(B.activeTexture.set(C.TEXTURE1),r.atlasTextureIcon&&r.atlasTextureIcon.bind(r.atlasInterpolationIcon,C.CLAMP_TO_EDGE,!0)),r.renderWithShadows&&t.shadowRenderer.setupShadows(r.tile.tileID.toUnwrapped(),r.program,"vector-tile"),t.uploadCommonLightUniforms(t.context,r.program),r.hasHalo){const i=r.uniformValues;i.u_is_halo=1,ca(r.buffers,e.segments,n,t,r.program,r.depthMode,o,a,i,2),i.u_is_halo=0}else{if(r.isSDF){const i=r.uniformValues;r.hasHalo&&(i.u_is_halo=1,ca(r.buffers,e.segments,n,t,r.program,r.depthMode,o,a,i,1)),i.u_is_halo=0}ca(r.buffers,e.segments,n,t,r.program,r.depthMode,o,a,r.uniformValues,1)}}}function ca(e,t,r,n,i,o,a,s,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer,e.orientationVertexBuffer];i.draw(n,n.context.gl.TRIANGLES,o,a,s,nn.disabled,l,r.id,e.layoutVertexBuffer,e.indexBuffer,t,r.paint,n.transform.zoom,e.programConfigurations.get(r.id),u,c)}function ua(t,r){const n=1<<t.canonical.z,i=(r.x*n-t.canonical.x-t.wrap*n)*e.al,o=(r.y*n-t.canonical.y)*e.al,a=e.e8(r.z,r.y);return e.d5(i,o,a)}function da(t,r,n,i,o){if(!n.layout||"none"===n.layout.get("fill-elevation-reference")||0===n.paint.get("fill-opacity").constantOr(1))return;const a=t.context.gl,s=new Jr(t.context.gl.LEQUAL,Jr.ReadWrite,t.depthRangeFor3D),l=new Jr(t.context.gl.GREATER,Jr.ReadWrite,t.depthRangeFor3D),c=function(t){let r=.01;return t.isOrthographic&&(r=e.ak(1e-4,r,e.d0(t.pitch>=hn?1:t.pitch/hn))),2*r}(t.transform),u=t.transform.getFreeCameraOptions().position,d="elevatedStructuresDepthReconstruct",h=t.getOrCreateProgram(d,{defines:["DEPTH_RECONSTRUCTION"]}),A=t.getOrCreateProgram(d);for(const e of i){const i=r.getTile(e),d=i.getBucket(n);if(!d)continue;const f=d.elevatedStructures;if(!f)continue;const p=d.elevationBufferData.heightRange,m=ua(e.toUnwrapped(),u),g=t.translatePosMatrix(e.projMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));let y,_,v,x;if("initialize"===o){if(!p||p.min>=1||0===f.depthSegments.segments[0].primitiveLength)continue;y=So(g,m,c,1,0),_=s,v=f.depthSegments,x=h}else if("reset"===o){if(!p||p.min>=0||0===f.maskSegments.segments[0].primitiveLength)continue;y=So(g,m,0,0,1),_=l,v=f.maskSegments,x=h}else if("geometry"===o){if(0===f.depthSegments.segments[0].primitiveLength)continue;y=So(g,m,c,1,0),_=s,v=f.depthSegments,x=A}x.draw(t,a.TRIANGLES,_,en.disabled,Yr.disabled,nn.disabled,y,n.id,f.vertexBuffer,f.indexBuffer,v,n.paint,t.transform.zoom)}}function ha(t,r,n,i){const{painter:o,sourceCache:a,layer:s,coords:l,colorMode:c,elevationType:u,terrainEnabled:d,pass:h}=t,A=o.context.gl,f=s.paint.get("fill-pattern"),p=s.paint.get("fill-pattern-cross-fade"),m=f.constantOr(null);let g=u;"road"!==u||r&&!d||(g="none");const y="road"===g,_=t.painter.shadowRenderer,v=y&&!!_&&_.enabled,x=new Jr(o.context.gl.LEQUAL,Jr.ReadOnly,o.depthRangeFor3D);let w=[0,0,0];if(v){const e=o.style.directionalLight,t=o.style.ambientLight;e&&t&&(w=xn(o.style,e,t))}const b=f&&f.constantOr(1),B=o.terrain&&o.terrain.renderingToTexture,C=(t,h)=>{let f,g,C,E,S;h?(f=b&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",C=A.LINES):(f=b?"fillPattern":"fill",C=A.TRIANGLES);for(const T of l){const l=a.getTile(T);if(b&&!l.patternsLoaded())continue;const I=l.getBucket(s);if(!I)continue;const F=r?I.elevationBufferData:I.bufferData;if(F.isEmpty())continue;o.prepareDrawTile();const k=F.programConfigurations.get(s.id),P=o.isTileAffectedByFog(T),M=[],O=[];y&&(M.push("ELEVATED_ROADS"),O.push(F.elevatedLayoutVertexBuffer)),v&&M.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),B&&n&&M.push("USE_MRT1"),b&&(o.context.activeTexture.set(A.TEXTURE0),l.imageAtlasTexture&&l.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),k.updatePaintBuffers());let L=!1;if(m&&l.imageAtlas){const t=l.imageAtlas,r=e.e3.from(m),n=r.getPrimary().scaleSelf(e.o.devicePixelRatio).toString(),i=r.getSecondary(),o=t.patternPositions.get(n),a=i?t.patternPositions.get(i.scaleSelf(e.o.devicePixelRatio).toString()):null;L=!!o&&!!a,o&&k.setConstantPatternPositions(o,a)}p>0&&(L||k.getPatternTransitionVertexBuffer("fill-pattern"))&&M.push("FILL_PATTERN_TRANSITION");const D=o.getOrCreateProgram(f,{config:k,overrideFog:P,defines:M}),U=o.translatePosMatrix(T.projMatrix,l,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));v&&_.setupShadows(l.tileID.toUnwrapped(),D,"vector-tile");const R=s.paint.get("fill-emissive-strength");if(h){E=F.lineIndexBuffer,S=F.lineSegments;const e=o.terrain&&o.terrain.renderingToTexture?o.terrain.drapeBufferSize:[A.drawingBufferWidth,A.drawingBufferHeight];g="fillOutlinePattern"===f&&b?Co(U,R,o,l,e,w,p):Bo(U,R,e,w)}else E=F.indexBuffer,S=F.triangleSegments,g=b?bo(U,R,o,l,w,p):wo(U,R,w);o.uploadCommonUniforms(o.context,D,T.toUnwrapped());let z=t;("road"===u&&!d||"offset"===u)&&(z=x),D.draw(o,C,z,i||o.stencilModeForClipping(T),c,nn.disabled,g,s.id,F.layoutVertexBuffer,E,S,s.paint,o.transform.zoom,k,O)}};o.renderPass===h&&C(o.depthModeForSublayer(1,"opaque"===o.renderPass?Jr.ReadWrite:Jr.ReadOnly),!1),"none"===g&&"translucent"===o.renderPass&&s.paint.get("fill-antialias")&&C(o.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Jr.ReadOnly),!0)}function Aa(t,r,n,i,o,a,s,l){n.resetLayerRenderingStats(t);const c=t.context,u=c.gl,d=t.transform,h=n.paint.get("fill-extrusion-pattern"),A=n.paint.get("fill-extrusion-pattern-cross-fade"),f=h.constantOr(null),p=h.constantOr(1),m=n.paint.get("fill-extrusion-opacity"),g=t.style.enable3dLights(),y=n.paint.get(g&&!p?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),_=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),y],v=n.layout.get("fill-extrusion-edge-radius"),x=v>0&&!n.paint.get("fill-extrusion-rounded-roof"),w=x?0:v,b="globe"===d.projection.name?e.eb():0,B="globe"===d.projection.name,C=B?e.aj(d.zoom):0,E=[e.aF(d.center.lng),e.aJ(d.center.lat)],S="none"===n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),T=n.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(S?null:n.lut).toArray01().slice(0,3),I=n.paint.get("fill-extrusion-flood-light-intensity"),F=n.paint.get("fill-extrusion-vertical-scale"),k=0!==n.paint.get("fill-extrusion-line-width").constantOr(1),P=n.paint.get("fill-extrusion-height-alignment"),M=n.paint.get("fill-extrusion-base-alignment"),O=fn(t,n.paint.get("fill-extrusion-cutoff-fade-range")),L=[];let D;B&&L.push("PROJECTION_GLOBE_VIEW"),_[0]>0&&L.push("FAUX_AO"),x&&L.push("ZERO_ROOF_RADIUS"),l&&L.push("HAS_CENTROID"),I>0&&L.push("FLOOD_LIGHT"),O.shouldRenderCutoff&&L.push("RENDER_CUTOFF"),k&&L.push("RENDER_WALL_MODE");const U="shadow"===t.renderPass,R=t.shadowRenderer,z=U&&!!R,N=U?nn.disabled:nn.backCCW;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let j=[0,0,0];if(R){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(j=xn(t.style,e,r)),U||(L.push("RENDER_SHADOWS","DEPTH_TEXTURE"),R.useNormalOffset&&L.push("NORMAL_OFFSET")),D=L.concat(["SHADOWS_SINGLE_CASCADE"])}const Q=z?"fillExtrusionDepth":p?"fillExtrusionPattern":"fillExtrusion",V=n.getLayerRenderingStats();for(const H of i){const i=r.getTile(H),h=i.getBucket(n);if(!h||h.projection.name!==d.projection.name)continue;let g=!1;R&&(g=0===R.getMaxCascadeForTile(H.toUnwrapped()));const y=t.isTileAffectedByFog(H),v=h.programConfigurations.get(n.id);let x=!1;if(f&&i.imageAtlas){const t=i.imageAtlas,r=e.e3.from(f),n=r.getPrimary().scaleSelf(e.o.devicePixelRatio).toString(),o=r.getSecondary(),a=t.patternPositions.get(n),s=o?t.patternPositions.get(o.scaleSelf(e.o.devicePixelRatio).toString()):null;x=!!a&&!!s,a&&v.setConstantPatternPositions(a,s)}A>0&&(x||v.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&L.push("FILL_EXTRUSION_PATTERN_TRANSITION");const S=t.getOrCreateProgram(Q,{config:v,defines:g?D:L,overrideFog:y});if(t.terrain&&t.terrain.setupElevationDraw(i,S,{useMeterToDem:!0}),!h.centroidVertexBuffer){const e=S.getAttributeLocation(u,"a_centroid_pos");-1!==e&&u.vertexAttrib2f(e,0,0)}!U&&R&&R.setupShadows(i.tileID.toUnwrapped(),S,"vector-tile"),p&&(t.context.activeTexture.set(u.TEXTURE0),i.imageAtlasTexture&&i.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),v.updatePaintBuffers());const z=n.paint.get("fill-extrusion-vertical-gradient"),G=1/h.tileToMeter;let K;if(U&&R){if(va(i.tileID,h.maxHeight,t))continue;const e=R.calculateShadowPassMatrixFromTile(i.tileID.toUnwrapped());K=_o(e,w,G,F,P,M)}else{const e=t.translatePosMatrix(H.expandedProjMatrix,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),r=d.projection.createInversionMatrix(d,H.canonical);K=p?vo(e,t,z,m,_,w,G,H,i,b,P,M,C,E,r,T,F,A):yo(e,t,z,m,_,w,G,H,b,P,M,C,E,r,T,F,I,j)}t.uploadCommonUniforms(c,S,H.toUnwrapped(),null,O);let W=h.segments;if("mercator"===d.projection.name&&!U&&(W=h.getVisibleSegments(i.tileID,t.terrain,t.transform.getFrustum(0)),!W.get().length))continue;if(V)if(U)for(const e of W.get())V.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of W.get())V.numRenderedVerticesInTransparentPass+=e.primitiveLength;const q=[];(t.terrain||l)&&q.push(h.centroidVertexBuffer),B&&q.push(h.layoutVertexExtBuffer),k&&q.push(h.wallVertexBuffer),S.draw(t,c.gl.TRIANGLES,o,a,s,N,K,n.id,h.layoutVertexBuffer,h.indexBuffer,W,n.paint,t.transform.zoom,v,q)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}class fa{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function pa(t,r,n,i,o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v){const x=r.context,w=x.gl,b=r.transform,B=r.transform.zoom,C=[],E=t.translate,S=t.translateAnchor,T=t.edgeRadius,I=fn(r,t.cutoffFadeRange);"clear"===d?(C.push("CLEAR_SUBPASS"),v&&(C.push("CLEAR_FROM_TEXTURE"),x.activeTexture.set(w.TEXTURE0),v.bind(w.LINEAR,w.CLAMP_TO_EDGE))):"sdf"===d?C.push("SDF_SUBPASS"):"emissive"===d&&(C.push("USE_MRT1"),x.activeTexture.set(w.TEXTURE0),v.bind(w.LINEAR,w.CLAMP_TO_EDGE)),y&&C.push("HAS_CENTROID"),I.shouldRenderCutoff&&C.push("RENDER_CUTOFF");const F=(e,t,n,o,d)=>{let _=C;null!=t.groundRadiusBuffer&&(_=C.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const w=t.programConfigurations.get(i.id),b=r.isTileAffectedByFog(e),E=r.getOrCreateProgram("fillExtrusionGroundEffect",{config:w,defines:_,overrideFog:b}),S=xo(r,o,h,u,d,[A,f*d],p,m,g,B>=17?0:T*d,v?v.size[0]:0),F=[];y&&F.push(t.hiddenByLandmarkVertexBuffer),null!=t.groundRadiusBuffer&&F.push(t.groundRadiusBuffer),r.uploadCommonUniforms(x,E,e.toUnwrapped(),null,I),E.draw(r,x.gl.TRIANGLES,a,s,l,c,S,i.id,t.vertexBuffer,t.indexBuffer,n,i.paint,B,w,F)};for(const k of o){const t=n.getTile(k),o=t.getBucket(i);if(!o||o.projection.name!==b.projection.name||!o.groundEffect||o.groundEffect&&!o.groundEffect.hasData())continue;const a=o.groundEffect,s=1/o.tileToMeter;{const e=r.translatePosMatrix(k.projMatrix,t,E,S),n=a.getDefaultSegment();F(k,a,n,e,s)}if(_)for(let l=0;l<4;l++){const o=e.e9[l](k),a=n.getTile(o);if(!a)continue;const c=a.getBucket(i);if(!c||c.projection.name!==b.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const u=c.groundEffect;let d,h;0===l?(d=[-e.al,0,0],h=1):1===l?(d=[e.al,0,0],h=0):2===l?(d=[0,-e.al,0],h=3):(d=[0,e.al,0],h=2);const A=u.regionSegments[h];if(!A)continue;const f=new Float32Array(16);e.br(f,k.projMatrix,d),F(k,u,A,r.translatePosMatrix(f,t,E,S),s)}}}function ma(t,r,n,i,o,a,s){0===i.centroidVertexArray.length&&i.createCentroidsBuffer();const l=a?a.findDEMTileFor(n):null;if(!(l&&l.dem||s))return;a&&l&&l.dem&&i.selfDEMTileTimestamp!==l.dem._timestamp&&(i.borderDoneWithNeighborZ=[-1,-1,-1,-1],i.selfDEMTileTimestamp=l.dem._timestamp);const c=t=>new e.P(Math.ceil((t+e.ed)*e.ee),0),u=e=>{const t=r.getSource().minzoom,n=e=>{const t=r.getTileByID(e);if(t&&t.hasData())return t.getBucket(o)},i=[0,-1,1];for(const r of i){if(e.overscaledZ+r<t)continue;const i=n(e.calculateScaledKey(e.overscaledZ+r));if(i)return i}},d=[0,0,0],h=(t,r)=>(d[0]=Math.min(t.min.y,r.min.y),d[1]=Math.max(t.max.y,r.max.y),d[2]=e.al-r.min.x>t.max.x?r.min.x-e.al:t.max.x,d),A=(t,r)=>(d[0]=Math.min(t.min.x,r.min.x),d[1]=Math.max(t.max.x,r.max.x),d[2]=e.al-r.min.y>t.max.y?r.min.y-e.al:t.max.y,d),f=[(e,t)=>h(e,t),(e,t)=>h(t,e),(e,t)=>A(e,t),(e,t)=>A(t,e)],p=(t,r,i,o,s,c,u)=>{if(!a)return 0;const d=[[c?i:t,c?t:i,0],[c?i:r,c?r:i,0]],h=u<0?e.al+u:u,A=[c?h:(t+r)/2,c?(t+r)/2:h,0];return 0===i&&u<0||0!==i&&u>0?a.getForTilePoints(s,[A],!0,o):d.push(A),a.getForTilePoints(n,d,!0,l),Math.max(d[0][2],d[1][2],A[2])/a.exaggeration()};for(let y=0;y<4;y++){const t=i.borderFeatureIndices[y];if(0===t.length)continue;const r=e.e9[y](n),o=u(r);if(!(o&&o instanceof e.ea))continue;const l=a?a.findDEMTileFor(r):null;if(!(l&&l.dem||s))continue;if(a&&l&&l.dem&&i.borderDEMTileTimestamp[y]!==l.dem._timestamp&&(i.borderDoneWithNeighborZ[y]=-1,i.borderDEMTileTimestamp[y]=l.dem._timestamp),i.borderDoneWithNeighborZ[y]===o.canonical.z)continue;0===o.centroidVertexArray.length&&o.createCentroidsBuffer();const d=(y<2?1:5)-y,h=o.borderDoneWithNeighborZ[d]!==i.canonical.z,A=o.borderFeatureIndices[d];let _=0;if(i.canonical.z!==o.canonical.z){for(const e of t)i.showCentroid(i.featuresOnBorder[e]);if(h)for(const e of A)o.showCentroid(o.featuresOnBorder[e]);i.borderDoneWithNeighborZ[y]=o.canonical.z,o.borderDoneWithNeighborZ[d]=i.canonical.z}for(const n of t){const t=i.featuresOnBorder[n],a=i.centroidData[t.centroidDataIndex],u=t.borders[y];let h;for(;_<A.length;){h=o.featuresOnBorder[A[_]];const e=h.borders[d];if(e[1]>u[0]+3||e[0]>u[0]-3)break;o.showCentroid(h),_++}if(h&&_<A.length){const n=_;let v=0;for(;!(h.borders[d][0]>u[1]-3)&&(v++,++_!==A.length);)h=o.featuresOnBorder[A[_]];h=o.featuresOnBorder[A[n]];let x=!1;if(v>=1){const e=h.borders[d];Math.abs(u[0]-e[0])<3&&Math.abs(u[1]-e[1])<3&&(v=1,x=!0,_=n+1)}else if(0===v){i.showCentroid(t);continue}const w=o.centroidData[h.centroidDataIndex];s&&x&&(((m=a).flags|(g=w).flags)&e.ec?(m.flags|=e.ec,g.flags|=e.ec):(m.flags&=~e.ec,g.flags&=~e.ec));const b=t.intersectsCount()>1||h.intersectsCount()>1;if(v>1)_=n,a.centroidXY=w.centroidXY=new e.P(0,0);else if(l&&l.dem&&!b){const t=f[y](a,w),n=y%2?e.al-1:0,i=p(t[0],Math.min(e.al-1,t[1]),n,l,r,y<2,t[2]);a.centroidXY=w.centroidXY=c(i)}else b?a.centroidXY=w.centroidXY=new e.P(0,0):(a.centroidXY=i.encodeBorderCentroid(t),w.centroidXY=o.encodeBorderCentroid(h));i.writeCentroidToBuffer(a),o.writeCentroidToBuffer(w)}else i.showCentroid(t)}i.borderDoneWithNeighborZ[y]=o.canonical.z,o.borderDoneWithNeighborZ[d]=i.canonical.z}var m,g;(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(t)}const ga=[1,0,0],ya=[0,1,0],_a=[0,0,1];function va(t,r,n){const i=n.transform,o=n.shadowRenderer;if(!o)return!0;const a=t.toUnwrapped(),s=i.tileSize*o._cascades[n.currentShadowCascade].scale;let l=r;if(i.elevation){const e=i.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...o.shadowDirection];c[2]=-c[2];const u=o.computeSimplifiedTileShadowVolume(a,l,s,c);if(!u)return!1;const d=[ga,ya,_a,c,[c[0],0,c[2]],[0,c[1],c[2]]],h="globe"===i.projection.name,A=i.scaleZoom(s),f=e.cB.fromInvProjectionMatrix(i.invProjMatrix,i.worldSize,A,!h),p=o.getCurrentCascadeFrustum();return 0===f.intersectsPrecise(u.vertices,u.planes,d)||0===p.intersectsPrecise(u.vertices,u.planes,d)}function xa(t){const{painter:r,source:n,layer:i,coords:o}=t;let a=t.defines;const s=r.context,l="shadow"===r.renderPass,c="light-beam"===r.renderPass,u=r.shadowRenderer,d=e.ef(r.transform.center.lat,r.transform.zoom),h=fn(r,i.paint.get("building-cutoff-fade-range"));h.shouldRenderCutoff&&(a=a.concat("RENDER_CUTOFF")),t.floodLightIntensity>0&&(a=a.concat("FLOOD_LIGHT"));for(const A of o){const o=n.getTile(A),f=o.getBucket(i);if(!f)continue;u&&0===u.getMaxCascadeForTile(A.toUnwrapped())&&(a=a.concat("SHADOWS_SINGLE_CASCADE"));const p=f.programConfigurations.get(i.id);let m,g,y,_=r.translatePosMatrix(A.expandedProjMatrix,o,[0,0],"map");if(_=e.cS(e.bC(),_,[1,1,t.verticalScale]),l&&u){if(va(o.tileID,f.maxHeight*d,r))continue;let n=u.calculateShadowPassMatrixFromTile(o.tileID.toUnwrapped());n=e.cS(e.bC(),n,[1,1,t.verticalScale]),y=Fo(n),m=g=r.getOrCreateProgram("buildingDepth",{config:p,defines:a,overrideFog:!1})}else if(c)m=g=r.getOrCreateProgram("buildingBloom",{config:p,defines:a,overrideFog:!1}),y=Io(_);else{const n=r.transform.calculatePosMatrix(A.toUnwrapped(),r.transform.worldSize);e.cS(n,n,[1,1,t.verticalScale]);const i=e.bC();e.cS(i,n,[1,-1,1/d]),e.bl(i,i),e.eg(i,i);const o=r.transform.getFreeCameraOptions().position,s=1<<A.canonical.z;if(y=To(_,i,t.opacity,t.facadeAOIntensity,[((o.x-A.wrap)*s-A.canonical.x)*e.al,(o.y*s-A.canonical.y)*e.al,o.z*s*e.al],f.tileToMeter,t.facadeEmissiveChance,t.floodLightColor,t.floodLightIntensity),g=r.getOrCreateProgram("building",{config:p,defines:a,overrideFog:!1}),!0===t.depthOnly)m=g;else{const e=a.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);m=r.getOrCreateProgram("building",{config:p,defines:e,overrideFog:!1})}u&&(u.setupShadowsFromMatrix(n,g,!0),m!==g&&u.setupShadowsFromMatrix(n,m,!0))}const v=(e,n)=>{if(c){const o=e.entranceBloom;n.draw(r,s.gl.TRIANGLES,t.depthMode,en.disabled,t.blendMode,nn.disabled,y,i.id,o.layoutVertexBuffer,o.indexBuffer,o.segmentsBucket,i.paint,r.transform.zoom,p,[o.layoutAttenuationBuffer,o.layoutColorBuffer])}else{const o=e.segmentsBucket;let a=[e.layoutNormalBuffer,e.layoutCentroidBuffer,e.layoutColorBuffer,e.layoutFloodLightDataBuffer];e.layoutFacadePaintBuffer&&(a=a.concat([e.layoutFacadeDataBuffer,e.layoutFacadeVerticalRangeBuffer,e.layoutFacadePaintBuffer])),n.draw(r,s.gl.TRIANGLES,t.depthMode,en.disabled,t.blendMode,l?nn.disabled:nn.backCW,y,i.id,e.layoutVertexBuffer,e.indexBuffer,o,i.paint,r.transform.zoom,p,a)}};r.uploadCommonUniforms(s,g,A.toUnwrapped(),null,h),f.buildingWithoutFacade&&v(f.buildingWithoutFacade,g),f.buildingWithFacade&&(m!==g&&r.uploadCommonUniforms(s,m,A.toUnwrapped(),null,h),v(f.buildingWithFacade,m))}}function wa(t,r,n,i,o,a,s,l,c,u,d,h,A){const f=t.context.gl,p=t.depthModeForSublayer(1,Jr.ReadOnly,f.LEQUAL,!0),m=.1*(1-(g=d))+3*g;var g;const y=t._showOverdrawInspector,_=h,v=new fa;y||pa(v,t,r,n,i,p,new en({func:f.ALWAYS,mask:255},255,255,f.KEEP,f.KEEP,f.REPLACE),new Yr([f.ONE,f.ONE,f.ONE,f.ONE],e.ao.transparent,[!1,!1,!1,!0],f.MIN),nn.disabled,o,"sdf",a,s,l,c,u,m,_,!1);{const d=y?en.disabled:new en({func:f.EQUAL,mask:255},255,255,f.KEEP,f.DECR,f.DECR),h=y?t.colorModeForRenderPass():new Yr([f.ONE_MINUS_DST_ALPHA,f.DST_ALPHA,f.ONE,f.ONE],e.ao.transparent,[!0,!0,!0,!0]);pa(v,t,r,n,i,p,d,h,nn.disabled,o,"color",a,s,l,c,u,m,_,!1)}}function ba(t){return[t[0]*e.eh,t[1]*e.eh,t[2]*e.eh,0]}function Ba(t,r,n,i,o,a,s,l,c){const u=i.getSource(),d=n.globeSharedBuffers;if(!d)return;let h,A,f;if(r&&(h=i.getTile(r)),u instanceof e.aU?(A=u.texture,f=e.dK(0,0,n.transform)):h&&r&&(A=h.texture,f=e.dK(r.canonical.z,r.canonical.x,n.transform)),!A||!f)return;t||(f=e.cS(e.bC(),f,[1,-1,1]));const p=n.context,m=p.gl,g="nearest"===o.paint.get("raster-resampling")?m.NEAREST:m.LINEAR,y=n.colorModeForDrapableLayerRenderPass(a),_=s.defines;_.push("GLOBE_POLES");const v=new Jr(m.LEQUAL,Jr.ReadWrite,n.depthRangeFor3D),x=Float32Array.from(n.transform.expandedFarZProjMatrix),w=Float32Array.from(e.bk(e.dJ(new e.cD(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),p.activeTexture.set(m.TEXTURE0),A.bind(g,m.CLAMP_TO_EDGE),p.activeTexture.set(m.TEXTURE1),A.bind(g,m.CLAMP_TO_EDGE),"useMipmap"in A&&p.extTextureFilterAnisotropic&&n.transform.pitch>20&&m.texParameterf(m.TEXTURE_2D,p.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,p.extTextureFilterAnisotropicMax);const[b,B,C,E]=r?d.getPoleBuffers(r.canonical.z,!1):d.getPoleBuffers(0,!0),S=o.paint.get("raster-elevation");let T;t?(T=b,n.renderDefaultNorthPole=0!==S):(T=B,n.renderDefaultSouthPole=0!==S);const I=ba(s.mix),F=((e,t,r,n,i,o,a,s,l,c,u,d,h)=>Uo(e,t,r,new Float32Array(16),new Float32Array(9),[0,0],n,[0,0],[0,0,0,0],1,{opacity:1,mix:0},o,[0,0]||0,s,2,c,u,d,1,0,h))(x,w,f,e.aj(n.transform.zoom),0,o,0,S,0,I,s.offset,s.range,a),k=n.getOrCreateProgram("raster",{defines:_});n.uploadCommonUniforms(p,k,null),k.draw(n,m.TRIANGLES,v,c,y,l,F,o.id,T,C,E)}function Ca(e){const t=e._nearZ,r=e.projection.farthestPixelDistance(e),n=r-t,i=.2*e.height,o=t+i;return[t,r,(o-i-t)/n,(o-t)/n]}function Ea(e,t,r,n){if(e)return t instanceof gt&&e instanceof Dt?t.getTextureDescriptor(e,r,!0):{texture:e.texture,mix:ba(n.mix),offset:n.offset,buffer:0,tileSize:1}}var Sa=e.ei([{name:"a_index",type:"Int16",components:1}]);class Ta{constructor(t,r,n,i){const o={width:n[0],height:n[1],data:null},a=t.gl;this.targetColorTexture=new e.T(t,o,a.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,o,a.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,i),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const n=this.context.gl,i=r.width*r.height;this.particleTexture0=new e.T(this.context,r,n.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,r,n.RGBA8,{premultiply:!1,useMipmap:!1});const o=new e.ej;o.reserve(i);for(let e=0;e<i;e++)o.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(o,Sa.members,!0),this.particleSegment=e.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Ia(t,r,n){if(!t)return null;const i=r.getTextureDescriptor(t,n,!0);if(!i)return null;let{texture:o,mix:a,offset:s,tileSize:l,buffer:c,format:u}=i;if(!o||!u)return null;let d=!1;return"uint32"===u&&(d=!0,a[3]=0,a=Lo(e.ek,a,[0,n.paint.get("raster-particle-max-speed")]),s=Do(e.ek,s,[0,n.paint.get("raster-particle-max-speed")])),{texture:o,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:d,scale:a,offset:s,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function Fa(e){const t=e._nearZ,r=e.projection.farthestPixelDistance(e),n=r-t,i=.2*e.height,o=t+i;return[t,r,(o-i-t)/n,(o-t)/n]}const ka=new e.ao(1,0,0,1),Pa=new e.ao(0,1,0,1),Ma=new e.ao(0,0,1,1),Oa=new e.ao(1,0,1,1),La=new e.ao(0,1,1,1);function Da(t,r,n,i,o,a){for(let s=0;s<n.length;s++)if(o){const o=1,l=.8,c=new e.ao(i.r*l,i.g*l,i.b*l,1);Ua(t,r,n[s],i,-o,-o,a),Ua(t,r,n[s],i,-o,o,a),Ua(t,r,n[s],i,o,o,a),Ua(t,r,n[s],i,o,-o,a),Ua(t,r,n[s],c,0,0,a)}else Ua(t,r,n[s],i,0,0,a)}function Ua(t,r,n,i,o,a,s){const l=t.context,c=t.transform,u=l.gl,d="globe"===c.projection.name,h=d?["PROJECTION_GLOBE_VIEW"]:[];let A=e.bz(n.projMatrix);if(d&&e.aj(c.zoom)>0){const t=e.bj(n.canonical,c),r=e.el(t);A=e.aB(new Float32Array(16),c.globeMatrix,r),e.aB(A,c.projMatrix,A)}const f=e.bC();f[12]+=2*o/(e.o.devicePixelRatio*c.width),f[13]+=2*a/(e.o.devicePixelRatio*c.height),e.aB(A,f,A);const p=t.getOrCreateProgram("debug",{defines:h}),m=r.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(m,p);const g=Jr.disabled,y=en.disabled,_=t.colorModeForRenderPass(),v="$debug";l.activeTexture.set(u.TEXTURE0),t.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),d?m._makeGlobeTileDebugBuffers(t.context,c):m._makeDebugTileBoundsBuffers(t.context,c.projection);const x=m._tileDebugBuffer||t.debugBuffer,w=m._tileDebugIndexBuffer||t.debugIndexBuffer,b=m._tileDebugSegments||t.debugSegments;if(p.draw(t,u.LINE_STRIP,g,y,_,nn.disabled,Po(A,i.toPremultipliedRenderColor(null)),v,x,w,b,null,null,null,[m._globeTileDebugBorderBuffer]),s){const e=m.latestRawTileData,r=Math.floor((e&&e.byteLength||0)/1024);let i=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(i+=" => ".concat(n.overscaledZ)),i+=" ".concat(m.state),i+=" ".concat(r,"kb"),function(e,t){e.initDebugOverlayCanvas();const r=e.debugOverlayCanvas,n=e.context.gl,i=e.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,r.width,r.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(r),e.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(t,i)}const B=r.getTile(n).tileSize,C=512/Math.min(B,512)*(n.overscaledZ/c.zoom)*.5,E=m._tileDebugTextBuffer||t.debugBuffer,S=m._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,T=m._tileDebugTextSegments||t.debugSegments;p.draw(t,u.TRIANGLES,g,y,Yr.alphaBlended,nn.disabled,Po(A,e.ao.transparent.toPremultipliedRenderColor(null),C),v,E,S,T,null,null,null,[m._globeTileDebugTextBuffer])}function Ra(e,t,r,n){Na(e,0,t+r/2,e.transform.width,r,n)}function za(e,t,r,n){Na(e,t-r/2,0,r,e.transform.height,n)}function Na(t,r,n,i,o,a){const s=t.context,l=s.gl;l.enable(l.SCISSOR_TEST),l.scissor(r*e.o.devicePixelRatio,n*e.o.devicePixelRatio,i*e.o.devicePixelRatio,o*e.o.devicePixelRatio),s.clear({color:a}),l.disable(l.SCISSOR_TEST)}const ja=e.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Qa}=ja;function Va(e,t,r,n){e.emplaceBack(t,r,n)}class Ha{constructor(t){this.vertexArray=new e.em,this.indices=new e.b0,Va(this.vertexArray,-1,-1,1),Va(this.vertexArray,1,-1,1),Va(this.vertexArray,-1,1,1),Va(this.vertexArray,1,1,1),Va(this.vertexArray,-1,-1,-1),Va(this.vertexArray,1,-1,-1),Va(this.vertexArray,-1,1,-1),Va(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Qa),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.bg.simpleSegment(0,0,36,12)}}function Ga(t,r,n,i,o,a){const s=t.context.gl,l=r.paint.get("sky-atmosphere-color"),c=r.paint.get("sky-atmosphere-halo-color"),u=r.paint.get("sky-atmosphere-sun-intensity"),d=((e,t,r,n,i)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:r,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[i.r,i.g,i.b,i.a],u_luminance:5e-5}))(e.eo(e.dO(),i),o,u,l.toPremultipliedRenderColor(null),c.toPremultipliedRenderColor(null));s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_CUBE_MAP_POSITIVE_X+a,r.skyboxTexture,0),n.draw(t,s.TRIANGLES,Jr.disabled,en.disabled,Yr.unblended,nn.frontCW,d,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Ka=e.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Wa{constructor(t){const r=new e.ep;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const n=new e.b0;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,Ka.members),this.indexBuffer=t.createIndexBuffer(n),this.segments=e.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const qa=e.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Za{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Xa{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Yr([1,Xr,1,Xr],e.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Yr([1,0,1,0],e.ao.transparent,[!1,!1,!1,!0]),this.params=new Za,this.updateNeeded=!0}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Wa(r);const t=this.params.sizeRange,n=this.params.intensityRange,i=function(t){const r=e.eq(30),n=[];for(let i=0;i<t;++i){const t=2*Math.PI*r(),i=Math.acos(1-2*r())-.5*Math.PI;n.push(e.d5(Math.cos(i)*Math.cos(t),Math.cos(i)*Math.sin(t),Math.sin(i)))}return n}(this.params.starsCount),o=e.eq(300),a=new e.er,s=new e.b0;let l=0;for(let r=0;r<i.length;++r){const c=e.c5([],i[r],200),u=Math.max(0,1+.01*t*(1*o()-.5)),d=Math.max(0,1+.01*n*(1*o()-.5));a.emplaceBack(c[0],c[1],c[2],-1,-1,u,d),a.emplaceBack(c[0],c[1],c[2],1,-1,u,d),a.emplaceBack(c[0],c[1],c[2],1,1,u,d),a.emplaceBack(c[0],c[1],c[2],-1,1,u,d),s.emplaceBack(l+0,l+1,l+2),s.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=r.createVertexBuffer(a,qa.members),this.starsIdx=r.createIndexBuffer(s),this.starsSegments=e.bg.simpleSegment(0,0,a.length,s.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const n=t.context,i=n.gl,o=t.transform,a=new Jr(i.LEQUAL,Jr.ReadOnly,[0,1]),s=e.aj(o.zoom),l=t.style.getLut(r.scope),c="none"===r.properties.get("color-use-theme"),u=r.properties.get("color").toNonPremultipliedRenderColor(c?null:l),d="none"===r.properties.get("high-color-use-theme"),h=r.properties.get("high-color").toNonPremultipliedRenderColor(d?null:l),A="none"===r.properties.get("space-color-use-theme"),f=r.properties.get("space-color").toNonPremultipliedRenderColor(A?null:l),p=5e-4,m=e.es(r.properties.get("horizon-blend"),0,1,p,.25),g=e.dE(t,n,o)&&m===p?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,y=t.frameCounter/1e3%1,_=e.ag(o.globeCenterInViewSpace),v=Math.sqrt(Math.pow(_,2)-Math.pow(g,2)),x=Math.acos(v/_),w=e=>{const r="globe"===o.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&r.push("ALPHA_PASS");const l=t.getOrCreateProgram("globeAtmosphere",{defines:r}),c=((e,t,r,n,i,o,a,s,l,c,u,d)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:r,u_frustum_bl:n,u_horizon:i,u_transition:o,u_fadeout_range:a,u_atmosphere_fog_color:s.toArray01(),u_high_color:l.toArray01(),u_space_color:c.toArray01(),u_temporal_offset:u,u_horizon_angle:d}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,s,m,u,h,f,y,x);t.uploadCommonUniforms(n,l);const d=this.atmosphereBuffer;d&&l.draw(t,i.TRIANGLES,a,en.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,nn.backCW,c,e?"atmosphere_glow_alpha":"atmosphere_glow",d.vertexBuffer,d.indexBuffer,d.segments)};w(!1),w(!0)}drawStars(t,r){const n=e.aA(r.properties.get("star-intensity"),0,1);if(0===n)return;const i=t.context,o=i.gl,a=t.transform,s=t.getOrCreateProgram("stars"),l=e.c7([]);e.c9(l,l,-a._pitch),e.c8(l,l,-a.angle),e.c9(l,l,e.an(a._center.lat)),e.et(l,l,-e.an(a._center.lng));const c=e.cc(new Float32Array(16),l),u=e.aB([],a.starsProjMatrix,c),d=e.eo([],c),h=e.eu([],d),A=[0,1,0];e.dQ(A,A,h),e.c5(A,A,this.params.sizeMultiplier);const f=[1,0,0];e.dQ(f,f,h),e.c5(f,f,this.params.sizeMultiplier);const p=(m=A,g=f,y=n,{u_matrix:Float32Array.from(u),u_up:m,u_right:g,u_intensity_multiplier:y});var m,g,y;t.uploadCommonUniforms(i,s),this.starsVx&&this.starsIdx&&s.draw(t,o.TRIANGLES,Jr.disabled,en.disabled,this.colorModeAlphaBlendedWriteRGB,nn.disabled,p,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Ya{constructor(){this.visibleTiles=[]}updateBorders(t,r){const n=[],i=[],o=t._getRenderableCoordinates(!1,!0);for(const e of o){const o=t.getTile(e);if(!o.hasData())continue;const a=o.getBucket(r);a&&(a.isEmpty()||(n.push(e.key),i.push({bucket:a,tileID:e.canonical})))}let a=n.length!==this.visibleTiles.length;if(!a){n.sort();for(let e=0;e<n.length;e++)if(n[e]!==this.visibleTiles[e]){a=!0;break}}if(!a)return;const s=new Set;this.visibleTiles=n,i.sort((e,t)=>e.tileID.z-t.tileID.z||e.tileID.x-t.tileID.x||e.tileID.y-t.tileID.y);for(const l of i){const t=new Array,r=new Array,n=l.bucket;for(const e of n.featuresOnBorder)s.has(e.featureId)?r.push(e.footprintIndex):(s.add(e.featureId),t.push(e.footprintIndex));n.updateFootprintHiddenFlags(t,e.ev,!1),n.updateFootprintHiddenFlags(r,e.ev,!0)}}}function Ja(t,r){const n=[...t],i=r.cameraWorldSizeForFog/r.worldSize,o=e.bA([]);return e.cS(o,o,[i,i,1]),e.aB(n,o,n),e.aB(n,r.worldToFogMatrix,n),n}function $a(t,r,n,i,o){const a=n.material,s=i.context,{baseColorTexture:l,metallicRoughnessTexture:c}=a.pbrMetallicRoughness,{normalTexture:u,occlusionTexture:d,emissionTexture:h}=a;function A(e,r,n){if(e&&(t.push(r),s.activeTexture.set(s.gl.TEXTURE0+n),e.gfxTexture)){const{minFilter:t,magFilter:r,wrapS:n,wrapT:i}=e.sampler;e.gfxTexture.bindExtraParam(t,r,n,i)}}A(l,"HAS_TEXTURE_u_baseColorTexture",un.BaseColor),A(c,"HAS_TEXTURE_u_metallicRoughnessTexture",un.MetallicRoughness),A(u,"HAS_TEXTURE_u_normalTexture",un.Normal),A(d,"HAS_TEXTURE_u_occlusionTexture",un.Occlusion),A(h,"HAS_TEXTURE_u_emissionTexture",un.Emission),o&&(o.texture||(o.texture=new e.d$(i.context,o.image,[o.image.height,o.image.height,o.image.height],s.gl.RGBA8)),s.activeTexture.set(s.gl.TEXTURE0+un.LUT),o.texture&&o.texture.bind(s.gl.LINEAR,s.gl.CLAMP_TO_EDGE),t.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(n.texcoordBuffer)),n.colorBuffer&&(t.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(n.colorBuffer)),n.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(n.normalBuffer)),n.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(n.pbrBuffer)),"OPAQUE"!==a.alphaMode&&"MASK"!==a.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),a.defined||t.push("DIFFUSE_SHADED");const f=i.shadowRenderer;f&&(t.push("RENDER_SHADOWS","DEPTH_TEXTURE"),f.useNormalOffset&&t.push("NORMAL_OFFSET"))}function es(t,r,n,i,o,a){const s=t.modelOpacity,l=r.context,c=new Jr(r.context.gl.LEQUAL,t.isLightMesh?Jr.ReadOnly:Jr.ReadWrite,r.depthRangeFor3D),u=r.transform,d=t.mesh,h=d.material,A=h.pbrMetallicRoughness,f=r.style.fog;let p;p="pixels"===r.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.aB([],i.zScaleMatrix,t.nodeModelMatrix),e.aB(p,i.negCameraPosMatrix,p);const m=e.bl([],p);e.eg(m,m);const g="none"===n.paint.get("model-color-use-theme").constantOr("default"),y=n.paint.get("model-emissive-strength").constantOr(0),_=qo(new Float32Array(t.worldViewProjection),new Float32Array(p),new Float32Array(m),null,r,s,A.baseColorFactor,h.emissiveFactor,A.metallicFactor,A.roughnessFactor,h,y,n,void 0,void 0,t.materialOverride,t.modelColor),v={defines:[]},x=[],w=r.shadowRenderer;w&&(w.useNormalOffset=!1),$a(v.defines,x,d,r,g?null:n.lut);let b=null;if(f){const e=Ja(t.nodeModelMatrix,r.transform);if(b=new Float32Array(e),"globe"!==u.projection.name){const t=d.aabb.min,r=d.aabb.max,[n,i]=f.getOpacityForBounds(e,t[0],t[1],r[0],r[1]);v.overrideFog=n>=We||i>=We}}const B=fn(r,n.paint.get("model-cutoff-fade-range"));B.shouldRenderCutoff&&v.defines.push("RENDER_CUTOFF");const C=r.getOrCreateProgram("model",v);r.uploadCommonUniforms(l,C,null,b,B),"shadow"!==r.renderPass&&w&&w.setupShadowsFromMatrix(t.nodeModelMatrix,C),C.draw(r,l.gl.TRIANGLES,c,o,a,d.material.doubleSided?nn.disabled:nn.backCCW,_,n.id,d.vertexBuffer,d.indexBuffer,d.segments,n.paint,r.transform.zoom,void 0,x)}function ts(e,t){return e.style._importedAsBasemap?"basemap":t.scope}function rs(t,r,n,i,o,a,s,l,c,u){const d=t.transform,h=!!r.isGeometryBloom&&r.isGeometryBloom;if(h&&"shadow"===t.renderPass)return;const A="globe"===d.projection.name?e.eD(n,d):[...n];e.aB(A,A,r.globalMatrix);const f=e.aB([],i,A);if(r.meshes)for(const p of r.meshes){const t=l.get(p.material.name);if(t&&t.opacity<=0)continue;if("BLEND"!==p.material.alphaMode){s.push({mesh:p,depth:0,modelIndex:o,worldViewProjection:f,nodeModelMatrix:A,isLightMesh:h,materialOverride:t,modelOpacity:c,modelColor:u});continue}const r=e.af([],p.centroid,f);!d.isOrthographic&&r[2]<=0||a.push({mesh:p,depth:r[2],modelIndex:o,worldViewProjection:f,nodeModelMatrix:A,isLightMesh:h,materialOverride:t,modelOpacity:c,modelColor:u})}if(r.children)for(const e of r.children)rs(t,e,n,i,o,a,s,l,c,u)}function ns(e,t,r,n){const i=r.shadowRenderer;if(!i)return;const o=i.getShadowPassDepthMode(),a=i.getShadowPassColorMode(),s=i.calculateShadowPassMatrixFromMatrix(t),l=Zo(s);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,o,en.disabled,a,nn.disabled,l,n.id,e.vertexBuffer,e.indexBuffer,e.segments,n.paint,r.transform.zoom,void 0,void 0)}function is(e,t,r,n,i,o){for(const a of i){const i=Object.assign({},n);i.part=a;const s={type:"Unknown",id:t,properties:i},l={orientation:e.paint.get("model-rotation").evaluate(s,r)};o.set(a,l)}}function os(e,t,r,n,i,o){for(const a of i){const i=Object.assign({},n);i.part=a;const s={type:"Unknown",id:t,properties:i},l={color:e.paint.get("model-color").evaluate(s,r),colorMix:e.paint.get("model-color-mix-intensity").evaluate(s,r),opacity:e.paint.get("model-opacity").evaluate(s,r),emissionStrength:e.paint.get("model-emissive-strength").evaluate(s,r)};o.set(a,l)}}function as(e,t,r,n,i){let o=!1;for(const s of n)1!==s.modelOpacity&&(es(s,e,t,i[s.modelIndex],en.disabled,Yr.disabled),o=!0);for(const s of n)es(s,e,t,i[s.modelIndex],1!==s.modelOpacity?e.stencilModeFor3D():en.disabled,e.colorModeForRenderPass());o&&e.resetStencilClippingMasks();const a=Yr.additive;for(const s of r)es(s,e,t,i[s.modelIndex],en.disabled,s.isLightMesh?a:e.colorModeForRenderPass())}function ss(t,r,n){const i=r.updateZoomBasedPaintProperties(),o=function(t,r,n){let i,o,a,s=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&s>0){const r=t.terrain,o=r.findDEMTileFor(n);o&&o.dem?i=e.eF.create(r,n,o):s=0}if(0===s&&(r.terrainElevationMin=0,r.terrainElevationMax=0),s===r.validForExaggeration&&(0===s||i&&i._demTile&&i._demTile.tileID===r.validForDEMTile.id&&i._dem._timestamp===r.validForDEMTile.timestamp))return!1;for(const e in r.instancesPerModel){const t=r.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const n=(i?s*i.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=n,o=o?Math.min(r.terrainElevationMin,n):n,a=a?Math.max(r.terrainElevationMax,n):n}}return r.terrainElevationMin=o||0,r.terrainElevationMax=a||0,r.validForExaggeration=s,r.validForDEMTile=i&&i._demTile?{id:i._demTile.tileID,timestamp:i._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,r,n);(i||o)&&(r.uploaded=!1,r.upload(t.context))}const ls={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.d9([0,0,0],[e.al,e.al,0])};function cs(t,r){const n=1<<t.canonical.z,i=r.getFreeCameraOptions().position,o=r.elevation,a=t.canonical.x/n,s=(t.canonical.x+1)/n,l=t.canonical.y/n,c=(t.canonical.y+1)/n;let u=r._centerAltitude;if(o){const e=o.getMinMaxForTile(t);e&&e.max>u&&(u=e.max)}const d=e.aA(i.x,a,s)-i.x,h=e.aA(i.y,l,c)-i.y,A=e.cf(u,r.center.lat)-i.z;return r._zoomFromMercatorZ(Math.sqrt(d*d+h*h+A*A))}function us(e,t,r,n,i,o,a){const s=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new Jr(s.gl.LEQUAL,Jr.ReadWrite,e.depthRangeFor3D),d=e.isTileAffectedByFog(o),h="globe"===e.transform.projection.name;if(r.meshes)for(const A of r.meshes){const f=h?[]:["MODEL_POSITION_ON_GPU"],p=[];let m,g,y;const _=!h&&n.instancedDataArray.length>20;_&&f.push("INSTANCED_ARRAYS");const v=fn(e,t.paint.get("model-cutoff-fade-range"));if(v.shouldRenderCutoff&&f.push("RENDER_CUTOFF"),l&&c)m=e.getOrCreateProgram("modelDepth",{defines:f}),g=Zo(a.shadowTileMatrix,a.shadowTileMatrix,Float32Array.from(r.globalMatrix)),y=c.getShadowPassColorMode();else{$a(f,p,A,e,"none"===t.paint.get("model-color-use-theme").constantOr("default")?null:t.lut),m=e.getOrCreateProgram("model",{defines:f,overrideFog:d});const n=A.material,l=n.pbrMetallicRoughness,u=t.paint.get("model-opacity").constantOr(1),h=t.paint.get("model-emissive-strength").constantOr(0);g=qo(o.expandedProjMatrix,Float32Array.from(r.globalMatrix),new Float32Array(16),null,e,u,l.baseColorFactor,n.emissiveFactor,l.metallicFactor,l.roughnessFactor,n,h,t,i),c&&(a.shadowUniformsInitialized?m.setShadowUniformValues(s,c.getShadowUniformValues()):(c.setupShadows(o.toUnwrapped(),m,"model-tile"),a.shadowUniformsInitialized=!0)),y=v.shouldRenderCutoff||u<1||"OPAQUE"!==n.alphaMode?Yr.alphaBlended:Yr.unblended}e.uploadCommonUniforms(s,m,o.toUnwrapped(),null,v);const x=A.material.doubleSided?nn.disabled:nn.backCCW;if(_)p.push(n.instancedDataBuffer),m.draw(e,s.gl.TRIANGLES,u,en.disabled,y,x,g,t.id,A.vertexBuffer,A.indexBuffer,A.segments,t.paint,e.transform.zoom,void 0,p,n.instancedDataArray.length);else{const r=l?"u_instance":"u_normal_matrix";for(let i=0;i<n.instancedDataArray.length;++i)g[r]=new Float32Array(n.instancedDataArray.arrayBuffer,64*i,16),m.draw(e,s.gl.TRIANGLES,u,en.disabled,y,x,g,t.id,A.vertexBuffer,A.indexBuffer,A.segments,t.paint,e.transform.zoom,void 0,p)}}if(r.children)for(const A of r.children)us(e,t,A,n,i,o,a)}const ds=[1,-1,1];function hs(t,r,n,i){if(!n.modelManager)return!0;const o=n.modelManager;if(!n.shadowRenderer)return!0;const a=n.shadowRenderer,s=r.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const r in t.instancesPerModel){const t=o.getModel(r,i);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}s.max[2]=c,s.min[2]+=t.terrainElevationMin,s.max[2]+=t.terrainElevationMax,e.af(s.min,s.min,r.tileMatrix),e.af(s.max,s.max,r.tileMatrix);const u=s.intersects(a.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===u),0===u}function As(t,r){const n=t.uniformValues.u_cutoff_params[0],i=t.uniformValues.u_cutoff_params[1],o=t.uniformValues.u_cutoff_params[2],a=t.uniformValues.u_cutoff_params[3];return i===n||a===o?1:e.aA(((r-n)/(i-n)-o)/(a-o),0,1)}function fs(t,r,n,i){if(r.pitch<20)return 1;const o=r.getWorldToCameraMatrix();e.aB(o,o,t);const a=e.bU(n.min[0],n.min[1],n.min[2],1);let s=e.aC(e.eG(),a,o),l=s,c=s;a[1]=n.max[1],s=e.aC(e.eG(),a,o),l=s[1]<l[1]?s:l,c=s[1]>c[1]?s:c,a[0]=n.max[0],s=e.aC(e.eG(),a,o),l=s[1]<l[1]?s:l,c=s[1]>c[1]?s:c,a[1]=n.min[1],s=e.aC(e.eG(),a,o),l=s[1]<l[1]?s:l,c=s[1]>c[1]?s:c;const u=e.aA(i[0],0,1),d=100*r.pixelsPerMeter*e.aA(i[1],0,1),h=e.aA(i[2],0,1),A=e.eH(e.eG(),l,c,u),f=Math.tan(.5*r.fovX),p=-A[2]*f;if(0===d)return A[1]<-Math.abs(p)?h:1;const m=(-Math.abs(p)-A[1])/d,g=(e,t,r)=>(1-r)*e+r*t,y=e.aA(g(1,h,m),h,1);return g(1,y,e.aA((r.pitch-20)/20,0,1))}class ps{}class ms{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,n){{const e=this._storage.get(r.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const i=n.gl,o=i.getBufferParameter(i.ELEMENT_ARRAY_BUFFER,i.BUFFER_SIZE),a=new ArrayBuffer(o),s=new Int16Array(a);i.getBufferSubData(i.ELEMENT_ARRAY_BUFFER,0,new Int16Array(a));const l=new e.eJ;for(let e=0;e<o/2;e+=3){const t=s[e],r=s[e+1],n=s[e+2];l.emplaceBack(t,r),l.emplaceBack(r,n),l.emplaceBack(n,t)}const c=n.bindVertexArrayOES.current,u=new ps;return u.buf=new Yo(n,l),u.lastUsedFrameIdx=t,this._storage.set(r.id,u),n.bindVertexArrayOES.set(c),u.buf}update(e){for(const[t,r]of this._storage)e-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class gs{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const ys=e.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class _s{constructor(e){this.revealStart=11,this.revealRange=2}}const vs=e.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class xs{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,r){const n=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const r=new e.eK,n=new e.b0;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1),n.emplaceBack(0,1,2),n.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(r,vs.members),this.vignetteIdx=t.context.createIndexBuffer(n)}const i=e.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,n);const e={u_vignetteShape:(o={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:o.vignetteColor};n.draw(t,t.context.gl.TRIANGLES,Jr.disabled,en.disabled,Yr.alphaBlended,nn.disabled,e,"vignette",this.vignetteVx,this.vignetteIdx,i)}var o}}class ws{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,r){const n=t.getFreeCameraOptions().position,i=n.toAltitude(),o=n.toLngLat(),a=e.an(o.lng),s=e.an(o.lat),l=t.pixelsPerMeter/r,c=a*e.eM,u=e.eM*Math.log(Math.tan(Math.PI/4+s/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const e=-this._offsetYPrev+u,t=-this._elevationPrev+i;this._accumulatedOffsetX+=(-this._offsetXPrev+c)*l,this._accumulatedOffsetY+=e*l,this._accumulatedElevation+=t*l,this._offsetXPrev=c,this._offsetYPrev=u,this._elevationPrev=i}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function bs(e,t){return[-(e[0]-Math.floor(e[0]/t)*t),-(e[1]-Math.floor(e[1]/t)*t),-(e[2]-Math.floor(e[2]/t)*t)]}function Bs(t){const r=e.eq(1323123451230),n=[];for(let i=0;i<t;++i){const t=2*r()-1,i=2*r()-1,o=2*r()-1;n.push(e.d5(t,i,o))}return n}function Cs(t,r,n,i,o){const a=e.aA((o-n)/(i-n),0,1);return(1-a)*t+a*r}class Es{constructor(e){this._movement=new ws,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new xs,this._ppmScaleFactor=e}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,r){const n=t.transform;this._movement.update(n,this._ppmScaleFactor);const i=n.starsProjMatrix,o=e.c7([]);e.c9(o,o,e.an(90)-n._pitch),e.c8(o,o,-n.angle);const a=e.cc(new Float32Array(16),o),s=e.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),l=e.eg([],s),c=e.aB([],l,a),u=Date.now()/1e3;return this._accumulatedTimeFromStart+=(u-this._prevTime)*r,this._prevTime=u,{projectionMatrix:i,modelviewMatrix:c}}}class Ss extends Es{constructor(e){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new _s("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const t=Bs(this.particlesCount),n=new e.eN,i=new e.b0;let o=0;const a=e.eq(1323123451230);for(let e=0;e<t.length;++e){const r=t[e],s=[2*a()-1,a(),a(),a()];n.emplaceBack(r[0],r[1],r[2],-1,-1,...s),n.emplaceBack(r[0],r[1],r[2],1,-1,...s),n.emplaceBack(r[0],r[1],r[2],1,1,...s),n.emplaceBack(r[0],r[1],r[2],-1,1,...s),i.emplaceBack(o+0,o+1,o+2),i.emplaceBack(o+0,o+2,o+3),o+=4}this.particlesVx=r.createVertexBuffer(n,ys.members),this.particlesIdx=r.createIndexBuffer(i)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},n=t.transform.zoom;if(r.revealStart>n)return;const i=Cs(0,1,r.revealStart,r.revealStart+r.revealRange,n);if(!this.particlesVx||!this.particlesIdx)return;const o=structuredClone(this._params);let a=[-o.direction.x,o.direction.y,-100];e.aw(a,a);const s=structuredClone(this._vignetteParams);s.strength*=i,o.overrideStyleParameters||(o.intensity=t.style.rain.state.density,o.timeFactor=t.style.rain.state.intensity,o.color=structuredClone(t.style.rain.state.color),a=structuredClone(t.style.rain.state.direction),o.screenThinning.intensity=t.style.rain.state.centerThinning,o.dropletSizeX=t.style.rain.state.dropletSize[0],o.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],o.distortionStrength=100*t.style.rain.state.distortionStrength,s.strength=1,s.color=structuredClone(t.style.rain.state.vignetteColor));const l=this.updateOnRender(t,o.timeFactor),c=t.context,u=c.gl,d=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new e.T(c,{width:t.width,height:t.height,data:null},u.RGBA8)),o.distortionStrength>0&&(c.activeTexture.set(u.TEXTURE0),this.screenTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.copyTexSubImage2D(u.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const h=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(c,h),c.activeTexture.set(u.TEXTURE0),this.screenTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE);const A=[o.color.r,o.color.g,o.color.b,o.color.a],f=(r,n)=>{const i=bs(this._movement.getPosition(),r),s=o.dropletSizeX,c=o.dropletSizeX*o.dropletSizeYScale,f=t.width/2,p=t.height/2,m=Cs(0,o.screenThinning.start,0,1,o.screenThinning.intensity),g=Cs(.001,o.screenThinning.range,0,1,o.screenThinning.intensity),y=Cs(0,o.screenThinning.particleOffset,0,1,o.screenThinning.intensity),_=(v={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:i,velocityConeAperture:o.velocityConeAperture,velocity:o.velocity,boxSize:r,rainDropletSize:[s,c],distortionStrength:o.distortionStrength,rainDirection:a,color:A,screenSize:[d.width,d.height],thinningCenterPos:[f,p],thinningShape:[m,g,Math.pow(10,o.screenThinning.fadePower)],thinningAffectedRatio:o.screenThinning.affectedRatio,thinningParticleOffset:y,shapeDirectionalPower:o.shapeDirPower,shapeNormalPower:o.shapeNormalPower,mode:n?0:1},{u_modelview:Float32Array.from(v.modelview),u_projection:Float32Array.from(v.projection),u_time:v.time,u_cam_pos:v.camPos,u_texScreen:0,u_velocityConeAperture:v.velocityConeAperture,u_velocity:v.velocity,u_boxSize:v.boxSize,u_rainDropletSize:v.rainDropletSize,u_distortionStrength:v.distortionStrength,u_rainDirection:v.rainDirection,u_color:v.color,u_screenSize:v.screenSize,u_thinningCenterPos:v.thinningCenterPos,u_thinningShape:v.thinningShape,u_thinningAffectedRatio:v.thinningAffectedRatio,u_thinningParticleOffset:v.thinningParticleOffset,u_shapeDirectionalPower:v.shapeDirectionalPower,u_shapeNormalPower:v.shapeNormalPower,u_mode:v.mode});var v;const x=Math.round(o.intensity*this.particlesCount),w=e.bg.simpleSegment(0,0,4*x,2*x);h.draw(t,u.TRIANGLES,Jr.disabled,en.disabled,Yr.alphaBlended,nn.disabled,_,"rain_particles",this.particlesVx,this.particlesIdx,w)};o.distortionStrength>0&&f(o.boxSize,!0),f(o.boxSize,!1),this._vignette.draw(t,s)}}const Ts=e.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Is extends Es{constructor(e){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new _s("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const t=Bs(this.particlesCount),n=new e.eO,i=new e.b0;let o=0;const a=e.eq(1323123451230);for(let e=0;e<t.length;++e){const r=t[e],s=a(),l=a(),c=a(),u=[e/t.length,s,l,c],d=[a(),a()];n.emplaceBack(r[0],r[1],r[2],-1,-1,...u,...d),n.emplaceBack(r[0],r[1],r[2],1,-1,...u,...d),n.emplaceBack(r[0],r[1],r[2],1,1,...u,...d),n.emplaceBack(r[0],r[1],r[2],-1,1,...u,...d),i.emplaceBack(o+0,o+1,o+2),i.emplaceBack(o+0,o+2,o+3),o+=4}this.particlesVx=r.createVertexBuffer(n,Ts.members),this.particlesIdx=r.createIndexBuffer(i)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const r=structuredClone(this._params);let n=[-r.direction.x,r.direction.y,-100];e.aw(n,n);const i=structuredClone(this._vignetteParams),o=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},a=t.transform.zoom;if(o.revealStart>a)return;const s=Cs(0,1,o.revealStart,o.revealStart+o.revealRange,a);i.strength*=s,r.overrideStyleParameters||(r.intensity=t.style.snow.state.density,r.timeFactor=t.style.snow.state.intensity,r.color=structuredClone(t.style.snow.state.color),n=structuredClone(t.style.snow.state.direction),r.screenThinning.intensity=t.style.snow.state.centerThinning,r.billboardSize=2.79*t.style.snow.state.flakeSize,i.strength=1,i.color=structuredClone(t.style.snow.state.vignetteColor));const l=this.updateOnRender(t,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const c=t.context,u=c.gl,d=t.transform,h=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(c,h),((r,i,o)=>{const a=bs(this._movement.getPosition(),r),s=d.width/2,c=d.height/2,A=Cs(0,o.screenThinning.start,0,1,o.screenThinning.intensity),f=Cs(.001,o.screenThinning.range,0,1,o.screenThinning.intensity),p=Cs(0,o.screenThinning.particleOffset,0,1,o.screenThinning.intensity),m=(g={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:a,velocityConeAperture:o.velocityConeAperture,velocity:o.velocity,horizontalOscillationRadius:o.horizontalOscillationRadius,horizontalOscillationRate:o.horizontalOscillationRate,boxSize:r,billboardSize:1*o.billboardSize,simpleShapeParameters:[o.shapeFadeStart,o.shapeFadePower],screenSize:[d.width,d.height],thinningCenterPos:[s,c],thinningShape:[A,f,Math.pow(10,o.screenThinning.fadePower)],thinningAffectedRatio:o.screenThinning.affectedRatio,thinningParticleOffset:p,color:[o.color.r,o.color.g,o.color.b,o.color.a],direction:n},{u_modelview:Float32Array.from(g.modelview),u_projection:Float32Array.from(g.projection),u_time:g.time,u_cam_pos:g.camPos,u_velocityConeAperture:g.velocityConeAperture,u_velocity:g.velocity,u_horizontalOscillationRadius:g.horizontalOscillationRadius,u_horizontalOscillationRate:g.horizontalOscillationRate,u_boxSize:g.boxSize,u_billboardSize:g.billboardSize,u_simpleShapeParameters:g.simpleShapeParameters,u_screenSize:g.screenSize,u_thinningCenterPos:g.thinningCenterPos,u_thinningShape:g.thinningShape,u_thinningAffectedRatio:g.thinningAffectedRatio,u_thinningParticleOffset:g.thinningParticleOffset,u_particleColor:g.color,u_direction:g.direction});var g;const y=Math.round(o.intensity*this.particlesCount),_=e.bg.simpleSegment(0,0,4*y,2*y);this.particlesVx&&this.particlesIdx&&h.draw(t,u.TRIANGLES,Jr.disabled,en.disabled,Yr.alphaBlended,nn.disabled,m,"snow_particles",this.particlesVx,this.particlesIdx,_)})(r.boxSize,0,r),this._vignette.draw(t,i)}}const Fs={symbol:function(t,r,n,i,o){if("translucent"!==t.renderPass)return;const a=en.disabled,s=t.colorModeForRenderPass(),l=n.layout.get("text-variable-anchor"),c=n.layout.get("text-size-scale-range"),u=e.aA(t.scaleFactor,c[0],c[1]);l&&function(t,r,n,i,o,a,s,l){const c=r.transform,u="map"===o,d="map"===a;for(const h of t){const t=i.getTile(h),r=t.getBucket(n);if(!r||!r.text||!r.text.segments.get().length)continue;const o=e.bK(r.textSizeData,c.zoom,l),a=rr(h,r.getProjection(),c),A=c.calculatePixelsToTileUnitsMatrix(t),f=sr(a,t.tileID.canonical,d,u,c,r.getProjection(),A),p=r.hasIconTextFit()&&r.hasIconData();o&&sa(r,u,d,s,c,f,h,Math.pow(2,c.zoom-t.tileID.overscaledZ),o,p)}}(i,t,n,r,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),o,u);const d=0!==n.paint.get("icon-opacity").constantOr(1),h=0!==n.paint.get("text-opacity").constantOr(1);void 0!==n.layout.get("symbol-sort-key").constantOr(1)&&(d||h)?la(t,r,n,i,a,s):(d&&la(t,r,n,i,a,s,{onlyIcons:!0}),h&&la(t,r,n,i,a,s,{onlyText:!0})),r.map.showCollisionBoxes&&(na(t,r,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),na(t,r,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,r,n,i){if("translucent"!==t.renderPass)return;const o=n.paint.get("circle-opacity"),a=n.paint.get("circle-stroke-width"),s=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1),c=n.paint.get("circle-emissive-strength");if(0===o.constantOr(1)&&(0===a.constantOr(1)||0===s.constantOr(1)))return;const u=t.context,d=u.gl,h=t.transform,A=!(!t.terrain||!t.terrain.enabled),f=n.layout.get("circle-elevation-reference"),p=t.depthModeForSublayer(0,Jr.ReadOnly),m=new Jr(t.context.gl.LEQUAL,Jr.ReadOnly,t.depthRangeFor3D),g="none"===f||A?p:m,y=en.disabled,_=t.colorModeForDrapableLayerRenderPass(c),v="globe"===h.projection.name,x=[e.aF(h.center.lng),e.aJ(h.center.lat)],w=[];for(let B=0;B<i.length;B++){const o=i[B],a=r.getTile(o),s=a.getBucket(n);if(!s||s.projection.name!==h.projection.name)continue;const c=s.programConfigurations.get(n.id),u=s.layoutVertexBuffer,d=s.globeExtVertexBuffer,A=s.indexBuffer,f=e.e0(n),p=[d],m=t.isTileAffectedByFog(o);v&&f.push("PROJECTION_GLOBE_VIEW"),f.push("DEPTH_D24"),t.terrain&&h.depthOcclusionForSymbolsAndCircles&&f.push("DEPTH_OCCLUSION"),s.hasElevation&&!t.terrain&&(f.push("ELEVATED_ROADS"),p.push(s.elevatedLayoutVertexBuffer));const g=t.getOrCreateProgram("circle",{config:c,defines:f,overrideFog:m}),y=h.projection.createInversionMatrix(h,o.canonical),_={programConfiguration:c,program:g,layoutVertexBuffer:u,dynamicBuffers:p,indexBuffer:A,uniformValues:e.e1(t,o,a,y,x,n),tile:a};if(l){const t=s.segments.get();for(const r of t)w.push({segments:new e.bg([r]),sortKey:r.sortKey,state:_})}else w.push({segments:s.segments,sortKey:0,state:_})}l&&w.sort((e,t)=>e.sortKey-t.sortKey);const b={useDepthForOcclusion:h.depthOcclusionForSymbolsAndCircles};for(const e of w){const{programConfiguration:r,program:i,layoutVertexBuffer:o,dynamicBuffers:a,indexBuffer:s,uniformValues:l,tile:c}=e.state,A=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,i,b),t.uploadCommonUniforms(u,i,c.tileID.toUnwrapped()),i.draw(t,d.TRIANGLES,g,y,_,nn.disabled,l,n.id,o,s,A,n.paint,h.zoom,r,a)}},heatmap:function(t,r,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const o=t.context,a=o.gl,s=en.disabled,l=new Yr([a.ONE,a.ONE,a.ONE,a.ONE],e.ao.transparent,[!0,!0,!0,!0]);!function(e,t,r,n){const i=e.gl,o=t.width*n,a=t.height*n;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,o,a]);let s=r.heatmapFbo;if(!s||s&&(s.width!==o||s.height!==a)){s&&s.destroy();const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),s=r.heatmapFbo=e.createFramebuffer(o,a,1,null),function(e,t,r,n,i,o){const a=e.gl;a.texImage2D(a.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?a.RGBA16F:a.RGBA,i,o,0,a.RGBA,e.extRenderToTextureHalfFloat?a.HALF_FLOAT:a.UNSIGNED_BYTE,null),n.colorAttachment0.set(r)}(e,0,t,s,o,a)}else i.bindTexture(i.TEXTURE_2D,s.colorAttachment0.get()),e.bindFramebuffer.set(s.framebuffer)}(o,t,n,"globe"===t.transform.projection.name?.5:.25),o.clear({color:e.ao.transparent});const c=t.transform,u="globe"===c.projection.name,d=u?["PROJECTION_GLOBE_VIEW"]:[],h=u?nn.frontCCW:nn.disabled,A=[e.aF(c.center.lng),e.aJ(c.center.lat)];for(let e=0;e<i.length;e++){const f=i[e];if(r.hasRenderableParent(f))continue;const p=r.getTile(f),m=p.getBucket(n);if(!m||m.projection.name!==c.projection.name)continue;const g=t.isTileAffectedByFog(f),y=m.programConfigurations.get(n.id),_=t.getOrCreateProgram("heatmap",{config:y,defines:d,overrideFog:g}),{zoom:v}=t.transform;t.terrain&&t.terrain.setupElevationDraw(p,_),t.uploadCommonUniforms(o,_,f.toUnwrapped());const x=c.projection.createInversionMatrix(c,f.canonical);_.draw(t,a.TRIANGLES,Jr.disabled,s,l,h,Oo(t,f,p,x,A,v,n.paint.get("heatmap-intensity")),n.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,n.paint,t.transform.zoom,y,u?[m.globeExtVertexBuffer]:null)}o.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,r){const n=t.context,i=n.gl,o=r.heatmapFbo;if(!o)return;n.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment0.get()),n.activeTexture.set(i.TEXTURE1);let a=r.colorRampTexture;a||(a=r.colorRampTexture=new e.T(n,r.colorRamp,i.RGBA8)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,i.TRIANGLES,Jr.disabled,en.disabled,t.colorModeForRenderPass(),nn.disabled,((e,t)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,r),r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,r.paint,t.transform.zoom)}(t,n))},line:function(t,r,n,i){if("translucent"!==t.renderPass)return;const o=n.paint.get("line-opacity"),a=n.paint.get("line-width");if(0===o.constantOr(1)||0===a.constantOr(1))return;const s=n.paint.get("line-emissive-strength").isConstant(),l=n.paint.get("line-emissive-strength").constantOr(0),c=n.paint.get("line-occlusion-opacity"),u=n.layout.get("line-elevation-reference"),d="meters"===n.layout.get("line-width-unit"),h="sea"===u,A=!(!t.terrain||!t.terrain.enabled),f=t.context,p=f.gl;if(n.hasElevatedBuckets&&"globe"===t.transform.projection.name)return;const m=n.layout.get("line-cross-slope"),g=void 0!==m,y=m<1,_=t.colorModeForDrapableLayerRenderPass(s?l:null),v=t.terrain&&t.terrain.renderingToTexture,x=v?1:e.o.devicePixelRatio,w=n.paint.get("line-dasharray"),b=w.constantOr(1),B=n.layout.get("line-cap"),C=w.constantOr(null),E=B.constantOr(null),S=n.paint.get("line-pattern"),T=S.constantOr(1),I=n.paint.get("line-pattern-cross-fade"),F=S.constantOr(null),k=n.paint.get("line-opacity").constantOr(1);let P=!T&&1!==k||t.depthOcclusion&&c>0&&c<1;const M=n.paint.get("line-gradient"),O=T?"linePattern":"line",L=e.e2(n);let D;if(v&&t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(P=!1),0!==c&&t.depthOcclusion){const t=n.paint._values["line-opacity"];t&&t.value&&"constant"===t.value.kind?D=t.value:e.w("Occlusion opacity for layer ".concat(n.id," is supported only when line-opacity isn't data-driven."))}"constant"!==a.value.kind&&!1===a.value.isLineProgressConstant&&L.push("VARIABLE_LINE_WIDTH"),v&&("dual-source-blending"!==t.emissiveMode||s?"mrt-fallback"===t.emissiveMode&&L.push("USE_MRT1"):L.push("DUAL_SOURCE_BLENDING"));const U=(i,o,a,s,l,u)=>{for(const A of i){const i=r.getTile(A);if(T&&!i.patternsLoaded())continue;const m=i.getBucket(n);if(!m)continue;if("none"!==m.elevationType&&!l||"none"===m.elevationType&&l)continue;t.prepareDrawTile();const g=[...o],y=t.shadowRenderer,w="road"===m.elevationType&&!!y&&y.enabled;let B=[0,0,0];if(w){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(B=xn(t.style,e,r)),g.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const S=m.programConfigurations.get(n.id);let L=!1;if(F&&i.imageAtlas){const t=e.e3.from(F),r=t.getPrimary().scaleSelf(x).toString(),n=i.imageAtlas.patternPositions.get(r),o=t.getSecondary(),a=o?i.imageAtlas.patternPositions.get(o.scaleSelf(x).toString()):null;L=!!n&&!!a,n&&S.setConstantPatternPositions(n,a)}I>0&&(L||S.getPatternTransitionVertexBuffer("line-pattern"))&&g.push("LINE_PATTERN_TRANSITION");const U=t.isTileAffectedByFog(A),R=t.getOrCreateProgram(O,{config:S,defines:g,overrideFog:U});if(!T&&C&&E&&i.lineAtlas){const e=i.lineAtlas.getDash(C,E);e&&S.setConstantPatternPositions(e)}w&&y.setupShadows(i.tileID.toUnwrapped(),R,"vector-tile");let[z,N]=n.paint.get("line-trim-offset");if("round"===E||"square"===E){const e=1;z!==N&&(0===z&&(z-=e),1===N&&(N+=e))}const j=v?A.projMatrix:null,Q=d?1/m.tileToMeter/e.ay(i,1,t.transform.zoom):1,V=d?1/m.tileToMeter/e.ay(i,1,Math.floor(t.transform.zoom)):1,H=T?e.e4(t,i,n,j,x,Q,V,[z,N],B,I):e.e5(t,i,n,j,m.lineClipsArray.length,x,Q,V,[z,N],B);if(M){const i=m.gradients[n.id];let o=i.texture;if(n.gradientVersion!==i.version){let a=256;if(n.stepInterpolant){const n=r.getSource().maxzoom,i=A.canonical.z===n?Math.ceil(1<<t.transform.maxZoom-A.canonical.z):1;a=e.aA(e.e6(m.maxLineLength/e.al*1024*i),256,f.maxTextureSize)}i.gradient=e.e7({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:i.gradient||void 0,clips:m.lineClipsArray}),i.texture?i.texture.update(i.gradient):i.texture=new e.T(f,i.gradient,p.RGBA8),i.version=n.gradientVersion,o=i.texture}f.activeTexture.set(p.TEXTURE1),o.bind(n.stepInterpolant?p.NEAREST:p.LINEAR,p.CLAMP_TO_EDGE)}b&&(f.activeTexture.set(p.TEXTURE0),i.lineAtlasTexture&&i.lineAtlasTexture.bind(p.LINEAR,p.REPEAT),S.updatePaintBuffers()),T&&(f.activeTexture.set(p.TEXTURE0),i.imageAtlasTexture&&i.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),S.updatePaintBuffers()),l&&!h&&t.terrain.setupElevationDraw(i,R),t.uploadCommonUniforms(f,R,A.toUnwrapped());const G=e=>{null!=D&&(D.value=k*c),R.draw(t,p.TRIANGLES,a,e,_,nn.disabled,H,n.id,m.layoutVertexBuffer,m.indexBuffer,m.segments,n.paint,t.transform.zoom,S,[m.layoutVertexBuffer2,m.patternVertexBuffer,m.zOffsetVertexBuffer]),null!=D&&(D.value=k)};if(P&&!l){const e=t.stencilModeForClipping(A).ref;0===e&&v&&f.clear({stencil:0});const r={func:p.EQUAL,mask:255};H.u_alpha_discard_threshold=.8,G(new en(r,e,255,p.KEEP,p.KEEP,p.INVERT)),H.u_alpha_discard_threshold=0,G(new en(r,e,255,p.KEEP,p.KEEP,p.KEEP))}else H.u_alpha_discard_threshold=P&&l&&u?.8:0,G(l?s:t.stencilModeForClipping(A))}};let R=t.depthModeForSublayer(0,Jr.ReadOnly);const z=new Jr(t.depthOcclusion?p.GREATER:p.LEQUAL,Jr.ReadOnly,t.depthRangeFor3D);if(n.hasNonElevatedBuckets){const r=!v&&t.terrain;0!==c&&r?e.w("Occlusion opacity for layer ".concat(n.id," is supported on terrain only if the layer has line-z-offset enabled.")):r?e.w("Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ".concat(n.id,".")):U(i,L,R,en.disabled,!1,!0)}if(n.hasElevatedBuckets){"hd-road-markup"===u?A||(R=z,L.push("ELEVATED_ROADS")):(L.push("ELEVATED"),R=z,g&&L.push(y?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),h&&L.push("ELEVATION_REFERENCE_SEA"));const e=P?t.stencilModeFor3D():en.disabled;t.forceTerrainMode=!0,U(i,L,R,e,!0,!0),P&&U(i,L,R,e,!0,!1),t.forceTerrainMode=!1}P&&(t.resetStencilClippingMasks(),v&&f.clear({stencil:0})),0===c||t.depthOcclusion||v||t.layersWithOcclusionOpacity.push(t.currentLayer)},fill:function(t,r,n,i){const o=n.paint.get("fill-color"),a=n.paint.get("fill-opacity");if(0===a.constantOr(1))return;const s=n.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(s),c=n.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===o.constantOr(e.ao.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";let d="none";"none"!==n.layout.get("fill-elevation-reference")?d="road":0!==n.paint.get("fill-z-offset").constantOr(1)&&(d="offset");const h=!(!t.terrain||!t.terrain.enabled),A={painter:t,sourceCache:r,layer:n,coords:i,colorMode:l,elevationType:d,terrainEnabled:h,pass:u};if("shadow"===t.renderPass)return void(t.shadowRenderer&&"road"===d&&!h&&function(e){const{painter:t,sourceCache:r,layer:n,coords:i}=e,o=t.context.gl,a=e.painter.shadowRenderer;for(const s of i){const e=r.getTile(s),i=e.getBucket(n);if(!i)continue;const l=i.elevatedStructures;if(!l)continue;if(!l.shadowCasterSegments||0===l.shadowCasterSegments.segments[0].primitiveLength)continue;t.prepareDrawTile();const c=i.bufferData.programConfigurations.get(n.id),u=t.isTileAffectedByFog(s),d=t.getOrCreateProgram("elevatedStructuresDepth",{config:c,overrideFog:u}),h=a.calculateShadowPassMatrixFromTile(e.tileID.toUnwrapped());t.uploadCommonUniforms(t.context,d,s.toUnwrapped());const A={u_matrix:h,u_depth_bias:0};d.draw(t,o.TRIANGLES,a.getShadowPassDepthMode(),en.disabled,a.getShadowPassColorMode(),nn.disabled,A,n.id,l.vertexBuffer,l.indexBuffer,l.shadowCasterSegments,n.paint,t.transform.zoom,c)}}(A));const f="mrt-fallback"===t.emissiveMode;if("offset"!==d){if(ha(A,!1,f),"road"===d){const e=!h&&"translucent"===t.renderPass;e&&da(t,r,n,i,"geometry"),ha(A,!0,f,en.disabled),e&&function(e){const{painter:t,sourceCache:r,layer:n,coords:i,colorMode:o}=e,a=t.context.gl,s=e.painter.shadowRenderer,l=!!s&&s.enabled,c=new Jr(t.context.gl.LEQUAL,Jr.ReadOnly,t.depthRangeFor3D);let u=[0,0,0];if(l){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(u=xn(t.style,e,r))}const d=e=>{for(const d of i){const i=r.getTile(d),h=i.getBucket(n);if(!h)continue;const A=h.elevatedStructures;if(!A)continue;let f,p;if(e?(f=A.renderableBridgeSegments,p=A.bridgeProgramConfigurations.get(n.id)):(f=A.renderableTunnelSegments,p=A.tunnelProgramConfigurations.get(n.id)),!f||0===f.segments[0].primitiveLength)continue;p.updatePaintBuffers(),t.prepareDrawTile();const m=t.isTileAffectedByFog(d),g=[];l&&g.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const y=t.getOrCreateProgram("elevatedStructures",{config:p,overrideFog:m,defines:g}),_=t.translatePosMatrix(d.projMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));l&&s.setupShadows(i.tileID.toUnwrapped(),y,"vector-tile");const v=Eo(_,u);t.uploadCommonUniforms(t.context,y,d.toUnwrapped()),y.draw(t,a.TRIANGLES,c,en.disabled,o,nn.backCCW,v,n.id,A.vertexBuffer,A.indexBuffer,f,n.paint,t.transform.zoom,p,[A.vertexBufferNormal])}};d(!0),d(!1)}(A)}}else ha(A,!1,f,t.stencilModeFor3D())},"fill-extrusion":function(t,r,n,i){const o=n.paint.get("fill-extrusion-opacity"),a=t.context,s=a.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===o)return;const u="mrt-fallback"===t.emissiveMode,d=t.conflationActive&&t.style.isLayerClipped(n,r.getSource()),h=t.style.order.indexOf(n.fqid);if(d&&function(e,t,r,n,i){for(const o of n){const n=t.getTile(o).getBucket(r);n&&(n.updateReplacement(o,e.replacementSource,i),n.uploadCentroid(e.context))}}(t,r,n,i,h),l||d)for(const e of i){const i=r.getTile(e).getBucket(n);i&&ma(t.context,r,e,i,n,l,d)}if("shadow"===t.renderPass&&t.shadowRenderer){const a=t.shadowRenderer;if(l&&o<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.ad)return;const s=a.getShadowPassDepthMode(),c=a.getShadowPassColorMode();Aa(t,r,n,i,s,en.disabled,c,d)}else if("translucent"===t.renderPass){const h=!n.paint.get("fill-extrusion-pattern").constantOr(1),A=n.paint.get("fill-extrusion-color").constantOr(e.ao.white);if(!c&&0!==A.a){const e=new Jr(t.context.gl.LEQUAL,Jr.ReadWrite,t.depthRangeFor3D);1===o&&h?Aa(t,r,n,i,e,en.disabled,Yr.unblended,d):(Aa(t,r,n,i,e,en.disabled,Yr.disabled,d),Aa(t,r,n,i,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),d),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&h&&(!l&&"globe"!==t.transform.projection.name||c)){const o=n.paint.get("fill-extrusion-opacity"),h=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),A=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),f=n.paint.get("fill-extrusion-flood-light-intensity"),p="none"===n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),m=n.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(p?null:n.lut).toArray01().slice(0,3),g=h>0&&A>0,y=f>0,_=(e,t,r)=>(1-r)*e+r*t,v=new fa;v.translate=n.paint.get("fill-extrusion-translate"),v.translateAnchor=n.paint.get("fill-extrusion-translate-anchor"),v.edgeRadius=n.layout.get("fill-extrusion-edge-radius"),v.cutoffFadeRange=n.paint.get("fill-extrusion-cutoff-fade-range");const x=a=>{const l=t.depthModeForSublayer(1,Jr.ReadOnly,s.LEQUAL,!0),c=n.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),u=_(.1,3,c),p=t._showOverdrawInspector;if(!p){const c=new en({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),p=new Yr([s.ONE,s.ONE,s.ONE,s.ONE],e.ao.transparent,[!1,!1,!1,!0],s.MIN);pa(v,t,r,n,i,l,c,p,nn.disabled,a,"sdf",o,h,A,f,m,u,d,!1)}{const c=p?en.disabled:new en({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),g=p?t.colorModeForRenderPass():new Yr([s.ONE_MINUS_DST_ALPHA,s.DST_ALPHA,s.ONE,s.ONE],e.ao.transparent,[!0,!0,!0,!0]);pa(v,t,r,n,i,l,c,g,nn.disabled,a,"color",o,h,A,f,m,u,d,!1)}};if(c){const c=()=>{const t=l.drapeBufferSize[0],r=l.drapeBufferSize[1];let n=l.framebufferCopyTexture;return n&&(!n||n.size[0]===t&&n.size[1]===r)||(n&&n.destroy(),n=l.framebufferCopyTexture=new e.T(a,new e.q({width:t,height:r}),s.RGBA8)),n.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.copyTexSubImage2D(s.TEXTURE_2D,0,0,0,0,0,t,r),n},p=(a,l,p)=>{const g=t.depthModeForSublayer(1,Jr.ReadOnly,s.LEQUAL,!1),y=n.paint.get(a?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),x=_(.1,3,y);{const c=new Yr([s.ONE,s.ONE,s.ONE,s.ONE],e.ao.transparent,[!1,!1,!1,!0]);pa(v,t,r,n,i,g,en.disabled,c,nn.disabled,a,"clear",o,h,A,f,m,x,d,l)}{const c=new en({func:s.ALWAYS,mask:255},255,255,s.KEEP,s.KEEP,s.REPLACE),u=new Yr([s.ONE,s.ONE,s.ONE,s.ONE],e.ao.transparent,[!1,!1,!1,!0],s.MIN);pa(v,t,r,n,i,g,c,u,nn.disabled,a,"sdf",o,h,A,f,m,x,d,l)}u&&!a&&(p=c());{const c=a?s.ZERO:s.ONE_MINUS_DST_ALPHA,u=new en({func:s.EQUAL,mask:255},255,255,s.KEEP,s.DECR,s.DECR),p=new Yr([c,s.DST_ALPHA,s.ONE_MINUS_DST_ALPHA,s.ZERO],e.ao.transparent,[!0,!0,!0,!0]);pa(v,t,r,n,i,g,u,p,nn.disabled,a,"color",o,h,A,f,m,x,d,l)}if(!u||a){const c=new Yr([s.ONE,s.ONE,s.ONE,a?s.ZERO:s.ONE],e.ao.transparent,[!1,!1,!1,!0],a?s.FUNC_ADD:s.MAX);pa(v,t,r,n,i,g,en.disabled,c,nn.disabled,a,"clear",o,h,A,f,m,x,d,l,p)}else{s.drawBuffers([s.NONE,s.COLOR_ATTACHMENT1]);const c=new en({func:s.EQUAL,mask:255},254,255,s.KEEP,s.DECR,s.DECR),u=new Yr([s.ONE,s.ONE,s.ONE,s.ONE],e.ao.transparent,[!0,!1,!1,!1],s.MAX);pa(v,t,r,n,i,g,c,u,nn.disabled,a,"emissive",o,h,A,f,m,x,d,l,p),s.drawBuffers([s.COLOR_ATTACHMENT0])}};if(g||y){let e;t.prepareDrawTile(),u&&!g||(e=c()),g&&p(!0,!1,e),y&&p(!1,!0,e)}}else g&&x(!0),y&&x(!1),(g||y)&&t.resetStencilClippingMasks()}}},building:function(e,t,r,n){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);const i=r.paint.get("building-ambient-occlusion-ground-intensity"),o=r.paint.get("building-ambient-occlusion-ground-radius"),a=r.paint.get("building-ambient-occlusion-ground-attenuation"),s=r.paint.get("building-opacity");if(s<=0)return;let l=i>0&&o>0,c=!0;const u=r.paint.get("building-vertical-scale");if(u<=0)return;e.shadowRenderer||(c=!1);const d=e.conflationActive&&e.style.isLayerClipped(r,t.getSource()),h=e.style.order.indexOf(r.fqid);if(function(e,t,r,n,i,o){for(const a of o){const o=t.getTile(a).getBucket(r);o&&(i&&o.updateReplacement(a,e.replacementSource,n),o.uploadUpdatedIndexBuffer(e.context))}}(e,t,r,h,d,n),function(e,t,r,n){for(const i of n){const n=t.getTile(i).getBucket(r);n&&n.needsEvaluation()&&n.uploadUpdatedColorBuffer(e.context)}}(e,t,r,n),r.resetLayerRenderingStats(e),e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0),"shadow"===e.renderPass&&e.shadowRenderer){const i=e.shadowRenderer,o=[],a=i.getShadowPassDepthMode();xa({painter:e,source:t,layer:r,coords:n,defines:o,blendMode:i.getShadowPassColorMode(),depthMode:a,opacity:s,verticalScale:u,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if("translucent"===e.renderPass){let h=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];c&&(h=h.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),e.shadowRenderer&&e.shadowRenderer.useNormalOffset&&(h=h.concat("NORMAL_OFFSET"));const A=r.paint.get("building-facade-emissive-chance"),f=r.paint.get("building-ambient-occlusion-intensity"),p=r.paint.get("building-flood-light-intensity"),m="none"===r.paint.get("building-flood-light-color-use-theme").constantOr("default"),g=r.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(m?null:r.lut).toArray01().slice(0,3),y=r.paint.get("building-flood-light-ground-attenuation"),_=p>0,v=new Jr(e.context.gl.LEQUAL,Jr.ReadWrite,e.depthRangeFor3D);s<1&&xa({painter:e,source:t,layer:r,coords:n,defines:h,blendMode:Yr.disabled,depthMode:v,opacity:s,verticalScale:u,facadeEmissiveChance:A,facadeAOIntensity:f,floodLightIntensity:p,floodLightColor:g,depthOnly:!0});const x=e.colorModeForRenderPass();xa({painter:e,source:t,layer:r,coords:n,defines:h,blendMode:x,depthMode:v,opacity:s,verticalScale:u,facadeEmissiveChance:A,facadeAOIntensity:f,floodLightIntensity:p,floodLightColor:g}),l&&wa(e,t,r,n,!0,s,i,o,p,g,a,d),_&&wa(e,t,r,n,!1,s,i,o,p,g,y,d)}else if("light-beam"===e.renderPass){const i=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],o=new Jr(e.context.gl.LEQUAL,Jr.ReadOnly,e.depthRangeFor3D);xa({painter:e,source:t,layer:r,coords:n,defines:i,blendMode:Yr.alphaBlended,depthMode:o,opacity:s,verticalScale:u,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1),e.resetStencilClippingMasks()},hillshade:function(e,t,r,n){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const i=e.context,o=e.terrain&&e.terrain.renderingToTexture,[a,s]="translucent"!==e.renderPass||o?[{},n]:e.stencilConfigForOverlap(n);for(const l of s){const n=t.getTile(l);if(n.needsHillshadePrepare&&"offscreen"===e.renderPass)hi(e,n,r);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Jr.ReadOnly),i=r.paint.get("hillshade-emissive-strength"),s=e.colorModeForDrapableLayerRenderPass(i),c=o&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):a[l.overscaledZ];ui(e,l,n,r,t,c,s)}}i.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(t,r,n,i,o,a){if("translucent"!==t.renderPass)return;if(0===n.paint.get("raster-opacity"))return;const s="globe"===t.transform.projection.name,l=0!==n.paint.get("raster-elevation"),c=l&&s;if(t.renderElevatedRasterBackface&&!c)return;const u=t.context,d=u.gl,h=r.getSource(),A=function(t,r,n,i,o){const a=r.paint.get("raster-color"),s="raster-array"===t.type,l=[],c=r.paint.get("raster-resampling"),u=r.paint.get("raster-color-mix");let d=r.paint.get("raster-color-range");const h=[u[0],u[1],u[2],0],A=u[3];let f="nearest"===c?i.NEAREST:i.LINEAR;if(s&&(l.push("RASTER_ARRAY"),a||l.push("RASTER_COLOR"),"linear"===c&&l.push("RASTER_ARRAY_LINEAR"),f=i.NEAREST,!d&&t.rasterLayers)){const e=t.rasterLayers.find(e=>{let{id:t}=e;return t===r.sourceLayer});e&&e.fields&&e.fields.range&&(d=e.fields.range)}if(d=d||[0,1],a){l.push("RASTER_COLOR"),n.activeTexture.set(i.TEXTURE2),r.updateColorRamp(d);let t=r.colorRampTexture;t||(t=r.colorRampTexture=new e.T(n,r.colorRamp,i.RGBA8)),t.bind(i.LINEAR,i.CLAMP_TO_EDGE)}return o&&l.push("USE_MRT1"),{mix:h,range:d,offset:A,defines:l,resampling:f}}(h,n,u,d,t.terrain&&t.terrain.renderingToTexture&&"mrt-fallback"===t.emissiveMode);if(h instanceof e.aU&&!i.length&&!s)return;const f=n.paint.get("raster-emissive-strength"),p=t.colorModeForDrapableLayerRenderPass(f),m=t.terrain&&t.terrain.renderingToTexture,g=!t.options.moving,y="nearest"===n.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;if(h instanceof e.aU&&!i.length&&(h.onNorthPole||h.onSouthPole)){const e=l?t.stencilModeFor3D():en.disabled;return void Ba(!!h.onNorthPole,null,t,r,n,f,A,nn.disabled,e)}if(!i.length)return;const[_,v]=h instanceof e.aU||m?[{},i]:t.stencilConfigForOverlap(i),x=v[v.length-1].overscaledZ;c&&A.defines.push("PROJECTION_GLOBE_VIEW"),l&&A.defines.push("RENDER_CUTOFF");const w=(i,o,v)=>{for(const w of i){const i=w.toUnwrapped(),b=r.getTile(w);if(m&&(!b||!b.hasData()))continue;u.activeTexture.set(d.TEXTURE0);const B=Ea(b,h,n,A);if(!B||!B.texture)continue;const{texture:C,mix:E,offset:S,tileSize:T,buffer:I}=B;let F,k;m?(F=Jr.disabled,k=w.projMatrix):l?(F=new Jr(d.LEQUAL,Jr.ReadWrite,t.depthRangeFor3D),k=s?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(i,g)):(F=t.depthModeForSublayer(w.overscaledZ-x,1===n.paint.get("raster-opacity")?Jr.ReadWrite:Jr.ReadOnly,d.LESS),k=t.transform.calculateProjMatrix(i,g));const P=t.terrain&&m?t.terrain.stencilModeForRTTOverlap(w):_[w.overscaledZ],M=a?0:n.paint.get("raster-fade-duration");b.registerFadeDuration(M);const O=r.findLoadedParent(w,0),L=oo(b,O,r,t.transform,M);let D,U;!L.isFading&&b.refreshedUponExpiration&&(b.refreshedUponExpiration=!1),t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),C.bind(y,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),O?(O.texture&&O.texture.bind(y,d.CLAMP_TO_EDGE),D=Math.pow(2,O.tileID.overscaledZ-b.tileID.overscaledZ),U=[b.tileID.canonical.x*D%1,b.tileID.canonical.y*D%1]):C.bind(y,d.CLAMP_TO_EDGE),"useMipmap"in C&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const R=t.transform;let z;const N=l?Ca(R):[0,0,0,0];let j,Q,V,H,G,K=0;if(c&&h instanceof e.aU&&h.coordinates.length>3)j=Float32Array.from(e.bk(e.dJ(new e.cD(0,0,0)))),Q=Float32Array.from(R.globeMatrix),V=Float32Array.from(e.dF(R)),H=[e.aF(R.center.lng),e.aJ(R.center.lat)],z=h.elevatedGlobePerspectiveTransform,G=h.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.dG(w.canonical);K=e.dH(t.getCenter().lat),j=Float32Array.from(e.bk(e.dJ(w.canonical))),Q=Float32Array.from(R.globeMatrix),V=Float32Array.from(e.dF(R)),H=[e.aF(R.center.lng),e.aJ(R.center.lat)],z=[0,0],G=Float32Array.from(e.dI(w.canonical,t,K,R.worldSize/R._pixelsPerMercatorPixel))}else z=h instanceof e.aU?h.perspectiveTransform:[0,0],j=new Float32Array(16),Q=new Float32Array(9),V=new Float32Array(16),H=[0,0],G=new Float32Array(9);const W=Uo(k,j,Q,V,G,U||[0,0],e.aj(t.transform.zoom),H,N,D||1,L,n,z,l?n.paint.get("raster-elevation"):0,2,E,S,A.range,T,I,f),q=t.isTileAffectedByFog(w),Z=t.getOrCreateProgram("raster",{defines:A.defines,overrideFog:q});if(t.uploadCommonUniforms(u,Z,i),h instanceof e.aU){const r=h.elevatedGlobeVertexBuffer,i=h.elevatedGlobeIndexBuffer;if(m||!s)h.boundsBuffer&&h.boundsSegments&&Z.draw(t,d.TRIANGLES,F,en.disabled,p,nn.disabled,W,n.id,h.boundsBuffer,t.quadTriangleIndexBuffer,h.boundsSegments);else if(r&&i){const a=R.zoom<=e.c_?h.elevatedGlobeSegments:h.getSegmentsForLongitude(R.center.lng);a&&Z.draw(t,d.TRIANGLES,F,en.disabled,p,o,W,n.id,r,i,a)}}else if(c){F=new Jr(d.LEQUAL,Jr.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[r,i,a]=e.getGridBuffers(K,!1);Z.draw(t,d.TRIANGLES,F,v||P,t.colorModeForRenderPass(),o,W,n.id,r,i,a)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:r,tileBoundsSegments:i}=t.getTileBoundsBuffers(b);Z.draw(t,d.TRIANGLES,F,P,p,nn.disabled,W,n.id,e,r,i)}}if(!(h instanceof e.aU)&&c)for(const e of i){const i=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&Ba(!0,e,t,r,n,f,A,o,v||en.disabled),i&&Ba(!1,e,t,r,n,f,A,o===nn.frontCW?nn.backCW:nn.frontCW,v||en.disabled)}};c?w(v,t.renderElevatedRasterBackface?nn.backCW:nn.frontCW,t.stencilModeFor3D()):w(v,nn.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,r,n,i,o,a){"offscreen"===t.renderPass&&function(t,r,n,i){if(!i.length)return;const o=t.context,a=o.gl,s=r.getSource();if(!(s instanceof gt))return;const l=Math.ceil(Math.sqrt(n.paint.get("raster-particle-count")));let c=n.particlePositionRGBAImage;if(!c||c.width!==l){const t=function(e){const t=e*e,r=new Uint8Array(4*t),n=function(e){return e|=0,e=Math.imul(2747636419^e,2654435769),e=Math.imul(e^e>>>16,2654435769),((e=Math.imul(e^e>>>16,2654435769))>>>0)/4294967296},i=1/1.1;for(let o=0;o<t;o++){const e=i*(n(2*o+0)+zo),t=i*(n(2*o+1)+zo),a=255*e%1,s=255*t%1,l=a,c=t-s/255,u=s;r[4*o+0]=255*(e-a/255),r[4*o+1]=255*l,r[4*o+2]=255*c,r[4*o+3]=255*u}return r}(l);c=n.particlePositionRGBAImage=new e.q({width:l,height:l},t)}let u=n.particleFramebuffer;u?u.width!==l&&(u.destroy(),u=n.particleFramebuffer=o.createFramebuffer(l,l,1,null)):u=n.particleFramebuffer=o.createFramebuffer(l,l,1,null);const d=[];for(const e of i){const t=r.getTile(e);if(!(t instanceof Dt))continue;const i=Ia(t,s,n);if(!i)continue;const a=[t.tileSize,t.tileSize];let u=n.tileFramebuffer;u||(u=n.tileFramebuffer=o.createFramebuffer(a[0],a[1],1,null));let h=t.rasterParticleState;h||(h=t.rasterParticleState=new Ta(o,e,a,c));const A=h.update(n.lastInvalidatedAt);h.particleTextureDimension!==l&&h.updateParticleTexture(e,c);const f=h.targetColorTexture;h.targetColorTexture=h.backgroundColorTexture,h.backgroundColorTexture=f;const p=h.particleTexture0;h.particleTexture0=h.particleTexture1,h.particleTexture1=p,d.push([e,i,h,A])}if(0===d.length)return;const h=e.o.now(),A=n.previousDrawTimestamp?.001*(h-n.previousDrawTimestamp):.0167;if(n.previousDrawTimestamp=h,n.hasColorMap()){o.activeTexture.set(a.TEXTURE0+2);let t=n.colorRampTexture;t||(t=n.colorRampTexture=new e.T(o,n.colorRamp,a.RGBA8)),t.bind(a.LINEAR,a.CLAMP_TO_EDGE)}o.bindFramebuffer.set(n.tileFramebuffer.framebuffer),function(t,r,n){const i=t.context,o=i.gl,a=r.tileFramebuffer;i.activeTexture.set(o.TEXTURE0);const s={u_texture:0,u_opacity:1.05*(c=r.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const u of n){const[,,n,c]=u;a.colorAttachment0.set(n.targetColorTexture.texture),i.viewport.set([0,0,a.width,a.height]),i.clear({color:e.ao.transparent}),c&&(n.backgroundColorTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),l.draw(t,o.TRIANGLES,Jr.disabled,en.disabled,Yr.alphaBlended,nn.disabled,s,r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,n,d),function(t,r,n,i){const o=t.context,a=o.gl,s=n.tileFramebuffer,l="globe"===t.transform.projection.name,c=n.paint.get("raster-particle-max-speed");for(const u of i){const[i,d,h]=u;o.activeTexture.set(a.TEXTURE0+0),d.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),s.colorAttachment0.set(h.targetColorTexture.texture);const A=t.getOrCreateProgram("rasterParticleDraw",{defines:d.defines,overrideFog:!1});o.activeTexture.set(a.TEXTURE0+1);const f=d.scalarData?[]:[0,1,2,3].map(t=>e.e9[t](i));f.push(i);const p=i.canonical.x,m=i.canonical.y;for(const e of f){const o=r.getTile(l?e.wrapped():e);if(!o)continue;const s=o.rasterParticleState;if(!s)continue;const u=e.canonical.x+(1<<e.canonical.z)*(e.wrap-i.wrap),h=e.canonical.y;s.particleTexture0.bind(a.NEAREST,a.CLAMP_TO_EDGE);const f=jo(1,s.particleTexture0.size[0],[u-p,h-m],0,d.texture.size,2,c,d.textureOffset,d.scale,d.offset);A.draw(t,a.POINTS,Jr.disabled,en.disabled,Yr.alphaBlended,nn.disabled,f,n.id,s.particleIndexBuffer,void 0,s.particleSegment)}}}(t,r,n,d),o.bindFramebuffer.set(n.particleFramebuffer.framebuffer),function(t,r,n,i){const o=t.context,a=o.gl,s=r.paint.get("raster-particle-max-speed"),l=i*r.paint.get("raster-particle-speed-factor")*.15,c=function(e){return Math.pow(e,6)}(.01+1*r.paint.get("raster-particle-reset-rate-factor")),u=r.particleFramebuffer;o.viewport.set([0,0,u.width,u.height]);for(const d of n){const[,n,i]=d;o.activeTexture.set(a.TEXTURE0+0),n.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE),o.activeTexture.set(a.TEXTURE0+1);const h=i.particleTexture0;h.bind(a.NEAREST,a.CLAMP_TO_EDGE);const A=Qo(1,h.size[0],0,n.texture.size,s,l,c,n.textureOffset,n.scale,n.offset);u.colorAttachment0.set(i.particleTexture1.texture),o.clear({color:e.ao.transparent}),t.getOrCreateProgram("rasterParticleUpdate",{defines:n.defines}).draw(t,a.TRIANGLES,Jr.disabled,en.disabled,Yr.unblended,nn.disabled,A,r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}}(t,n,d,A)}(t,r,n,i),"translucent"===t.renderPass&&(function(t,r,n,i){const o=t.context,a=o.gl,s=r.getSource().tileSize,l=5*(1-e.ah(e.cL,e.cL+1,t.transform.zoom))*s+n.paint.get("raster-particle-elevation"),c=!t.options.moving,u="globe"===t.transform.projection.name;if(!i.length)return;const[d,h]=t.stencilConfigForOverlap(i),A=[];u&&A.push("PROJECTION_GLOBE_VIEW");const f=t.stencilModeFor3D();for(const p of h){const i=p.toUnwrapped(),s=r.getTile(p);if(!s.rasterParticleState)continue;const h=s.rasterParticleState,m=100;s.registerFadeDuration(m);const g=r.findLoadedParent(p,0),y=oo(s,g,r,t.transform,m);let _,v;t.terrain&&t.terrain.prepareDrawTile(),o.activeTexture.set(a.TEXTURE0),h.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),o.activeTexture.set(a.TEXTURE1),g&&g.rasterParticleState?(g.rasterParticleState.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE),_=Math.pow(2,g.tileID.overscaledZ-s.tileID.overscaledZ),v=[s.tileID.canonical.x*_%1,s.tileID.canonical.y*_%1]):h.targetColorTexture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const x=u?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(i,c),w=t.transform,b=Fa(w),B=e.dG(p.canonical),C=e.dH(B.getCenter().lat);let E,S,T,I,F;u?(E=Float32Array.from(e.bk(e.dJ(p.canonical))),S=Float32Array.from(w.globeMatrix),T=Float32Array.from(e.dF(w)),I=[e.aF(w.center.lng),e.aJ(w.center.lat)],F=Float32Array.from(e.dI(p.canonical,B,C,w.worldSize/w._pixelsPerMercatorPixel))):(E=new Float32Array(16),S=new Float32Array(9),T=new Float32Array(16),I=[0,0],F=new Float32Array(9));const k=No(x,E,S,T,F,v||[0,0],e.aj(t.transform.zoom),I,b,_||1,y,l),P=t.isTileAffectedByFog(p),M=t.getOrCreateProgram("rasterParticle",{defines:A,overrideFog:P});if(t.uploadCommonUniforms(o,M,i),u){const e=new Jr(a.LEQUAL,Jr.ReadOnly,t.depthRangeFor3D),r=0,i=t.globeSharedBuffers;if(i){const[o,s,l]=i.getGridBuffers(C,0!==r);M.draw(t,a.TRIANGLES,e,f,Yr.alphaBlended,t.renderElevatedRasterBackface?nn.frontCCW:nn.backCCW,k,n.id,o,s,l)}}else{const e=t.depthModeForSublayer(0,Jr.ReadOnly),r=d[p.overscaledZ],{tileBoundsBuffer:i,tileBoundsIndexBuffer:o,tileBoundsSegments:l}=t.getTileBoundsBuffers(s);M.draw(t,a.TRIANGLES,e,r,Yr.alphaBlended,nn.disabled,k,n.id,i,o,l)}}t.resetStencilClippingMasks()}(t,r,n,i),t.style.map.triggerRepaint())},background:function(t,r,n,i){const o=n.paint.get("background-color"),a="none"===n.paint.get("background-color-use-theme").constantOr("default"),s=n.paint.get("background-opacity"),l=n.paint.get("background-emissive-strength"),c="viewport"===n.paint.get("background-pitch-alignment");if(0===s)return;const u=t.context,d=u.gl,h=t.transform,A=h.tileSize,f=n.paint.get("background-pattern");let p;if(void 0!==f){if(null===f)return;if(p=t.imageManager.getPattern(e.I.from(f.toString()),n.scope,t.style.getLut(n.scope)),!p)return}const m=!f&&1===o.a&&1===s&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==m)return;const g=en.disabled,y=t.depthModeForSublayer(0,"opaque"===m?Jr.ReadWrite:Jr.ReadOnly),_=t.colorModeForDrapableLayerRenderPass(l),v=f?"backgroundPattern":"background";let x,w=i;w||(x=t.getBackgroundTiles(),w=Object.values(x).map(e=>e.tileID)),f&&(u.activeTexture.set(d.TEXTURE0),t.imageManager.bind(t.context,n.scope));const b=[];if(t.terrain&&t.terrain.renderingToTexture&&"mrt-fallback"===t.emissiveMode&&b.push("USE_MRT1"),c){const r=t.getOrCreateProgram(v,{overrideFog:!1,overrideRtt:!0,defines:b}),i=new Float32Array(e.bA([])),u=new e.aQ(0,0,0,0,0),h=f?Ko(i,l,s,t,0,n.scope,p,c,{tileID:u,tileSize:A}):Go(i,l,s,o.toPremultipliedRenderColor(a?null:n.lut));r.draw(t,d.TRIANGLES,y,g,_,nn.disabled,h,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}else for(const e of w){const m=t.isTileAffectedByFog(e),w=t.getOrCreateProgram(v,{overrideFog:m,defines:b}),B=e.toUnwrapped(),C=i?e.projMatrix:t.transform.calculateProjMatrix(B);t.prepareDrawTile();const E=r?r.getTile(e):x?x[e.key]:new Lt(e,A,h.zoom,t),S=f?Ko(C,l,s,t,0,n.scope,p,c,{tileID:e,tileSize:A}):Go(C,l,s,o.toPremultipliedRenderColor(a?null:n.lut));t.uploadCommonUniforms(u,w,B);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:I,tileBoundsSegments:F}=t.getTileBoundsBuffers(E);w.draw(t,d.TRIANGLES,y,g,_,nn.disabled,S,n.id,T,I,F)}},sky:function(t,r,n){const i=t._atmosphere?e.aj(t.transform.zoom):1,o=n.paint.get("sky-opacity")*i;if(0===o)return;const a=t.context,s=n.paint.get("sky-type"),l=new Jr(a.gl.LEQUAL,Jr.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===s?"offscreen"===t.renderPass?n.needsSkyboxCapture(t)&&(function(t,r){const n=t.context,i=n.gl;let o=r.skyboxFbo;if(!o){o=r.skyboxFbo=n.createFramebuffer(32,32,1,null),r.skyboxGeometry=new Ha(n),r.skyboxTexture=n.gl.createTexture(),i.bindTexture(i.TEXTURE_CUBE_MAP,r.skyboxTexture),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR);for(let e=0;e<6;++e)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,i.RGBA,32,32,0,i.RGBA,i.UNSIGNED_BYTE,null)}n.bindFramebuffer.set(o.framebuffer),n.viewport.set([0,0,32,32]);const a=r.getCenter(t,!0),s=t.getOrCreateProgram("skyboxCapture"),l=new Float64Array(16);e.bA(l),e.en(l,l,.5*-Math.PI),Ga(t,r,s,l,a,0),e.bA(l),e.en(l,l,.5*Math.PI),Ga(t,r,s,l,a,1),e.bA(l),e.cU(l,l,.5*-Math.PI),Ga(t,r,s,l,a,2),e.bA(l),e.cU(l,l,.5*Math.PI),Ga(t,r,s,l,a,3),e.bA(l),Ga(t,r,s,l,a,4),e.bA(l),e.en(l,l,Math.PI),Ga(t,r,s,l,a,5),n.viewport.set([0,0,t.width,t.height])}(t,n),n.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,r,n,i){const o=e.context,a=o.gl,s=e.transform,l=e.getOrCreateProgram("skybox");o.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,r,n,i)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:n,u_temporal_offset:i}))(s.skyboxMatrix,t.getCenter(e,!1),0,n,i);e.uploadCommonUniforms(o,l),l.draw(e,a.TRIANGLES,r,en.disabled,e.colorModeForRenderPass(),nn.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(t,n,l,o,c):"gradient"===s&&"sky"===t.renderPass&&function(t,r,n,i,o){const a=t.context,s=a.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");r.skyboxGeometry||(r.skyboxGeometry=new Ha(a)),a.activeTexture.set(s.TEXTURE0);let u=r.colorRampTexture;u||(u=r.colorRampTexture=new e.T(a,r.colorRamp,s.RGBA8)),u.bind(s.LINEAR,s.CLAMP_TO_EDGE);const d=((t,r,n,i,o)=>({u_matrix:t,u_color_ramp:0,u_center_direction:r,u_radius:e.an(n),u_opacity:i,u_temporal_offset:o}))(l.skyboxMatrix,r.getCenter(t,!1),r.paint.get("sky-gradient-radius"),i,o);t.uploadCommonUniforms(a,c),c.draw(t,s.TRIANGLES,n,en.disabled,t.colorModeForRenderPass(),nn.backCW,d,"skyboxGradient",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}(t,n,l,o,c)},custom:function(t,r,n,i){const o=t.context,a=n.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&n.isDraped(r)){if("offscreen"===t.renderPass){const r=a.prerender;if(r){if(t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const n=t.transform.pointMerc;r.call(a,o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.aj(t.transform.zoom),[n.x,n.y],t.transform.pixelsPerMeterRatio)}else r.call(a,o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const e=a.renderToTile;if(e){const r=i[0].canonical,n={x:r.x+i[0].wrap*(a.wrapTileId?0:1<<r.z),y:r.y,z:r.z};o.setDepthMode(Jr.disabled),o.setStencilMode(en.disabled),o.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),e.call(a,o.gl,n),o.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),o.setColorMode(t.colorModeForRenderPass()),o.setStencilMode(en.disabled);const r="3d"===a.renderingMode?new Jr(t.context.gl.LEQUAL,Jr.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Jr.ReadOnly);if(o.setDepthMode(r),"globe"===t.transform.projection.name){const r=t.transform.pointMerc;a.render(o.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.aj(t.transform.zoom),[r.x,r.y],t.transform.pixelsPerMeterRatio)}else a.render(o.gl,t.transform.customLayerMatrix());o.setDirty(),t.setBaseState(),o.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,r,n,i){if("opaque"===t.renderPass)return;const o=n.paint.get("model-opacity").constantOr(1),a=n.paint.get("model-elevation-reference"),s="ground"===a,l="ground"===a;if(0===o)return;const c=n.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!c)return;if(t.terrain&&o<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof e.ad)return}const u=t.shadowRenderer,d=n.paint.get("model-receive-shadows");u&&(u.useNormalOffset=!0,d||(u.enabled=!1));const h=()=>{u&&(u.useNormalOffset=!0,d||(u.enabled=!0))},A=r.getSource();if("light-beam"===t.renderPass&&"batched-model"!==A.type)return;if("vector"===A.type||"geojson"===A.type)return function(t,r,n,i,o){const a=t.transform,s="globe"===a.projection.name,l=a.getFreeCameraOptions().position;if(!t.modelManager)return;const c=t.modelManager;n.modelManager=c;const u=t.shadowRenderer;if(!n._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const d=n._unevaluatedLayout._values["model-id"],h=Object.assign({},n.layout.get("model-id").parameters),A=t.style.order.indexOf(n.fqid),f=n.paint.get("model-opacity").constantOr(1);for(const p of i){const i=r.getTile(p).getBucket(n);if(!i||i.projection.name!==a.projection.name)continue;const m=i.getModelUris();if(m&&!i.modelsRequested&&(c.addModelsFromBucket(m,o),i.modelsRequested=!0),s)h.zoom=p.overscaledZ;else{const e=cs(p,a);h.zoom=e}const g=d.possiblyEvaluate(h);if(ss(t,i,p),ls.shadowUniformsInitialized=!1,ls.useSingleShadowCascade=!!u&&0===u.getMaxCascadeForTile(p.toUnwrapped()),"shadow"===t.renderPass&&u){if(1===t.currentShadowCascade&&i.isInsideFirstShadowMapFrustum)continue;const r=a.calculatePosMatrix(p.toUnwrapped(),a.worldSize);if(ls.tileMatrix.set(r),ls.shadowTileMatrix=Float32Array.from(u.calculateShadowPassMatrixFromMatrix(r)),ls.aabb.min=[0,0,0],ls.aabb.max[0]=ls.aabb.max[1]=e.al,ls.aabb.max[2]=0,hs(i,ls,t,n.scope))continue}const y=1<<p.canonical.z,_=[((l.x-p.wrap)*y-p.canonical.x)*e.al,(l.y*y-p.canonical.y)*e.al,l.z*y*e.al];t.conflationActive&&Object.keys(i.instancesPerModel).length>0&&t.style.isLayerClipped(n,r.getSource())&&i.updateReplacement(p,t.replacementSource,A,n.scope)&&(i.uploaded=!1,i.upload(t.context));let v=0;const x=new Array,w=new Array,b=new Array;for(let r in i.instancesPerModel){const a=i.instancesPerModel[r];a.features.length>0&&!s&&(r=g.evaluate(a.features[0].feature,{}));const u=c.getModel(r,o);if(u||c.hasURLBeenRequested(r)||i.modelUris.includes(r)||(i.modelUris.push(r),i.modelsRequested=!1),u&&u.uploaded)if(s){const r=e.c5([],[l.x,l.y,l.z],t.transform.worldSize);e.ew(r,r);for(let n=0;n<a.instancedDataArray.length;++n){const o=[0,0,0],s=[1,1,1],l=e.ex(),c=a.tileCoordinatesForInstance(n),d=a.transformForInstance(n);e.ey(s,d),e.ez(l,d),e.eA(o,l);const h=a.translationForInstance(n),A=new e.aT(0,0);e.eB(i.canonical,A,c.x,c.y);const p=e.bC();e.eC(p,u,t.transform,A,o,s,h,!0,!1,!1);const m=a.colorForInstance(n),g=e.bA([]),y=e.ef(A.lat,t.transform.zoom),_=e.bq([],[1,1,1/y]);e.br(g,g,r),b.push({zScaleMatrix:_,negCameraPosMatrix:g});for(const e of u.nodes)rs(t,e,p,t.transform.expandedFarZProjMatrix,v,x,w,u.materialOverrides,f,m);++v}}else for(const e of u.nodes)us(t,n,e,a,_,p,ls)}if(s)if("shadow"===t.renderPass){for(const e of w)ns(e.mesh,e.nodeModelMatrix,t,n);for(const e of x)ns(e.mesh,e.nodeModelMatrix,t,n)}else as(t,n,x,w,b)}}(t,r,n,i,ts(t,n)),void h();if(!A.loaded())return;if("batched-model"===A.type)return function(t,r,n,i){n.resetLayerRenderingStats(t);const o=t.context,a=t.transform,s=t.style.fog,l=t.shadowRenderer;if("mercator"!==a.projection.name)return void e.w("Drawing 3D landmark models for ".concat(a.projection.name," projection is not yet implemented"));const c=t.transform.getFreeCameraOptions().position,u=e.c5([],[c.x,c.y,c.z],t.transform.worldSize),d=e.ew([],u),h=e.bA([]),A=e.ef(a.center.lat,a.zoom),f=e.bq([],[1,1,1/A]);e.br(h,h,d);const p=n.paint.get("model-opacity").constantOr(1),m=new Jr(o.gl.LEQUAL,Jr.ReadWrite,t.depthRangeFor3D),g=new Jr(o.gl.LEQUAL,Jr.ReadOnly,t.depthRangeFor3D),y=new e.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),_="shadow"===t.renderPass,v=_&&l?l.getCurrentCascadeFrustum():a.getFrustum(a.scaleZoom(a.worldSize)),x=n.paint.get("model-front-cutoff"),w=x[2]<1,b=fn(t,n.paint.get("model-cutoff-fade-range")),B=n.getLayerRenderingStats();(function(e,t,r,n){const i=e.terrain?e.terrain.exaggeration():0,o=e.transform.zoom;for(const a of n){const n=t.getTile(a).getBucket(r);n&&(n.setFilter(r.filter),e.conflationActive&&n.updateReplacement(a,e.replacementSource),n.evaluateTransform(e,r),e.terrain&&i>0&&n.elevationUpdate(e.terrain,i,a,r.source),n.needsReEvaluation(e,o,r)&&n.evaluate(r))}})(t,r,n,i),function(){let c,d,C;w?(c=i.length-1,d=-1,C=-1):(c=0,d=i.length,C=1);const E=new Float64Array(16),S=e.cA(),T=new e.P(0,0);for(let I=c;I!==d;I+=C){const c=i[I],d=r.getTile(c).getBucket(n);if(!d||!d.uploaded)continue;let C=!1;l&&(C=0===l.getMaxCascadeForTile(c.toUnwrapped()));const F=a.calculatePosMatrix(c.toUnwrapped(),a.worldSize),k=d.modelTraits;!_&&w&&(e.bl(E,F),e.af(S,u,E),T.x=S[0],T.y=S[1]);const P=[];d.setFilter(n.filter);for(const r of d.getNodesInfo()){if(r.hiddenByReplacement)continue;if(!r.node.meshes)continue;const n=r.node;let i=0;t.terrain&&n.elevation&&(i=n.elevation*t.terrain.exaggeration());const o=(()=>{const t=r.aabb;return y.min=[...t.min],y.max=[...t.max],y.min[2]+=i,y.max[2]+=i,e.af(y.min,y.min,F),e.af(y.max,y.max,F),y})(),s=r.evaluatedScale;if(s[0]<=1&&s[1]<=1&&s[2]<=1&&0===o.intersects(v))continue;if(!_&&w){const t=1/6;r.cameraCollisionOpacity=u[0]>o.min[0]&&u[0]<o.max[0]&&u[1]>o.min[1]&&u[1]<o.max[1]&&u[2]*A<o.max[2]&&n.footprint&&e.c0(T,n.footprint)?Math.max(r.cameraCollisionOpacity-t,0):Math.min(1,r.cameraCollisionOpacity+t)}const l=[...F],d=1/e.d7(c.canonical),h=n.anchor?n.anchor[0]:0,f=n.anchor?n.anchor[1]:0;e.br(l,l,[h*(s[0]-1)+r.evaluatedTranslation[0]*d,f*(s[1]-1)+r.evaluatedTranslation[1]*d,i+r.evaluatedTranslation[2]]),e.cq(s,e.eE)||e.cS(l,l,s);const m=e.aB([],l,n.globalMatrix),g=e.aB([],a.expandedFarZProjMatrix,m),B=e.aB([],a.expandedFarZProjMatrix,l),C=e.aC([],[h,f,i,1],g)[2];n.hidden=!1;let E=p;_||(w&&(E*=r.cameraCollisionOpacity,E*=fs(l,a,r.aabb,x)),E*=As(b,C)),0!==E?P.push({nodeInfo:r,depth:C,opacity:E,wvpForNode:g,wvpForTile:B,nodeModelMatrix:m,tileModelMatrix:l}):n.hidden=!0}_||P.sort((e,t)=>!w||1===e.opacity&&1===t.opacity?e.depth<t.depth?-1:1:1===e.opacity?-1:1===t.opacity?1:e.depth>t.depth?-1:1);for(const r of P){const i=r.nodeInfo,c=i.node;let u=e.aB([],f,r.tileModelMatrix);e.aB(u,h,u);const d=e.bl([],u);e.eg(d,d),e.cS(d,d,ds),u=e.aB(u,u,c.globalMatrix);const A="light-beam"===t.renderPass,p="none"===n.paint.get("model-color-use-theme").constantOr("default"),y=k&e.eI.HasMapboxMeshFeatures,v=y?0:i.evaluatedRMEA[0][2];for(let e=0;e<c.meshes.length;++e){const h=c.meshes[e],f=e===c.lightMeshIndex;let x=r.wvpForNode;if(f){if(!A&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}x=r.wvpForTile}else if(A)continue;const w={defines:[]},b=[];if(!_&&l&&(l.useNormalOffset=!!h.normalBuffer),$a(w.defines,b,h,t,p?null:n.lut),y||w.defines.push("DIFFUSE_SHADED"),C&&w.defines.push("SHADOWS_SINGLE_CASCADE"),B&&(_?B.numRenderedVerticesInShadowPass+=h.vertexArray.length:B.numRenderedVerticesInTransparentPass+=h.vertexArray.length),_){ns(h,r.nodeModelMatrix,t,n);continue}let E=null;if(s){const e=Ja(r.nodeModelMatrix,t.transform);if(E=new Float32Array(e),"globe"!==a.projection.name){const t=h.aabb.min,r=h.aabb.max,[n,i]=s.getOpacityForBounds(e,t[0],t[1],r[0],r[1]);w.overrideFog=n>=We||i>=We}}const S=h.material;let T;S.occlusionTexture&&S.occlusionTexture.offsetScale&&(T=S.occlusionTexture.offsetScale,w.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const I=t.getOrCreateProgram("model",w);!_&&l&&l.setupShadowsFromMatrix(r.tileModelMatrix,I,l.useNormalOffset),t.uploadCommonUniforms(o,I,null,E);const F=S.pbrMetallicRoughness;F.metallicFactor=.9,F.roughnessFactor=.5;const k=qo(new Float32Array(x),new Float32Array(u),new Float32Array(d),new Float32Array(c.globalMatrix),t,r.opacity,F.baseColorFactor,S.emissiveFactor,F.metallicFactor,F.roughnessFactor,S,v,n,[0,0,0],T);!f&&(i.hasTranslucentParts||r.opacity<1)&&I.draw(t,o.gl.TRIANGLES,m,en.disabled,Yr.disabled,nn.backCCW,k,n.id,h.vertexBuffer,h.indexBuffer,h.segments,n.paint,t.transform.zoom,void 0,b),I.draw(t,o.gl.TRIANGLES,f?g:m,en.disabled,f||r.opacity<1||i.hasTranslucentParts?Yr.alphaBlended:Yr.unblended,nn.backCCW,k,n.id,h.vertexBuffer,h.indexBuffer,h.segments,n.paint,t.transform.zoom,void 0,b)}}}}()}(t,r,n,i),void h();if("model"!==A.type)return;const f=A.getModels(),p=[],m=t.transform.getFreeCameraOptions().position,g=e.c5([],[m.x,m.y,m.z],t.transform.worldSize);e.ew(g,g);const y=[],_=[];let v=0;for(const x of f){const i=r.getFeatureState("",x.id),o={type:"Unknown",id:x.id,properties:x.featureProperties},a=n.paint.get("model-rotation").evaluate(o,i),c=n.paint.get("model-scale").evaluate(o,i),u=n.paint.get("model-translation").evaluate(o,i),d=n.paint.get("model-opacity").evaluate(o,i);is(n,x.id,i,x.featureProperties,x.nodeOverrideNames,x.nodeOverrides),os(n,x.id,i,x.featureProperties,x.materialOverrideNames,x.materialOverrides),x.nodeOverrides.size>0&&x.computeBoundsAndApplyParent(),x.computeModelMatrix(t,a,c,u,l,s,!1);const h=e.bA([]),A=e.ef(x.position.lat,t.transform.zoom),f=e.bq([],[1,1,1/A]);e.br(h,h,g),p.push({zScaleMatrix:f,negCameraPosMatrix:h});for(const e of x.nodes)rs(t,e,x.matrix,t.transform.expandedFarZProjMatrix,v,y,_,x.materialOverrides,d);v++}if(y.sort((e,t)=>t.depth-e.depth),"shadow"!==t.renderPass)as(t,n,y,_,p),h();else{for(const e of _)ns(e.mesh,e.nodeModelMatrix,t,n);for(const e of y)ns(e.mesh,e.nodeModelMatrix,t,n);h()}}},ks={line:function(e,t,r){if(e.hasElevatedBuckets=!1,e.hasNonElevatedBuckets=!1,void 0!==e._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==e._unevaluatedLayout.getValue("line-z-offset")){if(t){const r=t.getVisibleCoordinates();for(const n of r){const r=t.getTile(n).getBucket(e);if(r&&("none"!==r.elevationType?e.hasElevatedBuckets=!0:e.hasNonElevatedBuckets=!0,e.hasElevatedBuckets&&e.hasNonElevatedBuckets))break}}}else e.hasNonElevatedBuckets=!0},model:function(e,t,r){const n=t.getSource();if(!n.loaded())return;if("vector"===n.type||"geojson"===n.type)return void(r.modelManager&&r.modelManager.upload(r,ts(r,e)));if("batched-model"===n.type)return;if("model"!==n.type)return;const i=n.getModels();for(const o of i)o.upload(r.context)},raster:function(e,t,r){const n=t.getSource();if(!(n instanceof gt&&n.loaded()))return;const i=e.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!i)return;const o=e.paint.get("raster-array-band")||n.getInitialBand(i);if(null==o)return;const a=t.getIds().map(e=>t.getTileByID(e));for(const s of a)s.updateNeeded(e.id,o)&&n.prepareTile(s,i,e.id,o)},"raster-particle":function(e,t,r){const n=t.getSource();if(!(n instanceof gt&&n.loaded()))return;const i=e.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!i)return;const o=e.paint.get("raster-particle-array-band")||n.getInitialBand(i);if(null==o)return;const a=t.getIds().map(e=>t.getTileByID(e));for(const s of a)s.updateNeeded(e.id,o)&&n.prepareTile(s,i,e.id,o)}},Ps={fill:da},Ms={fill:function(e,t,r,n){if(!r.layout||"none"===r.layout.get("fill-elevation-reference")||0===r.paint.get("fill-opacity").constantOr(1))return;const i=e.context.gl,o=new Jr(i.LEQUAL,Jr.ReadOnly,e.depthRangeFor3D),a=new en({func:i.ALWAYS,mask:255},255,255,i.KEEP,i.KEEP,i.REPLACE),s=e.transform.getFreeCameraOptions().position,l=e.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const c of n){const n=t.getTile(c),u=n.getBucket(r);if(!u)continue;const d=u.elevatedStructures;if(!d||0===d.depthSegments.segments[0].primitiveLength)continue;const h=ua(c.toUnwrapped(),s),A=e.translatePosMatrix(c.projMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),f=So(A,h,0,1,0);l.draw(e,i.TRIANGLES,o,a,Yr.disabled,nn.disabled,f,r.id,d.vertexBuffer,d.indexBuffer,d.depthSegments,r.paint,e.transform.zoom)}}};class Os{constructor(t,r,n,i,o){this.context=new ta(t,r),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=e.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const a=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const e of a)this._debugParams.enabledLayers[e]=!0;for(const e of a);this.occlusionParams=new gs,this.setup(),this.numSublayers=zt.maxUnderzooming+zt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new yn(this),this._wireframeDebugCache=new ms,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const s=new e.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new e.T(this.context,s,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=i,this.worldview=o,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(e,t){const r=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new co(this,e));const n=this._terrain;this.transform.elevation=r?n:null,n.update(e,this.transform,t),this.transform.elevation&&!n.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,n]=t.getFovAdjustedRange(this.transform._fov);if(r>n)return void(this.transform.fogCullDistSq=null);const i=r+.78*(n-r);this.transform.fogCullDistSq=i*i}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(e){e&&!this._terrain&&(this._terrain=new co(this,this.style)),this._forceTerrainMode=e}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*e.o.devicePixelRatio,this.height=r*e.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,r=new e.bd;r.emplaceBack(0,0),r.emplaceBack(e.al,0),r.emplaceBack(0,e.al),r.emplaceBack(e.al,e.al),this.tileExtentBuffer=t.createVertexBuffer(r,e.bf.members),this.tileExtentSegments=e.bg.simpleSegment(0,0,4,2);const n=new e.bd;n.emplaceBack(0,0),n.emplaceBack(e.al,0),n.emplaceBack(0,e.al),n.emplaceBack(e.al,e.al),this.debugBuffer=t.createVertexBuffer(n,e.bf.members),this.debugSegments=e.bg.simpleSegment(0,0,4,5);const i=new e.bd;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(-1,1),i.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(i,e.bf.members),this.viewportSegments=e.bg.simpleSegment(0,0,4,2);const o=new e.b1;o.emplaceBack(0,0,0,0),o.emplaceBack(e.al,0,e.al,0),o.emplaceBack(0,e.al,0,e.al),o.emplaceBack(e.al,e.al,e.al,e.al),this.mercatorBoundsBuffer=t.createVertexBuffer(o,e.bi.members),this.mercatorBoundsSegments=e.bg.simpleSegment(0,0,4,2);const a=new e.b0;a.emplaceBack(0,1,2),a.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(a);const s=new e.be;for(const e of[0,1,3,2,0])s.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(s),this.emptyTexture=new e.T(t,new e.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=e.bC();const l=this.context.gl;this.stencilClearMode=new en({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Jr.disabled,this.stencilClearMode,Yr.disabled,nn.disabled,io(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,r){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!r||0===r.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of r)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const n=this.context,i=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(Yr.disabled),n.setDepthMode(Jr.disabled);const o=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const a of r){const e=t.getTile(a),r=this._tileClippingMaskIDs[a.key]=this.nextStencilID++,{tileBoundsBuffer:n,tileBoundsIndexBuffer:s,tileBoundsSegments:l}=this.getTileBoundsBuffers(e);o.draw(this,i.TRIANGLES,Jr.disabled,new en({func:i.ALWAYS,mask:0},r,255,i.KEEP,i.KEEP,i.REPLACE),Yr.disabled,nn.disabled,io(a.projMatrix),"$clipping",n,s,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new en({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new en({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,r=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),n=r[r.length-1].overscaledZ,i=r[0].overscaledZ-n+1;if(i>1){this.currentStencilSource=void 0,this.nextStencilID+i>256&&this.clearStencil();const e={};for(let r=0;r<i;r++)e[r+n]=new en({func:t.GEQUAL,mask:255},r+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=i,[e,r]}return[{[n]:en.disabled},r]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const r=1/8;return new Yr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.ao(r,r,r,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Yr.unblended:Yr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?null!=t&&"mrt-fallback"!==this.emissiveMode||"constant"===this.emissiveMode?new Yr([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new e.ao(0,0,0,null!=t?t:0),[!0,!0,!0,!0]):"dual-source-blending"===this.emissiveMode?new Yr([r.ONE,r.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,r.ONE_MINUS_SRC_ALPHA],e.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.depthOcclusion)return new Jr(this.context.gl.GREATER,Jr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!n)return Jr.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Jr(r||this.context.gl.LEQUAL,t,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),n=Math.ceil(this.height),i=this.context.bindFramebuffer.get(),o=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===n||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==r&&0!==n&&(this.depthFBO=new ea(this.context,r,n,0,"texture"),this.depthTexture=new e.T(this.context,{width:r,height:n,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(i),t.bindTexture(t.TEXTURE_2D,o),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,n,0,0,r,n,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((e,t)=>e+t/this._fpsHistory.length,0))}render(t,r){const n=e.o.now();this._dt=n-this._timeStamp,this._timeStamp=n,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const i=this.style._mergedLayers,o=!(!this.terrain||!this.terrain.enabled),a=()=>this.style._getOrder(o).filter(e=>{const t=i[e];return!(t.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[t.type]});let s=a(),l=!1,c=!1,u=null,d=0,h=!1;for(const e of s){const t=i[e];"none"!==t.visibility&&("circle"===t.type?l=!0:"building"===t.type?(u=t,++d):"symbol"===t.type&&(t.hasOcclusionOpacityProperties?c=!0:l=!0))}this.updateEmissiveMode();let A=s.map(e=>i[e]);const f=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.o.now()),this.imageManager.beginFrame();for(const e in f){const t=f[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++d)}let p=!1;for(const e of A)e.isHidden(this.transform.zoom)||("clip"===e.type&&(p=!0),this.prepareLayer(e));const m={},g={},y={},_={},v={};for(const e in f){const t=f[e];m[e]=t.getVisibleCoordinates(),g[e]=m[e].slice().reverse(),y[e]=t.getVisibleCoordinates(!0).reverse(),_[e]=t.getShadowCasterCoordinates(),v[e]=t.sortCoordinatesByDistance(m[e])}const x=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(d||p||this._clippingActiveLastFrame){const t=[],r=[];let n=0;for(const e of A)this.isSourceForClippingOrConflation(e,x(e))&&(t.push(e),r.push(n)),n++;if(t&&(p||t.length>1)||this._clippingActiveLastFrame){p=!1;const n=[];for(let i=0;i<t.length;i++){const o=t[i],a=r[i],s=this.style.getLayerSourceCache(o);if(!s||!s.used||!s.getSource().usedInConflation&&"clip"!==o.type&&"building"!==o.type)continue;let l=e.eQ,c=e.b_.None;const u=[];let d=!0;if("building"===o.type)l=e.eS;else if("clip"===o.type){l=a;for(const t of o.layout.get("clip-layer-types"))c|="model"===t?e.b_.Model:"symbol"===t?e.b_.Symbol:e.b_.FillExtrusion;for(const e of o.layout.get("clip-layer-scope"))u.push(e);o.isHidden(this.transform.zoom)?d=!1:p=!0}d&&n.push({layer:o.fqid,cache:s,order:l,clipMask:c,clipScope:u})}this.replacementSource.setSources(n),h=!0}}this._clippingActiveLastFrame=p,h||this.replacementSource.clear(),this.conflationActive=h,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let e=0;e<A.length;e++){const t=A[e];if("none"===t.visibility)continue;const r=t.cutoffRange();if(this.longestCutoffRange=Math.max(r,this.longestCutoffRange),r>0){const e=x(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}t.is3D(o)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=e),this._lastOcclusionLayer=e)}const w=this.style&&this.style.fog;w?(this._fogVisible=0!==w.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=w.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(y),this.opaquePassCutoff=0,s=a(),A=s.map(e=>i[e]));const b=this._shadowRenderer;if(b){b.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in f)for(const t of m[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),b.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Xa(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const B=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),C=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(B&&!this._snow&&(this._snow=new Is(this)),!B&&this._snow&&(this._snow.destroy(),delete this._snow),C&&!this._rain&&(this._rain=new Ss(this)),!C&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),u){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Ya);const e=this.style.getLayerSourceCache(u);this.buildingTileBorderManager.updateBorders(e,u)}if(!q.has(this.context.gl))return;this.renderPass="offscreen";for(const e of A){const r=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const n=r?g[r.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||n&&n.length)&&this.renderLayer(this,r,e,n)}this.depthRangeFor3D=[0,1-(A.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,_)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const E="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),S=(()=>{if(r.showOverdrawInspector)return e.ao.black;const t=this.style.fog;if(t&&this.transform.projection.supportsFog){const r=this.style.getLut(t.scope);if(!E){const n="none"===t.properties.get("color-use-theme"),i=t.properties.get("color").toNonPremultipliedRenderColor(n?null:r).toArray01();return new e.ao(...i)}if(E){const n="none"===t.properties.get("space-color-use-theme"),i=t.properties.get("space-color").toNonPremultipliedRenderColor(n?null:r).toArray01();return new e.ao(...i)}}return e.ao.transparent})();if(this.context.clear({color:S,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&E&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=s.length-1;this.currentLayer>=0;this.currentLayer--){const e=A[this.currentLayer],r=t.getLayerSourceCache(e);if(e.isSky())continue;const n=r?(e.is3D(o)?v:g)[r.id]:void 0;this._renderTileClippingMasks(e,r,n),this.renderLayer(this,r,e,n)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&E&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.aj(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<s.length;this.currentLayer++){const e=A[this.currentLayer],r=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,r,e,r?g[r.id]:void 0)}function T(e,t){let r;return t&&(r=("symbol"===e.type?y:e.is3D(o)?v:g)[t.id]),r}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<s.length;){const e=A[this.currentLayer];if("raster"===e.type||"raster-particle"===e.type){const r=t.getLayerSourceCache(e);this.renderLayer(this,r,e,T(e,r))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let I=0;b&&(I=b.getShadowCastingLayerCount());let F=!1,k=-1;for(let e=0;e<s.length;++e){const t=A[e];t.isHidden(this.transform.zoom)||t.is3D(o)&&(k=e)}c&&-1===k&&(l=!0);let P=!1;for(;this.currentLayer<s.length;){const e=A[this.currentLayer],r=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!P&&e.is3D(o)&&!o){const e=this.currentLayer,t=e=>{for(this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const t=A[this.currentLayer];if(Ps[t.type]){const r=this.style.getLayerSourceCache(t);Ps[t.type](this,r,t,T(t,r),e)}}};t("initialize"),t("reset"),this.currentLayer=e,P=!0}if(l&&!F&&this.terrain&&!this.transform.isOrthographic&&(F=!0,this.blitDepth()),c&&-1!==k&&this.currentLayer===k+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(e,r,r?m[r.id]:void 0),this.renderLayer(this,r,e,T(e,r)),!this.terrain&&b&&I>0&&e.hasShadowPass()&&0==--I){{this.clearStencil(),this.resetStencilClippingMasks();const e=this.currentLayer;for(this.currentLayer=0;this.currentLayer<A.length;this.currentLayer++){const e=A[this.currentLayer];if(Ms[e.type]){const t=this.style.getLayerSourceCache(e);Ms[e.type](this,t,e,T(e,t))}}this.currentLayer=e}if(b.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=A[this.currentLayer];if(!e.hasLightBeamPass())continue;const r=t.getLayerSourceCache(e);this.renderLayer(this,r,e,r?g[r.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const e=this.currentLayer;this.depthOcclusion=!0;for(const r of this.layersWithOcclusionOpacity){this.currentLayer=r;const e=A[this.currentLayer],n=t.getLayerSourceCache(e),i=n?g[n.id]:void 0;this.terrain||this._renderTileClippingMasks(e,n,n?m[n.id]:void 0),this.renderLayer(this,n,e,i)}this.depthOcclusion=!1,this.currentLayer=e,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let r=null;A.forEach(e=>{const n=t.getLayerSourceCache(e);n&&!e.isHidden(this.transform.zoom)&&n.getVisibleCoordinates().length&&(!r||r.getSource().maxzoom<n.getSource().maxzoom)&&(r=n)}),r&&this.options.showTileBoundaries&&Da(this,r,r.getVisibleCoordinates(),e.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Da(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;Ra(e,e.transform.height-(t.top||0),3,ka),Ra(e,t.bottom||0,3,Pa),za(e,t.left||0,3,Ma),za(e,e.transform.width-(t.right||0),3,Oa);const r=e.transform.centerPoint;!function(e,t,r,n){Na(e,t-1,r-10,2,20,n),Na(e,t-10,r-1,20,2,n)}(e,r.x,e.transform.height-r.y,La)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),h||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,r=!t||!t.includes(e.type);if(ks[e.type]&&(r||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);ks[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,r,n){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||"model"===r.type||"raster"===r.type||"raster-particle"===r.type||n&&n.length)&&(this.id=r.id,this.gpuTimingStart(r),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(r.type)&&(!e.terrain||"custom"!==r.type)||"clip"===r.type||Fs[r.type](e,t,r,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,r=this.context.gl;let n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:r.createQuery()}),n.calls++,r.beginQuery(t.TIME_ELAPSED_EXT,n.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,r=t.createQuery();this.deferredRenderGpuTimeQueries.push(r),t.beginQuery(e.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const r in e){const n=e[r],i=this.context.extTimerQuery,o=i.getQueryParameter(n.query,this.context.gl.QUERY_RESULT)/1e6;i.deleteQueryEXT(n.query),t[r]=o}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.gl;let r=0;for(const n of e)r+=t.getQueryParameter(n,t.QUERY_RESULT)/1e6,t.deleteQuery(n);return r}translatePosMatrix(t,r,n,i,o){if(!n[0]&&!n[1])return t;const a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){const e=Math.sin(a),t=Math.cos(a);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}const s=[o?n[0]:e.ay(r,n[0],this.transform.zoom),o?n[1]:e.ay(r,n[1],this.transform.zoom),0],l=new Float32Array(16);return e.br(l,t,s),l}saveTileTexture(e){if(e.context!==this.context)return;const t=e.size[0],r=this._tileTextures[t];r?r.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,r){const n=void 0===r?this.terrain&&this.terrain.renderingToTexture:r,i=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(i.push("LIGHTING_3D_MODE"),i.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):n||i.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||i.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(i.push("TERRAIN"),this.linearFloatFilteringSupported()&&i.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&i.push("GLOBE"),!this._fogVisible||n||void 0!==t&&!t||i.push("FOG","FOG_DITHERING"),n&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}getOrCreateProgram(e,t){this.cache=this.cache||{};const r=t&&t.defines||[],n=t&&t.config,i=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(r),o=fo.cacheKey(oi[e],e,i,n);return this.cache[o]||(this.cache[o]=new fo(this.context,e,oi[e],n,Xo[e],i)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const n=this.style.directionalLight,i=this.style.ambientLight;if(n&&i){const o=((t,r,n)=>{const i=t.properties.get("direction"),o="none"===t.properties.get("color-use-theme"),a=t.properties.get("color").toNonPremultipliedRenderColor(o?null:n.getLut(t.scope)).toArray01(),s=t.properties.get("intensity"),l="none"===r.properties.get("color-use-theme"),c=r.properties.get("color").toNonPremultipliedRenderColor(l?null:n.getLut(r.scope)).toArray01(),u=r.properties.get("intensity"),d=[i.x,i.y,i.z],h=e.dN(c,u),A=e.dN(a,s);return{u_lighting_ambient_color:h,u_lighting_directional_dir:d,u_lighting_directional_color:A,u_ground_radiance:uo(d,A,h)}})(n,i,this.style);r.setLightsUniformValues(t,o)}}}uploadCommonUniforms(t,r,n,i,o){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const a=this.style.fog;if(a){const o=a.getOpacity(this.transform.pitch),s=((t,r,n,i,o,a,s,l,c,u,d,h)=>{const A=t.transform,f="none"===r.properties.get("color-use-theme"),p=r.properties.get("color").toNonPremultipliedRenderColor(f?null:t.style.getLut(r.scope)).toArray01();p[3]=i;const m=t.frameCounter/1e3%1,[g,y]=r.properties.get("vertical-range");return{u_fog_matrix:n?A.calculateFogTileMatrix(n):h||t.identityMat,u_fog_range:r.getFovAdjustedRange(A._fov),u_fog_color:p,u_fog_horizon_blend:r.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(g,y),y],u_fog_temporal_offset:m,u_frustum_tl:o,u_frustum_tr:a,u_frustum_br:s,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:d,u_globe_transition:e.aj(A.zoom),u_is_globe:+("globe"===A.projection.name)}})(this,a,n,o,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.o.devicePixelRatio,this.transform.height*e.o.devicePixelRatio],i);r.setFogUniformValues(t,s)}o&&r.setCutoffUniformValues(t,o.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const n of r)t[n.key]=e[n.key]||new Lt(n,512,this.transform.tileZoom,this,void 0,this.worldview);return t}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(e,t){return!(!e.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==e.type&&"building"!==e.type&&(e.minzoom&&e.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==e.sourceLayer&&"procedural_buildings"!==e.sourceLayer)&&(!t||"batched-model"!==t.type)))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=We||t[1]>=We}setupDepthForOcclusion(e,t,r){const n=this.context,i=n.gl,o=!!r;var a;r||(r={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),n.activeTexture.set(i.TEXTURE3),e&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),r.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],r.u_depth_range_unpack=[2/((a=this.depthRangeFor3D)[1]-a[0]),-1-2*a[0]/(a[1]-a[0])],r.u_occluder_half_size=.5*this.occlusionParams.occluderSize,r.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),n.activeTexture.set(i.TEXTURE0),o||t.setTerrainUniformValues(n,r)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const e=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=e?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Ls(e,t){let r=!1,n=null;const i=()=>{n=null,r&&(e(),n=setTimeout(i,t),r=!1)};return()=>(r=!0,n||i(),n)}class Ds{constructor(t){this._hashName=t&&encodeURIComponent(t),e.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ls(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=Us(e);if(this._hashName){const e=this._hashName;let r=!1;const n=location.hash.slice(1).split("&").map(n=>{const i=n.split("=")[0];return i===e?(r=!0,"".concat(i,"=").concat(t)):n}).filter(e=>e);return r||n.push("".concat(e,"=").concat(t)),"#".concat(n.join("&"))}return"#".concat(t)}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some(e=>isNaN(Number(e)))){const r=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:r,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Us(e,t){const r=e.getCenter(),n=Math.round(100*e.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),a=Math.round(r.lng*o)/o,s=Math.round(r.lat*o)/o,l=e.getBearing(),c=e.getPitch();let u=t?"/".concat(a,"/").concat(s,"/").concat(n):"".concat(n,"/").concat(s,"/").concat(a);return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/".concat(Math.round(c))),u}const Rs={linearity:.3,easing:e.eT(0,0,.3,1)},zs=Object.assign({deceleration:2500,maxSpeed:1400},Rs),Ns=Object.assign({deceleration:20,maxSpeed:1400},Rs),js=Object.assign({deceleration:1e3,maxSpeed:360},Rs),Qs=Object.assign({deceleration:1e3,maxSpeed:90},Rs);class Vs{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=e.o.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)r.zoom+=e.zoomDelta||0,r.bearing+=e.bearingDelta||0,r.pitch+=e.pitchDelta||0,e.panDelta&&r.pan._add(e.panDelta),e.around&&(r.around=e.around),e.pinchAround&&(r.pinchAround=e.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(r.pan.mag()){const e=Gs(r.pan.mag(),n,Object.assign({},zs,t||{}));i.offset=r.pan.mult(e.amount/r.pan.mag()),i.center=this._map.transform.center,Hs(i,e)}if(r.zoom){const e=Gs(r.zoom,n,Ns);i.zoom=this._map.transform.zoom+e.amount,Hs(i,e)}if(r.bearing){const t=Gs(r.bearing,n,js);i.bearing=this._map.transform.bearing+e.aA(t.amount,-179,179),Hs(i,t)}if(r.pitch){const e=Gs(r.pitch,n,Qs);i.pitch=this._map.transform.pitch+e.amount,Hs(i,e)}if(i.zoom||i.bearing){const e=void 0===r.pinchAround?r.around:r.pinchAround;i.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),i.noMoveStart=!0,i}}function Hs(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Gs(t,r,n){const{maxSpeed:i,linearity:o,deceleration:a}=n,s=e.aA(t*o/(r/1e3),-i,i),l=Math.abs(s)/(a*o);return{easing:n.easing,duration:1e3*l,amount:s*(l/2)}}class Ks extends e.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=v(t.getCanvasContainer(),r),o=t.unproject(i);super(e,Object.assign({point:i,lngLat:o,originalEvent:r},n)),this._defaultPrevented=!1,this.target=t}}class Ws extends e.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,n){const i="touchend"===t?n.changedTouches:n.touches,o=x(r.getCanvasContainer(),i),a=o.map(e=>r.unproject(e)),s=o.reduce((e,t,r,n)=>e.add(t.div(n.length)),new e.P(0,0));super(t,{points:o,point:s,lngLats:a,lngLat:r.unproject(s),originalEvent:n}),this._defaultPrevented=!1}}class qs extends e.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t){super("wheel",{originalEvent:t}),this._defaultPrevented=!1}}class Zs{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new qs(this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Ks(e.type,this._map,e))}mouseup(e){this._map.fire(new Ks(e.type,this._map,e))}preclick(e){const t=new MouseEvent("preclick",e);this._map.fire(new Ks(t.type,this._map,t))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new Ks(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new Ks(e.type,this._map,e))}mouseover(e){this._map.fire(new Ks(e.type,this._map,e))}mouseout(e){this._map.fire(new Ks(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Ws(e.type,this._map,e))}touchmove(e){this._map.fire(new Ws(e.type,this._map,e))}touchend(e){this._map.fire(new Ws(e.type,this._map,e))}touchcancel(e){this._map.fire(new Ws(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xs{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new Ks(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ks("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Ks(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ys{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(m(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const r=t,n=this._startPos,i=this._lastPos;if(!n||!i||i.equals(r)||!this._box&&r.dist(n)<this._clickTolerance)return;this._lastPos=r,this._box||(this._box=d("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const o=Math.min(n.x,r.x),a=Math.max(n.x,r.x),s=Math.min(n.y,r.y),l=Math.max(n.y,r.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform="translate(".concat(o,"px,").concat(s,"px)"),this._box.style.width=a-o+"px",this._box.style.height=l-s+"px")})}mouseupWindow(t,r){if(!this._active)return;const n=this._startPos,i=r;if(n&&0===t.button){if(this.reset(),_(),n.x!==i.x||n.y!==i.y)return this._map.fire(new e.z("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(n,i,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),g(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new e.z(t,{originalEvent:r}))}}function Js(e,t){const r={};for(let n=0;n<e.length;n++)r[e[n].identifier]=t[n];return r}class $s{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){const r=new e.P(0,0);for(const e of t)r._add(e);return r.div(t.length)}(r),this.touches=Js(n,r)))}touchmove(e,t,r){if(this.aborted||!this.centroid)return;const n=Js(r,t);for(const i in this.touches){const e=n[i];(!e||e.dist(this.touches[i])>30)&&(this.aborted=!0)}}touchend(e,t,r){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class el{constructor(e){this.singleTap=new $s(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,r){this.singleTap.touchstart(e,t,r)}touchmove(e,t,r){this.singleTap.touchmove(e,t,r)}touchend(e,t,r){const n=this.singleTap.touchend(e,t,r);if(n){const t=e.timeStamp-this.lastTime<500,r=!this.lastTap||this.lastTap.dist(n)<30;if(t&&r||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class tl{constructor(){this._zoomIn=new el({numTouches:1,numTaps:2}),this._zoomOut=new el({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,r){this._zoomIn.touchstart(e,t,r),this._zoomOut.touchstart(e,t,r)}touchmove(e,t,r){this._zoomIn.touchmove(e,t,r),this._zoomOut.touchmove(e,t,r)}touchend(e,t,r){const n=this._zoomIn.touchend(e,t,r),i=this._zoomOut.touchend(e,t,r);return n?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(n)},{originalEvent:e})}):i?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(i)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const rl={0:1,2:2},nl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class il{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const r=w(e);this._correctButton(e,r)&&(this._lastPoint=t,this._eventButton=r)}mousemoveWindow(e,t){const r=this._lastPoint;if(r)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const r=rl[t];return void 0===e.buttons||(e.buttons&r)!==r}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(r,t)}mouseupWindow(e){this._lastPoint&&w(e)===this._eventButton&&(this._moved&&_(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ol extends il{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class al extends il{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?nl[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const r=.8*(t.x-e.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class sl extends il{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?nl[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const r=-.5*(t.y-e.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class ll{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),e.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,r){return this._calculateTransform(e,t,r)}touchmove(t,r,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!e.eU())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,n)}}touchend(e,t,r){this._calculateTransform(e,t,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,n){n.length>0&&(this._active=!0);const i=Js(n,r),o=new e.P(0,0),a=new e.P(0,0);let s=0;for(const e in i){const t=i[e],r=this._touches[e];r&&(o._add(t),a._add(t.sub(r)),s++,i[e]=t)}if(this._touches=i,s<this._minTouches||!a.mag())return;const l=a.div(s);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(s),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=d("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class cl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,r){return{}}touchstart(e,t,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,r){const n=this._firstTwoTouches;if(!n)return;e.preventDefault();const[i,o]=n,a=ul(r,t,i),s=ul(r,t,o);if(!a||!s)return;const l=this._aroundCenter?null:a.add(s).div(2);return this._move([a,s],l,e)}touchend(e,t,r){if(!this._firstTwoTouches)return;const[n,i]=this._firstTwoTouches,o=ul(r,t,n),a=ul(r,t,i);o&&a||(this._active&&_(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ul(e,t,r){for(let n=0;n<e.length;n++)if(e[n].identifier===r)return t[n]}function dl(e,t){return Math.log2(e/t)}class hl extends cl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(dl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:dl(this._distance,r),pinchAround:t}}}function Al(e,t){return 180*e.angleWith(t)/Math.PI}class fl extends cl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const r=this._vector;if(this._vector=e[0].sub(e[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Al(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,r=this._startVector;if(!r)return!1;const n=Al(e,r);return Math.abs(n)<t}}function pl(e){return Math.abs(e.y)>Math.abs(e.x)}class ml extends cl{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,pl(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,r,n){const i=this._lastPoints;if(!i)return;const o=t[0].sub(i[0]),a=t[1].sub(i[1]);return this._map._cooperativeGestures&&!e.eU()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(o,a,n.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(o.y+a.y)/2*-.5})}gestureBeginsVertically(e,t,r){if(void 0!==this._valid)return this._valid;const n=e.mag()>=2,i=t.mag()>=2;if(!n&&!i)return;if(!n||!i)return null==this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;const o=e.y>0==t.y>0;return pl(e)&&pl(t)&&o}}const gl={panStep:100,bearingStep:15,pitchStep:10};class yl{constructor(){const e=gl;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,r=0,n=0,i=0,o=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),i=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),i=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),o=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(r=0,n=0),{cameraAnimation:a=>{const s=a.getZoom();a.easeTo({duration:300,easeId:"keyboardHandler",easing:_l,zoom:t?Math.round(s)+t*(e.shiftKey?2:1):s,bearing:a.getBearing()+r*this._bearingStep,pitch:a.getPitch()+n*this._pitchStep,offset:[-i*this._panStep,-o*this._panStep],center:a.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _l(e){return e*(2-e)}const vl=4.000244140625,xl=1/450;class wl{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=xl,e.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.eU()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const n=e.o.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==r&&r%vl==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=v(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>vl?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);const i=r(),o=Math.pow(2,i),a="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(a*n))),"wheel"===this._type&&(this._startZoom=i,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:r(),i=this._startZoom,o=this._easing;let a,s=!1;if("wheel"===this._type&&i&&o){const t=Math.min((e.o.now()-this._lastWheelEventTime)/200,1),r=o(t);a=e.ak(i,n,r),t<1?this._frameId||(this._frameId=!0):s=!0}else a=n,s=!0;this._active=!0,s&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let l=a-r();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!s,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=e.eV;if(this._prevEase){const t=this._prevEase,n=(e.o.now()-t.start)/t.duration,i=t.easing(n+.01)-t.easing(n),o=.27/Math.sqrt(i*i+1e-4)*.01,a=Math.sqrt(.0729-o*o);r=e.eT(o,a,.25,1)}return this._prevEase={start:e.o.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=d("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class bl{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Bl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(e.shiftKey?-1:1),around:r.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cl{constructor(){this._tap=new el({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,r){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=t[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(e,t,r))}touchmove(e,t,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const n=t[0],i=n.y-this._swipePoint.y;return this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,r)}touchend(e,t,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(e,t,r)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class El{constructor(e,t,r){this._el=e,this._mousePan=t,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Sl{constructor(e,t,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Tl{constructor(e,t,r,n){this._el=e,this._touchZoom=t,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Il=e=>e.zoom||e.drag||e.pitch||e.rotate;class Fl extends e.z{}class kl{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const n=e.av([],r,t);this.radius=e.ag(n[2]<0?e.eX([],n,this.constants):[n[0],n[1],0])}projectRay(t){e.eX(t,t,this.constants),e.aw(t,t),e.eY(t,t,this.constants);const r=e.c5([],t,this.radius);if(r[2]>0){const t=e.c5([],[0,0,1],e.bJ(r,[0,0,1])),n=e.c5([],e.aw([],[r[0],r[1],0]),this.radius),i=e.d8([],r,e.c5([],e.av([],e.d8([],n,t),r),2));r[0]=i[0],r[1]=i[1]}return r}}function Pl(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Ml{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Vs(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new kl,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),e.aY(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,i,o]of this._listeners){const t=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(i,t,o)}}destroy(){for(const[e,t,r]of this._listeners){const n=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,n,r)}}_addDefaultHandlers(e){const t=this._map,r=t.getCanvasContainer();this._add("mapEvent",new Zs(t,e));const n=t.boxZoom=new Ys(t,e);this._add("boxZoom",n);const i=new tl,o=new Bl;t.doubleClickZoom=new bl(o,i),this._add("tapZoom",i),this._add("clickZoom",o);const a=new Cl;this._add("tapDragZoom",a);const s=t.touchPitch=new ml(t);this._add("touchPitch",s);const l=new al(e),c=new sl(e);t.dragRotate=new Sl(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new ol(e),d=new ll(t,e);t.dragPan=new El(r,u,d),this._add("mousePan",u),this._add("touchPan",d,["touchZoom","touchRotate"]);const h=new fl,A=new hl;t.touchZoomRotate=new Tl(r,A,h,a),this._add("touchRotate",h,["touchPan","touchZoom"]),this._add("touchZoom",A,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Xs(t));const f=t.scrollZoom=new wl(t,this);this._add("scrollZoom",f,["mousePan"]);const p=t.keyboard=new yl;this._add("keyboard",p);for(const m of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[m]&&t[m].enable(e[m])}_add(e,t,r){this._handlers.push({handlerName:e,handler:t,allowed:r}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Il(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,r){for(const n in e)if(n!==r&&(!t||t.indexOf(n)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,"".concat(e.type,"Window"))}_getMapTouches(e){const t=[];for(const r of e)this._el.contains(r.target)&&t.push(r);return t}handleEvent(e,t){this._updatingCamera=!0;const r="renderFrame"===e.type,n=r?void 0:e,i={needsRenderFrame:!1},o={},a={},s=e.touches?this._getMapTouches(e.touches):void 0,l=s?x(this._el,s):r?void 0:v(this._el,e);for(const{handlerName:d,handler:h,allowed:A}of this._handlers){if(!h.isEnabled())continue;let r;this._blockedByActive(a,A,d)?h.reset():h[t||e.type]&&(r=h[t||e.type](e,l,s),this.mergeHandlerResult(i,o,r,d,n),r&&r.needsRenderFrame&&this._triggerRenderFrame()),(r||h.isActive())&&(a[d]=h)}const c={};for(const d in this._previousActiveHandlers)a[d]||(c[d]=n);this._previousActiveHandlers=a,(Object.keys(c).length||Pl(i))&&(this._changes.push([i,o,c]),this._triggerRenderFrame()),(Object.keys(a).length||Pl(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=i;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,t,r,n,i){if(!r)return;Object.assign(e,r);const o={handlerName:n,originalEvent:r.originalEvent||i};void 0!==r.zoomDelta&&(t.zoom=o),void 0!==r.panDelta&&(t.drag=o),void 0!==r.pitchDelta&&(t.pitch=o),void 0!==r.bearingDelta&&(t.rotate=o)}_applyChanges(){const t={},r={},n={};for(const[i,o,a]of this._changes)i.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(i.panDelta)),i.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+i.pitchDelta),void 0!==i.around&&(t.around=i.around),void 0!==i.aroundCoord&&(t.aroundCoord=i.aroundCoord),void 0!==i.pinchAround&&(t.pinchAround=i.pinchAround),i.noInertia&&(t.noInertia=i.noInertia),Object.assign(r,o),Object.assign(n,a);this._updateMapTransform(t,r,n),this._changes=[]}_updateMapTransform(t,r,n){const i=this._map,o=i.transform,a=e=>[e.x,e.y,e.z];if((()=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Pl(t)){const e=o.zoom;o.cameraElevationReference="sea",null!=this._originalZoom&&o._orthographicProjectionAtLowPitch&&"globe"!==o.projection.name&&0===o.pitch?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),e!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&i._stop(!0),!Pl(t))return void this._fireEvents(r,n,!0);let{panDelta:s,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:d,aroundCoord:h,pinchAround:A}=t;o._isCameraConstrained&&(l>0&&(l=0),o._isCameraConstrained=!1),void 0!==A&&(d=A),(l||(e=>r[e]&&!this._eventsInProgress[e])("drag"))&&d&&(this._dragOrigin=a(o.pointCoordinate3D(d)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",i._stop(!0),d=d||i.transform.centerPoint,c&&(o.bearing+=c),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(s)if("mercator"===o.projection.name){const e=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(d).dir),t=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(d.sub(s)).dir);f[0]=t[0]-e[0],f[1]=t[1]-e[1]}else{const t=o.pointCoordinate(d);if("globe"===o.projection.name){s=s.rotate(-o.angle);const r=o._pixelsPerMercatorPixel/o.worldSize;f[0]=-s.x*e.eW(e.a$(t.y))*r,f[1]=-s.y*e.eW(o.center.lat)*r}else{const e=o.pointCoordinate(d.sub(s));t&&e&&(f[0]=e.x-t.x,f[1]=e.y-t.y)}}const p=o.zoom,m=[0,0,0];if(l){const t=a(h||o.pointCoordinate3D(d)),r={dir:e.aw([],e.av([],t,o._camera.position))};if(r.dir[2]<0){const n=o.zoomDeltaToMovement(t,l);e.c5(m,r.dir,n)}}const g=e.d8(f,f,m);o._translateCameraConstrained(g),l&&Math.abs(o.zoom-p)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,n,!0)}_fireEvents(t,r,n){const i=Il(this._eventsInProgress),o=Il(t),a={};for(const e in t){const{originalEvent:r}=t[e];this._eventsInProgress[e]||(a["".concat(e,"start")]=r),this._eventsInProgress[e]=t[e]}!i&&o&&this._fireEvent("movestart",o.originalEvent);for(const e in a)this._fireEvent(e,a[e]);o&&this._fireEvent("move",o.originalEvent);for(const e in t){const{originalEvent:r}=t[e];this._fireEvent(e,r)}const s={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:n}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=r[t]||n,s["".concat(e,"end")]=l)}for(const e in s)this._fireEvent(e,s[e]);const c=Il(this._eventsInProgress);if(n&&(i||o)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),r=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(r(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.z("moveend",{originalEvent:l})),r(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new e.z(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new Fl("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ol="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ll extends e.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=!1!==r.respectPrefersReducedMotion,e.aY(["_renderFrameCallback"],this)}getCenter(){return new e.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,r,n){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},r),n)}panTo(e,t,r){return this.easeTo(Object.assign({center:e},t),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,t,r){return this.easeTo(Object.assign({zoom:e},t),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,t,r){return this.easeTo(Object.assign({bearing:e},t),r)}resetNorth(e,t){return this.rotateTo(0,Object.assign({duration:1e3},e),t),this}resetNorthPitch(e,t){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},e),t),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,r){t=e.aI.convert(t);const n=r&&r.bearing||0,i=r&&r.pitch||0,o=t.getNorthWest(),a=t.getSouthEast();return this._cameraForBounds(this.transform,o,a,n,i,r)}_extendPadding(e){const t={top:0,right:0,bottom:0,left:0};return null==e?Object.assign({},t,this.transform.padding):"number"==typeof e?{top:e,bottom:e,right:e,left:e}:Object.assign({},t,e)}_extendCameraOptions(e){return(e=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding=this._extendPadding(e.padding),e}_minimumAABBFrustumDistance(e,t){const r=t.max[0]-t.min[0],n=t.max[1]-t.min[1];return r/n>e.aspect?r/(2*Math.tan(.5*e.fovX)*e.aspect):n/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,r,n,i,o,a){const s=t.clone(),l=this._extendCameraOptions(a);s.bearing=i,s.pitch=o;const c=e.aT.convert(r),u=e.aT.convert(n),d=.5*(c.lat+u.lat),h=.5*(c.lng+u.lng),A=e.eZ(d,h),f=e.aw([],A),p=e.aw([],e.bI([],f,[0,1,0])),m=e.bI([],p,f),g=[p[0],p[1],p[2],0,m[0],m[1],m[2],0,f[0],f[1],f[2],0,0,0,0,1],y=[A,e.eZ(c.lat,c.lng),e.eZ(u.lat,c.lng),e.eZ(u.lat,u.lng),e.eZ(c.lat,u.lng),e.eZ(d,c.lng),e.eZ(d,u.lng),e.eZ(c.lat,h),e.eZ(u.lat,h)];let _=e.d9.fromPoints(y.map(t=>[e.bJ(p,t),e.bJ(m,t),e.bJ(f,t)]));const v=e.af([],_.center,g);0===e.e_(v)&&e.e$(v,0,0,1),e.aw(v,v),e.c5(v,v,e.aD),s.center=e.f0(v);const x=s.getWorldToCameraMatrix(),w=e.bl(new Float64Array(16),x);_=e.d9.applyTransform(_,e.aB([],x,g));const b=this._extendAABB(_,s,l,i);if(!b)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");_=b,e.af(v,v,x);const B=.5*(_.max[2]-_.min[2]),C=this._minimumAABBFrustumDistance(s,_),E=e.c5([],[0,0,1],B),S=e.d8(E,v,E),T=C+(0===s.pitch?0:e.bG(v,S)),I=s.globeCenterInViewSpace,F=e.av([],v,[I[0],I[1],I[2]]);e.aw(F,F),e.c5(F,F,T);const k=e.d8([],v,F);e.af(k,k,w);const P=e.eM/e.aD,M=e.ag(k),O=e.cf(Math.max(M*P-e.eM,Number.EPSILON),0),L=Math.min(s.zoomFromMercatorZAdjusted(O),l.maxZoom);return L>.5*(e.c_+e.cL)?(s.setProjection({name:"mercator"}),s.zoom=L,this._cameraForBounds(s,r,n,i,o,a)):{center:s.center,zoom:L,bearing:i,pitch:o}}_extendAABB(t,r,n,i){const o=.5*((n.padding.left||0)+(n.padding.right||0)),a=.5*((n.padding.top||0)+(n.padding.bottom||0)),s=a,l=o,c=o,u=a,d=r.width-(l+c),h=r.height-(s+u),A=e.av([],t.max,t.min),f=Math.min(d/A[0],h/A[1]),p=Math.min(r.scaleZoom(r.scale*f),n.maxZoom);if(isNaN(p))return null;const m=r.scale/r.zoomScale(p),g=new e.d9([t.min[0]-l*m,t.min[1]-u*m,t.min[2]],[t.max[0]+c*m,t.max[1]+s*m,t.max[2]]),y=("number"==typeof n.offset.x&&"number"==typeof n.offset.y?new e.P(n.offset.x,n.offset.y):e.P.convert(n.offset)).rotate(-e.an(i));return g.center[0]-=y.x*m,g.center[1]+=y.y*m,g}queryTerrainElevation(t,r){const n=this.transform.elevation;return n?(r=Object.assign({},{exaggerated:!0},r),n.getAtPoint(e.ae.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,n,i,o,a){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,r,n,i,o,a);const s=t.clone(),l=this._extendCameraOptions(a);s.bearing=i,s.pitch=o;const c=e.aT.convert(r),u=e.aT.convert(n),d=new e.aT(c.lng,u.lat),h=new e.aT(u.lng,c.lat),A=s.project(c),f=s.project(u),p=this.queryTerrainElevation(c),m=this.queryTerrainElevation(u),g=this.queryTerrainElevation(d),y=this.queryTerrainElevation(h),_=[[A.x,A.y,Math.min(p||0,m||0,g||0,y||0)],[f.x,f.y,Math.max(p||0,m||0,g||0,y||0)]];let v=e.d9.fromPoints(_);const x=s.getWorldToCameraMatrix(),w=e.bl(new Float64Array(16),x);v=e.d9.applyTransform(v,x);const b=this._extendAABB(v,s,l,i);if(!b)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=b;const B=.5*e.av([],v.max,v.min)[2],C=this._minimumAABBFrustumDistance(s,v),E=[0,0,1,0];e.aC(E,E,x),e.f1(E,E);const S=e.c5([],E,C+B),T=e.d8([],v.center,S);e.af(v.center,v.center,w),e.af(T,T,w);const I=s.unproject(new e.P(v.center[0],v.center[1])),F=e.f2(s.projection,I),k=Math.pow(2,F),P=Math.min(s._zoomFromMercatorZ(T[2]*s.pixelsPerMeter*k/s.worldSize),l.maxZoom);return s.mercatorFromTransition&&P<.5*(e.c_+e.cL)?(s.setProjection({name:"globe"}),s.zoom=P,this._cameraForBounds(s,r,n,i,o,a)):{center:I,zoom:P,bearing:i,pitch:o}}fitBounds(e,t,r){const n=this.cameraForBounds(e,t);return this._fitInternal(n,t,r)}fitScreenCoordinates(t,r,n,i,o){const a=e.P.convert(t),s=e.P.convert(r),l=new e.P(Math.min(a.x,s.x),Math.min(a.y,s.y)),c=new e.P(Math.max(a.x,s.x),Math.max(a.y,s.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(a,s))return this;const u=this.transform.pointLocation3D(l),d=this.transform.pointLocation3D(c),h=this.transform.pointLocation3D(new e.P(l.x,c.y)),A=this.transform.pointLocation3D(new e.P(c.x,l.y)),f=[Math.min(u.lng,d.lng,h.lng,A.lng),Math.min(u.lat,d.lat,h.lat,A.lat)],p=[Math.max(u.lng,d.lng,h.lng,A.lng),Math.max(u.lat,d.lat,h.lat,A.lat)],m=i&&i.pitch?i.pitch:this.getPitch(),g=this._cameraForBounds(this.transform,f,p,n,m,i);return this._fitInternal(g,i,o)}_fitInternal(e,t,r){return e?(t=Object.assign(e,t)).linear?this.easeTo(t,r):this.flyTo(t,r):this}jumpTo(t,r){this.stop();const n=t.preloadOnly?this.transform.clone():this.transform;let i=!1,o=!1,a=!1;"zoom"in t&&n.zoom!==+t.zoom&&(i=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=e.aT.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(o=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(a=!0,n.pitch=+t.pitch);const s="number"==typeof t.padding?this._extendPadding(t.padding):t.padding;if(null!=t.padding&&!n.isPaddingEqual(s))if(!1===t.retainPadding){const e=n.clone();e.padding=s,n.setLocationAtPoint(n.center,e.centerPoint)}else n.padding=s;return t.preloadOnly?(this._preloadTiles(n),this):(this.fire(new e.z("movestart",r)).fire(new e.z("move",r)),i&&this.fire(new e.z("zoomstart",r)).fire(new e.z("zoom",r)).fire(new e.z("zoomend",r)),o&&this.fire(new e.z("rotatestart",r)).fire(new e.z("rotate",r)).fire(new e.z("rotateend",r)),a&&this.fire(new e.z("pitchstart",r)).fire(new e.z("pitch",r)).fire(new e.z("pitchend",r)),this.fire(new e.z("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(Ol),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const n=this.transform;if(!n.projection.supportsFreeCamera)return e.w(Ol),this;this.stop();const i=n.zoom,o=n.pitch,a=n.bearing;n.setFreeCameraOptions(t);const s=i!==n.zoom,l=o!==n.pitch,c=a!==n.bearing;return this.fire(new e.z("movestart",r)).fire(new e.z("move",r)),s&&this.fire(new e.z("zoomstart",r)).fire(new e.z("zoom",r)).fire(new e.z("zoomend",r)),c&&this.fire(new e.z("rotatestart",r)).fire(new e.z("rotate",r)).fire(new e.z("rotateend",r)),l&&this.fire(new e.z("pitchstart",r)).fire(new e.z("pitch",r)).fire(new e.z("pitchend",r)),this.fire(new e.z("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),(!1===(t=Object.assign({offset:[0,0],duration:500,easing:e.eV},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const n=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in t?+t.zoom:i,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:a,d=this._extendPadding(t.padding),h=e.P.convert(t.offset);let A,f,p;if("globe"===n.projection.name){const r=e.ae.fromLngLat(n.center),i=h.rotate(-n.angle);r.x+=i.x/n.worldSize,r.y+=i.y/n.worldSize;const o=r.toLngLat(),a=e.aT.convert(t.center||o);this._normalizeCenter(a),A=n.centerPoint.add(i),f=new e.P(r.x,r.y).mult(n.worldSize),p=new e.P(e.aF(a.lng),e.aJ(a.lat)).mult(n.worldSize).sub(f)}else{A=n.centerPoint.add(h);const r=n.pointLocation(A),i=e.aT.convert(t.center||r);this._normalizeCenter(i),f=n.project(r),p=n.project(i).sub(f)}const m=n.zoomScale(l-i);let g,y;t.around&&(g=e.aT.convert(t.around),y=n.locationPoint(g));const _=this._zooming||l!==i,v=this._rotating||o!==c,x=this._pitching||u!==a,w=!n.isPaddingEqual(d),b=!1===t.retainPadding?n.clone():n,B=n=>B=>{if(_&&(n.zoom=e.ak(i,l,B)),v&&(n.bearing=e.ak(o,c,B)),x&&(n.pitch=e.ak(a,u,B)),w&&(b.interpolatePadding(s,d,B),A=b.centerPoint.add(h)),g)n.setLocationAtPoint(g,y);else{const e=n.zoomScale(n.zoom-i),t=l>i?Math.min(2,m):Math.max(.5,m),r=Math.pow(t,1-B),o=n.unproject(f.add(p.mult(B*r)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?o.wrap():o,A)}return t.preloadOnly||this._fireMoveEvents(r),n};if(t.preloadOnly){const e=this._emulate(B,t.duration,n);return this._preloadTiles(e),this}const C={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_,this._rotating=v,this._pitching=x,this._padding=w,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,C),this._ease(B(n),e=>{"sea"===n.cameraElevationReference&&n.recenterOnTerrain(),this._afterEase(r,e)},t),this}_prepareEase(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),r||n.moving||this.fire(new e.z("movestart",t)),this._zooming&&!n.zooming&&this.fire(new e.z("zoomstart",t)),this._rotating&&!n.rotating&&this.fire(new e.z("rotatestart",t)),this._pitching&&!n.pitching&&this.fire(new e.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.z("move",t)),this._zooming&&this.fire(new e.z("zoom",t)),this._rotating&&this.fire(new e.z("rotate",t)),this._pitching&&this.fire(new e.z("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new e.z("zoomend",t)),i&&this.fire(new e.z("rotateend",t)),o&&this.fire(new e.z("pitchend",t)),this.fire(new e.z("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const n=e.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(n,r)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:e.eV},t);const n=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),l="zoom"in t?e.aA(+t.zoom,n.minZoom,n.maxZoom):i,c="bearing"in t?this._normalizeBearing(t.bearing,o):o,u="pitch"in t?+t.pitch:a,d=this._extendPadding(t.padding),h=n.zoomScale(l-i),A=e.P.convert(t.offset);let f=n.centerPoint.add(A);const p=n.pointLocation(f),m=e.aT.convert(t.center||p);this._normalizeCenter(m);const g=n.project(p),y=n.project(m).sub(g);let _=t.curve;const v=Math.max(n.width,n.height),x=v/h,w=y.mag();if("minZoom"in t){const r=e.aA(Math.min(t.minZoom,i,l),n.minZoom,n.maxZoom),o=v/n.zoomScale(r-i);_=Math.sqrt(o/w*2)}const b=_*_;function B(e){const t=(x*x-v*v+(e?-1:1)*b*b*w*w)/(2*(e?x:v)*b*w);return Math.log(Math.sqrt(t*t+1)-t)}function C(e){return(Math.exp(e)-Math.exp(-e))/2}function E(e){return(Math.exp(e)+Math.exp(-e))/2}const S=B(0);let T=function(e){return E(S)/E(S+_*e)},I=function(e){return v*((E(S)*(C(t=S+_*e)/E(t))-C(S))/b)/w;var t},F=(B(1)-S)/_;if(Math.abs(w)<1e-6||!isFinite(F)){if(Math.abs(v-x)<1e-6)return this.easeTo(t,r);const e=x<v?-1:1;F=Math.abs(Math.log(x/v))/_,I=function(){return 0},T=function(t){return Math.exp(e*_*t)}}t.duration="duration"in t?+t.duration:1e3*F/("screenSpeed"in t?+t.screenSpeed/_:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const k=o!==c,P=u!==a,M=!n.isPaddingEqual(d),O=!1===t.retainPadding?n.clone():n,L=n=>h=>{const p=h*F,_=1/T(p);n.zoom=1===h?l:i+n.scaleZoom(_),k&&(n.bearing=e.ak(o,c,h)),P&&(n.pitch=e.ak(a,u,h)),M&&(O.interpolatePadding(s,d,h),f=O.centerPoint.add(A));const v=1===h?m:n.unproject(g.add(y.mult(I(p))).mult(_));return n.setLocationAtPoint(n.renderWorldCopies?v.wrap():v,f),n._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),n};if(t.preloadOnly){const e=this._emulate(L,t.duration,n);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=k,this._pitching=P,this._padding=M,this._prepareEase(r,!1),this._ease(L(n),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,r,n){!1===n.animate||0===n.duration?(t(1),r()):(this._easeStart=e.o.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.o.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=e.bT(t,-180,180);const n=Math.abs(t-r);return Math.abs(t-360-r)<n&&(t-=360),Math.abs(t+360-r)<n&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const r=e.lng-t.center.lng;e.lng+=r>180?-360:r<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,r){const n=Math.ceil(15*t/1e3),i=[],o=e(r.clone());for(let a=0;a<=n;a++){const e=o(a/n);i.push(e.clone())}return i}_preloadTiles(e,t){}}class Dl{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,e.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact,r=e._getUIString("AttributionControl.ToggleAttribution");this._map=e,this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=d("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",r);const n=d("span","mapboxgl-ctrl-icon",this._compactButton);return n.setAttribute("aria-hidden","true"),n.setAttribute("title",r),this._innerContainer=d("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.e.ACCESS_TOKEN}];if(t){const n=r.reduce((e,t,n)=>(t.value&&(e+="".concat(t.key,"=").concat(t.value).concat(n<r.length-1?"&":"")),e),"?");t.href="".concat(e.e.FEEDBACK_URL,"/").concat(n,"#").concat(Us(this._map,!0)),t.rel="noopener nofollow"}}_updateData(e){!e||("source"!==e.dataType||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType)&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const n in t){const r=t[n];if(r.used){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort((e,t)=>e.length-t.length),e=e.filter((t,r)=>{for(let n=r+1;n<e.length;n++)if(e[n].indexOf(t)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const r=e.map(e=>function(e){const t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.body.querySelectorAll("*")).forEach(e=>{const r=e.textContent||"";if("A"!==e.tagName)return void e.replaceWith(t.createTextNode(r));const n=e.getAttribute("href");if(!n||!/^(https?:|mailto:)/i.test(n))return void e.replaceWith(t.createTextNode(r));const i=t.createElement("a");i.href=n,i.textContent=r,i.rel="noopener nofollow";const o=e.getAttribute("class");o&&(i.className=o),e.replaceWith(i)}),t.body.innerHTML}(e)).join(" | ");r!==this._attribHTML&&(this._attribHTML=r,e.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Ul{constructor(){e.aY(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=d("div","mapboxgl-ctrl");const t=d("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const r=e[t].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class Rl{constructor(){e.aY(["_onIndoorUpdate"],this)}onAdd(e){return this._map=e,this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",e=>this._onIndoorUpdate(e)),this._container}_createButton(e,t){const r=d("button",e,this._container);return r.type="button",r.addEventListener("click",t),r}_createSeparator(){return d("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(e,t){this._map&&(e.setAttribute("aria-label",t),e.textContent=t)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(e){if(!e||!e.floors)return this._model=e,void(this._container.style.display="none");const t=this._model;this._model=e,this._container.style.display="inline-block",this._container.style.borderRadius="8px",t&&Array.from(this._container.children).forEach(e=>e.remove()),e.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(e.floors,e.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const e=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const e=this._map;this._model&&e&&e._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});d("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&e.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(e),this._createSeparator()}_updateBuildingsButtonState(){const e=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");e&&this._model&&(this._model.activeFloorsVisible?e.classList.remove("mapboxgl-ctrl-level-button-selected"):e.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(e,t){for(let r=0;r<e.length;r++){const n=e[r],i=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(n.id)});this._setButtonTitle(i,n.zIndex.toString()),this._model&&n.id===this._model.selectedFloorId&&t&&i.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(i),r<e.length-1&&this._createSeparator()}}}class zl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,r=t?this._queue.concat(t):this._queue;for(const n of r)if(n.id===e)return void(n.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const r of t)if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Nl{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=e.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,r){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+r}}const jl={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Ql extends e.z{constructor(e,t,r,n){const{point:i,lngLat:o,originalEvent:a,target:s}=e;super(e.type,{point:i,lngLat:o,originalEvent:a,target:s}),this.preventDefault=()=>{e.preventDefault()},this.id=t,this.interaction=r,this.feature=n}}class Vl{constructor(e){this.map=e,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,r){if(this.typeById.has(t))throw new Error('Interaction id "'.concat(t,'" already exists.'));const n=r.filter;let i=r.type;n&&this.filters.set(t,e.b6(n)),"mouseover"===i&&(i="mouseenter"),"mouseout"===i&&(i="mouseleave");const o=this.interactionsByType.get(i)||new Map;"mouseenter"===i||"mouseleave"===i?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,r)):0===o.size&&this.map.on(i,this.handleType),0===o.size&&this.interactionsByType.set(i,o),o.set(t,r),this.typeById.set(t,i)}get(e){const t=this.typeById.get(e);if(!t)return;const r=this.interactionsByType.get(t);return r?r.get(e):void 0}remove(e){const t=this.typeById.get(e);if(!t)return;this.typeById.delete(e),this.filters.delete(e);const r=this.interactionsByType.get(t);r&&(r.delete(e),"mouseenter"===t||"mouseleave"===t?(this.delegatedInteractions.delete(e),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===r.size&&this.map.off(t,this.handleType))}queryTargets(e,t){const r=[];for(const[n,i]of t)i.target&&r.push({targetId:n,target:i.target,filter:this.filters.get(n)});return this.map.style.queryRenderedTargets(e,r,this.map.transform)}handleMove(e){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const t=this.queryTargets(e.point,Array.from(this.delegatedInteractions).reverse());t.length&&(e.type="mouseenter",this.handleType(e,t));const r=new Map;for(const[n,{feature:i}]of this.prevHoveredFeatures)this.hoveredFeatures.has(n)||r.set(i.id,i);r.size&&(e.type="mouseleave",this.handleType(e,Array.from(r.values())))}handleOut(e){const t=Array.from(this.hoveredFeatures.values()).map(e=>{let{feature:t}=e;return t});t.length&&(e.type="mouseleave",this.handleType(e,t)),this.hoveredFeatures.clear()}handleType(t,r){const n="mouseenter"===t.type;if(n&&!this.interactionsByType.has(t.type))return void e.w("mouseenter interaction required for mouseleave to work.");const i=Array.from(this.interactionsByType.get(t.type)).reverse(),o=!!r;r=r||this.queryTargets(t.point,i);let a=!1;const s=new Set;for(const l of r){for(const[r,c]of i){if(!c.target)continue;const i=l.variants?l.variants[r]:null;if(i){for(const u of i){if(xt(u,l,s,r))continue;const i=new e.dx(l,u),d=vt(u,l,r);o&&void 0!==i.id&&(i.state=this.map.getFeatureState(i));const h=n?this.prevHoveredFeatures.get(d):null,A=new Ql(t,r,c,i),f=h?h.stop:c.handler(A);if(n&&this.hoveredFeatures.set(d,{feature:l,stop:f}),!1!==f){a=!0;break}}if(a)break}}if(a)break}if(!a)for(const[e,l]of i){const{handler:r,target:n}=l;if(!n&&!1!==r(new Ql(t,e,l,null)))break}}}function Hl(t,r){if(Array.isArray(t)&&Array.isArray(r)){const e=new Set(t),n=new Set(r);return e.size===n.size&&t.every(e=>n.has(e))}return e.by(t,r)}const Gl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Kl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Wl{constructor(t,r){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=r,this.mouseRotate=new al({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,n&&(this.mousePitch=new sl({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),m()}move(e,t){const r=this.map,n=this.mouseRotate.mousemoveWindow(e,t),i=n&&n.bearingDelta;if(i&&r.setBearing(r.getBearing()+i),this.mousePitch){const n=this.mousePitch.mousemoveWindow(e,t),i=n&&n.pitchDelta;i&&r.setPitch(r.getPitch()+i)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){g(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(Object.assign({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),v(this.element,e)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,v(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=x(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=x(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function ql(t,r,n){if(t=new e.aT(t.lng,t.lat),r){const i=new e.aT(t.lng-360,t.lat),o=new e.aT(t.lng+360,t.lat),a=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),s=n.locationPoint3D(t).distSqr(r),l=r.x<0||r.y<0||r.x>n.width||r.y>n.height;n.locationPoint3D(i).distSqr(r)<s&&(l||Math.abs(i.lng-n.center.lng)<a)?t=i:n.locationPoint3D(o).distSqr(r)<s&&(l||Math.abs(o.lng-n.center.lng)<a)&&(t=o)}for(;Math.abs(t.lng-n.center.lng)>180;){const e=n.locationPoint3D(t);if(e.x>=0&&e.y>=0&&e.x<=n.width&&e.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}const Zl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Xl={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Yl extends e.E{constructor(t,r){super(),(t instanceof HTMLElement||r)&&(t=Object.assign({element:t},r)),e.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:n="center",color:i="#3FB1CE",scale:o=1,draggable:a=!1,clickTolerance:s=0,rotation:l=Xl.rotation,rotationAlignment:c=Xl.rotationAlignment,pitchAlignment:u=Xl.pitchAlignment,occludedOpacity:d=Xl.occludedOpacity,altitude:h=Xl.altitude}=t||{};this._anchor=n,this._color=i,this._scale=o,this._draggable=a,this._clickTolerance=s,this._rotation=l,this._rotationAlignment=c,this._pitchAlignment=u,this._occludedOpacity=d,this._altitude=h,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=e.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()});const A=this._element.classList;for(const e in Zl)A.remove("mapboxgl-marker-anchor-".concat(e));A.add("mapboxgl-marker-anchor-".concat(this._anchor));const f=t&&t.className?t.className.trim().split(/\s+/):[];A.add(...f),this._popup=null}_createDefaultMarker(){const e=d("div"),t=h("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},e);if(0===this._altitude){const e=h("radialGradient",{id:"shadowGradient"},h("defs",{},t));h("stop",{offset:"10%","stop-opacity":.4},e),h("stop",{offset:"100%","stop-opacity":.05},e),h("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},t)}return h("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},t),h("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},t),h("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},t),e}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(e){return e===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==e||0!==this._altitude&&0===e)&&(this._element=this._createDefaultMarker()),this._altitude=e||Xl.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,r=13.5,n=Math.sqrt(Math.pow(r,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[n,-1*(t-r+n)],"bottom-right":[-n,-1*(t-r+n)],left:[r,-1*(t-r)],right:[-r,-1*(t-r)]}:this._offset}this._popup=e,e._marker=this,e._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,r=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==r&&13!==r||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,r=this._element;this._popup&&(t===r||r.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const r=e.unproject(t,this._altitude),n=e.getFreeCameraOptions();if(!n.position)return!1;const i=n.position.toLngLat();return i.distanceTo(r)<.9*i.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const n=t.unproject(r,this._altitude);let i;t._showingGlobe()&&e.f5(t.transform,this._lngLat)?i=0:(i=1-t._queryFogOpacity(n),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(i*=this._occludedOpacity)),this._element.style.opacity="".concat(i),this._element.style.pointerEvents=i>0?"auto":"none",this._popup&&this._popup._setOpacity(i),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(e.x,"px,").concat(e.y,"px)\n            ").concat(Zl[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(t.x,"px,").concat(t.y,"px)\n        ")}_calculateXYTransform(){const t=this._pos,r=this._map,n=this.getPitchAlignment();if(!r||!t||"map"!==n)return"";if(!r._showingGlobe()){const e=r.getPitch();return e?"rotateX(".concat(e,"deg)"):""}const i=e.cX(e.f6(r.transform,this._lngLat)),o=t.sub(e.f7(r.transform)),a=Math.abs(o.x)+Math.abs(o.y);if(0===a)return"";const s=i/a;return"rotateX(".concat(-o.y*s,"deg) rotateY(").concat(o.x*s,"deg)")}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let n=0;const i=this.getRotationAlignment();if("map"===i)if(r._showingGlobe()){const t=r.project(new e.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),i=r.project(new e.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(t);n=e.cX(Math.atan2(i.y,i.x))-90}else n=-r.getBearing();else if("horizon"===i){const i=e.ah(4,6,r.getZoom()),o=e.f7(r.transform);o.y+=i*r.transform.height;const a=t.sub(o),s=e.cX(Math.atan2(a.y,a.x));n=(s>90?s-270:s+90)*(1-i)}return n+=this._rotation,n?"rotateZ(".concat(n,"deg)"):""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=ql(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat,this._altitude),!0===e?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),t._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const r=this._map;if(!r)return;const n=this._pointerdownPos,i=this._positionDelta;if(n&&i){if(!this._isDragging){const e=this._clickTolerance||r._clickTolerance;if(t.point.dist(n)<e)return;this._isDragging=!0}this._pos=t.point.sub(i),this._lngLat=r.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.z("dragstart"))),this.fire(new e.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.z("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,r=this._pos;t&&r&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(r),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||Xl.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||Xl.rotationAlignment,this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||Xl.pitchAlignment,this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||Xl.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Jl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},$l={maxWidth:100,unit:"metric"},ec={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},tc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},rc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nc(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.P(0,0),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(r){case"top":return new e.P(0,t);case"top-left":return new e.P(n,n);case"top-right":return new e.P(-n,n);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(n,-n);case"bottom-right":return new e.P(-n,-n);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[r]||[0,0])}const ic={version:t,supported:u.supported,setRTLTextPlugin:e.fb,getRTLTextPluginStatus:e.fa,Map:class extends Ll{constructor(t){a.mark(r.create);const n=t;if(null!=(t=Object.assign({},Gl,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.f3(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new An(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies,null,null),t),this._repaint=!!t.repaint,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new zl,this._domRenderTaskQueue=new zl,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.b2(),this._locale=Object.assign({},jl,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._tessellationStep=t.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=t.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Nl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=t.scaleFactor,this._requestManager=new E(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?Object.assign({},t.contextCreateOptions):{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error("Container '".concat(t.container.toString(),"' not found."));this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),this._spriteFormat=t.spriteFormat,e.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ml(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.e.DEFAULT_STYLE,{config:t.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new Ds("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==n.center&&null==n.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const e=t.bounds;e&&(this.resize(),this.fitBounds(e,Object.assign({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new Dl({customAttribution:t.customAttribution})),this._logoControl=new Ul,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new e.z("".concat(t.dataType,"data"),t))}),this.on("dataloading",t=>{this.fire(new e.z("".concat(t.dataType,"dataloading"),t))}),this._interactions=new Vl(this)}_getMapId(){return this._mapId}addControl(t,r){if(void 0===r&&(r=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const i=this._controlPositions[r];return-1!==r.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(t);return r>-1&&this._controls.splice(r,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new e.z("movestart",t)).fire(new e.z("move",t)),this.fire(new e.z("resize",t)),r&&this.fire(new e.z("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.aI.convert(t)),this._update()}setMinZoom(t){if((t=null!==t&&void 0!==t?t:-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.z("zoomstart")).fire(new e.z("zoom")).fire(new e.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null!==t&&void 0!==t?t:22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.z("zoomstart")).fire(new e.z("zoom")).fire(new e.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null!==t&&void 0!==t?t:0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.z("pitchstart")).fire(new e.z("pitch")).fire(new e.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null!==t&&void 0!==t?t:85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.z("pitchstart")).fire(new e.z("pitch")).fire(new e.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(e){return this._scaleFactor=e,this.painter.scaleFactor=e,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(e=>"symbol"===e.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(e=>"auto"===e?navigator.language:e):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,r=t.projection.name;let n;"globe"===r&&t.zoom>=e.cL?(t.setMercatorFromTransition(),n=!0):"mercator"===r&&t.zoom<e.cL&&(t.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let r;const n=this.transform.mercatorFromTransition;r="globe"===t.name&&this.transform.zoom>=e.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate();const i="mercator"===this.transform.getProjection().name&&n!==this.transform.mercatorFromTransition;return(r||i)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t,r){return this.transform.locationPoint3D(e.aT.convert(t),r)}unproject(t,r){return this.transform.pointLocation3D(e.P.convert(t),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,r){const n=e=>{let r=[];if(Array.isArray(t)){const n=t.filter(e=>this.getLayer(e));r=n.length?this.queryRenderedFeatures(e,{layers:n}):[]}else r=this.queryRenderedFeatures(e,{target:t});return r};if("mouseenter"===e||"mouseover"===e){let i=!1;const o=t=>{const o=n(t.point);o.length?i||(i=!0,r.call(this,new Ks(e,this,t.originalEvent,{features:o}))):i=!1};return{listener:r,targets:t,delegates:{mousemove:o,mouseout:()=>{i=!1}}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const o=t=>{n(t.point).length?i=!0:i&&(i=!1,r.call(this,new Ks(e,this,t.originalEvent)))},a=t=>{i&&(i=!1,r.call(this,new Ks(e,this,t.originalEvent)))};return{listener:r,targets:t,delegates:{mousemove:o,mouseout:a}}}{const i=e=>{const t=n(e.point);t.length&&(e.features=t,r.call(this,e),delete e.features)};return{listener:r,targets:t,delegates:{[e]:i}}}}on(e,t,r){if("function"==typeof t||void 0===r)return super.on(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const n=this._createDelegatedListener(e,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n);for(const i in n.delegates)this.on(i,n.delegates[i]);return this}once(e,t,r){if("function"==typeof t||void 0===r)return super.once(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const n=this._createDelegatedListener(e,t,r);for(const i in n.delegates)this.once(i,n.delegates[i]);return this}off(e,t,r){if("function"==typeof t||void 0===r)return super.off(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const n=this._delegatedListeners?this._delegatedListeners[e]:void 0;return n&&(e=>{for(let n=0;n<e.length;n++){const i=e[n];if(i.listener===r&&Hl(i.targets,t)){for(const e in i.delegates)this.off(e,i.delegates[e]);return e.splice(n,1),this}}})(n),this}queryRenderedFeatures(t,r){if(!this.style)return[];if(void 0===t||t instanceof e.P||Array.isArray(t)||void 0!==r||(r=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],!r){const e=this.style.queryRenderedFeatures(t,void 0,this.transform),r=this.style.queryRenderedFeatureset(t,void 0,this.transform);return e.concat(r)}let n=!0;if(r.target&&(n=this._isTargetValid(r.target),n&&!r.layers))return this.style.queryRenderedFeatureset(t,r,this.transform);let i=!0;if(r.layers&&Array.isArray(r.layers)){for(const e of r.layers)if(!this._isValidId(e)){i=!1;break}if(i&&!r.target)return this.style.queryRenderedFeatures(t,r,this.transform)}let o=[];return i&&(o=o.concat(this.style.queryRenderedFeatures(t,r,this.transform))),n&&(o=o.concat(this.style.queryRenderedFeatureset(t,r,this.transform))),o}querySourceFeatures(e,t){return!e||"string"==typeof e&&!this._isValidId(e)?[]:this.style.querySourceFeatures(e,t)}queryRasterValue(e,t,r){return this._isValidId(e)?this.style.queryRasterValue(e,t,r):Promise.resolve(null)}isPointOnSurface(t){const{name:r}=this.transform.projection;return"globe"!==r&&"mercator"!==r&&e.w("".concat(r," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(e.P.convert(t))}addInteraction(e,t){return this._interactions.add(e,t),this}removeInteraction(e){return this._interactions.remove(e),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(e){return this._cooperativeGestures=e,this}setStyle(t,r){return r=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&t&&!1!==r.diff&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(t,(n,i)=>{if(n){const i="string"==typeof n?n:n instanceof Error?n.message:n.error;e.w("Unable to perform style diff: ".concat(i,". Rebuilding the style from scratch.")),this._updateStyle(t,r)}else i&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(t,r))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}_updateStyle(e,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e){const r=Object.assign({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new Ln(this,r).load(e),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ln(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.y(new Error("IDs can't be empty."))),!1):!e.dr(t)||(this.fire(new e.y(new Error("IDs can't contain special symbols: \"".concat(t,'".')))),!1)}_isTargetValid(e){return"featuresetId"in e?this._isValidId("importId"in e?e.importId:e.featuresetId):"layerId"in e&&this._isValidId(e.layerId)}_areTargetsValid(e){if(Array.isArray(e)){for(const t of e)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(e)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,r)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,r){let{pixelRatio:n=1,sdf:i=!1,stretchX:o,stretchY:a,content:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._lazyInitEmptyStyle();const l=e.I.from(t);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:t,height:c,data:u}=e.o.getImageData(r);this.style.addImage(l,{data:new e.q({width:t,height:c},u),pixelRatio:n,stretchX:o,stretchY:a,content:s,sdf:i,version:0,usvg:!1})}else if(void 0===r.width||void 0===r.height)this.fire(new e.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:c,height:u}=r,d=r;this.style.addImage(l,{data:new e.q({width:c,height:u},new Uint8Array(d.data)),pixelRatio:n,stretchX:o,stretchY:a,content:s,sdf:i,usvg:!1,version:0,userImage:d}),d.onAdd&&d.onAdd(this,t)}}updateImage(t,r){this._lazyInitEmptyStyle();const n=e.I.from(t),i=this.style.getImage(n);if(!i)return void this.fire(new e.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const o=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?e.o.getImageData(r):r,{width:a,height:s,data:l}=o;if(void 0===a||void 0===s)return void this.fire(new e.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(a!==(i.usvg?i.icon.usvg_tree.width:i.data.width)||s!==(i.usvg?i.icon.usvg_tree.height:i.data.height))return void this.fire(new e.y(new Error("The width and height of the updated image (".concat(a,", ").concat(s,")\n                must be that same as the previous version of the image\n                (").concat(i.data.width,", ").concat(i.data.height,")"))));const c=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let u=!1;i.usvg?(i.data=new e.q({width:a,height:s},new Uint8Array(l)),i.usvg=!1,i.icon=void 0,u=!0):i.data.replace(l,c),this.style.updateImage(n,i,u)}hasImage(t){return t?!!this.style&&!!this.style.getImage(e.I.from(t)):(this.fire(new e.y(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(e.I.from(t))}loadImage(t,r){e.n(this._requestManager.transformRequest(t,e.R.Image),(t,n)=>{r(t,n instanceof HTMLImageElement?e.o.getImageData(n):n)})}listImages(){return this.style.listImages().map(e=>e.name)}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.y(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(t,r){return this.style.addImport(t,r).catch(t=>this.fire(new e.y(new Error("Failed to add import",t)))),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){if(!this._isValidId(e))return null;const t=this.style.getOwnLayer(e);return t?"custom"===t.type?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(e,t,r){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,r),this._update(!0)):this}setFilter(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,r),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,r,n),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,r,n),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}setLayerProperty(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?("appearances"===t&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(e,t,r,n),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(e){return this.style.setGlyphsUrl(e),this._update(!0)}getSchema(e){return this.style.getSchema(e)}setSchema(e,t){return this.style.setSchema(e,t),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,t){return this.style.setConfig(e,t),this._update(!0)}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,r){return this.style.setConfigProperty(e,t,r),this._update(!0)}getFeaturesetDescriptors(e){return this.style.getFeaturesetDescriptors(e)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(e){return this._lazyInitEmptyStyle(),this.style.setSnow(e),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(e){return this._lazyInitEmptyStyle(),this.style.setRain(e),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(e){return this._lazyInitEmptyStyle(),this.style.setColorTheme(e),this._update(!0)}setImportColorTheme(e,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(e,t),this._update(!0)}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.aT.convert(t),this.transform):0}setFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.setFeatureState(e,t),this._update())}removeFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.removeFeatureState(e,t),this._update())}getFeatureState(e){return e.source&&!this._isValidId(e.source)?null:this.style.getFeatureState(e)}_selectIndoorFloor(e){this.indoor.selectFloor(e)}_setIndoorActiveFloorsVisibility(e){this.indoor.setActiveFloorsVisibility(e)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Rl),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,n,i,o=this._container;for(;o&&(!n||!i);){const e=window.getComputedStyle(o).transform;e&&"none"!==e&&(r=e.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(n=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(i=r[3])),o=o.parentElement}this._containerWidth=n?Math.abs(e/n):e,this._containerHeight=i?Math.abs(t/i):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Dn(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=d("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=d("div","mapboxgl-canvas-container",e);this._canvas=d("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=d("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(e=>{n[e]=d("div","mapboxgl-ctrl-".concat(e),r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,r){const n=e.o.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(r),this._canvas.style.width="".concat(t,"px"),this._canvas.style.height="".concat(r,"px")}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=Object.assign({},u.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",t);r?(Z(r,!0),this.painter=new Os(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)}),e.k.testSupport(r)):this.fire(new e.y(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.z("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new e.z("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let n;this.fire(new e.z("renderstart")),++this._frameId;const i=this.painter.context.extTimerQuery,o=e.o.now(),s=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=s.createQuery(),s.beginQuery(i.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,r=this.transform.pitch,n=e.o.now(),i=new e.ac(t,{now:n,fadeDuration:l,pitch:r,transition:this.style.transition,worldview:this._worldview});this.style.update(i)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let c=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),c=this._updateAverageElevation(o),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):c=this._updateAverageElevation(o);const u=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),u&&(this._placementDirty=u.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,a.mark(r.load),this.fire(new e.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const t=e.o.now()-o;s.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{const r=s.getQueryParameter(n,s.QUERY_RESULT)/1e6;s.deleteQuery(n),this.fire(new e.z("gpu-timing-frame",{cpuTime:t,gpuTime:r}))},50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout(()=>{const r=this.painter.queryGpuTimers(t);this.fire(new e.z("gpu-timing-layer",{layerTimes:r}))},50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const r=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.z("gpu-timing-deferred-render",{gpuTime:r}))},50)}const d=this._sourcesDirty||this._styleDirty||this._placementDirty||c;if(d||this._repaint)this.triggerRepaint();else{const t=this.idle();if(t&&(c=this._updateAverageElevation(o,!0)),c)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.z("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,a.mark(r.fullLoad),this._performanceMetricsCollection&&G(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);const n=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(n||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let i=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(i)?i=0:this._averageElevationLastSampledAt=e;const o=Math.abs(t-i);if(o>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(i),r(i);this._averageElevation.easeTo(i,e,300)}else if(o>1e-4)return this._averageElevation.jumpTo(i),r(i)}return!!this._averageElevation.isEasing(e)&&r(this._averageElevation.getValue(e))}_authenticate(){W(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===C||401===t.status)){const t=this.painter.context.gl;Z(t,!1),this._logoControl instanceof Ul&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),U(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&z(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&j(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){V(this._requestManager._customAccessToken)}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,n=r.createFramebuffer();function i(e){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);const t=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,t),t}return r.bindFramebuffer(r.FRAMEBUFFER,n),this._canvasPixelComparison(i(e),t.canvasCopies.map(i),t.timeStamps)}_canvasPixelComparison(e,t,r){let n=r[1]-r[0];const i=e.length/4;for(let o=0;o<t.length;o++){const a=t[o];let s=0;for(let t=0;t<a.length;t+=4)a[t]===e[t]&&a[t+1]===e[t+1]&&a[t+2]===e[t+2]&&a[t+3]===e[t+3]&&(s+=1);n+=(r[o+2]-r[o+1])*(1-s/i)}return n}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),q.delete(this.painter.context.gl),K.remove(),D.remove(),this._removed=!0,this.fire(new e.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.o.frame(e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)}))}_preloadTiles(t){const r=this.style?this.style.getSourceCaches():[];return e.bw(r,(e,r)=>e._preloadTiles(t,r),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this.style&&e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(t,r){e.f4(t,r)}get version(){return t}},NavigationControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=Object.assign({},Kl,t),this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(e.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),d("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),d("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))}),this._compassIcon=d("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),r=t===e.getMaxZoom(),n=t===e.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(e.transform.pitch,"deg) rotateZ(").concat(e.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(e.transform.angle*(180/Math.PI),"deg)");e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Wl(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const r=d("button",e,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(e,t){if(!this._map)return;const r=this._map._getUIString("NavigationControl.".concat(t));e.setAttribute("aria-label",r),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends e.E{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const r=navigator.geolocation;this.options=Object.assign({geolocation:r},Jl,t),e.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ls(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var t=this;const r=function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!t.options.geolocation;t._supportsGeolocation=r,e(r)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(e=>r("denied"!==e.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),r=e.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.z("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.z("geolocate",Object.assign({coords:t.coords,timestamp:t.timestamp},t.toJSON?{toJSON:t.toJSON.bind(t)}:{}))),this._finish()}}_updateCamera(t){const r=new e.aT(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,i=this._map.getBearing(),o=Object.assign({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(n),o,{geolocateSource:!0})}_updateMarker(t){if(t){const r=new e.aT(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,r=e.cf(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*r);this._circleElement.style.width="".concat(n,"px"),this._circleElement.style.height="".concat(n,"px")}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.z("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=d("button","mapboxgl-ctrl-geolocate",this._container),d("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=d("div","mapboxgl-user-location"),this._dotElement.appendChild(d("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(d("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Yl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=d("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Yl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.z("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Dl,ScaleControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=Object.assign({},$l,t),e.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,n=t._containerWidth/2-e/2,i=t.unproject([n,r]),o=t.unproject([n+e,r]),a=i.distanceTo(o);if("imperial"===this.options.unit){const t=3.2808*a;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,a/1852,"nautical-mile"):a>=1e3?this._setScale(e,a/1e3,"kilometer"):this._setScale(e,a,"meter")}_setScale(e,t,r){this._map._requestDomTask(()=>{const n=function(e){const t=Math.pow(10,"".concat(Math.floor(e)).length-1);let r=e/t;return r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:r>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(r),t*r}(t),i=n/t;this._container.innerHTML="nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(n):"".concat(n,"&nbsp;").concat(ec[r]),this._container.style.width=e*i+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=d("button","mapboxgl-ctrl-fullscreen",this._controlContainer);d("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Rl,Popup:class extends e.E{constructor(t){super(),this.options=Object.assign(Object.create(tc),t),this._altitude=this.options.altitude,e.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.z("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.aT.convert(t),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(e){return this._altitude=e,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),r=document.createElement("body");let n;for(r.innerHTML=e;n=r.firstChild,n;)t.appendChild(n);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=d("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=d("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.innerHTML='<span aria-hidden="true">&#215;</span>',e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,n=this._pos;if(!t||!r||!n)return"bottom";const i=r.offsetWidth,o=r.offsetHeight,a=n.x<i/2,s=n.x>t.transform.width-i/2;if(n.y+e<o)return a?"top-left":s?"top-right":"top";if(n.y>t.transform.height-o){if(a)return"bottom-left";if(s)return"bottom-right"}return a?"left":s?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const r=this._map,n=this._content;if(!r||!this._lngLat&&!this._trackPointer||!n)return;let i=this._container;if(i||(i=this._container=d("div","mapboxgl-popup",r.getContainer()),this._tip=d("div","mapboxgl-popup-tip",i),i.appendChild(n)),this.options.maxWidth&&i.style.maxWidth!==this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ql(this._lngLat,this._pos,r.transform)),!this._trackPointer||t){const n=this._pos=this._trackPointer&&t instanceof e.P?t:r.project(this._lngLat,this._altitude),i=nc(this.options.offset),o=this._anchor=this._getAnchor(i.y),a=nc(this.options.offset,o),s=n.add(a).round();r._requestDomTask(()=>{this._container&&o&&(this._container.style.transform="".concat(Zl[o]," translate(").concat(s.x,"px,").concat(s.y,"px)"))})}if(!this._marker&&r._showingGlobe()){const t=e.f5(r.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(rc);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity="".concat(e)),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Yl,Style:Ln,LngLat:e.aT,LngLatBounds:e.aI,Point:e.P,MercatorCoordinate:e.ae,FreeCameraOptions:ln,Evented:e.E,config:e.e,prewarm:e.f9,clearPrewarmedResources:e.f8,get accessToken(){return e.e.ACCESS_TOKEN},set accessToken(t){e.e.ACCESS_TOKEN=t},get baseApiUrl(){return e.e.API_URL},set baseApiUrl(t){e.e.API_URL=t},get workerCount(){return e.fi.workerCount},set workerCount(t){e.fi.workerCount=t},get maxParallelImageRequests(){return e.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.e.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.fh(t)},get workerUrl(){return e.fg.workerUrl},set workerUrl(t){e.fg.workerUrl=t},get workerClass(){return e.fg.workerClass},set workerClass(t){e.fg.workerClass=t},get workerParams(){return e.fg.workerParams},set workerParams(t){e.fg.workerParams=t},get dracoUrl(){return e.ff()},set dracoUrl(t){e.fe(t)},get meshoptUrl(){return e.fd()},set meshoptUrl(t){e.fc(t)},setNow:e.o.setNow,restoreNow:e.o.restoreNow};return ic}),r}()},1153(e,t,r){"use strict";var n=r(5043),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,s=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,r){var n,o={},c=null,u=null;for(n in void 0!==r&&(c=""+r),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(u=t.ref),t)a.call(t,n)&&!l.hasOwnProperty(n)&&(o[n]=t[n]);if(e&&e.defaultProps)for(n in t=e.defaultProps)void 0===o[n]&&(o[n]=t[n]);return{$$typeof:i,type:e,key:c,ref:u,props:o,_owner:s.current}}t.Fragment=o,t.jsx=c,t.jsxs=c},1203(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(8420);t.isArrayLike=function(e){return null!=e&&"function"!==typeof e&&n.isLength(e.length)}},1293(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(4830);t.debounce=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};"object"!==typeof r&&(r={});const{leading:i=!1,trailing:o=!0,maxWait:a}=r,s=Array(2);let l;i&&(s[0]="leading"),o&&(s[1]="trailing");let c=null;const u=n.debounce(function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];l=e.apply(this,r),c=null},t,{edges:s}),d=function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return null!=a&&(null===c&&(c=Date.now()),Date.now()-c>=a)?(l=e.apply(this,r),c=Date.now(),u.cancel(),u.schedule(),l):(u.apply(this,r),l)};return d.cancel=u.cancel,d.flush=()=>(u.flush(),l),d}},1444(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(418),i=r(3272);t.toPath=function(e){if(Array.isArray(e))return e.map(i.toKey);if("symbol"===typeof e)return[e];const t=[],r=(e=n.toString(e)).length;if(0===r)return t;let o=0,a="",s="",l=!1;for(46===e.charCodeAt(0)&&(t.push(""),o++);o<r;){const n=e[o];s?"\\"===n&&o+1<r?(o++,a+=e[o]):n===s?s="":a+=n:l?'"'===n||"'"===n?s=n:"]"===n?(l=!1,t.push(a),a=""):a+=n:"["===n?(l=!0,a&&(t.push(a),a="")):"."===n?a&&(t.push(a),a=""):a+=n,o++}return a&&t.push(a),t}},1847(e,t,r){var n=r(4893);e.exports=function(e,t){if(null==e)return{};var r,i,o=n(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(o[r]=e[r])}return o},e.exports.__esModule=!0,e.exports.default=e.exports},2086(e,t,r){"use strict";e.exports=r(5082)},2104(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(1203),i=r(9921);t.isArrayLikeObject=function(e){return i.isObjectLike(e)&&n.isArrayLike(e)}},2132(e,t,r){"use strict";var n=r(2897).default;Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const i=r(870),o=r(4803),a=r(5093);function s(e,t,r,u){if(t===e)return!0;switch(typeof t){case"object":return function(e,t,r,n){if(null==t)return!0;if(Array.isArray(t))return l(e,t,r,n);if(t instanceof Map)return function(e,t,r,n){if(0===t.size)return!0;if(!(e instanceof Map))return!1;for(const[i,o]of t.entries()){if(!1===r(e.get(i),o,i,e,t,n))return!1}return!0}(e,t,r,n);if(t instanceof Set)return c(e,t,r,n);const i=Object.keys(t);if(null==e||o.isPrimitive(e))return 0===i.length;if(0===i.length)return!0;if(null!==n&&void 0!==n&&n.has(t))return n.get(t)===e;null===n||void 0===n||n.set(t,e);try{for(let a=0;a<i.length;a++){const s=i[a];if(!o.isPrimitive(e)&&!(s in e))return!1;if(void 0===t[s]&&void 0!==e[s])return!1;if(null===t[s]&&null!==e[s])return!1;if(!r(e[s],t[s],s,e,t,n))return!1}return!0}finally{null===n||void 0===n||n.delete(t)}}(e,t,r,u);case"function":return Object.keys(t).length>0?s(e,n({},t),r,u):a.isEqualsSameValueZero(e,t);default:return i.isObject(e)?"string"!==typeof t||""===t:a.isEqualsSameValueZero(e,t)}}function l(e,t,r,n){if(0===t.length)return!0;if(!Array.isArray(e))return!1;const i=new Set;for(let o=0;o<t.length;o++){const a=t[o];let s=!1;for(let l=0;l<e.length;l++){if(i.has(l))continue;let c=!1;if(r(e[l],a,o,e,t,n)&&(c=!0),c){i.add(l),s=!0;break}}if(!s)return!1}return!0}function c(e,t,r,n){return 0===t.size||e instanceof Set&&l([...e],[...t],r,n)}t.isMatchWith=function e(t,r,n){return"function"!==typeof n?e(t,r,()=>{}):s(t,r,function e(t,r,i,o,a,l){const c=n(t,r,i,o,a,l);return void 0!==c?Boolean(c):s(t,r,e,l)},new Map)},t.isSetMatch=c},2204(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(5316),i=r(7312),o=r(3799);t.sortBy=function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];const s=r.length;return s>1&&o.isIterateeCall(e,r[0],r[1])?r=[]:s>2&&o.isIterateeCall(r[0],r[1],r[2])&&(r=[r[0]]),n.orderBy(e,i.flatten(r),["asc"])}},2330(e,t,r){"use strict";var n=r(5043);var i="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},o=n.useState,a=n.useEffect,s=n.useLayoutEffect,l=n.useDebugValue;function c(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!i(e,r)}catch(n){return!0}}var u="undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement?function(e,t){return t()}:function(e,t){var r=t(),n=o({inst:{value:r,getSnapshot:t}}),i=n[0].inst,u=n[1];return s(function(){i.value=r,i.getSnapshot=t,c(i)&&u({inst:i})},[e,r,t]),a(function(){return c(i)&&u({inst:i}),e(function(){c(i)&&u({inst:i})})},[e]),l(r),r};t.useSyncExternalStore=void 0!==n.useSyncExternalStore?n.useSyncExternalStore:u},2489(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isDeepKey=function(e){switch(typeof e){case"number":case"symbol":return!1;case"string":return e.includes(".")||e.includes("[")||e.includes("]")}}},2682(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isPlainObject=function(e){if("object"!==typeof e)return!1;if(null==e)return!1;if(null===Object.getPrototypeOf(e))return!0;if("[object Object]"!==Object.prototype.toString.call(e)){var t;const r=e[Symbol.toStringTag];if(null==r)return!1;return!!(null!==(t=Object.getOwnPropertyDescriptor(e,Symbol.toStringTag))&&void 0!==t&&t.writable)&&e.toString()==="[object ".concat(r,"]")}let r=e;for(;null!==Object.getPrototypeOf(r);)r=Object.getPrototypeOf(r);return Object.getPrototypeOf(e)===r}},2715(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(9599),i=r(7330),o=r(3808),a=r(8845);t.iteratee=function(e){if(null==e)return n.identity;switch(typeof e){case"function":return e;case"object":return Array.isArray(e)&&2===e.length?a.matchesProperty(e[0],e[1]):o.matches(e);case"string":case"symbol":case"number":return i.property(e)}}},2730(e,t,r){"use strict";var n=r(5043),i=r(8853);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,r=1;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,s={};function l(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)a.add(t[e])}var u=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),d=Object.prototype.hasOwnProperty,h=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,A={},f={};function p(e,t,r,n,i,o,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=n,this.attributeNamespace=i,this.mustUseProperty=r,this.propertyName=e,this.type=t,this.sanitizeURL=o,this.removeEmptyString=a}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){m[e]=new p(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];m[t]=new p(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){m[e]=new p(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){m[e]=new p(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){m[e]=new p(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){m[e]=new p(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){m[e]=new p(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){m[e]=new p(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){m[e]=new p(e,5,!1,e.toLowerCase(),null,!1,!1)});var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function _(e,t,r,n){var i=m.hasOwnProperty(t)?m[t]:null;(null!==i?0!==i.type:n||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,r,n){if(null===t||"undefined"===typeof t||function(e,t,r,n){if(null!==r&&0===r.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!n&&(null!==r?!r.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,r,n))return!0;if(n)return!1;if(null!==r)switch(r.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,r,i,n)&&(r=null),n||null===i?function(e){return!!d.call(f,e)||!d.call(A,e)&&(h.test(e)?f[e]=!0:(A[e]=!0,!1))}(t)&&(null===r?e.removeAttribute(t):e.setAttribute(t,""+r)):i.mustUseProperty?e[i.propertyName]=null===r?3!==i.type&&"":r:(t=i.attributeName,n=i.attributeNamespace,null===r?e.removeAttribute(t):(r=3===(i=i.type)||4===i&&!0===r?"":""+r,n?e.setAttributeNS(n,t,r):e.setAttribute(t,r))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(g,y);m[t]=new p(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(g,y);m[t]=new p(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(g,y);m[t]=new p(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){m[e]=new p(e,1,!1,e.toLowerCase(),null,!1,!1)}),m.xlinkHref=new p("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){m[e]=new p(e,1,!1,e.toLowerCase(),null,!0,!0)});var v=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,x=Symbol.for("react.element"),w=Symbol.for("react.portal"),b=Symbol.for("react.fragment"),B=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),E=Symbol.for("react.provider"),S=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),I=Symbol.for("react.suspense"),F=Symbol.for("react.suspense_list"),k=Symbol.for("react.memo"),P=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var M=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var O=Symbol.iterator;function L(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=O&&e[O]||e["@@iterator"])?e:null}var D,U=Object.assign;function R(e){if(void 0===D)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);D=t&&t[1]||""}return"\n"+D+e}var z=!1;function N(e,t){if(!e||z)return"";z=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var n=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){n=c}e.call(t.prototype)}else{try{throw Error()}catch(c){n=c}e()}}catch(c){if(c&&n&&"string"===typeof c.stack){for(var i=c.stack.split("\n"),o=n.stack.split("\n"),a=i.length-1,s=o.length-1;1<=a&&0<=s&&i[a]!==o[s];)s--;for(;1<=a&&0<=s;a--,s--)if(i[a]!==o[s]){if(1!==a||1!==s)do{if(a--,0>--s||i[a]!==o[s]){var l="\n"+i[a].replace(" at new "," at ");return e.displayName&&l.includes("<anonymous>")&&(l=l.replace("<anonymous>",e.displayName)),l}}while(1<=a&&0<=s);break}}}finally{z=!1,Error.prepareStackTrace=r}return(e=e?e.displayName||e.name:"")?R(e):""}function j(e){switch(e.tag){case 5:return R(e.type);case 16:return R("Lazy");case 13:return R("Suspense");case 19:return R("SuspenseList");case 0:case 2:case 15:return e=N(e.type,!1);case 11:return e=N(e.type.render,!1);case 1:return e=N(e.type,!0);default:return""}}function Q(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case b:return"Fragment";case w:return"Portal";case C:return"Profiler";case B:return"StrictMode";case I:return"Suspense";case F:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case S:return(e.displayName||"Context")+".Consumer";case E:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case k:return null!==(t=e.displayName||null)?t:Q(e.type)||"Memo";case P:t=e._payload,e=e._init;try{return Q(e(t))}catch(r){}}return null}function V(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Q(t);case 8:return t===B?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function H(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function K(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",r=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),n=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof r&&"function"===typeof r.get&&"function"===typeof r.set){var i=r.get,o=r.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){n=""+e,o.call(this,e)}}),Object.defineProperty(e,t,{enumerable:r.enumerable}),{getValue:function(){return n},setValue:function(e){n=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function W(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=G(e)?e.checked?"true":"false":e.value),(e=n)!==r&&(t.setValue(e),!0)}function q(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Z(e,t){var r=t.checked;return U({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=r?r:e._wrapperState.initialChecked})}function X(e,t){var r=null==t.defaultValue?"":t.defaultValue,n=null!=t.checked?t.checked:t.defaultChecked;r=H(null!=t.value?t.value:r),e._wrapperState={initialChecked:n,initialValue:r,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&_(e,"checked",t,!1)}function J(e,t){Y(e,t);var r=H(t.value),n=t.type;if(null!=r)"number"===n?(0===r&&""===e.value||e.value!=r)&&(e.value=""+r):e.value!==""+r&&(e.value=""+r);else if("submit"===n||"reset"===n)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,r):t.hasOwnProperty("defaultValue")&&ee(e,t.type,H(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,r){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var n=t.type;if(!("submit"!==n&&"reset"!==n||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,r||t===e.value||(e.value=t),e.defaultValue=t}""!==(r=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==r&&(e.name=r)}function ee(e,t,r){"number"===t&&q(e.ownerDocument)===e||(null==r?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+r&&(e.defaultValue=""+r))}var te=Array.isArray;function re(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+H(r),t=null,i=0;i<e.length;i++){if(e[i].value===r)return e[i].selected=!0,void(n&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function ne(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return U({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ie(e,t){var r=t.value;if(null==r){if(r=t.children,t=t.defaultValue,null!=r){if(null!=t)throw Error(o(92));if(te(r)){if(1<r.length)throw Error(o(93));r=r[0]}t=r}null==t&&(t=""),r=t}e._wrapperState={initialValue:H(r)}}function oe(e,t){var r=H(t.value),n=H(t.defaultValue);null!=r&&((r=""+r)!==e.value&&(e.value=r),null==t.defaultValue&&e.defaultValue!==r&&(e.defaultValue=r)),null!=n&&(e.defaultValue=""+n)}function ae(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function le(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,ue,de=(ue=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,r,n){MSApp.execUnsafeLocalFunction(function(){return ue(e,t)})}:ue);function he(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}var Ae={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},fe=["Webkit","ms","Moz","O"];function pe(e,t,r){return null==t||"boolean"===typeof t||""===t?"":r||"number"!==typeof t||0===t||Ae.hasOwnProperty(e)&&Ae[e]?(""+t).trim():t+"px"}function me(e,t){for(var r in e=e.style,t)if(t.hasOwnProperty(r)){var n=0===r.indexOf("--"),i=pe(r,t[r],n);"float"===r&&(r="cssFloat"),n?e.setProperty(r,i):e[r]=i}}Object.keys(Ae).forEach(function(e){fe.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Ae[t]=Ae[e]})});var ge=U({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62))}}function _e(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ve=null;function xe(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,be=null,Be=null;function Ce(e){if(e=_i(e)){if("function"!==typeof we)throw Error(o(280));var t=e.stateNode;t&&(t=xi(t),we(e.stateNode,e.type,t))}}function Ee(e){be?Be?Be.push(e):Be=[e]:be=e}function Se(){if(be){var e=be,t=Be;if(Be=be=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Te(e,t){return e(t)}function Ie(){}var Fe=!1;function ke(e,t,r){if(Fe)return e(t,r);Fe=!0;try{return Te(e,t,r)}finally{Fe=!1,(null!==be||null!==Be)&&(Ie(),Se())}}function Pe(e,t){var r=e.stateNode;if(null===r)return null;var n=xi(r);if(null===n)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(r&&"function"!==typeof r)throw Error(o(231,t,typeof r));return r}var Me=!1;if(u)try{var Oe={};Object.defineProperty(Oe,"passive",{get:function(){Me=!0}}),window.addEventListener("test",Oe,Oe),window.removeEventListener("test",Oe,Oe)}catch(ue){Me=!1}function Le(e,t,r,n,i,o,a,s,l){var c=Array.prototype.slice.call(arguments,3);try{t.apply(r,c)}catch(u){this.onError(u)}}var De=!1,Ue=null,Re=!1,ze=null,Ne={onError:function(e){De=!0,Ue=e}};function je(e,t,r,n,i,o,a,s,l){De=!1,Ue=null,Le.apply(Ne,arguments)}function Qe(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function Ve(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function He(e){if(Qe(e)!==e)throw Error(o(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=Qe(e)))throw Error(o(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(n=i.return)){r=n;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===r)return He(i),e;if(a===n)return He(i),t;a=a.sibling}throw Error(o(188))}if(r.return!==n.return)r=i,n=a;else{for(var s=!1,l=i.child;l;){if(l===r){s=!0,r=i,n=a;break}if(l===n){s=!0,n=i,r=a;break}l=l.sibling}if(!s){for(l=a.child;l;){if(l===r){s=!0,r=a,n=i;break}if(l===n){s=!0,n=a,r=i;break}l=l.sibling}if(!s)throw Error(o(189))}}if(r.alternate!==n)throw Error(o(190))}if(3!==r.tag)throw Error(o(188));return r.stateNode.current===r?e:t}(e))?Ke(e):null}function Ke(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=Ke(e);if(null!==t)return t;e=e.sibling}return null}var We=i.unstable_scheduleCallback,qe=i.unstable_cancelCallback,Ze=i.unstable_shouldYield,Xe=i.unstable_requestPaint,Ye=i.unstable_now,Je=i.unstable_getCurrentPriorityLevel,$e=i.unstable_ImmediatePriority,et=i.unstable_UserBlockingPriority,tt=i.unstable_NormalPriority,rt=i.unstable_LowPriority,nt=i.unstable_IdlePriority,it=null,ot=null;var at=Math.clz32?Math.clz32:function(e){return e>>>=0,0===e?32:31-(st(e)/lt|0)|0},st=Math.log,lt=Math.LN2;var ct=64,ut=4194304;function dt(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ht(e,t){var r=e.pendingLanes;if(0===r)return 0;var n=0,i=e.suspendedLanes,o=e.pingedLanes,a=268435455&r;if(0!==a){var s=a&~i;0!==s?n=dt(s):0!==(o&=a)&&(n=dt(o))}else 0!==(a=r&~i)?n=dt(a):0!==o&&(n=dt(o));if(0===n)return 0;if(0!==t&&t!==n&&0===(t&i)&&((i=n&-n)>=(o=t&-t)||16===i&&0!==(4194240&o)))return t;if(0!==(4&n)&&(n|=16&r),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=n;0<t;)i=1<<(r=31-at(t)),n|=e[r],t&=~i;return n}function At(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function ft(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function pt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function gt(e,t,r){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-at(t)]=r}function yt(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-at(r),i=1<<n;i&t|e[n]&t&&(e[n]|=t),r&=~i}}var _t=0;function vt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var xt,wt,bt,Bt,Ct,Et=!1,St=[],Tt=null,It=null,Ft=null,kt=new Map,Pt=new Map,Mt=[],Ot="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Lt(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":It=null;break;case"mouseover":case"mouseout":Ft=null;break;case"pointerover":case"pointerout":kt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Pt.delete(t.pointerId)}}function Dt(e,t,r,n,i,o){return null===e||e.nativeEvent!==o?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:o,targetContainers:[i]},null!==t&&(null!==(t=_i(t))&&wt(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Ut(e){var t=yi(e.target);if(null!==t){var r=Qe(t);if(null!==r)if(13===(t=r.tag)){if(null!==(t=Ve(r)))return e.blockedOn=t,void Ct(e.priority,function(){bt(r)})}else if(3===t&&r.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}e.blockedOn=null}function Rt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var r=Zt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==r)return null!==(t=_i(r))&&wt(t),e.blockedOn=r,!1;var n=new(r=e.nativeEvent).constructor(r.type,r);ve=n,r.target.dispatchEvent(n),ve=null,t.shift()}return!0}function zt(e,t,r){Rt(e)&&r.delete(t)}function Nt(){Et=!1,null!==Tt&&Rt(Tt)&&(Tt=null),null!==It&&Rt(It)&&(It=null),null!==Ft&&Rt(Ft)&&(Ft=null),kt.forEach(zt),Pt.forEach(zt)}function jt(e,t){e.blockedOn===t&&(e.blockedOn=null,Et||(Et=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,Nt)))}function Qt(e){function t(t){return jt(t,e)}if(0<St.length){jt(St[0],e);for(var r=1;r<St.length;r++){var n=St[r];n.blockedOn===e&&(n.blockedOn=null)}}for(null!==Tt&&jt(Tt,e),null!==It&&jt(It,e),null!==Ft&&jt(Ft,e),kt.forEach(t),Pt.forEach(t),r=0;r<Mt.length;r++)(n=Mt[r]).blockedOn===e&&(n.blockedOn=null);for(;0<Mt.length&&null===(r=Mt[0]).blockedOn;)Ut(r),null===r.blockedOn&&Mt.shift()}var Vt=v.ReactCurrentBatchConfig,Ht=!0;function Gt(e,t,r,n){var i=_t,o=Vt.transition;Vt.transition=null;try{_t=1,Wt(e,t,r,n)}finally{_t=i,Vt.transition=o}}function Kt(e,t,r,n){var i=_t,o=Vt.transition;Vt.transition=null;try{_t=4,Wt(e,t,r,n)}finally{_t=i,Vt.transition=o}}function Wt(e,t,r,n){if(Ht){var i=Zt(e,t,r,n);if(null===i)Hn(e,t,n,qt,r),Lt(e,n);else if(function(e,t,r,n,i){switch(t){case"focusin":return Tt=Dt(Tt,e,t,r,n,i),!0;case"dragenter":return It=Dt(It,e,t,r,n,i),!0;case"mouseover":return Ft=Dt(Ft,e,t,r,n,i),!0;case"pointerover":var o=i.pointerId;return kt.set(o,Dt(kt.get(o)||null,e,t,r,n,i)),!0;case"gotpointercapture":return o=i.pointerId,Pt.set(o,Dt(Pt.get(o)||null,e,t,r,n,i)),!0}return!1}(i,e,t,r,n))n.stopPropagation();else if(Lt(e,n),4&t&&-1<Ot.indexOf(e)){for(;null!==i;){var o=_i(i);if(null!==o&&xt(o),null===(o=Zt(e,t,r,n))&&Hn(e,t,n,qt,r),o===i)break;i=o}null!==i&&n.stopPropagation()}else Hn(e,t,n,null,r)}}var qt=null;function Zt(e,t,r,n){if(qt=null,null!==(e=yi(e=xe(n))))if(null===(t=Qe(e)))e=null;else if(13===(r=t.tag)){if(null!==(e=Ve(t)))return e;e=null}else if(3===r){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return qt=e,null}function Xt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case rt:return 16;case nt:return 536870912;default:return 16}default:return 16}}var Yt=null,Jt=null,$t=null;function er(){if($t)return $t;var e,t,r=Jt,n=r.length,i="value"in Yt?Yt.value:Yt.textContent,o=i.length;for(e=0;e<n&&r[e]===i[e];e++);var a=n-e;for(t=1;t<=a&&r[n-t]===i[o-t];t++);return $t=i.slice(e,1<t?1-t:void 0)}function tr(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function rr(){return!0}function nr(){return!1}function ir(e){function t(t,r,n,i,o){for(var a in this._reactName=t,this._targetInst=n,this.type=r,this.nativeEvent=i,this.target=o,this.currentTarget=null,e)e.hasOwnProperty(a)&&(t=e[a],this[a]=t?t(i):i[a]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?rr:nr,this.isPropagationStopped=nr,this}return U(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=rr)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=rr)},persist:function(){},isPersistent:rr}),t}var or,ar,sr,lr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},cr=ir(lr),ur=U({},lr,{view:0,detail:0}),dr=ir(ur),hr=U({},ur,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Br,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==sr&&(sr&&"mousemove"===e.type?(or=e.screenX-sr.screenX,ar=e.screenY-sr.screenY):ar=or=0,sr=e),or)},movementY:function(e){return"movementY"in e?e.movementY:ar}}),Ar=ir(hr),fr=ir(U({},hr,{dataTransfer:0})),pr=ir(U({},ur,{relatedTarget:0})),mr=ir(U({},lr,{animationName:0,elapsedTime:0,pseudoElement:0})),gr=U({},lr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),yr=ir(gr),_r=ir(U({},lr,{data:0})),vr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function br(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wr[e])&&!!t[e]}function Br(){return br}var Cr=U({},ur,{key:function(e){if(e.key){var t=vr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tr(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xr[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Br,charCode:function(e){return"keypress"===e.type?tr(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tr(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),Er=ir(Cr),Sr=ir(U({},hr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Tr=ir(U({},ur,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Br})),Ir=ir(U({},lr,{propertyName:0,elapsedTime:0,pseudoElement:0})),Fr=U({},hr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),kr=ir(Fr),Pr=[9,13,27,32],Mr=u&&"CompositionEvent"in window,Or=null;u&&"documentMode"in document&&(Or=document.documentMode);var Lr=u&&"TextEvent"in window&&!Or,Dr=u&&(!Mr||Or&&8<Or&&11>=Or),Ur=String.fromCharCode(32),Rr=!1;function zr(e,t){switch(e){case"keyup":return-1!==Pr.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Nr(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var jr=!1;var Qr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Vr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Qr[e.type]:"textarea"===t}function Hr(e,t,r,n){Ee(n),0<(t=Kn(t,"onChange")).length&&(r=new cr("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Gr=null,Kr=null;function Wr(e){Rn(e,0)}function qr(e){if(W(vi(e)))return e}function Zr(e,t){if("change"===e)return t}var Xr=!1;if(u){var Yr;if(u){var Jr="oninput"in document;if(!Jr){var $r=document.createElement("div");$r.setAttribute("oninput","return;"),Jr="function"===typeof $r.oninput}Yr=Jr}else Yr=!1;Xr=Yr&&(!document.documentMode||9<document.documentMode)}function en(){Gr&&(Gr.detachEvent("onpropertychange",tn),Kr=Gr=null)}function tn(e){if("value"===e.propertyName&&qr(Kr)){var t=[];Hr(t,Kr,e,xe(e)),ke(Wr,t)}}function rn(e,t,r){"focusin"===e?(en(),Kr=r,(Gr=t).attachEvent("onpropertychange",tn)):"focusout"===e&&en()}function nn(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return qr(Kr)}function on(e,t){if("click"===e)return qr(t)}function an(e,t){if("input"===e||"change"===e)return qr(t)}var sn="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ln(e,t){if(sn(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!d.call(t,i)||!sn(e[i],t[i]))return!1}return!0}function cn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function un(e,t){var r,n=cn(e);for(e=0;n;){if(3===n.nodeType){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=cn(n)}}function dn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?dn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function hn(){for(var e=window,t=q();t instanceof e.HTMLIFrameElement;){try{var r="string"===typeof t.contentWindow.location.href}catch(n){r=!1}if(!r)break;t=q((e=t.contentWindow).document)}return t}function An(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function fn(e){var t=hn(),r=e.focusedElem,n=e.selectionRange;if(t!==r&&r&&r.ownerDocument&&dn(r.ownerDocument.documentElement,r)){if(null!==n&&An(r))if(t=n.start,void 0===(e=n.end)&&(e=t),"selectionStart"in r)r.selectionStart=t,r.selectionEnd=Math.min(e,r.value.length);else if((e=(t=r.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var i=r.textContent.length,o=Math.min(n.start,i);n=void 0===n.end?o:Math.min(n.end,i),!e.extend&&o>n&&(i=n,n=o,o=i),i=un(r,o);var a=un(r,n);i&&a&&(1!==e.rangeCount||e.anchorNode!==i.node||e.anchorOffset!==i.offset||e.focusNode!==a.node||e.focusOffset!==a.offset)&&((t=t.createRange()).setStart(i.node,i.offset),e.removeAllRanges(),o>n?(e.addRange(t),e.extend(a.node,a.offset)):(t.setEnd(a.node,a.offset),e.addRange(t)))}for(t=[],e=r;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof r.focus&&r.focus(),r=0;r<t.length;r++)(e=t[r]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var pn=u&&"documentMode"in document&&11>=document.documentMode,mn=null,gn=null,yn=null,_n=!1;function vn(e,t,r){var n=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;_n||null==mn||mn!==q(n)||("selectionStart"in(n=mn)&&An(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},yn&&ln(yn,n)||(yn=n,0<(n=Kn(gn,"onSelect")).length&&(t=new cr("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=mn)))}function xn(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var wn={animationend:xn("Animation","AnimationEnd"),animationiteration:xn("Animation","AnimationIteration"),animationstart:xn("Animation","AnimationStart"),transitionend:xn("Transition","TransitionEnd")},bn={},Bn={};function Cn(e){if(bn[e])return bn[e];if(!wn[e])return e;var t,r=wn[e];for(t in r)if(r.hasOwnProperty(t)&&t in Bn)return bn[e]=r[t];return e}u&&(Bn=document.createElement("div").style,"AnimationEvent"in window||(delete wn.animationend.animation,delete wn.animationiteration.animation,delete wn.animationstart.animation),"TransitionEvent"in window||delete wn.transitionend.transition);var En=Cn("animationend"),Sn=Cn("animationiteration"),Tn=Cn("animationstart"),In=Cn("transitionend"),Fn=new Map,kn="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Pn(e,t){Fn.set(e,t),l(t,[e])}for(var Mn=0;Mn<kn.length;Mn++){var On=kn[Mn];Pn(On.toLowerCase(),"on"+(On[0].toUpperCase()+On.slice(1)))}Pn(En,"onAnimationEnd"),Pn(Sn,"onAnimationIteration"),Pn(Tn,"onAnimationStart"),Pn("dblclick","onDoubleClick"),Pn("focusin","onFocus"),Pn("focusout","onBlur"),Pn(In,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),l("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),l("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),l("onBeforeInput",["compositionend","keypress","textInput","paste"]),l("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),l("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ln="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Dn=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ln));function Un(e,t,r){var n=e.type||"unknown-event";e.currentTarget=r,function(e,t,r,n,i,a,s,l,c){if(je.apply(this,arguments),De){if(!De)throw Error(o(198));var u=Ue;De=!1,Ue=null,Re||(Re=!0,ze=u)}}(n,t,void 0,e),e.currentTarget=null}function Rn(e,t){t=0!==(4&t);for(var r=0;r<e.length;r++){var n=e[r],i=n.event;n=n.listeners;e:{var o=void 0;if(t)for(var a=n.length-1;0<=a;a--){var s=n[a],l=s.instance,c=s.currentTarget;if(s=s.listener,l!==o&&i.isPropagationStopped())break e;Un(i,s,c),o=l}else for(a=0;a<n.length;a++){if(l=(s=n[a]).instance,c=s.currentTarget,s=s.listener,l!==o&&i.isPropagationStopped())break e;Un(i,s,c),o=l}}}if(Re)throw e=ze,Re=!1,ze=null,e}function zn(e,t){var r=t[pi];void 0===r&&(r=t[pi]=new Set);var n=e+"__bubble";r.has(n)||(Vn(t,e,2,!1),r.add(n))}function Nn(e,t,r){var n=0;t&&(n|=4),Vn(r,e,n,t)}var jn="_reactListening"+Math.random().toString(36).slice(2);function Qn(e){if(!e[jn]){e[jn]=!0,a.forEach(function(t){"selectionchange"!==t&&(Dn.has(t)||Nn(t,!1,e),Nn(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[jn]||(t[jn]=!0,Nn("selectionchange",!1,t))}}function Vn(e,t,r,n){switch(Xt(t)){case 1:var i=Gt;break;case 4:i=Kt;break;default:i=Wt}r=i.bind(null,t,r,e),i=void 0,!Me||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),n?void 0!==i?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):void 0!==i?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function Hn(e,t,r,n,i){var o=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var a=n.tag;if(3===a||4===a){var s=n.stateNode.containerInfo;if(s===i||8===s.nodeType&&s.parentNode===i)break;if(4===a)for(a=n.return;null!==a;){var l=a.tag;if((3===l||4===l)&&((l=a.stateNode.containerInfo)===i||8===l.nodeType&&l.parentNode===i))return;a=a.return}for(;null!==s;){if(null===(a=yi(s)))return;if(5===(l=a.tag)||6===l){n=o=a;continue e}s=s.parentNode}}n=n.return}ke(function(){var n=o,i=xe(r),a=[];e:{var s=Fn.get(e);if(void 0!==s){var l=cr,c=e;switch(e){case"keypress":if(0===tr(r))break e;case"keydown":case"keyup":l=Er;break;case"focusin":c="focus",l=pr;break;case"focusout":c="blur",l=pr;break;case"beforeblur":case"afterblur":l=pr;break;case"click":if(2===r.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":l=Ar;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":l=fr;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":l=Tr;break;case En:case Sn:case Tn:l=mr;break;case In:l=Ir;break;case"scroll":l=dr;break;case"wheel":l=kr;break;case"copy":case"cut":case"paste":l=yr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":l=Sr}var u=0!==(4&t),d=!u&&"scroll"===e,h=u?null!==s?s+"Capture":null:s;u=[];for(var A,f=n;null!==f;){var p=(A=f).stateNode;if(5===A.tag&&null!==p&&(A=p,null!==h&&(null!=(p=Pe(f,h))&&u.push(Gn(f,p,A)))),d)break;f=f.return}0<u.length&&(s=new l(s,c,null,r,i),a.push({event:s,listeners:u}))}}if(0===(7&t)){if(l="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||r===ve||!(c=r.relatedTarget||r.fromElement)||!yi(c)&&!c[fi])&&(l||s)&&(s=i.window===i?i:(s=i.ownerDocument)?s.defaultView||s.parentWindow:window,l?(l=n,null!==(c=(c=r.relatedTarget||r.toElement)?yi(c):null)&&(c!==(d=Qe(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(l=null,c=n),l!==c)){if(u=Ar,p="onMouseLeave",h="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(u=Sr,p="onPointerLeave",h="onPointerEnter",f="pointer"),d=null==l?s:vi(l),A=null==c?s:vi(c),(s=new u(p,f+"leave",l,r,i)).target=d,s.relatedTarget=A,p=null,yi(i)===n&&((u=new u(h,f+"enter",c,r,i)).target=A,u.relatedTarget=d,p=u),d=p,l&&c)e:{for(h=c,f=0,A=u=l;A;A=Wn(A))f++;for(A=0,p=h;p;p=Wn(p))A++;for(;0<f-A;)u=Wn(u),f--;for(;0<A-f;)h=Wn(h),A--;for(;f--;){if(u===h||null!==h&&u===h.alternate)break e;u=Wn(u),h=Wn(h)}u=null}else u=null;null!==l&&qn(a,s,l,u,!1),null!==c&&null!==d&&qn(a,d,c,u,!0)}if("select"===(l=(s=n?vi(n):window).nodeName&&s.nodeName.toLowerCase())||"input"===l&&"file"===s.type)var m=Zr;else if(Vr(s))if(Xr)m=an;else{m=nn;var g=rn}else(l=s.nodeName)&&"input"===l.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=on);switch(m&&(m=m(e,n))?Hr(a,m,r,i):(g&&g(e,s,n),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=n?vi(n):window,e){case"focusin":(Vr(g)||"true"===g.contentEditable)&&(mn=g,gn=n,yn=null);break;case"focusout":yn=gn=mn=null;break;case"mousedown":_n=!0;break;case"contextmenu":case"mouseup":case"dragend":_n=!1,vn(a,r,i);break;case"selectionchange":if(pn)break;case"keydown":case"keyup":vn(a,r,i)}var y;if(Mr)e:{switch(e){case"compositionstart":var _="onCompositionStart";break e;case"compositionend":_="onCompositionEnd";break e;case"compositionupdate":_="onCompositionUpdate";break e}_=void 0}else jr?zr(e,r)&&(_="onCompositionEnd"):"keydown"===e&&229===r.keyCode&&(_="onCompositionStart");_&&(Dr&&"ko"!==r.locale&&(jr||"onCompositionStart"!==_?"onCompositionEnd"===_&&jr&&(y=er()):(Jt="value"in(Yt=i)?Yt.value:Yt.textContent,jr=!0)),0<(g=Kn(n,_)).length&&(_=new _r(_,e,null,r,i),a.push({event:_,listeners:g}),y?_.data=y:null!==(y=Nr(r))&&(_.data=y))),(y=Lr?function(e,t){switch(e){case"compositionend":return Nr(t);case"keypress":return 32!==t.which?null:(Rr=!0,Ur);case"textInput":return(e=t.data)===Ur&&Rr?null:e;default:return null}}(e,r):function(e,t){if(jr)return"compositionend"===e||!Mr&&zr(e,t)?(e=er(),$t=Jt=Yt=null,jr=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Dr&&"ko"!==t.locale?null:t.data}}(e,r))&&(0<(n=Kn(n,"onBeforeInput")).length&&(i=new _r("onBeforeInput","beforeinput",null,r,i),a.push({event:i,listeners:n}),i.data=y))}Rn(a,t)})}function Gn(e,t,r){return{instance:e,listener:t,currentTarget:r}}function Kn(e,t){for(var r=t+"Capture",n=[];null!==e;){var i=e,o=i.stateNode;5===i.tag&&null!==o&&(i=o,null!=(o=Pe(e,r))&&n.unshift(Gn(e,o,i)),null!=(o=Pe(e,t))&&n.push(Gn(e,o,i))),e=e.return}return n}function Wn(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function qn(e,t,r,n,i){for(var o=t._reactName,a=[];null!==r&&r!==n;){var s=r,l=s.alternate,c=s.stateNode;if(null!==l&&l===n)break;5===s.tag&&null!==c&&(s=c,i?null!=(l=Pe(r,o))&&a.unshift(Gn(r,l,s)):i||null!=(l=Pe(r,o))&&a.push(Gn(r,l,s))),r=r.return}0!==a.length&&e.push({event:t,listeners:a})}var Zn=/\r\n?/g,Xn=/\u0000|\uFFFD/g;function Yn(e){return("string"===typeof e?e:""+e).replace(Zn,"\n").replace(Xn,"")}function Jn(e,t,r){if(t=Yn(t),Yn(e)!==t&&r)throw Error(o(425))}function $n(){}var ei=null,ti=null;function ri(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ni="function"===typeof setTimeout?setTimeout:void 0,ii="function"===typeof clearTimeout?clearTimeout:void 0,oi="function"===typeof Promise?Promise:void 0,ai="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof oi?function(e){return oi.resolve(null).then(e).catch(si)}:ni;function si(e){setTimeout(function(){throw e})}function li(e,t){var r=t,n=0;do{var i=r.nextSibling;if(e.removeChild(r),i&&8===i.nodeType)if("/$"===(r=i.data)){if(0===n)return e.removeChild(i),void Qt(t);n--}else"$"!==r&&"$?"!==r&&"$!"!==r||n++;r=i}while(r);Qt(t)}function ci(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function ui(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("$"===r||"$!"===r||"$?"===r){if(0===t)return e;t--}else"/$"===r&&t++}e=e.previousSibling}return null}var di=Math.random().toString(36).slice(2),hi="__reactFiber$"+di,Ai="__reactProps$"+di,fi="__reactContainer$"+di,pi="__reactEvents$"+di,mi="__reactListeners$"+di,gi="__reactHandles$"+di;function yi(e){var t=e[hi];if(t)return t;for(var r=e.parentNode;r;){if(t=r[fi]||r[hi]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=ui(e);null!==e;){if(r=e[hi])return r;e=ui(e)}return t}r=(e=r).parentNode}return null}function _i(e){return!(e=e[hi]||e[fi])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function vi(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function xi(e){return e[Ai]||null}var wi=[],bi=-1;function Bi(e){return{current:e}}function Ci(e){0>bi||(e.current=wi[bi],wi[bi]=null,bi--)}function Ei(e,t){bi++,wi[bi]=e.current,e.current=t}var Si={},Ti=Bi(Si),Ii=Bi(!1),Fi=Si;function ki(e,t){var r=e.type.contextTypes;if(!r)return Si;var n=e.stateNode;if(n&&n.__reactInternalMemoizedUnmaskedChildContext===t)return n.__reactInternalMemoizedMaskedChildContext;var i,o={};for(i in r)o[i]=t[i];return n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=o),o}function Pi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Mi(){Ci(Ii),Ci(Ti)}function Oi(e,t,r){if(Ti.current!==Si)throw Error(o(168));Ei(Ti,t),Ei(Ii,r)}function Li(e,t,r){var n=e.stateNode;if(t=t.childContextTypes,"function"!==typeof n.getChildContext)return r;for(var i in n=n.getChildContext())if(!(i in t))throw Error(o(108,V(e)||"Unknown",i));return U({},r,n)}function Di(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Si,Fi=Ti.current,Ei(Ti,e),Ei(Ii,Ii.current),!0}function Ui(e,t,r){var n=e.stateNode;if(!n)throw Error(o(169));r?(e=Li(e,t,Fi),n.__reactInternalMemoizedMergedChildContext=e,Ci(Ii),Ci(Ti),Ei(Ti,e)):Ci(Ii),Ei(Ii,r)}var Ri=null,zi=!1,Ni=!1;function ji(e){null===Ri?Ri=[e]:Ri.push(e)}function Qi(){if(!Ni&&null!==Ri){Ni=!0;var e=0,t=_t;try{var r=Ri;for(_t=1;e<r.length;e++){var n=r[e];do{n=n(!0)}while(null!==n)}Ri=null,zi=!1}catch(i){throw null!==Ri&&(Ri=Ri.slice(e+1)),We($e,Qi),i}finally{_t=t,Ni=!1}}return null}var Vi=[],Hi=0,Gi=null,Ki=0,Wi=[],qi=0,Zi=null,Xi=1,Yi="";function Ji(e,t){Vi[Hi++]=Ki,Vi[Hi++]=Gi,Gi=e,Ki=t}function $i(e,t,r){Wi[qi++]=Xi,Wi[qi++]=Yi,Wi[qi++]=Zi,Zi=e;var n=Xi;e=Yi;var i=32-at(n)-1;n&=~(1<<i),r+=1;var o=32-at(t)+i;if(30<o){var a=i-i%5;o=(n&(1<<a)-1).toString(32),n>>=a,i-=a,Xi=1<<32-at(t)+i|r<<i|n,Yi=o+e}else Xi=1<<o|r<<i|n,Yi=e}function eo(e){null!==e.return&&(Ji(e,1),$i(e,1,0))}function to(e){for(;e===Gi;)Gi=Vi[--Hi],Vi[Hi]=null,Ki=Vi[--Hi],Vi[Hi]=null;for(;e===Zi;)Zi=Wi[--qi],Wi[qi]=null,Yi=Wi[--qi],Wi[qi]=null,Xi=Wi[--qi],Wi[qi]=null}var ro=null,no=null,io=!1,oo=null;function ao(e,t){var r=Fc(5,null,null,0);r.elementType="DELETED",r.stateNode=t,r.return=e,null===(t=e.deletions)?(e.deletions=[r],e.flags|=16):t.push(r)}function so(e,t){switch(e.tag){case 5:var r=e.type;return null!==(t=1!==t.nodeType||r.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ro=e,no=ci(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ro=e,no=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(r=null!==Zi?{id:Xi,overflow:Yi}:null,e.memoizedState={dehydrated:t,treeContext:r,retryLane:1073741824},(r=Fc(18,null,null,0)).stateNode=t,r.return=e,e.child=r,ro=e,no=null,!0);default:return!1}}function lo(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function co(e){if(io){var t=no;if(t){var r=t;if(!so(e,t)){if(lo(e))throw Error(o(418));t=ci(r.nextSibling);var n=ro;t&&so(e,t)?ao(n,r):(e.flags=-4097&e.flags|2,io=!1,ro=e)}}else{if(lo(e))throw Error(o(418));e.flags=-4097&e.flags|2,io=!1,ro=e}}}function uo(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ro=e}function ho(e){if(e!==ro)return!1;if(!io)return uo(e),io=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!ri(e.type,e.memoizedProps)),t&&(t=no)){if(lo(e))throw Ao(),Error(o(418));for(;t;)ao(e,t),t=ci(t.nextSibling)}if(uo(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var r=e.data;if("/$"===r){if(0===t){no=ci(e.nextSibling);break e}t--}else"$"!==r&&"$!"!==r&&"$?"!==r||t++}e=e.nextSibling}no=null}}else no=ro?ci(e.stateNode.nextSibling):null;return!0}function Ao(){for(var e=no;e;)e=ci(e.nextSibling)}function fo(){no=ro=null,io=!1}function po(e){null===oo?oo=[e]:oo.push(e)}var mo=v.ReactCurrentBatchConfig;function go(e,t,r){if(null!==(e=r.ref)&&"function"!==typeof e&&"object"!==typeof e){if(r._owner){if(r=r._owner){if(1!==r.tag)throw Error(o(309));var n=r.stateNode}if(!n)throw Error(o(147,e));var i=n,a=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===a?t.ref:(t=function(e){var t=i.refs;null===e?delete t[a]:t[a]=e},t._stringRef=a,t)}if("string"!==typeof e)throw Error(o(284));if(!r._owner)throw Error(o(290,e))}return e}function yo(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function _o(e){return(0,e._init)(e._payload)}function vo(e){function t(t,r){if(e){var n=t.deletions;null===n?(t.deletions=[r],t.flags|=16):n.push(r)}}function r(r,n){if(!e)return null;for(;null!==n;)t(r,n),n=n.sibling;return null}function n(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Pc(e,t)).index=0,e.sibling=null,e}function a(t,r,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<r?(t.flags|=2,r):n:(t.flags|=2,r):(t.flags|=1048576,r)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function l(e,t,r,n){return null===t||6!==t.tag?((t=Dc(r,e.mode,n)).return=e,t):((t=i(t,r)).return=e,t)}function c(e,t,r,n){var o=r.type;return o===b?d(e,t,r.props.children,n,r.key):null!==t&&(t.elementType===o||"object"===typeof o&&null!==o&&o.$$typeof===P&&_o(o)===t.type)?((n=i(t,r.props)).ref=go(e,t,r),n.return=e,n):((n=Mc(r.type,r.key,r.props,null,e.mode,n)).ref=go(e,t,r),n.return=e,n)}function u(e,t,r,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Uc(r,e.mode,n)).return=e,t):((t=i(t,r.children||[])).return=e,t)}function d(e,t,r,n,o){return null===t||7!==t.tag?((t=Oc(r,e.mode,n,o)).return=e,t):((t=i(t,r)).return=e,t)}function h(e,t,r){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Dc(""+t,e.mode,r)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case x:return(r=Mc(t.type,t.key,t.props,null,e.mode,r)).ref=go(e,null,t),r.return=e,r;case w:return(t=Uc(t,e.mode,r)).return=e,t;case P:return h(e,(0,t._init)(t._payload),r)}if(te(t)||L(t))return(t=Oc(t,e.mode,r,null)).return=e,t;yo(e,t)}return null}function A(e,t,r,n){var i=null!==t?t.key:null;if("string"===typeof r&&""!==r||"number"===typeof r)return null!==i?null:l(e,t,""+r,n);if("object"===typeof r&&null!==r){switch(r.$$typeof){case x:return r.key===i?c(e,t,r,n):null;case w:return r.key===i?u(e,t,r,n):null;case P:return A(e,t,(i=r._init)(r._payload),n)}if(te(r)||L(r))return null!==i?null:d(e,t,r,n,null);yo(e,r)}return null}function f(e,t,r,n,i){if("string"===typeof n&&""!==n||"number"===typeof n)return l(t,e=e.get(r)||null,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case x:return c(t,e=e.get(null===n.key?r:n.key)||null,n,i);case w:return u(t,e=e.get(null===n.key?r:n.key)||null,n,i);case P:return f(e,t,r,(0,n._init)(n._payload),i)}if(te(n)||L(n))return d(t,e=e.get(r)||null,n,i,null);yo(t,n)}return null}function p(i,o,s,l){for(var c=null,u=null,d=o,p=o=0,m=null;null!==d&&p<s.length;p++){d.index>p?(m=d,d=null):m=d.sibling;var g=A(i,d,s[p],l);if(null===g){null===d&&(d=m);break}e&&d&&null===g.alternate&&t(i,d),o=a(g,o,p),null===u?c=g:u.sibling=g,u=g,d=m}if(p===s.length)return r(i,d),io&&Ji(i,p),c;if(null===d){for(;p<s.length;p++)null!==(d=h(i,s[p],l))&&(o=a(d,o,p),null===u?c=d:u.sibling=d,u=d);return io&&Ji(i,p),c}for(d=n(i,d);p<s.length;p++)null!==(m=f(d,i,p,s[p],l))&&(e&&null!==m.alternate&&d.delete(null===m.key?p:m.key),o=a(m,o,p),null===u?c=m:u.sibling=m,u=m);return e&&d.forEach(function(e){return t(i,e)}),io&&Ji(i,p),c}function m(i,s,l,c){var u=L(l);if("function"!==typeof u)throw Error(o(150));if(null==(l=u.call(l)))throw Error(o(151));for(var d=u=null,p=s,m=s=0,g=null,y=l.next();null!==p&&!y.done;m++,y=l.next()){p.index>m?(g=p,p=null):g=p.sibling;var _=A(i,p,y.value,c);if(null===_){null===p&&(p=g);break}e&&p&&null===_.alternate&&t(i,p),s=a(_,s,m),null===d?u=_:d.sibling=_,d=_,p=g}if(y.done)return r(i,p),io&&Ji(i,m),u;if(null===p){for(;!y.done;m++,y=l.next())null!==(y=h(i,y.value,c))&&(s=a(y,s,m),null===d?u=y:d.sibling=y,d=y);return io&&Ji(i,m),u}for(p=n(i,p);!y.done;m++,y=l.next())null!==(y=f(p,i,m,y.value,c))&&(e&&null!==y.alternate&&p.delete(null===y.key?m:y.key),s=a(y,s,m),null===d?u=y:d.sibling=y,d=y);return e&&p.forEach(function(e){return t(i,e)}),io&&Ji(i,m),u}return function e(n,o,a,l){if("object"===typeof a&&null!==a&&a.type===b&&null===a.key&&(a=a.props.children),"object"===typeof a&&null!==a){switch(a.$$typeof){case x:e:{for(var c=a.key,u=o;null!==u;){if(u.key===c){if((c=a.type)===b){if(7===u.tag){r(n,u.sibling),(o=i(u,a.props.children)).return=n,n=o;break e}}else if(u.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===P&&_o(c)===u.type){r(n,u.sibling),(o=i(u,a.props)).ref=go(n,u,a),o.return=n,n=o;break e}r(n,u);break}t(n,u),u=u.sibling}a.type===b?((o=Oc(a.props.children,n.mode,l,a.key)).return=n,n=o):((l=Mc(a.type,a.key,a.props,null,n.mode,l)).ref=go(n,o,a),l.return=n,n=l)}return s(n);case w:e:{for(u=a.key;null!==o;){if(o.key===u){if(4===o.tag&&o.stateNode.containerInfo===a.containerInfo&&o.stateNode.implementation===a.implementation){r(n,o.sibling),(o=i(o,a.children||[])).return=n,n=o;break e}r(n,o);break}t(n,o),o=o.sibling}(o=Uc(a,n.mode,l)).return=n,n=o}return s(n);case P:return e(n,o,(u=a._init)(a._payload),l)}if(te(a))return p(n,o,a,l);if(L(a))return m(n,o,a,l);yo(n,a)}return"string"===typeof a&&""!==a||"number"===typeof a?(a=""+a,null!==o&&6===o.tag?(r(n,o.sibling),(o=i(o,a)).return=n,n=o):(r(n,o),(o=Dc(a,n.mode,l)).return=n,n=o),s(n)):r(n,o)}}var xo=vo(!0),wo=vo(!1),bo=Bi(null),Bo=null,Co=null,Eo=null;function So(){Eo=Co=Bo=null}function To(e){var t=bo.current;Ci(bo),e._currentValue=t}function Io(e,t,r){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Fo(e,t){Bo=e,Eo=Co=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(_s=!0),e.firstContext=null)}function ko(e){var t=e._currentValue;if(Eo!==e)if(e={context:e,memoizedValue:t,next:null},null===Co){if(null===Bo)throw Error(o(308));Co=e,Bo.dependencies={lanes:0,firstContext:e}}else Co=Co.next=e;return t}var Po=null;function Mo(e){null===Po?Po=[e]:Po.push(e)}function Oo(e,t,r,n){var i=t.interleaved;return null===i?(r.next=r,Mo(t)):(r.next=i.next,i.next=r),t.interleaved=r,Lo(e,n)}function Lo(e,t){e.lanes|=t;var r=e.alternate;for(null!==r&&(r.lanes|=t),r=e,e=e.return;null!==e;)e.childLanes|=t,null!==(r=e.alternate)&&(r.childLanes|=t),r=e,e=e.return;return 3===r.tag?r.stateNode:null}var Do=!1;function Uo(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ro(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function zo(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function No(e,t,r){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&Sl)){var i=n.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),n.pending=t,Lo(e,r)}return null===(i=n.interleaved)?(t.next=t,Mo(n)):(t.next=i.next,i.next=t),n.interleaved=t,Lo(e,r)}function jo(e,t,r){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&r))){var n=t.lanes;r|=n&=e.pendingLanes,t.lanes=r,yt(e,r)}}function Qo(e,t){var r=e.updateQueue,n=e.alternate;if(null!==n&&r===(n=n.updateQueue)){var i=null,o=null;if(null!==(r=r.firstBaseUpdate)){do{var a={eventTime:r.eventTime,lane:r.lane,tag:r.tag,payload:r.payload,callback:r.callback,next:null};null===o?i=o=a:o=o.next=a,r=r.next}while(null!==r);null===o?i=o=t:o=o.next=t}else i=o=t;return r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:n.shared,effects:n.effects},void(e.updateQueue=r)}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}function Vo(e,t,r,n){var i=e.updateQueue;Do=!1;var o=i.firstBaseUpdate,a=i.lastBaseUpdate,s=i.shared.pending;if(null!==s){i.shared.pending=null;var l=s,c=l.next;l.next=null,null===a?o=c:a.next=c,a=l;var u=e.alternate;null!==u&&((s=(u=u.updateQueue).lastBaseUpdate)!==a&&(null===s?u.firstBaseUpdate=c:s.next=c,u.lastBaseUpdate=l))}if(null!==o){var d=i.baseState;for(a=0,u=c=l=null,s=o;;){var h=s.lane,A=s.eventTime;if((n&h)===h){null!==u&&(u=u.next={eventTime:A,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var f=e,p=s;switch(h=t,A=r,p.tag){case 1:if("function"===typeof(f=p.payload)){d=f.call(A,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=p.payload)?f.call(A,d,h):f)||void 0===h)break e;d=U({},d,h);break e;case 2:Do=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(h=i.effects)?i.effects=[s]:h.push(s))}else A={eventTime:A,lane:h,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===u?(c=u=A,l=d):u=u.next=A,a|=h;if(null===(s=s.next)){if(null===(s=i.shared.pending))break;s=(h=s).next,h.next=null,i.lastBaseUpdate=h,i.shared.pending=null}}if(null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null!==(t=i.shared.interleaved)){i=t;do{a|=i.lane,i=i.next}while(i!==t)}else null===o&&(i.shared.lanes=0);Ll|=a,e.lanes=a,e.memoizedState=d}}function Ho(e,t,r){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var n=e[t],i=n.callback;if(null!==i){if(n.callback=null,n=r,"function"!==typeof i)throw Error(o(191,i));i.call(n)}}}var Go={},Ko=Bi(Go),Wo=Bi(Go),qo=Bi(Go);function Zo(e){if(e===Go)throw Error(o(174));return e}function Xo(e,t){switch(Ei(qo,t),Ei(Wo,e),Ei(Ko,Go),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:le(null,"");break;default:t=le(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ci(Ko),Ei(Ko,t)}function Yo(){Ci(Ko),Ci(Wo),Ci(qo)}function Jo(e){Zo(qo.current);var t=Zo(Ko.current),r=le(t,e.type);t!==r&&(Ei(Wo,e),Ei(Ko,r))}function $o(e){Wo.current===e&&(Ci(Ko),Ci(Wo))}var ea=Bi(0);function ta(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||"$?"===r.data||"$!"===r.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var ra=[];function na(){for(var e=0;e<ra.length;e++)ra[e]._workInProgressVersionPrimary=null;ra.length=0}var ia=v.ReactCurrentDispatcher,oa=v.ReactCurrentBatchConfig,aa=0,sa=null,la=null,ca=null,ua=!1,da=!1,ha=0,Aa=0;function fa(){throw Error(o(321))}function pa(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!sn(e[r],t[r]))return!1;return!0}function ma(e,t,r,n,i,a){if(aa=a,sa=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ia.current=null===e||null===e.memoizedState?$a:es,e=r(n,i),da){a=0;do{if(da=!1,ha=0,25<=a)throw Error(o(301));a+=1,ca=la=null,t.updateQueue=null,ia.current=ts,e=r(n,i)}while(da)}if(ia.current=Ja,t=null!==la&&null!==la.next,aa=0,ca=la=sa=null,ua=!1,t)throw Error(o(300));return e}function ga(){var e=0!==ha;return ha=0,e}function ya(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===ca?sa.memoizedState=ca=e:ca=ca.next=e,ca}function _a(){if(null===la){var e=sa.alternate;e=null!==e?e.memoizedState:null}else e=la.next;var t=null===ca?sa.memoizedState:ca.next;if(null!==t)ca=t,la=e;else{if(null===e)throw Error(o(310));e={memoizedState:(la=e).memoizedState,baseState:la.baseState,baseQueue:la.baseQueue,queue:la.queue,next:null},null===ca?sa.memoizedState=ca=e:ca=ca.next=e}return ca}function va(e,t){return"function"===typeof t?t(e):t}function xa(e){var t=_a(),r=t.queue;if(null===r)throw Error(o(311));r.lastRenderedReducer=e;var n=la,i=n.baseQueue,a=r.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}n.baseQueue=i=a,r.pending=null}if(null!==i){a=i.next,n=n.baseState;var l=s=null,c=null,u=a;do{var d=u.lane;if((aa&d)===d)null!==c&&(c=c.next={lane:0,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),n=u.hasEagerState?u.eagerState:e(n,u.action);else{var h={lane:d,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null};null===c?(l=c=h,s=n):c=c.next=h,sa.lanes|=d,Ll|=d}u=u.next}while(null!==u&&u!==a);null===c?s=n:c.next=l,sn(n,t.memoizedState)||(_s=!0),t.memoizedState=n,t.baseState=s,t.baseQueue=c,r.lastRenderedState=n}if(null!==(e=r.interleaved)){i=e;do{a=i.lane,sa.lanes|=a,Ll|=a,i=i.next}while(i!==e)}else null===i&&(r.lanes=0);return[t.memoizedState,r.dispatch]}function wa(e){var t=_a(),r=t.queue;if(null===r)throw Error(o(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,a=t.memoizedState;if(null!==i){r.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);sn(a,t.memoizedState)||(_s=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),r.lastRenderedState=a}return[a,n]}function ba(){}function Ba(e,t){var r=sa,n=_a(),i=t(),a=!sn(n.memoizedState,i);if(a&&(n.memoizedState=i,_s=!0),n=n.queue,Da(Sa.bind(null,r,n,e),[e]),n.getSnapshot!==t||a||null!==ca&&1&ca.memoizedState.tag){if(r.flags|=2048,ka(9,Ea.bind(null,r,n,i,t),void 0,null),null===Tl)throw Error(o(349));0!==(30&aa)||Ca(r,t,i)}return i}function Ca(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.stores=[e]):null===(r=t.stores)?t.stores=[e]:r.push(e)}function Ea(e,t,r,n){t.value=r,t.getSnapshot=n,Ta(t)&&Ia(e)}function Sa(e,t,r){return r(function(){Ta(t)&&Ia(e)})}function Ta(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!sn(e,r)}catch(n){return!0}}function Ia(e){var t=Lo(e,1);null!==t&&tc(t,e,1,-1)}function Fa(e){var t=ya();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:va,lastRenderedState:e},t.queue=e,e=e.dispatch=qa.bind(null,sa,e),[t.memoizedState,e]}function ka(e,t,r,n){return e={tag:e,create:t,destroy:r,deps:n,next:null},null===(t=sa.updateQueue)?(t={lastEffect:null,stores:null},sa.updateQueue=t,t.lastEffect=e.next=e):null===(r=t.lastEffect)?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e),e}function Pa(){return _a().memoizedState}function Ma(e,t,r,n){var i=ya();sa.flags|=e,i.memoizedState=ka(1|t,r,void 0,void 0===n?null:n)}function Oa(e,t,r,n){var i=_a();n=void 0===n?null:n;var o=void 0;if(null!==la){var a=la.memoizedState;if(o=a.destroy,null!==n&&pa(n,a.deps))return void(i.memoizedState=ka(t,r,o,n))}sa.flags|=e,i.memoizedState=ka(1|t,r,o,n)}function La(e,t){return Ma(8390656,8,e,t)}function Da(e,t){return Oa(2048,8,e,t)}function Ua(e,t){return Oa(4,2,e,t)}function Ra(e,t){return Oa(4,4,e,t)}function za(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Na(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,Oa(4,4,za.bind(null,t,e),r)}function ja(){}function Qa(e,t){var r=_a();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&pa(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function Va(e,t){var r=_a();t=void 0===t?null:t;var n=r.memoizedState;return null!==n&&null!==t&&pa(t,n[1])?n[0]:(e=e(),r.memoizedState=[e,t],e)}function Ha(e,t,r){return 0===(21&aa)?(e.baseState&&(e.baseState=!1,_s=!0),e.memoizedState=r):(sn(r,t)||(r=pt(),sa.lanes|=r,Ll|=r,e.baseState=!0),t)}function Ga(e,t){var r=_t;_t=0!==r&&4>r?r:4,e(!0);var n=oa.transition;oa.transition={};try{e(!1),t()}finally{_t=r,oa.transition=n}}function Ka(){return _a().memoizedState}function Wa(e,t,r){var n=ec(e);if(r={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null},Za(e))Xa(t,r);else if(null!==(r=Oo(e,t,r,n))){tc(r,e,n,$l()),Ya(r,t,n)}}function qa(e,t,r){var n=ec(e),i={lane:n,action:r,hasEagerState:!1,eagerState:null,next:null};if(Za(e))Xa(t,i);else{var o=e.alternate;if(0===e.lanes&&(null===o||0===o.lanes)&&null!==(o=t.lastRenderedReducer))try{var a=t.lastRenderedState,s=o(a,r);if(i.hasEagerState=!0,i.eagerState=s,sn(s,a)){var l=t.interleaved;return null===l?(i.next=i,Mo(t)):(i.next=l.next,l.next=i),void(t.interleaved=i)}}catch(c){}null!==(r=Oo(e,t,i,n))&&(tc(r,e,n,i=$l()),Ya(r,t,n))}}function Za(e){var t=e.alternate;return e===sa||null!==t&&t===sa}function Xa(e,t){da=ua=!0;var r=e.pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function Ya(e,t,r){if(0!==(4194240&r)){var n=t.lanes;r|=n&=e.pendingLanes,t.lanes=r,yt(e,r)}}var Ja={readContext:ko,useCallback:fa,useContext:fa,useEffect:fa,useImperativeHandle:fa,useInsertionEffect:fa,useLayoutEffect:fa,useMemo:fa,useReducer:fa,useRef:fa,useState:fa,useDebugValue:fa,useDeferredValue:fa,useTransition:fa,useMutableSource:fa,useSyncExternalStore:fa,useId:fa,unstable_isNewReconciler:!1},$a={readContext:ko,useCallback:function(e,t){return ya().memoizedState=[e,void 0===t?null:t],e},useContext:ko,useEffect:La,useImperativeHandle:function(e,t,r){return r=null!==r&&void 0!==r?r.concat([e]):null,Ma(4194308,4,za.bind(null,t,e),r)},useLayoutEffect:function(e,t){return Ma(4194308,4,e,t)},useInsertionEffect:function(e,t){return Ma(4,2,e,t)},useMemo:function(e,t){var r=ya();return t=void 0===t?null:t,e=e(),r.memoizedState=[e,t],e},useReducer:function(e,t,r){var n=ya();return t=void 0!==r?r(t):t,n.memoizedState=n.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},n.queue=e,e=e.dispatch=Wa.bind(null,sa,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},ya().memoizedState=e},useState:Fa,useDebugValue:ja,useDeferredValue:function(e){return ya().memoizedState=e},useTransition:function(){var e=Fa(!1),t=e[0];return e=Ga.bind(null,e[1]),ya().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,r){var n=sa,i=ya();if(io){if(void 0===r)throw Error(o(407));r=r()}else{if(r=t(),null===Tl)throw Error(o(349));0!==(30&aa)||Ca(n,t,r)}i.memoizedState=r;var a={value:r,getSnapshot:t};return i.queue=a,La(Sa.bind(null,n,a,e),[e]),n.flags|=2048,ka(9,Ea.bind(null,n,a,r,t),void 0,null),r},useId:function(){var e=ya(),t=Tl.identifierPrefix;if(io){var r=Yi;t=":"+t+"R"+(r=(Xi&~(1<<32-at(Xi)-1)).toString(32)+r),0<(r=ha++)&&(t+="H"+r.toString(32)),t+=":"}else t=":"+t+"r"+(r=Aa++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},es={readContext:ko,useCallback:Qa,useContext:ko,useEffect:Da,useImperativeHandle:Na,useInsertionEffect:Ua,useLayoutEffect:Ra,useMemo:Va,useReducer:xa,useRef:Pa,useState:function(){return xa(va)},useDebugValue:ja,useDeferredValue:function(e){return Ha(_a(),la.memoizedState,e)},useTransition:function(){return[xa(va)[0],_a().memoizedState]},useMutableSource:ba,useSyncExternalStore:Ba,useId:Ka,unstable_isNewReconciler:!1},ts={readContext:ko,useCallback:Qa,useContext:ko,useEffect:Da,useImperativeHandle:Na,useInsertionEffect:Ua,useLayoutEffect:Ra,useMemo:Va,useReducer:wa,useRef:Pa,useState:function(){return wa(va)},useDebugValue:ja,useDeferredValue:function(e){var t=_a();return null===la?t.memoizedState=e:Ha(t,la.memoizedState,e)},useTransition:function(){return[wa(va)[0],_a().memoizedState]},useMutableSource:ba,useSyncExternalStore:Ba,useId:Ka,unstable_isNewReconciler:!1};function rs(e,t){if(e&&e.defaultProps){for(var r in t=U({},t),e=e.defaultProps)void 0===t[r]&&(t[r]=e[r]);return t}return t}function ns(e,t,r,n){r=null===(r=r(n,t=e.memoizedState))||void 0===r?t:U({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}var is={isMounted:function(e){return!!(e=e._reactInternals)&&Qe(e)===e},enqueueSetState:function(e,t,r){e=e._reactInternals;var n=$l(),i=ec(e),o=zo(n,i);o.payload=t,void 0!==r&&null!==r&&(o.callback=r),null!==(t=No(e,o,i))&&(tc(t,e,i,n),jo(t,e,i))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=$l(),i=ec(e),o=zo(n,i);o.tag=1,o.payload=t,void 0!==r&&null!==r&&(o.callback=r),null!==(t=No(e,o,i))&&(tc(t,e,i,n),jo(t,e,i))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=$l(),n=ec(e),i=zo(r,n);i.tag=2,void 0!==t&&null!==t&&(i.callback=t),null!==(t=No(e,i,n))&&(tc(t,e,n,r),jo(t,e,n))}};function os(e,t,r,n,i,o,a){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,o,a):!t.prototype||!t.prototype.isPureReactComponent||(!ln(r,n)||!ln(i,o))}function as(e,t,r){var n=!1,i=Si,o=t.contextType;return"object"===typeof o&&null!==o?o=ko(o):(i=Pi(t)?Fi:Ti.current,o=(n=null!==(n=t.contextTypes)&&void 0!==n)?ki(e,i):Si),t=new t(r,o),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=is,e.stateNode=t,t._reactInternals=e,n&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=o),t}function ss(e,t,r,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&is.enqueueReplaceState(t,t.state,null)}function ls(e,t,r,n){var i=e.stateNode;i.props=r,i.state=e.memoizedState,i.refs={},Uo(e);var o=t.contextType;"object"===typeof o&&null!==o?i.context=ko(o):(o=Pi(t)?Fi:Ti.current,i.context=ki(e,o)),i.state=e.memoizedState,"function"===typeof(o=t.getDerivedStateFromProps)&&(ns(e,t,o,r),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&is.enqueueReplaceState(i,i.state,null),Vo(e,r,i,n),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.flags|=4194308)}function cs(e,t){try{var r="",n=t;do{r+=j(n),n=n.return}while(n);var i=r}catch(o){i="\nError generating stack: "+o.message+"\n"+o.stack}return{value:e,source:t,stack:i,digest:null}}function us(e,t,r){return{value:e,source:null,stack:null!=r?r:null,digest:null!=t?t:null}}function ds(e,t){try{console.error(t.value)}catch(r){setTimeout(function(){throw r})}}var hs="function"===typeof WeakMap?WeakMap:Map;function As(e,t,r){(r=zo(-1,r)).tag=3,r.payload={element:null};var n=t.value;return r.callback=function(){Vl||(Vl=!0,Hl=n),ds(0,t)},r}function fs(e,t,r){(r=zo(-1,r)).tag=3;var n=e.type.getDerivedStateFromError;if("function"===typeof n){var i=t.value;r.payload=function(){return n(i)},r.callback=function(){ds(0,t)}}var o=e.stateNode;return null!==o&&"function"===typeof o.componentDidCatch&&(r.callback=function(){ds(0,t),"function"!==typeof n&&(null===Gl?Gl=new Set([this]):Gl.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),r}function ps(e,t,r){var n=e.pingCache;if(null===n){n=e.pingCache=new hs;var i=new Set;n.set(t,i)}else void 0===(i=n.get(t))&&(i=new Set,n.set(t,i));i.has(r)||(i.add(r),e=Bc.bind(null,e,t,r),t.then(e,e))}function ms(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function gs(e,t,r,n,i){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,r.flags|=131072,r.flags&=-52805,1===r.tag&&(null===r.alternate?r.tag=17:((t=zo(-1,1)).tag=2,No(r,t,1))),r.lanes|=1),e):(e.flags|=65536,e.lanes=i,e)}var ys=v.ReactCurrentOwner,_s=!1;function vs(e,t,r,n){t.child=null===e?wo(t,null,r,n):xo(t,e.child,r,n)}function xs(e,t,r,n,i){r=r.render;var o=t.ref;return Fo(t,i),n=ma(e,t,r,n,o,i),r=ga(),null===e||_s?(io&&r&&eo(t),t.flags|=1,vs(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vs(e,t,i))}function ws(e,t,r,n,i){if(null===e){var o=r.type;return"function"!==typeof o||kc(o)||void 0!==o.defaultProps||null!==r.compare||void 0!==r.defaultProps?((e=Mc(r.type,null,n,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,bs(e,t,o,n,i))}if(o=e.child,0===(e.lanes&i)){var a=o.memoizedProps;if((r=null!==(r=r.compare)?r:ln)(a,n)&&e.ref===t.ref)return Vs(e,t,i)}return t.flags|=1,(e=Pc(o,n)).ref=t.ref,e.return=t,t.child=e}function bs(e,t,r,n,i){if(null!==e){var o=e.memoizedProps;if(ln(o,n)&&e.ref===t.ref){if(_s=!1,t.pendingProps=n=o,0===(e.lanes&i))return t.lanes=e.lanes,Vs(e,t,i);0!==(131072&e.flags)&&(_s=!0)}}return Es(e,t,r,n,i)}function Bs(e,t,r){var n=t.pendingProps,i=n.children,o=null!==e?e.memoizedState:null;if("hidden"===n.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ei(Pl,kl),kl|=r;else{if(0===(1073741824&r))return e=null!==o?o.baseLanes|r:r,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ei(Pl,kl),kl|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},n=null!==o?o.baseLanes:r,Ei(Pl,kl),kl|=n}else null!==o?(n=o.baseLanes|r,t.memoizedState=null):n=r,Ei(Pl,kl),kl|=n;return vs(e,t,i,r),t.child}function Cs(e,t){var r=t.ref;(null===e&&null!==r||null!==e&&e.ref!==r)&&(t.flags|=512,t.flags|=2097152)}function Es(e,t,r,n,i){var o=Pi(r)?Fi:Ti.current;return o=ki(t,o),Fo(t,i),r=ma(e,t,r,n,o,i),n=ga(),null===e||_s?(io&&n&&eo(t),t.flags|=1,vs(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~i,Vs(e,t,i))}function Ss(e,t,r,n,i){if(Pi(r)){var o=!0;Di(t)}else o=!1;if(Fo(t,i),null===t.stateNode)Qs(e,t),as(t,r,n),ls(t,r,n,i),n=!0;else if(null===e){var a=t.stateNode,s=t.memoizedProps;a.props=s;var l=a.context,c=r.contextType;"object"===typeof c&&null!==c?c=ko(c):c=ki(t,c=Pi(r)?Fi:Ti.current);var u=r.getDerivedStateFromProps,d="function"===typeof u||"function"===typeof a.getSnapshotBeforeUpdate;d||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==n||l!==c)&&ss(t,a,n,c),Do=!1;var h=t.memoizedState;a.state=h,Vo(t,n,a,i),l=t.memoizedState,s!==n||h!==l||Ii.current||Do?("function"===typeof u&&(ns(t,r,u,n),l=t.memoizedState),(s=Do||os(t,r,s,n,h,l,c))?(d||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||("function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount()),"function"===typeof a.componentDidMount&&(t.flags|=4194308)):("function"===typeof a.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=l),a.props=n,a.state=l,a.context=c,n=s):("function"===typeof a.componentDidMount&&(t.flags|=4194308),n=!1)}else{a=t.stateNode,Ro(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:rs(t.type,s),a.props=c,d=t.pendingProps,h=a.context,"object"===typeof(l=r.contextType)&&null!==l?l=ko(l):l=ki(t,l=Pi(r)?Fi:Ti.current);var A=r.getDerivedStateFromProps;(u="function"===typeof A||"function"===typeof a.getSnapshotBeforeUpdate)||"function"!==typeof a.UNSAFE_componentWillReceiveProps&&"function"!==typeof a.componentWillReceiveProps||(s!==d||h!==l)&&ss(t,a,n,l),Do=!1,h=t.memoizedState,a.state=h,Vo(t,n,a,i);var f=t.memoizedState;s!==d||h!==f||Ii.current||Do?("function"===typeof A&&(ns(t,r,A,n),f=t.memoizedState),(c=Do||os(t,r,c,n,h,f,l)||!1)?(u||"function"!==typeof a.UNSAFE_componentWillUpdate&&"function"!==typeof a.componentWillUpdate||("function"===typeof a.componentWillUpdate&&a.componentWillUpdate(n,f,l),"function"===typeof a.UNSAFE_componentWillUpdate&&a.UNSAFE_componentWillUpdate(n,f,l)),"function"===typeof a.componentDidUpdate&&(t.flags|=4),"function"===typeof a.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=f),a.props=n,a.state=f,a.context=l,n=c):("function"!==typeof a.componentDidUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof a.getSnapshotBeforeUpdate||s===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return Ts(e,t,r,n,o,i)}function Ts(e,t,r,n,i,o){Cs(e,t);var a=0!==(128&t.flags);if(!n&&!a)return i&&Ui(t,r,!1),Vs(e,t,o);n=t.stateNode,ys.current=t;var s=a&&"function"!==typeof r.getDerivedStateFromError?null:n.render();return t.flags|=1,null!==e&&a?(t.child=xo(t,e.child,null,o),t.child=xo(t,null,s,o)):vs(e,t,s,o),t.memoizedState=n.state,i&&Ui(t,r,!0),t.child}function Is(e){var t=e.stateNode;t.pendingContext?Oi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Oi(0,t.context,!1),Xo(e,t.containerInfo)}function Fs(e,t,r,n,i){return fo(),po(i),t.flags|=256,vs(e,t,r,n),t.child}var ks,Ps,Ms,Os={dehydrated:null,treeContext:null,retryLane:0};function Ls(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ds(e,t,r){var n,i=t.pendingProps,a=ea.current,s=!1,l=0!==(128&t.flags);if((n=l)||(n=(null===e||null!==e.memoizedState)&&0!==(2&a)),n?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(a|=1),Ei(ea,1&a),null===e)return co(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(l=i.children,e=i.fallback,s?(i=t.mode,s=t.child,l={mode:"hidden",children:l},0===(1&i)&&null!==s?(s.childLanes=0,s.pendingProps=l):s=Lc(l,i,0,null),e=Oc(e,i,r,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ls(r),t.memoizedState=Os,e):Us(t,l));if(null!==(a=e.memoizedState)&&null!==(n=a.dehydrated))return function(e,t,r,n,i,a,s){if(r)return 256&t.flags?(t.flags&=-257,Rs(e,t,s,n=us(Error(o(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(a=n.fallback,i=t.mode,n=Lc({mode:"visible",children:n.children},i,0,null),(a=Oc(a,i,s,null)).flags|=2,n.return=t,a.return=t,n.sibling=a,t.child=n,0!==(1&t.mode)&&xo(t,e.child,null,s),t.child.memoizedState=Ls(s),t.memoizedState=Os,a);if(0===(1&t.mode))return Rs(e,t,s,null);if("$!"===i.data){if(n=i.nextSibling&&i.nextSibling.dataset)var l=n.dgst;return n=l,Rs(e,t,s,n=us(a=Error(o(419)),n,void 0))}if(l=0!==(s&e.childLanes),_s||l){if(null!==(n=Tl)){switch(s&-s){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}0!==(i=0!==(i&(n.suspendedLanes|s))?0:i)&&i!==a.retryLane&&(a.retryLane=i,Lo(e,i),tc(n,e,i,-1))}return fc(),Rs(e,t,s,n=us(Error(o(421))))}return"$?"===i.data?(t.flags|=128,t.child=e.child,t=Ec.bind(null,e),i._reactRetry=t,null):(e=a.treeContext,no=ci(i.nextSibling),ro=t,io=!0,oo=null,null!==e&&(Wi[qi++]=Xi,Wi[qi++]=Yi,Wi[qi++]=Zi,Xi=e.id,Yi=e.overflow,Zi=t),t=Us(t,n.children),t.flags|=4096,t)}(e,t,l,i,n,a,r);if(s){s=i.fallback,l=t.mode,n=(a=e.child).sibling;var c={mode:"hidden",children:i.children};return 0===(1&l)&&t.child!==a?((i=t.child).childLanes=0,i.pendingProps=c,t.deletions=null):(i=Pc(a,c)).subtreeFlags=14680064&a.subtreeFlags,null!==n?s=Pc(n,s):(s=Oc(s,l,r,null)).flags|=2,s.return=t,i.return=t,i.sibling=s,t.child=i,i=s,s=t.child,l=null===(l=e.child.memoizedState)?Ls(r):{baseLanes:l.baseLanes|r,cachePool:null,transitions:l.transitions},s.memoizedState=l,s.childLanes=e.childLanes&~r,t.memoizedState=Os,i}return e=(s=e.child).sibling,i=Pc(s,{mode:"visible",children:i.children}),0===(1&t.mode)&&(i.lanes=r),i.return=t,i.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=i,t.memoizedState=null,i}function Us(e,t){return(t=Lc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Rs(e,t,r,n){return null!==n&&po(n),xo(t,e.child,null,r),(e=Us(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function zs(e,t,r){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Io(e.return,t,r)}function Ns(e,t,r,n,i){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=i)}function js(e,t,r){var n=t.pendingProps,i=n.revealOrder,o=n.tail;if(vs(e,t,n.children,r),0!==(2&(n=ea.current)))n=1&n|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&zs(e,r,t);else if(19===e.tag)zs(e,r,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}n&=1}if(Ei(ea,n),0===(1&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(r=t.child,i=null;null!==r;)null!==(e=r.alternate)&&null===ta(e)&&(i=r),r=r.sibling;null===(r=i)?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),Ns(t,!1,i,r,o);break;case"backwards":for(r=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===ta(e)){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}Ns(t,!0,r,null,o);break;case"together":Ns(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Qs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vs(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),Ll|=t.lanes,0===(r&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(r=Pc(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Pc(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function Hs(e,t){if(!io)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;null!==r;)null!==r.alternate&&(n=r),r=r.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function Gs(e){var t=null!==e.alternate&&e.alternate.child===e.child,r=0,n=0;if(t)for(var i=e.child;null!==i;)r|=i.lanes|i.childLanes,n|=14680064&i.subtreeFlags,n|=14680064&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function Ks(e,t,r){var n=t.pendingProps;switch(to(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gs(t),null;case 1:case 17:return Pi(t.type)&&Mi(),Gs(t),null;case 3:return n=t.stateNode,Yo(),Ci(Ii),Ci(Ti),na(),n.pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||(ho(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==oo&&(oc(oo),oo=null))),Gs(t),null;case 5:$o(t);var i=Zo(qo.current);if(r=t.type,null!==e&&null!=t.stateNode)Ps(e,t,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!n){if(null===t.stateNode)throw Error(o(166));return Gs(t),null}if(e=Zo(Ko.current),ho(t)){n=t.stateNode,r=t.type;var a=t.memoizedProps;switch(n[hi]=t,n[Ai]=a,e=0!==(1&t.mode),r){case"dialog":zn("cancel",n),zn("close",n);break;case"iframe":case"object":case"embed":zn("load",n);break;case"video":case"audio":for(i=0;i<Ln.length;i++)zn(Ln[i],n);break;case"source":zn("error",n);break;case"img":case"image":case"link":zn("error",n),zn("load",n);break;case"details":zn("toggle",n);break;case"input":X(n,a),zn("invalid",n);break;case"select":n._wrapperState={wasMultiple:!!a.multiple},zn("invalid",n);break;case"textarea":ie(n,a),zn("invalid",n)}for(var l in ye(r,a),i=null,a)if(a.hasOwnProperty(l)){var c=a[l];"children"===l?"string"===typeof c?n.textContent!==c&&(!0!==a.suppressHydrationWarning&&Jn(n.textContent,c,e),i=["children",c]):"number"===typeof c&&n.textContent!==""+c&&(!0!==a.suppressHydrationWarning&&Jn(n.textContent,c,e),i=["children",""+c]):s.hasOwnProperty(l)&&null!=c&&"onScroll"===l&&zn("scroll",n)}switch(r){case"input":K(n),$(n,a,!0);break;case"textarea":K(n),ae(n);break;case"select":case"option":break;default:"function"===typeof a.onClick&&(n.onclick=$n)}n=i,t.updateQueue=n,null!==n&&(t.flags|=4)}else{l=9===i.nodeType?i:i.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(r)),"http://www.w3.org/1999/xhtml"===e?"script"===r?((e=l.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof n.is?e=l.createElement(r,{is:n.is}):(e=l.createElement(r),"select"===r&&(l=e,n.multiple?l.multiple=!0:n.size&&(l.size=n.size))):e=l.createElementNS(e,r),e[hi]=t,e[Ai]=n,ks(e,t),t.stateNode=e;e:{switch(l=_e(r,n),r){case"dialog":zn("cancel",e),zn("close",e),i=n;break;case"iframe":case"object":case"embed":zn("load",e),i=n;break;case"video":case"audio":for(i=0;i<Ln.length;i++)zn(Ln[i],e);i=n;break;case"source":zn("error",e),i=n;break;case"img":case"image":case"link":zn("error",e),zn("load",e),i=n;break;case"details":zn("toggle",e),i=n;break;case"input":X(e,n),i=Z(e,n),zn("invalid",e);break;case"option":default:i=n;break;case"select":e._wrapperState={wasMultiple:!!n.multiple},i=U({},n,{value:void 0}),zn("invalid",e);break;case"textarea":ie(e,n),i=ne(e,n),zn("invalid",e)}for(a in ye(r,i),c=i)if(c.hasOwnProperty(a)){var u=c[a];"style"===a?me(e,u):"dangerouslySetInnerHTML"===a?null!=(u=u?u.__html:void 0)&&de(e,u):"children"===a?"string"===typeof u?("textarea"!==r||""!==u)&&he(e,u):"number"===typeof u&&he(e,""+u):"suppressContentEditableWarning"!==a&&"suppressHydrationWarning"!==a&&"autoFocus"!==a&&(s.hasOwnProperty(a)?null!=u&&"onScroll"===a&&zn("scroll",e):null!=u&&_(e,a,u,l))}switch(r){case"input":K(e),$(e,n,!1);break;case"textarea":K(e),ae(e);break;case"option":null!=n.value&&e.setAttribute("value",""+H(n.value));break;case"select":e.multiple=!!n.multiple,null!=(a=n.value)?re(e,!!n.multiple,a,!1):null!=n.defaultValue&&re(e,!!n.multiple,n.defaultValue,!0);break;default:"function"===typeof i.onClick&&(e.onclick=$n)}switch(r){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}}n&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Gs(t),null;case 6:if(e&&null!=t.stateNode)Ms(0,t,e.memoizedProps,n);else{if("string"!==typeof n&&null===t.stateNode)throw Error(o(166));if(r=Zo(qo.current),Zo(Ko.current),ho(t)){if(n=t.stateNode,r=t.memoizedProps,n[hi]=t,(a=n.nodeValue!==r)&&null!==(e=ro))switch(e.tag){case 3:Jn(n.nodeValue,r,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jn(n.nodeValue,r,0!==(1&e.mode))}a&&(t.flags|=4)}else(n=(9===r.nodeType?r:r.ownerDocument).createTextNode(n))[hi]=t,t.stateNode=n}return Gs(t),null;case 13:if(Ci(ea),n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(io&&null!==no&&0!==(1&t.mode)&&0===(128&t.flags))Ao(),fo(),t.flags|=98560,a=!1;else if(a=ho(t),null!==n&&null!==n.dehydrated){if(null===e){if(!a)throw Error(o(318));if(!(a=null!==(a=t.memoizedState)?a.dehydrated:null))throw Error(o(317));a[hi]=t}else fo(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Gs(t),a=!1}else null!==oo&&(oc(oo),oo=null),a=!0;if(!a)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=r,t):((n=null!==n)!==(null!==e&&null!==e.memoizedState)&&n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&ea.current)?0===Ml&&(Ml=3):fc())),null!==t.updateQueue&&(t.flags|=4),Gs(t),null);case 4:return Yo(),null===e&&Qn(t.stateNode.containerInfo),Gs(t),null;case 10:return To(t.type._context),Gs(t),null;case 19:if(Ci(ea),null===(a=t.memoizedState))return Gs(t),null;if(n=0!==(128&t.flags),null===(l=a.rendering))if(n)Hs(a,!1);else{if(0!==Ml||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(l=ta(e))){for(t.flags|=128,Hs(a,!1),null!==(n=l.updateQueue)&&(t.updateQueue=n,t.flags|=4),t.subtreeFlags=0,n=r,r=t.child;null!==r;)e=n,(a=r).flags&=14680066,null===(l=a.alternate)?(a.childLanes=0,a.lanes=e,a.child=null,a.subtreeFlags=0,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null,a.stateNode=null):(a.childLanes=l.childLanes,a.lanes=l.lanes,a.child=l.child,a.subtreeFlags=0,a.deletions=null,a.memoizedProps=l.memoizedProps,a.memoizedState=l.memoizedState,a.updateQueue=l.updateQueue,a.type=l.type,e=l.dependencies,a.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),r=r.sibling;return Ei(ea,1&ea.current|2),t.child}e=e.sibling}null!==a.tail&&Ye()>jl&&(t.flags|=128,n=!0,Hs(a,!1),t.lanes=4194304)}else{if(!n)if(null!==(e=ta(l))){if(t.flags|=128,n=!0,null!==(r=e.updateQueue)&&(t.updateQueue=r,t.flags|=4),Hs(a,!0),null===a.tail&&"hidden"===a.tailMode&&!l.alternate&&!io)return Gs(t),null}else 2*Ye()-a.renderingStartTime>jl&&1073741824!==r&&(t.flags|=128,n=!0,Hs(a,!1),t.lanes=4194304);a.isBackwards?(l.sibling=t.child,t.child=l):(null!==(r=a.last)?r.sibling=l:t.child=l,a.last=l)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=Ye(),t.sibling=null,r=ea.current,Ei(ea,n?1&r|2:1&r),t):(Gs(t),null);case 22:case 23:return uc(),n=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==n&&(t.flags|=8192),n&&0!==(1&t.mode)?0!==(1073741824&kl)&&(Gs(t),6&t.subtreeFlags&&(t.flags|=8192)):Gs(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}function Ws(e,t){switch(to(t),t.tag){case 1:return Pi(t.type)&&Mi(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return Yo(),Ci(Ii),Ci(Ti),na(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return $o(t),null;case 13:if(Ci(ea),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));fo()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ci(ea),null;case 4:return Yo(),null;case 10:return To(t.type._context),null;case 22:case 23:return uc(),null;default:return null}}ks=function(e,t){for(var r=t.child;null!==r;){if(5===r.tag||6===r.tag)e.appendChild(r.stateNode);else if(4!==r.tag&&null!==r.child){r.child.return=r,r=r.child;continue}if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}},Ps=function(e,t,r,n){var i=e.memoizedProps;if(i!==n){e=t.stateNode,Zo(Ko.current);var o,a=null;switch(r){case"input":i=Z(e,i),n=Z(e,n),a=[];break;case"select":i=U({},i,{value:void 0}),n=U({},n,{value:void 0}),a=[];break;case"textarea":i=ne(e,i),n=ne(e,n),a=[];break;default:"function"!==typeof i.onClick&&"function"===typeof n.onClick&&(e.onclick=$n)}for(u in ye(r,n),r=null,i)if(!n.hasOwnProperty(u)&&i.hasOwnProperty(u)&&null!=i[u])if("style"===u){var l=i[u];for(o in l)l.hasOwnProperty(o)&&(r||(r={}),r[o]="")}else"dangerouslySetInnerHTML"!==u&&"children"!==u&&"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&"autoFocus"!==u&&(s.hasOwnProperty(u)?a||(a=[]):(a=a||[]).push(u,null));for(u in n){var c=n[u];if(l=null!=i?i[u]:void 0,n.hasOwnProperty(u)&&c!==l&&(null!=c||null!=l))if("style"===u)if(l){for(o in l)!l.hasOwnProperty(o)||c&&c.hasOwnProperty(o)||(r||(r={}),r[o]="");for(o in c)c.hasOwnProperty(o)&&l[o]!==c[o]&&(r||(r={}),r[o]=c[o])}else r||(a||(a=[]),a.push(u,r)),r=c;else"dangerouslySetInnerHTML"===u?(c=c?c.__html:void 0,l=l?l.__html:void 0,null!=c&&l!==c&&(a=a||[]).push(u,c)):"children"===u?"string"!==typeof c&&"number"!==typeof c||(a=a||[]).push(u,""+c):"suppressContentEditableWarning"!==u&&"suppressHydrationWarning"!==u&&(s.hasOwnProperty(u)?(null!=c&&"onScroll"===u&&zn("scroll",e),a||l===c||(a=[])):(a=a||[]).push(u,c))}r&&(a=a||[]).push("style",r);var u=a;(t.updateQueue=u)&&(t.flags|=4)}},Ms=function(e,t,r,n){r!==n&&(t.flags|=4)};var qs=!1,Zs=!1,Xs="function"===typeof WeakSet?WeakSet:Set,Ys=null;function Js(e,t){var r=e.ref;if(null!==r)if("function"===typeof r)try{r(null)}catch(n){bc(e,t,n)}else r.current=null}function $s(e,t,r){try{r()}catch(n){bc(e,t,n)}}var el=!1;function tl(e,t,r){var n=t.updateQueue;if(null!==(n=null!==n?n.lastEffect:null)){var i=n=n.next;do{if((i.tag&e)===e){var o=i.destroy;i.destroy=void 0,void 0!==o&&$s(t,r,o)}i=i.next}while(i!==n)}}function rl(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var r=t=t.next;do{if((r.tag&e)===e){var n=r.create;r.destroy=n()}r=r.next}while(r!==t)}}function nl(e){var t=e.ref;if(null!==t){var r=e.stateNode;e.tag,e=r,"function"===typeof t?t(e):t.current=e}}function il(e){var t=e.alternate;null!==t&&(e.alternate=null,il(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[hi],delete t[Ai],delete t[pi],delete t[mi],delete t[gi])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ol(e){return 5===e.tag||3===e.tag||4===e.tag}function al(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ol(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function sl(e,t,r){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?8===r.nodeType?r.parentNode.insertBefore(e,t):r.insertBefore(e,t):(8===r.nodeType?(t=r.parentNode).insertBefore(e,r):(t=r).appendChild(e),null!==(r=r._reactRootContainer)&&void 0!==r||null!==t.onclick||(t.onclick=$n));else if(4!==n&&null!==(e=e.child))for(sl(e,t,r),e=e.sibling;null!==e;)sl(e,t,r),e=e.sibling}function ll(e,t,r){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==n&&null!==(e=e.child))for(ll(e,t,r),e=e.sibling;null!==e;)ll(e,t,r),e=e.sibling}var cl=null,ul=!1;function dl(e,t,r){for(r=r.child;null!==r;)hl(e,t,r),r=r.sibling}function hl(e,t,r){if(ot&&"function"===typeof ot.onCommitFiberUnmount)try{ot.onCommitFiberUnmount(it,r)}catch(s){}switch(r.tag){case 5:Zs||Js(r,t);case 6:var n=cl,i=ul;cl=null,dl(e,t,r),ul=i,null!==(cl=n)&&(ul?(e=cl,r=r.stateNode,8===e.nodeType?e.parentNode.removeChild(r):e.removeChild(r)):cl.removeChild(r.stateNode));break;case 18:null!==cl&&(ul?(e=cl,r=r.stateNode,8===e.nodeType?li(e.parentNode,r):1===e.nodeType&&li(e,r),Qt(e)):li(cl,r.stateNode));break;case 4:n=cl,i=ul,cl=r.stateNode.containerInfo,ul=!0,dl(e,t,r),cl=n,ul=i;break;case 0:case 11:case 14:case 15:if(!Zs&&(null!==(n=r.updateQueue)&&null!==(n=n.lastEffect))){i=n=n.next;do{var o=i,a=o.destroy;o=o.tag,void 0!==a&&(0!==(2&o)||0!==(4&o))&&$s(r,t,a),i=i.next}while(i!==n)}dl(e,t,r);break;case 1:if(!Zs&&(Js(r,t),"function"===typeof(n=r.stateNode).componentWillUnmount))try{n.props=r.memoizedProps,n.state=r.memoizedState,n.componentWillUnmount()}catch(s){bc(r,t,s)}dl(e,t,r);break;case 21:dl(e,t,r);break;case 22:1&r.mode?(Zs=(n=Zs)||null!==r.memoizedState,dl(e,t,r),Zs=n):dl(e,t,r);break;default:dl(e,t,r)}}function Al(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var r=e.stateNode;null===r&&(r=e.stateNode=new Xs),t.forEach(function(t){var n=Sc.bind(null,e,t);r.has(t)||(r.add(t),t.then(n,n))})}}function fl(e,t){var r=t.deletions;if(null!==r)for(var n=0;n<r.length;n++){var i=r[n];try{var a=e,s=t,l=s;e:for(;null!==l;){switch(l.tag){case 5:cl=l.stateNode,ul=!1;break e;case 3:case 4:cl=l.stateNode.containerInfo,ul=!0;break e}l=l.return}if(null===cl)throw Error(o(160));hl(a,s,i),cl=null,ul=!1;var c=i.alternate;null!==c&&(c.return=null),i.return=null}catch(u){bc(i,t,u)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)pl(t,e),t=t.sibling}function pl(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(fl(t,e),ml(e),4&n){try{tl(3,e,e.return),rl(3,e)}catch(m){bc(e,e.return,m)}try{tl(5,e,e.return)}catch(m){bc(e,e.return,m)}}break;case 1:fl(t,e),ml(e),512&n&&null!==r&&Js(r,r.return);break;case 5:if(fl(t,e),ml(e),512&n&&null!==r&&Js(r,r.return),32&e.flags){var i=e.stateNode;try{he(i,"")}catch(m){bc(e,e.return,m)}}if(4&n&&null!=(i=e.stateNode)){var a=e.memoizedProps,s=null!==r?r.memoizedProps:a,l=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===l&&"radio"===a.type&&null!=a.name&&Y(i,a),_e(l,s);var u=_e(l,a);for(s=0;s<c.length;s+=2){var d=c[s],h=c[s+1];"style"===d?me(i,h):"dangerouslySetInnerHTML"===d?de(i,h):"children"===d?he(i,h):_(i,d,h,u)}switch(l){case"input":J(i,a);break;case"textarea":oe(i,a);break;case"select":var A=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!a.multiple;var f=a.value;null!=f?re(i,!!a.multiple,f,!1):A!==!!a.multiple&&(null!=a.defaultValue?re(i,!!a.multiple,a.defaultValue,!0):re(i,!!a.multiple,a.multiple?[]:"",!1))}i[Ai]=a}catch(m){bc(e,e.return,m)}}break;case 6:if(fl(t,e),ml(e),4&n){if(null===e.stateNode)throw Error(o(162));i=e.stateNode,a=e.memoizedProps;try{i.nodeValue=a}catch(m){bc(e,e.return,m)}}break;case 3:if(fl(t,e),ml(e),4&n&&null!==r&&r.memoizedState.isDehydrated)try{Qt(t.containerInfo)}catch(m){bc(e,e.return,m)}break;case 4:default:fl(t,e),ml(e);break;case 13:fl(t,e),ml(e),8192&(i=e.child).flags&&(a=null!==i.memoizedState,i.stateNode.isHidden=a,!a||null!==i.alternate&&null!==i.alternate.memoizedState||(Nl=Ye())),4&n&&Al(e);break;case 22:if(d=null!==r&&null!==r.memoizedState,1&e.mode?(Zs=(u=Zs)||d,fl(t,e),Zs=u):fl(t,e),ml(e),8192&n){if(u=null!==e.memoizedState,(e.stateNode.isHidden=u)&&!d&&0!==(1&e.mode))for(Ys=e,d=e.child;null!==d;){for(h=Ys=d;null!==Ys;){switch(f=(A=Ys).child,A.tag){case 0:case 11:case 14:case 15:tl(4,A,A.return);break;case 1:Js(A,A.return);var p=A.stateNode;if("function"===typeof p.componentWillUnmount){n=A,r=A.return;try{t=n,p.props=t.memoizedProps,p.state=t.memoizedState,p.componentWillUnmount()}catch(m){bc(n,r,m)}}break;case 5:Js(A,A.return);break;case 22:if(null!==A.memoizedState){vl(h);continue}}null!==f?(f.return=A,Ys=f):vl(h)}d=d.sibling}e:for(d=null,h=e;;){if(5===h.tag){if(null===d){d=h;try{i=h.stateNode,u?"function"===typeof(a=i.style).setProperty?a.setProperty("display","none","important"):a.display="none":(l=h.stateNode,s=void 0!==(c=h.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,l.style.display=pe("display",s))}catch(m){bc(e,e.return,m)}}}else if(6===h.tag){if(null===d)try{h.stateNode.nodeValue=u?"":h.memoizedProps}catch(m){bc(e,e.return,m)}}else if((22!==h.tag&&23!==h.tag||null===h.memoizedState||h===e)&&null!==h.child){h.child.return=h,h=h.child;continue}if(h===e)break e;for(;null===h.sibling;){if(null===h.return||h.return===e)break e;d===h&&(d=null),h=h.return}d===h&&(d=null),h.sibling.return=h.return,h=h.sibling}}break;case 19:fl(t,e),ml(e),4&n&&Al(e);case 21:}}function ml(e){var t=e.flags;if(2&t){try{e:{for(var r=e.return;null!==r;){if(ol(r)){var n=r;break e}r=r.return}throw Error(o(160))}switch(n.tag){case 5:var i=n.stateNode;32&n.flags&&(he(i,""),n.flags&=-33),ll(e,al(e),i);break;case 3:case 4:var a=n.stateNode.containerInfo;sl(e,al(e),a);break;default:throw Error(o(161))}}catch(s){bc(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function gl(e,t,r){Ys=e,yl(e,t,r)}function yl(e,t,r){for(var n=0!==(1&e.mode);null!==Ys;){var i=Ys,o=i.child;if(22===i.tag&&n){var a=null!==i.memoizedState||qs;if(!a){var s=i.alternate,l=null!==s&&null!==s.memoizedState||Zs;s=qs;var c=Zs;if(qs=a,(Zs=l)&&!c)for(Ys=i;null!==Ys;)l=(a=Ys).child,22===a.tag&&null!==a.memoizedState?xl(i):null!==l?(l.return=a,Ys=l):xl(i);for(;null!==o;)Ys=o,yl(o,t,r),o=o.sibling;Ys=i,qs=s,Zs=c}_l(e)}else 0!==(8772&i.subtreeFlags)&&null!==o?(o.return=i,Ys=o):_l(e)}}function _l(e){for(;null!==Ys;){var t=Ys;if(0!==(8772&t.flags)){var r=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Zs||rl(5,t);break;case 1:var n=t.stateNode;if(4&t.flags&&!Zs)if(null===r)n.componentDidMount();else{var i=t.elementType===t.type?r.memoizedProps:rs(t.type,r.memoizedProps);n.componentDidUpdate(i,r.memoizedState,n.__reactInternalSnapshotBeforeUpdate)}var a=t.updateQueue;null!==a&&Ho(t,a,n);break;case 3:var s=t.updateQueue;if(null!==s){if(r=null,null!==t.child)switch(t.child.tag){case 5:case 1:r=t.child.stateNode}Ho(t,s,r)}break;case 5:var l=t.stateNode;if(null===r&&4&t.flags){r=l;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&r.focus();break;case"img":c.src&&(r.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var u=t.alternate;if(null!==u){var d=u.memoizedState;if(null!==d){var h=d.dehydrated;null!==h&&Qt(h)}}}break;default:throw Error(o(163))}Zs||512&t.flags&&nl(t)}catch(A){bc(t,t.return,A)}}if(t===e){Ys=null;break}if(null!==(r=t.sibling)){r.return=t.return,Ys=r;break}Ys=t.return}}function vl(e){for(;null!==Ys;){var t=Ys;if(t===e){Ys=null;break}var r=t.sibling;if(null!==r){r.return=t.return,Ys=r;break}Ys=t.return}}function xl(e){for(;null!==Ys;){var t=Ys;try{switch(t.tag){case 0:case 11:case 15:var r=t.return;try{rl(4,t)}catch(l){bc(t,r,l)}break;case 1:var n=t.stateNode;if("function"===typeof n.componentDidMount){var i=t.return;try{n.componentDidMount()}catch(l){bc(t,i,l)}}var o=t.return;try{nl(t)}catch(l){bc(t,o,l)}break;case 5:var a=t.return;try{nl(t)}catch(l){bc(t,a,l)}}}catch(l){bc(t,t.return,l)}if(t===e){Ys=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Ys=s;break}Ys=t.return}}var wl,bl=Math.ceil,Bl=v.ReactCurrentDispatcher,Cl=v.ReactCurrentOwner,El=v.ReactCurrentBatchConfig,Sl=0,Tl=null,Il=null,Fl=0,kl=0,Pl=Bi(0),Ml=0,Ol=null,Ll=0,Dl=0,Ul=0,Rl=null,zl=null,Nl=0,jl=1/0,Ql=null,Vl=!1,Hl=null,Gl=null,Kl=!1,Wl=null,ql=0,Zl=0,Xl=null,Yl=-1,Jl=0;function $l(){return 0!==(6&Sl)?Ye():-1!==Yl?Yl:Yl=Ye()}function ec(e){return 0===(1&e.mode)?1:0!==(2&Sl)&&0!==Fl?Fl&-Fl:null!==mo.transition?(0===Jl&&(Jl=pt()),Jl):0!==(e=_t)?e:e=void 0===(e=window.event)?16:Xt(e.type)}function tc(e,t,r,n){if(50<Zl)throw Zl=0,Xl=null,Error(o(185));gt(e,r,n),0!==(2&Sl)&&e===Tl||(e===Tl&&(0===(2&Sl)&&(Dl|=r),4===Ml&&ac(e,Fl)),rc(e,n),1===r&&0===Sl&&0===(1&t.mode)&&(jl=Ye()+500,zi&&Qi()))}function rc(e,t){var r=e.callbackNode;!function(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,i=e.expirationTimes,o=e.pendingLanes;0<o;){var a=31-at(o),s=1<<a,l=i[a];-1===l?0!==(s&r)&&0===(s&n)||(i[a]=At(s,t)):l<=t&&(e.expiredLanes|=s),o&=~s}}(e,t);var n=ht(e,e===Tl?Fl:0);if(0===n)null!==r&&qe(r),e.callbackNode=null,e.callbackPriority=0;else if(t=n&-n,e.callbackPriority!==t){if(null!=r&&qe(r),1===t)0===e.tag?function(e){zi=!0,ji(e)}(sc.bind(null,e)):ji(sc.bind(null,e)),ai(function(){0===(6&Sl)&&Qi()}),r=null;else{switch(vt(n)){case 1:r=$e;break;case 4:r=et;break;case 16:default:r=tt;break;case 536870912:r=nt}r=Tc(r,nc.bind(null,e))}e.callbackPriority=t,e.callbackNode=r}}function nc(e,t){if(Yl=-1,Jl=0,0!==(6&Sl))throw Error(o(327));var r=e.callbackNode;if(xc()&&e.callbackNode!==r)return null;var n=ht(e,e===Tl?Fl:0);if(0===n)return null;if(0!==(30&n)||0!==(n&e.expiredLanes)||t)t=pc(e,n);else{t=n;var i=Sl;Sl|=2;var a=Ac();for(Tl===e&&Fl===t||(Ql=null,jl=Ye()+500,dc(e,t));;)try{gc();break}catch(l){hc(e,l)}So(),Bl.current=a,Sl=i,null!==Il?t=0:(Tl=null,Fl=0,t=Ml)}if(0!==t){if(2===t&&(0!==(i=ft(e))&&(n=i,t=ic(e,i))),1===t)throw r=Ol,dc(e,0),ac(e,n),rc(e,Ye()),r;if(6===t)ac(e,n);else{if(i=e.current.alternate,0===(30&n)&&!function(e){for(var t=e;;){if(16384&t.flags){var r=t.updateQueue;if(null!==r&&null!==(r=r.stores))for(var n=0;n<r.length;n++){var i=r[n],o=i.getSnapshot;i=i.value;try{if(!sn(o(),i))return!1}catch(s){return!1}}}if(r=t.child,16384&t.subtreeFlags&&null!==r)r.return=t,t=r;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(i)&&(2===(t=pc(e,n))&&(0!==(a=ft(e))&&(n=a,t=ic(e,a))),1===t))throw r=Ol,dc(e,0),ac(e,n),rc(e,Ye()),r;switch(e.finishedWork=i,e.finishedLanes=n,t){case 0:case 1:throw Error(o(345));case 2:case 5:vc(e,zl,Ql);break;case 3:if(ac(e,n),(130023424&n)===n&&10<(t=Nl+500-Ye())){if(0!==ht(e,0))break;if(((i=e.suspendedLanes)&n)!==n){$l(),e.pingedLanes|=e.suspendedLanes&i;break}e.timeoutHandle=ni(vc.bind(null,e,zl,Ql),t);break}vc(e,zl,Ql);break;case 4:if(ac(e,n),(4194240&n)===n)break;for(t=e.eventTimes,i=-1;0<n;){var s=31-at(n);a=1<<s,(s=t[s])>i&&(i=s),n&=~a}if(n=i,10<(n=(120>(n=Ye()-n)?120:480>n?480:1080>n?1080:1920>n?1920:3e3>n?3e3:4320>n?4320:1960*bl(n/1960))-n)){e.timeoutHandle=ni(vc.bind(null,e,zl,Ql),n);break}vc(e,zl,Ql);break;default:throw Error(o(329))}}}return rc(e,Ye()),e.callbackNode===r?nc.bind(null,e):null}function ic(e,t){var r=Rl;return e.current.memoizedState.isDehydrated&&(dc(e,t).flags|=256),2!==(e=pc(e,t))&&(t=zl,zl=r,null!==t&&oc(t)),e}function oc(e){null===zl?zl=e:zl.push.apply(zl,e)}function ac(e,t){for(t&=~Ul,t&=~Dl,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var r=31-at(t),n=1<<r;e[r]=-1,t&=~n}}function sc(e){if(0!==(6&Sl))throw Error(o(327));xc();var t=ht(e,0);if(0===(1&t))return rc(e,Ye()),null;var r=pc(e,t);if(0!==e.tag&&2===r){var n=ft(e);0!==n&&(t=n,r=ic(e,n))}if(1===r)throw r=Ol,dc(e,0),ac(e,t),rc(e,Ye()),r;if(6===r)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,vc(e,zl,Ql),rc(e,Ye()),null}function lc(e,t){var r=Sl;Sl|=1;try{return e(t)}finally{0===(Sl=r)&&(jl=Ye()+500,zi&&Qi())}}function cc(e){null!==Wl&&0===Wl.tag&&0===(6&Sl)&&xc();var t=Sl;Sl|=1;var r=El.transition,n=_t;try{if(El.transition=null,_t=1,e)return e()}finally{_t=n,El.transition=r,0===(6&(Sl=t))&&Qi()}}function uc(){kl=Pl.current,Ci(Pl)}function dc(e,t){e.finishedWork=null,e.finishedLanes=0;var r=e.timeoutHandle;if(-1!==r&&(e.timeoutHandle=-1,ii(r)),null!==Il)for(r=Il.return;null!==r;){var n=r;switch(to(n),n.tag){case 1:null!==(n=n.type.childContextTypes)&&void 0!==n&&Mi();break;case 3:Yo(),Ci(Ii),Ci(Ti),na();break;case 5:$o(n);break;case 4:Yo();break;case 13:case 19:Ci(ea);break;case 10:To(n.type._context);break;case 22:case 23:uc()}r=r.return}if(Tl=e,Il=e=Pc(e.current,null),Fl=kl=t,Ml=0,Ol=null,Ul=Dl=Ll=0,zl=Rl=null,null!==Po){for(t=0;t<Po.length;t++)if(null!==(n=(r=Po[t]).interleaved)){r.interleaved=null;var i=n.next,o=r.pending;if(null!==o){var a=o.next;o.next=i,n.next=a}r.pending=n}Po=null}return e}function hc(e,t){for(;;){var r=Il;try{if(So(),ia.current=Ja,ua){for(var n=sa.memoizedState;null!==n;){var i=n.queue;null!==i&&(i.pending=null),n=n.next}ua=!1}if(aa=0,ca=la=sa=null,da=!1,ha=0,Cl.current=null,null===r||null===r.return){Ml=1,Ol=t,Il=null;break}e:{var a=e,s=r.return,l=r,c=t;if(t=Fl,l.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var u=c,d=l,h=d.tag;if(0===(1&d.mode)&&(0===h||11===h||15===h)){var A=d.alternate;A?(d.updateQueue=A.updateQueue,d.memoizedState=A.memoizedState,d.lanes=A.lanes):(d.updateQueue=null,d.memoizedState=null)}var f=ms(s);if(null!==f){f.flags&=-257,gs(f,s,l,0,t),1&f.mode&&ps(a,u,t),c=u;var p=(t=f).updateQueue;if(null===p){var m=new Set;m.add(c),t.updateQueue=m}else p.add(c);break e}if(0===(1&t)){ps(a,u,t),fc();break e}c=Error(o(426))}else if(io&&1&l.mode){var g=ms(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),gs(g,s,l,0,t),po(cs(c,l));break e}}a=c=cs(c,l),4!==Ml&&(Ml=2),null===Rl?Rl=[a]:Rl.push(a),a=s;do{switch(a.tag){case 3:a.flags|=65536,t&=-t,a.lanes|=t,Qo(a,As(0,c,t));break e;case 1:l=c;var y=a.type,_=a.stateNode;if(0===(128&a.flags)&&("function"===typeof y.getDerivedStateFromError||null!==_&&"function"===typeof _.componentDidCatch&&(null===Gl||!Gl.has(_)))){a.flags|=65536,t&=-t,a.lanes|=t,Qo(a,fs(a,l,t));break e}}a=a.return}while(null!==a)}_c(r)}catch(v){t=v,Il===r&&null!==r&&(Il=r=r.return);continue}break}}function Ac(){var e=Bl.current;return Bl.current=Ja,null===e?Ja:e}function fc(){0!==Ml&&3!==Ml&&2!==Ml||(Ml=4),null===Tl||0===(268435455&Ll)&&0===(268435455&Dl)||ac(Tl,Fl)}function pc(e,t){var r=Sl;Sl|=2;var n=Ac();for(Tl===e&&Fl===t||(Ql=null,dc(e,t));;)try{mc();break}catch(i){hc(e,i)}if(So(),Sl=r,Bl.current=n,null!==Il)throw Error(o(261));return Tl=null,Fl=0,Ml}function mc(){for(;null!==Il;)yc(Il)}function gc(){for(;null!==Il&&!Ze();)yc(Il)}function yc(e){var t=wl(e.alternate,e,kl);e.memoizedProps=e.pendingProps,null===t?_c(e):Il=t,Cl.current=null}function _c(e){var t=e;do{var r=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(r=Ks(r,t,kl)))return void(Il=r)}else{if(null!==(r=Ws(r,t)))return r.flags&=32767,void(Il=r);if(null===e)return Ml=6,void(Il=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Il=t);Il=t=e}while(null!==t);0===Ml&&(Ml=5)}function vc(e,t,r){var n=_t,i=El.transition;try{El.transition=null,_t=1,function(e,t,r,n){do{xc()}while(null!==Wl);if(0!==(6&Sl))throw Error(o(327));r=e.finishedWork;var i=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var a=r.lanes|r.childLanes;if(function(e,t){var r=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var n=e.eventTimes;for(e=e.expirationTimes;0<r;){var i=31-at(r),o=1<<i;t[i]=0,n[i]=-1,e[i]=-1,r&=~o}}(e,a),e===Tl&&(Il=Tl=null,Fl=0),0===(2064&r.subtreeFlags)&&0===(2064&r.flags)||Kl||(Kl=!0,Tc(tt,function(){return xc(),null})),a=0!==(15990&r.flags),0!==(15990&r.subtreeFlags)||a){a=El.transition,El.transition=null;var s=_t;_t=1;var l=Sl;Sl|=4,Cl.current=null,function(e,t){if(ei=Ht,An(e=hn())){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(r=(r=e.ownerDocument)&&r.defaultView||window).getSelection&&r.getSelection();if(n&&0!==n.rangeCount){r=n.anchorNode;var i=n.anchorOffset,a=n.focusNode;n=n.focusOffset;try{r.nodeType,a.nodeType}catch(x){r=null;break e}var s=0,l=-1,c=-1,u=0,d=0,h=e,A=null;t:for(;;){for(var f;h!==r||0!==i&&3!==h.nodeType||(l=s+i),h!==a||0!==n&&3!==h.nodeType||(c=s+n),3===h.nodeType&&(s+=h.nodeValue.length),null!==(f=h.firstChild);)A=h,h=f;for(;;){if(h===e)break t;if(A===r&&++u===i&&(l=s),A===a&&++d===n&&(c=s),null!==(f=h.nextSibling))break;A=(h=A).parentNode}h=f}r=-1===l||-1===c?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(ti={focusedElem:e,selectionRange:r},Ht=!1,Ys=t;null!==Ys;)if(e=(t=Ys).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Ys=e;else for(;null!==Ys;){t=Ys;try{var p=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==p){var m=p.memoizedProps,g=p.memoizedState,y=t.stateNode,_=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:rs(t.type,m),g);y.__reactInternalSnapshotBeforeUpdate=_}break;case 3:var v=t.stateNode.containerInfo;1===v.nodeType?v.textContent="":9===v.nodeType&&v.documentElement&&v.removeChild(v.documentElement);break;default:throw Error(o(163))}}catch(x){bc(t,t.return,x)}if(null!==(e=t.sibling)){e.return=t.return,Ys=e;break}Ys=t.return}p=el,el=!1}(e,r),pl(r,e),fn(ti),Ht=!!ei,ti=ei=null,e.current=r,gl(r,e,i),Xe(),Sl=l,_t=s,El.transition=a}else e.current=r;if(Kl&&(Kl=!1,Wl=e,ql=i),a=e.pendingLanes,0===a&&(Gl=null),function(e){if(ot&&"function"===typeof ot.onCommitFiberRoot)try{ot.onCommitFiberRoot(it,e,void 0,128===(128&e.current.flags))}catch(t){}}(r.stateNode),rc(e,Ye()),null!==t)for(n=e.onRecoverableError,r=0;r<t.length;r++)i=t[r],n(i.value,{componentStack:i.stack,digest:i.digest});if(Vl)throw Vl=!1,e=Hl,Hl=null,e;0!==(1&ql)&&0!==e.tag&&xc(),a=e.pendingLanes,0!==(1&a)?e===Xl?Zl++:(Zl=0,Xl=e):Zl=0,Qi()}(e,t,r,n)}finally{El.transition=i,_t=n}return null}function xc(){if(null!==Wl){var e=vt(ql),t=El.transition,r=_t;try{if(El.transition=null,_t=16>e?16:e,null===Wl)var n=!1;else{if(e=Wl,Wl=null,ql=0,0!==(6&Sl))throw Error(o(331));var i=Sl;for(Sl|=4,Ys=e.current;null!==Ys;){var a=Ys,s=a.child;if(0!==(16&Ys.flags)){var l=a.deletions;if(null!==l){for(var c=0;c<l.length;c++){var u=l[c];for(Ys=u;null!==Ys;){var d=Ys;switch(d.tag){case 0:case 11:case 15:tl(8,d,a)}var h=d.child;if(null!==h)h.return=d,Ys=h;else for(;null!==Ys;){var A=(d=Ys).sibling,f=d.return;if(il(d),d===u){Ys=null;break}if(null!==A){A.return=f,Ys=A;break}Ys=f}}}var p=a.alternate;if(null!==p){var m=p.child;if(null!==m){p.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}Ys=a}}if(0!==(2064&a.subtreeFlags)&&null!==s)s.return=a,Ys=s;else e:for(;null!==Ys;){if(0!==(2048&(a=Ys).flags))switch(a.tag){case 0:case 11:case 15:tl(9,a,a.return)}var y=a.sibling;if(null!==y){y.return=a.return,Ys=y;break e}Ys=a.return}}var _=e.current;for(Ys=_;null!==Ys;){var v=(s=Ys).child;if(0!==(2064&s.subtreeFlags)&&null!==v)v.return=s,Ys=v;else e:for(s=_;null!==Ys;){if(0!==(2048&(l=Ys).flags))try{switch(l.tag){case 0:case 11:case 15:rl(9,l)}}catch(w){bc(l,l.return,w)}if(l===s){Ys=null;break e}var x=l.sibling;if(null!==x){x.return=l.return,Ys=x;break e}Ys=l.return}}if(Sl=i,Qi(),ot&&"function"===typeof ot.onPostCommitFiberRoot)try{ot.onPostCommitFiberRoot(it,e)}catch(w){}n=!0}return n}finally{_t=r,El.transition=t}}return!1}function wc(e,t,r){e=No(e,t=As(0,t=cs(r,t),1),1),t=$l(),null!==e&&(gt(e,1,t),rc(e,t))}function bc(e,t,r){if(3===e.tag)wc(e,e,r);else for(;null!==t;){if(3===t.tag){wc(t,e,r);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Gl||!Gl.has(n))){t=No(t,e=fs(t,e=cs(r,e),1),1),e=$l(),null!==t&&(gt(t,1,e),rc(t,e));break}}t=t.return}}function Bc(e,t,r){var n=e.pingCache;null!==n&&n.delete(t),t=$l(),e.pingedLanes|=e.suspendedLanes&r,Tl===e&&(Fl&r)===r&&(4===Ml||3===Ml&&(130023424&Fl)===Fl&&500>Ye()-Nl?dc(e,0):Ul|=r),rc(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=ut,0===(130023424&(ut<<=1))&&(ut=4194304)));var r=$l();null!==(e=Lo(e,t))&&(gt(e,t,r),rc(e,r))}function Ec(e){var t=e.memoizedState,r=0;null!==t&&(r=t.retryLane),Cc(e,r)}function Sc(e,t){var r=0;switch(e.tag){case 13:var n=e.stateNode,i=e.memoizedState;null!==i&&(r=i.retryLane);break;case 19:n=e.stateNode;break;default:throw Error(o(314))}null!==n&&n.delete(t),Cc(e,r)}function Tc(e,t){return We(e,t)}function Ic(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Fc(e,t,r,n){return new Ic(e,t,r,n)}function kc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Pc(e,t){var r=e.alternate;return null===r?((r=Fc(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=14680064&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r}function Mc(e,t,r,n,i,a){var s=2;if(n=e,"function"===typeof e)kc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case b:return Oc(r.children,i,a,t);case B:s=8,i|=8;break;case C:return(e=Fc(12,r,t,2|i)).elementType=C,e.lanes=a,e;case I:return(e=Fc(13,r,t,i)).elementType=I,e.lanes=a,e;case F:return(e=Fc(19,r,t,i)).elementType=F,e.lanes=a,e;case M:return Lc(r,i,a,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case E:s=10;break e;case S:s=9;break e;case T:s=11;break e;case k:s=14;break e;case P:s=16,n=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Fc(s,r,t,i)).elementType=e,t.type=n,t.lanes=a,t}function Oc(e,t,r,n){return(e=Fc(7,e,n,t)).lanes=r,e}function Lc(e,t,r,n){return(e=Fc(22,e,n,t)).elementType=M,e.lanes=r,e.stateNode={isHidden:!1},e}function Dc(e,t,r){return(e=Fc(6,e,null,t)).lanes=r,e}function Uc(e,t,r){return(t=Fc(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Rc(e,t,r,n,i){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=n,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function zc(e,t,r,n,i,o,a,s,l){return e=new Rc(e,t,r,s,l),1===t?(t=1,!0===o&&(t|=8)):t=0,o=Fc(3,null,null,t),e.current=o,o.stateNode=e,o.memoizedState={element:n,isDehydrated:r,cache:null,transitions:null,pendingSuspenseBoundaries:null},Uo(o),e}function Nc(e){if(!e)return Si;e:{if(Qe(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Pi(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var r=e.type;if(Pi(r))return Li(e,r,t)}return t}function jc(e,t,r,n,i,o,a,s,l){return(e=zc(r,n,!0,e,0,o,0,s,l)).context=Nc(null),r=e.current,(o=zo(n=$l(),i=ec(r))).callback=void 0!==t&&null!==t?t:null,No(r,o,i),e.current.lanes=i,gt(e,i,n),rc(e,n),e}function Qc(e,t,r,n){var i=t.current,o=$l(),a=ec(i);return r=Nc(r),null===t.context?t.context=r:t.pendingContext=r,(t=zo(o,a)).payload={element:e},null!==(n=void 0===n?null:n)&&(t.callback=n),null!==(e=No(i,t,a))&&(tc(e,i,a,o),jo(e,i,a)),a}function Vc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function Gc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}wl=function(e,t,r){if(null!==e)if(e.memoizedProps!==t.pendingProps||Ii.current)_s=!0;else{if(0===(e.lanes&r)&&0===(128&t.flags))return _s=!1,function(e,t,r){switch(t.tag){case 3:Is(t),fo();break;case 5:Jo(t);break;case 1:Pi(t.type)&&Di(t);break;case 4:Xo(t,t.stateNode.containerInfo);break;case 10:var n=t.type._context,i=t.memoizedProps.value;Ei(bo,n._currentValue),n._currentValue=i;break;case 13:if(null!==(n=t.memoizedState))return null!==n.dehydrated?(Ei(ea,1&ea.current),t.flags|=128,null):0!==(r&t.child.childLanes)?Ds(e,t,r):(Ei(ea,1&ea.current),null!==(e=Vs(e,t,r))?e.sibling:null);Ei(ea,1&ea.current);break;case 19:if(n=0!==(r&t.childLanes),0!==(128&e.flags)){if(n)return js(e,t,r);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),Ei(ea,ea.current),n)break;return null;case 22:case 23:return t.lanes=0,Bs(e,t,r)}return Vs(e,t,r)}(e,t,r);_s=0!==(131072&e.flags)}else _s=!1,io&&0!==(1048576&t.flags)&&$i(t,Ki,t.index);switch(t.lanes=0,t.tag){case 2:var n=t.type;Qs(e,t),e=t.pendingProps;var i=ki(t,Ti.current);Fo(t,r),i=ma(null,t,n,e,i,r);var a=ga();return t.flags|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Pi(n)?(a=!0,Di(t)):a=!1,t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,Uo(t),i.updater=is,t.stateNode=i,i._reactInternals=t,ls(t,n,e,r),t=Ts(null,t,n,!0,a,r)):(t.tag=0,io&&a&&eo(t),vs(null,t,i,r),t=t.child),t;case 16:n=t.elementType;e:{switch(Qs(e,t),e=t.pendingProps,n=(i=n._init)(n._payload),t.type=n,i=t.tag=function(e){if("function"===typeof e)return kc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===T)return 11;if(e===k)return 14}return 2}(n),e=rs(n,e),i){case 0:t=Es(null,t,n,e,r);break e;case 1:t=Ss(null,t,n,e,r);break e;case 11:t=xs(null,t,n,e,r);break e;case 14:t=ws(null,t,n,rs(n.type,e),r);break e}throw Error(o(306,n,""))}return t;case 0:return n=t.type,i=t.pendingProps,Es(e,t,n,i=t.elementType===n?i:rs(n,i),r);case 1:return n=t.type,i=t.pendingProps,Ss(e,t,n,i=t.elementType===n?i:rs(n,i),r);case 3:e:{if(Is(t),null===e)throw Error(o(387));n=t.pendingProps,i=(a=t.memoizedState).element,Ro(e,t),Vo(t,n,null,r);var s=t.memoizedState;if(n=s.element,a.isDehydrated){if(a={element:n,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=a,t.memoizedState=a,256&t.flags){t=Fs(e,t,n,r,i=cs(Error(o(423)),t));break e}if(n!==i){t=Fs(e,t,n,r,i=cs(Error(o(424)),t));break e}for(no=ci(t.stateNode.containerInfo.firstChild),ro=t,io=!0,oo=null,r=wo(t,null,n,r),t.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(fo(),n===i){t=Vs(e,t,r);break e}vs(e,t,n,r)}t=t.child}return t;case 5:return Jo(t),null===e&&co(t),n=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,ri(n,i)?s=null:null!==a&&ri(n,a)&&(t.flags|=32),Cs(e,t),vs(e,t,s,r),t.child;case 6:return null===e&&co(t),null;case 13:return Ds(e,t,r);case 4:return Xo(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=xo(t,null,n,r):vs(e,t,n,r),t.child;case 11:return n=t.type,i=t.pendingProps,xs(e,t,n,i=t.elementType===n?i:rs(n,i),r);case 7:return vs(e,t,t.pendingProps,r),t.child;case 8:case 12:return vs(e,t,t.pendingProps.children,r),t.child;case 10:e:{if(n=t.type._context,i=t.pendingProps,a=t.memoizedProps,s=i.value,Ei(bo,n._currentValue),n._currentValue=s,null!==a)if(sn(a.value,s)){if(a.children===i.children&&!Ii.current){t=Vs(e,t,r);break e}}else for(null!==(a=t.child)&&(a.return=t);null!==a;){var l=a.dependencies;if(null!==l){s=a.child;for(var c=l.firstContext;null!==c;){if(c.context===n){if(1===a.tag){(c=zo(-1,r&-r)).tag=2;var u=a.updateQueue;if(null!==u){var d=(u=u.shared).pending;null===d?c.next=c:(c.next=d.next,d.next=c),u.pending=c}}a.lanes|=r,null!==(c=a.alternate)&&(c.lanes|=r),Io(a.return,r,t),l.lanes|=r;break}c=c.next}}else if(10===a.tag)s=a.type===t.type?null:a.child;else if(18===a.tag){if(null===(s=a.return))throw Error(o(341));s.lanes|=r,null!==(l=s.alternate)&&(l.lanes|=r),Io(s,r,t),s=a.sibling}else s=a.child;if(null!==s)s.return=a;else for(s=a;null!==s;){if(s===t){s=null;break}if(null!==(a=s.sibling)){a.return=s.return,s=a;break}s=s.return}a=s}vs(e,t,i.children,r),t=t.child}return t;case 9:return i=t.type,n=t.pendingProps.children,Fo(t,r),n=n(i=ko(i)),t.flags|=1,vs(e,t,n,r),t.child;case 14:return i=rs(n=t.type,t.pendingProps),ws(e,t,n,i=rs(n.type,i),r);case 15:return bs(e,t,t.type,t.pendingProps,r);case 17:return n=t.type,i=t.pendingProps,i=t.elementType===n?i:rs(n,i),Qs(e,t),t.tag=1,Pi(n)?(e=!0,Di(t)):e=!1,Fo(t,r),as(t,n,i),ls(t,n,i,r),Ts(null,t,n,!0,e,r);case 19:return js(e,t,r);case 22:return Bs(e,t,r)}throw Error(o(156,t.tag))};var Kc="function"===typeof reportError?reportError:function(e){console.error(e)};function Wc(e){this._internalRoot=e}function qc(e){this._internalRoot=e}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Xc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Yc(){}function Jc(e,t,r,n,i){var o=r._reactRootContainer;if(o){var a=o;if("function"===typeof i){var s=i;i=function(){var e=Vc(a);s.call(e)}}Qc(t,a,e,i)}else a=function(e,t,r,n,i){if(i){if("function"===typeof n){var o=n;n=function(){var e=Vc(a);o.call(e)}}var a=jc(t,n,e,0,null,!1,0,"",Yc);return e._reactRootContainer=a,e[fi]=a.current,Qn(8===e.nodeType?e.parentNode:e),cc(),a}for(;i=e.lastChild;)e.removeChild(i);if("function"===typeof n){var s=n;n=function(){var e=Vc(l);s.call(e)}}var l=zc(e,0,!1,null,0,!1,0,"",Yc);return e._reactRootContainer=l,e[fi]=l.current,Qn(8===e.nodeType?e.parentNode:e),cc(function(){Qc(t,l,r,n)}),l}(r,t,e,i,n);return Vc(a)}qc.prototype.render=Wc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));Qc(e,t,null,null)},qc.prototype.unmount=Wc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;cc(function(){Qc(null,e,null,null)}),t[fi]=null}},qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=Bt();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Mt.length&&0!==t&&t<Mt[r].priority;r++);Mt.splice(r,0,e),0===r&&Ut(e)}},xt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var r=dt(t.pendingLanes);0!==r&&(yt(t,1|r),rc(t,Ye()),0===(6&Sl)&&(jl=Ye()+500,Qi()))}break;case 13:cc(function(){var t=Lo(e,1);if(null!==t){var r=$l();tc(t,e,1,r)}}),Gc(e,1)}},wt=function(e){if(13===e.tag){var t=Lo(e,134217728);if(null!==t)tc(t,e,134217728,$l());Gc(e,134217728)}},bt=function(e){if(13===e.tag){var t=ec(e),r=Lo(e,t);if(null!==r)tc(r,e,t,$l());Gc(e,t)}},Bt=function(){return _t},Ct=function(e,t){var r=_t;try{return _t=e,t()}finally{_t=r}},we=function(e,t,r){switch(t){case"input":if(J(e,r),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=xi(n);if(!i)throw Error(o(90));W(n),J(n,i)}}}break;case"textarea":oe(e,r);break;case"select":null!=(t=r.value)&&re(e,!!r.multiple,t,!1)}},Te=lc,Ie=cc;var $c={usingClientEntryPoint:!1,Events:[_i,vi,xi,Ee,Se,lc]},eu={findFiberByHostInstance:yi,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},tu={bundleType:eu.bundleType,version:eu.version,rendererPackageName:eu.rendererPackageName,rendererConfig:eu.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:v.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:eu.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var ru=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ru.isDisabled&&ru.supportsFiber)try{it=ru.inject(tu),ot=ru}catch(ue){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$c,t.createPortal=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Zc(t))throw Error(o(200));return function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==n?null:""+n,children:e,containerInfo:t,implementation:r}}(e,t,null,r)},t.createRoot=function(e,t){if(!Zc(e))throw Error(o(299));var r=!1,n="",i=Kc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(r=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onRecoverableError&&(i=t.onRecoverableError)),t=zc(e,1,!1,null,0,r,0,n,i),e[fi]=t.current,Qn(8===e.nodeType?e.parentNode:e),new Wc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return cc(e)},t.hydrate=function(e,t,r){if(!Xc(t))throw Error(o(200));return Jc(null,e,t,!0,r)},t.hydrateRoot=function(e,t,r){if(!Zc(e))throw Error(o(405));var n=null!=r&&r.hydratedSources||null,i=!1,a="",s=Kc;if(null!==r&&void 0!==r&&(!0===r.unstable_strictMode&&(i=!0),void 0!==r.identifierPrefix&&(a=r.identifierPrefix),void 0!==r.onRecoverableError&&(s=r.onRecoverableError)),t=jc(t,null,e,1,null!=r?r:null,i,0,a,s),e[fi]=t.current,Qn(e),n)for(e=0;e<n.length;e++)i=(i=(r=n[e])._getVersion)(r._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[r,i]:t.mutableSourceEagerHydrationData.push(r,i);return new qc(t)},t.render=function(e,t,r){if(!Xc(t))throw Error(o(200));return Jc(null,e,t,!1,r)},t.unmountComponentAtNode=function(e){if(!Xc(e))throw Error(o(40));return!!e._reactRootContainer&&(cc(function(){Jc(null,null,e,!1,function(){e._reactRootContainer=null,e[fi]=null})}),!0)},t.unstable_batchedUpdates=lc,t.unstable_renderSubtreeIntoContainer=function(e,t,r,n){if(!Xc(r))throw Error(o(200));if(null==e||void 0===e._reactInternals)throw Error(o(38));return Jc(e,t,r,!1,n)},t.version="18.3.1-next-f1338f8080-20240426"},2777(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isSymbol=function(e){return"symbol"===typeof e||e instanceof Symbol}},2897(e,t,r){var n=r(3693);function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}e.exports=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach(function(t){n(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e},e.exports.__esModule=!0,e.exports.default=e.exports},3272(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.toKey=function(e){var t;return"string"===typeof e||"symbol"===typeof e?e:Object.is(null===e||void 0===e||null===(t=e.valueOf)||void 0===t?void 0:t.call(e),-0)?"-0":String(e)}},3693(e,t,r){var n=r(7736);e.exports=function(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},3738(e){function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},3757(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isTypedArray=function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}},3799(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(4704),i=r(1203),o=r(870),a=r(5093);t.isIterateeCall=function(e,t,r){return!!o.isObject(r)&&(!!("number"===typeof t&&i.isArrayLike(r)&&n.isIndex(t)&&t<r.length||"string"===typeof t&&t in r)&&a.isEqualsSameValueZero(r[t],e))}},3808(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(8268),i=r(5261);t.matches=function(e){return e=i.cloneDeep(e),t=>n.isMatch(t,e)}},3821(e,t,r){e.exports=r(2204).sortBy},4202(e,t){"use strict";var r=Symbol.for("react.element"),n=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),a=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),A=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},p=Object.assign,m={};function g(e,t,r){this.props=e,this.context=t,this.refs=m,this.updater=r||f}function y(){}function _(e,t,r){this.props=e,this.context=t,this.refs=m,this.updater=r||f}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var v=_.prototype=new y;v.constructor=_,p(v,g.prototype),v.isPureReactComponent=!0;var x=Array.isArray,w=Object.prototype.hasOwnProperty,b={current:null},B={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,n){var i,o={},a=null,s=null;if(null!=t)for(i in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(a=""+t.key),t)w.call(t,i)&&!B.hasOwnProperty(i)&&(o[i]=t[i]);var l=arguments.length-2;if(1===l)o.children=n;else if(1<l){for(var c=Array(l),u=0;u<l;u++)c[u]=arguments[u+2];o.children=c}if(e&&e.defaultProps)for(i in l=e.defaultProps)void 0===o[i]&&(o[i]=l[i]);return{$$typeof:r,type:e,key:a,ref:s,props:o,_owner:b.current}}function E(e){return"object"===typeof e&&null!==e&&e.$$typeof===r}var S=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function I(e,t,i,o,a){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var l=!1;if(null===e)l=!0;else switch(s){case"string":case"number":l=!0;break;case"object":switch(e.$$typeof){case r:case n:l=!0}}if(l)return a=a(l=e),e=""===o?"."+T(l,0):o,x(a)?(i="",null!=e&&(i=e.replace(S,"$&/")+"/"),I(a,t,i,"",function(e){return e})):null!=a&&(E(a)&&(a=function(e,t){return{$$typeof:r,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(a,i+(!a.key||l&&l.key===a.key?"":(""+a.key).replace(S,"$&/")+"/")+e)),t.push(a)),1;if(l=0,o=""===o?".":o+":",x(e))for(var c=0;c<e.length;c++){var u=o+T(s=e[c],c);l+=I(s,t,i,u,a)}else if(u=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=A&&e[A]||e["@@iterator"])?e:null}(e),"function"===typeof u)for(e=u.call(e),c=0;!(s=e.next()).done;)l+=I(s=s.value,t,i,u=o+T(s,c++),a);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return l}function F(e,t,r){if(null==e)return e;var n=[],i=0;return I(e,n,"","",function(e){return t.call(r,e,i++)}),n}function k(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var P={current:null},M={transition:null},O={ReactCurrentDispatcher:P,ReactCurrentBatchConfig:M,ReactCurrentOwner:b};function L(){throw Error("act(...) is not supported in production builds of React.")}t.Children={map:F,forEach:function(e,t,r){F(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return F(e,function(){t++}),t},toArray:function(e){return F(e,function(e){return e})||[]},only:function(e){if(!E(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=i,t.Profiler=a,t.PureComponent=_,t.StrictMode=o,t.Suspense=u,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=O,t.act=L,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var i=p({},e.props),o=e.key,a=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,s=b.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var l=e.type.defaultProps;for(c in t)w.call(t,c)&&!B.hasOwnProperty(c)&&(i[c]=void 0===t[c]&&void 0!==l?l[c]:t[c])}var c=arguments.length-2;if(1===c)i.children=n;else if(1<c){l=Array(c);for(var u=0;u<c;u++)l[u]=arguments[u+2];i.children=l}return{$$typeof:r,type:e.type,key:o,ref:a,props:i,_owner:s}},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=E,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:k}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=M.transition;M.transition={};try{e()}finally{M.transition=t}},t.unstable_act=L,t.useCallback=function(e,t){return P.current.useCallback(e,t)},t.useContext=function(e){return P.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return P.current.useDeferredValue(e)},t.useEffect=function(e,t){return P.current.useEffect(e,t)},t.useId=function(){return P.current.useId()},t.useImperativeHandle=function(e,t,r){return P.current.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return P.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return P.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return P.current.useMemo(e,t)},t.useReducer=function(e,t,r){return P.current.useReducer(e,t,r)},t.useRef=function(e){return P.current.useRef(e)},t.useState=function(e){return P.current.useState(e)},t.useSyncExternalStore=function(e,t,r){return P.current.useSyncExternalStore(e,t,r)},t.useTransition=function(){return P.current.useTransition()},t.version="18.3.1"},4208(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.uniqBy=function(e,t){const r=new Map;for(let n=0;n<e.length;n++){const i=e[n],o=t(i,n,e);r.has(o)||r.set(o,i)}return Array.from(r.values())}},4332(e,t,r){e.exports=r(5053).uniqBy},4391(e,t,r){"use strict";var n=r(7950);t.createRoot=n.createRoot,t.hydrateRoot=n.hydrateRoot},4704(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const r=/^(?:0|[1-9]\d*)$/;t.isIndex=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Number.MAX_SAFE_INTEGER;switch(typeof e){case"number":return Number.isInteger(e)&&e>=0&&e<t;case"symbol":return!1;case"string":return r.test(e)}}},4803(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isPrimitive=function(e){return null==e||"object"!==typeof e&&"function"!==typeof e}},4830(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.debounce=function(e,t){let r,{signal:n,edges:i}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=null;const a=null!=i&&i.includes("leading"),s=null==i||i.includes("trailing"),l=()=>{null!==o&&(e.apply(r,o),r=void 0,o=null)};let c=null;const u=()=>{null!=c&&clearTimeout(c),c=setTimeout(()=>{c=null,s&&l(),d()},t)},d=()=>{null!==c&&(clearTimeout(c),c=null),r=void 0,o=null},h=function(){if(null!==n&&void 0!==n&&n.aborted)return;r=this;for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];o=t;const s=null==c;u(),a&&s&&l()};return h.schedule=u,h.cancel=d,h.flush=()=>{l()},null===n||void 0===n||n.addEventListener("abort",d,{once:!0}),h}},4879(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(6770);t.toFinite=function(e){if(!e)return 0===e?e:0;if((e=n.toNumber(e))===1/0||e===-1/0){return(e<0?-1:1)*Number.MAX_VALUE}return e===e?e:0}},4893(e){e.exports=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r},e.exports.__esModule=!0,e.exports.default=e.exports},5043(e,t,r){"use strict";e.exports=r(4202)},5053(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(4208),i=r(9903),o=r(9599),a=r(2104),s=r(2715);t.uniqBy=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.identity;return a.isArrayLikeObject(e)?n.uniqBy(Array.from(e),i.ary(s.iteratee(t),1)):[]}},5082(e,t){"use strict";var r=60103,n=60106,i=60107,o=60108,a=60114,s=60109,l=60110,c=60112,u=60113,d=60120,h=60115,A=60116,f=60121,p=60122,m=60117,g=60129,y=60131;if("function"===typeof Symbol&&Symbol.for){var _=Symbol.for;r=_("react.element"),n=_("react.portal"),i=_("react.fragment"),o=_("react.strict_mode"),a=_("react.profiler"),s=_("react.provider"),l=_("react.context"),c=_("react.forward_ref"),u=_("react.suspense"),d=_("react.suspense_list"),h=_("react.memo"),A=_("react.lazy"),f=_("react.block"),p=_("react.server.block"),m=_("react.fundamental"),g=_("react.debug_trace_mode"),y=_("react.legacy_hidden")}function v(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case i:case a:case o:case u:case d:return e;default:switch(e=e&&e.$$typeof){case l:case c:case A:case h:case s:return e;default:return t}}case n:return t}}}t.isFragment=function(e){return v(e)===i}},5093(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isEqualsSameValueZero=function(e,t){return e===t||Number.isNaN(e)&&Number.isNaN(t)}},5239(e){e.exports=function(){"use strict";var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};function t(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function n(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(n.prototype=r.prototype,new n)}var r=function(){return r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e},r.apply(this,arguments)};function n(e,t,r,n){function i(e){return e instanceof r?e:new r(function(t){t(e)})}return new(r||(r=Promise))(function(r,o){function a(e){try{l(n.next(e))}catch(Ut){o(Ut)}}function s(e){try{l(n.throw(e))}catch(Ut){o(Ut)}}function l(e){e.done?r(e.value):i(e.value).then(a,s)}l((n=n.apply(e,t||[])).next())})}function i(e,t){var r,n,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(e){return function(t){return l([e,t])}}function l(o){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(i=2&o[0]?n.return:o[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,o[1])).done)return i;switch(n=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,n=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=t.call(e,a)}catch(Ut){o=[6,Ut],n=0}finally{r=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function o(e,t,r){if(r||2===arguments.length)for(var n,i=0,o=t.length;i<o;i++)!n&&i in t||(n||(n=Array.prototype.slice.call(t,0,i)),n[i]=t[i]);return e.concat(n||t)}for(var a=function(){function e(e,t,r,n){this.left=e,this.top=t,this.width=r,this.height=n}return e.prototype.add=function(t,r,n,i){return new e(this.left+t,this.top+r,this.width+n,this.height+i)},e.fromClientRect=function(t,r){return new e(r.left+t.windowBounds.left,r.top+t.windowBounds.top,r.width,r.height)},e.fromDOMRectList=function(t,r){var n=Array.from(r).find(function(e){return 0!==e.width});return n?new e(n.left+t.windowBounds.left,n.top+t.windowBounds.top,n.width,n.height):e.EMPTY},e.EMPTY=new e(0,0,0,0),e}(),s=function(e,t){return a.fromClientRect(e,t.getBoundingClientRect())},l=function(e){var t=e.body,r=e.documentElement;if(!t||!r)throw new Error("Unable to get document size");var n=Math.max(Math.max(t.scrollWidth,r.scrollWidth),Math.max(t.offsetWidth,r.offsetWidth),Math.max(t.clientWidth,r.clientWidth)),i=Math.max(Math.max(t.scrollHeight,r.scrollHeight),Math.max(t.offsetHeight,r.offsetHeight),Math.max(t.clientHeight,r.clientHeight));return new a(0,0,n,i)},c=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=e.charCodeAt(r++);if(i>=55296&&i<=56319&&r<n){var o=e.charCodeAt(r++);56320===(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),r--)}else t.push(i)}return t},u=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var r=e.length;if(!r)return"";for(var n=[],i=-1,o="";++i<r;){var a=e[i];a<=65535?n.push(a):(a-=65536,n.push(55296+(a>>10),a%1024+56320)),(i+1===r||n.length>16384)&&(o+=String.fromCharCode.apply(String,n),n.length=0)}return o},d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",h="undefined"===typeof Uint8Array?[]:new Uint8Array(256),A=0;A<d.length;A++)h[d.charCodeAt(A)]=A;for(var f="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",p="undefined"===typeof Uint8Array?[]:new Uint8Array(256),m=0;m<f.length;m++)p[f.charCodeAt(m)]=m;for(var g=function(e){var t,r,n,i,o,a=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint8Array.prototype.slice?new ArrayBuffer(a):new Array(a),u=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<s;t+=4)r=p[e.charCodeAt(t)],n=p[e.charCodeAt(t+1)],i=p[e.charCodeAt(t+2)],o=p[e.charCodeAt(t+3)],u[l++]=r<<2|n>>4,u[l++]=(15&n)<<4|i>>2,u[l++]=(3&i)<<6|63&o;return c},y=function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r.push(e[n+1]<<8|e[n]);return r},_=function(e){for(var t=e.length,r=[],n=0;n<t;n+=4)r.push(e[n+3]<<24|e[n+2]<<16|e[n+1]<<8|e[n]);return r},v=5,x=11,w=2,b=65536>>v,B=(1<<v)-1,C=b+(1024>>v)+32,E=65536>>x,S=(1<<x-v)-1,T=function(e,t,r){return e.slice?e.slice(t,r):new Uint16Array(Array.prototype.slice.call(e,t,r))},I=function(e,t,r){return e.slice?e.slice(t,r):new Uint32Array(Array.prototype.slice.call(e,t,r))},F=function(e,t){var r=g(e),n=Array.isArray(r)?_(r):new Uint32Array(r),i=Array.isArray(r)?y(r):new Uint16Array(r),o=24,a=T(i,o/2,n[4]/2),s=2===n[5]?T(i,(o+n[4])/2):I(n,Math.ceil((o+n[4])/4));return new k(n[0],n[1],n[2],n[3],a,s)},k=function(){function e(e,t,r,n,i,o){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=i,this.data=o}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>v])<<w)+(e&B),this.data[t];if(e<=65535)return t=((t=this.index[b+(e-55296>>v)])<<w)+(e&B),this.data[t];if(e<this.highStart)return t=C-E+(e>>x),t=this.index[t],t+=e>>v&S,t=((t=this.index[t])<<w)+(e&B),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),P="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",M="undefined"===typeof Uint8Array?[]:new Uint8Array(256),O=0;O<P.length;O++)M[P.charCodeAt(O)]=O;var L=50,D=1,U=2,R=3,z=4,N=5,j=7,Q=8,V=9,H=10,G=11,K=12,W=13,q=14,Z=15,X=16,Y=17,J=18,$=19,ee=20,te=21,re=22,ne=23,ie=24,oe=25,ae=26,se=27,le=28,ce=29,ue=30,de=31,he=32,Ae=33,fe=34,pe=35,me=36,ge=37,ye=38,_e=39,ve=40,xe=41,we=42,be=43,Be=[9001,65288],Ce="!",Ee="\xd7",Se="\xf7",Te=F("KwAAAAAAAAAACA4AUD0AADAgAAACAAAAAAAIABAAGABAAEgAUABYAGAAaABgAGgAYgBqAF8AZwBgAGgAcQB5AHUAfQCFAI0AlQCdAKIAqgCyALoAYABoAGAAaABgAGgAwgDKAGAAaADGAM4A0wDbAOEA6QDxAPkAAQEJAQ8BFwF1AH0AHAEkASwBNAE6AUIBQQFJAVEBWQFhAWgBcAF4ATAAgAGGAY4BlQGXAZ8BpwGvAbUBvQHFAc0B0wHbAeMB6wHxAfkBAQIJAvEBEQIZAiECKQIxAjgCQAJGAk4CVgJeAmQCbAJ0AnwCgQKJApECmQKgAqgCsAK4ArwCxAIwAMwC0wLbAjAA4wLrAvMC+AIAAwcDDwMwABcDHQMlAy0DNQN1AD0DQQNJA0kDSQNRA1EDVwNZA1kDdQB1AGEDdQBpA20DdQN1AHsDdQCBA4kDkQN1AHUAmQOhA3UAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AKYDrgN1AHUAtgO+A8YDzgPWAxcD3gPjA+sD8wN1AHUA+wMDBAkEdQANBBUEHQQlBCoEFwMyBDgEYABABBcDSARQBFgEYARoBDAAcAQzAXgEgASIBJAEdQCXBHUAnwSnBK4EtgS6BMIEyAR1AHUAdQB1AHUAdQCVANAEYABgAGAAYABgAGAAYABgANgEYADcBOQEYADsBPQE/AQEBQwFFAUcBSQFLAU0BWQEPAVEBUsFUwVbBWAAYgVgAGoFcgV6BYIFigWRBWAAmQWfBaYFYABgAGAAYABgAKoFYACxBbAFuQW6BcEFwQXHBcEFwQXPBdMF2wXjBeoF8gX6BQIGCgYSBhoGIgYqBjIGOgZgAD4GRgZMBmAAUwZaBmAAYABgAGAAYABgAGAAYABgAGAAYABgAGIGYABpBnAGYABgAGAAYABgAGAAYABgAGAAYAB4Bn8GhQZgAGAAYAB1AHcDFQSLBmAAYABgAJMGdQA9A3UAmwajBqsGqwaVALMGuwbDBjAAywbSBtIG1QbSBtIG0gbSBtIG0gbdBuMG6wbzBvsGAwcLBxMHAwcbByMHJwcsBywHMQcsB9IGOAdAB0gHTgfSBkgHVgfSBtIG0gbSBtIG0gbSBtIG0gbSBiwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdgAGAALAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAdbB2MHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB2kH0gZwB64EdQB1AHUAdQB1AHUAdQB1AHUHfQdgAIUHjQd1AHUAlQedB2AAYAClB6sHYACzB7YHvgfGB3UAzgfWBzMB3gfmB1EB7gf1B/0HlQENAQUIDQh1ABUIHQglCBcDLQg1CD0IRQhNCEEDUwh1AHUAdQBbCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIaQhjCGQIZQhmCGcIaAhpCGMIZAhlCGYIZwhoCGkIYwhkCGUIZghnCGgIcAh3CHoIMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIgggwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAALAcsBywHLAcsBywHLAcsBywHLAcsB4oILAcsB44I0gaWCJ4Ipgh1AHUAqgiyCHUAdQB1AHUAdQB1AHUAdQB1AHUAtwh8AXUAvwh1AMUIyQjRCNkI4AjoCHUAdQB1AO4I9gj+CAYJDgkTCS0HGwkjCYIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiCCIIIggiAAIAAAAFAAYABgAGIAXwBgAHEAdQBFAJUAogCyAKAAYABgAEIA4ABGANMA4QDxAMEBDwE1AFwBLAE6AQEBUQF4QkhCmEKoQrhCgAHIQsAB0MLAAcABwAHAAeDC6ABoAHDCwMMAAcABwAHAAdDDGMMAAcAB6MM4wwjDWMNow3jDaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAGgAaABoAEjDqABWw6bDqABpg6gAaABoAHcDvwOPA+gAaABfA/8DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DvwO/A78DpcPAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcAB9cPKwkyCToJMAB1AHUAdQBCCUoJTQl1AFUJXAljCWcJawkwADAAMAAwAHMJdQB2CX4JdQCECYoJjgmWCXUAngkwAGAAYABxAHUApgn3A64JtAl1ALkJdQDACTAAMAAwADAAdQB1AHUAdQB1AHUAdQB1AHUAowYNBMUIMAAwADAAMADICcsJ0wnZCRUE4QkwAOkJ8An4CTAAMAB1AAAKvwh1AAgKDwoXCh8KdQAwACcKLgp1ADYKqAmICT4KRgowADAAdQB1AE4KMAB1AFYKdQBeCnUAZQowADAAMAAwADAAMAAwADAAMAAVBHUAbQowADAAdQC5CXUKMAAwAHwBxAijBogEMgF9CoQKiASMCpQKmgqIBKIKqgquCogEDQG2Cr4KxgrLCjAAMADTCtsKCgHjCusK8Qr5CgELMAAwADAAMAB1AIsECQsRC3UANAEZCzAAMAAwADAAMAB1ACELKQswAHUANAExCzkLdQBBC0kLMABRC1kLMAAwADAAMAAwADAAdQBhCzAAMAAwAGAAYABpC3ELdwt/CzAAMACHC4sLkwubC58Lpwt1AK4Ltgt1APsDMAAwADAAMAAwADAAMAAwAL4LwwvLC9IL1wvdCzAAMADlC+kL8Qv5C/8LSQswADAAMAAwADAAMAAwADAAMAAHDDAAMAAwADAAMAAODBYMHgx1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1ACYMMAAwADAAdQB1AHUALgx1AHUAdQB1AHUAdQA2DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AD4MdQBGDHUAdQB1AHUAdQB1AEkMdQB1AHUAdQB1AFAMMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQBYDHUAdQB1AF8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUA+wMVBGcMMAAwAHwBbwx1AHcMfwyHDI8MMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAYABgAJcMMAAwADAAdQB1AJ8MlQClDDAAMACtDCwHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsB7UMLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHdQB1AHUAdQB1AHUAdQB1AHUAdQB1AHUAdQB1AA0EMAC9DDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAsBywHLAcsBywHLAcsBywHLQcwAMEMyAwsBywHLAcsBywHLAcsBywHLAcsBywHzAwwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwAHUAdQB1ANQM2QzhDDAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMABgAGAAYABgAGAAYABgAOkMYADxDGAA+AwADQYNYABhCWAAYAAODTAAMAAwADAAFg1gAGAAHg37AzAAMAAwADAAYABgACYNYAAsDTQNPA1gAEMNPg1LDWAAYABgAGAAYABgAGAAYABgAGAAUg1aDYsGVglhDV0NcQBnDW0NdQ15DWAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAlQCBDZUAiA2PDZcNMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAnw2nDTAAMAAwADAAMAAwAHUArw23DTAAMAAwADAAMAAwADAAMAAwADAAMAB1AL8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAB1AHUAdQB1AHUAdQDHDTAAYABgAM8NMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA1w11ANwNMAAwAD0B5A0wADAAMAAwADAAMADsDfQN/A0EDgwOFA4wABsOMAAwADAAMAAwADAAMAAwANIG0gbSBtIG0gbSBtIG0gYjDigOwQUuDsEFMw7SBjoO0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGQg5KDlIOVg7SBtIGXg5lDm0OdQ7SBtIGfQ6EDooOjQ6UDtIGmg6hDtIG0gaoDqwO0ga0DrwO0gZgAGAAYADEDmAAYAAkBtIGzA5gANIOYADaDokO0gbSBt8O5w7SBu8O0gb1DvwO0gZgAGAAxA7SBtIG0gbSBtIGYABgAGAAYAAED2AAsAUMD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHJA8sBywHLAcsBywHLAccDywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywPLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAc0D9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAccD9IG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIGFA8sBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHLAcsBywHPA/SBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gbSBtIG0gYUD0QPlQCVAJUAMAAwADAAMACVAJUAlQCVAJUAlQCVAEwPMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAA//8EAAQABAAEAAQABAAEAAQABAANAAMAAQABAAIABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQACgATABcAHgAbABoAHgAXABYAEgAeABsAGAAPABgAHABLAEsASwBLAEsASwBLAEsASwBLABgAGAAeAB4AHgATAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABYAGwASAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWAA0AEQAeAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAFAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJABYAGgAbABsAGwAeAB0AHQAeAE8AFwAeAA0AHgAeABoAGwBPAE8ADgBQAB0AHQAdAE8ATwAXAE8ATwBPABYAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AHgAeAFAATwBAAE8ATwBPAEAATwBQAFAATwBQAB4AHgAeAB4AHgAeAB0AHQAdAB0AHgAdAB4ADgBQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgBQAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAJAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAkACQAJAAkACQAJAAkABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAFAAHgAeAB4AKwArAFAAUABQAFAAGABQACsAKwArACsAHgAeAFAAHgBQAFAAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUAAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAYAA0AKwArAB4AHgAbACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAB4ABAAEAB4ABAAEABMABAArACsAKwArACsAKwArACsAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAKwArACsAKwBWAFYAVgBWAB4AHgArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AGgAaABoAGAAYAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQAEwAEACsAEwATAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABLAEsASwBLAEsASwBLAEsASwBLABoAGQAZAB4AUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQABMAUAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABABQAFAABAAEAB4ABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUAAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAFAABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQAUABQAB4AHgAYABMAUAArACsABAAbABsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAFAABAAEAAQABAAEAFAABAAEAAQAUAAEAAQABAAEAAQAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArACsAHgArAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAUAAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEAA0ADQBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUAArACsAKwBQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABABQACsAKwArACsAKwArACsAKwAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUAAaABoAUABQAFAAUABQAEwAHgAbAFAAHgAEACsAKwAEAAQABAArAFAAUABQAFAAUABQACsAKwArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQACsAUABQACsAKwAEACsABAAEAAQABAAEACsAKwArACsABAAEACsAKwAEAAQABAArACsAKwAEACsAKwArACsAKwArACsAUABQAFAAUAArAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLAAQABABQAFAAUAAEAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsAKwAEAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAArACsAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AGwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAKwArACsAKwArAAQABAAEACsAKwArACsAUABQACsAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAAQAUAArAFAAUABQAFAAUABQACsAKwArAFAAUABQACsAUABQAFAAUAArACsAKwBQAFAAKwBQACsAUABQACsAKwArAFAAUAArACsAKwBQAFAAUAArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArAAQABAAEAAQABAArACsAKwAEAAQABAArAAQABAAEAAQAKwArAFAAKwArACsAKwArACsABAArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAHgAeAB4AHgAeAB4AGwAeACsAKwArACsAKwAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAUABQAFAAKwArACsAKwArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwAOAFAAUABQAFAAUABQAFAAHgBQAAQABAAEAA4AUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAKwArAAQAUAAEAAQABAAEAAQABAAEACsABAAEAAQAKwAEAAQABAAEACsAKwArACsAKwArACsABAAEACsAKwArACsAKwArACsAUAArAFAAUAAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAFAABAAEAAQABAAEAAQABAArAAQABAAEACsABAAEAAQABABQAB4AKwArACsAKwBQAFAAUAAEAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQABoAUABQAFAAUABQAFAAKwAEAAQABAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQACsAUAArACsAUABQAFAAUABQAFAAUAArACsAKwAEACsAKwArACsABAAEAAQABAAEAAQAKwAEACsABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArAAQABAAeACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAXAAqACoAKgAqACoAKgAqACsAKwArACsAGwBcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAeAEsASwBLAEsASwBLAEsASwBLAEsADQANACsAKwArACsAKwBcAFwAKwBcACsAXABcAFwAXABcACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAXAArAFwAXABcAFwAXABcAFwAXABcAFwAKgBcAFwAKgAqACoAKgAqACoAKgAqACoAXAArACsAXABcAFwAXABcACsAXAArACoAKgAqACoAKgAqACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwBcAFwAXABcAFAADgAOAA4ADgAeAA4ADgAJAA4ADgANAAkAEwATABMAEwATAAkAHgATAB4AHgAeAAQABAAeAB4AHgAeAB4AHgBLAEsASwBLAEsASwBLAEsASwBLAFAAUABQAFAAUABQAFAAUABQAFAADQAEAB4ABAAeAAQAFgARABYAEQAEAAQAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQADQAEAAQABAAEAAQADQAEAAQAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAA0ADQAeAB4AHgAeAB4AHgAEAB4AHgAeAB4AHgAeACsAHgAeAA4ADgANAA4AHgAeAB4AHgAeAAkACQArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgBcAEsASwBLAEsASwBLAEsASwBLAEsADQANAB4AHgAeAB4AXABcAFwAXABcAFwAKgAqACoAKgBcAFwAXABcACoAKgAqAFwAKgAqACoAXABcACoAKgAqACoAKgAqACoAXABcAFwAKgAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKgAqAFwAKgBLAEsASwBLAEsASwBLAEsASwBLACoAKgAqACoAKgAqAFAAUABQAFAAUABQACsAUAArACsAKwArACsAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAKwBQACsAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsABAAEAAQAHgANAB4AHgAeAB4AHgAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUAArACsADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAWABEAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQANAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAANAA0AKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUAArAAQABAArACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqAA0ADQAVAFwADQAeAA0AGwBcACoAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwAeAB4AEwATAA0ADQAOAB4AEwATAB4ABAAEAAQACQArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAHgArACsAKwATABMASwBLAEsASwBLAEsASwBLAEsASwBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAXABcAFwAXABcACsAKwArACsAKwArACsAKwArACsAKwBcAFwAXABcAFwAXABcAFwAXABcAFwAXAArACsAKwArAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAXAArACsAKwAqACoAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAArACsAHgAeAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcACoAKgAqACoAKgAqACoAKgAqACoAKwAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKwArAAQASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACoAKgAqACoAKgAqACoAXAAqACoAKgAqACoAKgArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABABQAFAAUABQAFAAUABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwANAA0AHgANAA0ADQANAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAEAAQABAAEAAQAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwAeAB4AHgAeAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArAA0ADQANAA0ADQBLAEsASwBLAEsASwBLAEsASwBLACsAKwArAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAA0ADQBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUAAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArAAQABAAEAB4ABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAAQAUABQAFAAUABQAFAABABQAFAABAAEAAQAUAArACsAKwArACsABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQACsAUAArAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAFAAUABQACsAHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQACsAKwAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQACsAHgAeAB4AHgAeAB4AHgAOAB4AKwANAA0ADQANAA0ADQANAAkADQANAA0ACAAEAAsABAAEAA0ACQANAA0ADAAdAB0AHgAXABcAFgAXABcAFwAWABcAHQAdAB4AHgAUABQAFAANAAEAAQAEAAQABAAEAAQACQAaABoAGgAaABoAGgAaABoAHgAXABcAHQAVABUAHgAeAB4AHgAeAB4AGAAWABEAFQAVABUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ADQAeAA0ADQANAA0AHgANAA0ADQAHAB4AHgAeAB4AKwAEAAQABAAEAAQABAAEAAQABAAEAFAAUAArACsATwBQAFAAUABQAFAAHgAeAB4AFgARAE8AUABPAE8ATwBPAFAAUABQAFAAUAAeAB4AHgAWABEAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArABsAGwAbABsAGwAbABsAGgAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGgAbABsAGwAbABoAGwAbABoAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbABsAGwAbAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAHgAeAFAAGgAeAB0AHgBQAB4AGgAeAB4AHgAeAB4AHgAeAB4AHgBPAB4AUAAbAB4AHgBQAFAAUABQAFAAHgAeAB4AHQAdAB4AUAAeAFAAHgBQAB4AUABPAFAAUAAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAHgBQAFAAUABQAE8ATwBQAFAAUABQAFAATwBQAFAATwBQAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAUABQAFAATwBPAE8ATwBPAE8ATwBPAE8ATwBQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABPAB4AHgArACsAKwArAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHQAdAB4AHgAeAB0AHQAeAB4AHQAeAB4AHgAdAB4AHQAbABsAHgAdAB4AHgAeAB4AHQAeAB4AHQAdAB0AHQAeAB4AHQAeAB0AHgAdAB0AHQAdAB0AHQAeAB0AHgAeAB4AHgAeAB0AHQAdAB0AHgAeAB4AHgAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB4AHgAeAB0AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAeAB0AHQAdAB0AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAdAB4AHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAWABEAHgAeAB4AHgAeAB4AHQAeAB4AHgAeAB4AHgAeACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAWABEAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAFAAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAeAB4AHQAdAB0AHQAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB0AHQAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB0AHQAeAB4AHQAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AHQAdAB0AHgAeAB0AHgAeAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlAB4AHQAdAB4AHgAdAB4AHgAeAB4AHQAdAB4AHgAeAB4AJQAlAB0AHQAlAB4AJQAlACUAIAAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAeAB4AHgAeAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHgAdAB0AHQAeAB0AJQAdAB0AHgAdAB0AHgAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHQAdAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAdAB0AHQAdACUAHgAlACUAJQAdACUAJQAdAB0AHQAlACUAHQAdACUAHQAdACUAJQAlAB4AHQAeAB4AHgAeAB0AHQAlAB0AHQAdAB0AHQAdACUAJQAlACUAJQAdACUAJQAgACUAHQAdACUAJQAlACUAJQAlACUAJQAeAB4AHgAlACUAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB0AHgAeAB4AFwAXABcAFwAXABcAHgATABMAJQAeAB4AHgAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARABYAEQAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAWABEAFgARABYAEQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAWABEAFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AFgARAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAdAB0AHQAdAB0AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAFAAUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAEAAQABAAeAB4AKwArACsAKwArABMADQANAA0AUAATAA0AUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUAANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAA0ADQANAA0ADQANAA0ADQAeAA0AFgANAB4AHgAXABcAHgAeABcAFwAWABEAFgARABYAEQAWABEADQANAA0ADQATAFAADQANAB4ADQANAB4AHgAeAB4AHgAMAAwADQANAA0AHgANAA0AFgANAA0ADQANAA0ADQANAA0AHgANAB4ADQANAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArACsAKwArACsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArAA0AEQARACUAJQBHAFcAVwAWABEAFgARABYAEQAWABEAFgARACUAJQAWABEAFgARABYAEQAWABEAFQAWABEAEQAlAFcAVwBXAFcAVwBXAFcAVwBXAAQABAAEAAQABAAEACUAVwBXAFcAVwA2ACUAJQBXAFcAVwBHAEcAJQAlACUAKwBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBRAFcAUQBXAFEAVwBXAFcAVwBXAFcAUQBXAFcAVwBXAFcAVwBRAFEAKwArAAQABAAVABUARwBHAFcAFQBRAFcAUQBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFEAVwBRAFcAUQBXAFcAVwBXAFcAVwBRAFcAVwBXAFcAVwBXAFEAUQBXAFcAVwBXABUAUQBHAEcAVwArACsAKwArACsAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwAlACUAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACsAKwArACsAKwArACsAKwArACsAKwArAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAUQBRAFEAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBPAE8ATwBPAE8ATwBPAE8AJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADQATAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABLAEsASwBLAEsASwBLAEsASwBLAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAABAAEAAQABAAeAAQABAAEAAQABAAEAAQABAAEAAQAHgBQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUABQAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAeAA0ADQANAA0ADQArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AUAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAB4AHgAeAB4AHgAeAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AUABQAFAAUABQAFAAUABQAFAAUABQAAQAUABQAFAABABQAFAAUABQAAQAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAeAB4AHgAeAAQAKwArACsAUABQAFAAUABQAFAAHgAeABoAHgArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAADgAOABMAEwArACsAKwArACsAKwArACsABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwANAA0ASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUAAeAB4AHgBQAA4AUABQAAQAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArAB4AWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYAFgAWABYACsAKwArAAQAHgAeAB4AHgAeAB4ADQANAA0AHgAeAB4AHgArAFAASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArAB4AHgBcAFwAXABcAFwAKgBcAFwAXABcAFwAXABcAFwAXABcAEsASwBLAEsASwBLAEsASwBLAEsAXABcAFwAXABcACsAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAFAAUABQAAQAUABQAFAAUABQAFAAUABQAAQABAArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAHgANAA0ADQBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKgAqACoAXAAqACoAKgBcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXAAqAFwAKgAqACoAXABcACoAKgBcAFwAXABcAFwAKgAqAFwAKgBcACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFwAXABcACoAKgBQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAA0ADQBQAFAAUAAEAAQAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQADQAEAAQAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAVABVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBUAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVAFUAVQBVACsAKwArACsAKwArACsAKwArACsAKwArAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAWQBZAFkAKwArACsAKwBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAWgBaAFoAKwArACsAKwAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYABgAGAAYAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAKwArACsAKwArAFYABABWAFYAVgBWAFYAVgBWAFYAVgBWAB4AVgBWAFYAVgBWAFYAVgBWAFYAVgBWAFYAVgArAFYAVgBWAFYAVgArAFYAKwBWAFYAKwBWAFYAKwBWAFYAVgBWAFYAVgBWAFYAVgBWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAEQAWAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAaAB4AKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAGAARABEAGAAYABMAEwAWABEAFAArACsAKwArACsAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACUAJQAlACUAJQAWABEAFgARABYAEQAWABEAFgARABYAEQAlACUAFgARACUAJQAlACUAJQAlACUAEQAlABEAKwAVABUAEwATACUAFgARABYAEQAWABEAJQAlACUAJQAlACUAJQAlACsAJQAbABoAJQArACsAKwArAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAcAKwATACUAJQAbABoAJQAlABYAEQAlACUAEQAlABEAJQBXAFcAVwBXAFcAVwBXAFcAVwBXABUAFQAlACUAJQATACUAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXABYAJQARACUAJQAlAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAWACUAEQAlABYAEQARABYAEQARABUAVwBRAFEAUQBRAFEAUQBRAFEAUQBRAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAEcARwArACsAVwBXAFcAVwBXAFcAKwArAFcAVwBXAFcAVwBXACsAKwBXAFcAVwBXAFcAVwArACsAVwBXAFcAKwArACsAGgAbACUAJQAlABsAGwArAB4AHgAeAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwAEAAQABAAQAB0AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsADQANAA0AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAA0AUABQAFAAUAArACsAKwArAFAAUABQAFAAUABQAFAAUAANAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwArAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwBQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwANAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAB4AUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAUABQAFAAUABQAAQABAAEACsABAAEACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAKwBQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAA0ADQANAA0ADQANAA0ADQAeACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAArACsAKwArAFAAUABQAFAAUAANAA0ADQANAA0ADQAUACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsADQANAA0ADQANAA0ADQBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAB4AHgAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArAAQABAANACsAKwBQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAB4AHgAeAB4AHgArACsAKwArACsAKwAEAAQABAAEAAQABAAEAA0ADQAeAB4AHgAeAB4AKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwAeACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEACsASwBLAEsASwBLAEsASwBLAEsASwANAA0ADQANAFAABAAEAFAAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAeAA4AUAArACsAKwArACsAKwArACsAKwAEAFAAUABQAFAADQANAB4ADQAEAAQABAAEAB4ABAAEAEsASwBLAEsASwBLAEsASwBLAEsAUAAOAFAADQANAA0AKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAANAA0AHgANAA0AHgAEACsAUABQAFAAUABQAFAAUAArAFAAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAA0AKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsABAAEAAQABAArAFAAUABQAFAAUABQAFAAUAArACsAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQACsABAAEAFAABAAEAAQABAAEAAQABAArACsABAAEACsAKwAEAAQABAArACsAUAArACsAKwArACsAKwAEACsAKwArACsAKwBQAFAAUABQAFAABAAEACsAKwAEAAQABAAEAAQABAAEACsAKwArAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsABAAEAAQABAAEAAQABABQAFAAUABQAA0ADQANAA0AHgBLAEsASwBLAEsASwBLAEsASwBLAA0ADQArAB4ABABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAFAAUAAeAFAAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABAAEAAQADgANAA0AEwATAB4AHgAeAA0ADQANAA0ADQANAA0ADQANAA0ADQANAA0ADQANAFAAUABQAFAABAAEACsAKwAEAA0ADQAeAFAAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAFAAKwArACsAKwArACsAKwBLAEsASwBLAEsASwBLAEsASwBLACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAXABcAFwAKwArACoAKgAqACoAKgAqACoAKgAqACoAKgAqACoAKgAqACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBcAFwADQANAA0AKgBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAKwArAFAAKwArAFAAUABQAFAAUABQAFAAUAArAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQAKwAEAAQAKwArAAQABAAEAAQAUAAEAFAABAAEAA0ADQANACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAArACsABAAEAAQABAAEAAQABABQAA4AUAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAABAAEAAQABAAEAAQABAAEAAQABABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAFAABAAEAAQABAAOAB4ADQANAA0ADQAOAB4ABAArACsAKwArACsAKwArACsAUAAEAAQABAAEAAQABAAEAAQABAAEAAQAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAA0ADQANAFAADgAOAA4ADQANACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAEAAQABAAEACsABAAEAAQABAAEAAQABAAEAFAADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAOABMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQACsAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAArACsAKwAEACsABAAEACsABAAEAAQABAAEAAQABABQAAQAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAUABQAFAAUABQAFAAKwBQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAUAArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAABAAEAAQABAAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAaABoAGgAaAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArAA0AUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsADQANAA0ADQANACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABIAEgAQwBDAEMAUABQAFAAUABDAFAAUABQAEgAQwBIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAASABDAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwAJAAkACQAJAAkACQAJABYAEQArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABIAEMAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwANAA0AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArAAQABAAEAAQABAANACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEAA0ADQANAB4AHgAeAB4AHgAeAFAAUABQAFAADQAeACsAKwArACsAKwArACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAANAA0AHgAeACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwAEAFAABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwAEAAQABAAEAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAARwBHABUARwAJACsAKwArACsAKwArACsAKwArACsAKwAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUQBRAFEAKwArACsAKwArACsAKwArACsAKwArACsAKwBRAFEAUQBRACsAKwArACsAKwArACsAKwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUAArACsAHgAEAAQADQAEAAQABAAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAAQABAAEAAQABAAeAB4AHgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAB4AHgAEAAQABAAEAAQABAAEAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4ABAAEAAQAHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwArACsAKwArACsAKwArACsAKwArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAKwArAFAAKwArAFAAUAArACsAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACsAUAArAFAAUABQAFAAUABQAFAAKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwBQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAHgAeAFAAUABQAFAAUAArAFAAKwArACsAUABQAFAAUABQAFAAUAArAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAB4AHgAeAB4AHgAeAB4AHgAeACsAKwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAEsASwBLAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAeAB4AHgAeAB4AHgAeAB4ABAAeAB4AHgAeAB4AHgAeAB4AHgAeAAQAHgAeAA0ADQANAA0AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQAKwAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArAAQABAAEAAQABAAEAAQAKwAEAAQAKwAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwAEAAQABAAEAAQABAAEAFAAUABQAFAAUABQAFAAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwBQAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArABsAUABQAFAAUABQACsAKwBQAFAAUABQAFAAUABQAFAAUAAEAAQABAAEAAQABAAEACsAKwArACsAKwArACsAKwArAB4AHgAeAB4ABAAEAAQABAAEAAQABABQACsAKwArACsASwBLAEsASwBLAEsASwBLAEsASwArACsAKwArABYAFgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAGgBQAFAAUAAaAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAeAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQACsAKwBQAFAAUABQACsAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUAArACsAKwArACsAKwBQACsAKwArACsAUAArAFAAKwBQACsAUABQAFAAKwBQAFAAKwBQACsAKwBQACsAUAArAFAAKwBQACsAUAArAFAAUAArAFAAKwArAFAAUABQAFAAKwBQAFAAUABQAFAAUABQACsAUABQAFAAUAArAFAAUABQAFAAKwBQACsAUABQAFAAUABQAFAAUABQAFAAUAArAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAArACsAKwArACsAUABQAFAAKwBQAFAAUABQAFAAKwBQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwAeAB4AKwArACsAKwArACsAKwArACsAKwArACsAKwArAE8ATwBPAE8ATwBPAE8ATwBPAE8ATwBPAE8AJQAlACUAHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHgAeAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB4AHgAeACUAJQAlAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAdAB0AHQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAKQApACkAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAlACUAJQAlACUAHgAlACUAJQAlACUAIAAgACAAJQAlACAAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACEAIQAhACEAIQAlACUAIAAgACUAJQAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlACUAIAAlACUAJQAlACAAIAAgACUAIAAgACAAJQAlACUAJQAlACUAJQAgACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAlAB4AJQAeACUAJQAlACUAJQAgACUAJQAlACUAHgAlAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAgACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACAAIAAgACAAIAAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeABcAFwAXABUAFQAVAB4AHgAeAB4AJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAgACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlACUAJQAeAB4AHgAeAB4AHgAeAB4AHgAeACUAJQAlACUAJQAlAB4AHgAeAB4AHgAeAB4AHgAlACUAJQAlACUAJQAlACUAHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAgACUAJQAgACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAJQAlACUAJQAlACUAIAAlACUAJQAlACUAJQAlACUAJQAgACAAIAAgACAAIAAgACAAIAAgACUAJQAgACAAIAAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACAAIAAlACAAIAAlACAAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAgACAAIAAlACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAJQAlAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AKwAeAB4AHgAeAB4AHgAeAB4AHgAeAB4AHgArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAEsASwBLAEsASwBLAEsASwBLAEsAKwArACsAKwArACsAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwArAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwAlACUAJQAlACUAJQAlACUAJQAlACUAVwBXACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQBXAFcAVwBXAFcAVwBXAFcAVwBXAFcAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAJQAlACUAKwAEACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArACsAKwArAA=="),Ie=[ue,me],Fe=[D,U,R,N],ke=[H,Q],Pe=[se,ae],Me=Fe.concat(ke),Oe=[ye,_e,ve,fe,pe],Le=[Z,W],De=function(e,t){void 0===t&&(t="strict");var r=[],n=[],i=[];return e.forEach(function(e,o){var a=Te.get(e);if(a>L?(i.push(!0),a-=L):i.push(!1),-1!==["normal","auto","loose"].indexOf(t)&&-1!==[8208,8211,12316,12448].indexOf(e))return n.push(o),r.push(X);if(a===z||a===G){if(0===o)return n.push(o),r.push(ue);var s=r[o-1];return-1===Me.indexOf(s)?(n.push(n[o-1]),r.push(s)):(n.push(o),r.push(ue))}return n.push(o),a===de?r.push("strict"===t?te:ge):a===we||a===ce?r.push(ue):a===be?e>=131072&&e<=196605||e>=196608&&e<=262141?r.push(ge):r.push(ue):void r.push(a)}),[n,r,i]},Ue=function(e,t,r,n){var i=n[r];if(Array.isArray(e)?-1!==e.indexOf(i):e===i)for(var o=r;o<=n.length;){if((l=n[++o])===t)return!0;if(l!==H)break}if(i===H)for(o=r;o>0;){var a=n[--o];if(Array.isArray(e)?-1!==e.indexOf(a):e===a)for(var s=r;s<=n.length;){var l;if((l=n[++s])===t)return!0;if(l!==H)break}if(a!==H)break}return!1},Re=function(e,t){for(var r=e;r>=0;){var n=t[r];if(n!==H)return n;r--}return 0},ze=function(e,t,r,n,i){if(0===r[n])return Ee;var o=n-1;if(Array.isArray(i)&&!0===i[o])return Ee;var a=o-1,s=o+1,l=t[o],c=a>=0?t[a]:0,u=t[s];if(l===U&&u===R)return Ee;if(-1!==Fe.indexOf(l))return Ce;if(-1!==Fe.indexOf(u))return Ee;if(-1!==ke.indexOf(u))return Ee;if(Re(o,t)===Q)return Se;if(Te.get(e[o])===G)return Ee;if((l===he||l===Ae)&&Te.get(e[s])===G)return Ee;if(l===j||u===j)return Ee;if(l===V)return Ee;if(-1===[H,W,Z].indexOf(l)&&u===V)return Ee;if(-1!==[Y,J,$,ie,le].indexOf(u))return Ee;if(Re(o,t)===re)return Ee;if(Ue(ne,re,o,t))return Ee;if(Ue([Y,J],te,o,t))return Ee;if(Ue(K,K,o,t))return Ee;if(l===H)return Se;if(l===ne||u===ne)return Ee;if(u===X||l===X)return Se;if(-1!==[W,Z,te].indexOf(u)||l===q)return Ee;if(c===me&&-1!==Le.indexOf(l))return Ee;if(l===le&&u===me)return Ee;if(u===ee)return Ee;if(-1!==Ie.indexOf(u)&&l===oe||-1!==Ie.indexOf(l)&&u===oe)return Ee;if(l===se&&-1!==[ge,he,Ae].indexOf(u)||-1!==[ge,he,Ae].indexOf(l)&&u===ae)return Ee;if(-1!==Ie.indexOf(l)&&-1!==Pe.indexOf(u)||-1!==Pe.indexOf(l)&&-1!==Ie.indexOf(u))return Ee;if(-1!==[se,ae].indexOf(l)&&(u===oe||-1!==[re,Z].indexOf(u)&&t[s+1]===oe)||-1!==[re,Z].indexOf(l)&&u===oe||l===oe&&-1!==[oe,le,ie].indexOf(u))return Ee;if(-1!==[oe,le,ie,Y,J].indexOf(u))for(var d=o;d>=0;){if((h=t[d])===oe)return Ee;if(-1===[le,ie].indexOf(h))break;d--}if(-1!==[se,ae].indexOf(u))for(d=-1!==[Y,J].indexOf(l)?a:o;d>=0;){var h;if((h=t[d])===oe)return Ee;if(-1===[le,ie].indexOf(h))break;d--}if(ye===l&&-1!==[ye,_e,fe,pe].indexOf(u)||-1!==[_e,fe].indexOf(l)&&-1!==[_e,ve].indexOf(u)||-1!==[ve,pe].indexOf(l)&&u===ve)return Ee;if(-1!==Oe.indexOf(l)&&-1!==[ee,ae].indexOf(u)||-1!==Oe.indexOf(u)&&l===se)return Ee;if(-1!==Ie.indexOf(l)&&-1!==Ie.indexOf(u))return Ee;if(l===ie&&-1!==Ie.indexOf(u))return Ee;if(-1!==Ie.concat(oe).indexOf(l)&&u===re&&-1===Be.indexOf(e[s])||-1!==Ie.concat(oe).indexOf(u)&&l===J)return Ee;if(l===xe&&u===xe){for(var A=r[o],f=1;A>0&&t[--A]===xe;)f++;if(f%2!==0)return Ee}return l===he&&u===Ae?Ee:Se},Ne=function(e,t){t||(t={lineBreak:"normal",wordBreak:"normal"});var r=De(e,t.lineBreak),n=r[0],i=r[1],o=r[2];"break-all"!==t.wordBreak&&"break-word"!==t.wordBreak||(i=i.map(function(e){return-1!==[oe,ue,we].indexOf(e)?ge:e}));var a="keep-all"===t.wordBreak?o.map(function(t,r){return t&&e[r]>=19968&&e[r]<=40959}):void 0;return[n,i,a]},je=function(){function e(e,t,r,n){this.codePoints=e,this.required=t===Ce,this.start=r,this.end=n}return e.prototype.slice=function(){return u.apply(void 0,this.codePoints.slice(this.start,this.end))},e}(),Qe=function(e,t){var r=c(e),n=Ne(r,t),i=n[0],o=n[1],a=n[2],s=r.length,l=0,u=0;return{next:function(){if(u>=s)return{done:!0,value:null};for(var e=Ee;u<s&&(e=ze(r,o,i,++u,a))===Ee;);if(e!==Ee||u===s){var t=new je(r,e,l,u);return l=u,{value:t,done:!1}}return{done:!0,value:null}}}},Ve=1,He=2,Ge=4,Ke=8,We=10,qe=47,Ze=92,Xe=9,Ye=32,Je=34,$e=61,et=35,tt=36,rt=37,nt=39,it=40,ot=41,at=95,st=45,lt=33,ct=60,ut=62,dt=64,ht=91,At=93,ft=61,pt=123,mt=63,gt=125,yt=124,_t=126,vt=128,xt=65533,wt=42,bt=43,Bt=44,Ct=58,Et=59,St=46,Tt=0,It=8,Ft=11,kt=14,Pt=31,Mt=127,Ot=-1,Lt=48,Dt=97,Ut=101,Rt=102,zt=117,Nt=122,jt=65,Qt=69,Vt=70,Ht=85,Gt=90,Kt=function(e){return e>=Lt&&e<=57},Wt=function(e){return e>=55296&&e<=57343},qt=function(e){return Kt(e)||e>=jt&&e<=Vt||e>=Dt&&e<=Rt},Zt=function(e){return e>=Dt&&e<=Nt},Xt=function(e){return e>=jt&&e<=Gt},Yt=function(e){return Zt(e)||Xt(e)},Jt=function(e){return e>=vt},$t=function(e){return e===We||e===Xe||e===Ye},er=function(e){return Yt(e)||Jt(e)||e===at},tr=function(e){return er(e)||Kt(e)||e===st},rr=function(e){return e>=Tt&&e<=It||e===Ft||e>=kt&&e<=Pt||e===Mt},nr=function(e,t){return e===Ze&&t!==We},ir=function(e,t,r){return e===st?er(t)||nr(t,r):!!er(e)||!(e!==Ze||!nr(e,t))},or=function(e,t,r){return e===bt||e===st?!!Kt(t)||t===St&&Kt(r):Kt(e===St?t:e)},ar=function(e){var t=0,r=1;e[t]!==bt&&e[t]!==st||(e[t]===st&&(r=-1),t++);for(var n=[];Kt(e[t]);)n.push(e[t++]);var i=n.length?parseInt(u.apply(void 0,n),10):0;e[t]===St&&t++;for(var o=[];Kt(e[t]);)o.push(e[t++]);var a=o.length,s=a?parseInt(u.apply(void 0,o),10):0;e[t]!==Qt&&e[t]!==Ut||t++;var l=1;e[t]!==bt&&e[t]!==st||(e[t]===st&&(l=-1),t++);for(var c=[];Kt(e[t]);)c.push(e[t++]);var d=c.length?parseInt(u.apply(void 0,c),10):0;return r*(i+s*Math.pow(10,-a))*Math.pow(10,l*d)},sr={type:2},lr={type:3},cr={type:4},ur={type:13},dr={type:8},hr={type:21},Ar={type:9},fr={type:10},pr={type:11},mr={type:12},gr={type:14},yr={type:23},_r={type:1},vr={type:25},xr={type:24},wr={type:26},br={type:27},Br={type:28},Cr={type:29},Er={type:31},Sr={type:32},Tr=function(){function e(){this._value=[]}return e.prototype.write=function(e){this._value=this._value.concat(c(e))},e.prototype.read=function(){for(var e=[],t=this.consumeToken();t!==Sr;)e.push(t),t=this.consumeToken();return e},e.prototype.consumeToken=function(){var e=this.consumeCodePoint();switch(e){case Je:return this.consumeStringToken(Je);case et:var t=this.peekCodePoint(0),r=this.peekCodePoint(1),n=this.peekCodePoint(2);if(tr(t)||nr(r,n)){var i=ir(t,r,n)?He:Ve;return{type:5,value:this.consumeName(),flags:i}}break;case tt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),ur;break;case nt:return this.consumeStringToken(nt);case it:return sr;case ot:return lr;case wt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),gr;break;case bt:if(or(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case Bt:return cr;case st:var o=e,a=this.peekCodePoint(0),s=this.peekCodePoint(1);if(or(o,a,s))return this.reconsumeCodePoint(e),this.consumeNumericToken();if(ir(o,a,s))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();if(a===st&&s===ut)return this.consumeCodePoint(),this.consumeCodePoint(),xr;break;case St:if(or(e,this.peekCodePoint(0),this.peekCodePoint(1)))return this.reconsumeCodePoint(e),this.consumeNumericToken();break;case qe:if(this.peekCodePoint(0)===wt)for(this.consumeCodePoint();;){var l=this.consumeCodePoint();if(l===wt&&(l=this.consumeCodePoint())===qe)return this.consumeToken();if(l===Ot)return this.consumeToken()}break;case Ct:return wr;case Et:return br;case ct:if(this.peekCodePoint(0)===lt&&this.peekCodePoint(1)===st&&this.peekCodePoint(2)===st)return this.consumeCodePoint(),this.consumeCodePoint(),vr;break;case dt:var c=this.peekCodePoint(0),d=this.peekCodePoint(1),h=this.peekCodePoint(2);if(ir(c,d,h))return{type:7,value:this.consumeName()};break;case ht:return Br;case Ze:if(nr(e,this.peekCodePoint(0)))return this.reconsumeCodePoint(e),this.consumeIdentLikeToken();break;case At:return Cr;case ft:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),dr;break;case pt:return pr;case gt:return mr;case zt:case Ht:var A=this.peekCodePoint(0),f=this.peekCodePoint(1);return A!==bt||!qt(f)&&f!==mt||(this.consumeCodePoint(),this.consumeUnicodeRangeToken()),this.reconsumeCodePoint(e),this.consumeIdentLikeToken();case yt:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),Ar;if(this.peekCodePoint(0)===yt)return this.consumeCodePoint(),hr;break;case _t:if(this.peekCodePoint(0)===$e)return this.consumeCodePoint(),fr;break;case Ot:return Sr}return $t(e)?(this.consumeWhiteSpace(),Er):Kt(e)?(this.reconsumeCodePoint(e),this.consumeNumericToken()):er(e)?(this.reconsumeCodePoint(e),this.consumeIdentLikeToken()):{type:6,value:u(e)}},e.prototype.consumeCodePoint=function(){var e=this._value.shift();return"undefined"===typeof e?-1:e},e.prototype.reconsumeCodePoint=function(e){this._value.unshift(e)},e.prototype.peekCodePoint=function(e){return e>=this._value.length?-1:this._value[e]},e.prototype.consumeUnicodeRangeToken=function(){for(var e=[],t=this.consumeCodePoint();qt(t)&&e.length<6;)e.push(t),t=this.consumeCodePoint();for(var r=!1;t===mt&&e.length<6;)e.push(t),t=this.consumeCodePoint(),r=!0;if(r)return{type:30,start:parseInt(u.apply(void 0,e.map(function(e){return e===mt?Lt:e})),16),end:parseInt(u.apply(void 0,e.map(function(e){return e===mt?Vt:e})),16)};var n=parseInt(u.apply(void 0,e),16);if(this.peekCodePoint(0)===st&&qt(this.peekCodePoint(1))){this.consumeCodePoint(),t=this.consumeCodePoint();for(var i=[];qt(t)&&i.length<6;)i.push(t),t=this.consumeCodePoint();return{type:30,start:n,end:parseInt(u.apply(void 0,i),16)}}return{type:30,start:n,end:n}},e.prototype.consumeIdentLikeToken=function(){var e=this.consumeName();return"url"===e.toLowerCase()&&this.peekCodePoint(0)===it?(this.consumeCodePoint(),this.consumeUrlToken()):this.peekCodePoint(0)===it?(this.consumeCodePoint(),{type:19,value:e}):{type:20,value:e}},e.prototype.consumeUrlToken=function(){var e=[];if(this.consumeWhiteSpace(),this.peekCodePoint(0)===Ot)return{type:22,value:""};var t=this.peekCodePoint(0);if(t===nt||t===Je){var r=this.consumeStringToken(this.consumeCodePoint());return 0===r.type&&(this.consumeWhiteSpace(),this.peekCodePoint(0)===Ot||this.peekCodePoint(0)===ot)?(this.consumeCodePoint(),{type:22,value:r.value}):(this.consumeBadUrlRemnants(),yr)}for(;;){var n=this.consumeCodePoint();if(n===Ot||n===ot)return{type:22,value:u.apply(void 0,e)};if($t(n))return this.consumeWhiteSpace(),this.peekCodePoint(0)===Ot||this.peekCodePoint(0)===ot?(this.consumeCodePoint(),{type:22,value:u.apply(void 0,e)}):(this.consumeBadUrlRemnants(),yr);if(n===Je||n===nt||n===it||rr(n))return this.consumeBadUrlRemnants(),yr;if(n===Ze){if(!nr(n,this.peekCodePoint(0)))return this.consumeBadUrlRemnants(),yr;e.push(this.consumeEscapedCodePoint())}else e.push(n)}},e.prototype.consumeWhiteSpace=function(){for(;$t(this.peekCodePoint(0));)this.consumeCodePoint()},e.prototype.consumeBadUrlRemnants=function(){for(;;){var e=this.consumeCodePoint();if(e===ot||e===Ot)return;nr(e,this.peekCodePoint(0))&&this.consumeEscapedCodePoint()}},e.prototype.consumeStringSlice=function(e){for(var t=5e4,r="";e>0;){var n=Math.min(t,e);r+=u.apply(void 0,this._value.splice(0,n)),e-=n}return this._value.shift(),r},e.prototype.consumeStringToken=function(e){for(var t="",r=0;;){var n=this._value[r];if(n===Ot||void 0===n||n===e)return{type:0,value:t+=this.consumeStringSlice(r)};if(n===We)return this._value.splice(0,r),_r;if(n===Ze){var i=this._value[r+1];i!==Ot&&void 0!==i&&(i===We?(t+=this.consumeStringSlice(r),r=-1,this._value.shift()):nr(n,i)&&(t+=this.consumeStringSlice(r),t+=u(this.consumeEscapedCodePoint()),r=-1))}r++}},e.prototype.consumeNumber=function(){var e=[],t=Ge,r=this.peekCodePoint(0);for(r!==bt&&r!==st||e.push(this.consumeCodePoint());Kt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0);var n=this.peekCodePoint(1);if(r===St&&Kt(n))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=Ke;Kt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());r=this.peekCodePoint(0),n=this.peekCodePoint(1);var i=this.peekCodePoint(2);if((r===Qt||r===Ut)&&((n===bt||n===st)&&Kt(i)||Kt(n)))for(e.push(this.consumeCodePoint(),this.consumeCodePoint()),t=Ke;Kt(this.peekCodePoint(0));)e.push(this.consumeCodePoint());return[ar(e),t]},e.prototype.consumeNumericToken=function(){var e=this.consumeNumber(),t=e[0],r=e[1],n=this.peekCodePoint(0),i=this.peekCodePoint(1),o=this.peekCodePoint(2);return ir(n,i,o)?{type:15,number:t,flags:r,unit:this.consumeName()}:n===rt?(this.consumeCodePoint(),{type:16,number:t,flags:r}):{type:17,number:t,flags:r}},e.prototype.consumeEscapedCodePoint=function(){var e=this.consumeCodePoint();if(qt(e)){for(var t=u(e);qt(this.peekCodePoint(0))&&t.length<6;)t+=u(this.consumeCodePoint());$t(this.peekCodePoint(0))&&this.consumeCodePoint();var r=parseInt(t,16);return 0===r||Wt(r)||r>1114111?xt:r}return e===Ot?xt:e},e.prototype.consumeName=function(){for(var e="";;){var t=this.consumeCodePoint();if(tr(t))e+=u(t);else{if(!nr(t,this.peekCodePoint(0)))return this.reconsumeCodePoint(t),e;e+=u(this.consumeEscapedCodePoint())}}},e}(),Ir=function(){function e(e){this._tokens=e}return e.create=function(t){var r=new Tr;return r.write(t),new e(r.read())},e.parseValue=function(t){return e.create(t).parseComponentValue()},e.parseValues=function(t){return e.create(t).parseComponentValues()},e.prototype.parseComponentValue=function(){for(var e=this.consumeToken();31===e.type;)e=this.consumeToken();if(32===e.type)throw new SyntaxError("Error parsing CSS component value, unexpected EOF");this.reconsumeToken(e);var t=this.consumeComponentValue();do{e=this.consumeToken()}while(31===e.type);if(32===e.type)return t;throw new SyntaxError("Error parsing CSS component value, multiple values found when expecting only one")},e.prototype.parseComponentValues=function(){for(var e=[];;){var t=this.consumeComponentValue();if(32===t.type)return e;e.push(t),e.push()}},e.prototype.consumeComponentValue=function(){var e=this.consumeToken();switch(e.type){case 11:case 28:case 2:return this.consumeSimpleBlock(e.type);case 19:return this.consumeFunction(e)}return e},e.prototype.consumeSimpleBlock=function(e){for(var t={type:e,values:[]},r=this.consumeToken();;){if(32===r.type||Rr(r,e))return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue()),r=this.consumeToken()}},e.prototype.consumeFunction=function(e){for(var t={name:e.value,values:[],type:18};;){var r=this.consumeToken();if(32===r.type||3===r.type)return t;this.reconsumeToken(r),t.values.push(this.consumeComponentValue())}},e.prototype.consumeToken=function(){var e=this._tokens.shift();return"undefined"===typeof e?Sr:e},e.prototype.reconsumeToken=function(e){this._tokens.unshift(e)},e}(),Fr=function(e){return 15===e.type},kr=function(e){return 17===e.type},Pr=function(e){return 20===e.type},Mr=function(e){return 0===e.type},Or=function(e,t){return Pr(e)&&e.value===t},Lr=function(e){return 31!==e.type},Dr=function(e){return 31!==e.type&&4!==e.type},Ur=function(e){var t=[],r=[];return e.forEach(function(e){if(4===e.type){if(0===r.length)throw new Error("Error parsing function args, zero tokens for arg");return t.push(r),void(r=[])}31!==e.type&&r.push(e)}),r.length&&t.push(r),t},Rr=function(e,t){return 11===t&&12===e.type||28===t&&29===e.type||2===t&&3===e.type},zr=function(e){return 17===e.type||15===e.type},Nr=function(e){return 16===e.type||zr(e)},jr=function(e){return e.length>1?[e[0],e[1]]:[e[0]]},Qr={type:17,number:0,flags:Ge},Vr={type:16,number:50,flags:Ge},Hr={type:16,number:100,flags:Ge},Gr=function(e,t,r){var n=e[0],i=e[1];return[Kr(n,t),Kr("undefined"!==typeof i?i:n,r)]},Kr=function(e,t){if(16===e.type)return e.number/100*t;if(Fr(e))switch(e.unit){case"rem":case"em":return 16*e.number;default:return e.number}return e.number},Wr="deg",qr="grad",Zr="rad",Xr="turn",Yr={name:"angle",parse:function(e,t){if(15===t.type)switch(t.unit){case Wr:return Math.PI*t.number/180;case qr:return Math.PI/200*t.number;case Zr:return t.number;case Xr:return 2*Math.PI*t.number}throw new Error("Unsupported angle type")}},Jr=function(e){return 15===e.type&&(e.unit===Wr||e.unit===qr||e.unit===Zr||e.unit===Xr)},$r=function(e){switch(e.filter(Pr).map(function(e){return e.value}).join(" ")){case"to bottom right":case"to right bottom":case"left top":case"top left":return[Qr,Qr];case"to top":case"bottom":return en(0);case"to bottom left":case"to left bottom":case"right top":case"top right":return[Qr,Hr];case"to right":case"left":return en(90);case"to top left":case"to left top":case"right bottom":case"bottom right":return[Hr,Hr];case"to bottom":case"top":return en(180);case"to top right":case"to right top":case"left bottom":case"bottom left":return[Hr,Qr];case"to left":case"right":return en(270)}return 0},en=function(e){return Math.PI*e/180},tn={name:"color",parse:function(e,t){if(18===t.type){var r=un[t.name];if("undefined"===typeof r)throw new Error('Attempting to parse an unsupported color function "'+t.name+'"');return r(e,t.values)}if(5===t.type){if(3===t.value.length){var n=t.value.substring(0,1),i=t.value.substring(1,2),o=t.value.substring(2,3);return on(parseInt(n+n,16),parseInt(i+i,16),parseInt(o+o,16),1)}if(4===t.value.length){n=t.value.substring(0,1),i=t.value.substring(1,2),o=t.value.substring(2,3);var a=t.value.substring(3,4);return on(parseInt(n+n,16),parseInt(i+i,16),parseInt(o+o,16),parseInt(a+a,16)/255)}if(6===t.value.length)return n=t.value.substring(0,2),i=t.value.substring(2,4),o=t.value.substring(4,6),on(parseInt(n,16),parseInt(i,16),parseInt(o,16),1);if(8===t.value.length)return n=t.value.substring(0,2),i=t.value.substring(2,4),o=t.value.substring(4,6),a=t.value.substring(6,8),on(parseInt(n,16),parseInt(i,16),parseInt(o,16),parseInt(a,16)/255)}if(20===t.type){var s=hn[t.value.toUpperCase()];if("undefined"!==typeof s)return s}return hn.TRANSPARENT}},rn=function(e){return 0===(255&e)},nn=function(e){var t=255&e,r=255&e>>8,n=255&e>>16,i=255&e>>24;return t<255?"rgba("+i+","+n+","+r+","+t/255+")":"rgb("+i+","+n+","+r+")"},on=function(e,t,r,n){return(e<<24|t<<16|r<<8|Math.round(255*n))>>>0},an=function(e,t){if(17===e.type)return e.number;if(16===e.type){var r=3===t?1:255;return 3===t?e.number/100*r:Math.round(e.number/100*r)}return 0},sn=function(e,t){var r=t.filter(Dr);if(3===r.length){var n=r.map(an),i=n[0],o=n[1],a=n[2];return on(i,o,a,1)}if(4===r.length){var s=r.map(an),l=(i=s[0],o=s[1],a=s[2],s[3]);return on(i,o,a,l)}return 0};function ln(e,t,r){return r<0&&(r+=1),r>=1&&(r-=1),r<1/6?(t-e)*r*6+e:r<.5?t:r<2/3?6*(t-e)*(2/3-r)+e:e}var cn=function(e,t){var r=t.filter(Dr),n=r[0],i=r[1],o=r[2],a=r[3],s=(17===n.type?en(n.number):Yr.parse(e,n))/(2*Math.PI),l=Nr(i)?i.number/100:0,c=Nr(o)?o.number/100:0,u="undefined"!==typeof a&&Nr(a)?Kr(a,1):1;if(0===l)return on(255*c,255*c,255*c,1);var d=c<=.5?c*(l+1):c+l-c*l,h=2*c-d,A=ln(h,d,s+1/3),f=ln(h,d,s),p=ln(h,d,s-1/3);return on(255*A,255*f,255*p,u)},un={hsl:cn,hsla:cn,rgb:sn,rgba:sn},dn=function(e,t){return tn.parse(e,Ir.create(t).parseComponentValue())},hn={ALICEBLUE:4042850303,ANTIQUEWHITE:4209760255,AQUA:16777215,AQUAMARINE:2147472639,AZURE:4043309055,BEIGE:4126530815,BISQUE:4293182719,BLACK:255,BLANCHEDALMOND:4293643775,BLUE:65535,BLUEVIOLET:2318131967,BROWN:2771004159,BURLYWOOD:3736635391,CADETBLUE:1604231423,CHARTREUSE:2147418367,CHOCOLATE:3530104575,CORAL:4286533887,CORNFLOWERBLUE:1687547391,CORNSILK:4294499583,CRIMSON:3692313855,CYAN:16777215,DARKBLUE:35839,DARKCYAN:9145343,DARKGOLDENROD:3095837695,DARKGRAY:2846468607,DARKGREEN:6553855,DARKGREY:2846468607,DARKKHAKI:3182914559,DARKMAGENTA:2332068863,DARKOLIVEGREEN:1433087999,DARKORANGE:4287365375,DARKORCHID:2570243327,DARKRED:2332033279,DARKSALMON:3918953215,DARKSEAGREEN:2411499519,DARKSLATEBLUE:1211993087,DARKSLATEGRAY:793726975,DARKSLATEGREY:793726975,DARKTURQUOISE:13554175,DARKVIOLET:2483082239,DEEPPINK:4279538687,DEEPSKYBLUE:12582911,DIMGRAY:1768516095,DIMGREY:1768516095,DODGERBLUE:512819199,FIREBRICK:2988581631,FLORALWHITE:4294635775,FORESTGREEN:579543807,FUCHSIA:4278255615,GAINSBORO:3705462015,GHOSTWHITE:4177068031,GOLD:4292280575,GOLDENROD:3668254975,GRAY:2155905279,GREEN:8388863,GREENYELLOW:2919182335,GREY:2155905279,HONEYDEW:4043305215,HOTPINK:4285117695,INDIANRED:3445382399,INDIGO:1258324735,IVORY:4294963455,KHAKI:4041641215,LAVENDER:3873897215,LAVENDERBLUSH:4293981695,LAWNGREEN:2096890111,LEMONCHIFFON:4294626815,LIGHTBLUE:2916673279,LIGHTCORAL:4034953471,LIGHTCYAN:3774873599,LIGHTGOLDENRODYELLOW:4210742015,LIGHTGRAY:3553874943,LIGHTGREEN:2431553791,LIGHTGREY:3553874943,LIGHTPINK:4290167295,LIGHTSALMON:4288707327,LIGHTSEAGREEN:548580095,LIGHTSKYBLUE:2278488831,LIGHTSLATEGRAY:2005441023,LIGHTSLATEGREY:2005441023,LIGHTSTEELBLUE:2965692159,LIGHTYELLOW:4294959359,LIME:16711935,LIMEGREEN:852308735,LINEN:4210091775,MAGENTA:4278255615,MAROON:2147483903,MEDIUMAQUAMARINE:1724754687,MEDIUMBLUE:52735,MEDIUMORCHID:3126187007,MEDIUMPURPLE:2473647103,MEDIUMSEAGREEN:1018393087,MEDIUMSLATEBLUE:2070474495,MEDIUMSPRINGGREEN:16423679,MEDIUMTURQUOISE:1221709055,MEDIUMVIOLETRED:3340076543,MIDNIGHTBLUE:421097727,MINTCREAM:4127193855,MISTYROSE:4293190143,MOCCASIN:4293178879,NAVAJOWHITE:4292783615,NAVY:33023,OLDLACE:4260751103,OLIVE:2155872511,OLIVEDRAB:1804477439,ORANGE:4289003775,ORANGERED:4282712319,ORCHID:3664828159,PALEGOLDENROD:4008225535,PALEGREEN:2566625535,PALETURQUOISE:2951671551,PALEVIOLETRED:3681588223,PAPAYAWHIP:4293907967,PEACHPUFF:4292524543,PERU:3448061951,PINK:4290825215,PLUM:3718307327,POWDERBLUE:2967529215,PURPLE:2147516671,REBECCAPURPLE:1714657791,RED:4278190335,ROSYBROWN:3163525119,ROYALBLUE:1097458175,SADDLEBROWN:2336560127,SALMON:4202722047,SANDYBROWN:4104413439,SEAGREEN:780883967,SEASHELL:4294307583,SIENNA:2689740287,SILVER:3233857791,SKYBLUE:2278484991,SLATEBLUE:1784335871,SLATEGRAY:1887473919,SLATEGREY:1887473919,SNOW:4294638335,SPRINGGREEN:16744447,STEELBLUE:1182971135,TAN:3535047935,TEAL:8421631,THISTLE:3636451583,TOMATO:4284696575,TRANSPARENT:0,TURQUOISE:1088475391,VIOLET:4001558271,WHEAT:4125012991,WHITE:4294967295,WHITESMOKE:4126537215,YELLOW:4294902015,YELLOWGREEN:2597139199},An={name:"background-clip",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map(function(e){if(Pr(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},fn={name:"background-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},pn=function(e,t){var r=tn.parse(e,t[0]),n=t[1];return n&&Nr(n)?{color:r,stop:n}:{color:r,stop:null}},mn=function(e,t){var r=e[0],n=e[e.length-1];null===r.stop&&(r.stop=Qr),null===n.stop&&(n.stop=Hr);for(var i=[],o=0,a=0;a<e.length;a++){var s=e[a].stop;if(null!==s){var l=Kr(s,t);l>o?i.push(l):i.push(o),o=l}else i.push(null)}var c=null;for(a=0;a<i.length;a++){var u=i[a];if(null===u)null===c&&(c=a);else if(null!==c){for(var d=a-c,h=(u-i[c-1])/(d+1),A=1;A<=d;A++)i[c+A-1]=h*A;c=null}}return e.map(function(e,r){return{color:e.color,stop:Math.max(Math.min(1,i[r]/t),0)}})},gn=function(e,t,r){var n=t/2,i=r/2,o=Kr(e[0],t)-n,a=i-Kr(e[1],r);return(Math.atan2(a,o)+2*Math.PI)%(2*Math.PI)},yn=function(e,t,r){var n="number"===typeof e?e:gn(e,t,r),i=Math.abs(t*Math.sin(n))+Math.abs(r*Math.cos(n)),o=t/2,a=r/2,s=i/2,l=Math.sin(n-Math.PI/2)*s,c=Math.cos(n-Math.PI/2)*s;return[i,o-c,o+c,a-l,a+l]},_n=function(e,t){return Math.sqrt(e*e+t*t)},vn=function(e,t,r,n,i){return[[0,0],[0,t],[e,0],[e,t]].reduce(function(e,t){var o=t[0],a=t[1],s=_n(r-o,n-a);return(i?s<e.optimumDistance:s>e.optimumDistance)?{optimumCorner:t,optimumDistance:s}:e},{optimumDistance:i?1/0:-1/0,optimumCorner:null}).optimumCorner},xn=function(e,t,r,n,i){var o=0,a=0;switch(e.size){case 0:0===e.shape?o=a=Math.min(Math.abs(t),Math.abs(t-n),Math.abs(r),Math.abs(r-i)):1===e.shape&&(o=Math.min(Math.abs(t),Math.abs(t-n)),a=Math.min(Math.abs(r),Math.abs(r-i)));break;case 2:if(0===e.shape)o=a=Math.min(_n(t,r),_n(t,r-i),_n(t-n,r),_n(t-n,r-i));else if(1===e.shape){var s=Math.min(Math.abs(r),Math.abs(r-i))/Math.min(Math.abs(t),Math.abs(t-n)),l=vn(n,i,t,r,!0),c=l[0],u=l[1];a=s*(o=_n(c-t,(u-r)/s))}break;case 1:0===e.shape?o=a=Math.max(Math.abs(t),Math.abs(t-n),Math.abs(r),Math.abs(r-i)):1===e.shape&&(o=Math.max(Math.abs(t),Math.abs(t-n)),a=Math.max(Math.abs(r),Math.abs(r-i)));break;case 3:if(0===e.shape)o=a=Math.max(_n(t,r),_n(t,r-i),_n(t-n,r),_n(t-n,r-i));else if(1===e.shape){s=Math.max(Math.abs(r),Math.abs(r-i))/Math.max(Math.abs(t),Math.abs(t-n));var d=vn(n,i,t,r,!1);c=d[0],u=d[1],a=s*(o=_n(c-t,(u-r)/s))}}return Array.isArray(e.size)&&(o=Kr(e.size[0],n),a=2===e.size.length?Kr(e.size[1],i):o),[o,a]},wn=function(e,t){var r=en(180),n=[];return Ur(t).forEach(function(t,i){if(0===i){var o=t[0];if(20===o.type&&-1!==["top","left","right","bottom"].indexOf(o.value))return void(r=$r(t));if(Jr(o))return void(r=(Yr.parse(e,o)+en(270))%en(360))}var a=pn(e,t);n.push(a)}),{angle:r,stops:n,type:1}},bn="closest-side",Bn="farthest-side",Cn="closest-corner",En="farthest-corner",Sn="circle",Tn="ellipse",In="cover",Fn="contain",kn=function(e,t){var r=0,n=3,i=[],o=[];return Ur(t).forEach(function(t,a){var s=!0;if(0===a?s=t.reduce(function(e,t){if(Pr(t))switch(t.value){case"center":return o.push(Vr),!1;case"top":case"left":return o.push(Qr),!1;case"right":case"bottom":return o.push(Hr),!1}else if(Nr(t)||zr(t))return o.push(t),!1;return e},s):1===a&&(s=t.reduce(function(e,t){if(Pr(t))switch(t.value){case Sn:return r=0,!1;case Tn:return r=1,!1;case Fn:case bn:return n=0,!1;case Bn:return n=1,!1;case Cn:return n=2,!1;case In:case En:return n=3,!1}else if(zr(t)||Nr(t))return Array.isArray(n)||(n=[]),n.push(t),!1;return e},s)),s){var l=pn(e,t);i.push(l)}}),{size:n,shape:r,stops:i,position:o,type:2}},Pn=function(e){return 1===e.type},Mn=function(e){return 2===e.type},On={name:"image",parse:function(e,t){if(22===t.type){var r={url:t.value,type:0};return e.cache.addImage(t.value),r}if(18===t.type){var n=Un[t.name];if("undefined"===typeof n)throw new Error('Attempting to parse an unsupported image function "'+t.name+'"');return n(e,t.values)}throw new Error("Unsupported image type "+t.type)}};function Ln(e){return!(20===e.type&&"none"===e.value)&&(18!==e.type||!!Un[e.name])}var Dn,Un={"linear-gradient":function(e,t){var r=en(180),n=[];return Ur(t).forEach(function(t,i){if(0===i){var o=t[0];if(20===o.type&&"to"===o.value)return void(r=$r(t));if(Jr(o))return void(r=Yr.parse(e,o))}var a=pn(e,t);n.push(a)}),{angle:r,stops:n,type:1}},"-moz-linear-gradient":wn,"-ms-linear-gradient":wn,"-o-linear-gradient":wn,"-webkit-linear-gradient":wn,"radial-gradient":function(e,t){var r=0,n=3,i=[],o=[];return Ur(t).forEach(function(t,a){var s=!0;if(0===a){var l=!1;s=t.reduce(function(e,t){if(l)if(Pr(t))switch(t.value){case"center":return o.push(Vr),e;case"top":case"left":return o.push(Qr),e;case"right":case"bottom":return o.push(Hr),e}else(Nr(t)||zr(t))&&o.push(t);else if(Pr(t))switch(t.value){case Sn:return r=0,!1;case Tn:return r=1,!1;case"at":return l=!0,!1;case bn:return n=0,!1;case In:case Bn:return n=1,!1;case Fn:case Cn:return n=2,!1;case En:return n=3,!1}else if(zr(t)||Nr(t))return Array.isArray(n)||(n=[]),n.push(t),!1;return e},s)}if(s){var c=pn(e,t);i.push(c)}}),{size:n,shape:r,stops:i,position:o,type:2}},"-moz-radial-gradient":kn,"-ms-radial-gradient":kn,"-o-radial-gradient":kn,"-webkit-radial-gradient":kn,"-webkit-gradient":function(e,t){var r=en(180),n=[],i=1,o=0,a=3,s=[];return Ur(t).forEach(function(t,r){var o=t[0];if(0===r){if(Pr(o)&&"linear"===o.value)return void(i=1);if(Pr(o)&&"radial"===o.value)return void(i=2)}if(18===o.type)if("from"===o.name){var a=tn.parse(e,o.values[0]);n.push({stop:Qr,color:a})}else if("to"===o.name)a=tn.parse(e,o.values[0]),n.push({stop:Hr,color:a});else if("color-stop"===o.name){var s=o.values.filter(Dr);if(2===s.length){a=tn.parse(e,s[1]);var l=s[0];kr(l)&&n.push({stop:{type:16,number:100*l.number,flags:l.flags},color:a})}}}),1===i?{angle:(r+en(180))%en(360),stops:n,type:i}:{size:a,shape:o,stops:n,position:s,type:i}}},Rn={name:"background-image",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var r=t[0];return 20===r.type&&"none"===r.value?[]:t.filter(function(e){return Dr(e)&&Ln(e)}).map(function(t){return On.parse(e,t)})}},zn={name:"background-origin",initialValue:"border-box",prefix:!1,type:1,parse:function(e,t){return t.map(function(e){if(Pr(e))switch(e.value){case"padding-box":return 1;case"content-box":return 2}return 0})}},Nn={name:"background-position",initialValue:"0% 0%",type:1,prefix:!1,parse:function(e,t){return Ur(t).map(function(e){return e.filter(Nr)}).map(jr)}},jn={name:"background-repeat",initialValue:"repeat",prefix:!1,type:1,parse:function(e,t){return Ur(t).map(function(e){return e.filter(Pr).map(function(e){return e.value}).join(" ")}).map(Qn)}},Qn=function(e){switch(e){case"no-repeat":return 1;case"repeat-x":case"repeat no-repeat":return 2;case"repeat-y":case"no-repeat repeat":return 3;default:return 0}};!function(e){e.AUTO="auto",e.CONTAIN="contain",e.COVER="cover"}(Dn||(Dn={}));var Vn,Hn={name:"background-size",initialValue:"0",prefix:!1,type:1,parse:function(e,t){return Ur(t).map(function(e){return e.filter(Gn)})}},Gn=function(e){return Pr(e)||Nr(e)},Kn=function(e){return{name:"border-"+e+"-color",initialValue:"transparent",prefix:!1,type:3,format:"color"}},Wn=Kn("top"),qn=Kn("right"),Zn=Kn("bottom"),Xn=Kn("left"),Yn=function(e){return{name:"border-radius-"+e,initialValue:"0 0",prefix:!1,type:1,parse:function(e,t){return jr(t.filter(Nr))}}},Jn=Yn("top-left"),$n=Yn("top-right"),ei=Yn("bottom-right"),ti=Yn("bottom-left"),ri=function(e){return{name:"border-"+e+"-style",initialValue:"solid",prefix:!1,type:2,parse:function(e,t){switch(t){case"none":return 0;case"dashed":return 2;case"dotted":return 3;case"double":return 4}return 1}}},ni=ri("top"),ii=ri("right"),oi=ri("bottom"),ai=ri("left"),si=function(e){return{name:"border-"+e+"-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Fr(t)?t.number:0}}},li=si("top"),ci=si("right"),ui=si("bottom"),di=si("left"),hi={name:"color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ai={name:"direction",initialValue:"ltr",prefix:!1,type:2,parse:function(e,t){return"rtl"===t?1:0}},fi={name:"display",initialValue:"inline-block",prefix:!1,type:1,parse:function(e,t){return t.filter(Pr).reduce(function(e,t){return e|pi(t.value)},0)}},pi=function(e){switch(e){case"block":case"-webkit-box":return 2;case"inline":return 4;case"run-in":return 8;case"flow":return 16;case"flow-root":return 32;case"table":return 64;case"flex":case"-webkit-flex":return 128;case"grid":case"-ms-grid":return 256;case"ruby":return 512;case"subgrid":return 1024;case"list-item":return 2048;case"table-row-group":return 4096;case"table-header-group":return 8192;case"table-footer-group":return 16384;case"table-row":return 32768;case"table-cell":return 65536;case"table-column-group":return 131072;case"table-column":return 262144;case"table-caption":return 524288;case"ruby-base":return 1048576;case"ruby-text":return 2097152;case"ruby-base-container":return 4194304;case"ruby-text-container":return 8388608;case"contents":return 16777216;case"inline-block":return 33554432;case"inline-list-item":return 67108864;case"inline-table":return 134217728;case"inline-flex":return 268435456;case"inline-grid":return 536870912}return 0},mi={name:"float",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"left":return 1;case"right":return 2;case"inline-start":return 3;case"inline-end":return 4}return 0}},gi={name:"letter-spacing",initialValue:"0",prefix:!1,type:0,parse:function(e,t){return 20===t.type&&"normal"===t.value?0:17===t.type||15===t.type?t.number:0}};!function(e){e.NORMAL="normal",e.STRICT="strict"}(Vn||(Vn={}));var yi,_i={name:"line-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"strict"===t?Vn.STRICT:Vn.NORMAL}},vi={name:"line-height",initialValue:"normal",prefix:!1,type:4},xi=function(e,t){return Pr(e)&&"normal"===e.value?1.2*t:17===e.type?t*e.number:Nr(e)?Kr(e,t):t},wi={name:"list-style-image",initialValue:"none",type:0,prefix:!1,parse:function(e,t){return 20===t.type&&"none"===t.value?null:On.parse(e,t)}},bi={name:"list-style-position",initialValue:"outside",prefix:!1,type:2,parse:function(e,t){return"inside"===t?0:1}},Bi={name:"list-style-type",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"disc":return 0;case"circle":return 1;case"square":return 2;case"decimal":return 3;case"cjk-decimal":return 4;case"decimal-leading-zero":return 5;case"lower-roman":return 6;case"upper-roman":return 7;case"lower-greek":return 8;case"lower-alpha":return 9;case"upper-alpha":return 10;case"arabic-indic":return 11;case"armenian":return 12;case"bengali":return 13;case"cambodian":return 14;case"cjk-earthly-branch":return 15;case"cjk-heavenly-stem":return 16;case"cjk-ideographic":return 17;case"devanagari":return 18;case"ethiopic-numeric":return 19;case"georgian":return 20;case"gujarati":return 21;case"gurmukhi":case"hebrew":return 22;case"hiragana":return 23;case"hiragana-iroha":return 24;case"japanese-formal":return 25;case"japanese-informal":return 26;case"kannada":return 27;case"katakana":return 28;case"katakana-iroha":return 29;case"khmer":return 30;case"korean-hangul-formal":return 31;case"korean-hanja-formal":return 32;case"korean-hanja-informal":return 33;case"lao":return 34;case"lower-armenian":return 35;case"malayalam":return 36;case"mongolian":return 37;case"myanmar":return 38;case"oriya":return 39;case"persian":return 40;case"simp-chinese-formal":return 41;case"simp-chinese-informal":return 42;case"tamil":return 43;case"telugu":return 44;case"thai":return 45;case"tibetan":return 46;case"trad-chinese-formal":return 47;case"trad-chinese-informal":return 48;case"upper-armenian":return 49;case"disclosure-open":return 50;case"disclosure-closed":return 51;default:return-1}}},Ci=function(e){return{name:"margin-"+e,initialValue:"0",prefix:!1,type:4}},Ei=Ci("top"),Si=Ci("right"),Ti=Ci("bottom"),Ii=Ci("left"),Fi={name:"overflow",initialValue:"visible",prefix:!1,type:1,parse:function(e,t){return t.filter(Pr).map(function(e){switch(e.value){case"hidden":return 1;case"scroll":return 2;case"clip":return 3;case"auto":return 4;default:return 0}})}},ki={name:"overflow-wrap",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){return"break-word"===t?"break-word":"normal"}},Pi=function(e){return{name:"padding-"+e,initialValue:"0",prefix:!1,type:3,format:"length-percentage"}},Mi=Pi("top"),Oi=Pi("right"),Li=Pi("bottom"),Di=Pi("left"),Ui={name:"text-align",initialValue:"left",prefix:!1,type:2,parse:function(e,t){switch(t){case"right":return 2;case"center":case"justify":return 1;default:return 0}}},Ri={name:"position",initialValue:"static",prefix:!1,type:2,parse:function(e,t){switch(t){case"relative":return 1;case"absolute":return 2;case"fixed":return 3;case"sticky":return 4}return 0}},zi={name:"text-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&Or(t[0],"none")?[]:Ur(t).map(function(t){for(var r={color:hn.TRANSPARENT,offsetX:Qr,offsetY:Qr,blur:Qr},n=0,i=0;i<t.length;i++){var o=t[i];zr(o)?(0===n?r.offsetX=o:1===n?r.offsetY=o:r.blur=o,n++):r.color=tn.parse(e,o)}return r})}},Ni={name:"text-transform",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"uppercase":return 2;case"lowercase":return 1;case"capitalize":return 3}return 0}},ji={name:"transform",initialValue:"none",prefix:!0,type:0,parse:function(e,t){if(20===t.type&&"none"===t.value)return null;if(18===t.type){var r=Qi[t.name];if("undefined"===typeof r)throw new Error('Attempting to parse an unsupported transform function "'+t.name+'"');return r(t.values)}return null}},Qi={matrix:function(e){var t=e.filter(function(e){return 17===e.type}).map(function(e){return e.number});return 6===t.length?t:null},matrix3d:function(e){var t=e.filter(function(e){return 17===e.type}).map(function(e){return e.number}),r=t[0],n=t[1];t[2],t[3];var i=t[4],o=t[5];t[6],t[7],t[8],t[9],t[10],t[11];var a=t[12],s=t[13];return t[14],t[15],16===t.length?[r,n,i,o,a,s]:null}},Vi={type:16,number:50,flags:Ge},Hi=[Vi,Vi],Gi={name:"transform-origin",initialValue:"50% 50%",prefix:!0,type:1,parse:function(e,t){var r=t.filter(Nr);return 2!==r.length?Hi:[r[0],r[1]]}},Ki={name:"visible",initialValue:"none",prefix:!1,type:2,parse:function(e,t){switch(t){case"hidden":return 1;case"collapse":return 2;default:return 0}}};!function(e){e.NORMAL="normal",e.BREAK_ALL="break-all",e.KEEP_ALL="keep-all"}(yi||(yi={}));for(var Wi={name:"word-break",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"break-all":return yi.BREAK_ALL;case"keep-all":return yi.KEEP_ALL;default:return yi.NORMAL}}},qi={name:"z-index",initialValue:"auto",prefix:!1,type:0,parse:function(e,t){if(20===t.type)return{auto:!0,order:0};if(kr(t))return{auto:!1,order:t.number};throw new Error("Invalid z-index number parsed")}},Zi={name:"time",parse:function(e,t){if(15===t.type)switch(t.unit.toLowerCase()){case"s":return 1e3*t.number;case"ms":return t.number}throw new Error("Unsupported time type")}},Xi={name:"opacity",initialValue:"1",type:0,prefix:!1,parse:function(e,t){return kr(t)?t.number:1}},Yi={name:"text-decoration-color",initialValue:"transparent",prefix:!1,type:3,format:"color"},Ji={name:"text-decoration-line",initialValue:"none",prefix:!1,type:1,parse:function(e,t){return t.filter(Pr).map(function(e){switch(e.value){case"underline":return 1;case"overline":return 2;case"line-through":return 3;case"none":return 4}return 0}).filter(function(e){return 0!==e})}},$i={name:"font-family",initialValue:"",prefix:!1,type:1,parse:function(e,t){var r=[],n=[];return t.forEach(function(e){switch(e.type){case 20:case 0:r.push(e.value);break;case 17:r.push(e.number.toString());break;case 4:n.push(r.join(" ")),r.length=0}}),r.length&&n.push(r.join(" ")),n.map(function(e){return-1===e.indexOf(" ")?e:"'"+e+"'"})}},eo={name:"font-size",initialValue:"0",prefix:!1,type:3,format:"length"},to={name:"font-weight",initialValue:"normal",type:0,prefix:!1,parse:function(e,t){return kr(t)?t.number:Pr(t)&&"bold"===t.value?700:400}},ro={name:"font-variant",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return t.filter(Pr).map(function(e){return e.value})}},no={name:"font-style",initialValue:"normal",prefix:!1,type:2,parse:function(e,t){switch(t){case"oblique":return"oblique";case"italic":return"italic";default:return"normal"}}},io=function(e,t){return 0!==(e&t)},oo={name:"content",initialValue:"none",type:1,prefix:!1,parse:function(e,t){if(0===t.length)return[];var r=t[0];return 20===r.type&&"none"===r.value?[]:t}},ao={name:"counter-increment",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var r=t[0];if(20===r.type&&"none"===r.value)return null;for(var n=[],i=t.filter(Lr),o=0;o<i.length;o++){var a=i[o],s=i[o+1];if(20===a.type){var l=s&&kr(s)?s.number:1;n.push({counter:a.value,increment:l})}}return n}},so={name:"counter-reset",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return[];for(var r=[],n=t.filter(Lr),i=0;i<n.length;i++){var o=n[i],a=n[i+1];if(Pr(o)&&"none"!==o.value){var s=a&&kr(a)?a.number:0;r.push({counter:o.value,reset:s})}}return r}},lo={name:"duration",initialValue:"0s",prefix:!1,type:1,parse:function(e,t){return t.filter(Fr).map(function(t){return Zi.parse(e,t)})}},co={name:"quotes",initialValue:"none",prefix:!0,type:1,parse:function(e,t){if(0===t.length)return null;var r=t[0];if(20===r.type&&"none"===r.value)return null;var n=[],i=t.filter(Mr);if(i.length%2!==0)return null;for(var o=0;o<i.length;o+=2){var a=i[o].value,s=i[o+1].value;n.push({open:a,close:s})}return n}},uo=function(e,t,r){if(!e)return"";var n=e[Math.min(t,e.length-1)];return n?r?n.open:n.close:""},ho={name:"box-shadow",initialValue:"none",type:1,prefix:!1,parse:function(e,t){return 1===t.length&&Or(t[0],"none")?[]:Ur(t).map(function(t){for(var r={color:255,offsetX:Qr,offsetY:Qr,blur:Qr,spread:Qr,inset:!1},n=0,i=0;i<t.length;i++){var o=t[i];Or(o,"inset")?r.inset=!0:zr(o)?(0===n?r.offsetX=o:1===n?r.offsetY=o:2===n?r.blur=o:r.spread=o,n++):r.color=tn.parse(e,o)}return r})}},Ao={name:"paint-order",initialValue:"normal",prefix:!1,type:1,parse:function(e,t){var r=[0,1,2],n=[];return t.filter(Pr).forEach(function(e){switch(e.value){case"stroke":n.push(1);break;case"fill":n.push(0);break;case"markers":n.push(2)}}),r.forEach(function(e){-1===n.indexOf(e)&&n.push(e)}),n}},fo={name:"-webkit-text-stroke-color",initialValue:"currentcolor",prefix:!1,type:3,format:"color"},po={name:"-webkit-text-stroke-width",initialValue:"0",type:0,prefix:!1,parse:function(e,t){return Fr(t)?t.number:0}},mo=function(){function e(e,t){var r,n;this.animationDuration=_o(e,lo,t.animationDuration),this.backgroundClip=_o(e,An,t.backgroundClip),this.backgroundColor=_o(e,fn,t.backgroundColor),this.backgroundImage=_o(e,Rn,t.backgroundImage),this.backgroundOrigin=_o(e,zn,t.backgroundOrigin),this.backgroundPosition=_o(e,Nn,t.backgroundPosition),this.backgroundRepeat=_o(e,jn,t.backgroundRepeat),this.backgroundSize=_o(e,Hn,t.backgroundSize),this.borderTopColor=_o(e,Wn,t.borderTopColor),this.borderRightColor=_o(e,qn,t.borderRightColor),this.borderBottomColor=_o(e,Zn,t.borderBottomColor),this.borderLeftColor=_o(e,Xn,t.borderLeftColor),this.borderTopLeftRadius=_o(e,Jn,t.borderTopLeftRadius),this.borderTopRightRadius=_o(e,$n,t.borderTopRightRadius),this.borderBottomRightRadius=_o(e,ei,t.borderBottomRightRadius),this.borderBottomLeftRadius=_o(e,ti,t.borderBottomLeftRadius),this.borderTopStyle=_o(e,ni,t.borderTopStyle),this.borderRightStyle=_o(e,ii,t.borderRightStyle),this.borderBottomStyle=_o(e,oi,t.borderBottomStyle),this.borderLeftStyle=_o(e,ai,t.borderLeftStyle),this.borderTopWidth=_o(e,li,t.borderTopWidth),this.borderRightWidth=_o(e,ci,t.borderRightWidth),this.borderBottomWidth=_o(e,ui,t.borderBottomWidth),this.borderLeftWidth=_o(e,di,t.borderLeftWidth),this.boxShadow=_o(e,ho,t.boxShadow),this.color=_o(e,hi,t.color),this.direction=_o(e,Ai,t.direction),this.display=_o(e,fi,t.display),this.float=_o(e,mi,t.cssFloat),this.fontFamily=_o(e,$i,t.fontFamily),this.fontSize=_o(e,eo,t.fontSize),this.fontStyle=_o(e,no,t.fontStyle),this.fontVariant=_o(e,ro,t.fontVariant),this.fontWeight=_o(e,to,t.fontWeight),this.letterSpacing=_o(e,gi,t.letterSpacing),this.lineBreak=_o(e,_i,t.lineBreak),this.lineHeight=_o(e,vi,t.lineHeight),this.listStyleImage=_o(e,wi,t.listStyleImage),this.listStylePosition=_o(e,bi,t.listStylePosition),this.listStyleType=_o(e,Bi,t.listStyleType),this.marginTop=_o(e,Ei,t.marginTop),this.marginRight=_o(e,Si,t.marginRight),this.marginBottom=_o(e,Ti,t.marginBottom),this.marginLeft=_o(e,Ii,t.marginLeft),this.opacity=_o(e,Xi,t.opacity);var i=_o(e,Fi,t.overflow);this.overflowX=i[0],this.overflowY=i[i.length>1?1:0],this.overflowWrap=_o(e,ki,t.overflowWrap),this.paddingTop=_o(e,Mi,t.paddingTop),this.paddingRight=_o(e,Oi,t.paddingRight),this.paddingBottom=_o(e,Li,t.paddingBottom),this.paddingLeft=_o(e,Di,t.paddingLeft),this.paintOrder=_o(e,Ao,t.paintOrder),this.position=_o(e,Ri,t.position),this.textAlign=_o(e,Ui,t.textAlign),this.textDecorationColor=_o(e,Yi,null!==(r=t.textDecorationColor)&&void 0!==r?r:t.color),this.textDecorationLine=_o(e,Ji,null!==(n=t.textDecorationLine)&&void 0!==n?n:t.textDecoration),this.textShadow=_o(e,zi,t.textShadow),this.textTransform=_o(e,Ni,t.textTransform),this.transform=_o(e,ji,t.transform),this.transformOrigin=_o(e,Gi,t.transformOrigin),this.visibility=_o(e,Ki,t.visibility),this.webkitTextStrokeColor=_o(e,fo,t.webkitTextStrokeColor),this.webkitTextStrokeWidth=_o(e,po,t.webkitTextStrokeWidth),this.wordBreak=_o(e,Wi,t.wordBreak),this.zIndex=_o(e,qi,t.zIndex)}return e.prototype.isVisible=function(){return this.display>0&&this.opacity>0&&0===this.visibility},e.prototype.isTransparent=function(){return rn(this.backgroundColor)},e.prototype.isTransformed=function(){return null!==this.transform},e.prototype.isPositioned=function(){return 0!==this.position},e.prototype.isPositionedWithZIndex=function(){return this.isPositioned()&&!this.zIndex.auto},e.prototype.isFloating=function(){return 0!==this.float},e.prototype.isInlineLevel=function(){return io(this.display,4)||io(this.display,33554432)||io(this.display,268435456)||io(this.display,536870912)||io(this.display,67108864)||io(this.display,134217728)},e}(),go=function(){function e(e,t){this.content=_o(e,oo,t.content),this.quotes=_o(e,co,t.quotes)}return e}(),yo=function(){function e(e,t){this.counterIncrement=_o(e,ao,t.counterIncrement),this.counterReset=_o(e,so,t.counterReset)}return e}(),_o=function(e,t,r){var n=new Tr,i=null!==r&&"undefined"!==typeof r?r.toString():t.initialValue;n.write(i);var o=new Ir(n.read());switch(t.type){case 2:var a=o.parseComponentValue();return t.parse(e,Pr(a)?a.value:t.initialValue);case 0:return t.parse(e,o.parseComponentValue());case 1:return t.parse(e,o.parseComponentValues());case 4:return o.parseComponentValue();case 3:switch(t.format){case"angle":return Yr.parse(e,o.parseComponentValue());case"color":return tn.parse(e,o.parseComponentValue());case"image":return On.parse(e,o.parseComponentValue());case"length":var s=o.parseComponentValue();return zr(s)?s:Qr;case"length-percentage":var l=o.parseComponentValue();return Nr(l)?l:Qr;case"time":return Zi.parse(e,o.parseComponentValue())}}},vo="data-html2canvas-debug",xo=function(e){switch(e.getAttribute(vo)){case"all":return 1;case"clone":return 2;case"parse":return 3;case"render":return 4;default:return 0}},wo=function(e,t){var r=xo(e);return 1===r||t===r},bo=function(){function e(e,t){this.context=e,this.textNodes=[],this.elements=[],this.flags=0,wo(t,3),this.styles=new mo(e,window.getComputedStyle(t,null)),us(t)&&(this.styles.animationDuration.some(function(e){return e>0})&&(t.style.animationDuration="0s"),null!==this.styles.transform&&(t.style.transform="none")),this.bounds=s(this.context,t),wo(t,4)&&(this.flags|=16)}return e}(),Bo="AAAAAAAAAAAAEA4AGBkAAFAaAAACAAAAAAAIABAAGAAwADgACAAQAAgAEAAIABAACAAQAAgAEAAIABAACAAQAAgAEAAIABAAQABIAEQATAAIABAACAAQAAgAEAAIABAAVABcAAgAEAAIABAACAAQAGAAaABwAHgAgACIAI4AlgAIABAAmwCjAKgAsAC2AL4AvQDFAMoA0gBPAVYBWgEIAAgACACMANoAYgFkAWwBdAF8AX0BhQGNAZUBlgGeAaMBlQGWAasBswF8AbsBwwF0AcsBYwHTAQgA2wG/AOMBdAF8AekB8QF0AfkB+wHiAHQBfAEIAAMC5gQIAAsCEgIIAAgAFgIeAggAIgIpAggAMQI5AkACygEIAAgASAJQAlgCYAIIAAgACAAKBQoFCgUTBRMFGQUrBSsFCAAIAAgACAAIAAgACAAIAAgACABdAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABoAmgCrwGvAQgAbgJ2AggAHgEIAAgACADnAXsCCAAIAAgAgwIIAAgACAAIAAgACACKAggAkQKZAggAPADJAAgAoQKkAqwCsgK6AsICCADJAggA0AIIAAgACAAIANYC3gIIAAgACAAIAAgACABAAOYCCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAkASoB+QIEAAgACAA8AEMCCABCBQgACABJBVAFCAAIAAgACAAIAAgACAAIAAgACABTBVoFCAAIAFoFCABfBWUFCAAIAAgACAAIAAgAbQUIAAgACAAIAAgACABzBXsFfQWFBYoFigWKBZEFigWKBYoFmAWfBaYFrgWxBbkFCAAIAAgACAAIAAgACAAIAAgACAAIAMEFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAMgFCADQBQgACAAIAAgACAAIAAgACAAIAAgACAAIAO4CCAAIAAgAiQAIAAgACABAAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAD0AggACAD8AggACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIANYFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAMDvwAIAAgAJAIIAAgACAAIAAgACAAIAAgACwMTAwgACAB9BOsEGwMjAwgAKwMyAwsFYgE3A/MEPwMIAEUDTQNRAwgAWQOsAGEDCAAIAAgACAAIAAgACABpAzQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFOgU0BTUFNgU3BTgFOQU6BTQFNQU2BTcFOAU5BToFNAU1BTYFNwU4BTkFIQUoBSwFCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABtAwgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABMAEwACAAIAAgACAAIABgACAAIAAgACAC/AAgACAAyAQgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACAAIAAwAAgACAAIAAgACAAIAAgACAAIAAAARABIAAgACAAIABQASAAIAAgAIABwAEAAjgCIABsAqAC2AL0AigDQAtwC+IJIQqVAZUBWQqVAZUBlQGVAZUBlQGrC5UBlQGVAZUBlQGVAZUBlQGVAXsKlQGVAbAK6wsrDGUMpQzlDJUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAZUBlQGVAfAKAAuZA64AtwCJALoC6ADwAAgAuACgA/oEpgO6AqsD+AAIAAgAswMIAAgACAAIAIkAuwP5AfsBwwPLAwgACAAIAAgACADRA9kDCAAIAOED6QMIAAgACAAIAAgACADuA/YDCAAIAP4DyQAIAAgABgQIAAgAXQAOBAgACAAIAAgACAAIABMECAAIAAgACAAIAAgACAD8AAQBCAAIAAgAGgQiBCoECAExBAgAEAEIAAgACAAIAAgACAAIAAgACAAIAAgACAA4BAgACABABEYECAAIAAgATAQYAQgAVAQIAAgACAAIAAgACAAIAAgACAAIAFoECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAOQEIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAB+BAcACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAEABhgSMBAgACAAIAAgAlAQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAwAEAAQABAADAAMAAwADAAQABAAEAAQABAAEAAQABHATAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAdQMIAAgACAAIAAgACAAIAMkACAAIAAgAfQMIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACACFA4kDCAAIAAgACAAIAOcBCAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAIcDCAAIAAgACAAIAAgACAAIAAgACAAIAJEDCAAIAAgACADFAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABgBAgAZgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAbAQCBXIECAAIAHkECAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACABAAJwEQACjBKoEsgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAC6BMIECAAIAAgACAAIAAgACABmBAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAxwQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAGYECAAIAAgAzgQIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBd0FXwUIAOIF6gXxBYoF3gT5BQAGCAaKBYoFigWKBYoFigWKBYoFigWKBYoFigXWBIoFigWKBYoFigWKBYoFigWKBYsFEAaKBYoFigWKBYoFigWKBRQGCACKBYoFigWKBQgACAAIANEECAAIABgGigUgBggAJgYIAC4GMwaKBYoF0wQ3Bj4GigWKBYoFigWKBYoFigWKBYoFigWKBYoFigUIAAgACAAIAAgACAAIAAgAigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWKBYoFigWLBf///////wQABAAEAAQABAAEAAQABAAEAAQAAwAEAAQAAgAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAQADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUAAAAFAAUAAAAFAAUAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUAAQAAAAUABQAFAAUABQAFAAAAAAAFAAUAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAFAAUAAQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAAABwAHAAcAAAAHAAcABwAFAAEAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAcABwAFAAUAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAAAAQABAAAAAAAAAAAAAAAFAAUABQAFAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAHAAcAAAAHAAcAAAAAAAUABQAHAAUAAQAHAAEABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwABAAUABQAFAAUAAAAAAAAAAAAAAAEAAQABAAEAAQABAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABQANAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABAAEAAQABAAEAAQABAAEAAQABAAEAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAABQAHAAUABQAFAAAAAAAAAAcABQAFAAUABQAFAAQABAAEAAQABAAEAAQABAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUAAAAFAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAUAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAcABwAFAAcABwAAAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUABwAHAAUABQAFAAUAAAAAAAcABwAAAAAABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAABQAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAAAAAAAAAAABQAFAAAAAAAFAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAFAAUABQAFAAUAAAAFAAUABwAAAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABwAFAAUABQAFAAAAAAAHAAcAAAAAAAcABwAFAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAAAAAAAAAHAAcABwAAAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAABQAHAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAUABQAFAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAHAAcABQAHAAcAAAAFAAcABwAAAAcABwAFAAUAAAAAAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAFAAcABwAFAAUABQAAAAUAAAAHAAcABwAHAAcABwAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAHAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAABwAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAUAAAAFAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABwAFAAUABQAFAAUAAAAFAAUAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABwAFAAUABQAFAAUABQAAAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABQAFAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABQAFAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAHAAUABQAFAAUABQAFAAUABwAHAAcABwAHAAcABwAHAAUABwAHAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABwAHAAcABwAFAAUABwAHAAcAAAAAAAAAAAAHAAcABQAHAAcABwAHAAcABwAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAcABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAUABQAFAAUABQAFAAUAAAAFAAAABQAAAAAABQAFAAUABQAFAAUABQAFAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAFAAUAAAAAAAUABQAFAAUABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABwAFAAcABwAHAAcABwAFAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAUABQAFAAUABwAHAAUABQAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABQAFAAcABwAHAAUABwAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAcABQAFAAUABQAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAAAAAABwAFAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAAAAAAAAAFAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAUABQAHAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAUABQAFAAUABQAHAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAcABwAFAAUABQAFAAcABwAFAAUABwAHAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAFAAcABwAFAAUABwAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAFAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAFAAUABQAAAAAABQAFAAAAAAAAAAAAAAAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAcABwAAAAAAAAAAAAAABwAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAcABwAFAAcABwAAAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAFAAUABQAAAAUABQAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABwAFAAUABQAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAUABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAHAAcABQAHAAUABQAAAAAAAAAAAAAAAAAFAAAABwAHAAcABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAHAAcABwAAAAAABwAHAAAAAAAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABwAHAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAFAAUABwAFAAcABwAFAAcABQAFAAcABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAHAAcABQAFAAUABQAAAAAABwAHAAcABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAHAAUABQAFAAUABQAFAAUABQAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABwAFAAcABwAFAAUABQAFAAUABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAcABwAFAAUABQAFAAcABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAUABQAFAAUABQAHAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAFAAUABQAFAAAAAAAFAAUABwAHAAcABwAFAAAAAAAAAAcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABwAHAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAcABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUAAAAHAAUABQAFAAUABQAFAAUABwAFAAUABwAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUAAAAAAAAABQAAAAUABQAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAHAAcABwAHAAcAAAAFAAUAAAAHAAcABQAHAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAAAAUABQAFAAAAAAAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAFAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAFAAUABQAAAAAABQAFAAUABQAFAAUABQAAAAUABQAAAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAFAAUABQAFAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABQAFAAUABQAFAAUABQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAFAAUABQAFAAUADgAOAA4ADgAOAA4ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAA8ADwAPAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAcABwAHAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAgACAAIAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAMAAwADAAMAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkAAAAAAAAAAAAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAKAAoACgAAAAAAAAAAAAsADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwACwAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAMAAwADAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAADgAOAA4AAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAAAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4AAAAOAAAAAAAAAAAAAAAAAA4AAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAAAAAAAAAAAA4AAAAOAAAAAAAAAAAADgAOAA4AAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAA4AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4AAAAAAA4ADgAOAA4ADgAOAA4ADgAOAAAADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4ADgAOAAAAAAAAAAAAAAAAAAAAAAAAAAAADgAOAA4ADgAOAA4AAAAAAAAAAAAAAAAAAAAAAA4ADgAOAA4ADgAOAA4ADgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAOAA4ADgAOAA4ADgAAAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4ADgAOAA4AAAAAAAAAAAA=",Co="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Eo="undefined"===typeof Uint8Array?[]:new Uint8Array(256),So=0;So<Co.length;So++)Eo[Co.charCodeAt(So)]=So;for(var To=function(e){var t,r,n,i,o,a=.75*e.length,s=e.length,l=0;"="===e[e.length-1]&&(a--,"="===e[e.length-2]&&a--);var c="undefined"!==typeof ArrayBuffer&&"undefined"!==typeof Uint8Array&&"undefined"!==typeof Uint8Array.prototype.slice?new ArrayBuffer(a):new Array(a),u=Array.isArray(c)?c:new Uint8Array(c);for(t=0;t<s;t+=4)r=Eo[e.charCodeAt(t)],n=Eo[e.charCodeAt(t+1)],i=Eo[e.charCodeAt(t+2)],o=Eo[e.charCodeAt(t+3)],u[l++]=r<<2|n>>4,u[l++]=(15&n)<<4|i>>2,u[l++]=(3&i)<<6|63&o;return c},Io=function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r.push(e[n+1]<<8|e[n]);return r},Fo=function(e){for(var t=e.length,r=[],n=0;n<t;n+=4)r.push(e[n+3]<<24|e[n+2]<<16|e[n+1]<<8|e[n]);return r},ko=5,Po=11,Mo=2,Oo=65536>>ko,Lo=(1<<ko)-1,Do=Oo+(1024>>ko)+32,Uo=65536>>Po,Ro=(1<<Po-ko)-1,zo=function(e,t,r){return e.slice?e.slice(t,r):new Uint16Array(Array.prototype.slice.call(e,t,r))},No=function(e,t,r){return e.slice?e.slice(t,r):new Uint32Array(Array.prototype.slice.call(e,t,r))},jo=function(e,t){var r=To(e),n=Array.isArray(r)?Fo(r):new Uint32Array(r),i=Array.isArray(r)?Io(r):new Uint16Array(r),o=24,a=zo(i,o/2,n[4]/2),s=2===n[5]?zo(i,(o+n[4])/2):No(n,Math.ceil((o+n[4])/4));return new Qo(n[0],n[1],n[2],n[3],a,s)},Qo=function(){function e(e,t,r,n,i,o){this.initialValue=e,this.errorValue=t,this.highStart=r,this.highValueIndex=n,this.index=i,this.data=o}return e.prototype.get=function(e){var t;if(e>=0){if(e<55296||e>56319&&e<=65535)return t=((t=this.index[e>>ko])<<Mo)+(e&Lo),this.data[t];if(e<=65535)return t=((t=this.index[Oo+(e-55296>>ko)])<<Mo)+(e&Lo),this.data[t];if(e<this.highStart)return t=Do-Uo+(e>>Po),t=this.index[t],t+=e>>ko&Ro,t=((t=this.index[t])<<Mo)+(e&Lo),this.data[t];if(e<=1114111)return this.data[this.highValueIndex]}return this.errorValue},e}(),Vo="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Ho="undefined"===typeof Uint8Array?[]:new Uint8Array(256),Go=0;Go<Vo.length;Go++)Ho[Vo.charCodeAt(Go)]=Go;var Ko,Wo=1,qo=2,Zo=3,Xo=4,Yo=5,Jo=7,$o=8,ea=9,ta=10,ra=11,na=12,ia=13,oa=14,aa=15,sa=function(e){for(var t=[],r=0,n=e.length;r<n;){var i=e.charCodeAt(r++);if(i>=55296&&i<=56319&&r<n){var o=e.charCodeAt(r++);56320===(64512&o)?t.push(((1023&i)<<10)+(1023&o)+65536):(t.push(i),r--)}else t.push(i)}return t},la=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];if(String.fromCodePoint)return String.fromCodePoint.apply(String,e);var r=e.length;if(!r)return"";for(var n=[],i=-1,o="";++i<r;){var a=e[i];a<=65535?n.push(a):(a-=65536,n.push(55296+(a>>10),a%1024+56320)),(i+1===r||n.length>16384)&&(o+=String.fromCharCode.apply(String,n),n.length=0)}return o},ca=jo(Bo),ua="\xd7",da="\xf7",ha=function(e){return ca.get(e)},Aa=function(e,t,r){var n=r-2,i=t[n],o=t[r-1],a=t[r];if(o===qo&&a===Zo)return ua;if(o===qo||o===Zo||o===Xo)return da;if(a===qo||a===Zo||a===Xo)return da;if(o===$o&&-1!==[$o,ea,ra,na].indexOf(a))return ua;if((o===ra||o===ea)&&(a===ea||a===ta))return ua;if((o===na||o===ta)&&a===ta)return ua;if(a===ia||a===Yo)return ua;if(a===Jo)return ua;if(o===Wo)return ua;if(o===ia&&a===oa){for(;i===Yo;)i=t[--n];if(i===oa)return ua}if(o===aa&&a===aa){for(var s=0;i===aa;)s++,i=t[--n];if(s%2===0)return ua}return da},fa=function(e){var t=sa(e),r=t.length,n=0,i=0,o=t.map(ha);return{next:function(){if(n>=r)return{done:!0,value:null};for(var e=ua;n<r&&(e=Aa(t,o,++n))===ua;);if(e!==ua||n===r){var a=la.apply(null,t.slice(i,n));return i=n,{value:a,done:!1}}return{done:!0,value:null}}}},pa=function(e){for(var t,r=fa(e),n=[];!(t=r.next()).done;)t.value&&n.push(t.value.slice());return n},ma=function(e){var t=123;if(e.createRange){var r=e.createRange();if(r.getBoundingClientRect){var n=e.createElement("boundtest");n.style.height=t+"px",n.style.display="block",e.body.appendChild(n),r.selectNode(n);var i=r.getBoundingClientRect(),o=Math.round(i.height);if(e.body.removeChild(n),o===t)return!0}}return!1},ga=function(e){var t=e.createElement("boundtest");t.style.width="50px",t.style.display="block",t.style.fontSize="12px",t.style.letterSpacing="0px",t.style.wordSpacing="0px",e.body.appendChild(t);var r=e.createRange();t.innerHTML="function"===typeof"".repeat?"&#128104;".repeat(10):"";var n=t.firstChild,i=c(n.data).map(function(e){return u(e)}),o=0,a={},s=i.every(function(e,t){r.setStart(n,o),r.setEnd(n,o+e.length);var i=r.getBoundingClientRect();o+=e.length;var s=i.x>a.x||i.y>a.y;return a=i,0===t||s});return e.body.removeChild(t),s},ya=function(){return"undefined"!==typeof(new Image).crossOrigin},_a=function(){return"string"===typeof(new XMLHttpRequest).responseType},va=function(e){var t=new Image,r=e.createElement("canvas"),n=r.getContext("2d");if(!n)return!1;t.src="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'></svg>";try{n.drawImage(t,0,0),r.toDataURL()}catch(Ut){return!1}return!0},xa=function(e){return 0===e[0]&&255===e[1]&&0===e[2]&&255===e[3]},wa=function(e){var t=e.createElement("canvas"),r=100;t.width=r,t.height=r;var n=t.getContext("2d");if(!n)return Promise.reject(!1);n.fillStyle="rgb(0, 255, 0)",n.fillRect(0,0,r,r);var i=new Image,o=t.toDataURL();i.src=o;var a=ba(r,r,0,0,i);return n.fillStyle="red",n.fillRect(0,0,r,r),Ba(a).then(function(t){n.drawImage(t,0,0);var i=n.getImageData(0,0,r,r).data;n.fillStyle="red",n.fillRect(0,0,r,r);var a=e.createElement("div");return a.style.backgroundImage="url("+o+")",a.style.height=r+"px",xa(i)?Ba(ba(r,r,0,0,a)):Promise.reject(!1)}).then(function(e){return n.drawImage(e,0,0),xa(n.getImageData(0,0,r,r).data)}).catch(function(){return!1})},ba=function(e,t,r,n,i){var o="http://www.w3.org/2000/svg",a=document.createElementNS(o,"svg"),s=document.createElementNS(o,"foreignObject");return a.setAttributeNS(null,"width",e.toString()),a.setAttributeNS(null,"height",t.toString()),s.setAttributeNS(null,"width","100%"),s.setAttributeNS(null,"height","100%"),s.setAttributeNS(null,"x",r.toString()),s.setAttributeNS(null,"y",n.toString()),s.setAttributeNS(null,"externalResourcesRequired","true"),a.appendChild(s),s.appendChild(i),a},Ba=function(e){return new Promise(function(t,r){var n=new Image;n.onload=function(){return t(n)},n.onerror=r,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))})},Ca={get SUPPORT_RANGE_BOUNDS(){var e=ma(document);return Object.defineProperty(Ca,"SUPPORT_RANGE_BOUNDS",{value:e}),e},get SUPPORT_WORD_BREAKING(){var e=Ca.SUPPORT_RANGE_BOUNDS&&ga(document);return Object.defineProperty(Ca,"SUPPORT_WORD_BREAKING",{value:e}),e},get SUPPORT_SVG_DRAWING(){var e=va(document);return Object.defineProperty(Ca,"SUPPORT_SVG_DRAWING",{value:e}),e},get SUPPORT_FOREIGNOBJECT_DRAWING(){var e="function"===typeof Array.from&&"function"===typeof window.fetch?wa(document):Promise.resolve(!1);return Object.defineProperty(Ca,"SUPPORT_FOREIGNOBJECT_DRAWING",{value:e}),e},get SUPPORT_CORS_IMAGES(){var e=ya();return Object.defineProperty(Ca,"SUPPORT_CORS_IMAGES",{value:e}),e},get SUPPORT_RESPONSE_TYPE(){var e=_a();return Object.defineProperty(Ca,"SUPPORT_RESPONSE_TYPE",{value:e}),e},get SUPPORT_CORS_XHR(){var e="withCredentials"in new XMLHttpRequest;return Object.defineProperty(Ca,"SUPPORT_CORS_XHR",{value:e}),e},get SUPPORT_NATIVE_TEXT_SEGMENTATION(){var e=!("undefined"===typeof Intl||!Intl.Segmenter);return Object.defineProperty(Ca,"SUPPORT_NATIVE_TEXT_SEGMENTATION",{value:e}),e}},Ea=function(){function e(e,t){this.text=e,this.bounds=t}return e}(),Sa=function(e,t,r,n){var i=Pa(t,r),o=[],s=0;return i.forEach(function(t){if(r.textDecorationLine.length||t.trim().length>0)if(Ca.SUPPORT_RANGE_BOUNDS){var i=Ia(n,s,t.length).getClientRects();if(i.length>1){var l=Fa(t),c=0;l.forEach(function(t){o.push(new Ea(t,a.fromDOMRectList(e,Ia(n,c+s,t.length).getClientRects()))),c+=t.length})}else o.push(new Ea(t,a.fromDOMRectList(e,i)))}else{var u=n.splitText(t.length);o.push(new Ea(t,Ta(e,n))),n=u}else Ca.SUPPORT_RANGE_BOUNDS||(n=n.splitText(t.length));s+=t.length}),o},Ta=function(e,t){var r=t.ownerDocument;if(r){var n=r.createElement("html2canvaswrapper");n.appendChild(t.cloneNode(!0));var i=t.parentNode;if(i){i.replaceChild(n,t);var o=s(e,n);return n.firstChild&&i.replaceChild(n.firstChild,n),o}}return a.EMPTY},Ia=function(e,t,r){var n=e.ownerDocument;if(!n)throw new Error("Node has no owner document");var i=n.createRange();return i.setStart(e,t),i.setEnd(e,t+r),i},Fa=function(e){if(Ca.SUPPORT_NATIVE_TEXT_SEGMENTATION){var t=new Intl.Segmenter(void 0,{granularity:"grapheme"});return Array.from(t.segment(e)).map(function(e){return e.segment})}return pa(e)},ka=function(e,t){if(Ca.SUPPORT_NATIVE_TEXT_SEGMENTATION){var r=new Intl.Segmenter(void 0,{granularity:"word"});return Array.from(r.segment(e)).map(function(e){return e.segment})}return Oa(e,t)},Pa=function(e,t){return 0!==t.letterSpacing?Fa(e):ka(e,t)},Ma=[32,160,4961,65792,65793,4153,4241],Oa=function(e,t){for(var r,n=Qe(e,{lineBreak:t.lineBreak,wordBreak:"break-word"===t.overflowWrap?"break-word":t.wordBreak}),i=[],o=function(){if(r.value){var e=r.value.slice(),t=c(e),n="";t.forEach(function(e){-1===Ma.indexOf(e)?n+=u(e):(n.length&&i.push(n),i.push(u(e)),n="")}),n.length&&i.push(n)}};!(r=n.next()).done;)o();return i},La=function(){function e(e,t,r){this.text=Da(t.data,r.textTransform),this.textBounds=Sa(e,this.text,r,t)}return e}(),Da=function(e,t){switch(t){case 1:return e.toLowerCase();case 3:return e.replace(Ua,Ra);case 2:return e.toUpperCase();default:return e}},Ua=/(^|\s|:|-|\(|\))([a-z])/g,Ra=function(e,t,r){return e.length>0?t+r.toUpperCase():e},za=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n.src=r.currentSrc||r.src,n.intrinsicWidth=r.naturalWidth,n.intrinsicHeight=r.naturalHeight,n.context.cache.addImage(n.src),n}return t(r,e),r}(bo),Na=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n.canvas=r,n.intrinsicWidth=r.width,n.intrinsicHeight=r.height,n}return t(r,e),r}(bo),ja=function(e){function r(t,r){var n=e.call(this,t,r)||this,i=new XMLSerializer,o=s(t,r);return r.setAttribute("width",o.width+"px"),r.setAttribute("height",o.height+"px"),n.svg="data:image/svg+xml,"+encodeURIComponent(i.serializeToString(r)),n.intrinsicWidth=r.width.baseVal.value,n.intrinsicHeight=r.height.baseVal.value,n.context.cache.addImage(n.svg),n}return t(r,e),r}(bo),Qa=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n.value=r.value,n}return t(r,e),r}(bo),Va=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n.start=r.start,n.reversed="boolean"===typeof r.reversed&&!0===r.reversed,n}return t(r,e),r}(bo),Ha=[{type:15,flags:0,unit:"px",number:3}],Ga=[{type:16,flags:0,number:50}],Ka=function(e){return e.width>e.height?new a(e.left+(e.width-e.height)/2,e.top,e.height,e.height):e.width<e.height?new a(e.left,e.top+(e.height-e.width)/2,e.width,e.width):e},Wa=function(e){var t=e.type===Xa?new Array(e.value.length+1).join("\u2022"):e.value;return 0===t.length?e.placeholder||"":t},qa="checkbox",Za="radio",Xa="password",Ya=707406591,Ja=function(e){function r(t,r){var n=e.call(this,t,r)||this;switch(n.type=r.type.toLowerCase(),n.checked=r.checked,n.value=Wa(r),n.type!==qa&&n.type!==Za||(n.styles.backgroundColor=3739148031,n.styles.borderTopColor=n.styles.borderRightColor=n.styles.borderBottomColor=n.styles.borderLeftColor=2779096575,n.styles.borderTopWidth=n.styles.borderRightWidth=n.styles.borderBottomWidth=n.styles.borderLeftWidth=1,n.styles.borderTopStyle=n.styles.borderRightStyle=n.styles.borderBottomStyle=n.styles.borderLeftStyle=1,n.styles.backgroundClip=[0],n.styles.backgroundOrigin=[0],n.bounds=Ka(n.bounds)),n.type){case qa:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=Ha;break;case Za:n.styles.borderTopRightRadius=n.styles.borderTopLeftRadius=n.styles.borderBottomRightRadius=n.styles.borderBottomLeftRadius=Ga}return n}return t(r,e),r}(bo),$a=function(e){function r(t,r){var n=e.call(this,t,r)||this,i=r.options[r.selectedIndex||0];return n.value=i&&i.text||"",n}return t(r,e),r}(bo),es=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n.value=r.value,n}return t(r,e),r}(bo),ts=function(e){function r(t,r){var n=e.call(this,t,r)||this;n.src=r.src,n.width=parseInt(r.width,10)||0,n.height=parseInt(r.height,10)||0,n.backgroundColor=n.styles.backgroundColor;try{if(r.contentWindow&&r.contentWindow.document&&r.contentWindow.document.documentElement){n.tree=os(t,r.contentWindow.document.documentElement);var i=r.contentWindow.document.documentElement?dn(t,getComputedStyle(r.contentWindow.document.documentElement).backgroundColor):hn.TRANSPARENT,o=r.contentWindow.document.body?dn(t,getComputedStyle(r.contentWindow.document.body).backgroundColor):hn.TRANSPARENT;n.backgroundColor=rn(i)?rn(o)?n.styles.backgroundColor:o:i}}catch(Ut){}return n}return t(r,e),r}(bo),rs=["OL","UL","MENU"],ns=function(e,t,r,n){for(var i=t.firstChild,o=void 0;i;i=o)if(o=i.nextSibling,ls(i)&&i.data.trim().length>0)r.textNodes.push(new La(e,i,r.styles));else if(cs(i))if(Es(i)&&i.assignedNodes)i.assignedNodes().forEach(function(t){return ns(e,t,r,n)});else{var a=is(e,i);a.styles.isVisible()&&(as(i,a,n)?a.flags|=4:ss(a.styles)&&(a.flags|=2),-1!==rs.indexOf(i.tagName)&&(a.flags|=8),r.elements.push(a),i.slot,i.shadowRoot?ns(e,i.shadowRoot,a,n):Bs(i)||ms(i)||Cs(i)||ns(e,i,a,n))}},is=function(e,t){return vs(t)?new za(e,t):ys(t)?new Na(e,t):ms(t)?new ja(e,t):hs(t)?new Qa(e,t):As(t)?new Va(e,t):fs(t)?new Ja(e,t):Cs(t)?new $a(e,t):Bs(t)?new es(e,t):xs(t)?new ts(e,t):new bo(e,t)},os=function(e,t){var r=is(e,t);return r.flags|=4,ns(e,t,r,r),r},as=function(e,t,r){return t.styles.isPositionedWithZIndex()||t.styles.opacity<1||t.styles.isTransformed()||gs(e)&&r.styles.isTransparent()},ss=function(e){return e.isPositioned()||e.isFloating()},ls=function(e){return e.nodeType===Node.TEXT_NODE},cs=function(e){return e.nodeType===Node.ELEMENT_NODE},us=function(e){return cs(e)&&"undefined"!==typeof e.style&&!ds(e)},ds=function(e){return"object"===typeof e.className},hs=function(e){return"LI"===e.tagName},As=function(e){return"OL"===e.tagName},fs=function(e){return"INPUT"===e.tagName},ps=function(e){return"HTML"===e.tagName},ms=function(e){return"svg"===e.tagName},gs=function(e){return"BODY"===e.tagName},ys=function(e){return"CANVAS"===e.tagName},_s=function(e){return"VIDEO"===e.tagName},vs=function(e){return"IMG"===e.tagName},xs=function(e){return"IFRAME"===e.tagName},ws=function(e){return"STYLE"===e.tagName},bs=function(e){return"SCRIPT"===e.tagName},Bs=function(e){return"TEXTAREA"===e.tagName},Cs=function(e){return"SELECT"===e.tagName},Es=function(e){return"SLOT"===e.tagName},Ss=function(e){return e.tagName.indexOf("-")>0},Ts=function(){function e(){this.counters={}}return e.prototype.getCounterValue=function(e){var t=this.counters[e];return t&&t.length?t[t.length-1]:1},e.prototype.getCounterValues=function(e){var t=this.counters[e];return t||[]},e.prototype.pop=function(e){var t=this;e.forEach(function(e){return t.counters[e].pop()})},e.prototype.parse=function(e){var t=this,r=e.counterIncrement,n=e.counterReset,i=!0;null!==r&&r.forEach(function(e){var r=t.counters[e.counter];r&&0!==e.increment&&(i=!1,r.length||r.push(1),r[Math.max(0,r.length-1)]+=e.increment)});var o=[];return i&&n.forEach(function(e){var r=t.counters[e.counter];o.push(e.counter),r||(r=t.counters[e.counter]=[]),r.push(e.reset)}),o},e}(),Is={integers:[1e3,900,500,400,100,90,50,40,10,9,5,4,1],values:["M","CM","D","CD","C","XC","L","XL","X","IX","V","IV","I"]},Fs={integers:[9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u0554","\u0553","\u0552","\u0551","\u0550","\u054f","\u054e","\u054d","\u054c","\u054b","\u054a","\u0549","\u0548","\u0547","\u0546","\u0545","\u0544","\u0543","\u0542","\u0541","\u0540","\u053f","\u053e","\u053d","\u053c","\u053b","\u053a","\u0539","\u0538","\u0537","\u0536","\u0535","\u0534","\u0533","\u0532","\u0531"]},ks={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,400,300,200,100,90,80,70,60,50,40,30,20,19,18,17,16,15,10,9,8,7,6,5,4,3,2,1],values:["\u05d9\u05f3","\u05d8\u05f3","\u05d7\u05f3","\u05d6\u05f3","\u05d5\u05f3","\u05d4\u05f3","\u05d3\u05f3","\u05d2\u05f3","\u05d1\u05f3","\u05d0\u05f3","\u05ea","\u05e9","\u05e8","\u05e7","\u05e6","\u05e4","\u05e2","\u05e1","\u05e0","\u05de","\u05dc","\u05db","\u05d9\u05d8","\u05d9\u05d7","\u05d9\u05d6","\u05d8\u05d6","\u05d8\u05d5","\u05d9","\u05d8","\u05d7","\u05d6","\u05d5","\u05d4","\u05d3","\u05d2","\u05d1","\u05d0"]},Ps={integers:[1e4,9e3,8e3,7e3,6e3,5e3,4e3,3e3,2e3,1e3,900,800,700,600,500,400,300,200,100,90,80,70,60,50,40,30,20,10,9,8,7,6,5,4,3,2,1],values:["\u10f5","\u10f0","\u10ef","\u10f4","\u10ee","\u10ed","\u10ec","\u10eb","\u10ea","\u10e9","\u10e8","\u10e7","\u10e6","\u10e5","\u10e4","\u10f3","\u10e2","\u10e1","\u10e0","\u10df","\u10de","\u10dd","\u10f2","\u10dc","\u10db","\u10da","\u10d9","\u10d8","\u10d7","\u10f1","\u10d6","\u10d5","\u10d4","\u10d3","\u10d2","\u10d1","\u10d0"]},Ms=function(e,t,r,n,i,o){return e<t||e>r?Ks(e,i,o.length>0):n.integers.reduce(function(t,r,i){for(;e>=r;)e-=r,t+=n.values[i];return t},"")+o},Os=function(e,t,r,n){var i="";do{r||e--,i=n(e)+i,e/=t}while(e*t>=t);return i},Ls=function(e,t,r,n,i){var o=r-t+1;return(e<0?"-":"")+(Os(Math.abs(e),o,n,function(e){return u(Math.floor(e%o)+t)})+i)},Ds=function(e,t,r){void 0===r&&(r=". ");var n=t.length;return Os(Math.abs(e),n,!1,function(e){return t[Math.floor(e%n)]})+r},Us=1,Rs=2,zs=4,Ns=8,js=function(e,t,r,n,i,o){if(e<-9999||e>9999)return Ks(e,4,i.length>0);var a=Math.abs(e),s=i;if(0===a)return t[0]+s;for(var l=0;a>0&&l<=4;l++){var c=a%10;0===c&&io(o,Us)&&""!==s?s=t[c]+s:c>1||1===c&&0===l||1===c&&1===l&&io(o,Rs)||1===c&&1===l&&io(o,zs)&&e>100||1===c&&l>1&&io(o,Ns)?s=t[c]+(l>0?r[l-1]:"")+s:1===c&&l>0&&(s=r[l-1]+s),a=Math.floor(a/10)}return(e<0?n:"")+s},Qs="\u5341\u767e\u5343\u842c",Vs="\u62fe\u4f70\u4edf\u842c",Hs="\u30de\u30a4\u30ca\u30b9",Gs="\ub9c8\uc774\ub108\uc2a4",Ks=function(e,t,r){var n=r?". ":"",i=r?"\u3001":"",o=r?", ":"",a=r?" ":"";switch(t){case 0:return"\u2022"+a;case 1:return"\u25e6"+a;case 2:return"\u25fe"+a;case 5:var s=Ls(e,48,57,!0,n);return s.length<4?"0"+s:s;case 4:return Ds(e,"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",i);case 6:return Ms(e,1,3999,Is,3,n).toLowerCase();case 7:return Ms(e,1,3999,Is,3,n);case 8:return Ls(e,945,969,!1,n);case 9:return Ls(e,97,122,!1,n);case 10:return Ls(e,65,90,!1,n);case 11:return Ls(e,1632,1641,!0,n);case 12:case 49:return Ms(e,1,9999,Fs,3,n);case 35:return Ms(e,1,9999,Fs,3,n).toLowerCase();case 13:return Ls(e,2534,2543,!0,n);case 14:case 30:return Ls(e,6112,6121,!0,n);case 15:return Ds(e,"\u5b50\u4e11\u5bc5\u536f\u8fb0\u5df3\u5348\u672a\u7533\u9149\u620c\u4ea5",i);case 16:return Ds(e,"\u7532\u4e59\u4e19\u4e01\u620a\u5df1\u5e9a\u8f9b\u58ec\u7678",i);case 17:case 48:return js(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",Qs,"\u8ca0",i,Rs|zs|Ns);case 47:return js(e,"\u96f6\u58f9\u8cb3\u53c3\u8086\u4f0d\u9678\u67d2\u634c\u7396",Vs,"\u8ca0",i,Us|Rs|zs|Ns);case 42:return js(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d",Qs,"\u8d1f",i,Rs|zs|Ns);case 41:return js(e,"\u96f6\u58f9\u8d30\u53c1\u8086\u4f0d\u9646\u67d2\u634c\u7396",Vs,"\u8d1f",i,Us|Rs|zs|Ns);case 26:return js(e,"\u3007\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u5341\u767e\u5343\u4e07",Hs,i,0);case 25:return js(e,"\u96f6\u58f1\u5f10\u53c2\u56db\u4f0d\u516d\u4e03\u516b\u4e5d","\u62fe\u767e\u5343\u4e07",Hs,i,Us|Rs|zs);case 31:return js(e,"\uc601\uc77c\uc774\uc0bc\uc0ac\uc624\uc721\uce60\ud314\uad6c","\uc2ed\ubc31\ucc9c\ub9cc",Gs,o,Us|Rs|zs);case 33:return js(e,"\u96f6\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u5341\u767e\u5343\u842c",Gs,o,0);case 32:return js(e,"\u96f6\u58f9\u8cb3\u53c3\u56db\u4e94\u516d\u4e03\u516b\u4e5d","\u62fe\u767e\u5343",Gs,o,Us|Rs|zs);case 18:return Ls(e,2406,2415,!0,n);case 20:return Ms(e,1,19999,Ps,3,n);case 21:return Ls(e,2790,2799,!0,n);case 22:return Ls(e,2662,2671,!0,n);case 22:return Ms(e,1,10999,ks,3,n);case 23:return Ds(e,"\u3042\u3044\u3046\u3048\u304a\u304b\u304d\u304f\u3051\u3053\u3055\u3057\u3059\u305b\u305d\u305f\u3061\u3064\u3066\u3068\u306a\u306b\u306c\u306d\u306e\u306f\u3072\u3075\u3078\u307b\u307e\u307f\u3080\u3081\u3082\u3084\u3086\u3088\u3089\u308a\u308b\u308c\u308d\u308f\u3090\u3091\u3092\u3093");case 24:return Ds(e,"\u3044\u308d\u306f\u306b\u307b\u3078\u3068\u3061\u308a\u306c\u308b\u3092\u308f\u304b\u3088\u305f\u308c\u305d\u3064\u306d\u306a\u3089\u3080\u3046\u3090\u306e\u304a\u304f\u3084\u307e\u3051\u3075\u3053\u3048\u3066\u3042\u3055\u304d\u3086\u3081\u307f\u3057\u3091\u3072\u3082\u305b\u3059");case 27:return Ls(e,3302,3311,!0,n);case 28:return Ds(e,"\u30a2\u30a4\u30a6\u30a8\u30aa\u30ab\u30ad\u30af\u30b1\u30b3\u30b5\u30b7\u30b9\u30bb\u30bd\u30bf\u30c1\u30c4\u30c6\u30c8\u30ca\u30cb\u30cc\u30cd\u30ce\u30cf\u30d2\u30d5\u30d8\u30db\u30de\u30df\u30e0\u30e1\u30e2\u30e4\u30e6\u30e8\u30e9\u30ea\u30eb\u30ec\u30ed\u30ef\u30f0\u30f1\u30f2\u30f3",i);case 29:return Ds(e,"\u30a4\u30ed\u30cf\u30cb\u30db\u30d8\u30c8\u30c1\u30ea\u30cc\u30eb\u30f2\u30ef\u30ab\u30e8\u30bf\u30ec\u30bd\u30c4\u30cd\u30ca\u30e9\u30e0\u30a6\u30f0\u30ce\u30aa\u30af\u30e4\u30de\u30b1\u30d5\u30b3\u30a8\u30c6\u30a2\u30b5\u30ad\u30e6\u30e1\u30df\u30b7\u30f1\u30d2\u30e2\u30bb\u30b9",i);case 34:return Ls(e,3792,3801,!0,n);case 37:return Ls(e,6160,6169,!0,n);case 38:return Ls(e,4160,4169,!0,n);case 39:return Ls(e,2918,2927,!0,n);case 40:return Ls(e,1776,1785,!0,n);case 43:return Ls(e,3046,3055,!0,n);case 44:return Ls(e,3174,3183,!0,n);case 45:return Ls(e,3664,3673,!0,n);case 46:return Ls(e,3872,3881,!0,n);default:return Ls(e,48,57,!0,n)}},Ws="data-html2canvas-ignore",qs=function(){function e(e,t,r){if(this.context=e,this.options=r,this.scrolledElements=[],this.referenceElement=t,this.counters=new Ts,this.quoteDepth=0,!t.ownerDocument)throw new Error("Cloned element does not have an owner document");this.documentElement=this.cloneNode(t.ownerDocument.documentElement,!1)}return e.prototype.toIFrame=function(e,t){var r=this,o=Xs(e,t);if(!o.contentWindow)return Promise.reject("Unable to find iframe window");var a=e.defaultView.pageXOffset,s=e.defaultView.pageYOffset,l=o.contentWindow,c=l.document,u=$s(o).then(function(){return n(r,void 0,void 0,function(){var e,r;return i(this,function(n){switch(n.label){case 0:return this.scrolledElements.forEach(il),l&&(l.scrollTo(t.left,t.top),!/(iPad|iPhone|iPod)/g.test(navigator.userAgent)||l.scrollY===t.top&&l.scrollX===t.left||(this.context.logger.warn("Unable to restore scroll position for cloned document"),this.context.windowBounds=this.context.windowBounds.add(l.scrollX-t.left,l.scrollY-t.top,0,0))),e=this.options.onclone,"undefined"===typeof(r=this.clonedReferenceElement)?[2,Promise.reject("Error finding the "+this.referenceElement.nodeName+" in the cloned document")]:c.fonts&&c.fonts.ready?[4,c.fonts.ready]:[3,2];case 1:n.sent(),n.label=2;case 2:return/(AppleWebKit)/g.test(navigator.userAgent)?[4,Js(c)]:[3,4];case 3:n.sent(),n.label=4;case 4:return"function"===typeof e?[2,Promise.resolve().then(function(){return e(c,r)}).then(function(){return o})]:[2,o]}})})});return c.open(),c.write(rl(document.doctype)+"<html></html>"),nl(this.referenceElement.ownerDocument,a,s),c.replaceChild(c.adoptNode(this.documentElement),c.documentElement),c.close(),u},e.prototype.createElementClone=function(e){if(wo(e,2),ys(e))return this.createCanvasClone(e);if(_s(e))return this.createVideoClone(e);if(ws(e))return this.createStyleClone(e);var t=e.cloneNode(!1);return vs(t)&&(vs(e)&&e.currentSrc&&e.currentSrc!==e.src&&(t.src=e.currentSrc,t.srcset=""),"lazy"===t.loading&&(t.loading="eager")),Ss(t)?this.createCustomElementClone(t):t},e.prototype.createCustomElementClone=function(e){var t=document.createElement("html2canvascustomelement");return tl(e.style,t),t},e.prototype.createStyleClone=function(e){try{var t=e.sheet;if(t&&t.cssRules){var r=[].slice.call(t.cssRules,0).reduce(function(e,t){return t&&"string"===typeof t.cssText?e+t.cssText:e},""),n=e.cloneNode(!1);return n.textContent=r,n}}catch(Ut){if(this.context.logger.error("Unable to access cssRules property",Ut),"SecurityError"!==Ut.name)throw Ut}return e.cloneNode(!1)},e.prototype.createCanvasClone=function(e){var t;if(this.options.inlineImages&&e.ownerDocument){var r=e.ownerDocument.createElement("img");try{return r.src=e.toDataURL(),r}catch(Ut){this.context.logger.info("Unable to inline canvas contents, canvas is tainted",e)}}var n=e.cloneNode(!1);try{n.width=e.width,n.height=e.height;var i=e.getContext("2d"),o=n.getContext("2d");if(o)if(!this.options.allowTaint&&i)o.putImageData(i.getImageData(0,0,e.width,e.height),0,0);else{var a=null!==(t=e.getContext("webgl2"))&&void 0!==t?t:e.getContext("webgl");if(a){var s=a.getContextAttributes();!1===(null===s||void 0===s?void 0:s.preserveDrawingBuffer)&&this.context.logger.warn("Unable to clone WebGL context as it has preserveDrawingBuffer=false",e)}o.drawImage(e,0,0)}return n}catch(Ut){this.context.logger.info("Unable to clone canvas as it is tainted",e)}return n},e.prototype.createVideoClone=function(e){var t=e.ownerDocument.createElement("canvas");t.width=e.offsetWidth,t.height=e.offsetHeight;var r=t.getContext("2d");try{return r&&(r.drawImage(e,0,0,t.width,t.height),this.options.allowTaint||r.getImageData(0,0,t.width,t.height)),t}catch(Ut){this.context.logger.info("Unable to clone video as it is tainted",e)}var n=e.ownerDocument.createElement("canvas");return n.width=e.offsetWidth,n.height=e.offsetHeight,n},e.prototype.appendChildNode=function(e,t,r){cs(t)&&(bs(t)||t.hasAttribute(Ws)||"function"===typeof this.options.ignoreElements&&this.options.ignoreElements(t))||this.options.copyStyles&&cs(t)&&ws(t)||e.appendChild(this.cloneNode(t,r))},e.prototype.cloneChildNodes=function(e,t,r){for(var n=this,i=e.shadowRoot?e.shadowRoot.firstChild:e.firstChild;i;i=i.nextSibling)if(cs(i)&&Es(i)&&"function"===typeof i.assignedNodes){var o=i.assignedNodes();o.length&&o.forEach(function(e){return n.appendChildNode(t,e,r)})}else this.appendChildNode(t,i,r)},e.prototype.cloneNode=function(e,t){if(ls(e))return document.createTextNode(e.data);if(!e.ownerDocument)return e.cloneNode(!1);var r=e.ownerDocument.defaultView;if(r&&cs(e)&&(us(e)||ds(e))){var n=this.createElementClone(e);n.style.transitionProperty="none";var i=r.getComputedStyle(e),o=r.getComputedStyle(e,":before"),a=r.getComputedStyle(e,":after");this.referenceElement===e&&us(n)&&(this.clonedReferenceElement=n),gs(n)&&ul(n);var s=this.counters.parse(new yo(this.context,i)),l=this.resolvePseudoContent(e,n,o,Ko.BEFORE);Ss(e)&&(t=!0),_s(e)||this.cloneChildNodes(e,n,t),l&&n.insertBefore(l,n.firstChild);var c=this.resolvePseudoContent(e,n,a,Ko.AFTER);return c&&n.appendChild(c),this.counters.pop(s),(i&&(this.options.copyStyles||ds(e))&&!xs(e)||t)&&tl(i,n),0===e.scrollTop&&0===e.scrollLeft||this.scrolledElements.push([n,e.scrollLeft,e.scrollTop]),(Bs(e)||Cs(e))&&(Bs(n)||Cs(n))&&(n.value=e.value),n}return e.cloneNode(!1)},e.prototype.resolvePseudoContent=function(e,t,r,n){var i=this;if(r){var o=r.content,a=t.ownerDocument;if(a&&o&&"none"!==o&&"-moz-alt-content"!==o&&"none"!==r.display){this.counters.parse(new yo(this.context,r));var s=new go(this.context,r),l=a.createElement("html2canvaspseudoelement");tl(r,l),s.content.forEach(function(t){if(0===t.type)l.appendChild(a.createTextNode(t.value));else if(22===t.type){var r=a.createElement("img");r.src=t.value,r.style.opacity="1",l.appendChild(r)}else if(18===t.type){if("attr"===t.name){var n=t.values.filter(Pr);n.length&&l.appendChild(a.createTextNode(e.getAttribute(n[0].value)||""))}else if("counter"===t.name){var o=t.values.filter(Dr),c=o[0],u=o[1];if(c&&Pr(c)){var d=i.counters.getCounterValue(c.value),h=u&&Pr(u)?Bi.parse(i.context,u.value):3;l.appendChild(a.createTextNode(Ks(d,h,!1)))}}else if("counters"===t.name){var A=t.values.filter(Dr),f=(c=A[0],A[1]);if(u=A[2],c&&Pr(c)){var p=i.counters.getCounterValues(c.value),m=u&&Pr(u)?Bi.parse(i.context,u.value):3,g=f&&0===f.type?f.value:"",y=p.map(function(e){return Ks(e,m,!1)}).join(g);l.appendChild(a.createTextNode(y))}}}else if(20===t.type)switch(t.value){case"open-quote":l.appendChild(a.createTextNode(uo(s.quotes,i.quoteDepth++,!0)));break;case"close-quote":l.appendChild(a.createTextNode(uo(s.quotes,--i.quoteDepth,!1)));break;default:l.appendChild(a.createTextNode(t.value))}}),l.className=sl+" "+ll;var c=n===Ko.BEFORE?" "+sl:" "+ll;return ds(t)?t.className.baseValue+=c:t.className+=c,l}}},e.destroy=function(e){return!!e.parentNode&&(e.parentNode.removeChild(e),!0)},e}();!function(e){e[e.BEFORE=0]="BEFORE",e[e.AFTER=1]="AFTER"}(Ko||(Ko={}));var Zs,Xs=function(e,t){var r=e.createElement("iframe");return r.className="html2canvas-container",r.style.visibility="hidden",r.style.position="fixed",r.style.left="-10000px",r.style.top="0px",r.style.border="0",r.width=t.width.toString(),r.height=t.height.toString(),r.scrolling="no",r.setAttribute(Ws,"true"),e.body.appendChild(r),r},Ys=function(e){return new Promise(function(t){e.complete?t():e.src?(e.onload=t,e.onerror=t):t()})},Js=function(e){return Promise.all([].slice.call(e.images,0).map(Ys))},$s=function(e){return new Promise(function(t,r){var n=e.contentWindow;if(!n)return r("No window assigned for iframe");var i=n.document;n.onload=e.onload=function(){n.onload=e.onload=null;var r=setInterval(function(){i.body.childNodes.length>0&&"complete"===i.readyState&&(clearInterval(r),t(e))},50)}})},el=["all","d","content"],tl=function(e,t){for(var r=e.length-1;r>=0;r--){var n=e.item(r);-1===el.indexOf(n)&&t.style.setProperty(n,e.getPropertyValue(n))}return t},rl=function(e){var t="";return e&&(t+="<!DOCTYPE ",e.name&&(t+=e.name),e.internalSubset&&(t+=e.internalSubset),e.publicId&&(t+='"'+e.publicId+'"'),e.systemId&&(t+='"'+e.systemId+'"'),t+=">"),t},nl=function(e,t,r){e&&e.defaultView&&(t!==e.defaultView.pageXOffset||r!==e.defaultView.pageYOffset)&&e.defaultView.scrollTo(t,r)},il=function(e){var t=e[0],r=e[1],n=e[2];t.scrollLeft=r,t.scrollTop=n},ol=":before",al=":after",sl="___html2canvas___pseudoelement_before",ll="___html2canvas___pseudoelement_after",cl='{\n    content: "" !important;\n    display: none !important;\n}',ul=function(e){dl(e,"."+sl+ol+cl+"\n         ."+ll+al+cl)},dl=function(e,t){var r=e.ownerDocument;if(r){var n=r.createElement("style");n.textContent=t,e.appendChild(n)}},hl=function(){function e(){}return e.getOrigin=function(t){var r=e._link;return r?(r.href=t,r.href=r.href,r.protocol+r.hostname+r.port):"about:blank"},e.isSameOrigin=function(t){return e.getOrigin(t)===e._origin},e.setContext=function(t){e._link=t.document.createElement("a"),e._origin=e.getOrigin(t.location.href)},e._origin="about:blank",e}(),Al=function(){function e(e,t){this.context=e,this._options=t,this._cache={}}return e.prototype.addImage=function(e){var t=Promise.resolve();return this.has(e)?t:vl(e)||gl(e)?((this._cache[e]=this.loadImage(e)).catch(function(){}),t):t},e.prototype.match=function(e){return this._cache[e]},e.prototype.loadImage=function(e){return n(this,void 0,void 0,function(){var t,r,n,o,a=this;return i(this,function(i){switch(i.label){case 0:return t=hl.isSameOrigin(e),r=!yl(e)&&!0===this._options.useCORS&&Ca.SUPPORT_CORS_IMAGES&&!t,n=!yl(e)&&!t&&!vl(e)&&"string"===typeof this._options.proxy&&Ca.SUPPORT_CORS_XHR&&!r,t||!1!==this._options.allowTaint||yl(e)||vl(e)||n||r?(o=e,n?[4,this.proxy(o)]:[3,2]):[2];case 1:o=i.sent(),i.label=2;case 2:return this.context.logger.debug("Added image "+e.substring(0,256)),[4,new Promise(function(e,t){var n=new Image;n.onload=function(){return e(n)},n.onerror=t,(_l(o)||r)&&(n.crossOrigin="anonymous"),n.src=o,!0===n.complete&&setTimeout(function(){return e(n)},500),a._options.imageTimeout>0&&setTimeout(function(){return t("Timed out ("+a._options.imageTimeout+"ms) loading image")},a._options.imageTimeout)})];case 3:return[2,i.sent()]}})})},e.prototype.has=function(e){return"undefined"!==typeof this._cache[e]},e.prototype.keys=function(){return Promise.resolve(Object.keys(this._cache))},e.prototype.proxy=function(e){var t=this,r=this._options.proxy;if(!r)throw new Error("No proxy defined");var n=e.substring(0,256);return new Promise(function(i,o){var a=Ca.SUPPORT_RESPONSE_TYPE?"blob":"text",s=new XMLHttpRequest;s.onload=function(){if(200===s.status)if("text"===a)i(s.response);else{var e=new FileReader;e.addEventListener("load",function(){return i(e.result)},!1),e.addEventListener("error",function(e){return o(e)},!1),e.readAsDataURL(s.response)}else o("Failed to proxy resource "+n+" with status code "+s.status)},s.onerror=o;var l=r.indexOf("?")>-1?"&":"?";if(s.open("GET",""+r+l+"url="+encodeURIComponent(e)+"&responseType="+a),"text"!==a&&s instanceof XMLHttpRequest&&(s.responseType=a),t._options.imageTimeout){var c=t._options.imageTimeout;s.timeout=c,s.ontimeout=function(){return o("Timed out ("+c+"ms) proxying "+n)}}s.send()})},e}(),fl=/^data:image\/svg\+xml/i,pl=/^data:image\/.*;base64,/i,ml=/^data:image\/.*/i,gl=function(e){return Ca.SUPPORT_SVG_DRAWING||!xl(e)},yl=function(e){return ml.test(e)},_l=function(e){return pl.test(e)},vl=function(e){return"blob"===e.substr(0,4)},xl=function(e){return"svg"===e.substr(-3).toLowerCase()||fl.test(e)},wl=function(){function e(e,t){this.type=0,this.x=e,this.y=t}return e.prototype.add=function(t,r){return new e(this.x+t,this.y+r)},e}(),bl=function(e,t,r){return new wl(e.x+(t.x-e.x)*r,e.y+(t.y-e.y)*r)},Bl=function(){function e(e,t,r,n){this.type=1,this.start=e,this.startControl=t,this.endControl=r,this.end=n}return e.prototype.subdivide=function(t,r){var n=bl(this.start,this.startControl,t),i=bl(this.startControl,this.endControl,t),o=bl(this.endControl,this.end,t),a=bl(n,i,t),s=bl(i,o,t),l=bl(a,s,t);return r?new e(this.start,n,a,l):new e(l,s,o,this.end)},e.prototype.add=function(t,r){return new e(this.start.add(t,r),this.startControl.add(t,r),this.endControl.add(t,r),this.end.add(t,r))},e.prototype.reverse=function(){return new e(this.end,this.endControl,this.startControl,this.start)},e}(),Cl=function(e){return 1===e.type},El=function(){function e(e){var t=e.styles,r=e.bounds,n=Gr(t.borderTopLeftRadius,r.width,r.height),i=n[0],o=n[1],a=Gr(t.borderTopRightRadius,r.width,r.height),s=a[0],l=a[1],c=Gr(t.borderBottomRightRadius,r.width,r.height),u=c[0],d=c[1],h=Gr(t.borderBottomLeftRadius,r.width,r.height),A=h[0],f=h[1],p=[];p.push((i+s)/r.width),p.push((A+u)/r.width),p.push((o+f)/r.height),p.push((l+d)/r.height);var m=Math.max.apply(Math,p);m>1&&(i/=m,o/=m,s/=m,l/=m,u/=m,d/=m,A/=m,f/=m);var g=r.width-s,y=r.height-d,_=r.width-u,v=r.height-f,x=t.borderTopWidth,w=t.borderRightWidth,b=t.borderBottomWidth,B=t.borderLeftWidth,C=Kr(t.paddingTop,e.bounds.width),E=Kr(t.paddingRight,e.bounds.width),S=Kr(t.paddingBottom,e.bounds.width),T=Kr(t.paddingLeft,e.bounds.width);this.topLeftBorderDoubleOuterBox=i>0||o>0?Sl(r.left+B/3,r.top+x/3,i-B/3,o-x/3,Zs.TOP_LEFT):new wl(r.left+B/3,r.top+x/3),this.topRightBorderDoubleOuterBox=i>0||o>0?Sl(r.left+g,r.top+x/3,s-w/3,l-x/3,Zs.TOP_RIGHT):new wl(r.left+r.width-w/3,r.top+x/3),this.bottomRightBorderDoubleOuterBox=u>0||d>0?Sl(r.left+_,r.top+y,u-w/3,d-b/3,Zs.BOTTOM_RIGHT):new wl(r.left+r.width-w/3,r.top+r.height-b/3),this.bottomLeftBorderDoubleOuterBox=A>0||f>0?Sl(r.left+B/3,r.top+v,A-B/3,f-b/3,Zs.BOTTOM_LEFT):new wl(r.left+B/3,r.top+r.height-b/3),this.topLeftBorderDoubleInnerBox=i>0||o>0?Sl(r.left+2*B/3,r.top+2*x/3,i-2*B/3,o-2*x/3,Zs.TOP_LEFT):new wl(r.left+2*B/3,r.top+2*x/3),this.topRightBorderDoubleInnerBox=i>0||o>0?Sl(r.left+g,r.top+2*x/3,s-2*w/3,l-2*x/3,Zs.TOP_RIGHT):new wl(r.left+r.width-2*w/3,r.top+2*x/3),this.bottomRightBorderDoubleInnerBox=u>0||d>0?Sl(r.left+_,r.top+y,u-2*w/3,d-2*b/3,Zs.BOTTOM_RIGHT):new wl(r.left+r.width-2*w/3,r.top+r.height-2*b/3),this.bottomLeftBorderDoubleInnerBox=A>0||f>0?Sl(r.left+2*B/3,r.top+v,A-2*B/3,f-2*b/3,Zs.BOTTOM_LEFT):new wl(r.left+2*B/3,r.top+r.height-2*b/3),this.topLeftBorderStroke=i>0||o>0?Sl(r.left+B/2,r.top+x/2,i-B/2,o-x/2,Zs.TOP_LEFT):new wl(r.left+B/2,r.top+x/2),this.topRightBorderStroke=i>0||o>0?Sl(r.left+g,r.top+x/2,s-w/2,l-x/2,Zs.TOP_RIGHT):new wl(r.left+r.width-w/2,r.top+x/2),this.bottomRightBorderStroke=u>0||d>0?Sl(r.left+_,r.top+y,u-w/2,d-b/2,Zs.BOTTOM_RIGHT):new wl(r.left+r.width-w/2,r.top+r.height-b/2),this.bottomLeftBorderStroke=A>0||f>0?Sl(r.left+B/2,r.top+v,A-B/2,f-b/2,Zs.BOTTOM_LEFT):new wl(r.left+B/2,r.top+r.height-b/2),this.topLeftBorderBox=i>0||o>0?Sl(r.left,r.top,i,o,Zs.TOP_LEFT):new wl(r.left,r.top),this.topRightBorderBox=s>0||l>0?Sl(r.left+g,r.top,s,l,Zs.TOP_RIGHT):new wl(r.left+r.width,r.top),this.bottomRightBorderBox=u>0||d>0?Sl(r.left+_,r.top+y,u,d,Zs.BOTTOM_RIGHT):new wl(r.left+r.width,r.top+r.height),this.bottomLeftBorderBox=A>0||f>0?Sl(r.left,r.top+v,A,f,Zs.BOTTOM_LEFT):new wl(r.left,r.top+r.height),this.topLeftPaddingBox=i>0||o>0?Sl(r.left+B,r.top+x,Math.max(0,i-B),Math.max(0,o-x),Zs.TOP_LEFT):new wl(r.left+B,r.top+x),this.topRightPaddingBox=s>0||l>0?Sl(r.left+Math.min(g,r.width-w),r.top+x,g>r.width+w?0:Math.max(0,s-w),Math.max(0,l-x),Zs.TOP_RIGHT):new wl(r.left+r.width-w,r.top+x),this.bottomRightPaddingBox=u>0||d>0?Sl(r.left+Math.min(_,r.width-B),r.top+Math.min(y,r.height-b),Math.max(0,u-w),Math.max(0,d-b),Zs.BOTTOM_RIGHT):new wl(r.left+r.width-w,r.top+r.height-b),this.bottomLeftPaddingBox=A>0||f>0?Sl(r.left+B,r.top+Math.min(v,r.height-b),Math.max(0,A-B),Math.max(0,f-b),Zs.BOTTOM_LEFT):new wl(r.left+B,r.top+r.height-b),this.topLeftContentBox=i>0||o>0?Sl(r.left+B+T,r.top+x+C,Math.max(0,i-(B+T)),Math.max(0,o-(x+C)),Zs.TOP_LEFT):new wl(r.left+B+T,r.top+x+C),this.topRightContentBox=s>0||l>0?Sl(r.left+Math.min(g,r.width+B+T),r.top+x+C,g>r.width+B+T?0:s-B+T,l-(x+C),Zs.TOP_RIGHT):new wl(r.left+r.width-(w+E),r.top+x+C),this.bottomRightContentBox=u>0||d>0?Sl(r.left+Math.min(_,r.width-(B+T)),r.top+Math.min(y,r.height+x+C),Math.max(0,u-(w+E)),d-(b+S),Zs.BOTTOM_RIGHT):new wl(r.left+r.width-(w+E),r.top+r.height-(b+S)),this.bottomLeftContentBox=A>0||f>0?Sl(r.left+B+T,r.top+v,Math.max(0,A-(B+T)),f-(b+S),Zs.BOTTOM_LEFT):new wl(r.left+B+T,r.top+r.height-(b+S))}return e}();!function(e){e[e.TOP_LEFT=0]="TOP_LEFT",e[e.TOP_RIGHT=1]="TOP_RIGHT",e[e.BOTTOM_RIGHT=2]="BOTTOM_RIGHT",e[e.BOTTOM_LEFT=3]="BOTTOM_LEFT"}(Zs||(Zs={}));var Sl=function(e,t,r,n,i){var o=(Math.sqrt(2)-1)/3*4,a=r*o,s=n*o,l=e+r,c=t+n;switch(i){case Zs.TOP_LEFT:return new Bl(new wl(e,c),new wl(e,c-s),new wl(l-a,t),new wl(l,t));case Zs.TOP_RIGHT:return new Bl(new wl(e,t),new wl(e+a,t),new wl(l,c-s),new wl(l,c));case Zs.BOTTOM_RIGHT:return new Bl(new wl(l,t),new wl(l,t+s),new wl(e+a,c),new wl(e,c));case Zs.BOTTOM_LEFT:default:return new Bl(new wl(l,c),new wl(l-a,c),new wl(e,t+s),new wl(e,t))}},Tl=function(e){return[e.topLeftBorderBox,e.topRightBorderBox,e.bottomRightBorderBox,e.bottomLeftBorderBox]},Il=function(e){return[e.topLeftContentBox,e.topRightContentBox,e.bottomRightContentBox,e.bottomLeftContentBox]},Fl=function(e){return[e.topLeftPaddingBox,e.topRightPaddingBox,e.bottomRightPaddingBox,e.bottomLeftPaddingBox]},kl=function(){function e(e,t,r){this.offsetX=e,this.offsetY=t,this.matrix=r,this.type=0,this.target=6}return e}(),Pl=function(){function e(e,t){this.path=e,this.target=t,this.type=1}return e}(),Ml=function(){function e(e){this.opacity=e,this.type=2,this.target=6}return e}(),Ol=function(e){return 0===e.type},Ll=function(e){return 1===e.type},Dl=function(e){return 2===e.type},Ul=function(e,t){return e.length===t.length&&e.some(function(e,r){return e===t[r]})},Rl=function(e,t,r,n,i){return e.map(function(e,o){switch(o){case 0:return e.add(t,r);case 1:return e.add(t+n,r);case 2:return e.add(t+n,r+i);case 3:return e.add(t,r+i)}return e})},zl=function(){function e(e){this.element=e,this.inlineLevel=[],this.nonInlineLevel=[],this.negativeZIndex=[],this.zeroOrAutoZIndexOrTransformedOrOpacity=[],this.positiveZIndex=[],this.nonPositionedFloats=[],this.nonPositionedInlineLevel=[]}return e}(),Nl=function(){function e(e,t){if(this.container=e,this.parent=t,this.effects=[],this.curves=new El(this.container),this.container.styles.opacity<1&&this.effects.push(new Ml(this.container.styles.opacity)),null!==this.container.styles.transform){var r=this.container.bounds.left+this.container.styles.transformOrigin[0].number,n=this.container.bounds.top+this.container.styles.transformOrigin[1].number,i=this.container.styles.transform;this.effects.push(new kl(r,n,i))}if(0!==this.container.styles.overflowX){var o=Tl(this.curves),a=Fl(this.curves);Ul(o,a)?this.effects.push(new Pl(o,6)):(this.effects.push(new Pl(o,2)),this.effects.push(new Pl(a,4)))}}return e.prototype.getEffects=function(e){for(var t=-1===[2,3].indexOf(this.container.styles.position),r=this.parent,n=this.effects.slice(0);r;){var i=r.effects.filter(function(e){return!Ll(e)});if(t||0!==r.container.styles.position||!r.parent){if(n.unshift.apply(n,i),t=-1===[2,3].indexOf(r.container.styles.position),0!==r.container.styles.overflowX){var o=Tl(r.curves),a=Fl(r.curves);Ul(o,a)||n.unshift(new Pl(a,6))}}else n.unshift.apply(n,i);r=r.parent}return n.filter(function(t){return io(t.target,e)})},e}(),jl=function(e,t,r,n){e.container.elements.forEach(function(i){var o=io(i.flags,4),a=io(i.flags,2),s=new Nl(i,e);io(i.styles.display,2048)&&n.push(s);var l=io(i.flags,8)?[]:n;if(o||a){var c=o||i.styles.isPositioned()?r:t,u=new zl(s);if(i.styles.isPositioned()||i.styles.opacity<1||i.styles.isTransformed()){var d=i.styles.zIndex.order;if(d<0){var h=0;c.negativeZIndex.some(function(e,t){return d>e.element.container.styles.zIndex.order?(h=t,!1):h>0}),c.negativeZIndex.splice(h,0,u)}else if(d>0){var A=0;c.positiveZIndex.some(function(e,t){return d>=e.element.container.styles.zIndex.order?(A=t+1,!1):A>0}),c.positiveZIndex.splice(A,0,u)}else c.zeroOrAutoZIndexOrTransformedOrOpacity.push(u)}else i.styles.isFloating()?c.nonPositionedFloats.push(u):c.nonPositionedInlineLevel.push(u);jl(s,u,o?u:r,l)}else i.styles.isInlineLevel()?t.inlineLevel.push(s):t.nonInlineLevel.push(s),jl(s,t,r,l);io(i.flags,8)&&Ql(i,l)})},Ql=function(e,t){for(var r=e instanceof Va?e.start:1,n=e instanceof Va&&e.reversed,i=0;i<t.length;i++){var o=t[i];o.container instanceof Qa&&"number"===typeof o.container.value&&0!==o.container.value&&(r=o.container.value),o.listValue=Ks(r,o.container.styles.listStyleType,!0),r+=n?-1:1}},Vl=function(e){var t=new Nl(e,null),r=new zl(t),n=[];return jl(t,r,r,n),Ql(t.container,n),r},Hl=function(e,t){switch(t){case 0:return Zl(e.topLeftBorderBox,e.topLeftPaddingBox,e.topRightBorderBox,e.topRightPaddingBox);case 1:return Zl(e.topRightBorderBox,e.topRightPaddingBox,e.bottomRightBorderBox,e.bottomRightPaddingBox);case 2:return Zl(e.bottomRightBorderBox,e.bottomRightPaddingBox,e.bottomLeftBorderBox,e.bottomLeftPaddingBox);default:return Zl(e.bottomLeftBorderBox,e.bottomLeftPaddingBox,e.topLeftBorderBox,e.topLeftPaddingBox)}},Gl=function(e,t){switch(t){case 0:return Zl(e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox,e.topRightBorderBox,e.topRightBorderDoubleOuterBox);case 1:return Zl(e.topRightBorderBox,e.topRightBorderDoubleOuterBox,e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox);case 2:return Zl(e.bottomRightBorderBox,e.bottomRightBorderDoubleOuterBox,e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox);default:return Zl(e.bottomLeftBorderBox,e.bottomLeftBorderDoubleOuterBox,e.topLeftBorderBox,e.topLeftBorderDoubleOuterBox)}},Kl=function(e,t){switch(t){case 0:return Zl(e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox,e.topRightBorderDoubleInnerBox,e.topRightPaddingBox);case 1:return Zl(e.topRightBorderDoubleInnerBox,e.topRightPaddingBox,e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox);case 2:return Zl(e.bottomRightBorderDoubleInnerBox,e.bottomRightPaddingBox,e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox);default:return Zl(e.bottomLeftBorderDoubleInnerBox,e.bottomLeftPaddingBox,e.topLeftBorderDoubleInnerBox,e.topLeftPaddingBox)}},Wl=function(e,t){switch(t){case 0:return ql(e.topLeftBorderStroke,e.topRightBorderStroke);case 1:return ql(e.topRightBorderStroke,e.bottomRightBorderStroke);case 2:return ql(e.bottomRightBorderStroke,e.bottomLeftBorderStroke);default:return ql(e.bottomLeftBorderStroke,e.topLeftBorderStroke)}},ql=function(e,t){var r=[];return Cl(e)?r.push(e.subdivide(.5,!1)):r.push(e),Cl(t)?r.push(t.subdivide(.5,!0)):r.push(t),r},Zl=function(e,t,r,n){var i=[];return Cl(e)?i.push(e.subdivide(.5,!1)):i.push(e),Cl(r)?i.push(r.subdivide(.5,!0)):i.push(r),Cl(n)?i.push(n.subdivide(.5,!0).reverse()):i.push(n),Cl(t)?i.push(t.subdivide(.5,!1).reverse()):i.push(t),i},Xl=function(e){var t=e.bounds,r=e.styles;return t.add(r.borderLeftWidth,r.borderTopWidth,-(r.borderRightWidth+r.borderLeftWidth),-(r.borderTopWidth+r.borderBottomWidth))},Yl=function(e){var t=e.styles,r=e.bounds,n=Kr(t.paddingLeft,r.width),i=Kr(t.paddingRight,r.width),o=Kr(t.paddingTop,r.width),a=Kr(t.paddingBottom,r.width);return r.add(n+t.borderLeftWidth,o+t.borderTopWidth,-(t.borderRightWidth+t.borderLeftWidth+n+i),-(t.borderTopWidth+t.borderBottomWidth+o+a))},Jl=function(e,t){return 0===e?t.bounds:2===e?Yl(t):Xl(t)},$l=function(e,t){return 0===e?t.bounds:2===e?Yl(t):Xl(t)},ec=function(e,t,r){var n=Jl(ic(e.styles.backgroundOrigin,t),e),i=$l(ic(e.styles.backgroundClip,t),e),o=nc(ic(e.styles.backgroundSize,t),r,n),a=o[0],s=o[1],l=Gr(ic(e.styles.backgroundPosition,t),n.width-a,n.height-s);return[oc(ic(e.styles.backgroundRepeat,t),l,o,n,i),Math.round(n.left+l[0]),Math.round(n.top+l[1]),a,s]},tc=function(e){return Pr(e)&&e.value===Dn.AUTO},rc=function(e){return"number"===typeof e},nc=function(e,t,r){var n=t[0],i=t[1],o=t[2],a=e[0],s=e[1];if(!a)return[0,0];if(Nr(a)&&s&&Nr(s))return[Kr(a,r.width),Kr(s,r.height)];var l=rc(o);if(Pr(a)&&(a.value===Dn.CONTAIN||a.value===Dn.COVER))return rc(o)?r.width/r.height<o!==(a.value===Dn.COVER)?[r.width,r.width/o]:[r.height*o,r.height]:[r.width,r.height];var c=rc(n),u=rc(i),d=c||u;if(tc(a)&&(!s||tc(s)))return c&&u?[n,i]:l||d?d&&l?[c?n:i*o,u?i:n/o]:[c?n:r.width,u?i:r.height]:[r.width,r.height];if(l){var h=0,A=0;return Nr(a)?h=Kr(a,r.width):Nr(s)&&(A=Kr(s,r.height)),tc(a)?h=A*o:s&&!tc(s)||(A=h/o),[h,A]}var f=null,p=null;if(Nr(a)?f=Kr(a,r.width):s&&Nr(s)&&(p=Kr(s,r.height)),null===f||s&&!tc(s)||(p=c&&u?f/n*i:r.height),null!==p&&tc(a)&&(f=c&&u?p/i*n:r.width),null!==f&&null!==p)return[f,p];throw new Error("Unable to calculate background-size for element")},ic=function(e,t){var r=e[t];return"undefined"===typeof r?e[0]:r},oc=function(e,t,r,n,i){var o=t[0],a=t[1],s=r[0],l=r[1];switch(e){case 2:return[new wl(Math.round(n.left),Math.round(n.top+a)),new wl(Math.round(n.left+n.width),Math.round(n.top+a)),new wl(Math.round(n.left+n.width),Math.round(l+n.top+a)),new wl(Math.round(n.left),Math.round(l+n.top+a))];case 3:return[new wl(Math.round(n.left+o),Math.round(n.top)),new wl(Math.round(n.left+o+s),Math.round(n.top)),new wl(Math.round(n.left+o+s),Math.round(n.height+n.top)),new wl(Math.round(n.left+o),Math.round(n.height+n.top))];case 1:return[new wl(Math.round(n.left+o),Math.round(n.top+a)),new wl(Math.round(n.left+o+s),Math.round(n.top+a)),new wl(Math.round(n.left+o+s),Math.round(n.top+a+l)),new wl(Math.round(n.left+o),Math.round(n.top+a+l))];default:return[new wl(Math.round(i.left),Math.round(i.top)),new wl(Math.round(i.left+i.width),Math.round(i.top)),new wl(Math.round(i.left+i.width),Math.round(i.height+i.top)),new wl(Math.round(i.left),Math.round(i.height+i.top))]}},ac="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",sc="Hidden Text",lc=function(){function e(e){this._data={},this._document=e}return e.prototype.parseMetrics=function(e,t){var r=this._document.createElement("div"),n=this._document.createElement("img"),i=this._document.createElement("span"),o=this._document.body;r.style.visibility="hidden",r.style.fontFamily=e,r.style.fontSize=t,r.style.margin="0",r.style.padding="0",r.style.whiteSpace="nowrap",o.appendChild(r),n.src=ac,n.width=1,n.height=1,n.style.margin="0",n.style.padding="0",n.style.verticalAlign="baseline",i.style.fontFamily=e,i.style.fontSize=t,i.style.margin="0",i.style.padding="0",i.appendChild(this._document.createTextNode(sc)),r.appendChild(i),r.appendChild(n);var a=n.offsetTop-i.offsetTop+2;r.removeChild(i),r.appendChild(this._document.createTextNode(sc)),r.style.lineHeight="normal",n.style.verticalAlign="super";var s=n.offsetTop-r.offsetTop+2;return o.removeChild(r),{baseline:a,middle:s}},e.prototype.getMetrics=function(e,t){var r=e+" "+t;return"undefined"===typeof this._data[r]&&(this._data[r]=this.parseMetrics(e,t)),this._data[r]},e}(),cc=function(){function e(e,t){this.context=e,this.options=t}return e}(),uc=1e4,dc=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n._activeEffects=[],n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),r.canvas||(n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px"),n.fontMetrics=new lc(document),n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.ctx.textBaseline="bottom",n._activeEffects=[],n.context.logger.debug("Canvas renderer initialized ("+r.width+"x"+r.height+") with scale "+r.scale),n}return t(r,e),r.prototype.applyEffects=function(e){for(var t=this;this._activeEffects.length;)this.popEffect();e.forEach(function(e){return t.applyEffect(e)})},r.prototype.applyEffect=function(e){this.ctx.save(),Dl(e)&&(this.ctx.globalAlpha=e.opacity),Ol(e)&&(this.ctx.translate(e.offsetX,e.offsetY),this.ctx.transform(e.matrix[0],e.matrix[1],e.matrix[2],e.matrix[3],e.matrix[4],e.matrix[5]),this.ctx.translate(-e.offsetX,-e.offsetY)),Ll(e)&&(this.path(e.path),this.ctx.clip()),this._activeEffects.push(e)},r.prototype.popEffect=function(){this._activeEffects.pop(),this.ctx.restore()},r.prototype.renderStack=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return e.element.container.styles.isVisible()?[4,this.renderStackContent(e)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},r.prototype.renderNode=function(e){return n(this,void 0,void 0,function(){return i(this,function(t){switch(t.label){case 0:return io(e.container.flags,16),e.container.styles.isVisible()?[4,this.renderNodeBackgroundAndBorders(e)]:[3,3];case 1:return t.sent(),[4,this.renderNodeContent(e)];case 2:t.sent(),t.label=3;case 3:return[2]}})})},r.prototype.renderTextWithLetterSpacing=function(e,t,r){var n=this;0===t?this.ctx.fillText(e.text,e.bounds.left,e.bounds.top+r):Fa(e.text).reduce(function(t,i){return n.ctx.fillText(i,t,e.bounds.top+r),t+n.ctx.measureText(i).width},e.bounds.left)},r.prototype.createFontStyle=function(e){var t=e.fontVariant.filter(function(e){return"normal"===e||"small-caps"===e}).join(""),r=mc(e.fontFamily).join(", "),n=Fr(e.fontSize)?""+e.fontSize.number+e.fontSize.unit:e.fontSize.number+"px";return[[e.fontStyle,t,e.fontWeight,n,r].join(" "),r,n]},r.prototype.renderTextNode=function(e,t){return n(this,void 0,void 0,function(){var r,n,o,a,s,l,c,u,d=this;return i(this,function(i){return r=this.createFontStyle(t),n=r[0],o=r[1],a=r[2],this.ctx.font=n,this.ctx.direction=1===t.direction?"rtl":"ltr",this.ctx.textAlign="left",this.ctx.textBaseline="alphabetic",s=this.fontMetrics.getMetrics(o,a),l=s.baseline,c=s.middle,u=t.paintOrder,e.textBounds.forEach(function(e){u.forEach(function(r){switch(r){case 0:d.ctx.fillStyle=nn(t.color),d.renderTextWithLetterSpacing(e,t.letterSpacing,l);var n=t.textShadow;n.length&&e.text.trim().length&&(n.slice(0).reverse().forEach(function(r){d.ctx.shadowColor=nn(r.color),d.ctx.shadowOffsetX=r.offsetX.number*d.options.scale,d.ctx.shadowOffsetY=r.offsetY.number*d.options.scale,d.ctx.shadowBlur=r.blur.number,d.renderTextWithLetterSpacing(e,t.letterSpacing,l)}),d.ctx.shadowColor="",d.ctx.shadowOffsetX=0,d.ctx.shadowOffsetY=0,d.ctx.shadowBlur=0),t.textDecorationLine.length&&(d.ctx.fillStyle=nn(t.textDecorationColor||t.color),t.textDecorationLine.forEach(function(t){switch(t){case 1:d.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top+l),e.bounds.width,1);break;case 2:d.ctx.fillRect(e.bounds.left,Math.round(e.bounds.top),e.bounds.width,1);break;case 3:d.ctx.fillRect(e.bounds.left,Math.ceil(e.bounds.top+c),e.bounds.width,1)}}));break;case 1:t.webkitTextStrokeWidth&&e.text.trim().length&&(d.ctx.strokeStyle=nn(t.webkitTextStrokeColor),d.ctx.lineWidth=t.webkitTextStrokeWidth,d.ctx.lineJoin=window.chrome?"miter":"round",d.ctx.strokeText(e.text,e.bounds.left,e.bounds.top+l)),d.ctx.strokeStyle="",d.ctx.lineWidth=0,d.ctx.lineJoin="miter"}})}),[2]})})},r.prototype.renderReplacedElement=function(e,t,r){if(r&&e.intrinsicWidth>0&&e.intrinsicHeight>0){var n=Yl(e),i=Fl(t);this.path(i),this.ctx.save(),this.ctx.clip(),this.ctx.drawImage(r,0,0,e.intrinsicWidth,e.intrinsicHeight,n.left,n.top,n.width,n.height),this.ctx.restore()}},r.prototype.renderNodeContent=function(e){return n(this,void 0,void 0,function(){var t,n,o,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x;return i(this,function(i){switch(i.label){case 0:this.applyEffects(e.getEffects(4)),t=e.container,n=e.curves,o=t.styles,s=0,l=t.textNodes,i.label=1;case 1:return s<l.length?(c=l[s],[4,this.renderTextNode(c,o)]):[3,4];case 2:i.sent(),i.label=3;case 3:return s++,[3,1];case 4:if(!(t instanceof za))return[3,8];i.label=5;case 5:return i.trys.push([5,7,,8]),[4,this.context.cache.match(t.src)];case 6:return y=i.sent(),this.renderReplacedElement(t,n,y),[3,8];case 7:return i.sent(),this.context.logger.error("Error loading image "+t.src),[3,8];case 8:if(t instanceof Na&&this.renderReplacedElement(t,n,t.canvas),!(t instanceof ja))return[3,12];i.label=9;case 9:return i.trys.push([9,11,,12]),[4,this.context.cache.match(t.svg)];case 10:return y=i.sent(),this.renderReplacedElement(t,n,y),[3,12];case 11:return i.sent(),this.context.logger.error("Error loading svg "+t.svg.substring(0,255)),[3,12];case 12:return t instanceof ts&&t.tree?[4,new r(this.context,{scale:this.options.scale,backgroundColor:t.backgroundColor,x:0,y:0,width:t.width,height:t.height}).render(t.tree)]:[3,14];case 13:u=i.sent(),t.width&&t.height&&this.ctx.drawImage(u,0,0,t.width,t.height,t.bounds.left,t.bounds.top,t.bounds.width,t.bounds.height),i.label=14;case 14:if(t instanceof Ja&&(d=Math.min(t.bounds.width,t.bounds.height),t.type===qa?t.checked&&(this.ctx.save(),this.path([new wl(t.bounds.left+.39363*d,t.bounds.top+.79*d),new wl(t.bounds.left+.16*d,t.bounds.top+.5549*d),new wl(t.bounds.left+.27347*d,t.bounds.top+.44071*d),new wl(t.bounds.left+.39694*d,t.bounds.top+.5649*d),new wl(t.bounds.left+.72983*d,t.bounds.top+.23*d),new wl(t.bounds.left+.84*d,t.bounds.top+.34085*d),new wl(t.bounds.left+.39363*d,t.bounds.top+.79*d)]),this.ctx.fillStyle=nn(Ya),this.ctx.fill(),this.ctx.restore()):t.type===Za&&t.checked&&(this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t.bounds.left+d/2,t.bounds.top+d/2,d/4,0,2*Math.PI,!0),this.ctx.fillStyle=nn(Ya),this.ctx.fill(),this.ctx.restore())),hc(t)&&t.value.length){switch(h=this.createFontStyle(o),v=h[0],A=h[1],f=this.fontMetrics.getMetrics(v,A).baseline,this.ctx.font=v,this.ctx.fillStyle=nn(o.color),this.ctx.textBaseline="alphabetic",this.ctx.textAlign=fc(t.styles.textAlign),x=Yl(t),p=0,t.styles.textAlign){case 1:p+=x.width/2;break;case 2:p+=x.width}m=x.add(p,0,0,-x.height/2+1),this.ctx.save(),this.path([new wl(x.left,x.top),new wl(x.left+x.width,x.top),new wl(x.left+x.width,x.top+x.height),new wl(x.left,x.top+x.height)]),this.ctx.clip(),this.renderTextWithLetterSpacing(new Ea(t.value,m),o.letterSpacing,f),this.ctx.restore(),this.ctx.textBaseline="alphabetic",this.ctx.textAlign="left"}if(!io(t.styles.display,2048))return[3,20];if(null===t.styles.listStyleImage)return[3,19];if(0!==(g=t.styles.listStyleImage).type)return[3,18];y=void 0,_=g.url,i.label=15;case 15:return i.trys.push([15,17,,18]),[4,this.context.cache.match(_)];case 16:return y=i.sent(),this.ctx.drawImage(y,t.bounds.left-(y.width+10),t.bounds.top),[3,18];case 17:return i.sent(),this.context.logger.error("Error loading list-style-image "+_),[3,18];case 18:return[3,20];case 19:e.listValue&&-1!==t.styles.listStyleType&&(v=this.createFontStyle(o)[0],this.ctx.font=v,this.ctx.fillStyle=nn(o.color),this.ctx.textBaseline="middle",this.ctx.textAlign="right",x=new a(t.bounds.left,t.bounds.top+Kr(t.styles.paddingTop,t.bounds.width),t.bounds.width,xi(o.lineHeight,o.fontSize.number)/2+1),this.renderTextWithLetterSpacing(new Ea(e.listValue,x),o.letterSpacing,xi(o.lineHeight,o.fontSize.number)/2+2),this.ctx.textBaseline="bottom",this.ctx.textAlign="left"),i.label=20;case 20:return[2]}})})},r.prototype.renderStackContent=function(e){return n(this,void 0,void 0,function(){var t,r,n,o,a,s,l,c,u,d,h,A,f,p,m;return i(this,function(i){switch(i.label){case 0:return io(e.element.container.flags,16),[4,this.renderNodeBackgroundAndBorders(e.element)];case 1:i.sent(),t=0,r=e.negativeZIndex,i.label=2;case 2:return t<r.length?(m=r[t],[4,this.renderStack(m)]):[3,5];case 3:i.sent(),i.label=4;case 4:return t++,[3,2];case 5:return[4,this.renderNodeContent(e.element)];case 6:i.sent(),n=0,o=e.nonInlineLevel,i.label=7;case 7:return n<o.length?(m=o[n],[4,this.renderNode(m)]):[3,10];case 8:i.sent(),i.label=9;case 9:return n++,[3,7];case 10:a=0,s=e.nonPositionedFloats,i.label=11;case 11:return a<s.length?(m=s[a],[4,this.renderStack(m)]):[3,14];case 12:i.sent(),i.label=13;case 13:return a++,[3,11];case 14:l=0,c=e.nonPositionedInlineLevel,i.label=15;case 15:return l<c.length?(m=c[l],[4,this.renderStack(m)]):[3,18];case 16:i.sent(),i.label=17;case 17:return l++,[3,15];case 18:u=0,d=e.inlineLevel,i.label=19;case 19:return u<d.length?(m=d[u],[4,this.renderNode(m)]):[3,22];case 20:i.sent(),i.label=21;case 21:return u++,[3,19];case 22:h=0,A=e.zeroOrAutoZIndexOrTransformedOrOpacity,i.label=23;case 23:return h<A.length?(m=A[h],[4,this.renderStack(m)]):[3,26];case 24:i.sent(),i.label=25;case 25:return h++,[3,23];case 26:f=0,p=e.positiveZIndex,i.label=27;case 27:return f<p.length?(m=p[f],[4,this.renderStack(m)]):[3,30];case 28:i.sent(),i.label=29;case 29:return f++,[3,27];case 30:return[2]}})})},r.prototype.mask=function(e){this.ctx.beginPath(),this.ctx.moveTo(0,0),this.ctx.lineTo(this.canvas.width,0),this.ctx.lineTo(this.canvas.width,this.canvas.height),this.ctx.lineTo(0,this.canvas.height),this.ctx.lineTo(0,0),this.formatPath(e.slice(0).reverse()),this.ctx.closePath()},r.prototype.path=function(e){this.ctx.beginPath(),this.formatPath(e),this.ctx.closePath()},r.prototype.formatPath=function(e){var t=this;e.forEach(function(e,r){var n=Cl(e)?e.start:e;0===r?t.ctx.moveTo(n.x,n.y):t.ctx.lineTo(n.x,n.y),Cl(e)&&t.ctx.bezierCurveTo(e.startControl.x,e.startControl.y,e.endControl.x,e.endControl.y,e.end.x,e.end.y)})},r.prototype.renderRepeat=function(e,t,r,n){this.path(e),this.ctx.fillStyle=t,this.ctx.translate(r,n),this.ctx.fill(),this.ctx.translate(-r,-n)},r.prototype.resizeImage=function(e,t,r){var n;if(e.width===t&&e.height===r)return e;var i=(null!==(n=this.canvas.ownerDocument)&&void 0!==n?n:document).createElement("canvas");return i.width=Math.max(1,t),i.height=Math.max(1,r),i.getContext("2d").drawImage(e,0,0,e.width,e.height,0,0,t,r),i},r.prototype.renderBackgroundImage=function(e){return n(this,void 0,void 0,function(){var t,r,n,o,a,s;return i(this,function(l){switch(l.label){case 0:t=e.styles.backgroundImage.length-1,r=function(r){var o,a,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x,w,b,B,C,E,S,T,I,F,k,P,M,O,L;return i(this,function(i){switch(i.label){case 0:if(0!==r.type)return[3,5];o=void 0,a=r.url,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.context.cache.match(a)];case 2:return o=i.sent(),[3,4];case 3:return i.sent(),n.context.logger.error("Error loading background-image "+a),[3,4];case 4:return o&&(s=ec(e,t,[o.width,o.height,o.width/o.height]),v=s[0],E=s[1],S=s[2],b=s[3],B=s[4],y=n.ctx.createPattern(n.resizeImage(o,b,B),"repeat"),n.renderRepeat(v,y,E,S)),[3,6];case 5:Pn(r)?(l=ec(e,t,[null,null,null]),v=l[0],E=l[1],S=l[2],b=l[3],B=l[4],c=yn(r.angle,b,B),u=c[0],d=c[1],h=c[2],A=c[3],f=c[4],(p=document.createElement("canvas")).width=b,p.height=B,m=p.getContext("2d"),g=m.createLinearGradient(d,A,h,f),mn(r.stops,u).forEach(function(e){return g.addColorStop(e.stop,nn(e.color))}),m.fillStyle=g,m.fillRect(0,0,b,B),b>0&&B>0&&(y=n.ctx.createPattern(p,"repeat"),n.renderRepeat(v,y,E,S))):Mn(r)&&(_=ec(e,t,[null,null,null]),v=_[0],x=_[1],w=_[2],b=_[3],B=_[4],C=0===r.position.length?[Vr]:r.position,E=Kr(C[0],b),S=Kr(C[C.length-1],B),T=xn(r,E,S,b,B),I=T[0],F=T[1],I>0&&F>0&&(k=n.ctx.createRadialGradient(x+E,w+S,0,x+E,w+S,I),mn(r.stops,2*I).forEach(function(e){return k.addColorStop(e.stop,nn(e.color))}),n.path(v),n.ctx.fillStyle=k,I!==F?(P=e.bounds.left+.5*e.bounds.width,M=e.bounds.top+.5*e.bounds.height,L=1/(O=F/I),n.ctx.save(),n.ctx.translate(P,M),n.ctx.transform(1,0,0,O,0,0),n.ctx.translate(-P,-M),n.ctx.fillRect(x,L*(w-M)+M,b,B*L),n.ctx.restore()):n.ctx.fill())),i.label=6;case 6:return t--,[2]}})},n=this,o=0,a=e.styles.backgroundImage.slice(0).reverse(),l.label=1;case 1:return o<a.length?(s=a[o],[5,r(s)]):[3,4];case 2:l.sent(),l.label=3;case 3:return o++,[3,1];case 4:return[2]}})})},r.prototype.renderSolidBorder=function(e,t,r){return n(this,void 0,void 0,function(){return i(this,function(n){return this.path(Hl(r,t)),this.ctx.fillStyle=nn(e),this.ctx.fill(),[2]})})},r.prototype.renderDoubleBorder=function(e,t,r,o){return n(this,void 0,void 0,function(){var n,a;return i(this,function(i){switch(i.label){case 0:return t<3?[4,this.renderSolidBorder(e,r,o)]:[3,2];case 1:return i.sent(),[2];case 2:return n=Gl(o,r),this.path(n),this.ctx.fillStyle=nn(e),this.ctx.fill(),a=Kl(o,r),this.path(a),this.ctx.fill(),[2]}})})},r.prototype.renderNodeBackgroundAndBorders=function(e){return n(this,void 0,void 0,function(){var t,r,n,o,a,s,l,c,u=this;return i(this,function(i){switch(i.label){case 0:return this.applyEffects(e.getEffects(2)),t=e.container.styles,r=!rn(t.backgroundColor)||t.backgroundImage.length,n=[{style:t.borderTopStyle,color:t.borderTopColor,width:t.borderTopWidth},{style:t.borderRightStyle,color:t.borderRightColor,width:t.borderRightWidth},{style:t.borderBottomStyle,color:t.borderBottomColor,width:t.borderBottomWidth},{style:t.borderLeftStyle,color:t.borderLeftColor,width:t.borderLeftWidth}],o=Ac(ic(t.backgroundClip,0),e.curves),r||t.boxShadow.length?(this.ctx.save(),this.path(o),this.ctx.clip(),rn(t.backgroundColor)||(this.ctx.fillStyle=nn(t.backgroundColor),this.ctx.fill()),[4,this.renderBackgroundImage(e.container)]):[3,2];case 1:i.sent(),this.ctx.restore(),t.boxShadow.slice(0).reverse().forEach(function(t){u.ctx.save();var r=Tl(e.curves),n=t.inset?0:uc,i=Rl(r,-n+(t.inset?1:-1)*t.spread.number,(t.inset?1:-1)*t.spread.number,t.spread.number*(t.inset?-2:2),t.spread.number*(t.inset?-2:2));t.inset?(u.path(r),u.ctx.clip(),u.mask(i)):(u.mask(r),u.ctx.clip(),u.path(i)),u.ctx.shadowOffsetX=t.offsetX.number+n,u.ctx.shadowOffsetY=t.offsetY.number,u.ctx.shadowColor=nn(t.color),u.ctx.shadowBlur=t.blur.number,u.ctx.fillStyle=t.inset?nn(t.color):"rgba(0,0,0,1)",u.ctx.fill(),u.ctx.restore()}),i.label=2;case 2:a=0,s=0,l=n,i.label=3;case 3:return s<l.length?0!==(c=l[s]).style&&!rn(c.color)&&c.width>0?2!==c.style?[3,5]:[4,this.renderDashedDottedBorder(c.color,c.width,a,e.curves,2)]:[3,11]:[3,13];case 4:return i.sent(),[3,11];case 5:return 3!==c.style?[3,7]:[4,this.renderDashedDottedBorder(c.color,c.width,a,e.curves,3)];case 6:return i.sent(),[3,11];case 7:return 4!==c.style?[3,9]:[4,this.renderDoubleBorder(c.color,c.width,a,e.curves)];case 8:return i.sent(),[3,11];case 9:return[4,this.renderSolidBorder(c.color,a,e.curves)];case 10:i.sent(),i.label=11;case 11:a++,i.label=12;case 12:return s++,[3,3];case 13:return[2]}})})},r.prototype.renderDashedDottedBorder=function(e,t,r,o,a){return n(this,void 0,void 0,function(){var n,s,l,c,u,d,h,A,f,p,m,g,y,_,v,x;return i(this,function(i){return this.ctx.save(),n=Wl(o,r),s=Hl(o,r),2===a&&(this.path(s),this.ctx.clip()),Cl(s[0])?(l=s[0].start.x,c=s[0].start.y):(l=s[0].x,c=s[0].y),Cl(s[1])?(u=s[1].end.x,d=s[1].end.y):(u=s[1].x,d=s[1].y),h=0===r||2===r?Math.abs(l-u):Math.abs(c-d),this.ctx.beginPath(),3===a?this.formatPath(n):this.formatPath(s.slice(0,2)),A=t<3?3*t:2*t,f=t<3?2*t:t,3===a&&(A=t,f=t),p=!0,h<=2*A?p=!1:h<=2*A+f?(A*=m=h/(2*A+f),f*=m):(g=Math.floor((h+f)/(A+f)),y=(h-g*A)/(g-1),f=(_=(h-(g+1)*A)/g)<=0||Math.abs(f-y)<Math.abs(f-_)?y:_),p&&(3===a?this.ctx.setLineDash([0,A+f]):this.ctx.setLineDash([A,f])),3===a?(this.ctx.lineCap="round",this.ctx.lineWidth=t):this.ctx.lineWidth=2*t+1.1,this.ctx.strokeStyle=nn(e),this.ctx.stroke(),this.ctx.setLineDash([]),2===a&&(Cl(s[0])&&(v=s[3],x=s[0],this.ctx.beginPath(),this.formatPath([new wl(v.end.x,v.end.y),new wl(x.start.x,x.start.y)]),this.ctx.stroke()),Cl(s[1])&&(v=s[1],x=s[2],this.ctx.beginPath(),this.formatPath([new wl(v.end.x,v.end.y),new wl(x.start.x,x.start.y)]),this.ctx.stroke())),this.ctx.restore(),[2]})})},r.prototype.render=function(e){return n(this,void 0,void 0,function(){var t;return i(this,function(r){switch(r.label){case 0:return this.options.backgroundColor&&(this.ctx.fillStyle=nn(this.options.backgroundColor),this.ctx.fillRect(this.options.x,this.options.y,this.options.width,this.options.height)),t=Vl(e),[4,this.renderStack(t)];case 1:return r.sent(),this.applyEffects([]),[2,this.canvas]}})})},r}(cc),hc=function(e){return e instanceof es||e instanceof $a||e instanceof Ja&&e.type!==Za&&e.type!==qa},Ac=function(e,t){switch(e){case 0:return Tl(t);case 2:return Il(t);default:return Fl(t)}},fc=function(e){switch(e){case 1:return"center";case 2:return"right";default:return"left"}},pc=["-apple-system","system-ui"],mc=function(e){return/iPhone OS 15_(0|1)/.test(window.navigator.userAgent)?e.filter(function(e){return-1===pc.indexOf(e)}):e},gc=function(e){function r(t,r){var n=e.call(this,t,r)||this;return n.canvas=r.canvas?r.canvas:document.createElement("canvas"),n.ctx=n.canvas.getContext("2d"),n.options=r,n.canvas.width=Math.floor(r.width*r.scale),n.canvas.height=Math.floor(r.height*r.scale),n.canvas.style.width=r.width+"px",n.canvas.style.height=r.height+"px",n.ctx.scale(n.options.scale,n.options.scale),n.ctx.translate(-r.x,-r.y),n.context.logger.debug("EXPERIMENTAL ForeignObject renderer initialized ("+r.width+"x"+r.height+" at "+r.x+","+r.y+") with scale "+r.scale),n}return t(r,e),r.prototype.render=function(e){return n(this,void 0,void 0,function(){var t,r;return i(this,function(n){switch(n.label){case 0:return t=ba(this.options.width*this.options.scale,this.options.height*this.options.scale,this.options.scale,this.options.scale,e),[4,yc(t)];case 1:return r=n.sent(),this.options.backgroundColor&&(this.ctx.fillStyle=nn(this.options.backgroundColor),this.ctx.fillRect(0,0,this.options.width*this.options.scale,this.options.height*this.options.scale)),this.ctx.drawImage(r,-this.options.x*this.options.scale,-this.options.y*this.options.scale),[2,this.canvas]}})})},r}(cc),yc=function(e){return new Promise(function(t,r){var n=new Image;n.onload=function(){t(n)},n.onerror=r,n.src="data:image/svg+xml;charset=utf-8,"+encodeURIComponent((new XMLSerializer).serializeToString(e))})},_c=function(){function e(e){var t=e.id,r=e.enabled;this.id=t,this.enabled=r,this.start=Date.now()}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.debug?console.debug.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.getTime=function(){return Date.now()-this.start},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&"undefined"!==typeof window&&window.console&&"function"===typeof console.info&&console.info.apply(console,o([this.id,this.getTime()+"ms"],e))},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.warn?console.warn.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.enabled&&("undefined"!==typeof window&&window.console&&"function"===typeof console.error?console.error.apply(console,o([this.id,this.getTime()+"ms"],e)):this.info.apply(this,e))},e.instances={},e}(),vc=function(){function e(t,r){var n;this.windowBounds=r,this.instanceName="#"+e.instanceCount++,this.logger=new _c({id:this.instanceName,enabled:t.logging}),this.cache=null!==(n=t.cache)&&void 0!==n?n:new Al(this,t)}return e.instanceCount=1,e}(),xc=function(e,t){return void 0===t&&(t={}),wc(e,t)};"undefined"!==typeof window&&hl.setContext(window);var wc=function(e,t){return n(void 0,void 0,void 0,function(){var n,o,c,u,d,h,A,f,p,m,g,y,_,v,x,w,b,B,C,E,S,T,I,F,k,P,M,O,L,D,U,R,z,N,j,Q,V,H;return i(this,function(i){switch(i.label){case 0:if(!e||"object"!==typeof e)return[2,Promise.reject("Invalid element provided as first argument")];if(!(n=e.ownerDocument))throw new Error("Element is not attached to a Document");if(!(o=n.defaultView))throw new Error("Document is not attached to a Window");return c={allowTaint:null!==(T=t.allowTaint)&&void 0!==T&&T,imageTimeout:null!==(I=t.imageTimeout)&&void 0!==I?I:15e3,proxy:t.proxy,useCORS:null!==(F=t.useCORS)&&void 0!==F&&F},u=r({logging:null===(k=t.logging)||void 0===k||k,cache:t.cache},c),d={windowWidth:null!==(P=t.windowWidth)&&void 0!==P?P:o.innerWidth,windowHeight:null!==(M=t.windowHeight)&&void 0!==M?M:o.innerHeight,scrollX:null!==(O=t.scrollX)&&void 0!==O?O:o.pageXOffset,scrollY:null!==(L=t.scrollY)&&void 0!==L?L:o.pageYOffset},h=new a(d.scrollX,d.scrollY,d.windowWidth,d.windowHeight),A=new vc(u,h),f=null!==(D=t.foreignObjectRendering)&&void 0!==D&&D,p={allowTaint:null!==(U=t.allowTaint)&&void 0!==U&&U,onclone:t.onclone,ignoreElements:t.ignoreElements,inlineImages:f,copyStyles:f},A.logger.debug("Starting document clone with size "+h.width+"x"+h.height+" scrolled to "+-h.left+","+-h.top),m=new qs(A,e,p),(g=m.clonedReferenceElement)?[4,m.toIFrame(n,h)]:[2,Promise.reject("Unable to find element in cloned iframe")];case 1:return y=i.sent(),_=gs(g)||ps(g)?l(g.ownerDocument):s(A,g),v=_.width,x=_.height,w=_.left,b=_.top,B=bc(A,g,t.backgroundColor),C={canvas:t.canvas,backgroundColor:B,scale:null!==(z=null!==(R=t.scale)&&void 0!==R?R:o.devicePixelRatio)&&void 0!==z?z:1,x:(null!==(N=t.x)&&void 0!==N?N:0)+w,y:(null!==(j=t.y)&&void 0!==j?j:0)+b,width:null!==(Q=t.width)&&void 0!==Q?Q:Math.ceil(v),height:null!==(V=t.height)&&void 0!==V?V:Math.ceil(x)},f?(A.logger.debug("Document cloned, using foreign object rendering"),[4,new gc(A,C).render(g)]):[3,3];case 2:return E=i.sent(),[3,5];case 3:return A.logger.debug("Document cloned, element located at "+w+","+b+" with size "+v+"x"+x+" using computed rendering"),A.logger.debug("Starting DOM parsing"),S=os(A,g),B===S.styles.backgroundColor&&(S.styles.backgroundColor=hn.TRANSPARENT),A.logger.debug("Starting renderer for element at "+C.x+","+C.y+" with size "+C.width+"x"+C.height),[4,new dc(A,C).render(S)];case 4:E=i.sent(),i.label=5;case 5:return(null===(H=t.removeContainer)||void 0===H||H)&&(qs.destroy(y)||A.logger.error("Cannot detach cloned iframe as it is not in the DOM anymore")),A.logger.debug("Finished rendering"),[2,E]}})})},bc=function(e,t,r){var n=t.ownerDocument,i=n.documentElement?dn(e,getComputedStyle(n.documentElement).backgroundColor):hn.TRANSPARENT,o=n.body?dn(e,getComputedStyle(n.body).backgroundColor):hn.TRANSPARENT,a="string"===typeof r?dn(e,r):null===r?hn.TRANSPARENT:4294967295;return t===n.documentElement?rn(i)?rn(o)?a:o:i:a};return xc}()},5261(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(6433);t.cloneDeep=function(e){return n.cloneDeepWithImpl(e,void 0,e,new Map,void 0)}},5303(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(2489),i=r(4704),o=r(6321),a=r(1444);t.has=function(e,t){let r;if(r=Array.isArray(t)?t:"string"===typeof t&&n.isDeepKey(t)&&null==(null===e||void 0===e?void 0:e[t])?a.toPath(t):[t],0===r.length)return!1;let s=e;for(let n=0;n<r.length;n++){const e=r[n];if(null==s||!Object.hasOwn(s,e)){if(!((Array.isArray(s)||o.isArguments(s))&&i.isIndex(e)&&e<s.length))return!1}s=s[e]}return!0}},5316(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(9709),i=r(7043),o=r(1444);t.orderBy=function(e,t,r,a){if(null==e)return[];r=a?void 0:r,Array.isArray(e)||(e=Object.values(e)),Array.isArray(t)||(t=null==t?[null]:[t]),0===t.length&&(t=[null]),Array.isArray(r)||(r=null==r?[]:[r]),r=r.map(e=>String(e));const s=(e,t)=>{let r=e;for(let n=0;n<t.length&&null!=r;++n)r=r[t[n]];return r},l=t.map(e=>(Array.isArray(e)&&1===e.length&&(e=e[0]),null==e||"function"===typeof e||Array.isArray(e)||i.isKey(e)?e:{key:e,path:o.toPath(e)}));return e.map(e=>({original:e,criteria:l.map(t=>((e,t)=>null==t||null==e?t:"object"===typeof e&&"key"in e?Object.hasOwn(t,e.key)?t[e.key]:s(t,e.path):"function"===typeof e?e(t):Array.isArray(e)?s(t,e):"object"===typeof t?t[e]:t)(t,e))})).slice().sort((e,t)=>{for(let i=0;i<l.length;i++){const o=n.compareValues(e.criteria[i],t.criteria[i],r[i]);if(0!==o)return o}return 0}).map(e=>e.original)}},5414(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(1293);t.throttle=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{leading:i=!0,trailing:o=!0}=r;return n.debounce(e,t,{leading:i,maxWait:t,trailing:o})}},5508(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(6433),i=r(5990),o=r(7599);t.cloneDeepWith=function(e,t){return n.cloneDeepWith(e,(r,a,s,l)=>{const c=null===t||void 0===t?void 0:t(r,a,s,l);if(void 0!==c)return c;if("object"===typeof e){if(i.getTag(e)===o.objectTag&&"function"!==typeof e.constructor){const t={};return l.set(e,t),n.copyProperties(t,e,s,l),t}switch(Object.prototype.toString.call(e)){case o.numberTag:case o.stringTag:case o.booleanTag:{const t=new e.constructor(null===e||void 0===e?void 0:e.valueOf());return n.copyProperties(t,e),t}case o.argumentsTag:{const t={};return n.copyProperties(t,e),t.length=e.length,t[Symbol.iterator]=e[Symbol.iterator],t}default:return}}})}},5990(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.getTag=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":Object.prototype.toString.call(e)}},6321(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(5990);t.isArguments=function(e){return null!==e&&"object"===typeof e&&"[object Arguments]"===n.getTag(e)}},6392(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.last=function(e){return e[e.length-1]}},6433(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(6443),i=r(5990),o=r(7599),a=r(4803),s=r(3757);function l(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;const d=null===u||void 0===u?void 0:u(e,t,r,n);if(void 0!==d)return d;if(a.isPrimitive(e))return e;if(n.has(e))return n.get(e);if(Array.isArray(e)){const t=new Array(e.length);n.set(e,t);for(let i=0;i<e.length;i++)t[i]=l(e[i],i,r,n,u);return Object.hasOwn(e,"index")&&(t.index=e.index),Object.hasOwn(e,"input")&&(t.input=e.input),t}if(e instanceof Date)return new Date(e.getTime());if(e instanceof RegExp){const t=new RegExp(e.source,e.flags);return t.lastIndex=e.lastIndex,t}if(e instanceof Map){const t=new Map;n.set(e,t);for(const[i,o]of e)t.set(i,l(o,i,r,n,u));return t}if(e instanceof Set){const t=new Set;n.set(e,t);for(const i of e)t.add(l(i,void 0,r,n,u));return t}if("undefined"!==typeof Buffer&&Buffer.isBuffer(e))return e.subarray();if(s.isTypedArray(e)){const t=new(Object.getPrototypeOf(e).constructor)(e.length);n.set(e,t);for(let i=0;i<e.length;i++)t[i]=l(e[i],i,r,n,u);return t}if(e instanceof ArrayBuffer||"undefined"!==typeof SharedArrayBuffer&&e instanceof SharedArrayBuffer)return e.slice(0);if(e instanceof DataView){const t=new DataView(e.buffer.slice(0),e.byteOffset,e.byteLength);return n.set(e,t),c(t,e,r,n,u),t}if("undefined"!==typeof File&&e instanceof File){const t=new File([e],e.name,{type:e.type});return n.set(e,t),c(t,e,r,n,u),t}if("undefined"!==typeof Blob&&e instanceof Blob){const t=new Blob([e],{type:e.type});return n.set(e,t),c(t,e,r,n,u),t}if(e instanceof Error){const t=new e.constructor;return n.set(e,t),t.message=e.message,t.name=e.name,t.stack=e.stack,t.cause=e.cause,c(t,e,r,n,u),t}if(e instanceof Boolean){const t=new Boolean(e.valueOf());return n.set(e,t),c(t,e,r,n,u),t}if(e instanceof Number){const t=new Number(e.valueOf());return n.set(e,t),c(t,e,r,n,u),t}if(e instanceof String){const t=new String(e.valueOf());return n.set(e,t),c(t,e,r,n,u),t}if("object"===typeof e&&function(e){switch(i.getTag(e)){case o.argumentsTag:case o.arrayTag:case o.arrayBufferTag:case o.dataViewTag:case o.booleanTag:case o.dateTag:case o.float32ArrayTag:case o.float64ArrayTag:case o.int8ArrayTag:case o.int16ArrayTag:case o.int32ArrayTag:case o.mapTag:case o.numberTag:case o.objectTag:case o.regexpTag:case o.setTag:case o.stringTag:case o.symbolTag:case o.uint8ArrayTag:case o.uint8ClampedArrayTag:case o.uint16ArrayTag:case o.uint32ArrayTag:return!0;default:return!1}}(e)){const t=Object.create(Object.getPrototypeOf(e));return n.set(e,t),c(t,e,r,n,u),t}return e}function c(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,i=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0;const a=[...Object.keys(t),...n.getSymbols(t)];for(let n=0;n<a.length;n++){const s=a[n],c=Object.getOwnPropertyDescriptor(e,s);(null==c||c.writable)&&(e[s]=l(t[s],s,r,i,o))}}t.cloneDeepWith=function(e,t){return l(e,void 0,e,new Map,t)},t.cloneDeepWithImpl=l,t.copyProperties=c},6443(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.getSymbols=function(e){return Object.getOwnPropertySymbols(e).filter(t=>Object.prototype.propertyIsEnumerable.call(e,t))}},6770(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(2777);t.toNumber=function(e){return n.isSymbol(e)?NaN:Number(e)}},7043(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(2777),i=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;t.isKey=function(e,t){return!Array.isArray(e)&&(!("number"!==typeof e&&"boolean"!==typeof e&&null!=e&&!n.isSymbol(e))||("string"===typeof e&&(o.test(e)||!i.test(e))||null!=t&&Object.hasOwn(t,e)))}},7231(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(3799),i=r(4879);t.range=function(e,t,r){r&&"number"!==typeof r&&n.isIterateeCall(e,t,r)&&(t=r=void 0),e=i.toFinite(e),void 0===t?(t=e,e=0):t=i.toFinite(t),r=void 0===r?e<t?1:-1:i.toFinite(r);const o=Math.max(Math.ceil((t-e)/(r||1)),0),a=new Array(o);for(let n=0;n<o;n++)a[n]=e,e+=r;return a}},7234(e,t){"use strict";function r(e,t){var r=e.length;e.push(t);e:for(;0<r;){var n=r-1>>>1,i=e[n];if(!(0<o(i,t)))break e;e[n]=t,e[r]=i,r=n}}function n(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var n=0,i=e.length,a=i>>>1;n<a;){var s=2*(n+1)-1,l=e[s],c=s+1,u=e[c];if(0>o(l,r))c<i&&0>o(u,l)?(e[n]=u,e[c]=r,n=c):(e[n]=l,e[s]=r,n=s);else{if(!(c<i&&0>o(u,r)))break e;e[n]=u,e[c]=r,n=c}}}return t}function o(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var a=performance;t.unstable_now=function(){return a.now()}}else{var s=Date,l=s.now();t.unstable_now=function(){return s.now()-l}}var c=[],u=[],d=1,h=null,A=3,f=!1,p=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,_="undefined"!==typeof setImmediate?setImmediate:null;function v(e){for(var t=n(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,r(c,t)}t=n(u)}}function x(e){if(m=!1,v(e),!p)if(null!==n(c))p=!0,M(w);else{var t=n(u);null!==t&&O(x,t.startTime-e)}}function w(e,r){p=!1,m&&(m=!1,y(E),E=-1),f=!0;var o=A;try{for(v(r),h=n(c);null!==h&&(!(h.expirationTime>r)||e&&!I());){var a=h.callback;if("function"===typeof a){h.callback=null,A=h.priorityLevel;var s=a(h.expirationTime<=r);r=t.unstable_now(),"function"===typeof s?h.callback=s:h===n(c)&&i(c),v(r)}else i(c);h=n(c)}if(null!==h)var l=!0;else{var d=n(u);null!==d&&O(x,d.startTime-r),l=!1}return l}finally{h=null,A=o,f=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var b,B=!1,C=null,E=-1,S=5,T=-1;function I(){return!(t.unstable_now()-T<S)}function F(){if(null!==C){var e=t.unstable_now();T=e;var r=!0;try{r=C(!0,e)}finally{r?b():(B=!1,C=null)}}else B=!1}if("function"===typeof _)b=function(){_(F)};else if("undefined"!==typeof MessageChannel){var k=new MessageChannel,P=k.port2;k.port1.onmessage=F,b=function(){P.postMessage(null)}}else b=function(){g(F,0)};function M(e){C=e,B||(B=!0,b())}function O(e,r){E=g(function(){e(t.unstable_now())},r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,M(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):S=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return A},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(e){switch(A){case 1:case 2:case 3:var t=3;break;default:t=A}var r=A;A=t;try{return e()}finally{A=r}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=A;A=e;try{return t()}finally{A=r}},t.unstable_scheduleCallback=function(e,i,o){var a=t.unstable_now();switch("object"===typeof o&&null!==o?o="number"===typeof(o=o.delay)&&0<o?a+o:a:o=a,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:o,expirationTime:s=o+s,sortIndex:-1},o>a?(e.sortIndex=o,r(u,e),null===n(c)&&e===n(u)&&(m?(y(E),E=-1):m=!0,O(x,o-a))):(e.sortIndex=s,r(c,e),p||f||(p=!0,M(w))),e},t.unstable_shouldYield=I,t.unstable_wrapCallback=function(e){var t=A;return function(){var r=A;A=t;try{return e.apply(this,arguments)}finally{A=r}}}},7237(e,t,r){"use strict";e.exports=r(8365)},7260(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isUnsafeProperty=function(e){return"__proto__"===e}},7312(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.flatten=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;const r=[],n=Math.floor(t),i=(e,t)=>{for(let o=0;o<e.length;o++){const a=e[o];Array.isArray(a)&&t<n?i(a,t+1):r.push(a)}};return i(e,0),r}},7330(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(9323);t.property=function(e){return function(t){return n.get(t,e)}}},7599(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});t.argumentsTag="[object Arguments]",t.arrayBufferTag="[object ArrayBuffer]",t.arrayTag="[object Array]",t.bigInt64ArrayTag="[object BigInt64Array]",t.bigUint64ArrayTag="[object BigUint64Array]",t.booleanTag="[object Boolean]",t.dataViewTag="[object DataView]",t.dateTag="[object Date]",t.errorTag="[object Error]",t.float32ArrayTag="[object Float32Array]",t.float64ArrayTag="[object Float64Array]",t.functionTag="[object Function]",t.int16ArrayTag="[object Int16Array]",t.int32ArrayTag="[object Int32Array]",t.int8ArrayTag="[object Int8Array]",t.mapTag="[object Map]",t.numberTag="[object Number]",t.objectTag="[object Object]",t.regexpTag="[object RegExp]",t.setTag="[object Set]",t.stringTag="[object String]",t.symbolTag="[object Symbol]",t.uint16ArrayTag="[object Uint16Array]",t.uint32ArrayTag="[object Uint32Array]",t.uint8ArrayTag="[object Uint8Array]",t.uint8ClampedArrayTag="[object Uint8ClampedArray]"},7736(e,t,r){var n=r(3738).default,i=r(9045);e.exports=function(e){var t=i(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},7770(e,t,r){e.exports=r(9323).get},7820(e,t,r){e.exports=r(5414).throttle},7950(e,t,r){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=r(2730)},8210(e,t,r){var n;!function(){"use strict";var i,o=1e9,a={precision:20,rounding:4,toExpNeg:-7,toExpPos:21,LN10:"2.302585092994045684017991454684364207601101488628772976033327900967572609677352480235997205089598298341967784042286"},s=!0,l="[DecimalError] ",c=l+"Invalid argument: ",u=l+"Exponent out of range: ",d=Math.floor,h=Math.pow,A=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,f=1e7,p=9007199254740991,m=d(1286742750677284.5),g={};function y(e,t){var r,n,i,o,a,l,c,u,d=e.constructor,h=d.precision;if(!e.s||!t.s)return t.s||(t=new d(e)),s?T(t,h):t;if(c=e.d,u=t.d,a=e.e,i=t.e,c=c.slice(),o=a-i){for(o<0?(n=c,o=-o,l=u.length):(n=u,i=a,l=c.length),o>(l=(a=Math.ceil(h/7))>l?a+1:l+1)&&(o=l,n.length=1),n.reverse();o--;)n.push(0);n.reverse()}for((l=c.length)-(o=u.length)<0&&(o=l,n=u,u=c,c=n),r=0;o;)r=(c[--o]=c[o]+u[o]+r)/f|0,c[o]%=f;for(r&&(c.unshift(r),++i),l=c.length;0==c[--l];)c.pop();return t.d=c,t.e=i,s?T(t,h):t}function _(e,t,r){if(e!==~~e||e<t||e>r)throw Error(c+e)}function v(e){var t,r,n,i=e.length-1,o="",a=e[0];if(i>0){for(o+=a,t=1;t<i;t++)(r=7-(n=e[t]+"").length)&&(o+=C(r)),o+=n;(r=7-(n=(a=e[t])+"").length)&&(o+=C(r))}else if(0===a)return"0";for(;a%10===0;)a/=10;return o+a}g.absoluteValue=g.abs=function(){var e=new this.constructor(this);return e.s&&(e.s=1),e},g.comparedTo=g.cmp=function(e){var t,r,n,i,o=this;if(e=new o.constructor(e),o.s!==e.s)return o.s||-e.s;if(o.e!==e.e)return o.e>e.e^o.s<0?1:-1;for(t=0,r=(n=o.d.length)<(i=e.d.length)?n:i;t<r;++t)if(o.d[t]!==e.d[t])return o.d[t]>e.d[t]^o.s<0?1:-1;return n===i?0:n>i^o.s<0?1:-1},g.decimalPlaces=g.dp=function(){var e=this,t=e.d.length-1,r=7*(t-e.e);if(t=e.d[t])for(;t%10==0;t/=10)r--;return r<0?0:r},g.dividedBy=g.div=function(e){return x(this,new this.constructor(e))},g.dividedToIntegerBy=g.idiv=function(e){var t=this.constructor;return T(x(this,new t(e),0,1),t.precision)},g.equals=g.eq=function(e){return!this.cmp(e)},g.exponent=function(){return b(this)},g.greaterThan=g.gt=function(e){return this.cmp(e)>0},g.greaterThanOrEqualTo=g.gte=function(e){return this.cmp(e)>=0},g.isInteger=g.isint=function(){return this.e>this.d.length-2},g.isNegative=g.isneg=function(){return this.s<0},g.isPositive=g.ispos=function(){return this.s>0},g.isZero=function(){return 0===this.s},g.lessThan=g.lt=function(e){return this.cmp(e)<0},g.lessThanOrEqualTo=g.lte=function(e){return this.cmp(e)<1},g.logarithm=g.log=function(e){var t,r=this,n=r.constructor,o=n.precision,a=o+5;if(void 0===e)e=new n(10);else if((e=new n(e)).s<1||e.eq(i))throw Error(l+"NaN");if(r.s<1)throw Error(l+(r.s?"NaN":"-Infinity"));return r.eq(i)?new n(0):(s=!1,t=x(E(r,a),E(e,a),a),s=!0,T(t,o))},g.minus=g.sub=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?I(t,e):y(t,(e.s=-e.s,e))},g.modulo=g.mod=function(e){var t,r=this,n=r.constructor,i=n.precision;if(!(e=new n(e)).s)throw Error(l+"NaN");return r.s?(s=!1,t=x(r,e,0,1).times(e),s=!0,r.minus(t)):T(new n(r),i)},g.naturalExponential=g.exp=function(){return w(this)},g.naturalLogarithm=g.ln=function(){return E(this)},g.negated=g.neg=function(){var e=new this.constructor(this);return e.s=-e.s||0,e},g.plus=g.add=function(e){var t=this;return e=new t.constructor(e),t.s==e.s?y(t,e):I(t,(e.s=-e.s,e))},g.precision=g.sd=function(e){var t,r,n,i=this;if(void 0!==e&&e!==!!e&&1!==e&&0!==e)throw Error(c+e);if(t=b(i)+1,r=7*(n=i.d.length-1)+1,n=i.d[n]){for(;n%10==0;n/=10)r--;for(n=i.d[0];n>=10;n/=10)r++}return e&&t>r?t:r},g.squareRoot=g.sqrt=function(){var e,t,r,n,i,o,a,c=this,u=c.constructor;if(c.s<1){if(!c.s)return new u(0);throw Error(l+"NaN")}for(e=b(c),s=!1,0==(i=Math.sqrt(+c))||i==1/0?(((t=v(c.d)).length+e)%2==0&&(t+="0"),i=Math.sqrt(t),e=d((e+1)/2)-(e<0||e%2),n=new u(t=i==1/0?"5e"+e:(t=i.toExponential()).slice(0,t.indexOf("e")+1)+e)):n=new u(i.toString()),i=a=(r=u.precision)+3;;)if(n=(o=n).plus(x(c,o,a+2)).times(.5),v(o.d).slice(0,a)===(t=v(n.d)).slice(0,a)){if(t=t.slice(a-3,a+1),i==a&&"4999"==t){if(T(o,r+1,0),o.times(o).eq(c)){n=o;break}}else if("9999"!=t)break;a+=4}return s=!0,T(n,r)},g.times=g.mul=function(e){var t,r,n,i,o,a,l,c,u,d=this,h=d.constructor,A=d.d,p=(e=new h(e)).d;if(!d.s||!e.s)return new h(0);for(e.s*=d.s,r=d.e+e.e,(c=A.length)<(u=p.length)&&(o=A,A=p,p=o,a=c,c=u,u=a),o=[],n=a=c+u;n--;)o.push(0);for(n=u;--n>=0;){for(t=0,i=c+n;i>n;)l=o[i]+p[n]*A[i-n-1]+t,o[i--]=l%f|0,t=l/f|0;o[i]=(o[i]+t)%f|0}for(;!o[--a];)o.pop();return t?++r:o.shift(),e.d=o,e.e=r,s?T(e,h.precision):e},g.toDecimalPlaces=g.todp=function(e,t){var r=this,n=r.constructor;return r=new n(r),void 0===e?r:(_(e,0,o),void 0===t?t=n.rounding:_(t,0,8),T(r,e+b(r)+1,t))},g.toExponential=function(e,t){var r,n=this,i=n.constructor;return void 0===e?r=F(n,!0):(_(e,0,o),void 0===t?t=i.rounding:_(t,0,8),r=F(n=T(new i(n),e+1,t),!0,e+1)),r},g.toFixed=function(e,t){var r,n,i=this,a=i.constructor;return void 0===e?F(i):(_(e,0,o),void 0===t?t=a.rounding:_(t,0,8),r=F((n=T(new a(i),e+b(i)+1,t)).abs(),!1,e+b(n)+1),i.isneg()&&!i.isZero()?"-"+r:r)},g.toInteger=g.toint=function(){var e=this,t=e.constructor;return T(new t(e),b(e)+1,t.rounding)},g.toNumber=function(){return+this},g.toPower=g.pow=function(e){var t,r,n,o,a,c,u=this,h=u.constructor,A=+(e=new h(e));if(!e.s)return new h(i);if(!(u=new h(u)).s){if(e.s<1)throw Error(l+"Infinity");return u}if(u.eq(i))return u;if(n=h.precision,e.eq(i))return T(u,n);if(c=(t=e.e)>=(r=e.d.length-1),a=u.s,c){if((r=A<0?-A:A)<=p){for(o=new h(i),t=Math.ceil(n/7+4),s=!1;r%2&&k((o=o.times(u)).d,t),0!==(r=d(r/2));)k((u=u.times(u)).d,t);return s=!0,e.s<0?new h(i).div(o):T(o,n)}}else if(a<0)throw Error(l+"NaN");return a=a<0&&1&e.d[Math.max(t,r)]?-1:1,u.s=1,s=!1,o=e.times(E(u,n+12)),s=!0,(o=w(o)).s=a,o},g.toPrecision=function(e,t){var r,n,i=this,a=i.constructor;return void 0===e?n=F(i,(r=b(i))<=a.toExpNeg||r>=a.toExpPos):(_(e,1,o),void 0===t?t=a.rounding:_(t,0,8),n=F(i=T(new a(i),e,t),e<=(r=b(i))||r<=a.toExpNeg,e)),n},g.toSignificantDigits=g.tosd=function(e,t){var r=this.constructor;return void 0===e?(e=r.precision,t=r.rounding):(_(e,1,o),void 0===t?t=r.rounding:_(t,0,8)),T(new r(this),e,t)},g.toString=g.valueOf=g.val=g.toJSON=function(){var e=this,t=b(e),r=e.constructor;return F(e,t<=r.toExpNeg||t>=r.toExpPos)};var x=function(){function e(e,t){var r,n=0,i=e.length;for(e=e.slice();i--;)r=e[i]*t+n,e[i]=r%f|0,n=r/f|0;return n&&e.unshift(n),e}function t(e,t,r,n){var i,o;if(r!=n)o=r>n?1:-1;else for(i=o=0;i<r;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function r(e,t,r){for(var n=0;r--;)e[r]-=n,n=e[r]<t[r]?1:0,e[r]=n*f+e[r]-t[r];for(;!e[0]&&e.length>1;)e.shift()}return function(n,i,o,a){var s,c,u,d,h,A,p,m,g,y,_,v,x,w,B,C,E,S,I=n.constructor,F=n.s==i.s?1:-1,k=n.d,P=i.d;if(!n.s)return new I(n);if(!i.s)throw Error(l+"Division by zero");for(c=n.e-i.e,E=P.length,B=k.length,m=(p=new I(F)).d=[],u=0;P[u]==(k[u]||0);)++u;if(P[u]>(k[u]||0)&&--c,(v=null==o?o=I.precision:a?o+(b(n)-b(i))+1:o)<0)return new I(0);if(v=v/7+2|0,u=0,1==E)for(d=0,P=P[0],v++;(u<B||d)&&v--;u++)x=d*f+(k[u]||0),m[u]=x/P|0,d=x%P|0;else{for((d=f/(P[0]+1)|0)>1&&(P=e(P,d),k=e(k,d),E=P.length,B=k.length),w=E,y=(g=k.slice(0,E)).length;y<E;)g[y++]=0;(S=P.slice()).unshift(0),C=P[0],P[1]>=f/2&&++C;do{d=0,(s=t(P,g,E,y))<0?(_=g[0],E!=y&&(_=_*f+(g[1]||0)),(d=_/C|0)>1?(d>=f&&(d=f-1),1==(s=t(h=e(P,d),g,A=h.length,y=g.length))&&(d--,r(h,E<A?S:P,A))):(0==d&&(s=d=1),h=P.slice()),(A=h.length)<y&&h.unshift(0),r(g,h,y),-1==s&&(s=t(P,g,E,y=g.length))<1&&(d++,r(g,E<y?S:P,y)),y=g.length):0===s&&(d++,g=[0]),m[u++]=d,s&&g[0]?g[y++]=k[w]||0:(g=[k[w]],y=1)}while((w++<B||void 0!==g[0])&&v--)}return m[0]||m.shift(),p.e=c,T(p,a?o+b(p)+1:o)}}();function w(e,t){var r,n,o,a,l,c=0,d=0,A=e.constructor,f=A.precision;if(b(e)>16)throw Error(u+b(e));if(!e.s)return new A(i);for(null==t?(s=!1,l=f):l=t,a=new A(.03125);e.abs().gte(.1);)e=e.times(a),d+=5;for(l+=Math.log(h(2,d))/Math.LN10*2+5|0,r=n=o=new A(i),A.precision=l;;){if(n=T(n.times(e),l),r=r.times(++c),v((a=o.plus(x(n,r,l))).d).slice(0,l)===v(o.d).slice(0,l)){for(;d--;)o=T(o.times(o),l);return A.precision=f,null==t?(s=!0,T(o,f)):o}o=a}}function b(e){for(var t=7*e.e,r=e.d[0];r>=10;r/=10)t++;return t}function B(e,t,r){if(t>e.LN10.sd())throw s=!0,r&&(e.precision=r),Error(l+"LN10 precision limit exceeded");return T(new e(e.LN10),t)}function C(e){for(var t="";e--;)t+="0";return t}function E(e,t){var r,n,o,a,c,u,d,h,A,f=1,p=e,m=p.d,g=p.constructor,y=g.precision;if(p.s<1)throw Error(l+(p.s?"NaN":"-Infinity"));if(p.eq(i))return new g(0);if(null==t?(s=!1,h=y):h=t,p.eq(10))return null==t&&(s=!0),B(g,h);if(h+=10,g.precision=h,n=(r=v(m)).charAt(0),a=b(p),!(Math.abs(a)<15e14))return d=B(g,h+2,y).times(a+""),p=E(new g(n+"."+r.slice(1)),h-10).plus(d),g.precision=y,null==t?(s=!0,T(p,y)):p;for(;n<7&&1!=n||1==n&&r.charAt(1)>3;)n=(r=v((p=p.times(e)).d)).charAt(0),f++;for(a=b(p),n>1?(p=new g("0."+r),a++):p=new g(n+"."+r.slice(1)),u=c=p=x(p.minus(i),p.plus(i),h),A=T(p.times(p),h),o=3;;){if(c=T(c.times(A),h),v((d=u.plus(x(c,new g(o),h))).d).slice(0,h)===v(u.d).slice(0,h))return u=u.times(2),0!==a&&(u=u.plus(B(g,h+2,y).times(a+""))),u=x(u,new g(f),h),g.precision=y,null==t?(s=!0,T(u,y)):u;u=d,o+=2}}function S(e,t){var r,n,i;for((r=t.indexOf("."))>-1&&(t=t.replace(".","")),(n=t.search(/e/i))>0?(r<0&&(r=n),r+=+t.slice(n+1),t=t.substring(0,n)):r<0&&(r=t.length),n=0;48===t.charCodeAt(n);)++n;for(i=t.length;48===t.charCodeAt(i-1);)--i;if(t=t.slice(n,i)){if(i-=n,r=r-n-1,e.e=d(r/7),e.d=[],n=(r+1)%7,r<0&&(n+=7),n<i){for(n&&e.d.push(+t.slice(0,n)),i-=7;n<i;)e.d.push(+t.slice(n,n+=7));n=7-(t=t.slice(n)).length}else n-=i;for(;n--;)t+="0";if(e.d.push(+t),s&&(e.e>m||e.e<-m))throw Error(u+r)}else e.s=0,e.e=0,e.d=[0];return e}function T(e,t,r){var n,i,o,a,l,c,A,p,g=e.d;for(a=1,o=g[0];o>=10;o/=10)a++;if((n=t-a)<0)n+=7,i=t,A=g[p=0];else{if((p=Math.ceil((n+1)/7))>=(o=g.length))return e;for(A=o=g[p],a=1;o>=10;o/=10)a++;i=(n%=7)-7+a}if(void 0!==r&&(l=A/(o=h(10,a-i-1))%10|0,c=t<0||void 0!==g[p+1]||A%o,c=r<4?(l||c)&&(0==r||r==(e.s<0?3:2)):l>5||5==l&&(4==r||c||6==r&&(n>0?i>0?A/h(10,a-i):0:g[p-1])%10&1||r==(e.s<0?8:7))),t<1||!g[0])return c?(o=b(e),g.length=1,t=t-o-1,g[0]=h(10,(7-t%7)%7),e.e=d(-t/7)||0):(g.length=1,g[0]=e.e=e.s=0),e;if(0==n?(g.length=p,o=1,p--):(g.length=p+1,o=h(10,7-n),g[p]=i>0?(A/h(10,a-i)%h(10,i)|0)*o:0),c)for(;;){if(0==p){(g[0]+=o)==f&&(g[0]=1,++e.e);break}if(g[p]+=o,g[p]!=f)break;g[p--]=0,o=1}for(n=g.length;0===g[--n];)g.pop();if(s&&(e.e>m||e.e<-m))throw Error(u+b(e));return e}function I(e,t){var r,n,i,o,a,l,c,u,d,h,A=e.constructor,p=A.precision;if(!e.s||!t.s)return t.s?t.s=-t.s:t=new A(e),s?T(t,p):t;if(c=e.d,h=t.d,n=t.e,u=e.e,c=c.slice(),a=u-n){for((d=a<0)?(r=c,a=-a,l=h.length):(r=h,n=u,l=c.length),a>(i=Math.max(Math.ceil(p/7),l)+2)&&(a=i,r.length=1),r.reverse(),i=a;i--;)r.push(0);r.reverse()}else{for((d=(i=c.length)<(l=h.length))&&(l=i),i=0;i<l;i++)if(c[i]!=h[i]){d=c[i]<h[i];break}a=0}for(d&&(r=c,c=h,h=r,t.s=-t.s),l=c.length,i=h.length-l;i>0;--i)c[l++]=0;for(i=h.length;i>a;){if(c[--i]<h[i]){for(o=i;o&&0===c[--o];)c[o]=f-1;--c[o],c[i]+=f}c[i]-=h[i]}for(;0===c[--l];)c.pop();for(;0===c[0];c.shift())--n;return c[0]?(t.d=c,t.e=n,s?T(t,p):t):new A(0)}function F(e,t,r){var n,i=b(e),o=v(e.d),a=o.length;return t?(r&&(n=r-a)>0?o=o.charAt(0)+"."+o.slice(1)+C(n):a>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i<0?"e":"e+")+i):i<0?(o="0."+C(-i-1)+o,r&&(n=r-a)>0&&(o+=C(n))):i>=a?(o+=C(i+1-a),r&&(n=r-i-1)>0&&(o=o+"."+C(n))):((n=i+1)<a&&(o=o.slice(0,n)+"."+o.slice(n)),r&&(n=r-a)>0&&(i+1===a&&(o+="."),o+=C(n))),e.s<0?"-"+o:o}function k(e,t){if(e.length>t)return e.length=t,!0}function P(e){if(!e||"object"!==typeof e)throw Error(l+"Object expected");var t,r,n,i=["precision",1,o,"rounding",0,8,"toExpNeg",-1/0,0,"toExpPos",0,1/0];for(t=0;t<i.length;t+=3)if(void 0!==(n=e[r=i[t]])){if(!(d(n)===n&&n>=i[t+1]&&n<=i[t+2]))throw Error(c+r+": "+n);this[r]=n}if(void 0!==(n=e[r="LN10"])){if(n!=Math.LN10)throw Error(c+r+": "+n);this[r]=new this(n)}return this}a=function e(t){var r,n,i;function o(e){var t=this;if(!(t instanceof o))return new o(e);if(t.constructor=o,e instanceof o)return t.s=e.s,t.e=e.e,void(t.d=(e=e.d)?e.slice():e);if("number"===typeof e){if(0*e!==0)throw Error(c+e);if(e>0)t.s=1;else{if(!(e<0))return t.s=0,t.e=0,void(t.d=[0]);e=-e,t.s=-1}return e===~~e&&e<1e7?(t.e=0,void(t.d=[e])):S(t,e.toString())}if("string"!==typeof e)throw Error(c+e);if(45===e.charCodeAt(0)?(e=e.slice(1),t.s=-1):t.s=1,!A.test(e))throw Error(c+e);S(t,e)}if(o.prototype=g,o.ROUND_UP=0,o.ROUND_DOWN=1,o.ROUND_CEIL=2,o.ROUND_FLOOR=3,o.ROUND_HALF_UP=4,o.ROUND_HALF_DOWN=5,o.ROUND_HALF_EVEN=6,o.ROUND_HALF_CEIL=7,o.ROUND_HALF_FLOOR=8,o.clone=e,o.config=o.set=P,void 0===t&&(t={}),t)for(i=["precision","rounding","toExpNeg","toExpPos","LN10"],r=0;r<i.length;)t.hasOwnProperty(n=i[r++])||(t[n]=this[n]);return o.config(t),o}(a),a.default=a.Decimal=a,i=new a(1),void 0===(n=function(){return a}.call(t,r,t,e))||(e.exports=n)}()},8268(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(2132);t.isMatch=function(e,t){return n.isMatchWith(e,t,()=>{})}},8346(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.toArray=function(e){return Array.isArray(e)?e:Array.from(e)}},8365(e,t,r){"use strict";var n=r(5043);var i="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},o=n.useSyncExternalStore,a=n.useRef,s=n.useEffect,l=n.useMemo,c=n.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,n,u){var d=a(null);if(null===d.current){var h={hasValue:!1,value:null};d.current=h}else h=d.current;d=l(function(){function e(e){if(!s){if(s=!0,o=e,e=n(e),void 0!==u&&h.hasValue){var t=h.value;if(u(t,e))return a=t}return a=e}if(t=a,i(o,e))return t;var r=n(e);return void 0!==u&&u(t,r)?(o=e,t):(o=e,a=r)}var o,a,s=!1,l=void 0===r?null:r;return[function(){return e(t())},null===l?void 0:function(){return e(l())}]},[t,r,n,u]);var A=o(e,d[0],d[1]);return s(function(){h.hasValue=!0,h.value=A},[A]),c(A),A}},8396(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(5508);t.cloneDeep=function(e){return n.cloneDeepWith(e)}},8420(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isLength=function(e){return Number.isSafeInteger(e)&&e>=0}},8443(e,t,r){"use strict";e.exports=r(9717)},8499(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function n(){}function i(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function o(e,t,n,o,a){if("function"!==typeof n)throw new TypeError("The listener must be a function");var s=new i(n,o||e,a),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],s]:e._events[l].push(s):(e._events[l]=s,e._eventsCount++),e}function a(e,t){0===--e._eventsCount?e._events=new n:delete e._events[t]}function s(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(r=!1)),s.prototype.eventNames=function(){var e,n,i=[];if(0===this._eventsCount)return i;for(n in e=this._events)t.call(e,n)&&i.push(r?n.slice(1):n);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},s.prototype.listeners=function(e){var t=r?r+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var i=0,o=n.length,a=new Array(o);i<o;i++)a[i]=n[i].fn;return a},s.prototype.listenerCount=function(e){var t=r?r+e:e,n=this._events[t];return n?n.fn?1:n.length:0},s.prototype.emit=function(e,t,n,i,o,a){var s=r?r+e:e;if(!this._events[s])return!1;var l,c,u=this._events[s],d=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),d){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,n),!0;case 4:return u.fn.call(u.context,t,n,i),!0;case 5:return u.fn.call(u.context,t,n,i,o),!0;case 6:return u.fn.call(u.context,t,n,i,o,a),!0}for(c=1,l=new Array(d-1);c<d;c++)l[c-1]=arguments[c];u.fn.apply(u.context,l)}else{var h,A=u.length;for(c=0;c<A;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),d){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,n);break;case 4:u[c].fn.call(u[c].context,t,n,i);break;default:if(!l)for(h=1,l=new Array(d-1);h<d;h++)l[h-1]=arguments[h];u[c].fn.apply(u[c].context,l)}}return!0},s.prototype.on=function(e,t,r){return o(this,e,t,r,!1)},s.prototype.once=function(e,t,r){return o(this,e,t,r,!0)},s.prototype.removeListener=function(e,t,n,i){var o=r?r+e:e;if(!this._events[o])return this;if(!t)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==t||i&&!s.once||n&&s.context!==n||a(this,o);else{for(var l=0,c=[],u=s.length;l<u;l++)(s[l].fn!==t||i&&!s[l].once||n&&s[l].context!==n)&&c.push(s[l]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&a(this,t)):(this._events=new n,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=r,s.EventEmitter=s,e.exports=s},8845(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(8268),i=r(3272),o=r(8396),a=r(9323),s=r(5303);t.matchesProperty=function(e,t){switch(typeof e){case"object":var r;Object.is(null===(r=e)||void 0===r?void 0:r.valueOf(),-0)&&(e="-0");break;case"number":e=i.toKey(e)}return t=o.cloneDeep(t),function(r){const i=a.get(r,e);return void 0===i?s.has(r,e):void 0===t?void 0===i:n.isMatch(i,t)}}},8853(e,t,r){"use strict";e.exports=r(7234)},9045(e,t,r){var n=r(3738).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},9323(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(7260),i=r(2489),o=r(3272),a=r(1444);t.get=function e(t,r,s){if(null==t)return s;switch(typeof r){case"string":{if(n.isUnsafeProperty(r))return s;const o=t[r];return void 0===o?i.isDeepKey(r)?e(t,a.toPath(r),s):s:o}case"number":case"symbol":{"number"===typeof r&&(r=o.toKey(r));const e=t[r];return void 0===e?s:e}default:{var l;if(Array.isArray(r))return function(e,t,r){if(0===t.length)return r;let i=e;for(let o=0;o<t.length;o++){if(null==i)return r;if(n.isUnsafeProperty(t[o]))return r;i=i[t[o]]}if(void 0===i)return r;return i}(t,r,s);if(r=Object.is(null===(l=r)||void 0===l?void 0:l.valueOf(),-0)?"-0":String(r),n.isUnsafeProperty(r))return s;const e=t[r];return void 0===e?s:e}}}},9397(e,t,r){e.exports=r(2682).isPlainObject},9461(e,t,r){"use strict";e.exports=r(2330)},9599(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.identity=function(e){return e}},9645(e,t,r){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});const n=r(6392),i=r(8346),o=r(1203);t.last=function(e){if(o.isArrayLike(e))return n.last(i.toArray(e))}},9709(e,t){"use strict";function r(e){return"symbol"===typeof e?1:null===e?2:void 0===e?3:e!==e?4:0}Object.defineProperty(t,Symbol.toStringTag,{value:"Module"});t.compareValues=(e,t,n)=>{if(e!==t){const i=r(e),o=r(t);if(i===o&&0===i){if(e<t)return"desc"===n?1:-1;if(e>t)return"desc"===n?-1:1}return"desc"===n?o-i:i-o}return 0}},9717(e,t,r){"use strict";var n=r(5043),i=r(9461);var o="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},a=i.useSyncExternalStore,s=n.useRef,l=n.useEffect,c=n.useMemo,u=n.useDebugValue;t.useSyncExternalStoreWithSelector=function(e,t,r,n,i){var d=s(null);if(null===d.current){var h={hasValue:!1,value:null};d.current=h}else h=d.current;d=c(function(){function e(e){if(!l){if(l=!0,a=e,e=n(e),void 0!==i&&h.hasValue){var t=h.value;if(i(t,e))return s=t}return s=e}if(t=s,o(a,e))return t;var r=n(e);return void 0!==i&&i(t,r)?(a=e,t):(a=e,s=r)}var a,s,l=!1,c=void 0===r?null:r;return[function(){return e(t())},null===c?void 0:function(){return e(c())}]},[t,r,n,i]);var A=a(e,d[0],d[1]);return l(function(){h.hasValue=!0,h.value=A},[A]),u(A),A}},9859(e,t,r){e.exports=r(7231).range},9903(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.ary=function(e,t){return function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];return e.apply(this,n.slice(0,t))}}},9921(e,t){"use strict";Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),t.isObjectLike=function(e){return"object"===typeof e&&null!==e}}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var o=t[n]={exports:{}};return e[n].call(o.exports,o,o.exports,r),o.exports}r.m=e,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"===typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"===typeof n.then)return n}var o=Object.create(null);r.r(o);var a={};e=e||[null,t({}),t([]),t(t)];for(var s=2&i&&n;("object"==typeof s||"function"==typeof s)&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach(e=>a[e]=()=>n[e]);return a.default=()=>n,r.d(o,a),o}})(),r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce((t,n)=>(r.f[n](e,t),t),[])),r.u=e=>"static/js/"+e+".6385f967.chunk.js",r.miniCssF=e=>{},r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="canopi-frontend:";r.l=(n,i,o,a)=>{if(e[n])e[n].push(i);else{var s,l;if(void 0!==o)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+o){s=d;break}}s||(l=!0,(s=document.createElement("script")).charset="utf-8",r.nc&&s.setAttribute("nonce",r.nc),s.setAttribute("data-webpack",t+o),s.src=n),e[n]=[i];var h=(t,r)=>{s.onerror=s.onload=null,clearTimeout(A);var i=e[n];if(delete e[n],s.parentNode&&s.parentNode.removeChild(s),i&&i.forEach(e=>e(r)),t)return t(r)},A=setTimeout(h.bind(null,void 0,{type:"timeout",target:s}),12e4);s.onerror=h.bind(null,s.onerror),s.onload=h.bind(null,s.onload),l&&document.head.appendChild(s)}}})(),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/CANOPI_Prototyping/",(()=>{var e={792:0};r.f.j=(t,n)=>{var i=r.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var o=new Promise((r,n)=>i=e[t]=[r,n]);n.push(i[2]=o);var a=r.p+r.u(t),s=new Error;r.l(a,n=>{if(r.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var o=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;s.message="Loading chunk "+t+" failed.\n("+o+": "+a+")",s.name="ChunkLoadError",s.type=o,s.request=a,i[1](s)}},"chunk-"+t,t)}};var t=(t,n)=>{var i,o,[a,s,l]=n,c=0;if(a.some(t=>0!==e[t])){for(i in s)r.o(s,i)&&(r.m[i]=s[i]);if(l)l(r)}for(t&&t(n);c<a.length;c++)o=a[c],r.o(e,o)&&e[o]&&e[o][0](),e[o]=0},n=self.webpackChunkcanopi_frontend=self.webpackChunkcanopi_frontend||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";var e={};r.r(e),r.d(e,{hasBrowserEnv:()=>ao,hasStandardBrowserEnv:()=>lo,hasStandardBrowserWebWorkerEnv:()=>co,navigator:()=>so,origin:()=>uo});var t={};r.r(t),r.d(t,{scaleBand:()=>Nh,scaleDiverging:()=>Lg,scaleDivergingLog:()=>Dg,scaleDivergingPow:()=>Rg,scaleDivergingSqrt:()=>zg,scaleDivergingSymlog:()=>Ug,scaleIdentity:()=>If,scaleImplicit:()=>Rh,scaleLinear:()=>Tf,scaleLog:()=>Rf,scaleOrdinal:()=>zh,scalePoint:()=>Qh,scalePow:()=>Wf,scaleQuantile:()=>op,scaleQuantize:()=>ap,scaleRadial:()=>Xf,scaleSequential:()=>Tg,scaleSequentialLog:()=>Ig,scaleSequentialPow:()=>kg,scaleSequentialQuantile:()=>Mg,scaleSequentialSqrt:()=>Pg,scaleSequentialSymlog:()=>Fg,scaleSqrt:()=>qf,scaleSymlog:()=>Qf,scaleThreshold:()=>sp,scaleTime:()=>Bg,scaleUtc:()=>Cg,tickFormat:()=>Ef});var n=r(5043),i=r.t(n,2),o=r(4391),a=r(7237);function s(e){e()}var l={notify(){},get:()=>[]};function c(e,t){let r,n=l,i=0,o=!1;function a(){d.onStateChange&&d.onStateChange()}function c(){i++,r||(r=t?t.addNestedSub(a):e.subscribe(a),n=function(){let e=null,t=null;return{clear(){e=null,t=null},notify(){s(()=>{let t=e;for(;t;)t.callback(),t=t.next})},get(){const t=[];let r=e;for(;r;)t.push(r),r=r.next;return t},subscribe(r){let n=!0;const i=t={callback:r,next:null,prev:t};return i.prev?i.prev.next=i:e=i,function(){n&&null!==e&&(n=!1,i.next?i.next.prev=i.prev:t=i.prev,i.prev?i.prev.next=i.next:e=i.next)}}}}())}function u(){i--,r&&0===i&&(r(),r=void 0,n.clear(),n=l)}const d={addNestedSub:function(e){c();const t=n.subscribe(e);let r=!1;return()=>{r||(r=!0,t(),u())}},notifyNestedSubs:function(){n.notify()},handleChangeWrapper:a,isSubscribed:function(){return o},trySubscribe:function(){o||(o=!0,c())},tryUnsubscribe:function(){o&&(o=!1,u())},getListeners:()=>n};return d}var u=(()=>!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement))(),d=(()=>"undefined"!==typeof navigator&&"ReactNative"===navigator.product)(),h=(()=>u||d?n.useLayoutEffect:n.useEffect)();function A(e,t){return e===t?0!==e||0!==t||1/e===1/t:e!==e&&t!==t}function f(e,t){if(A(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;const r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(let i=0;i<r.length;i++)if(!Object.prototype.hasOwnProperty.call(t,r[i])||!A(e[r[i]],t[r[i]]))return!1;return!0}Object.defineProperty,Object.getOwnPropertyNames,Object.getOwnPropertySymbols,Object.getOwnPropertyDescriptor,Object.getPrototypeOf,Object.prototype;var p=Symbol.for("react-redux-context"),m="undefined"!==typeof globalThis?globalThis:{};function g(){var e;if(!n.createContext)return{};const t=null!==(e=m[p])&&void 0!==e?e:m[p]=new Map;let r=t.get(n.createContext);return r||(r=n.createContext(null),t.set(n.createContext,r)),r}var y=g();var _=function(e){const{children:t,context:r,serverState:i,store:o}=e,a=n.useMemo(()=>{const e=c(o);return{store:o,subscription:e,getServerState:i?()=>i:void 0}},[o,i]),s=n.useMemo(()=>o.getState(),[o]);h(()=>{const{subscription:e}=a;return e.onStateChange=e.notifyNestedSubs,e.trySubscribe(),s!==o.getState()&&e.notifyNestedSubs(),()=>{e.tryUnsubscribe(),e.onStateChange=void 0}},[a,s]);const l=r||y;return n.createElement(l.Provider,{value:a},t)};function v(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;return function(){return n.useContext(e)}}var x=v();function w(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;const t=e===y?x:v(e),r=()=>{const{store:e}=t();return e};return Object.assign(r,{withTypes:()=>r}),r}var b=w();function B(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;const t=e===y?b:w(e),r=()=>t().dispatch;return Object.assign(r,{withTypes:()=>r}),r}var C=B(),E=(e,t)=>e===t;function S(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:y;const t=e===y?x:v(e),r=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const{equalityFn:i=E}="function"===typeof r?{equalityFn:r}:r;const o=t(),{store:s,subscription:l,getServerState:c}=o,u=(n.useRef(!0),n.useCallback({[e.name]:t=>e(t)}[e.name],[e])),d=(0,a.useSyncExternalStoreWithSelector)(l.addNestedSub,s.getState,c||s.getState,u,i);return n.useDebugValue(d),d};return Object.assign(r,{withTypes:()=>r}),r}var T,I=S(),F=r(7950),k=r.t(F,2);function P(){return P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},P.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(T||(T={}));const M="popstate";function O(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function L(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(r){}}}function D(e,t){return{usr:e.state,key:e.key,idx:t}}function U(e,t,r,n){return void 0===r&&(r=null),P({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?z(t):t,{state:r,key:t&&t.key||n||Math.random().toString(36).substr(2,8)})}function R(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&"?"!==r&&(t+="?"===r.charAt(0)?r:"?"+r),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function z(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substr(r),e=e.substr(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substr(n),e=e.substr(0,n)),e&&(t.pathname=e)}return t}function N(e,t,r,n){void 0===n&&(n={});let{window:i=document.defaultView,v5Compat:o=!1}=n,a=i.history,s=T.Pop,l=null,c=u();function u(){return(a.state||{idx:null}).idx}function d(){s=T.Pop;let e=u(),t=null==e?null:e-c;c=e,l&&l({action:s,location:A.location,delta:t})}function h(e){let t="null"!==i.location.origin?i.location.origin:i.location.href,r="string"===typeof e?e:R(e);return r=r.replace(/ $/,"%20"),O(t,"No window.location.(origin|href) available to create URL for href: "+r),new URL(r,t)}null==c&&(c=0,a.replaceState(P({},a.state,{idx:c}),""));let A={get action(){return s},get location(){return e(i,a)},listen(e){if(l)throw new Error("A history only accepts one active listener");return i.addEventListener(M,d),l=e,()=>{i.removeEventListener(M,d),l=null}},createHref:e=>t(i,e),createURL:h,encodeLocation(e){let t=h(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){s=T.Push;let n=U(A.location,e,t);r&&r(n,e),c=u()+1;let d=D(n,c),h=A.createHref(n);try{a.pushState(d,"",h)}catch(f){if(f instanceof DOMException&&"DataCloneError"===f.name)throw f;i.location.assign(h)}o&&l&&l({action:s,location:A.location,delta:1})},replace:function(e,t){s=T.Replace;let n=U(A.location,e,t);r&&r(n,e),c=u();let i=D(n,c),d=A.createHref(n);a.replaceState(i,"",d),o&&l&&l({action:s,location:A.location,delta:0})},go:e=>a.go(e)};return A}var j;!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(j||(j={}));new Set(["lazy","caseSensitive","path","id","index","children"]);function Q(e,t,r){return void 0===r&&(r="/"),V(e,t,r,!1)}function V(e,t,r,n){let i=ne(("string"===typeof t?z(t):t).pathname||"/",r);if(null==i)return null;let o=H(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let r=e.length===t.length&&e.slice(0,-1).every((e,r)=>e===t[r]);return r?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(o);let a=null;for(let s=0;null==a&&s<o.length;++s){let e=re(i);a=ee(o[s],e,n)}return a}function H(e,t,r,n){void 0===t&&(t=[]),void 0===r&&(r=[]),void 0===n&&(n="");let i=(e,i,o)=>{let a={relativePath:void 0===o?e.path||"":o,caseSensitive:!0===e.caseSensitive,childrenIndex:i,route:e};a.relativePath.startsWith("/")&&(O(a.relativePath.startsWith(n),'Absolute route path "'+a.relativePath+'" nested under path "'+n+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),a.relativePath=a.relativePath.slice(n.length));let s=de([n,a.relativePath]),l=r.concat(a);e.children&&e.children.length>0&&(O(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+s+'".'),H(e.children,t,l,s)),(null!=e.path||e.index)&&t.push({path:s,score:$(s,e.index),routesMeta:l})};return e.forEach((e,t)=>{var r;if(""!==e.path&&null!=(r=e.path)&&r.includes("?"))for(let n of G(e.path))i(e,t,n);else i(e,t)}),t}function G(e){let t=e.split("/");if(0===t.length)return[];let[r,...n]=t,i=r.endsWith("?"),o=r.replace(/\?$/,"");if(0===n.length)return i?[o,""]:[o];let a=G(n.join("/")),s=[];return s.push(...a.map(e=>""===e?o:[o,e].join("/"))),i&&s.push(...a),s.map(t=>e.startsWith("/")&&""===t?"/":t)}const K=/^:[\w-]+$/,W=3,q=2,Z=1,X=10,Y=-2,J=e=>"*"===e;function $(e,t){let r=e.split("/"),n=r.length;return r.some(J)&&(n+=Y),t&&(n+=q),r.filter(e=>!J(e)).reduce((e,t)=>e+(K.test(t)?W:""===t?Z:X),n)}function ee(e,t,r){void 0===r&&(r=!1);let{routesMeta:n}=e,i={},o="/",a=[];for(let s=0;s<n.length;++s){let e=n[s],l=s===n.length-1,c="/"===o?t:t.slice(o.length)||"/",u=te({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),d=e.route;if(!u&&l&&r&&!n[n.length-1].route.index&&(u=te({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),a.push({params:i,pathname:de([o,u.pathname]),pathnameBase:he(de([o,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(o=de([o,u.pathnameBase]))}return a}function te(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=function(e,t,r){void 0===t&&(t=!1);void 0===r&&(r=!0);L("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');let n=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,r)=>(n.push({paramName:t,isOptional:null!=r}),r?"/?([^\\/]+)?":"/([^\\/]+)"));e.endsWith("*")?(n.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))");let o=new RegExp(i,t?void 0:"i");return[o,n]}(e.path,e.caseSensitive,e.end),i=t.match(r);if(!i)return null;let o=i[0],a=o.replace(/(.)\/+$/,"$1"),s=i.slice(1),l=n.reduce((e,t,r)=>{let{paramName:n,isOptional:i}=t;if("*"===n){let e=s[r]||"";a=o.slice(0,o.length-e.length).replace(/(.)\/+$/,"$1")}const l=s[r];return e[n]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{});return{params:l,pathname:o,pathnameBase:a,pattern:e}}function re(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return L(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent encoding ('+t+")."),e}}function ne(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&"/"!==n?null:e.slice(r)||"/"}const ie=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i;function oe(e,t){void 0===t&&(t="/");let r,{pathname:n,search:i="",hash:o=""}="string"===typeof e?z(e):e;if(n)if(a=n,ie.test(a))r=n;else{if(n.includes("//")){let e=n;n=n.replace(/\/\/+/g,"/"),L(!1,"Pathnames cannot have embedded double slashes - normalizing "+e+" -> "+n)}r=n.startsWith("/")?ae(n.substring(1),"/"):ae(n,t)}else r=t;var a;return{pathname:r,search:Ae(i),hash:fe(o)}}function ae(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?r.length>1&&r.pop():"."!==e&&r.push(e)}),r.length>1?r.join("/"):"/"}function se(e,t,r,n){return"Cannot include a '"+e+"' character in a manually specified `to."+t+"` field ["+JSON.stringify(n)+"].  Please separate it out to the `to."+r+'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.'}function le(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function ce(e,t){let r=le(e);return t?r.map((e,t)=>t===r.length-1?e.pathname:e.pathnameBase):r.map(e=>e.pathnameBase)}function ue(e,t,r,n){let i;void 0===n&&(n=!1),"string"===typeof e?i=z(e):(i=P({},e),O(!i.pathname||!i.pathname.includes("?"),se("?","pathname","search",i)),O(!i.pathname||!i.pathname.includes("#"),se("#","pathname","hash",i)),O(!i.search||!i.search.includes("#"),se("#","search","hash",i)));let o,a=""===e||""===i.pathname,s=a?"/":i.pathname;if(null==s)o=r;else{let e=t.length-1;if(!n&&s.startsWith("..")){let t=s.split("/");for(;".."===t[0];)t.shift(),e-=1;i.pathname=t.join("/")}o=e>=0?t[e]:"/"}let l=oe(i,o),c=s&&"/"!==s&&s.endsWith("/"),u=(a||"."===s)&&r.endsWith("/");return l.pathname.endsWith("/")||!c&&!u||(l.pathname+="/"),l}const de=e=>e.join("/").replace(/\/\/+/g,"/"),he=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),Ae=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",fe=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";Error;function pe(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}const me=["post","put","patch","delete"],ge=(new Set(me),["get",...me]);new Set(ge),new Set([301,302,303,307,308]),new Set([307,308]);Symbol("deferred");function ye(){return ye=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ye.apply(this,arguments)}const _e=n.createContext(null);const ve=n.createContext(null);const xe=n.createContext(null);const we=n.createContext(null);const be=n.createContext({outlet:null,matches:[],isDataRoute:!1});const Be=n.createContext(null);function Ce(){return null!=n.useContext(we)}function Ee(){return Ce()||O(!1),n.useContext(we).location}function Se(e){n.useContext(xe).static||n.useLayoutEffect(e)}function Te(){let{isDataRoute:e}=n.useContext(be);return e?function(){let{router:e}=Ue(Le.UseNavigateStable),t=ze(De.UseNavigateStable),r=n.useRef(!1);Se(()=>{r.current=!0});let i=n.useCallback(function(n,i){void 0===i&&(i={}),r.current&&("number"===typeof n?e.navigate(n):e.navigate(n,ye({fromRouteId:t},i)))},[e,t]);return i}():function(){Ce()||O(!1);let e=n.useContext(_e),{basename:t,future:r,navigator:i}=n.useContext(xe),{matches:o}=n.useContext(be),{pathname:a}=Ee(),s=JSON.stringify(ce(o,r.v7_relativeSplatPath)),l=n.useRef(!1);Se(()=>{l.current=!0});let c=n.useCallback(function(r,n){if(void 0===n&&(n={}),!l.current)return;if("number"===typeof r)return void i.go(r);let o=ue(r,JSON.parse(s),a,"path"===n.relative);null==e&&"/"!==t&&(o.pathname="/"===o.pathname?t:de([t,o.pathname])),(n.replace?i.replace:i.push)(o,n.state,n)},[t,i,s,a,e]);return c}()}function Ie(e,t,r,i){Ce()||O(!1);let{navigator:o}=n.useContext(xe),{matches:a}=n.useContext(be),s=a[a.length-1],l=s?s.params:{},c=(s&&s.pathname,s?s.pathnameBase:"/");s&&s.route;let u,d=Ee();if(t){var h;let e="string"===typeof t?z(t):t;"/"===c||(null==(h=e.pathname)?void 0:h.startsWith(c))||O(!1),u=e}else u=d;let A=u.pathname||"/",f=A;if("/"!==c){let e=c.replace(/^\//,"").split("/");f="/"+A.replace(/^\//,"").split("/").slice(e.length).join("/")}let p=Q(e,{pathname:f});let m=Oe(p&&p.map(e=>Object.assign({},e,{params:Object.assign({},l,e.params),pathname:de([c,o.encodeLocation?o.encodeLocation(e.pathname).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?c:de([c,o.encodeLocation?o.encodeLocation(e.pathnameBase).pathname:e.pathnameBase])})),a,r,i);return t&&m?n.createElement(we.Provider,{value:{location:ye({pathname:"/",search:"",hash:"",state:null,key:"default"},u),navigationType:T.Pop}},m):m}function Fe(){let e=function(){var e;let t=n.useContext(Be),r=Re(De.UseRouteError),i=ze(De.UseRouteError);if(void 0!==t)return t;return null==(e=r.errors)?void 0:e[i]}(),t=pe(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,i="rgba(200,200,200, 0.5)",o={padding:"0.5rem",backgroundColor:i};return n.createElement(n.Fragment,null,n.createElement("h2",null,"Unexpected Application Error!"),n.createElement("h3",{style:{fontStyle:"italic"}},t),r?n.createElement("pre",{style:o},r):null,null)}const ke=n.createElement(Fe,null);class Pe extends n.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return void 0!==this.state.error?n.createElement(be.Provider,{value:this.props.routeContext},n.createElement(Be.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Me(e){let{routeContext:t,match:r,children:i}=e,o=n.useContext(_e);return o&&o.static&&o.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=r.route.id),n.createElement(be.Provider,{value:t},i)}function Oe(e,t,r,i){var o;if(void 0===t&&(t=[]),void 0===r&&(r=null),void 0===i&&(i=null),null==e){var a;if(!r)return null;if(r.errors)e=r.matches;else{if(!(null!=(a=i)&&a.v7_partialHydration&&0===t.length&&!r.initialized&&r.matches.length>0))return null;e=r.matches}}let s=e,l=null==(o=r)?void 0:o.errors;if(null!=l){let e=s.findIndex(e=>e.route.id&&void 0!==(null==l?void 0:l[e.route.id]));e>=0||O(!1),s=s.slice(0,Math.min(s.length,e+1))}let c=!1,u=-1;if(r&&i&&i.v7_partialHydration)for(let n=0;n<s.length;n++){let e=s[n];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(u=n),e.route.id){let{loaderData:t,errors:n}=r,i=e.route.loader&&void 0===t[e.route.id]&&(!n||void 0===n[e.route.id]);if(e.route.lazy||i){c=!0,s=u>=0?s.slice(0,u+1):[s[0]];break}}}return s.reduceRight((e,i,o)=>{let a,d=!1,h=null,A=null;var f;r&&(a=l&&i.route.id?l[i.route.id]:void 0,h=i.route.errorElement||ke,c&&(u<0&&0===o?(f="route-fallback",!1||Ne[f]||(Ne[f]=!0),d=!0,A=null):u===o&&(d=!0,A=i.route.hydrateFallbackElement||null)));let p=t.concat(s.slice(0,o+1)),m=()=>{let t;return t=a?h:d?A:i.route.Component?n.createElement(i.route.Component,null):i.route.element?i.route.element:e,n.createElement(Me,{match:i,routeContext:{outlet:e,matches:p,isDataRoute:null!=r},children:t})};return r&&(i.route.ErrorBoundary||i.route.errorElement||0===o)?n.createElement(Pe,{location:r.location,revalidation:r.revalidation,component:h,error:a,children:m(),routeContext:{outlet:null,matches:p,isDataRoute:!0}}):m()},null)}var Le=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(Le||{}),De=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(De||{});function Ue(e){let t=n.useContext(_e);return t||O(!1),t}function Re(e){let t=n.useContext(ve);return t||O(!1),t}function ze(e){let t=function(){let e=n.useContext(be);return e||O(!1),e}(),r=t.matches[t.matches.length-1];return r.route.id||O(!1),r.route.id}const Ne={};function je(e,t){null==e||e.v7_startTransition,void 0===(null==e?void 0:e.v7_relativeSplatPath)&&(!t||t.v7_relativeSplatPath),t&&(t.v7_fetcherPersist,t.v7_normalizeFormMethod,t.v7_partialHydration,t.v7_skipActionErrorRevalidation)}i.startTransition;function Qe(e){let{to:t,replace:r,state:i,relative:o}=e;Ce()||O(!1);let{future:a,static:s}=n.useContext(xe),{matches:l}=n.useContext(be),{pathname:c}=Ee(),u=Te(),d=ue(t,ce(l,a.v7_relativeSplatPath),c,"path"===o),h=JSON.stringify(d);return n.useEffect(()=>u(JSON.parse(h),{replace:r,state:i,relative:o}),[u,h,o,r,i]),null}function Ve(e){O(!1)}function He(e){let{basename:t="/",children:r=null,location:i,navigationType:o=T.Pop,navigator:a,static:s=!1,future:l}=e;Ce()&&O(!1);let c=t.replace(/^\/*/,"/"),u=n.useMemo(()=>({basename:c,navigator:a,static:s,future:ye({v7_relativeSplatPath:!1},l)}),[c,l,a,s]);"string"===typeof i&&(i=z(i));let{pathname:d="/",search:h="",hash:A="",state:f=null,key:p="default"}=i,m=n.useMemo(()=>{let e=ne(d,c);return null==e?null:{location:{pathname:e,search:h,hash:A,state:f,key:p},navigationType:o}},[c,d,h,A,f,p,o]);return null==m?null:n.createElement(xe.Provider,{value:u},n.createElement(we.Provider,{children:r,value:m}))}function Ge(e){let{children:t,location:r}=e;return Ie(Ke(t),r)}new Promise(()=>{});n.Component;function Ke(e,t){void 0===t&&(t=[]);let r=[];return n.Children.forEach(e,(e,i)=>{if(!n.isValidElement(e))return;let o=[...t,i];if(e.type===n.Fragment)return void r.push.apply(r,Ke(e.props.children,o));e.type!==Ve&&O(!1),e.props.index&&e.props.children&&O(!1);let a={id:e.props.id||o.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(a.children=Ke(e.props.children,o)),r.push(a)}),r}new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);try{window.__reactRouterVersion="6"}catch(JO){}new Map;const We=i.startTransition;k.flushSync,i.useId;function qe(e){let{basename:t,children:r,future:i,window:o}=e,a=n.useRef();var s;null==a.current&&(a.current=(void 0===(s={window:o,v5Compat:!0})&&(s={}),N(function(e,t){let{pathname:r,search:n,hash:i}=e.location;return U("",{pathname:r,search:n,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:R(t)},null,s)));let l=a.current,[c,u]=n.useState({action:l.action,location:l.location}),{v7_startTransition:d}=i||{},h=n.useCallback(e=>{d&&We?We(()=>u(e)):u(e)},[u,d]);return n.useLayoutEffect(()=>l.listen(h),[l,h]),n.useEffect(()=>je(i),[i]),n.createElement(He,{basename:t,children:r,location:c.location,navigationType:c.action,navigator:l,future:i})}"undefined"!==typeof window&&"undefined"!==typeof window.document&&window.document.createElement;var Ze,Xe;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(Ze||(Ze={})),function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"}(Xe||(Xe={}));var Ye=r(879),Je=r.n(Ye);const $e=()=>C(),et=I;function tt(e){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},tt(e)}function rt(e){var t=function(e,t){if("object"!=tt(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==tt(t)?t:t+""}function nt(e,t,r){return(t=rt(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function it(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ot(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?it(Object(r),!0).forEach(function(t){nt(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):it(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}var at=Symbol.for("immer-nothing"),st=Symbol.for("immer-draftable"),lt=Symbol.for("immer-state");function ct(e){throw new Error("[Immer] minified error nr: ".concat(e,". Full error at: https://bit.ly/3cXEKWf"))}var ut=Object,dt=ut.getPrototypeOf,ht="constructor",At="prototype",ft="configurable",pt="enumerable",mt="writable",gt="value",yt=e=>!!e&&!!e[lt];function _t(e){var t;return!!e&&(wt(e)||Tt(e)||!!e[st]||!(null===(t=e[ht])||void 0===t||!t[st])||It(e)||Ft(e))}var vt=ut[At][ht].toString(),xt=new WeakMap;function wt(e){if(!e||!kt(e))return!1;const t=dt(e);if(null===t||t===ut[At])return!0;const r=ut.hasOwnProperty.call(t,ht)&&t[ht];if(r===Object)return!0;if(!Pt(r))return!1;let n=xt.get(r);return void 0===n&&(n=Function.toString.call(r),xt.set(r,n)),n===vt}function bt(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===Bt(e)){(r?Reflect.ownKeys(e):ut.keys(e)).forEach(r=>{t(r,e[r],e)})}else e.forEach((r,n)=>t(n,r,e))}function Bt(e){const t=e[lt];return t?t.type_:Tt(e)?1:It(e)?2:Ft(e)?3:0}var Ct=function(e,t){return 2===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bt(e))?e.has(t):ut[At].hasOwnProperty.call(e,t)},Et=function(e,t){return 2===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:Bt(e))?e.get(t):e[t]},St=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Bt(e);2===n?e.set(t,r):3===n?e.add(r):e[t]=r};var Tt=Array.isArray,It=e=>e instanceof Map,Ft=e=>e instanceof Set,kt=e=>"object"===typeof e,Pt=e=>"function"===typeof e,Mt=e=>"boolean"===typeof e;var Ot=e=>e.copy_||e.base_,Lt=e=>e.modified_?e.copy_:e.base_;function Dt(e,t){if(It(e))return new Map(e);if(Ft(e))return new Set(e);if(Tt(e))return Array[At].slice.call(e);const r=wt(e);if(!0===t||"class_only"===t&&!r){const t=ut.getOwnPropertyDescriptors(e);delete t[lt];let r=Reflect.ownKeys(t);for(let n=0;n<r.length;n++){const i=r[n],o=t[i];!1===o[mt]&&(o[mt]=!0,o[ft]=!0),(o.get||o.set)&&(t[i]={[ft]:!0,[mt]:!0,[pt]:o[pt],[gt]:e[i]})}return ut.create(dt(e),t)}{const t=dt(e);if(null!==t&&r)return ot({},e);const n=ut.create(t);return ut.assign(n,e)}}function Ut(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return zt(e)||yt(e)||!_t(e)||(Bt(e)>1&&ut.defineProperties(e,{set:Rt,add:Rt,clear:Rt,delete:Rt}),ut.freeze(e),t&&bt(e,(e,t)=>{Ut(t,!0)},!1)),e}var Rt={[gt]:function(){ct(2)}};function zt(e){return null===e||!kt(e)||ut.isFrozen(e)}var Nt="MapSet",jt="Patches",Qt="ArrayMethods",Vt={};function Ht(e){const t=Vt[e];return t||ct(0),t}var Gt,Kt=e=>!!Vt[e];var Wt=()=>Gt;function qt(e,t){t&&(e.patchPlugin_=Ht(jt),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function Zt(e){Xt(e),e.drafts_.forEach(Jt),e.drafts_=null}function Xt(e){e===Gt&&(Gt=e.parent_)}var Yt=e=>Gt={drafts_:[],parent_:Gt,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0,handledSet_:new Set,processedForPatches_:new Set,mapSetPlugin_:Kt(Nt)?Ht(Nt):void 0,arrayMethodsPlugin_:Kt(Qt)?Ht(Qt):void 0};function Jt(e){const t=e[lt];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function $t(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];if(void 0!==e&&e!==r){r[lt].modified_&&(Zt(t),ct(4)),_t(e)&&(e=er(t,e));const{patchPlugin_:n}=t;n&&n.generateReplacementPatches_(r[lt].base_,e,t)}else e=er(t,r);return function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&Ut(t,r)}(t,e,!0),Zt(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==at?e:void 0}function er(e,t){if(zt(t))return t;const r=t[lt];if(!r){return sr(t,e.handledSet_,e)}if(!rr(r,e))return t;if(!r.modified_)return r.base_;if(!r.finalized_){const{callbacks_:t}=r;if(t)for(;t.length>0;){t.pop()(e)}or(r,e)}return r.copy_}function tr(e){e.finalized_=!0,e.scope_.unfinalizedDrafts_--}var rr=(e,t)=>e.scope_===t,nr=[];function ir(e,t,r,n){var i;const o=Ot(e),a=e.type_;if(void 0!==n){if(Et(o,n,a)===t)return void St(o,n,r,a)}if(!e.draftLocations_){const t=e.draftLocations_=new Map;bt(o,(e,r)=>{if(yt(r)){const n=t.get(r)||[];n.push(e),t.set(r,n)}})}const s=null!==(i=e.draftLocations_.get(t))&&void 0!==i?i:nr;for(const l of s)St(o,l,r,a)}function or(e,t){var r,n;if(e.modified_&&!e.finalized_&&(3===e.type_||1===e.type_&&e.allIndicesReassigned_||(null!==(r=null===(n=e.assigned_)||void 0===n?void 0:n.size)&&void 0!==r?r:0)>0)){const{patchPlugin_:r}=t;if(r){const n=r.getPath(e);n&&r.generatePatches_(e,n,t)}tr(e)}}function ar(e,t,r){const{scope_:n}=e;if(yt(r)){const i=r[lt];rr(i,n)&&i.callbacks_.push(function(){Ar(e);const n=Lt(i);ir(e,r,n,t)})}else _t(r)&&e.callbacks_.push(function(){const i=Ot(e);var o;3===e.type_?i.has(r)&&sr(r,n.handledSet_,n):Et(i,t,e.type_)===r&&n.drafts_.length>1&&!0===(null!==(o=e.assigned_.get(t))&&void 0!==o&&o)&&e.copy_&&sr(Et(e.copy_,t,e.type_),n.handledSet_,n)})}function sr(e,t,r){return!r.immer_.autoFreeze_&&r.unfinalizedDrafts_<1||yt(e)||t.has(e)||!_t(e)||zt(e)||(t.add(e),bt(e,(n,i)=>{if(yt(i)){const t=i[lt];if(rr(t,r)){const r=Lt(t);St(e,n,r,e.type_),tr(t)}}else _t(i)&&sr(i,t,r)})),e}var lr={get(e,t){if(t===lt)return e;let r=e.scope_.arrayMethodsPlugin_;const n=1===e.type_&&"string"===typeof t;if(n&&null!==r&&void 0!==r&&r.isArrayOperationMethod(t))return r.createMethodInterceptor(e,t);const i=Ot(e);if(!Ct(i,t,e.type_))return function(e,t,r){var n;const i=dr(t,r);return i?gt in i?i[gt]:null===(n=i.get)||void 0===n?void 0:n.call(e.draft_):void 0}(e,i,t);const o=i[t];if(e.finalized_||!_t(o))return o;if(n&&e.operationMethod&&null!==r&&void 0!==r&&r.isMutatingArrayMethod(e.operationMethod)&&function(e){const t=+e;return Number.isInteger(t)&&String(t)===e}(t))return o;if(o===ur(e.base_,t)){Ar(e);const r=1===e.type_?+t:t,n=fr(e.scope_,o,e,r);return e.copy_[r]=n}return o},has:(e,t)=>t in Ot(e),ownKeys:e=>Reflect.ownKeys(Ot(e)),set(e,t,r){const n=dr(Ot(e),t);if(null!==n&&void 0!==n&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const n=ur(Ot(e),t),a=null===n||void 0===n?void 0:n[lt];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_.set(t,!1),!0;if(((i=r)===(o=n)?0!==i||1/i===1/o:i!==i&&o!==o)&&(void 0!==r||Ct(e.base_,t,e.type_)))return!0;Ar(e),hr(e)}var i,o;return e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_.set(t,!0),ar(e,t,r)),!0},deleteProperty:(e,t)=>(Ar(e),void 0!==ur(e.base_,t)||t in e.base_?(e.assigned_.set(t,!1),hr(e)):e.assigned_.delete(t),e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const r=Ot(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{[mt]:!0,[ft]:1!==e.type_||"length"!==t,[pt]:n[pt],[gt]:r[t]}:n},defineProperty(){ct(11)},getPrototypeOf:e=>dt(e.base_),setPrototypeOf(){ct(12)}},cr={};for(let r in lr){let e=lr[r];cr[r]=function(){const t=arguments;return t[0]=t[0][0],e.apply(this,t)}}function ur(e,t){const r=e[lt];return(r?Ot(r):e)[t]}function dr(e,t){if(!(t in e))return;let r=dt(e);for(;r;){const e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=dt(r)}}function hr(e){e.modified_||(e.modified_=!0,e.parent_&&hr(e.parent_))}function Ar(e){e.copy_||(e.assigned_=new Map,e.copy_=Dt(e.base_,e.scope_.immer_.useStrictShallowCopy_))}cr.deleteProperty=function(e,t){return cr.set.call(this,e,t,void 0)},cr.set=function(e,t,r){return lr.set.call(this,e[0],t,r,e[0])};function fr(e,t,r,n){var i,o;const[a,s]=It(t)?Ht(Nt).proxyMap_(t,r):Ft(t)?Ht(Nt).proxySet_(t,r):function(e,t){const r=Tt(e),n={type_:r?1:0,scope_:t?t.scope_:Wt(),modified_:!1,finalized_:!1,assigned_:void 0,parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1,callbacks_:void 0};let i=n,o=lr;r&&(i=[n],o=cr);const{revoke:a,proxy:s}=Proxy.revocable(i,o);return n.draft_=s,n.revoke_=a,[s,n]}(t,r);return(null!==(i=null===r||void 0===r?void 0:r.scope_)&&void 0!==i?i:Wt()).drafts_.push(a),s.callbacks_=null!==(o=null===r||void 0===r?void 0:r.callbacks_)&&void 0!==o?o:[],s.key_=n,r&&void 0!==n?function(e,t,r){e.callbacks_.push(function(n){var i,o;const a=t;if(!a||!rr(a,n))return;null===(i=n.mapSetPlugin_)||void 0===i||i.fixSetContents(a);const s=Lt(a);ir(e,null!==(o=a.draft_)&&void 0!==o?o:a,s,r),or(a,n)})}(r,s,n):s.callbacks_.push(function(e){var t;null===(t=e.mapSetPlugin_)||void 0===t||t.fixSetContents(s);const{patchPlugin_:r}=e;s.modified_&&r&&r.generatePatches_(s,[],e)}),a}function pr(e){return yt(e)||ct(10),mr(e)}function mr(e){if(!_t(e)||zt(e))return e;const t=e[lt];let r,n=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=Dt(e,t.scope_.immer_.useStrictShallowCopy_),n=t.scope_.immer_.shouldUseStrictIteration()}else r=Dt(e,!0);return bt(r,(e,t)=>{St(r,e,mr(t))},n),t&&(t.finalized_=!1),r}var gr=new class{constructor(e){var t=this;this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!1,this.produce=(e,t,r)=>{if(Pt(e)&&!Pt(t)){const r=t;t=e;const n=this;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return n.produce(e,e=>t.call(this,e,...o))}}let n;if(Pt(t)||ct(6),void 0===r||Pt(r)||ct(7),_t(e)){const i=Yt(this),o=fr(i,e,void 0);let a=!0;try{n=t(o),a=!1}finally{a?Zt(i):Xt(i)}return qt(i,r),$t(n,i)}if(!e||!kt(e)){if(n=t(e),void 0===n&&(n=e),n===at&&(n=void 0),this.autoFreeze_&&Ut(n,!0),r){const t=[],i=[];Ht(jt).generateReplacementPatches_(e,n,{patches_:t,inversePatches_:i}),r(t,i)}return n}ct(1)},this.produceWithPatches=(e,r)=>{if(Pt(e))return function(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return t.produceWithPatches(r,t=>e(t,...i))};let n,i;return[this.produce(e,r,(e,t)=>{n=e,i=t}),n,i]},Mt(null===e||void 0===e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),Mt(null===e||void 0===e?void 0:e.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),Mt(null===e||void 0===e?void 0:e.useStrictIteration)&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){_t(e)||ct(8),yt(e)&&(e=pr(e));const t=Yt(this),r=fr(t,e,void 0);return r[lt].isManual_=!0,Xt(t),r}finishDraft(e,t){const r=e&&e[lt];r&&r.isManual_||ct(9);const{scope_:n}=r;return qt(n,t),$t(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const n=t[r];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}r>-1&&(t=t.slice(r+1));const n=Ht(jt).applyPatches_;return yt(e)?n(e,t):this.produce(e,e=>n(e,t))}},yr=gr.produce;function _r(e){return"Minified Redux error #".concat(e,"; visit https://redux.js.org/Errors?code=").concat(e," for the full message or use the non-minified dev environment for full errors. ")}var vr=(()=>"function"===typeof Symbol&&Symbol.observable||"@@observable")(),xr=()=>Math.random().toString(36).substring(7).split("").join("."),wr={INIT:"@@redux/INIT".concat(xr()),REPLACE:"@@redux/REPLACE".concat(xr()),PROBE_UNKNOWN_ACTION:()=>"@@redux/PROBE_UNKNOWN_ACTION".concat(xr())};function br(e){if("object"!==typeof e||null===e)return!1;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t||null===Object.getPrototypeOf(e)}function Br(e,t,r){if("function"!==typeof e)throw new Error(_r(2));if("function"===typeof t&&"function"===typeof r||"function"===typeof r&&"function"===typeof arguments[3])throw new Error(_r(0));if("function"===typeof t&&"undefined"===typeof r&&(r=t,t=void 0),"undefined"!==typeof r){if("function"!==typeof r)throw new Error(_r(1));return r(Br)(e,t)}let n=e,i=t,o=new Map,a=o,s=0,l=!1;function c(){a===o&&(a=new Map,o.forEach((e,t)=>{a.set(t,e)}))}function u(){if(l)throw new Error(_r(3));return i}function d(e){if("function"!==typeof e)throw new Error(_r(4));if(l)throw new Error(_r(5));let t=!0;c();const r=s++;return a.set(r,e),function(){if(t){if(l)throw new Error(_r(6));t=!1,c(),a.delete(r),o=null}}}function h(e){if(!br(e))throw new Error(_r(7));if("undefined"===typeof e.type)throw new Error(_r(8));if("string"!==typeof e.type)throw new Error(_r(17));if(l)throw new Error(_r(9));try{l=!0,i=n(i,e)}finally{l=!1}return(o=a).forEach(e=>{e()}),e}h({type:wr.INIT});return{dispatch:h,subscribe:d,getState:u,replaceReducer:function(e){if("function"!==typeof e)throw new Error(_r(10));n=e,h({type:wr.REPLACE})},[vr]:function(){const e=d;return{subscribe(t){if("object"!==typeof t||null===t)throw new Error(_r(11));function r(){const e=t;e.next&&e.next(u())}r();return{unsubscribe:e(r)}},[vr](){return this}}}}}function Cr(e){const t=Object.keys(e),r={};for(let o=0;o<t.length;o++){const n=t[o];0,"function"===typeof e[n]&&(r[n]=e[n])}const n=Object.keys(r);let i;try{!function(e){Object.keys(e).forEach(t=>{const r=e[t];if("undefined"===typeof r(void 0,{type:wr.INIT}))throw new Error(_r(12));if("undefined"===typeof r(void 0,{type:wr.PROBE_UNKNOWN_ACTION()}))throw new Error(_r(13))})}(r)}catch(JO){i=JO}return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;if(i)throw i;let o=!1;const a={};for(let i=0;i<n.length;i++){const s=n[i],l=r[s],c=e[s],u=l(c,t);if("undefined"===typeof u){t&&t.type;throw new Error(_r(14))}a[s]=u,o=o||u!==c}return o=o||n.length!==Object.keys(e).length,o?a:e}}function Er(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return 0===t.length?e=>e:1===t.length?t[0]:t.reduce((e,t)=>function(){return e(t(...arguments))})}function Sr(e){return br(e)&&"type"in e&&"string"===typeof e.type}function Tr(e){return t=>{let{dispatch:r,getState:n}=t;return t=>i=>"function"===typeof i?i(r,n,e):t(i)}}var Ir=Tr(),Fr=Tr;const kr=["reducerPath"];var Pr="undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__?window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__:function(){if(0!==arguments.length)return"object"===typeof arguments[0]?Er:Er.apply(null,arguments)},Mr=("undefined"!==typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__,e=>e&&"function"===typeof e.match);function Or(e,t){function r(){if(t){let r=t(...arguments);if(!r)throw new Error(Rn(0));return ot(ot({type:e,payload:r.payload},"meta"in r&&{meta:r.meta}),"error"in r&&{error:r.error})}return{type:e,payload:arguments.length<=0?void 0:arguments[0]}}return r.toString=()=>"".concat(e),r.type=e,r.match=t=>Sr(t)&&t.type===e,r}var Lr=class e extends Array{constructor(){super(...arguments),Object.setPrototypeOf(this,e.prototype)}static get[Symbol.species](){return e}concat(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return super.concat.apply(this,t)}prepend(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return 1===r.length&&Array.isArray(r[0])?new e(...r[0].concat(this)):new e(...r.concat(this))}};function Dr(e){return _t(e)?yr(e,()=>{}):e}function Ur(e,t,r){return e.has(t)?e.get(t):e.set(t,r(t)).get(t)}var Rr="RTK_autoBatch",zr=()=>e=>({payload:e,meta:{[Rr]:!0}}),Nr=e=>t=>{setTimeout(t,e)},jr=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{type:"raf"};return t=>function(){const r=t(...arguments);let n=!0,i=!1,o=!1;const a=new Set,s="tick"===e.type?queueMicrotask:"raf"===e.type?"undefined"!==typeof window&&window.requestAnimationFrame?window.requestAnimationFrame:Nr(10):"callback"===e.type?e.queueNotification:Nr(e.timeout),l=()=>{o=!1,i&&(i=!1,a.forEach(e=>e()))};return Object.assign({},r,{subscribe(e){const t=r.subscribe(()=>n&&e());return a.add(e),()=>{t(),a.delete(e)}},dispatch(e){try{var t;return n=!(null!==e&&void 0!==e&&null!==(t=e.meta)&&void 0!==t&&t[Rr]),i=!n,i&&(o||(o=!0,s(l))),r.dispatch(e)}finally{n=!0}}})}};function Qr(e){const t=function(e){const{thunk:t=!0,immutableCheck:r=!0,serializableCheck:n=!0,actionCreatorCheck:i=!0}=null!==e&&void 0!==e?e:{};let o=new Lr;return t&&("boolean"===typeof t?o.push(Ir):o.push(Fr(t.extraArgument))),o},{reducer:r,middleware:n,devTools:i=!0,duplicateMiddlewareCheck:o=!0,preloadedState:a,enhancers:s}=e||{};let l,c;if("function"===typeof r)l=r;else{if(!br(r))throw new Error(Rn(1));l=Cr(r)}c="function"===typeof n?n(t):t();let u=Er;i&&(u=Pr(ot({trace:!1},"object"===typeof i&&i)));const d=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return e=>(r,n)=>{const i=e(r,n);let o=()=>{throw new Error(_r(15))};const a={getState:i.getState,dispatch:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return o(e,...r)}},s=t.map(e=>e(a));return o=Er(...s)(i.dispatch),ot(ot({},i),{},{dispatch:o})}}(...c),h=(e=>function(t){const{autoBatch:r=!0}=null!==t&&void 0!==t?t:{};let n=new Lr(e);return r&&n.push(jr("object"===typeof r?r:void 0)),n})(d);return Br(l,a,u(..."function"===typeof s?s(h):h()))}function Vr(e){const t={},r=[];let n;const i={addCase(e,r){const n="string"===typeof e?e:e.type;if(!n)throw new Error(Rn(28));if(n in t)throw new Error(Rn(29));return t[n]=r,i},addAsyncThunk:(e,n)=>(n.pending&&(t[e.pending.type]=n.pending),n.rejected&&(t[e.rejected.type]=n.rejected),n.fulfilled&&(t[e.fulfilled.type]=n.fulfilled),n.settled&&r.push({matcher:e.settled,reducer:n.settled}),i),addMatcher:(e,t)=>(r.push({matcher:e,reducer:t}),i),addDefaultCase:e=>(n=e,i)};return e(i),[t,r,n]}var Hr=(e,t)=>Mr(e)?e.match(t):e(t);function Gr(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return e=>t.some(t=>Hr(t,e))}var Kr=function(){let e="",t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:21;for(;t--;)e+="ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW"[64*Math.random()|0];return e},Wr=["name","message","stack","code"],qr=class{constructor(e,t){nt(this,"_type",void 0),this.payload=e,this.meta=t}},Zr=class{constructor(e,t){nt(this,"_type",void 0),this.payload=e,this.meta=t}},Xr=e=>{if("object"===typeof e&&null!==e){const t={};for(const r of Wr)"string"===typeof e[r]&&(t[r]=e[r]);return t}return{message:String(e)}},Yr="External signal was aborted",Jr=(()=>{function e(e,t,r){const n=Or(e+"/fulfilled",(e,t,r,n)=>({payload:e,meta:ot(ot({},n||{}),{},{arg:r,requestId:t,requestStatus:"fulfilled"})})),i=Or(e+"/pending",(e,t,r)=>({payload:void 0,meta:ot(ot({},r||{}),{},{arg:t,requestId:e,requestStatus:"pending"})})),o=Or(e+"/rejected",(e,t,n,i,o)=>({payload:i,error:(r&&r.serializeError||Xr)(e||"Rejected"),meta:ot(ot({},o||{}),{},{arg:n,requestId:t,rejectedWithValue:!!i,requestStatus:"rejected",aborted:"AbortError"===(null===e||void 0===e?void 0:e.name),condition:"ConditionError"===(null===e||void 0===e?void 0:e.name)})}));return Object.assign(function(e){let{signal:a}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(s,l,c)=>{const u=null!==r&&void 0!==r&&r.idGenerator?r.idGenerator(e):Kr(),d=new AbortController;let h,A;function f(e){A=e,d.abort()}a&&(a.aborted?f(Yr):a.addEventListener("abort",()=>f(Yr),{once:!0}));const p=async function(){let a;try{var p,m;let o=null===r||void 0===r||null===(p=r.condition)||void 0===p?void 0:p.call(r,e,{getState:l,extra:c});if(function(e){return null!==e&&"object"===typeof e&&"function"===typeof e.then}(o)&&(o=await o),!1===o||d.signal.aborted)throw{name:"ConditionError",message:"Aborted due to condition callback returning false."};const g=new Promise((e,t)=>{h=()=>{t({name:"AbortError",message:A||"Aborted"})},d.signal.addEventListener("abort",h,{once:!0})});s(i(u,e,null===r||void 0===r||null===(m=r.getPendingMeta)||void 0===m?void 0:m.call(r,{requestId:u,arg:e},{getState:l,extra:c}))),a=await Promise.race([g,Promise.resolve(t(e,{dispatch:s,getState:l,extra:c,requestId:u,signal:d.signal,abort:f,rejectWithValue:(e,t)=>new qr(e,t),fulfillWithValue:(e,t)=>new Zr(e,t)})).then(t=>{if(t instanceof qr)throw t;return t instanceof Zr?n(t.payload,u,e,t.meta):n(t,u,e)})])}catch(g){a=g instanceof qr?o(null,u,e,g.payload,g.meta):o(g,u,e)}finally{h&&d.signal.removeEventListener("abort",h)}return r&&!r.dispatchConditionRejection&&o.match(a)&&a.meta.condition||s(a),a}();return Object.assign(p,{abort:f,requestId:u,arg:e,unwrap:()=>p.then($r)})}},{pending:i,rejected:o,fulfilled:n,settled:Gr(o,n),typePrefix:e})}return e.withTypes=()=>e,e})();function $r(e){if(e.meta&&e.meta.rejectedWithValue)throw e.payload;if(e.error)throw e.error;return e.payload}var en=Symbol.for("rtk-slice-createasyncthunk");function tn(e,t){return"".concat(e,"/").concat(t)}function rn(){var e;let{creators:t}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const r=null===t||void 0===t||null===(e=t.asyncThunk)||void 0===e?void 0:e[en];return function(e){const{name:t,reducerPath:n=t}=e;if(!t)throw new Error(Rn(11));const i=("function"===typeof e.reducers?e.reducers(function(){function e(e,t){return ot({_reducerDefinitionType:"asyncThunk",payloadCreator:e},t)}return e.withTypes=()=>e,{reducer:e=>Object.assign({[e.name](){return e(...arguments)}}[e.name],{_reducerDefinitionType:"reducer"}),preparedReducer:(e,t)=>({_reducerDefinitionType:"reducerWithPrepare",prepare:e,reducer:t}),asyncThunk:e}}()):e.reducers)||{},o=Object.keys(i),a={sliceCaseReducersByName:{},sliceCaseReducersByType:{},actionCreators:{},sliceMatchers:[]},s={addCase(e,t){const r="string"===typeof e?e:e.type;if(!r)throw new Error(Rn(12));if(r in a.sliceCaseReducersByType)throw new Error(Rn(13));return a.sliceCaseReducersByType[r]=t,s},addMatcher:(e,t)=>(a.sliceMatchers.push({matcher:e,reducer:t}),s),exposeAction:(e,t)=>(a.actionCreators[e]=t,s),exposeCaseReducer:(e,t)=>(a.sliceCaseReducersByName[e]=t,s)};function l(){const[t={},r=[],n]="function"===typeof e.extraReducers?Vr(e.extraReducers):[e.extraReducers],i=ot(ot({},t),a.sliceCaseReducersByType);return function(e,t){let r,[n,i,o]=Vr(t);if("function"===typeof e)r=()=>Dr(e());else{const t=Dr(e);r=()=>t}function a(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r(),t=arguments.length>1?arguments[1]:void 0,a=[n[t.type],...i.filter(e=>{let{matcher:r}=e;return r(t)}).map(e=>{let{reducer:t}=e;return t})];return 0===a.filter(e=>!!e).length&&(a=[o]),a.reduce((e,r)=>{if(r){if(yt(e)){const n=r(e,t);return void 0===n?e:n}if(_t(e))return yr(e,e=>r(e,t));{const n=r(e,t);if(void 0===n){if(null===e)return e;throw Error("A case reducer on a non-draftable value must not return undefined")}return n}}return e},e)}return a.getInitialState=r,a}(e.initialState,e=>{for(let t in i)e.addCase(t,i[t]);for(let t of a.sliceMatchers)e.addMatcher(t.matcher,t.reducer);for(let t of r)e.addMatcher(t.matcher,t.reducer);n&&e.addDefaultCase(n)})}o.forEach(n=>{const o=i[n],a={reducerName:n,type:tn(t,n),createNotation:"function"===typeof e.reducers};!function(e){return"asyncThunk"===e._reducerDefinitionType}(o)?function(e,t,r){let n,i,{type:o,reducerName:a,createNotation:s}=e;if("reducer"in t){if(s&&!function(e){return"reducerWithPrepare"===e._reducerDefinitionType}(t))throw new Error(Rn(17));n=t.reducer,i=t.prepare}else n=t;r.addCase(o,n).exposeCaseReducer(a,n).exposeAction(a,i?Or(o,i):Or(o))}(a,o,s):function(e,t,r,n){let{type:i,reducerName:o}=e;if(!n)throw new Error(Rn(18));const{payloadCreator:a,fulfilled:s,pending:l,rejected:c,settled:u,options:d}=t,h=n(i,a,d);r.exposeAction(o,h),s&&r.addCase(h.fulfilled,s);l&&r.addCase(h.pending,l);c&&r.addCase(h.rejected,c);u&&r.addMatcher(h.settled,u);r.exposeCaseReducer(o,{fulfilled:s||an,pending:l||an,rejected:c||an,settled:u||an})}(a,o,s,r)});const c=e=>e,u=new Map,d=new WeakMap;let h;function A(e,t){return h||(h=l()),h(e,t)}function f(){return h||(h=l()),h.getInitialState()}function p(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];function n(e){let i=e[t];return"undefined"===typeof i&&r&&(i=Ur(d,n,f)),i}function i(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;const n=Ur(u,r,()=>new WeakMap);return Ur(n,t,()=>{const n={};for(const[o,a]of Object.entries(null!==(i=e.selectors)&&void 0!==i?i:{})){var i;n[o]=nn(a,t,()=>Ur(d,t,f),r)}return n})}return{reducerPath:t,getSelectors:i,get selectors(){return i(n)},selectSlice:n}}const m=ot(ot({name:t,reducer:A,actions:a.actionCreators,caseReducers:a.sliceCaseReducersByName,getInitialState:f},p(n)),{},{injectInto(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{reducerPath:r}=t,i=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(t,kr);const o=null!==r&&void 0!==r?r:n;return e.inject({reducerPath:o,reducer:A},i),ot(ot({},m),p(o,!0))}});return m}}function nn(e,t,r,n){function i(i){let o=t(i);"undefined"===typeof o&&n&&(o=r());for(var a=arguments.length,s=new Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];return e(o,...s)}return i.unwrapped=e,i}var on=rn();function an(){}var sn="listener",ln="completed",cn="cancelled",un="task-".concat(cn),dn="task-".concat(ln),hn="".concat(sn,"-").concat(cn),An="".concat(sn,"-").concat(ln),fn=class{constructor(e){nt(this,"name","TaskAbortError"),nt(this,"message",void 0),this.code=e,this.message="".concat("task"," ").concat(cn," (reason: ").concat(e,")")}},pn=(e,t)=>{if("function"!==typeof e)throw new TypeError(Rn(32))},mn=()=>{},gn=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:mn;return e.catch(t),e},yn=(e,t)=>(e.addEventListener("abort",t,{once:!0}),()=>e.removeEventListener("abort",t)),_n=e=>{if(e.aborted)throw new fn(e.reason)};function vn(e,t){let r=mn;return new Promise((n,i)=>{const o=()=>i(new fn(e.reason));e.aborted?o():(r=yn(e,o),t.finally(()=>r()).then(n,i))}).finally(()=>{r=mn})}var xn=e=>t=>gn(vn(e,t).then(t=>(_n(e),t))),wn=e=>{const t=xn(e);return e=>t(new Promise(t=>setTimeout(t,e)))},{assign:bn}=Object,Bn={},Cn="listenerMiddleware",En=(e,t)=>(r,n)=>{pn(r);const i=new AbortController;var o;o=i,yn(e,()=>o.abort(e.reason));const a=(async(e,t)=>{try{return await Promise.resolve(),{status:"ok",value:await e()}}catch(r){return{status:r instanceof fn?"cancelled":"rejected",error:r}}finally{null===t||void 0===t||t()}})(async()=>{_n(e),_n(i.signal);const t=await r({pause:xn(i.signal),delay:wn(i.signal),signal:i.signal});return _n(i.signal),t},()=>i.abort(dn));return null!==n&&void 0!==n&&n.autoJoin&&t.push(a.catch(mn)),{result:xn(e)(a),cancel(){i.abort(un)}}},Sn=(e,t)=>(r,n)=>gn((async(r,n)=>{_n(t);let i=()=>{};const o=[new Promise((t,n)=>{let o=e({predicate:r,effect:(e,r)=>{r.unsubscribe(),t([e,r.getState(),r.getOriginalState()])}});i=()=>{o(),n()}})];null!=n&&o.push(new Promise(e=>setTimeout(e,n,null)));try{const e=await vn(t,Promise.race(o));return _n(t),e}finally{i()}})(r,n)),Tn=e=>{let{type:t,actionCreator:r,matcher:n,predicate:i,effect:o}=e;if(t)i=Or(t).match;else if(r)t=r.type,i=r.match;else if(n)i=n;else if(!i)throw new Error(Rn(21));return pn(o),{predicate:i,type:t,effect:o}},In=bn(e=>{const{type:t,predicate:r,effect:n}=Tn(e);return{id:Kr(),effect:n,type:t,predicate:r,pending:new Set,unsubscribe:()=>{throw new Error(Rn(22))}}},{withTypes:()=>In}),Fn=(e,t)=>{const{type:r,effect:n,predicate:i}=Tn(t);return Array.from(e.values()).find(e=>("string"===typeof r?e.type===r:e.predicate===i)&&e.effect===n)},kn=e=>{e.pending.forEach(e=>{e.abort(hn)})},Pn=(e,t,r)=>{try{e(t,r)}catch(n){setTimeout(()=>{throw n},0)}},Mn=bn(Or("".concat(Cn,"/add")),{withTypes:()=>Mn}),On=Or("".concat(Cn,"/removeAll")),Ln=bn(Or("".concat(Cn,"/remove")),{withTypes:()=>Ln}),Dn=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];console.error("".concat(Cn,"/error"),...t)},Un=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new Map,r=new Map,{extra:n,onError:i=Dn}=e;pn(i);const o=e=>{var r;return(e=>(e.unsubscribe=()=>t.delete(e.id),t.set(e.id,e),t=>{e.unsubscribe(),null!==t&&void 0!==t&&t.cancelActive&&kn(e)}))(null!==(r=Fn(t,e))&&void 0!==r?r:In(e))};bn(o,{withTypes:()=>o});const a=e=>{const r=Fn(t,e);return r&&(r.unsubscribe(),e.cancelActive&&kn(r)),!!r};bn(a,{withTypes:()=>a});const s=async(e,a,s,l)=>{const c=new AbortController,u=Sn(o,c.signal),d=[];try{e.pending.add(c),(e=>{var t;const n=null!==(t=r.get(e))&&void 0!==t?t:0;r.set(e,n+1)})(e),await Promise.resolve(e.effect(a,bn({},s,{getOriginalState:l,condition:(e,t)=>u(e,t).then(Boolean),take:u,delay:wn(c.signal),pause:xn(c.signal),extra:n,signal:c.signal,fork:En(c.signal,d),unsubscribe:e.unsubscribe,subscribe:()=>{t.set(e.id,e)},cancelActiveListeners:()=>{e.pending.forEach((e,t,r)=>{e!==c&&(e.abort(hn),r.delete(e))})},cancel:()=>{c.abort(hn),e.pending.delete(c)},throwIfCancelled:()=>{_n(c.signal)}})))}catch(h){h instanceof fn||Pn(i,h,{raisedBy:"effect"})}finally{await Promise.all(d),c.abort(An),(e=>{var t;const n=null!==(t=r.get(e))&&void 0!==t?t:1;1===n?r.delete(e):r.set(e,n-1)})(e),e.pending.delete(c)}},l=((e,t)=>()=>{for(const e of t.keys())kn(e);e.clear()})(t,r);return{middleware:e=>r=>n=>{if(!Sr(n))return r(n);if(Mn.match(n))return o(n.payload);if(On.match(n))return void l();if(Ln.match(n))return a(n.payload);let c=e.getState();const u=()=>{if(c===Bn)throw new Error(Rn(23));return c};let d;try{if(d=r(n),t.size>0){const r=e.getState(),o=Array.from(t.values());for(const t of o){let o=!1;try{o=t.predicate(n,r,c)}catch(h){o=!1,Pn(i,h,{raisedBy:"predicate"})}o&&s(t,n,e,u)}}}finally{c=Bn}return d},startListening:o,stopListening:a,clearListeners:l}};Symbol.for("rtk-state-proxy-original");function Rn(e){return"Minified Redux Toolkit error #".concat(e,"; visit https://redux-toolkit.js.org/Errors?code=").concat(e," for the full message or use the non-minified dev environment for full errors. ")}const zn={viewState:{longitude:-114,latitude:39,zoom:5,pitch:0,bearing:0},layers:{projects:!0,grid:!0,transmission:!0,substations:!0,terrain:!1,satellite:!1,optimalLocations:!0,transmissionUpgrades:!0,hifldTransmission:!0,generators:!0},mapInstance:null,isMapLoaded:!1,hoveredFeature:null,selectedFeature:null,minVoltage:230,visibleFuelTypes:["nuclear","coal","natural_gas","wind","solar","hydro","petroleum","biomass","geothermal","other"],gridDataStats:{transmissionLines:0,generators:0,totalCapacityMW:0,loading:!1}},Nn=on({name:"map",initialState:zn,reducers:{setViewState:(e,t)=>{e.viewState=ot(ot({},e.viewState),t.payload)},toggleLayer:(e,t)=>{e.layers[t.payload]=!e.layers[t.payload]},setLayerVisibility:(e,t)=>{e.layers[t.payload.layer]=t.payload.visible},setMapInstance:(e,t)=>{e.mapInstance=t.payload,e.isMapLoaded=null!==t.payload},setHoveredFeature:(e,t)=>{e.hoveredFeature=t.payload},setSelectedFeature:(e,t)=>{e.selectedFeature=t.payload},flyTo:(e,t)=>{e.viewState.longitude=t.payload.longitude,e.viewState.latitude=t.payload.latitude,void 0!==t.payload.zoom&&(e.viewState.zoom=t.payload.zoom)},resetView:e=>{e.viewState=zn.viewState},setMinVoltage:(e,t)=>{e.minVoltage=t.payload},toggleFuelType:(e,t)=>{const r=t.payload,n=e.visibleFuelTypes.indexOf(r);-1===n?e.visibleFuelTypes.push(r):e.visibleFuelTypes.splice(n,1)},setVisibleFuelTypes:(e,t)=>{e.visibleFuelTypes=t.payload},updateGridDataStats:(e,t)=>{e.gridDataStats=ot(ot({},e.gridDataStats),t.payload)}}}),{setViewState:jn,toggleLayer:Qn,setLayerVisibility:Vn,setMapInstance:Hn,setHoveredFeature:Gn,setSelectedFeature:Kn,flyTo:Wn,resetView:qn,setMinVoltage:Zn,toggleFuelType:Xn,setVisibleFuelTypes:Yn,updateGridDataStats:Jn}=Nn.actions,$n=Nn.reducer;let ei=function(e){return e.SOLAR="solar",e.WIND="wind",e.STORAGE="storage",e.DATACENTER="datacenter",e}({});function ti(e,t){return function(){return e.apply(t,arguments)}}const{toString:ri}=Object.prototype,{getPrototypeOf:ni}=Object,{iterator:ii,toStringTag:oi}=Symbol,ai=(si=Object.create(null),e=>{const t=ri.call(e);return si[t]||(si[t]=t.slice(8,-1).toLowerCase())});var si;const li=e=>(e=e.toLowerCase(),t=>ai(t)===e),ci=e=>t=>typeof t===e,{isArray:ui}=Array,di=ci("undefined");function hi(e){return null!==e&&!di(e)&&null!==e.constructor&&!di(e.constructor)&&pi(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Ai=li("ArrayBuffer");const fi=ci("string"),pi=ci("function"),mi=ci("number"),gi=e=>null!==e&&"object"===typeof e,yi=e=>{if("object"!==ai(e))return!1;const t=ni(e);return(null===t||t===Object.prototype||null===Object.getPrototypeOf(t))&&!(oi in e)&&!(ii in e)},_i=li("Date"),vi=li("File"),xi=li("Blob"),wi=li("FileList"),bi=li("URLSearchParams"),[Bi,Ci,Ei,Si]=["ReadableStream","Request","Response","Headers"].map(li);function Ti(e,t){let r,n,{allOwnKeys:i=!1}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(null!==e&&"undefined"!==typeof e)if("object"!==typeof e&&(e=[e]),ui(e))for(r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else{if(hi(e))return;const n=i?Object.getOwnPropertyNames(e):Object.keys(e),o=n.length;let a;for(r=0;r<o;r++)a=n[r],t.call(null,e[a],a,e)}}function Ii(e,t){if(hi(e))return null;t=t.toLowerCase();const r=Object.keys(e);let n,i=r.length;for(;i-- >0;)if(n=r[i],t===n.toLowerCase())return n;return null}const Fi="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:r.g,ki=e=>!di(e)&&e!==Fi;const Pi=(Mi="undefined"!==typeof Uint8Array&&ni(Uint8Array),e=>Mi&&e instanceof Mi);var Mi;const Oi=li("HTMLFormElement"),Li=(e=>{let{hasOwnProperty:t}=e;return(e,r)=>t.call(e,r)})(Object.prototype),Di=li("RegExp"),Ui=(e,t)=>{const r=Object.getOwnPropertyDescriptors(e),n={};Ti(r,(r,i)=>{let o;!1!==(o=t(r,i,e))&&(n[i]=o||r)}),Object.defineProperties(e,n)};const Ri=li("AsyncFunction"),zi=((e,t)=>{return e?setImmediate:t?(r="axios@".concat(Math.random()),n=[],Fi.addEventListener("message",e=>{let{source:t,data:i}=e;t===Fi&&i===r&&n.length&&n.shift()()},!1),e=>{n.push(e),Fi.postMessage(r,"*")}):e=>setTimeout(e);var r,n})("function"===typeof setImmediate,pi(Fi.postMessage)),Ni="undefined"!==typeof queueMicrotask?queueMicrotask.bind(Fi):"undefined"!==typeof process&&process.nextTick||zi,ji={isArray:ui,isArrayBuffer:Ai,isBuffer:hi,isFormData:e=>{let t;return e&&("function"===typeof FormData&&e instanceof FormData||pi(e.append)&&("formdata"===(t=ai(e))||"object"===t&&pi(e.toString)&&"[object FormData]"===e.toString()))},isArrayBufferView:function(e){let t;return t="undefined"!==typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Ai(e.buffer),t},isString:fi,isNumber:mi,isBoolean:e=>!0===e||!1===e,isObject:gi,isPlainObject:yi,isEmptyObject:e=>{if(!gi(e)||hi(e))return!1;try{return 0===Object.keys(e).length&&Object.getPrototypeOf(e)===Object.prototype}catch(JO){return!1}},isReadableStream:Bi,isRequest:Ci,isResponse:Ei,isHeaders:Si,isUndefined:di,isDate:_i,isFile:vi,isBlob:xi,isRegExp:Di,isFunction:pi,isStream:e=>gi(e)&&pi(e.pipe),isURLSearchParams:bi,isTypedArray:Pi,isFileList:wi,forEach:Ti,merge:function e(){const{caseless:t,skipUndefined:r}=ki(this)&&this||{},n={},i=(i,o)=>{const a=t&&Ii(n,o)||o;yi(n[a])&&yi(i)?n[a]=e(n[a],i):yi(i)?n[a]=e({},i):ui(i)?n[a]=i.slice():r&&di(i)||(n[a]=i)};for(let o=0,a=arguments.length;o<a;o++)arguments[o]&&Ti(arguments[o],i);return n},extend:function(e,t,r){let{allOwnKeys:n}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Ti(t,(t,n)=>{r&&pi(t)?e[n]=ti(t,r):e[n]=t},{allOwnKeys:n}),e},trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,r,n)=>{e.prototype=Object.create(t.prototype,n),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),r&&Object.assign(e.prototype,r)},toFlatObject:(e,t,r,n)=>{let i,o,a;const s={};if(t=t||{},null==e)return t;do{for(i=Object.getOwnPropertyNames(e),o=i.length;o-- >0;)a=i[o],n&&!n(a,e,t)||s[a]||(t[a]=e[a],s[a]=!0);e=!1!==r&&ni(e)}while(e&&(!r||r(e,t))&&e!==Object.prototype);return t},kindOf:ai,kindOfTest:li,endsWith:(e,t,r)=>{e=String(e),(void 0===r||r>e.length)&&(r=e.length),r-=t.length;const n=e.indexOf(t,r);return-1!==n&&n===r},toArray:e=>{if(!e)return null;if(ui(e))return e;let t=e.length;if(!mi(t))return null;const r=new Array(t);for(;t-- >0;)r[t]=e[t];return r},forEachEntry:(e,t)=>{const r=(e&&e[ii]).call(e);let n;for(;(n=r.next())&&!n.done;){const r=n.value;t.call(e,r[0],r[1])}},matchAll:(e,t)=>{let r;const n=[];for(;null!==(r=e.exec(t));)n.push(r);return n},isHTMLForm:Oi,hasOwnProperty:Li,hasOwnProp:Li,reduceDescriptors:Ui,freezeMethods:e=>{Ui(e,(t,r)=>{if(pi(e)&&-1!==["arguments","caller","callee"].indexOf(r))return!1;const n=e[r];pi(n)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+r+"'")}))})},toObjectSet:(e,t)=>{const r={},n=e=>{e.forEach(e=>{r[e]=!0})};return ui(e)?n(e):n(String(e).split(t)),r},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(e,t,r){return t.toUpperCase()+r}),noop:()=>{},toFiniteNumber:(e,t)=>null!=e&&Number.isFinite(e=+e)?e:t,findKey:Ii,global:Fi,isContextDefined:ki,isSpecCompliantForm:function(e){return!!(e&&pi(e.append)&&"FormData"===e[oi]&&e[ii])},toJSONObject:e=>{const t=new Array(10),r=(e,n)=>{if(gi(e)){if(t.indexOf(e)>=0)return;if(hi(e))return e;if(!("toJSON"in e)){t[n]=e;const i=ui(e)?[]:{};return Ti(e,(e,t)=>{const o=r(e,n+1);!di(o)&&(i[t]=o)}),t[n]=void 0,i}}return e};return r(e,0)},isAsyncFn:Ri,isThenable:e=>e&&(gi(e)||pi(e))&&pi(e.then)&&pi(e.catch),setImmediate:zi,asap:Ni,isIterable:e=>null!=e&&pi(e[ii])};function Qi(e,t,r,n,i){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),r&&(this.config=r),n&&(this.request=n),i&&(this.response=i,this.status=i.status?i.status:null)}ji.inherits(Qi,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:ji.toJSONObject(this.config),code:this.code,status:this.status}}});const Vi=Qi.prototype,Hi={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{Hi[e]={value:e}}),Object.defineProperties(Qi,Hi),Object.defineProperty(Vi,"isAxiosError",{value:!0}),Qi.from=(e,t,r,n,i,o)=>{const a=Object.create(Vi);ji.toFlatObject(e,a,function(e){return e!==Error.prototype},e=>"isAxiosError"!==e);const s=e&&e.message?e.message:"Error",l=null==t&&e?e.code:t;return Qi.call(a,s,l,r,n,i),e&&null==a.cause&&Object.defineProperty(a,"cause",{value:e,configurable:!0}),a.name=e&&e.name||"Error",o&&Object.assign(a,o),a};const Gi=Qi;function Ki(e){return ji.isPlainObject(e)||ji.isArray(e)}function Wi(e){return ji.endsWith(e,"[]")?e.slice(0,-2):e}function qi(e,t,r){return e?e.concat(t).map(function(e,t){return e=Wi(e),!r&&t?"["+e+"]":e}).join(r?".":""):t}const Zi=ji.toFlatObject(ji,{},null,function(e){return/^is[A-Z]/.test(e)});const Xi=function(e,t,r){if(!ji.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const n=(r=ji.toFlatObject(r,{metaTokens:!0,dots:!1,indexes:!1},!1,function(e,t){return!ji.isUndefined(t[e])})).metaTokens,i=r.visitor||c,o=r.dots,a=r.indexes,s=(r.Blob||"undefined"!==typeof Blob&&Blob)&&ji.isSpecCompliantForm(t);if(!ji.isFunction(i))throw new TypeError("visitor must be a function");function l(e){if(null===e)return"";if(ji.isDate(e))return e.toISOString();if(ji.isBoolean(e))return e.toString();if(!s&&ji.isBlob(e))throw new Gi("Blob is not supported. Use a Buffer instead.");return ji.isArrayBuffer(e)||ji.isTypedArray(e)?s&&"function"===typeof Blob?new Blob([e]):Buffer.from(e):e}function c(e,r,i){let s=e;if(e&&!i&&"object"===typeof e)if(ji.endsWith(r,"{}"))r=n?r:r.slice(0,-2),e=JSON.stringify(e);else if(ji.isArray(e)&&function(e){return ji.isArray(e)&&!e.some(Ki)}(e)||(ji.isFileList(e)||ji.endsWith(r,"[]"))&&(s=ji.toArray(e)))return r=Wi(r),s.forEach(function(e,n){!ji.isUndefined(e)&&null!==e&&t.append(!0===a?qi([r],n,o):null===a?r:r+"[]",l(e))}),!1;return!!Ki(e)||(t.append(qi(i,r,o),l(e)),!1)}const u=[],d=Object.assign(Zi,{defaultVisitor:c,convertValue:l,isVisitable:Ki});if(!ji.isObject(e))throw new TypeError("data must be an object");return function e(r,n){if(!ji.isUndefined(r)){if(-1!==u.indexOf(r))throw Error("Circular reference detected in "+n.join("."));u.push(r),ji.forEach(r,function(r,o){!0===(!(ji.isUndefined(r)||null===r)&&i.call(t,r,ji.isString(o)?o.trim():o,n,d))&&e(r,n?n.concat(o):[o])}),u.pop()}}(e),t};function Yi(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(e){return t[e]})}function Ji(e,t){this._pairs=[],e&&Xi(e,this,t)}const $i=Ji.prototype;$i.append=function(e,t){this._pairs.push([e,t])},$i.toString=function(e){const t=e?function(t){return e.call(this,t,Yi)}:Yi;return this._pairs.map(function(e){return t(e[0])+"="+t(e[1])},"").join("&")};const eo=Ji;function to(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ro(e,t,r){if(!t)return e;const n=r&&r.encode||to;ji.isFunction(r)&&(r={serialize:r});const i=r&&r.serialize;let o;if(o=i?i(t,r):ji.isURLSearchParams(t)?t.toString():new eo(t,r).toString(n),o){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+o}return e}const no=class{constructor(){this.handlers=[]}use(e,t,r){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!r&&r.synchronous,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){ji.forEach(this.handlers,function(t){null!==t&&e(t)})}},io={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},oo={isBrowser:!0,classes:{URLSearchParams:"undefined"!==typeof URLSearchParams?URLSearchParams:eo,FormData:"undefined"!==typeof FormData?FormData:null,Blob:"undefined"!==typeof Blob?Blob:null},protocols:["http","https","file","blob","url","data"]},ao="undefined"!==typeof window&&"undefined"!==typeof document,so="object"===typeof navigator&&navigator||void 0,lo=ao&&(!so||["ReactNative","NativeScript","NS"].indexOf(so.product)<0),co="undefined"!==typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"===typeof self.importScripts,uo=ao&&window.location.href||"http://localhost",ho=ot(ot({},e),oo);const Ao=function(e){function t(e,r,n,i){let o=e[i++];if("__proto__"===o)return!0;const a=Number.isFinite(+o),s=i>=e.length;if(o=!o&&ji.isArray(n)?n.length:o,s)return ji.hasOwnProp(n,o)?n[o]=[n[o],r]:n[o]=r,!a;n[o]&&ji.isObject(n[o])||(n[o]=[]);return t(e,r,n[o],i)&&ji.isArray(n[o])&&(n[o]=function(e){const t={},r=Object.keys(e);let n;const i=r.length;let o;for(n=0;n<i;n++)o=r[n],t[o]=e[o];return t}(n[o])),!a}if(ji.isFormData(e)&&ji.isFunction(e.entries)){const r={};return ji.forEachEntry(e,(e,n)=>{t(function(e){return ji.matchAll(/\w+|\[(\w*)]/g,e).map(e=>"[]"===e[0]?"":e[1]||e[0])}(e),n,r,0)}),r}return null};const fo={transitional:io,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const r=t.getContentType()||"",n=r.indexOf("application/json")>-1,i=ji.isObject(e);i&&ji.isHTMLForm(e)&&(e=new FormData(e));if(ji.isFormData(e))return n?JSON.stringify(Ao(e)):e;if(ji.isArrayBuffer(e)||ji.isBuffer(e)||ji.isStream(e)||ji.isFile(e)||ji.isBlob(e)||ji.isReadableStream(e))return e;if(ji.isArrayBufferView(e))return e.buffer;if(ji.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let o;if(i){if(r.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return Xi(e,new ho.classes.URLSearchParams,ot({visitor:function(e,t,r,n){return ho.isNode&&ji.isBuffer(e)?(this.append(t,e.toString("base64")),!1):n.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((o=ji.isFileList(e))||r.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return Xi(o?{"files[]":e}:e,t&&new t,this.formSerializer)}}return i||n?(t.setContentType("application/json",!1),function(e,t,r){if(ji.isString(e))try{return(t||JSON.parse)(e),ji.trim(e)}catch(JO){if("SyntaxError"!==JO.name)throw JO}return(r||JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||fo.transitional,r=t&&t.forcedJSONParsing,n="json"===this.responseType;if(ji.isResponse(e)||ji.isReadableStream(e))return e;if(e&&ji.isString(e)&&(r&&!this.responseType||n)){const r=!(t&&t.silentJSONParsing)&&n;try{return JSON.parse(e,this.parseReviver)}catch(JO){if(r){if("SyntaxError"===JO.name)throw Gi.from(JO,Gi.ERR_BAD_RESPONSE,this,null,this.response);throw JO}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ho.classes.FormData,Blob:ho.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};ji.forEach(["delete","get","head","post","put","patch"],e=>{fo.headers[e]={}});const po=fo,mo=ji.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),go=Symbol("internals");function yo(e){return e&&String(e).trim().toLowerCase()}function _o(e){return!1===e||null==e?e:ji.isArray(e)?e.map(_o):String(e)}function vo(e,t,r,n,i){return ji.isFunction(n)?n.call(this,t,r):(i&&(t=r),ji.isString(t)?ji.isString(n)?-1!==t.indexOf(n):ji.isRegExp(n)?n.test(t):void 0:void 0)}class xo{constructor(e){e&&this.set(e)}set(e,t,r){const n=this;function i(e,t,r){const i=yo(t);if(!i)throw new Error("header name must be a non-empty string");const o=ji.findKey(n,i);(!o||void 0===n[o]||!0===r||void 0===r&&!1!==n[o])&&(n[o||t]=_o(e))}const o=(e,t)=>ji.forEach(e,(e,r)=>i(e,r,t));if(ji.isPlainObject(e)||e instanceof this.constructor)o(e,t);else if(ji.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim()))o((e=>{const t={};let r,n,i;return e&&e.split("\n").forEach(function(e){i=e.indexOf(":"),r=e.substring(0,i).trim().toLowerCase(),n=e.substring(i+1).trim(),!r||t[r]&&mo[r]||("set-cookie"===r?t[r]?t[r].push(n):t[r]=[n]:t[r]=t[r]?t[r]+", "+n:n)}),t})(e),t);else if(ji.isObject(e)&&ji.isIterable(e)){let r,n,i={};for(const t of e){if(!ji.isArray(t))throw TypeError("Object iterator must return a key-value pair");i[n=t[0]]=(r=i[n])?ji.isArray(r)?[...r,t[1]]:[r,t[1]]:t[1]}o(i,t)}else null!=e&&i(t,e,r);return this}get(e,t){if(e=yo(e)){const r=ji.findKey(this,e);if(r){const e=this[r];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),r=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=r.exec(e);)t[n[1]]=n[2];return t}(e);if(ji.isFunction(t))return t.call(this,e,r);if(ji.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=yo(e)){const r=ji.findKey(this,e);return!(!r||void 0===this[r]||t&&!vo(0,this[r],r,t))}return!1}delete(e,t){const r=this;let n=!1;function i(e){if(e=yo(e)){const i=ji.findKey(r,e);!i||t&&!vo(0,r[i],i,t)||(delete r[i],n=!0)}}return ji.isArray(e)?e.forEach(i):i(e),n}clear(e){const t=Object.keys(this);let r=t.length,n=!1;for(;r--;){const i=t[r];e&&!vo(0,this[i],i,e,!0)||(delete this[i],n=!0)}return n}normalize(e){const t=this,r={};return ji.forEach(this,(n,i)=>{const o=ji.findKey(r,i);if(o)return t[o]=_o(n),void delete t[i];const a=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,r)=>t.toUpperCase()+r)}(i):String(i).trim();a!==i&&delete t[i],t[a]=_o(n),r[a]=!0}),this}concat(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.constructor.concat(this,...t)}toJSON(e){const t=Object.create(null);return ji.forEach(this,(r,n)=>{null!=r&&!1!==r&&(t[n]=e&&ji.isArray(r)?r.join(", "):r)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(e=>{let[t,r]=e;return t+": "+r}).join("\n")}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e){const t=new this(e);for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];return n.forEach(e=>t.set(e)),t}static accessor(e){const t=(this[go]=this[go]={accessors:{}}).accessors,r=this.prototype;function n(e){const n=yo(e);t[n]||(!function(e,t){const r=ji.toCamelCase(" "+t);["get","set","has"].forEach(n=>{Object.defineProperty(e,n+r,{value:function(e,r,i){return this[n].call(this,t,e,r,i)},configurable:!0})})}(r,e),t[n]=!0)}return ji.isArray(e)?e.forEach(n):n(e),this}}xo.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),ji.reduceDescriptors(xo.prototype,(e,t)=>{let{value:r}=e,n=t[0].toUpperCase()+t.slice(1);return{get:()=>r,set(e){this[n]=e}}}),ji.freezeMethods(xo);const wo=xo;function bo(e,t){const r=this||po,n=t||r,i=wo.from(n.headers);let o=n.data;return ji.forEach(e,function(e){o=e.call(r,o,i.normalize(),t?t.status:void 0)}),i.normalize(),o}function Bo(e){return!(!e||!e.__CANCEL__)}function Co(e,t,r){Gi.call(this,null==e?"canceled":e,Gi.ERR_CANCELED,t,r),this.name="CanceledError"}ji.inherits(Co,Gi,{__CANCEL__:!0});const Eo=Co;function So(e,t,r){const n=r.config.validateStatus;r.status&&n&&!n(r.status)?t(new Gi("Request failed with status code "+r.status,[Gi.ERR_BAD_REQUEST,Gi.ERR_BAD_RESPONSE][Math.floor(r.status/100)-4],r.config,r.request,r)):e(r)}const To=function(e,t){e=e||10;const r=new Array(e),n=new Array(e);let i,o=0,a=0;return t=void 0!==t?t:1e3,function(s){const l=Date.now(),c=n[a];i||(i=l),r[o]=s,n[o]=l;let u=a,d=0;for(;u!==o;)d+=r[u++],u%=e;if(o=(o+1)%e,o===a&&(a=(a+1)%e),l-i<t)return;const h=c&&l-c;return h?Math.round(1e3*d/h):void 0}};const Io=function(e,t){let r,n,i=0,o=1e3/t;const a=function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Date.now();i=o,r=null,n&&(clearTimeout(n),n=null),e(...t)};return[function(){const e=Date.now(),t=e-i;for(var s=arguments.length,l=new Array(s),c=0;c<s;c++)l[c]=arguments[c];t>=o?a(l,e):(r=l,n||(n=setTimeout(()=>{n=null,a(r)},o-t)))},()=>r&&a(r)]},Fo=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:3,n=0;const i=To(50,250);return Io(r=>{const o=r.loaded,a=r.lengthComputable?r.total:void 0,s=o-n,l=i(s);n=o;e({loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:l||void 0,estimated:l&&a&&o<=a?(a-o)/l:void 0,event:r,lengthComputable:null!=a,[t?"download":"upload"]:!0})},r)},ko=(e,t)=>{const r=null!=e;return[n=>t[0]({lengthComputable:r,total:e,loaded:n}),t[1]]},Po=e=>function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return ji.asap(()=>e(...r))},Mo=ho.hasStandardBrowserEnv?((e,t)=>r=>(r=new URL(r,ho.origin),e.protocol===r.protocol&&e.host===r.host&&(t||e.port===r.port)))(new URL(ho.origin),ho.navigator&&/(msie|trident)/i.test(ho.navigator.userAgent)):()=>!0,Oo=ho.hasStandardBrowserEnv?{write(e,t,r,n,i,o,a){if("undefined"===typeof document)return;const s=["".concat(e,"=").concat(encodeURIComponent(t))];ji.isNumber(r)&&s.push("expires=".concat(new Date(r).toUTCString())),ji.isString(n)&&s.push("path=".concat(n)),ji.isString(i)&&s.push("domain=".concat(i)),!0===o&&s.push("secure"),ji.isString(a)&&s.push("SameSite=".concat(a)),document.cookie=s.join("; ")},read(e){if("undefined"===typeof document)return null;const t=document.cookie.match(new RegExp("(?:^|; )"+e+"=([^;]*)"));return t?decodeURIComponent(t[1]):null},remove(e){this.write(e,"",Date.now()-864e5,"/")}}:{write(){},read:()=>null,remove(){}};function Lo(e,t,r){let n=!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t);return e&&(n||0==r)?function(e,t){return t?e.replace(/\/?\/$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}const Do=e=>e instanceof wo?ot({},e):e;function Uo(e,t){t=t||{};const r={};function n(e,t,r,n){return ji.isPlainObject(e)&&ji.isPlainObject(t)?ji.merge.call({caseless:n},e,t):ji.isPlainObject(t)?ji.merge({},t):ji.isArray(t)?t.slice():t}function i(e,t,r,i){return ji.isUndefined(t)?ji.isUndefined(e)?void 0:n(void 0,e,0,i):n(e,t,0,i)}function o(e,t){if(!ji.isUndefined(t))return n(void 0,t)}function a(e,t){return ji.isUndefined(t)?ji.isUndefined(e)?void 0:n(void 0,e):n(void 0,t)}function s(r,i,o){return o in t?n(r,i):o in e?n(void 0,r):void 0}const l={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(e,t,r)=>i(Do(e),Do(t),0,!0)};return ji.forEach(Object.keys(ot(ot({},e),t)),function(n){const o=l[n]||i,a=o(e[n],t[n],n);ji.isUndefined(a)&&o!==s||(r[n]=a)}),r}const Ro=e=>{const t=Uo({},e);let{data:r,withXSRFToken:n,xsrfHeaderName:i,xsrfCookieName:o,headers:a,auth:s}=t;if(t.headers=a=wo.from(a),t.url=ro(Lo(t.baseURL,t.url,t.allowAbsoluteUrls),e.params,e.paramsSerializer),s&&a.set("Authorization","Basic "+btoa((s.username||"")+":"+(s.password?unescape(encodeURIComponent(s.password)):""))),ji.isFormData(r))if(ho.hasStandardBrowserEnv||ho.hasStandardBrowserWebWorkerEnv)a.setContentType(void 0);else if(ji.isFunction(r.getHeaders)){const e=r.getHeaders(),t=["content-type","content-length"];Object.entries(e).forEach(e=>{let[r,n]=e;t.includes(r.toLowerCase())&&a.set(r,n)})}if(ho.hasStandardBrowserEnv&&(n&&ji.isFunction(n)&&(n=n(t)),n||!1!==n&&Mo(t.url))){const e=i&&o&&Oo.read(o);e&&a.set(i,e)}return t},zo="undefined"!==typeof XMLHttpRequest&&function(e){return new Promise(function(t,r){const n=Ro(e);let i=n.data;const o=wo.from(n.headers).normalize();let a,s,l,c,u,{responseType:d,onUploadProgress:h,onDownloadProgress:A}=n;function f(){c&&c(),u&&u(),n.cancelToken&&n.cancelToken.unsubscribe(a),n.signal&&n.signal.removeEventListener("abort",a)}let p=new XMLHttpRequest;function m(){if(!p)return;const n=wo.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders());So(function(e){t(e),f()},function(e){r(e),f()},{data:d&&"text"!==d&&"json"!==d?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:n,config:e,request:p}),p=null}p.open(n.method.toUpperCase(),n.url,!0),p.timeout=n.timeout,"onloadend"in p?p.onloadend=m:p.onreadystatechange=function(){p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))&&setTimeout(m)},p.onabort=function(){p&&(r(new Gi("Request aborted",Gi.ECONNABORTED,e,p)),p=null)},p.onerror=function(t){const n=t&&t.message?t.message:"Network Error",i=new Gi(n,Gi.ERR_NETWORK,e,p);i.event=t||null,r(i),p=null},p.ontimeout=function(){let t=n.timeout?"timeout of "+n.timeout+"ms exceeded":"timeout exceeded";const i=n.transitional||io;n.timeoutErrorMessage&&(t=n.timeoutErrorMessage),r(new Gi(t,i.clarifyTimeoutError?Gi.ETIMEDOUT:Gi.ECONNABORTED,e,p)),p=null},void 0===i&&o.setContentType(null),"setRequestHeader"in p&&ji.forEach(o.toJSON(),function(e,t){p.setRequestHeader(t,e)}),ji.isUndefined(n.withCredentials)||(p.withCredentials=!!n.withCredentials),d&&"json"!==d&&(p.responseType=n.responseType),A&&([l,u]=Fo(A,!0),p.addEventListener("progress",l)),h&&p.upload&&([s,c]=Fo(h),p.upload.addEventListener("progress",s),p.upload.addEventListener("loadend",c)),(n.cancelToken||n.signal)&&(a=t=>{p&&(r(!t||t.type?new Eo(null,e,p):t),p.abort(),p=null)},n.cancelToken&&n.cancelToken.subscribe(a),n.signal&&(n.signal.aborted?a():n.signal.addEventListener("abort",a)));const g=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(n.url);g&&-1===ho.protocols.indexOf(g)?r(new Gi("Unsupported protocol "+g+":",Gi.ERR_BAD_REQUEST,e)):p.send(i||null)})},No=(e,t)=>{const{length:r}=e=e?e.filter(Boolean):[];if(t||r){let r,n=new AbortController;const i=function(e){if(!r){r=!0,a();const t=e instanceof Error?e:this.reason;n.abort(t instanceof Gi?t:new Eo(t instanceof Error?t.message:t))}};let o=t&&setTimeout(()=>{o=null,i(new Gi("timeout ".concat(t," of ms exceeded"),Gi.ETIMEDOUT))},t);const a=()=>{e&&(o&&clearTimeout(o),o=null,e.forEach(e=>{e.unsubscribe?e.unsubscribe(i):e.removeEventListener("abort",i)}),e=null)};e.forEach(e=>e.addEventListener("abort",i));const{signal:s}=n;return s.unsubscribe=()=>ji.asap(a),s}};function jo(e,t){this.v=e,this.k=t}function Qo(e){return function(){return new Vo(e.apply(this,arguments))}}function Vo(e){var t,r;function n(t,r){try{var o=e[t](r),a=o.value,s=a instanceof jo;Promise.resolve(s?a.v:a).then(function(r){if(s){var l="return"===t?"return":"next";if(!a.k||r.done)return n(l,r);r=e[l](r).value}i(o.done?"return":"normal",r)},function(e){n("throw",e)})}catch(e){i("throw",e)}}function i(e,i){switch(e){case"return":t.resolve({value:i,done:!0});break;case"throw":t.reject(i);break;default:t.resolve({value:i,done:!1})}(t=t.next)?n(t.key,t.arg):r=null}this._invoke=function(e,i){return new Promise(function(o,a){var s={key:e,arg:i,resolve:o,reject:a,next:null};r?r=r.next=s:(t=r=s,n(e,i))})},"function"!=typeof e.return&&(this.return=void 0)}function Ho(e){return new jo(e,0)}function Go(e){var t={},r=!1;function n(t,n){return r=!0,n=new Promise(function(r){r(e[t](n))}),{done:!1,value:new jo(n,1)}}return t["undefined"!=typeof Symbol&&Symbol.iterator||"@@iterator"]=function(){return this},t.next=function(e){return r?(r=!1,e):n("next",e)},"function"==typeof e.throw&&(t.throw=function(e){if(r)throw r=!1,e;return n("throw",e)}),"function"==typeof e.return&&(t.return=function(e){return r?(r=!1,e):n("return",e)}),t}function Ko(e){var t,r,n,i=2;for("undefined"!=typeof Symbol&&(r=Symbol.asyncIterator,n=Symbol.iterator);i--;){if(r&&null!=(t=e[r]))return t.call(e);if(n&&null!=(t=e[n]))return new Wo(t.call(e));r="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Wo(e){function t(e){if(Object(e)!==e)return Promise.reject(new TypeError(e+" is not an object."));var t=e.done;return Promise.resolve(e.value).then(function(e){return{value:e,done:t}})}return Wo=function(e){this.s=e,this.n=e.next},Wo.prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(e){var r=this.s.return;return void 0===r?Promise.resolve({value:e,done:!0}):t(r.apply(this.s,arguments))},throw:function(e){var r=this.s.return;return void 0===r?Promise.reject(e):t(r.apply(this.s,arguments))}},new Wo(e)}Vo.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},Vo.prototype.next=function(e){return this._invoke("next",e)},Vo.prototype.throw=function(e){return this._invoke("throw",e)},Vo.prototype.return=function(e){return this._invoke("return",e)};const qo=function*(e,t){let r=e.byteLength;if(!t||r<t)return void(yield e);let n,i=0;for(;i<r;)n=i+t,yield e.slice(i,n),i=n},Zo=function(){var e=Qo(function*(e,t){var r,n=!1,i=!1;try{for(var o,a=Ko(Xo(e));n=!(o=yield Ho(a.next())).done;n=!1){const e=o.value;yield*Go(Ko(qo(e,t)))}}catch(s){i=!0,r=s}finally{try{n&&null!=a.return&&(yield Ho(a.return()))}finally{if(i)throw r}}});return function(t,r){return e.apply(this,arguments)}}(),Xo=function(){var e=Qo(function*(e){if(e[Symbol.asyncIterator])return void(yield*Go(Ko(e)));const t=e.getReader();try{for(;;){const{done:e,value:r}=yield Ho(t.read());if(e)break;yield r}}finally{yield Ho(t.cancel())}});return function(t){return e.apply(this,arguments)}}(),Yo=(e,t,r,n)=>{const i=Zo(e,t);let o,a=0,s=e=>{o||(o=!0,n&&n(e))};return new ReadableStream({async pull(e){try{const{done:t,value:n}=await i.next();if(t)return s(),void e.close();let o=n.byteLength;if(r){let e=a+=o;r(e)}e.enqueue(new Uint8Array(n))}catch(t){throw s(t),t}},cancel:e=>(s(e),i.return())},{highWaterMark:2})},{isFunction:Jo}=ji,$o=(e=>{let{Request:t,Response:r}=e;return{Request:t,Response:r}})(ji.global),{ReadableStream:ea,TextEncoder:ta}=ji.global,ra=function(e){try{for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return!!e(...r)}catch(JO){return!1}},na=e=>{e=ji.merge.call({skipUndefined:!0},$o,e);const{fetch:t,Request:r,Response:n}=e,i=t?Jo(t):"function"===typeof fetch,o=Jo(r),a=Jo(n);if(!i)return!1;const s=i&&Jo(ea),l=i&&("function"===typeof ta?(c=new ta,e=>c.encode(e)):async e=>new Uint8Array(await new r(e).arrayBuffer()));var c;const u=o&&s&&ra(()=>{let e=!1;const t=new r(ho.origin,{body:new ea,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!t}),d=a&&s&&ra(()=>ji.isReadableStream(new n("").body)),h={stream:d&&(e=>e.body)};i&&["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!h[e]&&(h[e]=(t,r)=>{let n=t&&t[e];if(n)return n.call(t);throw new Gi("Response type '".concat(e,"' is not supported"),Gi.ERR_NOT_SUPPORT,r)})});const A=async(e,t)=>{const n=ji.toFiniteNumber(e.getContentLength());return null==n?(async e=>{if(null==e)return 0;if(ji.isBlob(e))return e.size;if(ji.isSpecCompliantForm(e)){const t=new r(ho.origin,{method:"POST",body:e});return(await t.arrayBuffer()).byteLength}return ji.isArrayBufferView(e)||ji.isArrayBuffer(e)?e.byteLength:(ji.isURLSearchParams(e)&&(e+=""),ji.isString(e)?(await l(e)).byteLength:void 0)})(t):n};return async e=>{let{url:i,method:a,data:s,signal:l,cancelToken:c,timeout:f,onDownloadProgress:p,onUploadProgress:m,responseType:g,headers:y,withCredentials:_="same-origin",fetchOptions:v}=Ro(e),x=t||fetch;g=g?(g+"").toLowerCase():"text";let w=No([l,c&&c.toAbortSignal()],f),b=null;const B=w&&w.unsubscribe&&(()=>{w.unsubscribe()});let C;try{if(m&&u&&"get"!==a&&"head"!==a&&0!==(C=await A(y,s))){let e,t=new r(i,{method:"POST",body:s,duplex:"half"});if(ji.isFormData(s)&&(e=t.headers.get("content-type"))&&y.setContentType(e),t.body){const[e,r]=ko(C,Fo(Po(m)));s=Yo(t.body,65536,e,r)}}ji.isString(_)||(_=_?"include":"omit");const t=o&&"credentials"in r.prototype,l=ot(ot({},v),{},{signal:w,method:a.toUpperCase(),headers:y.normalize().toJSON(),body:s,duplex:"half",credentials:t?_:void 0});b=o&&new r(i,l);let c=await(o?x(b,v):x(i,l));const f=d&&("stream"===g||"response"===g);if(d&&(p||f&&B)){const e={};["status","statusText","headers"].forEach(t=>{e[t]=c[t]});const t=ji.toFiniteNumber(c.headers.get("content-length")),[r,i]=p&&ko(t,Fo(Po(p),!0))||[];c=new n(Yo(c.body,65536,r,()=>{i&&i(),B&&B()}),e)}g=g||"text";let E=await h[ji.findKey(h,g)||"text"](c,e);return!f&&B&&B(),await new Promise((t,r)=>{So(t,r,{data:E,headers:wo.from(c.headers),status:c.status,statusText:c.statusText,config:e,request:b})})}catch(E){if(B&&B(),E&&"TypeError"===E.name&&/Load failed|fetch/i.test(E.message))throw Object.assign(new Gi("Network Error",Gi.ERR_NETWORK,e,b),{cause:E.cause||E});throw Gi.from(E,E&&E.code,e,b)}}},ia=new Map,oa=e=>{let t=e&&e.env||{};const{fetch:r,Request:n,Response:i}=t,o=[n,i,r];let a,s,l=o.length,c=ia;for(;l--;)a=o[l],s=c.get(a),void 0===s&&c.set(a,s=l?new Map:na(t)),c=s;return s},aa=(oa(),{http:null,xhr:zo,fetch:{get:oa}});ji.forEach(aa,(e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(JO){}Object.defineProperty(e,"adapterName",{value:t})}});const sa=e=>"- ".concat(e),la=e=>ji.isFunction(e)||null===e||!1===e;const ca={getAdapter:function(e,t){e=ji.isArray(e)?e:[e];const{length:r}=e;let n,i;const o={};for(let a=0;a<r;a++){let r;if(n=e[a],i=n,!la(n)&&(i=aa[(r=String(n)).toLowerCase()],void 0===i))throw new Gi("Unknown adapter '".concat(r,"'"));if(i&&(ji.isFunction(i)||(i=i.get(t))))break;o[r||"#"+a]=i}if(!i){const e=Object.entries(o).map(e=>{let[t,r]=e;return"adapter ".concat(t," ")+(!1===r?"is not supported by the environment":"is not available in the build")});let t=r?e.length>1?"since :\n"+e.map(sa).join("\n"):" "+sa(e[0]):"as no adapter specified";throw new Gi("There is no suitable adapter to dispatch the request "+t,"ERR_NOT_SUPPORT")}return i},adapters:aa};function ua(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new Eo(null,e)}function da(e){ua(e),e.headers=wo.from(e.headers),e.data=bo.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1);return ca.getAdapter(e.adapter||po.adapter,e)(e).then(function(t){return ua(e),t.data=bo.call(e,e.transformResponse,t),t.headers=wo.from(t.headers),t},function(t){return Bo(t)||(ua(e),t&&t.response&&(t.response.data=bo.call(e,e.transformResponse,t.response),t.response.headers=wo.from(t.response.headers))),Promise.reject(t)})}const ha="1.13.2",Aa={};["object","boolean","number","function","string","symbol"].forEach((e,t)=>{Aa[e]=function(r){return typeof r===e||"a"+(t<1?"n ":" ")+e}});const fa={};Aa.transitional=function(e,t,r){function n(e,t){return"[Axios v"+ha+"] Transitional option '"+e+"'"+t+(r?". "+r:"")}return(r,i,o)=>{if(!1===e)throw new Gi(n(i," has been removed"+(t?" in "+t:"")),Gi.ERR_DEPRECATED);return t&&!fa[i]&&(fa[i]=!0,console.warn(n(i," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(r,i,o)}},Aa.spelling=function(e){return(t,r)=>(console.warn("".concat(r," is likely a misspelling of ").concat(e)),!0)};const pa={assertOptions:function(e,t,r){if("object"!==typeof e)throw new Gi("options must be an object",Gi.ERR_BAD_OPTION_VALUE);const n=Object.keys(e);let i=n.length;for(;i-- >0;){const o=n[i],a=t[o];if(a){const t=e[o],r=void 0===t||a(t,o,e);if(!0!==r)throw new Gi("option "+o+" must be "+r,Gi.ERR_BAD_OPTION_VALUE);continue}if(!0!==r)throw new Gi("Unknown option "+o,Gi.ERR_BAD_OPTION)}},validators:Aa},ma=pa.validators;class ga{constructor(e){this.defaults=e||{},this.interceptors={request:new no,response:new no}}async request(e,t){try{return await this._request(e,t)}catch(r){if(r instanceof Error){let e={};Error.captureStackTrace?Error.captureStackTrace(e):e=new Error;const t=e.stack?e.stack.replace(/^.+\n/,""):"";try{r.stack?t&&!String(r.stack).endsWith(t.replace(/^.+\n.+\n/,""))&&(r.stack+="\n"+t):r.stack=t}catch(JO){}}throw r}}_request(e,t){"string"===typeof e?(t=t||{}).url=e:t=e||{},t=Uo(this.defaults,t);const{transitional:r,paramsSerializer:n,headers:i}=t;void 0!==r&&pa.assertOptions(r,{silentJSONParsing:ma.transitional(ma.boolean),forcedJSONParsing:ma.transitional(ma.boolean),clarifyTimeoutError:ma.transitional(ma.boolean)},!1),null!=n&&(ji.isFunction(n)?t.paramsSerializer={serialize:n}:pa.assertOptions(n,{encode:ma.function,serialize:ma.function},!0)),void 0!==t.allowAbsoluteUrls||(void 0!==this.defaults.allowAbsoluteUrls?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),pa.assertOptions(t,{baseUrl:ma.spelling("baseURL"),withXsrfToken:ma.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let o=i&&ji.merge(i.common,i[t.method]);i&&ji.forEach(["delete","get","head","post","put","patch","common"],e=>{delete i[e]}),t.headers=wo.concat(o,i);const a=[];let s=!0;this.interceptors.request.forEach(function(e){"function"===typeof e.runWhen&&!1===e.runWhen(t)||(s=s&&e.synchronous,a.unshift(e.fulfilled,e.rejected))});const l=[];let c;this.interceptors.response.forEach(function(e){l.push(e.fulfilled,e.rejected)});let u,d=0;if(!s){const e=[da.bind(this),void 0];for(e.unshift(...a),e.push(...l),u=e.length,c=Promise.resolve(t);d<u;)c=c.then(e[d++],e[d++]);return c}u=a.length;let h=t;for(;d<u;){const e=a[d++],t=a[d++];try{h=e(h)}catch(A){t.call(this,A);break}}try{c=da.call(this,h)}catch(A){return Promise.reject(A)}for(d=0,u=l.length;d<u;)c=c.then(l[d++],l[d++]);return c}getUri(e){return ro(Lo((e=Uo(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}}ji.forEach(["delete","get","head","options"],function(e){ga.prototype[e]=function(t,r){return this.request(Uo(r||{},{method:e,url:t,data:(r||{}).data}))}}),ji.forEach(["post","put","patch"],function(e){function t(t){return function(r,n,i){return this.request(Uo(i||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:n}))}}ga.prototype[e]=t(),ga.prototype[e+"Form"]=t(!0)});const ya=ga;class _a{constructor(e){if("function"!==typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(e){t=e});const r=this;this.promise.then(e=>{if(!r._listeners)return;let t=r._listeners.length;for(;t-- >0;)r._listeners[t](e);r._listeners=null}),this.promise.then=e=>{let t;const n=new Promise(e=>{r.subscribe(e),t=e}).then(e);return n.cancel=function(){r.unsubscribe(t)},n},e(function(e,n,i){r.reason||(r.reason=new Eo(e,n,i),t(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=t=>{e.abort(t)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;const t=new _a(function(t){e=t});return{token:t,cancel:e}}}const va=_a;const xa={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(xa).forEach(e=>{let[t,r]=e;xa[r]=t});const wa=xa;const ba=function e(t){const r=new ya(t),n=ti(ya.prototype.request,r);return ji.extend(n,ya.prototype,r,{allOwnKeys:!0}),ji.extend(n,r,null,{allOwnKeys:!0}),n.create=function(r){return e(Uo(t,r))},n}(po);ba.Axios=ya,ba.CanceledError=Eo,ba.CancelToken=va,ba.isCancel=Bo,ba.VERSION=ha,ba.toFormData=Xi,ba.AxiosError=Gi,ba.Cancel=ba.CanceledError,ba.all=function(e){return Promise.all(e)},ba.spread=function(e){return function(t){return e.apply(null,t)}},ba.isAxiosError=function(e){return ji.isObject(e)&&!0===e.isAxiosError},ba.mergeConfig=Uo,ba.AxiosHeaders=wo,ba.formToJSON=e=>Ao(ji.isHTMLForm(e)?new FormData(e):e),ba.getAdapter=ca.getAdapter,ba.HttpStatusCode=wa,ba.default=ba;const Ba=ba;var Ca=r(579);const Ea=new Set;let Sa=[];const Ta=(e,t)=>{const r={id:Math.random().toString(36).substr(2,9),message:e,details:t,timestamp:new Date};Sa=[...Sa,r],Ea.forEach(e=>e(Sa)),console.error("[CANOPI Error] ".concat(e),t||""),setTimeout(()=>{Ia(r.id)},1e4)},Ia=e=>{Sa=Sa.filter(t=>t.id!==e),Ea.forEach(e=>e(Sa))},Fa="http://localhost:8000",ka=Ba.create({baseURL:Fa,timeout:3e4,withCredentials:!1,headers:{"Content-Type":"application/json"}});ka.interceptors.request.use(e=>{const t=localStorage.getItem("auth_token");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e},e=>(console.error("[API Request Error]",e),Promise.reject(e)));const Pa=e=>{if(!e)return"";if("object"===typeof e&&"detail"in e){const t=e.detail;if(Array.isArray(t))return t.map(e=>{var t;const r=(null===(t=e.loc)||void 0===t?void 0:t.slice(-1)[0])||"field";return"".concat(r,": ").concat(e.msg||"validation error")}).join(", ");if("string"===typeof t)return t}if("object"===typeof e&&"message"in e){const t=e.message;if("string"===typeof t)return t}return""};ka.interceptors.response.use(e=>e,e=>{var t;const r=(null===(t=e.config)||void 0===t?void 0:t.url)||"unknown endpoint";if(e.response){const t=e.response.status,n=Pa(e.response.data);switch(t){case 401:Ta("Session expired","Please log in again"),localStorage.removeItem("auth_token");break;case 403:Ta("Access denied","Insufficient permissions");break;case 404:Ta("Not found: ".concat(r),n);break;case 422:Ta("Validation error",n||"Invalid request parameters");break;case 500:Ta("Server error",n||"Internal server error");break;default:Ta("API Error (".concat(t,")"),n||"Request to ".concat(r," failed"))}}else e.request?Ta("Network error","Cannot reach server at ".concat(Fa)):Ta("Request error",e.message);return Promise.reject(e)});const Ma=e=>{if(Ba.isAxiosError(e)){var t;const r=e;if(null!==(t=r.response)&&void 0!==t&&t.data){const e=Pa(r.response.data);if(e)return e}if(r.message)return r.message}return"An unexpected error occurred"};const Oa=e=>{var t,r,n,i;return{id:e.id,name:e.name,type:e.type,coordinates:{latitude:(null===(t=e.location)||void 0===t?void 0:t.lat)||0,longitude:(null===(r=e.location)||void 0===r?void 0:r.lon)||0},capacity_mw:e.capacity_mw,capex_per_mw:null!==(n=e.parameters)&&void 0!==n&&n.capex?e.parameters.capex/e.capacity_mw:void 0,opex_per_mw:null!==(i=e.parameters)&&void 0!==i&&i.opex?e.parameters.opex/e.capacity_mw:void 0,status:e.status,created_at:e.created_at,updated_at:e.updated_at}},La={async getProjects(e){try{return(await ka.get("/api/v1/projects/",{params:e})).data.map(Oa)}catch(t){throw new Error(Ma(t))}},async getProject(e){try{const t=await ka.get("/api/v1/projects/".concat(e));return Oa(t.data)}catch(t){throw new Error(Ma(t))}},async createProject(e){try{const t=await ka.post("/api/v1/projects/",e);return Oa(t.data)}catch(t){throw new Error(Ma(t))}},async updateProject(e,t){try{const r=await ka.put("/api/v1/projects/".concat(e),t);return Oa(r.data)}catch(r){throw new Error(Ma(r))}},async deleteProject(e){try{await ka.delete("/api/v1/projects/".concat(e))}catch(t){throw new Error(Ma(t))}},async updateProjectCoordinates(e,t,r){try{const n=await ka.patch("/api/v1/projects/".concat(e,"/coordinates"),{latitude:t,longitude:r});return Oa(n.data)}catch(n){throw new Error(Ma(n))}},async bulkCreateProjects(e){try{return(await ka.post("/api/v1/projects/bulk",{projects:e})).data.map(Oa)}catch(t){throw new Error(Ma(t))}}},Da=La,Ua=Jr("projects/fetchProjects",async e=>await Da.getProjects(e)),Ra=Jr("projects/fetchProject",async e=>await Da.getProject(e)),za=Jr("projects/createProject",async e=>await Da.createProject(e)),Na=Jr("projects/updateProject",async e=>{let{id:t,data:r}=e;return await Da.updateProject(t,r)}),ja=Jr("projects/deleteProject",async e=>(await Da.deleteProject(e),e)),Qa=Jr("projects/updateProjectCoordinates",async e=>{let{id:t,latitude:r,longitude:n}=e;return await Da.updateProjectCoordinates(t,r,n)}),Va=on({name:"projects",initialState:{projects:[],selectedProject:null,isLoading:!1,error:null,total:0},reducers:{setSelectedProject:(e,t)=>{e.selectedProject=t.payload},clearError:e=>{e.error=null},addProjectLocal:(e,t)=>{e.projects.push(t.payload)},updateProjectLocal:(e,t)=>{const r=e.projects.findIndex(e=>e.id===t.payload.id);-1!==r&&(e.projects[r]=t.payload)},removeProjectLocal:(e,t)=>{e.projects=e.projects.filter(e=>e.id!==t.payload)}},extraReducers:e=>{e.addCase(Ua.pending,e=>{e.isLoading=!0,e.error=null}).addCase(Ua.fulfilled,(e,t)=>{e.isLoading=!1,e.projects=Array.isArray(t.payload)?t.payload:[],e.total=Array.isArray(t.payload)?t.payload.length:0}).addCase(Ua.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to fetch projects"}),e.addCase(Ra.pending,e=>{e.isLoading=!0,e.error=null}).addCase(Ra.fulfilled,(e,t)=>{e.isLoading=!1,e.selectedProject=t.payload}).addCase(Ra.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to fetch project"}),e.addCase(za.pending,e=>{e.isLoading=!0,e.error=null}).addCase(za.fulfilled,(e,t)=>{e.isLoading=!1,e.projects.push(t.payload),e.selectedProject=t.payload}).addCase(za.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to create project"}),e.addCase(Na.pending,e=>{e.isLoading=!0,e.error=null}).addCase(Na.fulfilled,(e,t)=>{var r;e.isLoading=!1;const n=e.projects.findIndex(e=>e.id===t.payload.id);-1!==n&&(e.projects[n]=t.payload),(null===(r=e.selectedProject)||void 0===r?void 0:r.id)===t.payload.id&&(e.selectedProject=t.payload)}).addCase(Na.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to update project"}),e.addCase(ja.pending,e=>{e.isLoading=!0,e.error=null}).addCase(ja.fulfilled,(e,t)=>{var r;e.isLoading=!1,e.projects=e.projects.filter(e=>e.id!==t.payload),(null===(r=e.selectedProject)||void 0===r?void 0:r.id)===t.payload&&(e.selectedProject=null)}).addCase(ja.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to delete project"}),e.addCase(Qa.fulfilled,(e,t)=>{var r;const n=e.projects.findIndex(e=>e.id===t.payload.id);-1!==n&&(e.projects[n]=t.payload),(null===(r=e.selectedProject)||void 0===r?void 0:r.id)===t.payload.id&&(e.selectedProject=t.payload)})}}),{setSelectedProject:Ha,clearError:Ga,addProjectLocal:Ka,updateProjectLocal:Wa,removeProjectLocal:qa}=Va.actions,Za=Va.reducer,Xa=e=>{let{project:t,map:r}=e;const i=(0,n.useRef)(null),o=$e();return(0,n.useEffect)(()=>{if(!r||i.current)return;const e=document.createElement("div");e.className="project-marker",e.innerHTML='\n      <div class="flex flex-col items-center cursor-pointer transition-transform hover:scale-110">\n        <div class="text-3xl" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));">\n          '.concat((e=>{switch(e){case ei.SOLAR:return"\u2600\ufe0f";case ei.WIND:return"\ud83d\udca8";case ei.STORAGE:return"\u26a1";case ei.DATACENTER:return"\ud83c\udfe2";default:return"\ud83d\udccd"}})(t.type),'\n        </div>\n        <div class="bg-white dark:bg-gray-800 px-2 py-1 rounded shadow-lg text-xs font-semibold mt-1 border-2"\n             style="border-color: ').concat((e=>{switch(e){case ei.SOLAR:return"#F59E0B";case ei.WIND:return"#06B6D4";case ei.STORAGE:return"#8B5CF6";case ei.DATACENTER:return"#1E40AF";default:return"#6B7280"}})(t.type),';">\n          ').concat(t.name,"\n        </div>\n      </div>\n    ");const n=new(Je().Marker)({element:e,draggable:!0,anchor:"bottom"}).setLngLat([t.coordinates.longitude,t.coordinates.latitude]).addTo(r);e.addEventListener("click",()=>{o(Ha(t))}),n.on("dragend",()=>{const e=n.getLngLat();o(Qa({id:t.id,latitude:e.lat,longitude:e.lng}))});const a=new(Je().Popup)({offset:25,closeButton:!1,closeOnClick:!1}).setHTML('\n      <div class="p-2">\n        <h3 class="font-bold text-sm mb-1">'.concat(t.name,'</h3>\n        <p class="text-xs text-gray-600 dark:text-gray-400">\n          Type: ').concat(t.type,"<br/>\n          Capacity: ").concat(t.capacity_mw," MW<br/>\n          Location: ").concat(t.coordinates.latitude.toFixed(4),", ").concat(t.coordinates.longitude.toFixed(4),"\n        </p>\n      </div>\n    "));return e.addEventListener("mouseenter",()=>{n.setPopup(a),a.addTo(r)}),e.addEventListener("mouseleave",()=>{a.remove()}),i.current=n,()=>{i.current&&(i.current.remove(),i.current=null)}},[r,t,o]),(0,n.useEffect)(()=>{i.current&&i.current.setLngLat([t.coordinates.longitude,t.coordinates.latitude])},[t.coordinates]),null},Ya=[{id:"w1",name:"Palo Verde",coordinates:{latitude:33.39,longitude:-112.86},voltage_kv:500,type:"substation"},{id:"w2",name:"Devers",coordinates:{latitude:33.93,longitude:-116.58},voltage_kv:500,type:"substation"},{id:"w3",name:"Vincent",coordinates:{latitude:34.5,longitude:-118.11},voltage_kv:500,type:"substation"},{id:"w4",name:"Malin",coordinates:{latitude:42.01,longitude:-121.41},voltage_kv:500,type:"substation"},{id:"w5",name:"Midpoint",coordinates:{latitude:42.68,longitude:-115.53},voltage_kv:500,type:"substation"},{id:"w6",name:"Mead",coordinates:{latitude:36.05,longitude:-114.75},voltage_kv:500,type:"substation"},{id:"w7",name:"Glen Canyon",coordinates:{latitude:36.94,longitude:-111.48},voltage_kv:345,type:"substation"},{id:"w8",name:"Four Corners",coordinates:{latitude:36.69,longitude:-108.48},voltage_kv:500,type:"substation"},{id:"w9",name:"San Juan",coordinates:{latitude:36.8,longitude:-108.43},voltage_kv:345,type:"substation"},{id:"w10",name:"Colstrip",coordinates:{latitude:45.88,longitude:-106.62},voltage_kv:500,type:"substation"},{id:"e1",name:"PJM West Hub",coordinates:{latitude:40,longitude:-80},voltage_kv:500,type:"substation"},{id:"e2",name:"Indian Point",coordinates:{latitude:41.27,longitude:-73.95},voltage_kv:345,type:"substation"},{id:"e3",name:"Millstone",coordinates:{latitude:41.31,longitude:-72.17},voltage_kv:345,type:"substation"},{id:"e4",name:"Seabrook",coordinates:{latitude:42.9,longitude:-70.85},voltage_kv:345,type:"substation"},{id:"e5",name:"Calvert Cliffs",coordinates:{latitude:38.43,longitude:-76.44},voltage_kv:500,type:"substation"},{id:"e6",name:"North Anna",coordinates:{latitude:38.06,longitude:-77.79},voltage_kv:500,type:"substation"},{id:"e7",name:"Brunswick",coordinates:{latitude:33.96,longitude:-78.01},voltage_kv:230,type:"substation"},{id:"e8",name:"Vogtle",coordinates:{latitude:33.14,longitude:-81.76},voltage_kv:500,type:"substation"},{id:"e9",name:"Turkey Point",coordinates:{latitude:25.43,longitude:-80.33},voltage_kv:500,type:"substation"},{id:"e10",name:"Crystal River",coordinates:{latitude:28.96,longitude:-82.7},voltage_kv:500,type:"substation"},{id:"e11",name:"Grand Gulf",coordinates:{latitude:32.01,longitude:-91.05},voltage_kv:500,type:"substation"},{id:"e12",name:"River Bend",coordinates:{latitude:30.76,longitude:-91.33},voltage_kv:500,type:"substation"},{id:"e13",name:"Waterford",coordinates:{latitude:29.99,longitude:-90.47},voltage_kv:500,type:"substation"},{id:"e14",name:"Cook",coordinates:{latitude:41.97,longitude:-86.56},voltage_kv:345,type:"substation"},{id:"e15",name:"Braidwood",coordinates:{latitude:41.24,longitude:-88.21},voltage_kv:345,type:"substation"},{id:"e16",name:"Byron",coordinates:{latitude:42.08,longitude:-89.28},voltage_kv:345,type:"substation"},{id:"e17",name:"Prairie Island",coordinates:{latitude:44.62,longitude:-92.63},voltage_kv:345,type:"substation"},{id:"e18",name:"Monticello",coordinates:{latitude:45.33,longitude:-93.85},voltage_kv:345,type:"substation"},{id:"t1",name:"South Texas",coordinates:{latitude:28.8,longitude:-96.05},voltage_kv:345,type:"substation"},{id:"t2",name:"Comanche Peak",coordinates:{latitude:32.3,longitude:-97.79},voltage_kv:345,type:"substation"},{id:"t3",name:"Martin Lake",coordinates:{latitude:32.26,longitude:-94.57},voltage_kv:345,type:"substation"},{id:"t4",name:"Houston Hub",coordinates:{latitude:29.76,longitude:-95.37},voltage_kv:345,type:"substation"},{id:"t5",name:"Dallas Hub",coordinates:{latitude:32.78,longitude:-96.8},voltage_kv:345,type:"substation"},{id:"t6",name:"West Texas Hub",coordinates:{latitude:31.87,longitude:-102.37},voltage_kv:345,type:"substation"}],Ja=[{id:"wl1",from_node_id:"w1",to_node_id:"w2",capacity_mw:2e3,voltage_kv:500,length_km:300,status:"operational"},{id:"wl2",from_node_id:"w2",to_node_id:"w3",capacity_mw:2e3,voltage_kv:500,length_km:150,status:"operational"},{id:"wl3",from_node_id:"w4",to_node_id:"w5",capacity_mw:2e3,voltage_kv:500,length_km:500,status:"operational"},{id:"wl4",from_node_id:"w1",to_node_id:"w6",capacity_mw:2e3,voltage_kv:500,length_km:350,status:"operational"},{id:"wl5",from_node_id:"w6",to_node_id:"w7",capacity_mw:900,voltage_kv:345,length_km:200,status:"operational"},{id:"wl6",from_node_id:"w7",to_node_id:"w8",capacity_mw:900,voltage_kv:345,length_km:250,status:"operational"},{id:"wl7",from_node_id:"w8",to_node_id:"w9",capacity_mw:900,voltage_kv:345,length_km:15,status:"operational"},{id:"wl8",from_node_id:"w5",to_node_id:"w10",capacity_mw:2e3,voltage_kv:500,length_km:700,status:"operational"},{id:"el1",from_node_id:"e1",to_node_id:"e5",capacity_mw:2e3,voltage_kv:500,length_km:200,status:"operational"},{id:"el2",from_node_id:"e5",to_node_id:"e6",capacity_mw:2e3,voltage_kv:500,length_km:80,status:"operational"},{id:"el3",from_node_id:"e6",to_node_id:"e7",capacity_mw:900,voltage_kv:230,length_km:350,status:"operational"},{id:"el4",from_node_id:"e7",to_node_id:"e8",capacity_mw:2e3,voltage_kv:500,length_km:300,status:"operational"},{id:"el5",from_node_id:"e8",to_node_id:"e9",capacity_mw:2e3,voltage_kv:500,length_km:600,status:"operational"},{id:"el6",from_node_id:"e9",to_node_id:"e10",capacity_mw:2e3,voltage_kv:500,length_km:400,status:"operational"},{id:"el7",from_node_id:"e10",to_node_id:"e11",capacity_mw:2e3,voltage_kv:500,length_km:600,status:"operational"},{id:"el8",from_node_id:"e11",to_node_id:"e12",capacity_mw:2e3,voltage_kv:500,length_km:150,status:"operational"},{id:"el9",from_node_id:"e12",to_node_id:"e13",capacity_mw:2e3,voltage_kv:500,length_km:100,status:"operational"},{id:"el10",from_node_id:"e14",to_node_id:"e15",capacity_mw:900,voltage_kv:345,length_km:150,status:"operational"},{id:"el11",from_node_id:"e15",to_node_id:"e16",capacity_mw:900,voltage_kv:345,length_km:100,status:"operational"},{id:"el12",from_node_id:"e17",to_node_id:"e18",capacity_mw:900,voltage_kv:345,length_km:80,status:"operational"},{id:"el13",from_node_id:"e2",to_node_id:"e3",capacity_mw:900,voltage_kv:345,length_km:150,status:"operational"},{id:"el14",from_node_id:"e3",to_node_id:"e4",capacity_mw:900,voltage_kv:345,length_km:200,status:"operational"},{id:"tl1",from_node_id:"t1",to_node_id:"t4",capacity_mw:900,voltage_kv:345,length_km:200,status:"operational"},{id:"tl2",from_node_id:"t2",to_node_id:"t5",capacity_mw:900,voltage_kv:345,length_km:80,status:"operational"},{id:"tl3",from_node_id:"t3",to_node_id:"t5",capacity_mw:900,voltage_kv:345,length_km:200,status:"operational"},{id:"tl4",from_node_id:"t4",to_node_id:"t5",capacity_mw:900,voltage_kv:345,length_km:350,status:"operational"},{id:"tl5",from_node_id:"t5",to_node_id:"t6",capacity_mw:900,voltage_kv:345,length_km:450,status:"operational"}],$a={nodes:Ya,lines:Ja},es={getGridTopology:async e=>(console.log("[Demo Mode] Returning demo grid topology"),$a),getNetworkNodes:async e=>Ya,getTransmissionLines:async e=>Ja,async findNearestSubstation(e,t){{let r=Ya[0],n=1/0;for(const i of Ya){const o=Math.sqrt(Math.pow(i.coordinates.latitude-e,2)+Math.pow(i.coordinates.longitude-t,2));o<n&&(n=o,r=i)}return r}},calculateInterconnectionCost:async(e,t)=>({distance_km:25.5,estimated_cost:1275e4,voltage_kv:345})},ts=e=>{try{return!!(e&&e.getStyle()&&e.isStyleLoaded())}catch(t){return!1}},rs=(e,t)=>{try{if(!ts(e))return;return e.getLayer(t)}catch(r){return}},ns=(e,t)=>{try{if(!ts(e))return;return e.getSource(t)}catch(r){return}},is=e=>{let{map:t}=e;const[r,i]=(0,n.useState)(null),o=et(e=>e.map.layers),a=(0,n.useRef)(!0),s=(0,n.useRef)(null),l=(0,n.useRef)(!1);return(0,n.useEffect)(()=>{a.current=!0;return(async()=>{try{const e=await es.getGridTopology({min_lat:14,max_lat:62,min_lon:-141,max_lon:-52,voltage_threshold:100,limit:2e3});a.current&&i(e)}catch(e){console.error("Failed to fetch grid topology:",e),a.current&&i({nodes:[],lines:[]})}})(),()=>{a.current=!1}},[]),(0,n.useEffect)(()=>{if(t&&r){if(!ts(t)){const r=()=>e();return t.once("styledata",r),()=>{try{t.off("styledata",r)}catch(e){}}}return e(),()=>{try{s.current&&(s.current.remove(),s.current=null),rs(t,"transmission-lines")&&t.removeLayer("transmission-lines"),rs(t,"substations")&&t.removeLayer("substations"),ns(t,"transmission-lines")&&t.removeSource("transmission-lines"),ns(t,"substations")&&t.removeSource("substations")}catch(JO){}}}function e(){if(r&&r.lines&&r.nodes&&ts(t)){try{rs(t,"transmission-lines")&&t.removeLayer("transmission-lines"),rs(t,"substations")&&t.removeLayer("substations"),ns(t,"transmission-lines")&&t.removeSource("transmission-lines"),ns(t,"substations")&&t.removeSource("substations")}catch(JO){return void console.warn("Error removing existing layers:",JO)}if(r.lines&&r.lines.length>0&&o.transmission){const e=r.lines.map(e=>{const t=r.nodes.find(t=>t.id===e.from_node_id),n=r.nodes.find(t=>t.id===e.to_node_id);return t&&n?{type:"Feature",properties:{id:e.id,capacity:e.capacity_mw,voltage:e.voltage_kv,status:e.status},geometry:{type:"LineString",coordinates:[[t.coordinates.longitude,t.coordinates.latitude],[n.coordinates.longitude,n.coordinates.latitude]]}}:null}).filter(e=>null!==e);t.addSource("transmission-lines",{type:"geojson",data:{type:"FeatureCollection",features:e}}),t.addLayer({id:"transmission-lines",type:"line",source:"transmission-lines",paint:{"line-color":["match",["get","status"],"operational","#06B6D4","planned","#F59E0B","under_construction","#8B5CF6","#6B7280"],"line-width":["interpolate",["linear"],["get","voltage"],100,1,345,3,500,5],"line-opacity":.7}})}if(r.nodes&&r.nodes.length>0&&o.substations){const e=r.nodes.map(e=>({type:"Feature",properties:{id:e.id,name:e.name,voltage:e.voltage_kv,type:e.type},geometry:{type:"Point",coordinates:[e.coordinates.longitude,e.coordinates.latitude]}}));t.addSource("substations",{type:"geojson",data:{type:"FeatureCollection",features:e}}),t.addLayer({id:"substations",type:"circle",source:"substations",paint:{"circle-radius":["interpolate",["linear"],["get","voltage"],100,4,345,8,500,12],"circle-color":"#1E40AF","circle-stroke-width":2,"circle-stroke-color":"#ffffff","circle-opacity":.8}});const n=e=>{if(t.getCanvas().style.cursor="pointer",e.features&&e.features[0]){s.current&&(s.current.remove(),s.current=null);const r=e.features[0],n=r.geometry.coordinates.slice(),i=r.properties,o=new(Je().Popup)({closeButton:!0,closeOnClick:!1,className:"substation-popup"}).setLngLat(n).setHTML('\n                <div class="p-2" style="min-width: 150px;">\n                  <h3 style="font-weight: bold; font-size: 14px; margin-bottom: 4px;">'.concat((null===i||void 0===i?void 0:i.name)||"Substation",'</h3>\n                  <p style="font-size: 12px; color: #666;">\n                    Voltage: ').concat(null===i||void 0===i?void 0:i.voltage," kV<br/>\n                    Type: ").concat(null===i||void 0===i?void 0:i.type,"\n                  </p>\n                </div>\n              ")).addTo(t),a=o.getElement();a&&(a.addEventListener("mouseenter",()=>{l.current=!0}),a.addEventListener("mouseleave",()=>{l.current=!1,setTimeout(()=>{!l.current&&s.current&&(s.current.remove(),s.current=null)},100)})),s.current=o}},i=()=>{t.getCanvas().style.cursor="",setTimeout(()=>{!l.current&&s.current&&(s.current.remove(),s.current=null)},100)};t.on("mouseenter","substations",n),t.on("mouseleave","substations",i)}}}},[t,r,o.transmission,o.substations]),null},os="eia_generator_data",as={NUC:"nuclear",COL:"coal",NG:"natural_gas",WND:"wind",SUN:"solar",WAT:"hydro",PET:"petroleum",BIO:"biomass",GEO:"geothermal",OTH:"other",GAS:"natural_gas",WIND:"wind",SOLAR:"solar",COAL:"coal",NUCLEAR:"nuclear",HYDRO:"hydro"},ss={nuclear:"#8B5CF6",coal:"#6B7280",natural_gas:"#3B82F6",wind:"#06B6D4",solar:"#FBBF24",hydro:"#10B981",petroleum:"#F97316",biomass:"#84CC16",geothermal:"#EF4444",other:"#9CA3AF"},ls={nuclear:"Nuclear",coal:"Coal",natural_gas:"Natural Gas",wind:"Wind",solar:"Solar",hydro:"Hydro",petroleum:"Petroleum",biomass:"Biomass",geothermal:"Geothermal",other:"Other"},cs=e=>{const t=(e||"").toUpperCase();return as[t]||"other"},us=[{id:"palo-verde",plantId:"6008",plantName:"Palo Verde",capacityMW:3937,fuelType:"nuclear",latitude:33.39,longitude:-112.86,state:"AZ",status:"OP"},{id:"south-texas",plantId:"6182",plantName:"South Texas Project",capacityMW:2700,fuelType:"nuclear",latitude:28.8,longitude:-96.05,state:"TX",status:"OP"},{id:"vogtle",plantId:"57689",plantName:"Vogtle",capacityMW:4700,fuelType:"nuclear",latitude:33.14,longitude:-81.76,state:"GA",status:"OP"},{id:"braidwood",plantId:"6069",plantName:"Braidwood",capacityMW:2389,fuelType:"nuclear",latitude:41.24,longitude:-88.21,state:"IL",status:"OP"},{id:"byron",plantId:"6070",plantName:"Byron",capacityMW:2347,fuelType:"nuclear",latitude:42.08,longitude:-89.28,state:"IL",status:"OP"},{id:"diablo-canyon",plantId:"292",plantName:"Diablo Canyon",capacityMW:2256,fuelType:"nuclear",latitude:35.21,longitude:-120.85,state:"CA",status:"OP"},{id:"scherer",plantId:"6023",plantName:"Robert W Scherer",capacityMW:3564,fuelType:"coal",latitude:33.08,longitude:-83.77,state:"GA",status:"OP"},{id:"colstrip",plantId:"6076",plantName:"Colstrip",capacityMW:2094,fuelType:"coal",latitude:45.88,longitude:-106.62,state:"MT",status:"OP"},{id:"navajo",plantId:"4941",plantName:"Navajo",capacityMW:2250,fuelType:"coal",latitude:36.91,longitude:-111.39,state:"AZ",status:"RE"},{id:"west-county",plantId:"54792",plantName:"West County Energy Center",capacityMW:3750,fuelType:"natural_gas",latitude:26.69,longitude:-80.3,state:"FL",status:"OP"},{id:"riviera-beach",plantId:"55120",plantName:"Riviera Beach Clean Energy",capacityMW:1219,fuelType:"natural_gas",latitude:26.77,longitude:-80.06,state:"FL",status:"OP"},{id:"martin",plantId:"628",plantName:"Martin",capacityMW:2860,fuelType:"natural_gas",latitude:27.06,longitude:-80.55,state:"FL",status:"OP"},{id:"alta-wind",plantId:"57251",plantName:"Alta Wind Energy Center",capacityMW:1548,fuelType:"wind",latitude:35.07,longitude:-118.39,state:"CA",status:"OP"},{id:"roscoe",plantId:"56639",plantName:"Roscoe Wind Farm",capacityMW:782,fuelType:"wind",latitude:32.45,longitude:-100.53,state:"TX",status:"OP"},{id:"horse-hollow",plantId:"56227",plantName:"Horse Hollow Wind",capacityMW:736,fuelType:"wind",latitude:32.11,longitude:-100.41,state:"TX",status:"OP"},{id:"capricorn-ridge",plantId:"56228",plantName:"Capricorn Ridge Wind",capacityMW:662,fuelType:"wind",latitude:32.01,longitude:-100.72,state:"TX",status:"OP"},{id:"fowler-ridge",plantId:"57172",plantName:"Fowler Ridge Wind Farm",capacityMW:600,fuelType:"wind",latitude:40.5,longitude:-87.35,state:"IN",status:"OP"},{id:"solar-star",plantId:"58176",plantName:"Solar Star",capacityMW:579,fuelType:"solar",latitude:35.02,longitude:-118.3,state:"CA",status:"OP"},{id:"topaz",plantId:"58081",plantName:"Topaz Solar Farm",capacityMW:550,fuelType:"solar",latitude:35.38,longitude:-119.93,state:"CA",status:"OP"},{id:"desert-sunlight",plantId:"58080",plantName:"Desert Sunlight",capacityMW:550,fuelType:"solar",latitude:33.83,longitude:-115.4,state:"CA",status:"OP"},{id:"ivanpah",plantId:"57505",plantName:"Ivanpah Solar",capacityMW:392,fuelType:"solar",latitude:35.56,longitude:-115.47,state:"CA",status:"OP"},{id:"agua-caliente",plantId:"57979",plantName:"Agua Caliente Solar",capacityMW:290,fuelType:"solar",latitude:32.95,longitude:-113.49,state:"AZ",status:"OP"},{id:"grand-coulee",plantId:"266",plantName:"Grand Coulee",capacityMW:6809,fuelType:"hydro",latitude:47.96,longitude:-118.98,state:"WA",status:"OP"},{id:"hoover-dam",plantId:"53",plantName:"Hoover Dam",capacityMW:2080,fuelType:"hydro",latitude:36.02,longitude:-114.74,state:"NV",status:"OP"},{id:"glen-canyon",plantId:"267",plantName:"Glen Canyon",capacityMW:1320,fuelType:"hydro",latitude:36.94,longitude:-111.48,state:"AZ",status:"OP"},{id:"chiefs-joseph",plantId:"265",plantName:"Chief Joseph",capacityMW:2614,fuelType:"hydro",latitude:47.99,longitude:-119.63,state:"WA",status:"OP"}],ds=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{minCapacity:t=100,apiKey:r}=e,n=(e=>{try{const t=localStorage.getItem(os);if(!t)return null;const r=JSON.parse(t);return Date.now()-r.timestamp>864e5?(localStorage.removeItem(os),null):r.minCapacity>e?null:r.minCapacity<e?r.data.filter(t=>t.capacityMW>=e):r.data}catch(t){return localStorage.removeItem(os),null}})(t);if(n)return console.log("[EIA] Using cached generator data"),n;const i=r||{NODE_ENV:"production",PUBLIC_URL:"/CANOPI_Prototyping",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0,REACT_APP_API_BASE_URL:"",REACT_APP_API_TIMEOUT:"30000",REACT_APP_DEMO_MODE:"true",REACT_APP_ENABLE_ANALYTICS:"false",REACT_APP_ENABLE_DARK_MODE:"true",REACT_APP_ENABLE_DEBUG:"false",REACT_APP_ENABLE_MOCK_DATA:"true",REACT_APP_ENVIRONMENT:"production",REACT_APP_MAPBOX_TOKEN:"pk.eyJ1IjoiYWdyYWJvd3MiLCJhIjoiY205MXBkaTEyMDNobjJzcHdyNjczOHY1ZiJ9.YUk31iaej90fE7REWALCLQ",REACT_APP_VERSION:"1.0.0"}.REACT_APP_EIA_API_KEY;if(!i)return console.log("[EIA] No API key, using sample generator data"),us.filter(e=>e.capacityMW>=t);console.log("[EIA] Fetching generators (minCapacity: ".concat(t,"MW)"));try{var o;const e=new URLSearchParams({api_key:i,frequency:"monthly",data:"nameplate-capacity-mw",facets:JSON.stringify({primemover:["ST","CC","CT","GT","WT","PV"]}),sort:'[{"column":"nameplate-capacity-mw","direction":"desc"}]',offset:"0",length:"5000"}),r=await fetch("".concat("https://api.eia.gov/v2/electricity/operating-generator-capacity/data","?").concat(e.toString()));if(!r.ok)throw new Error("EIA API error: ".concat(r.status));const n=((null===(o=(await r.json()).response)||void 0===o?void 0:o.data)||[]).filter(e=>(e["nameplate-capacity-mw"]||0)>=t).map(e=>({id:"".concat(e.plantid,"-").concat(e.generatorid),plantId:String(e.plantid),plantName:e.plantName||"Unknown Plant",capacityMW:e["nameplate-capacity-mw"]||0,fuelType:cs(e.energy_source_code),latitude:e.latitude||0,longitude:e.longitude||0,state:e.state||"Unknown",status:e.status||"OP",operatingYear:e.operating_year})).filter(e=>0!==e.latitude&&0!==e.longitude);return console.log("[EIA] Fetched ".concat(n.length," generators")),((e,t)=>{try{const r={data:e,timestamp:Date.now(),minCapacity:t};localStorage.setItem(os,JSON.stringify(r))}catch(JO){console.warn("Failed to cache EIA data:",JO)}})(n,t),n}catch(a){return console.error("[EIA] Failed to fetch generators:",a),console.log("[EIA] Falling back to sample data"),us.filter(e=>e.capacityMW>=t)}},hs=e=>({type:"FeatureCollection",features:e.map(e=>({type:"Feature",id:e.id,properties:{plantId:e.plantId,plantName:e.plantName,capacityMW:e.capacityMW,fuelType:e.fuelType,state:e.state,status:e.status,operatingYear:e.operatingYear},geometry:{type:"Point",coordinates:[e.longitude,e.latitude]}}))}),As=()=>{const e=$e(),t=et(e=>e.map.layers),r=et(e=>e.map.minVoltage),i=et(e=>e.map.visibleFuelTypes),o=et(e=>e.map.gridDataStats),[a,s]=(0,n.useState)(!1),[l,c]=(0,n.useState)(!1),u=[69,115,138,230,345,500,765],d=["nuclear","coal","natural_gas","wind","solar","hydro","petroleum","biomass","geothermal","other"];return(0,Ca.jsx)("div",{className:"absolute top-4 left-4 z-10","data-tour":"layers",children:(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden max-w-xs",role:"region","aria-label":"Map layer controls",children:[(0,Ca.jsxs)("button",{onClick:()=>s(!a),className:"w-full px-4 py-3 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500","aria-expanded":a,"aria-controls":"layer-controls-panel",children:[(0,Ca.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ca.jsx)("span",{className:"text-lg",children:"\ud83d\uddfa\ufe0f"}),(0,Ca.jsx)("span",{className:"font-semibold text-sm",children:"Map Layers"})]}),(0,Ca.jsxs)("div",{className:"flex items-center gap-2",children:[o.loading&&(0,Ca.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-primary-500 border-t-transparent rounded-full"}),(0,Ca.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(a?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]}),a&&(0,Ca.jsxs)("div",{id:"layer-controls-panel",className:"border-t border-gray-200 dark:border-gray-700 max-h-96 overflow-y-auto",children:[(o.transmissionLines>0||o.generators>0)&&(0,Ca.jsxs)("div",{className:"px-4 py-2 bg-gray-50 dark:bg-gray-700/50 text-xs",children:[(0,Ca.jsxs)("div",{className:"flex justify-between",children:[(0,Ca.jsx)("span",{className:"text-gray-500",children:"Transmission Lines:"}),(0,Ca.jsx)("span",{className:"font-medium",children:o.transmissionLines.toLocaleString()})]}),(0,Ca.jsxs)("div",{className:"flex justify-between",children:[(0,Ca.jsx)("span",{className:"text-gray-500",children:"Power Plants:"}),(0,Ca.jsx)("span",{className:"font-medium",children:o.generators})]}),(0,Ca.jsxs)("div",{className:"flex justify-between",children:[(0,Ca.jsx)("span",{className:"text-gray-500",children:"Total Capacity:"}),(0,Ca.jsxs)("span",{className:"font-medium",children:[(o.totalCapacityMW/1e3).toFixed(1)," GW"]})]})]}),[{key:"hifldTransmission",label:"HIFLD Transmission",icon:"\ud83d\udd0c"},{key:"generators",label:"Power Plants",icon:"\u26a1"},{key:"projects",label:"Projects",icon:"\ud83d\udccd"},{key:"grid",label:"Grid Network",icon:"\ud83d\udd17"},{key:"transmission",label:"Backend Tx Lines",icon:"\ud83d\udce1"},{key:"substations",label:"Substations",icon:"\ud83c\udfed"},{key:"optimalLocations",label:"Optimal Sites",icon:"\ud83c\udfaf"},{key:"transmissionUpgrades",label:"Tx Upgrades",icon:"\ud83d\udcc8"},{key:"terrain",label:"Terrain",icon:"\u26f0\ufe0f"},{key:"satellite",label:"Satellite",icon:"\ud83d\udef0\ufe0f"}].map(r=>{let{key:n,label:i,icon:o}=r;return(0,Ca.jsxs)("div",{className:"px-4 py-2 flex items-center justify-between hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[(0,Ca.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer flex-1",children:[(0,Ca.jsx)("span",{className:"text-lg",children:o}),(0,Ca.jsx)("span",{className:"text-sm font-medium",children:i})]}),(0,Ca.jsx)("button",{onClick:()=>e(Qn(n)),className:"relative inline-flex h-6 w-11 items-center rounded-full transition-colors ".concat(t[n]?"bg-primary-600":"bg-gray-300 dark:bg-gray-600"),children:(0,Ca.jsx)("span",{className:"inline-block h-4 w-4 transform rounded-full bg-white transition-transform ".concat(t[n]?"translate-x-6":"translate-x-1")})})]},n)}),(0,Ca.jsx)("div",{className:"px-4 py-2 border-t border-gray-200 dark:border-gray-700",children:(0,Ca.jsxs)("button",{onClick:()=>c(!l),className:"flex items-center gap-2 text-sm font-semibold text-gray-600 dark:text-gray-300 hover:text-primary-600",children:[(0,Ca.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(l?"rotate-90":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})}),(0,Ca.jsx)("span",{children:"Filters"})]})}),l&&(0,Ca.jsxs)("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700 space-y-4",children:[t.hifldTransmission&&(0,Ca.jsxs)("div",{children:[(0,Ca.jsxs)("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:["Minimum Voltage: ",r," kV"]}),(0,Ca.jsx)("input",{type:"range",min:0,max:u.length-1,value:-1!==u.indexOf(r)?u.indexOf(r):3,onChange:t=>e(Zn(u[parseInt(t.target.value)])),className:"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700"}),(0,Ca.jsxs)("div",{className:"flex justify-between text-xs text-gray-400 mt-1",children:[(0,Ca.jsx)("span",{children:"69kV"}),(0,Ca.jsx)("span",{children:"765kV"})]})]}),t.generators&&(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"Fuel Types"}),(0,Ca.jsx)("div",{className:"grid grid-cols-2 gap-1",children:d.map(t=>(0,Ca.jsxs)("label",{className:"flex items-center space-x-2 cursor-pointer text-xs",children:[(0,Ca.jsx)("input",{type:"checkbox",checked:i.includes(t),onChange:()=>e(Xn(t)),className:"rounded border-gray-300 text-primary-600 focus:ring-primary-500"}),(0,Ca.jsx)("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:ss[t]}}),(0,Ca.jsx)("span",{className:"text-gray-600 dark:text-gray-300",children:ls[t]})]},t))})]})]}),(t.transmission||t.hifldTransmission)&&(0,Ca.jsxs)("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:[(0,Ca.jsx)("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"Voltage Legend"}),(0,Ca.jsx)("div",{className:"space-y-1",children:[{voltage:"765 kV",color:"#FF0000",label:"Ultra High",value:765},{voltage:"500 kV",color:"#FF6600",label:"Extra High",value:500},{voltage:"345 kV",color:"#FFCC00",label:"Extra High",value:345},{voltage:"230 kV",color:"#00CC00",label:"High",value:230},{voltage:"138 kV",color:"#0066CC",label:"Transmission",value:138},{voltage:"69 kV",color:"#999999",label:"Sub-transmission",value:69}].filter(e=>e.value>=r).map(e=>{let{voltage:t,color:r}=e;return(0,Ca.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ca.jsx)("div",{className:"w-4 h-1 rounded",style:{backgroundColor:r}}),(0,Ca.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:t})]},t)})})]}),t.generators&&(0,Ca.jsxs)("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700",children:[(0,Ca.jsx)("div",{className:"text-xs font-semibold text-gray-500 dark:text-gray-400 mb-2",children:"Generator Types"}),(0,Ca.jsx)("div",{className:"grid grid-cols-2 gap-1",children:d.filter(e=>i.includes(e)).map(e=>(0,Ca.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ca.jsx)("div",{className:"w-3 h-3 rounded-full border border-white",style:{backgroundColor:ss[e]}}),(0,Ca.jsx)("span",{className:"text-xs text-gray-600 dark:text-gray-300",children:ls[e]})]},e))})]}),(0,Ca.jsxs)("div",{className:"px-4 py-2 border-t border-gray-200 dark:border-gray-700 text-xs text-gray-400",children:[(0,Ca.jsx)("div",{children:"Transmission: HIFLD ArcGIS"}),(0,Ca.jsx)("div",{children:"Generators: EIA"})]})]})]})})},fs=e=>{switch(e){case"solar":return"\ud83c\udf1e";case"wind":return"\ud83c\udf2c\ufe0f";case"storage":return"\ud83d\udd0b";default:return"\ud83d\udccd"}},ps=e=>{switch(e){case"solar":return"#F97316";case"wind":return"#0EA5E9";case"storage":return"#A855F7";default:return"#10B981"}},ms=e=>{let{locations:t,map:r,visible:i}=e;const o=(0,n.useRef)([]);return(0,n.useEffect)(()=>{if(o.current.forEach(e=>e.remove()),o.current=[],r&&i&&t&&0!==t.length)return t.forEach(e=>{const t=document.createElement("div");t.className="optimal-location-marker",t.innerHTML='\n        <div class="flex flex-col items-center cursor-pointer transition-transform hover:scale-110 animate-pulse-slow">\n          <div class="relative">\n            <div class="absolute -inset-2 rounded-full opacity-30 animate-ping"\n                 style="background-color: '.concat(ps(e.type),';">\n            </div>\n            <div class="text-3xl relative z-10" style="filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));">\n              ').concat(fs(e.type),'\n            </div>\n          </div>\n          <div class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-2 py-1 rounded-full shadow-lg text-xs font-bold mt-1 border-2 border-white">\n            ').concat(e.capacity_mw.toFixed(0)," MW\n          </div>\n        </div>\n      ");const n=new(Je().Marker)({element:t,anchor:"bottom"}).setLngLat([e.lon,e.lat]).addTo(r),i=e.capacity_factor?"".concat((100*e.capacity_factor).toFixed(0),"%"):"N/A",a=e.lcoe?"$".concat(e.lcoe.toFixed(2),"/MWh"):"N/A",s=new(Je().Popup)({offset:25,closeButton:!0,closeOnClick:!1,maxWidth:"300px"}).setHTML('\n        <div class="p-3">\n          <div class="flex items-center gap-2 mb-2">\n            <span class="text-2xl">'.concat(fs(e.type),'</span>\n            <h3 class="font-bold text-lg capitalize" style="color: ').concat(ps(e.type),'">\n              ').concat(e.type,' Project\n            </h3>\n          </div>\n          <div class="bg-green-50 dark:bg-green-900/20 rounded-lg p-2 mb-2">\n            <p class="text-sm font-semibold text-green-700 dark:text-green-400">\n              Recommended by CANOPI Optimization\n            </p>\n          </div>\n          <div class="space-y-1 text-sm">\n            <div class="flex justify-between">\n              <span class="text-gray-500">Capacity:</span>\n              <span class="font-semibold">').concat(e.capacity_mw.toFixed(0),' MW</span>\n            </div>\n            <div class="flex justify-between">\n              <span class="text-gray-500">Capacity Factor:</span>\n              <span class="font-semibold">').concat(i,'</span>\n            </div>\n            <div class="flex justify-between">\n              <span class="text-gray-500">LCOE:</span>\n              <span class="font-semibold">').concat(a,'</span>\n            </div>\n            <div class="flex justify-between">\n              <span class="text-gray-500">Interconnection Cost:</span>\n              <span class="font-semibold">').concat((l=e.interconnection_cost,l>=1e9?"$".concat((l/1e9).toFixed(1),"B"):l>=1e6?"$".concat((l/1e6).toFixed(1),"M"):l>=1e3?"$".concat((l/1e3).toFixed(0),"K"):"$".concat(l.toFixed(0))),'</span>\n            </div>\n            <div class="flex justify-between">\n              <span class="text-gray-500">Grid Node:</span>\n              <span class="font-semibold">').concat(e.grid_node,'</span>\n            </div>\n          </div>\n          <div class="mt-3 pt-2 border-t border-gray-200 dark:border-gray-700">\n            <p class="text-xs text-gray-600 dark:text-gray-400 italic">\n              "').concat(e.rationale,'"\n            </p>\n          </div>\n          <div class="mt-2 text-xs text-gray-400">\n            Location: ').concat(e.lat.toFixed(4),", ").concat(e.lon.toFixed(4),"\n          </div>\n        </div>\n      "));var l;t.addEventListener("click",e=>{e.stopPropagation(),n.setPopup(s),s.addTo(r)}),o.current.push(n)}),()=>{o.current.forEach(e=>e.remove()),o.current=[]}},[r,t,i]),null},gs=e=>{let{upgrades:t,map:r,visible:i}=e;const o=(0,n.useRef)("transmission-upgrades-source"),a=(0,n.useRef)("transmission-upgrades-layer"),s=(0,n.useRef)("transmission-upgrades-animation"),l=(0,n.useRef)([]);return(0,n.useEffect)(()=>{if(!r)return;const e=o.current,n=a.current,c=s.current;if(r.getLayer(c)&&r.removeLayer(c),r.getLayer(n)&&r.removeLayer(n),r.getSource(e)&&r.removeSource(e),l.current.forEach(e=>e.remove()),l.current=[],!i||!t||0===t.length)return;const u={type:"FeatureCollection",features:t.map((e,t)=>({type:"Feature",properties:{id:t,from_node:e.from_node,to_node:e.to_node,capacity_add_mw:e.capacity_add_mw,estimated_cost:e.estimated_cost,rationale:e.rationale},geometry:{type:"LineString",coordinates:[[e.from_lon,e.from_lat],[e.to_lon,e.to_lat]]}}))};return r.addSource(e,{type:"geojson",data:u}),r.addLayer({id:n,type:"line",source:e,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#10B981","line-width":4,"line-dasharray":[2,2],"line-opacity":.8}}),r.addLayer({id:c,type:"line",source:e,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#34D399","line-width":8,"line-opacity":.3,"line-blur":3}}),t.forEach(e=>{const t=(e.from_lat+e.to_lat)/2,n=(e.from_lon+e.to_lon)/2,i=document.createElement("div");i.className="transmission-upgrade-marker",i.innerHTML='\n        <div class="bg-emerald-500 text-white px-2 py-1 rounded-lg shadow-lg text-xs font-bold\n                    border-2 border-white cursor-pointer hover:bg-emerald-600 transition-colors">\n          \u26a1 +'.concat(e.capacity_add_mw.toFixed(0)," MW\n        </div>\n      ");const o=new(Je().Marker)({element:i,anchor:"center"}).setLngLat([n,t]).addTo(r),a=new(Je().Popup)({offset:15,closeButton:!0,closeOnClick:!1,maxWidth:"280px"}).setHTML('\n        <div class="p-3">\n          <div class="flex items-center gap-2 mb-2">\n            <span class="text-xl">\u26a1</span>\n            <h3 class="font-bold text-emerald-600">Transmission Upgrade</h3>\n          </div>\n          <div class="bg-emerald-50 dark:bg-emerald-900/20 rounded-lg p-2 mb-2">\n            <p class="text-sm font-semibold text-emerald-700 dark:text-emerald-400">\n              Recommended by CANOPI Optimization\n            </p>\n          </div>\n          <div class="space-y-1 text-sm">\n            <div class="flex justify-between">\n              <span class="text-gray-500">From:</span>\n              <span class="font-semibold">'.concat(e.from_node,'</span>\n            </div>\n            <div class="flex justify-between">\n              <span class="text-gray-500">To:</span>\n              <span class="font-semibold">').concat(e.to_node,'</span>\n            </div>\n            <div class="flex justify-between">\n              <span class="text-gray-500">Capacity Addition:</span>\n              <span class="font-semibold text-emerald-600">+').concat(e.capacity_add_mw.toFixed(0),' MW</span>\n            </div>\n            <div class="flex justify-between">\n              <span class="text-gray-500">Estimated Cost:</span>\n              <span class="font-semibold">').concat((s=e.estimated_cost,s>=1e9?"$".concat((s/1e9).toFixed(1),"B"):s>=1e6?"$".concat((s/1e6).toFixed(1),"M"):s>=1e3?"$".concat((s/1e3).toFixed(0),"K"):"$".concat(s.toFixed(0))),'</span>\n            </div>\n          </div>\n          <div class="mt-3 pt-2 border-t border-gray-200 dark:border-gray-700">\n            <p class="text-xs text-gray-600 dark:text-gray-400 italic">\n              "').concat(e.rationale,'"\n            </p>\n          </div>\n        </div>\n      '));var s;i.addEventListener("click",e=>{e.stopPropagation(),o.setPopup(a),a.addTo(r)}),l.current.push(o)}),()=>{r.getLayer(c)&&r.removeLayer(c),r.getLayer(n)&&r.removeLayer(n),r.getSource(e)&&r.removeSource(e),l.current.forEach(e=>e.remove()),l.current=[]}},[r,t,i]),null},ys={async getTransmissionGeoJSON(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new URLSearchParams;void 0!==e.min_lat&&t.append("min_lat",String(e.min_lat)),void 0!==e.max_lat&&t.append("max_lat",String(e.max_lat)),void 0!==e.min_lon&&t.append("min_lon",String(e.min_lon)),void 0!==e.max_lon&&t.append("max_lon",String(e.max_lon)),void 0!==e.min_voltage&&t.append("min_voltage",String(e.min_voltage)),void 0!==e.simplify&&t.append("simplify",String(e.simplify)),void 0!==e.limit&&t.append("limit",String(e.limit));return(await ka.get("/api/v1/transmission/lines/geojson?".concat(t.toString()))).data},async getTransmissionLines(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=new URLSearchParams;t.append("format","list"),void 0!==e.min_lat&&t.append("min_lat",String(e.min_lat)),void 0!==e.max_lat&&t.append("max_lat",String(e.max_lat)),void 0!==e.min_lon&&t.append("min_lon",String(e.min_lon)),void 0!==e.max_lon&&t.append("max_lon",String(e.max_lon)),void 0!==e.min_voltage&&t.append("min_voltage",String(e.min_voltage)),void 0!==e.max_voltage&&t.append("max_voltage",String(e.max_voltage)),void 0!==e.country&&t.append("country",e.country),void 0!==e.status&&t.append("status",e.status),void 0!==e.limit&&t.append("limit",String(e.limit));return(await ka.get("/api/v1/transmission/lines?".concat(t.toString()))).data},getStatistics:async()=>(await ka.get("/api/v1/transmission/stats")).data,findNearbyLines:async e=>(await ka.post("/api/v1/transmission/nearby",e)).data,getVoltageClasses:async()=>(await ka.get("/api/v1/transmission/voltage-classes")).data,getCoverage:async()=>(await ka.get("/api/v1/transmission/coverage")).data},_s="#FF0000",vs="#FF6600",xs="#FFCC00",ws="#00CC00",bs="#0066CC",Bs="#6666CC",Cs="#999999",Es="#06B6D4",Ss=e=>{let{map:t}=e;const[r,i]=(0,n.useState)(null),[,o]=(0,n.useState)(!1),[,a]=(0,n.useState)(null),s=et(e=>e.map.layers),l=(0,n.useRef)("transmission-network-source"),c=(0,n.useRef)("transmission-network-layer"),u=(0,n.useRef)(null),d=(0,n.useRef)(null),h=(0,n.useCallback)(async()=>{if(t){o(!0),a(null);try{const e=t.getBounds();if(!e)return void console.warn("Map bounds not available");const r=t.getZoom();let n=69;r<5?n=345:r<6?n=230:r<7?n=138:r<8&&(n=115);const o=e=>Math.max(-180,Math.min(180,e)),a=e=>Math.max(-90,Math.min(90,e)),s=await ys.getTransmissionGeoJSON({min_lat:a(e.getSouth()),max_lat:a(e.getNorth()),min_lon:o(e.getWest()),max_lon:o(e.getEast()),min_voltage:n,simplify:r<8,limit:15e3});i(s)}catch(e){console.error("Failed to fetch transmission data:",e),a("Failed to load transmission network data")}finally{o(!1)}}},[t]);return(0,n.useEffect)(()=>{if(!t||!s.transmission)return;let e;h();const r=()=>{clearTimeout(e),e=setTimeout(h,300)};return t.on("moveend",r),()=>{t.off("moveend",r),clearTimeout(e)}},[t,s.transmission,h]),(0,n.useEffect)(()=>{if(!t||!r)return;const e=l.current,n=c.current;return t.getLayer(n)&&t.removeLayer(n),t.getSource(e)&&t.removeSource(e),s.transmission&&0!==r.features.length?(t.addSource(e,{type:"geojson",data:r}),t.addLayer({id:n,type:"line",source:e,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["case",[">=",["get","voltage_kv"],765],_s,[">=",["get","voltage_kv"],500],vs,[">=",["get","voltage_kv"],345],xs,[">=",["get","voltage_kv"],230],ws,[">=",["get","voltage_kv"],138],bs,[">=",["get","voltage_kv"],115],Bs,[">=",["get","voltage_kv"],69],Cs,Es],"line-width":["interpolate",["linear"],["get","voltage_kv"],69,1,138,1.5,230,2,345,2.5,500,3,765,4],"line-opacity":["case",["boolean",["feature-state","hover"],!1],1,.7]}}),t.on("mouseenter",n,r=>{if(t.getCanvas().style.cursor="pointer",r.features&&r.features.length>0){var n;const o=r.features[0],a=o.id;null!==u.current&&t.setFeatureState({source:e,id:u.current},{hover:!1}),u.current=a,t.setFeatureState({source:e,id:a},{hover:!0});const s=o.properties,l=r.lngLat;d.current&&d.current.remove();const c=(null===s||void 0===s?void 0:s.voltage_kv)>=500?"Extra High Voltage":(null===s||void 0===s?void 0:s.voltage_kv)>=230?"High Voltage":(null===s||void 0===s?void 0:s.voltage_kv)>=115?"Transmission":"Sub-transmission";d.current=new(Je().Popup)({closeButton:!1,closeOnClick:!1,offset:10}).setLngLat(l).setHTML('\n            <div class="p-2 min-w-48">\n              <div class="flex items-center gap-2 mb-2">\n                <div class="w-3 h-3 rounded-full" style="background-color: '.concat((i=(null===s||void 0===s?void 0:s.voltage_kv)||0,i>=765?_s:i>=500?vs:i>=345?xs:i>=230?ws:i>=138?bs:i>=115?Bs:i>=69?Cs:Es),'"></div>\n                <span class="font-bold text-sm">').concat(null===s||void 0===s?void 0:s.voltage_kv," kV ").concat(c,'</span>\n              </div>\n              <div class="text-xs space-y-1">\n                <div class="flex justify-between">\n                  <span class="text-gray-500">Capacity:</span>\n                  <span class="font-medium">').concat(null===s||void 0===s||null===(n=s.capacity_mw)||void 0===n?void 0:n.toLocaleString(),' MW</span>\n                </div>\n                <div class="flex justify-between">\n                  <span class="text-gray-500">Owner:</span>\n                  <span class="font-medium">').concat((null===s||void 0===s?void 0:s.owner)||"Unknown",'</span>\n                </div>\n                <div class="flex justify-between">\n                  <span class="text-gray-500">Status:</span>\n                  <span class="font-medium capitalize">').concat((null===s||void 0===s?void 0:s.status)||"Unknown",'</span>\n                </div>\n                <div class="flex justify-between">\n                  <span class="text-gray-500">Country:</span>\n                  <span class="font-medium">').concat((null===s||void 0===s?void 0:s.country)||"Unknown","</span>\n                </div>\n              </div>\n            </div>\n          ")).addTo(t)}var i}),t.on("mouseleave",n,()=>{t.getCanvas().style.cursor="",null!==u.current&&(t.setFeatureState({source:e,id:u.current},{hover:!1}),u.current=null),d.current&&(d.current.remove(),d.current=null)}),()=>{t.getLayer(n)&&t.removeLayer(n),t.getSource(e)&&t.removeSource(e),d.current&&d.current.remove()}):void 0},[t,r,s.transmission]),null},Ts="hifld_transmission_data",Is=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{minVoltage:t=230,maxRecords:r=1e4,bbox:n}=e,{data:i,expired:o}=(e=>{try{const t=localStorage.getItem(Ts);if(!t)return{data:null,expired:!1};const r=JSON.parse(t);return Date.now()-r.timestamp>864e5?{data:null,expired:!0}:r.minVoltage>e?{data:null,expired:!1}:r.minVoltage<e?{data:ot(ot({},r.data),{},{features:r.data.features.filter(t=>(t.properties.VOLTAGE||0)>=e)}),expired:!1}:{data:r.data,expired:!1}}catch(t){return localStorage.removeItem(Ts),{data:null,expired:!1}}})(t);if(i&&!n)return console.log("[HIFLD] Using cached transmission data"),i;o&&console.log("[HIFLD] Cache expired, fetching fresh data"),console.log("[HIFLD] Fetching transmission lines (minVoltage: ".concat(t,"kV)"));const a=new URLSearchParams({where:"VOLTAGE >= ".concat(t),outFields:"OBJECTID,VOLTAGE,OWNER,STATUS,NAESSION,SUB_1,SUB_2",f:"geojson",resultRecordCount:String(r)});n&&(a.set("geometry",JSON.stringify({xmin:n.minLon,ymin:n.minLat,xmax:n.maxLon,ymax:n.maxLat,spatialReference:{wkid:4326}})),a.set("geometryType","esriGeometryEnvelope"),a.set("spatialRel","esriSpatialRelIntersects"),a.set("inSR","4326")),a.set("outSR","4326");try{const e=await fetch("".concat("https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Transmission_Lines/FeatureServer/0/query","?").concat(a.toString()));if(!e.ok)throw new Error("HIFLD API error: ".concat(e.status," ").concat(e.statusText));const r={type:"FeatureCollection",features:((await e.json()).features||[]).map((e,t)=>{var r,n,i,o,a,s,l,c;return{type:"Feature",id:String((null===(r=e.properties)||void 0===r?void 0:r.OBJECTID)||t),properties:{OBJECTID:(null===(n=e.properties)||void 0===n?void 0:n.OBJECTID)||t,VOLTAGE:(null===(i=e.properties)||void 0===i?void 0:i.VOLTAGE)||0,OWNER:(null===(o=e.properties)||void 0===o?void 0:o.OWNER)||"Unknown",STATUS:(null===(a=e.properties)||void 0===a?void 0:a.STATUS)||"Unknown",NAESSION:null===(s=e.properties)||void 0===s?void 0:s.NAESSION,SUB_1:null===(l=e.properties)||void 0===l?void 0:l.SUB_1,SUB_2:null===(c=e.properties)||void 0===c?void 0:c.SUB_2},geometry:e.geometry}})};return console.log("[HIFLD] Fetched ".concat(r.features.length," transmission lines")),n||(o&&localStorage.removeItem(Ts),((e,t)=>{try{const r={data:e,timestamp:Date.now(),minVoltage:t};localStorage.setItem(Ts,JSON.stringify(r))}catch(JO){console.warn("Failed to cache HIFLD data:",JO)}})(r,t)),r}catch(s){console.error("[HIFLD] Failed to fetch transmission lines:",s);const e=localStorage.getItem(Ts);if(e)try{const t=JSON.parse(e);return console.log("[HIFLD] Using expired cached data as fallback"),t.data}catch(l){}return{type:"FeatureCollection",features:[]}}},Fs=e=>e>=765?"#FF0000":e>=500?"#FF6600":e>=345?"#FFCC00":e>=230?"#00CC00":e>=138?"#0066CC":e>=115?"#6666CC":e>=69?"#999999":"#06B6D4",ks="#FF0000",Ps="#FF6600",Ms="#FFCC00",Os="#00CC00",Ls="#0066CC",Ds="#6666CC",Us="#999999",Rs="#06B6D4",zs=e=>{let{map:t,visible:r=!0,minVoltage:i=230,onStatsUpdate:o}=e;const[a,s]=(0,n.useState)(null),[l,c]=(0,n.useState)(!1),u=(0,n.useRef)("hifld-transmission-source"),d=(0,n.useRef)("hifld-transmission-layer"),h=(0,n.useRef)("hifld-transmission-highlight"),A=(0,n.useRef)(null),f=(0,n.useRef)(null),p=(0,n.useCallback)(async()=>{c(!0),null===o||void 0===o||o({totalLines:0,loading:!0});try{const e=await Is({minVoltage:i,maxRecords:15e3});s(e),null===o||void 0===o||o({totalLines:e.features.length,loading:!1})}catch(e){console.error("[HIFLD Layer] Failed to fetch data:",e),null===o||void 0===o||o({totalLines:0,loading:!1})}finally{c(!1)}},[i,o]);return(0,n.useEffect)(()=>{r&&p()},[r,p]),(0,n.useEffect)(()=>{if(!t||!a)return;const e=u.current,n=d.current,i=h.current,o=()=>{t.getLayer(i)&&t.removeLayer(i),t.getLayer(n)&&t.removeLayer(n),t.getSource(e)&&t.removeSource(e),f.current&&(f.current.remove(),f.current=null)};if(o(),!r||0===a.features.length)return o;t.addSource(e,{type:"geojson",data:a,generateId:!0}),t.addLayer({id:n,type:"line",source:e,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":["case",[">=",["get","VOLTAGE"],765],ks,[">=",["get","VOLTAGE"],500],Ps,[">=",["get","VOLTAGE"],345],Ms,[">=",["get","VOLTAGE"],230],Os,[">=",["get","VOLTAGE"],138],Ls,[">=",["get","VOLTAGE"],115],Ds,[">=",["get","VOLTAGE"],69],Us,Rs],"line-width":["interpolate",["linear"],["get","VOLTAGE"],69,1,138,1.5,230,2,345,2.5,500,3,765,4],"line-opacity":.7}}),t.addLayer({id:i,type:"line",source:e,layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#FFFFFF","line-width":["interpolate",["linear"],["get","VOLTAGE"],69,3,138,4,230,5,345,6,500,7,765,8],"line-opacity":["case",["boolean",["feature-state","hover"],!1],.5,0]}});const s=r=>{if(t.getCanvas().style.cursor="pointer",r.features&&r.features.length>0){const n=r.features[0],i=n.id;null!==A.current&&t.setFeatureState({source:e,id:A.current},{hover:!1}),void 0!==i&&(A.current=i,t.setFeatureState({source:e,id:i},{hover:!0}));const o=n.properties,a=(null===o||void 0===o?void 0:o.VOLTAGE)||0,s=(null===o||void 0===o?void 0:o.OWNER)||"Unknown",l=(null===o||void 0===o?void 0:o.STATUS)||"Unknown",c=a>=500?"Extra High Voltage":a>=230?"High Voltage":a>=115?"Transmission":"Sub-transmission";f.current&&f.current.remove(),f.current=new(Je().Popup)({closeButton:!1,closeOnClick:!1,offset:10}).setLngLat(r.lngLat).setHTML('\n            <div class="p-2 min-w-48">\n              <div class="flex items-center gap-2 mb-2">\n                <div class="w-3 h-3 rounded-full" style="background-color: '.concat(Fs(a),'"></div>\n                <span class="font-bold text-sm">').concat(a," kV ").concat(c,'</span>\n              </div>\n              <div class="text-xs space-y-1">\n                <div class="flex justify-between">\n                  <span class="text-gray-500">Owner:</span>\n                  <span class="font-medium">').concat(s,'</span>\n                </div>\n                <div class="flex justify-between">\n                  <span class="text-gray-500">Status:</span>\n                  <span class="font-medium capitalize">').concat(l,'</span>\n                </div>\n              </div>\n              <div class="mt-2 pt-2 border-t border-gray-200 text-xs text-gray-400">\n                Source: HIFLD\n              </div>\n            </div>\n          ')).addTo(t)}},l=()=>{t.getCanvas().style.cursor="",null!==A.current&&(t.setFeatureState({source:e,id:A.current},{hover:!1}),A.current=null),f.current&&(f.current.remove(),f.current=null)};return t.on("mouseenter",n,s),t.on("mouseleave",n,l),()=>{t.off("mouseenter",n,s),t.off("mouseleave",n,l),o()}},[t,a,r]),l&&r?(0,Ca.jsx)("div",{className:"absolute bottom-20 left-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg px-3 py-2 z-10",children:(0,Ca.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Ca.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-primary-500 border-t-transparent rounded-full"}),(0,Ca.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Loading HIFLD data..."})]})}):null},Ns=e=>{let{map:t,visible:r=!0,minCapacity:i=100,visibleFuelTypes:o,onStatsUpdate:a}=e;const[s,l]=(0,n.useState)([]),[c,u]=(0,n.useState)(null),[d,h]=(0,n.useState)(!1),A=(0,n.useRef)("generator-source"),f=(0,n.useRef)("generator-layer"),p=(0,n.useRef)("generator-highlight"),m=(0,n.useRef)(null),g=(0,n.useRef)(null),y=(0,n.useCallback)(async()=>{h(!0),null===a||void 0===a||a({totalGenerators:0,totalCapacityMW:0,loading:!0});try{const e=await ds({minCapacity:i});l(e);const t=e.reduce((e,t)=>e+t.capacityMW,0);null===a||void 0===a||a({totalGenerators:e.length,totalCapacityMW:t,loading:!1})}catch(e){console.error("[Generator Layer] Failed to fetch data:",e),null===a||void 0===a||a({totalGenerators:0,totalCapacityMW:0,loading:!1})}finally{h(!1)}},[i,a]);return(0,n.useEffect)(()=>{r&&y()},[r,y]),(0,n.useEffect)(()=>{if(0===s.length)return void u(null);let e=s;o&&o.length>0&&(e=s.filter(e=>o.includes(e.fuelType))),u(hs(e))},[s,o]),(0,n.useEffect)(()=>{if(!t||!c)return;const e=A.current,n=f.current,i=p.current,o=()=>{t.getLayer(i)&&t.removeLayer(i),t.getLayer(n)&&t.removeLayer(n),t.getSource(e)&&t.removeSource(e),g.current&&(g.current.remove(),g.current=null)};if(o(),!r||0===c.features.length)return o;t.addSource(e,{type:"geojson",data:c,generateId:!0}),t.addLayer({id:n,type:"circle",source:e,paint:{"circle-color":["match",["get","fuelType"],"nuclear",ss.nuclear,"coal",ss.coal,"natural_gas",ss.natural_gas,"wind",ss.wind,"solar",ss.solar,"hydro",ss.hydro,"petroleum",ss.petroleum,"biomass",ss.biomass,"geothermal",ss.geothermal,ss.other],"circle-radius":["interpolate",["linear"],["sqrt",["get","capacityMW"]],0,4,10,6,31.6,10,70.7,16],"circle-stroke-color":"#FFFFFF","circle-stroke-width":1.5,"circle-opacity":.85}}),t.addLayer({id:i,type:"circle",source:e,paint:{"circle-color":"transparent","circle-radius":["interpolate",["linear"],["sqrt",["get","capacityMW"]],0,8,10,12,31.6,18,70.7,26],"circle-stroke-color":"#FFFFFF","circle-stroke-width":["case",["boolean",["feature-state","hover"],!1],3,0],"circle-opacity":["case",["boolean",["feature-state","hover"],!1],1,0]}});const a=r=>{if(t.getCanvas().style.cursor="pointer",r.features&&r.features.length>0){const n=r.features[0],i=n.id;null!==m.current&&t.setFeatureState({source:e,id:m.current},{hover:!1}),void 0!==i&&(m.current=i,t.setFeatureState({source:e,id:i},{hover:!0}));const o=n.properties,a=(null===o||void 0===o?void 0:o.fuelType)||"other",s=ls[a],l=ss[a],c=n.geometry.coordinates;g.current&&g.current.remove(),g.current=new(Je().Popup)({closeButton:!1,closeOnClick:!1,offset:15}).setLngLat(c).setHTML('\n            <div class="p-2 min-w-48">\n              <div class="font-bold text-sm mb-2">'.concat((null===o||void 0===o?void 0:o.plantName)||"Unknown Plant",'</div>\n              <div class="flex items-center gap-2 mb-2">\n                <div class="w-3 h-3 rounded-full" style="background-color: ').concat(l,'"></div>\n                <span class="text-sm">').concat(s,'</span>\n              </div>\n              <div class="text-xs space-y-1">\n                <div class="flex justify-between">\n                  <span class="text-gray-500">Capacity:</span>\n                  <span class="font-medium">').concat(Number((null===o||void 0===o?void 0:o.capacityMW)||0).toLocaleString(),' MW</span>\n                </div>\n                <div class="flex justify-between">\n                  <span class="text-gray-500">State:</span>\n                  <span class="font-medium">').concat((null===o||void 0===o?void 0:o.state)||"Unknown",'</span>\n                </div>\n                <div class="flex justify-between">\n                  <span class="text-gray-500">Status:</span>\n                  <span class="font-medium">').concat("OP"===(null===o||void 0===o?void 0:o.status)?"Operating":null===o||void 0===o?void 0:o.status,'</span>\n                </div>\n              </div>\n              <div class="mt-2 pt-2 border-t border-gray-200 text-xs text-gray-400">\n                Source: EIA\n              </div>\n            </div>\n          ')).addTo(t)}},s=()=>{t.getCanvas().style.cursor="",null!==m.current&&(t.setFeatureState({source:e,id:m.current},{hover:!1}),m.current=null),g.current&&(g.current.remove(),g.current=null)};return t.on("mouseenter",n,a),t.on("mouseleave",n,s),()=>{t.off("mouseenter",n,a),t.off("mouseleave",n,s),o()}},[t,c,r]),d&&r?(0,Ca.jsx)("div",{className:"absolute bottom-32 left-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg px-3 py-2 z-10",children:(0,Ca.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Ca.jsx)("div",{className:"animate-spin h-4 w-4 border-2 border-primary-500 border-t-transparent rounded-full"}),(0,Ca.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Loading generators..."})]})}):null},js=e=>{let{onClose:t}=e;const r=et(e=>e.map.gridDataStats),n=et(e=>e.map.minVoltage),i=et(e=>e.map.visibleFuelTypes),o=et(e=>e.map.selectedFeature);return(0,Ca.jsxs)("div",{className:"absolute top-0 right-0 h-full w-80 bg-white dark:bg-gray-800 shadow-xl z-20 flex flex-col",children:[(0,Ca.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 dark:border-gray-700",children:[(0,Ca.jsx)("h2",{className:"font-bold text-lg",children:"Grid Data Panel"}),(0,Ca.jsx)("button",{onClick:t,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded",children:(0,Ca.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,Ca.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[(0,Ca.jsxs)("section",{children:[(0,Ca.jsx)("h3",{className:"font-semibold text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:"Network Statistics"}),(0,Ca.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-4 space-y-3",children:[(0,Ca.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Ca.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Transmission Lines"}),(0,Ca.jsx)("span",{className:"font-bold text-lg",children:r.loading?(0,Ca.jsx)("span",{className:"animate-pulse",children:"..."}):r.transmissionLines.toLocaleString()})]}),(0,Ca.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Ca.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Power Plants"}),(0,Ca.jsx)("span",{className:"font-bold text-lg",children:r.generators})]}),(0,Ca.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Ca.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Total Capacity"}),(0,Ca.jsxs)("span",{className:"font-bold text-lg",children:[(r.totalCapacityMW/1e3).toFixed(1)," GW"]})]}),(0,Ca.jsxs)("div",{className:"flex justify-between items-center",children:[(0,Ca.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300",children:"Min Voltage Filter"}),(0,Ca.jsxs)("span",{className:"font-medium",children:[n," kV"]})]})]})]}),(0,Ca.jsxs)("section",{children:[(0,Ca.jsx)("h3",{className:"font-semibold text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:"Voltage Distribution"}),(0,Ca.jsx)("div",{className:"space-y-2",children:[{class:"765 kV",color:"#FF0000",percent:2},{class:"500 kV",color:"#FF6600",percent:8},{class:"345 kV",color:"#FFCC00",percent:15},{class:"230 kV",color:"#00CC00",percent:25},{class:"138 kV",color:"#0066CC",percent:30},{class:"69 kV",color:"#999999",percent:20}].map(e=>{let{class:t,color:r,percent:n}=e;return(0,Ca.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Ca.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:r}}),(0,Ca.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300 flex-1",children:t}),(0,Ca.jsx)("div",{className:"w-24 h-2 bg-gray-200 dark:bg-gray-600 rounded-full overflow-hidden",children:(0,Ca.jsx)("div",{className:"h-full rounded-full",style:{width:"".concat(n,"%"),backgroundColor:r}})}),(0,Ca.jsxs)("span",{className:"text-xs text-gray-500 w-8 text-right",children:[n,"%"]})]},t)})})]}),(0,Ca.jsxs)("section",{children:[(0,Ca.jsx)("h3",{className:"font-semibold text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:"Capacity by Fuel Type"}),(0,Ca.jsx)("div",{className:"space-y-2",children:["nuclear","coal","natural_gas","wind","solar","hydro","petroleum","biomass","geothermal","other"].filter(e=>i.includes(e)).map(e=>(0,Ca.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Ca.jsx)("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:ss[e]}}),(0,Ca.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-300 flex-1",children:ls[e]})]},e))})]}),o&&(0,Ca.jsxs)("section",{children:[(0,Ca.jsx)("h3",{className:"font-semibold text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:"Selected Feature"}),(0,Ca.jsx)("div",{className:"bg-primary-50 dark:bg-primary-900/20 rounded-lg p-4",children:(0,Ca.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-300",children:o})})]}),(0,Ca.jsxs)("section",{children:[(0,Ca.jsx)("h3",{className:"font-semibold text-sm text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:"Data Sources"}),(0,Ca.jsxs)("div",{className:"space-y-3",children:[(0,Ca.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[(0,Ca.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,Ca.jsx)("span",{className:"text-lg",children:"\ud83d\udd0c"}),(0,Ca.jsx)("span",{className:"font-medium text-sm",children:"HIFLD Transmission Lines"})]}),(0,Ca.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"Homeland Infrastructure Foundation-Level Data (HIFLD) via ArcGIS REST API. Updated periodically by DHS."}),(0,Ca.jsx)("a",{href:"https://hifld-geoplatform.opendata.arcgis.com/datasets/transmission-lines",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary-600 hover:underline mt-1 inline-block",children:"View source"})]}),(0,Ca.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-700/50 rounded-lg p-3",children:[(0,Ca.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,Ca.jsx)("span",{className:"text-lg",children:"\u26a1"}),(0,Ca.jsx)("span",{className:"font-medium text-sm",children:"EIA Generator Data"})]}),(0,Ca.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:"US Energy Information Administration operating generator capacity data. Monthly updates."}),(0,Ca.jsx)("a",{href:"https://www.eia.gov/electricity/data/eia860/",target:"_blank",rel:"noopener noreferrer",className:"text-xs text-primary-600 hover:underline mt-1 inline-block",children:"View source"})]})]})]}),(0,Ca.jsx)("section",{children:(0,Ca.jsxs)("div",{className:"text-xs text-gray-400 text-center",children:["Data cached locally with 24-hour expiry.",(0,Ca.jsx)("br",{}),"Last refresh: ",(new Date).toLocaleString()]})})]}),(0,Ca.jsx)("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-700/50",children:(0,Ca.jsxs)("div",{className:"flex gap-2",children:[(0,Ca.jsx)("button",{onClick:()=>{localStorage.removeItem("hifld_transmission_data"),localStorage.removeItem("eia_generator_data"),window.location.reload()},className:"flex-1 px-3 py-2 text-sm bg-gray-200 dark:bg-gray-600 rounded hover:bg-gray-300 dark:hover:bg-gray-500",children:"Clear Cache"}),(0,Ca.jsx)("button",{onClick:t,className:"flex-1 px-3 py-2 text-sm bg-primary-600 text-white rounded hover:bg-primary-700",children:"Close"})]})})]})},Qs={id:"default",name:"New Scenario",planningHorizonYears:25,discountRatePercent:7,carbonPriceDollarsPerTon:50,budgetConstraintMillions:null,renewableTargetPercent:80,reliabilityStandard:"n-1"},Vs=on({name:"candidateSites",initialState:{sites:[],selectedSiteId:null,hoveredSiteId:null,isPlacingMode:!1,scenarioConfig:Qs,optimizationProgress:{iteration:0,totalIterations:100,gap:1,status:"idle"},optimizationResult:null},reducers:{addCandidateSite:(e,t)=>{const r={id:"site-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),name:t.payload.name,type:t.payload.type,coordinates:t.payload.coordinates,maxCapacityMW:t.payload.maxCapacityMW,createdAt:(new Date).toISOString()};e.sites.push(r)},updateCandidateSite:(e,t)=>{const r=e.sites.find(e=>e.id===t.payload.id);r&&Object.assign(r,t.payload.updates)},updateSiteCoordinates:(e,t)=>{const r=e.sites.find(e=>e.id===t.payload.id);r&&(r.coordinates=t.payload.coordinates)},removeCandidateSite:(e,t)=>{e.sites=e.sites.filter(e=>e.id!==t.payload),e.selectedSiteId===t.payload&&(e.selectedSiteId=null)},setSelectedSiteId:(e,t)=>{e.selectedSiteId=t.payload},setHoveredSiteId:(e,t)=>{e.hoveredSiteId=t.payload},setPlacingMode:(e,t)=>{e.isPlacingMode=t.payload},updateScenarioConfig:(e,t)=>{e.scenarioConfig=ot(ot({},e.scenarioConfig),t.payload)},resetScenarioConfig:e=>{e.scenarioConfig=ot(ot({},Qs),{},{id:"scenario-".concat(Date.now())})},setOptimizationProgress:(e,t)=>{e.optimizationProgress=t.payload},setOptimizationResult:(e,t)=>{e.optimizationResult=t.payload},clearAllSites:e=>{e.sites=[],e.selectedSiteId=null,e.hoveredSiteId=null,e.optimizationResult=null},loadScenarioFromUrl:(e,t)=>{e.sites=t.payload.sites,e.scenarioConfig=t.payload.config}}}),{addCandidateSite:Hs,updateCandidateSite:Gs,updateSiteCoordinates:Ks,removeCandidateSite:Ws,setSelectedSiteId:qs,setHoveredSiteId:Zs,setPlacingMode:Xs,updateScenarioConfig:Ys,resetScenarioConfig:Js,setOptimizationProgress:$s,setOptimizationResult:el,clearAllSites:tl,loadScenarioFromUrl:rl}=Vs.actions,nl=Vs.reducer;function il(e,t){return 5e6+(t>=500?75e4:t>=345?5e5:3e5)*e}function ol(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:5;if(!t||0===t.length)return[];const n=t.filter(e=>"substation"===e.type||"generator"===e.type).map(t=>{const r=function(e,t){const r=e.latitude*Math.PI/180,n=t.latitude*Math.PI/180,i=(t.latitude-e.latitude)*Math.PI/180,o=(t.longitude-e.longitude)*Math.PI/180,a=Math.sin(i/2)*Math.sin(i/2)+Math.cos(r)*Math.cos(n)*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a))*6371}(e,t.coordinates);return{node:t,distanceKm:r,estimatedInterconnectionCost:il(r,t.voltage_kv)}});return n.sort((e,t)=>e.distanceKm-t.distanceKm),n.slice(0,r)}function al(e){return e>=1e9?"$".concat((e/1e9).toFixed(2),"B"):e>=1e6?"$".concat((e/1e6).toFixed(1),"M"):e>=1e3?"$".concat((e/1e3).toFixed(0),"K"):"$".concat(e.toFixed(0))}const sl={solar:"\u2600",wind:"\ud83c\udf2c",storage:"\ud83d\udd0b",load:"\u26a1"},ll={solar:"#F59E0B",wind:"#3B82F6",storage:"#8B5CF6",load:"#EF4444"},cl=e=>{let{map:t,buses:r}=e;const i=$e(),{sites:o,selectedSiteId:a,hoveredSiteId:s,isPlacingMode:l}=et(e=>e.candidateSites),c=(0,n.useRef)(new Map),u=(0,n.useRef)(null),[d,h]=(0,n.useState)(null),[A,f]=(0,n.useState)({name:"",type:"solar",maxCapacityMW:100});(0,n.useEffect)(()=>{if(!t||!l)return;const e=e=>{const t={latitude:e.lngLat.lat,longitude:e.lngLat.lng};h(t),f({name:"Site ".concat(o.length+1),type:"solar",maxCapacityMW:100})};return t.on("click",e),t.getCanvas().style.cursor="crosshair",()=>{t.off("click",e),t.getCanvas().style.cursor=""}},[t,l,o.length]),(0,n.useEffect)(()=>{t&&(c.current.forEach((e,t)=>{o.find(e=>e.id===t)||(e.remove(),c.current.delete(t))}),o.forEach(e=>{let r=c.current.get(e.id);if(r){r.setLngLat([e.coordinates.longitude,e.coordinates.latitude]);const t=r.getElement();t.style.background=ll[e.type],t.innerHTML=sl[e.type]}else{const n=document.createElement("div");n.className="candidate-site-marker",n.style.cssText="\n          width: 36px;\n          height: 36px;\n          background: ".concat(ll[e.type],";\n          border: 3px solid white;\n          border-radius: 50%;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          font-size: 18px;\n          cursor: grab;\n          box-shadow: 0 2px 8px rgba(0,0,0,0.3);\n          transition: transform 0.2s, box-shadow 0.2s;\n        "),n.innerHTML=sl[e.type],r=new(Je().Marker)({element:n,draggable:!0}).setLngLat([e.coordinates.longitude,e.coordinates.latitude]).addTo(t),r.on("dragend",()=>{const t=r.getLngLat();i(Ks({id:e.id,coordinates:{latitude:t.lat,longitude:t.lng}}))}),n.addEventListener("click",t=>{t.stopPropagation(),i(qs(e.id))}),n.addEventListener("mouseenter",()=>{i(Zs(e.id)),n.style.transform="scale(1.2)",n.style.boxShadow="0 4px 12px rgba(0,0,0,0.4)"}),n.addEventListener("mouseleave",()=>{i(Zs(null)),n.style.transform="scale(1)",n.style.boxShadow="0 2px 8px rgba(0,0,0,0.3)"}),c.current.set(e.id,r)}}))},[t,o,i]);const p=(0,n.useCallback)(e=>{if(!t||0===r.length)return;const n=ol(e.coordinates,r,5),i="candidate-site-connections";t.getLayer(i)&&t.removeLayer(i),t.getSource(i)&&t.removeSource(i);const o=n.map((t,r)=>({type:"Feature",properties:{distance:t.distanceKm,cost:t.estimatedInterconnectionCost,busName:t.node.name,opacity:1-.15*r},geometry:{type:"LineString",coordinates:[[e.coordinates.longitude,e.coordinates.latitude],[t.node.coordinates.longitude,t.node.coordinates.latitude]]}}));t.addSource(i,{type:"geojson",data:{type:"FeatureCollection",features:o}}),t.addLayer({id:i,type:"line",source:i,paint:{"line-color":ll[e.type],"line-width":2,"line-dasharray":[4,4],"line-opacity":["get","opacity"]}}),u.current=i},[t,r]),m=(0,n.useCallback)(()=>{if(!t||!u.current)return;const e=u.current;t.getLayer(e)&&t.removeLayer(e),t.getSource(e)&&t.removeSource(e),u.current=null},[t]);(0,n.useEffect)(()=>{if(s){const e=o.find(e=>e.id===s);e&&p(e)}else m()},[s,o,p,m]);const g=o.find(e=>e.id===a),y=g?ol(g.coordinates,r,5):[];return(0,n.useEffect)(()=>()=>{c.current.forEach(e=>e.remove()),c.current.clear(),m()},[m]),(0,Ca.jsxs)(Ca.Fragment,{children:[d&&(0,Ca.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 w-96",children:[(0,Ca.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:"Add Candidate Site"}),(0,Ca.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d&&(i(Hs({name:A.name,type:A.type,coordinates:d,maxCapacityMW:A.maxCapacityMW})),h(null),i(Xs(!1)))},className:"space-y-4",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Site Name"}),(0,Ca.jsx)("input",{type:"text",value:A.name,onChange:e=>f(ot(ot({},A),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Type"}),(0,Ca.jsxs)("select",{value:A.type,onChange:e=>f(ot(ot({},A),{},{type:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",children:[(0,Ca.jsxs)("option",{value:"solar",children:[sl.solar," Solar"]}),(0,Ca.jsxs)("option",{value:"wind",children:[sl.wind," Wind"]}),(0,Ca.jsxs)("option",{value:"storage",children:[sl.storage," Storage"]}),(0,Ca.jsxs)("option",{value:"load",children:[sl.load," Load"]})]})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Max Capacity (MW)"}),(0,Ca.jsx)("input",{type:"number",value:A.maxCapacityMW,onChange:e=>f(ot(ot({},A),{},{maxCapacityMW:parseInt(e.target.value)||0})),min:"1",max:"10000",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",required:!0})]}),(0,Ca.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:["Location: ",d.latitude.toFixed(4),","," ",d.longitude.toFixed(4)]}),(0,Ca.jsxs)("div",{className:"flex space-x-3",children:[(0,Ca.jsx)("button",{type:"submit",className:"flex-1 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Add Site"}),(0,Ca.jsx)("button",{type:"button",onClick:()=>{h(null),i(Xs(!1))},className:"flex-1 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Cancel"})]})]})]})}),g&&(0,Ca.jsxs)("div",{className:"fixed bottom-4 left-1/2 transform -translate-x-1/2 bg-white dark:bg-gray-800 rounded-lg shadow-xl p-4 w-96 z-40",children:[(0,Ca.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,Ca.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Ca.jsx)("span",{className:"text-2xl p-2 rounded-full",style:{backgroundColor:ll[g.type]+"20"},children:sl[g.type]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h4",{className:"font-bold text-gray-900 dark:text-white",children:g.name}),(0,Ca.jsx)("p",{className:"text-sm text-gray-500 capitalize",children:g.type})]})]}),(0,Ca.jsx)("button",{onClick:()=>i(qs(null)),className:"text-gray-400 hover:text-gray-600",children:"\xd7"})]}),(0,Ca.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-3 text-sm",children:[(0,Ca.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900 p-2 rounded",children:[(0,Ca.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:"Max Capacity"}),(0,Ca.jsxs)("div",{className:"font-semibold text-gray-900 dark:text-white",children:[g.maxCapacityMW," MW"]})]}),(0,Ca.jsxs)("div",{className:"bg-gray-50 dark:bg-gray-900 p-2 rounded",children:[(0,Ca.jsx)("div",{className:"text-gray-500 dark:text-gray-400",children:"Coordinates"}),(0,Ca.jsxs)("div",{className:"font-semibold text-gray-900 dark:text-white text-xs",children:[g.coordinates.latitude.toFixed(3),","," ",g.coordinates.longitude.toFixed(3)]})]})]}),y.length>0&&(0,Ca.jsxs)("div",{className:"mb-3",children:[(0,Ca.jsx)("h5",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Nearest Substations"}),(0,Ca.jsx)("div",{className:"space-y-1 max-h-32 overflow-y-auto",children:y.map(e=>{return(0,Ca.jsxs)("div",{className:"flex justify-between items-center text-xs bg-gray-50 dark:bg-gray-900 p-2 rounded",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:e.node.name}),(0,Ca.jsxs)("span",{className:"text-gray-500 ml-1",children:["(",e.node.voltage_kv,"kV)"]})]}),(0,Ca.jsxs)("div",{className:"text-right",children:[(0,Ca.jsx)("div",{className:"text-gray-600 dark:text-gray-400",children:(t=e.distanceKm,t<1?"".concat(Math.round(1e3*t)," m"):"".concat(t.toFixed(1)," km"))}),(0,Ca.jsx)("div",{className:"text-gray-500",children:al(e.estimatedInterconnectionCost)})]})]},e.node.id);var t})})]}),(0,Ca.jsx)("button",{onClick:()=>i(Ws(g.id)),className:"w-full py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm",children:"Remove Site"})]})]})};Je().accessToken="pk.eyJ1IjoiYWdyYWJvd3MiLCJhIjoiY205MXBkaTEyMDNobjJzcHdyNjczOHY1ZiJ9.YUk31iaej90fE7REWALCLQ";const ul=()=>{const e=(0,n.useRef)(null),t=(0,n.useRef)(null),r=$e(),i=et(e=>e.map.viewState),o=et(e=>e.map.layers),a=et(e=>e.map.minVoltage),s=et(e=>e.map.visibleFuelTypes),l=et(e=>e.projects.projects),c=et(e=>e.optimization.results),[u,d]=(0,n.useState)(!1),[h,A]=(0,n.useState)(!1),f=(0,n.useCallback)(e=>{r(Jn({transmissionLines:e.totalLines,loading:e.loading}))},[r]),p=(0,n.useCallback)(e=>{r(Jn({generators:e.totalGenerators,totalCapacityMW:e.totalCapacityMW,loading:e.loading}))},[r]);return(0,n.useEffect)(()=>{if(!e.current||t.current)return;const n=new(Je().Map)({container:e.current,style:o.satellite?"mapbox://styles/mapbox/satellite-streets-v12":o.terrain?"mapbox://styles/mapbox/outdoors-v12":"mapbox://styles/mapbox/light-v11",center:[i.longitude,i.latitude],zoom:i.zoom,pitch:i.pitch||0,bearing:i.bearing||0,interactive:!0,dragPan:!0,dragRotate:!0,scrollZoom:!0,touchZoomRotate:!0,doubleClickZoom:!0});return n.addControl(new(Je().NavigationControl),"top-right"),n.addControl(new(Je().ScaleControl)({maxWidth:100,unit:"imperial"}),"bottom-left"),n.addControl(new(Je().FullscreenControl),"top-right"),n.on("load",()=>{d(!0),r(Hn(n))}),n.on("moveend",()=>{const e=n.getCenter(),t=n.getZoom(),i=n.getPitch(),o=n.getBearing();r(jn({longitude:e.lng,latitude:e.lat,zoom:t,pitch:i,bearing:o}))}),t.current=n,()=>{t.current&&(t.current.remove(),t.current=null,r(Hn(null)))}},[]),(0,n.useEffect)(()=>{if(!t.current)return;const e=o.satellite?"mapbox://styles/mapbox/satellite-streets-v12":o.terrain?"mapbox://styles/mapbox/outdoors-v12":"mapbox://styles/mapbox/light-v11";t.current.setStyle(e)},[o.satellite,o.terrain]),(0,Ca.jsxs)("div",{className:"relative w-full h-full",children:[(0,Ca.jsx)("div",{ref:e,className:"w-full h-full",style:{cursor:"grab"}}),u&&(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)(As,{}),o.hifldTransmission&&(0,Ca.jsx)(zs,{map:t.current,visible:o.hifldTransmission,minVoltage:a,onStatsUpdate:f}),o.generators&&(0,Ca.jsx)(Ns,{map:t.current,visible:o.generators,visibleFuelTypes:s,onStatsUpdate:p}),o.transmission&&(0,Ca.jsx)(Ss,{map:t.current}),o.grid&&(0,Ca.jsx)(is,{map:t.current}),o.projects&&l.map(e=>(0,Ca.jsx)(Xa,{project:e,map:t.current},e.id)),(null===c||void 0===c?void 0:c.optimal_locations)&&(0,Ca.jsx)(ms,{locations:c.optimal_locations,map:t.current,visible:!1!==o.optimalLocations}),(null===c||void 0===c?void 0:c.transmission_upgrades)&&(0,Ca.jsx)(gs,{upgrades:c.transmission_upgrades,map:t.current,visible:!1!==o.transmissionUpgrades}),(0,Ca.jsxs)("button",{onClick:()=>A(!h),className:"absolute bottom-4 right-4 bg-white dark:bg-gray-800 rounded-lg shadow-lg px-4 py-2 flex items-center gap-2 hover:bg-gray-50 dark:hover:bg-gray-700 z-10",children:[(0,Ca.jsx)("span",{children:"\ud83d\udcca"}),(0,Ca.jsx)("span",{className:"text-sm font-medium",children:"Data Panel"})]}),h&&(0,Ca.jsx)(js,{onClose:()=>A(!1)}),(0,Ca.jsx)(cl,{map:t.current,buses:Ya})]}),!u&&(0,Ca.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-900",children:(0,Ca.jsxs)("div",{className:"text-center",children:[(0,Ca.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),(0,Ca.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading map..."})]})})]})},dl=e=>{switch(e){case ei.SOLAR:return"\u2600\ufe0f";case ei.WIND:return"\ud83d\udca8";case ei.STORAGE:return"\u26a1";case ei.DATACENTER:return"\ud83c\udfe2";default:return"\ud83d\udccd"}},hl=e=>{switch(e){case ei.SOLAR:return"border-accent-500 bg-accent-50 dark:bg-accent-900/20";case ei.WIND:return"border-secondary-500 bg-secondary-50 dark:bg-secondary-900/20";case ei.STORAGE:return"border-purple-500 bg-purple-50 dark:bg-purple-900/20";case ei.DATACENTER:return"border-primary-500 bg-primary-50 dark:bg-primary-900/20";default:return"border-gray-500 bg-gray-50 dark:bg-gray-900/20"}},Al=e=>{let{project:t,onSelect:r,onDelete:n}=e;return(0,Ca.jsxs)("div",{onClick:r,className:"p-4 rounded-lg border-2 cursor-pointer transition-all hover:shadow-lg ".concat(hl(t.type)),children:[(0,Ca.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,Ca.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ca.jsx)("span",{className:"text-2xl",children:dl(t.type)}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:t.name}),(0,Ca.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 capitalize",children:t.type})]})]}),(0,Ca.jsx)("button",{onClick:e=>{e.stopPropagation(),n()},className:"text-gray-400 hover:text-red-600 transition-colors",title:"Delete project",children:(0,Ca.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),(0,Ca.jsxs)("div",{className:"space-y-1 text-sm",children:[(0,Ca.jsxs)("div",{className:"flex justify-between",children:[(0,Ca.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Capacity:"}),(0,Ca.jsxs)("span",{className:"font-semibold text-gray-900 dark:text-white",children:[t.capacity_mw," MW"]})]}),(0,Ca.jsxs)("div",{className:"flex justify-between",children:[(0,Ca.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Location:"}),(0,Ca.jsxs)("span",{className:"font-mono text-xs text-gray-900 dark:text-white",children:[t.coordinates.latitude.toFixed(2),", ",t.coordinates.longitude.toFixed(2)]})]}),t.status&&(0,Ca.jsxs)("div",{className:"flex justify-between",children:[(0,Ca.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Status:"}),(0,Ca.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-medium ".concat("active"===t.status?"bg-green-100 text-green-800 dark:bg-green-900/30 dark:text-green-400":"optimized"===t.status?"bg-blue-100 text-blue-800 dark:bg-blue-900/30 dark:text-blue-400":"bg-gray-100 text-gray-800 dark:bg-gray-900/30 dark:text-gray-400"),children:t.status})]})]})]})},fl=e=>{let{onClose:t,initialCoordinates:r}=e;const i=$e(),[o,a]=(0,n.useState)({name:"",type:ei.SOLAR,latitude:(null===r||void 0===r?void 0:r.latitude)||39,longitude:(null===r||void 0===r?void 0:r.longitude)||-114,capacity_mw:100,capex_per_mw:1e6,opex_per_mw:2e4}),[s,l]=(0,n.useState)(!1),[c,u]=(0,n.useState)(null),d=(e,t)=>{a(r=>ot(ot({},r),{},{[e]:t}))};return(0,Ca.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[(0,Ca.jsxs)("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:[(0,Ca.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"New Project"}),(0,Ca.jsx)("button",{onClick:t,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-200",children:(0,Ca.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,Ca.jsxs)("form",{onSubmit:async e=>{e.preventDefault(),l(!0),u(null);try{const e={name:o.name,type:o.type,capacity_mw:o.capacity_mw,location:{lat:o.latitude,lon:o.longitude},parameters:{capex:o.capex_per_mw*o.capacity_mw,opex:o.opex_per_mw*o.capacity_mw},status:"proposed"};await i(za(e)).unwrap(),t()}catch(r){u(r.message||"Failed to create project")}finally{l(!1)}},className:"p-6 space-y-6",children:[c&&(0,Ca.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 text-red-800 dark:text-red-200",children:c}),(0,Ca.jsxs)("div",{className:"space-y-4",children:[(0,Ca.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Basic Information"}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Project Name"}),(0,Ca.jsx)("input",{type:"text",value:o.name,onChange:e=>d("name",e.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white",placeholder:"e.g., Mojave Solar Farm"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Project Type"}),(0,Ca.jsxs)("select",{value:o.type,onChange:e=>d("type",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white",children:[(0,Ca.jsx)("option",{value:ei.SOLAR,children:"Solar"}),(0,Ca.jsx)("option",{value:ei.WIND,children:"Wind"}),(0,Ca.jsx)("option",{value:ei.STORAGE,children:"Storage"}),(0,Ca.jsx)("option",{value:ei.DATACENTER,children:"Data Center"})]})]})]}),(0,Ca.jsxs)("div",{className:"space-y-4",children:[(0,Ca.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Location"}),(0,Ca.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Latitude"}),(0,Ca.jsx)("input",{type:"number",step:"0.0001",value:o.latitude,onChange:e=>d("latitude",parseFloat(e.target.value)),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Longitude"}),(0,Ca.jsx)("input",{type:"number",step:"0.0001",value:o.longitude,onChange:e=>d("longitude",parseFloat(e.target.value)),required:!0,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]})]}),(0,Ca.jsxs)("div",{className:"space-y-4",children:[(0,Ca.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:"Technical Specifications"}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Capacity (MW)"}),(0,Ca.jsx)("input",{type:"number",step:"0.1",value:o.capacity_mw,onChange:e=>d("capacity_mw",parseFloat(e.target.value)),required:!0,min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"CAPEX per MW ($)"}),(0,Ca.jsx)("input",{type:"number",step:"1000",value:o.capex_per_mw,onChange:e=>d("capex_per_mw",parseFloat(e.target.value)),required:!0,min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"OPEX per MW ($/year)"}),(0,Ca.jsx)("input",{type:"number",step:"1000",value:o.opex_per_mw,onChange:e=>d("opex_per_mw",parseFloat(e.target.value)),required:!0,min:"0",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"})]})]}),(0,Ca.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,Ca.jsx)("button",{type:"button",onClick:t,className:"px-4 py-2 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Cancel"}),(0,Ca.jsxs)("button",{type:"submit",disabled:s,className:"px-6 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2",children:[s&&(0,Ca.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,Ca.jsx)("span",{children:s?"Creating...":"Create Project"})]})]})]})]})})},pl=()=>{const e=$e(),{projects:t,isLoading:r,error:i}=et(e=>e.projects),[o,a]=(0,n.useState)(!1),[s,l]=(0,n.useState)("all"),[c,u]=(0,n.useState)("");(0,n.useEffect)(()=>{e(Ua())},[e]);const d=(t||[]).filter(e=>{const t="all"===s||e.type===s,r=""===c||e.name.toLowerCase().includes(c.toLowerCase());return t&&r});return(0,Ca.jsxs)("div",{className:"flex flex-col h-full bg-white dark:bg-gray-800",children:[(0,Ca.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700",children:[(0,Ca.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,Ca.jsx)("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"Projects"}),(0,Ca.jsxs)("button",{onClick:()=>a(!0),className:"px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors flex items-center space-x-2",children:[(0,Ca.jsx)("span",{children:"+"}),(0,Ca.jsx)("span",{children:"New Project"})]})]}),(0,Ca.jsx)("input",{type:"text",placeholder:"Search projects...",value:c,onChange:e=>u(e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent dark:bg-gray-700 dark:text-white"}),(0,Ca.jsx)("div",{className:"flex space-x-2 mt-3 overflow-x-auto pb-2",children:["all","solar","wind","storage","datacenter"].map(e=>(0,Ca.jsx)("button",{onClick:()=>l(e),className:"px-3 py-1 rounded-full text-xs font-medium whitespace-nowrap transition-colors ".concat(s===e?"bg-primary-600 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"),children:"all"===e?"All":e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,Ca.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:[r&&(0,Ca.jsx)("div",{className:"flex items-center justify-center py-8",children:(0,Ca.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"})}),i&&(0,Ca.jsx)("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 text-red-800 dark:text-red-200",children:i}),!r&&!i&&0===d.length&&(0,Ca.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:0===(t||[]).length?(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("p",{className:"mb-2",children:"No projects yet"}),(0,Ca.jsx)("p",{className:"text-sm",children:'Click "New Project" to get started'})]}):(0,Ca.jsx)("p",{children:"No projects match your filters"})}),!r&&!i&&d.map(t=>(0,Ca.jsx)(Al,{project:t,onSelect:()=>e(Ha(t)),onDelete:()=>(async t=>{window.confirm("Are you sure you want to delete this project?")&&await e(ja(t))})(t.id)},t.id))]}),(0,Ca.jsx)("div",{className:"p-4 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900",children:(0,Ca.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("div",{className:"text-2xl font-bold text-primary-600",children:d.length}),(0,Ca.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Projects"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("div",{className:"text-2xl font-bold text-secondary-600",children:d.reduce((e,t)=>e+t.capacity_mw,0).toFixed(0)}),(0,Ca.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Total MW"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("div",{className:"text-2xl font-bold text-accent-600",children:new Set(d.map(e=>e.type)).size}),(0,Ca.jsx)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Types"})]})]})}),o&&(0,Ca.jsx)(fl,{onClose:()=>a(!1)})]})},ml={async createOptimizationJob(e){try{return(await ka.post("/api/v1/optimization/jobs",e)).data}catch(t){throw new Error(Ma(t))}},async getOptimizationJobs(e){try{return(await ka.get("/api/v1/optimization/jobs",{params:e})).data}catch(t){throw new Error(Ma(t))}},async getOptimizationJob(e){try{return(await ka.get("/api/v1/optimization/jobs/".concat(e))).data}catch(t){throw new Error(Ma(t))}},async getJobStatus(e){try{return(await ka.get("/api/v1/optimization/jobs/".concat(e,"/status"))).data}catch(t){throw new Error(Ma(t))}},async getJobResults(e){try{return(await ka.get("/api/v1/optimization/jobs/".concat(e,"/results"))).data}catch(t){throw new Error(Ma(t))}},async cancelJob(e){try{await ka.post("/api/v1/optimization/jobs/".concat(e,"/cancel"))}catch(t){throw new Error(Ma(t))}},async deleteJob(e){try{await ka.delete("/api/v1/optimization/jobs/".concat(e))}catch(t){throw new Error(Ma(t))}},async runQuickOptimization(e){try{return(await ka.post("/api/v1/optimization/quick",{project_ids:e,mode:"evaluate"})).data}catch(t){throw new Error(Ma(t))}},async runGreenfieldOptimization(){try{return(await ka.post("/api/v1/optimization/quick",{project_ids:[],mode:"greenfield"})).data}catch(e){throw new Error(Ma(e))}}},gl=ml,yl=Jr("optimization/createJob",async e=>await gl.createOptimizationJob(e)),_l=Jr("optimization/fetchJobs",async e=>await gl.getOptimizationJobs(e)),vl=Jr("optimization/fetchJob",async e=>await gl.getOptimizationJob(e)),xl=Jr("optimization/fetchJobStatus",async e=>ot({id:e},await gl.getJobStatus(e))),wl=Jr("optimization/fetchJobResults",async e=>await gl.getJobResults(e)),bl=Jr("optimization/cancelJob",async e=>(await gl.cancelJob(e),e)),Bl=Jr("optimization/runQuick",async e=>await gl.runQuickOptimization(e)),Cl=Jr("optimization/runGreenfield",async()=>await gl.runGreenfieldOptimization()),El=on({name:"optimization",initialState:{jobs:[],currentJob:null,results:null,isLoading:!1,error:null,isRunning:!1},reducers:{setCurrentJob:(e,t)=>{var r;e.currentJob=t.payload,e.isRunning="running"===(null===(r=t.payload)||void 0===r?void 0:r.status)},clearResults:e=>{e.results=null},clearError:e=>{e.error=null},updateJobProgress:(e,t)=>{var r;const n=e.jobs.find(e=>e.id===t.payload.id);n&&(n.progress_percentage=t.payload.progress),(null===(r=e.currentJob)||void 0===r?void 0:r.id)===t.payload.id&&(e.currentJob.progress_percentage=t.payload.progress)}},extraReducers:e=>{e.addCase(yl.pending,e=>{e.isLoading=!0,e.error=null}).addCase(yl.fulfilled,(e,t)=>{e.isLoading=!1,e.jobs.unshift(t.payload),e.currentJob=t.payload,e.isRunning="running"===t.payload.status}).addCase(yl.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to create optimization job"}),e.addCase(_l.pending,e=>{e.isLoading=!0,e.error=null}).addCase(_l.fulfilled,(e,t)=>{e.isLoading=!1,e.jobs=t.payload}).addCase(_l.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to fetch optimization jobs"}),e.addCase(vl.pending,e=>{e.isLoading=!0,e.error=null}).addCase(vl.fulfilled,(e,t)=>{e.isLoading=!1,e.currentJob=t.payload,e.isRunning="running"===t.payload.status}).addCase(vl.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to fetch optimization job"}),e.addCase(xl.fulfilled,(e,t)=>{var r;const n=e.jobs.find(e=>e.id===t.payload.id);n&&(n.status=t.payload.status,n.progress_percentage=t.payload.progress_percentage),(null===(r=e.currentJob)||void 0===r?void 0:r.id)===t.payload.id&&(e.currentJob.status=t.payload.status,e.currentJob.progress_percentage=t.payload.progress_percentage,e.isRunning="running"===t.payload.status)}),e.addCase(wl.pending,e=>{e.isLoading=!0,e.error=null}).addCase(wl.fulfilled,(e,t)=>{e.isLoading=!1,e.results=t.payload}).addCase(wl.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to fetch job results"}),e.addCase(bl.fulfilled,(e,t)=>{var r;const n=e.jobs.find(e=>e.id===t.payload);n&&(n.status="cancelled"),(null===(r=e.currentJob)||void 0===r?void 0:r.id)===t.payload&&(e.currentJob.status="cancelled",e.isRunning=!1)}),e.addCase(Bl.pending,e=>{e.isLoading=!0,e.error=null}).addCase(Bl.fulfilled,(e,t)=>{e.isLoading=!1,e.jobs.unshift(t.payload),e.currentJob=t.payload,e.results=t.payload.results||null,e.isRunning="running"===t.payload.status}).addCase(Bl.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to run optimization"}),e.addCase(Cl.pending,e=>{e.isLoading=!0,e.error=null}).addCase(Cl.fulfilled,(e,t)=>{e.isLoading=!1,e.jobs.unshift(t.payload),e.currentJob=t.payload,e.results=t.payload.results||null,e.isRunning="running"===t.payload.status}).addCase(Cl.rejected,(e,t)=>{e.isLoading=!1,e.error=t.error.message||"Failed to run greenfield optimization"})}}),{setCurrentJob:Sl,clearResults:Tl,clearError:Il,updateJobProgress:Fl}=El.actions,kl=El.reducer,Pl=()=>{const e=$e(),t=et(e=>e.projects.projects),{isRunning:r,currentJob:i,isLoading:o}=et(e=>e.optimization),[a,s]=(0,n.useState)(!1),[l,c]=(0,n.useState)([]),[u,d]=(0,n.useState)({name:"Optimization Run",objective:"minimize_cost",time_horizon_years:25,discount_rate:.07});return(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,Ca.jsx)("div",{className:"p-4 bg-gradient-to-r from-primary-600 to-secondary-600",children:(0,Ca.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ca.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center space-x-2",children:[(0,Ca.jsx)("span",{children:"\ud83c\udfaf"}),(0,Ca.jsx)("span",{children:"Optimization"})]}),r&&i&&(0,Ca.jsxs)("span",{className:"px-3 py-1 bg-white/20 text-white text-sm rounded-full flex items-center space-x-2",children:[(0,Ca.jsx)("div",{className:"animate-spin rounded-full h-3 w-3 border-b-2 border-white"}),(0,Ca.jsx)("span",{children:"Running"})]})]})}),(0,Ca.jsxs)("div",{className:"p-4 space-y-4",children:[(0,Ca.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 p-4 rounded-lg border border-green-200 dark:border-green-800",children:[(0,Ca.jsxs)("h3",{className:"font-semibold text-green-700 dark:text-green-400 mb-2 flex items-center gap-2",children:[(0,Ca.jsx)("span",{children:"\ud83c\udf0d"}),"Find Optimal Locations"]}),(0,Ca.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:"Let CANOPI analyze the grid and recommend the best locations for new renewable projects."}),(0,Ca.jsxs)("button",{onClick:async()=>{await e(Cl())},disabled:r||o,className:"w-full py-3 bg-gradient-to-r from-green-600 to-emerald-600 text-white font-semibold rounded-lg hover:from-green-700 hover:to-emerald-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[(0,Ca.jsx)("span",{children:"\ud83d\udd0d"}),(0,Ca.jsx)("span",{children:"Run Greenfield Optimization"})]})]}),(0,Ca.jsxs)("div",{className:"relative",children:[(0,Ca.jsx)("div",{className:"absolute inset-0 flex items-center",children:(0,Ca.jsx)("div",{className:"w-full border-t border-gray-200 dark:border-gray-700"})}),(0,Ca.jsx)("div",{className:"relative flex justify-center text-sm",children:(0,Ca.jsx)("span",{className:"px-2 bg-white dark:bg-gray-800 text-gray-500",children:"or evaluate specific sites"})})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,Ca.jsx)("label",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:"Select Projects to Evaluate"}),(0,Ca.jsxs)("div",{className:"flex space-x-2 text-xs",children:[(0,Ca.jsx)("button",{onClick:()=>{c(t.map(e=>e.id))},className:"text-primary-600 hover:text-primary-700 dark:text-primary-400",children:"Select All"}),(0,Ca.jsx)("span",{className:"text-gray-400",children:"|"}),(0,Ca.jsx)("button",{onClick:()=>{c([])},className:"text-gray-600 hover:text-gray-700 dark:text-gray-400",children:"Clear"})]})]}),(0,Ca.jsx)("div",{className:"max-h-48 overflow-y-auto space-y-2 p-3 bg-gray-50 dark:bg-gray-900 rounded-lg",children:0===(t||[]).length?(0,Ca.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400 text-center py-4",children:"No projects available. Create projects first."}):(t||[]).map(e=>(0,Ca.jsxs)("label",{className:"flex items-center space-x-3 cursor-pointer hover:bg-white dark:hover:bg-gray-800 p-2 rounded transition-colors",children:[(0,Ca.jsx)("input",{type:"checkbox",checked:l.includes(e.id),onChange:()=>{return t=e.id,void c(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t]);var t},className:"w-4 h-4 text-primary-600 rounded focus:ring-2 focus:ring-primary-500"}),(0,Ca.jsxs)("div",{className:"flex-1",children:[(0,Ca.jsx)("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.name}),(0,Ca.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[e.type," - ",e.capacity_mw," MW"]})]})]},e.id))}),(0,Ca.jsxs)("div",{className:"mt-2 text-xs text-gray-600 dark:text-gray-400",children:[l.length," of ",(t||[]).length," selected"]})]}),(0,Ca.jsxs)("button",{onClick:async()=>{0!==l.length?await e(Bl(l)):alert("Please select at least one project")},disabled:r||o||0===l.length,className:"w-full py-3 bg-gradient-to-r from-primary-600 to-secondary-600 text-white font-semibold rounded-lg hover:from-primary-700 hover:to-secondary-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2",children:[(0,Ca.jsx)("span",{children:"\ud83d\ude80"}),(0,Ca.jsx)("span",{children:"Run Quick Optimization"})]}),(0,Ca.jsxs)("button",{onClick:()=>s(!a),className:"w-full py-2 text-sm text-primary-600 dark:text-primary-400 hover:bg-primary-50 dark:hover:bg-primary-900/20 rounded transition-colors flex items-center justify-center space-x-2",children:[(0,Ca.jsxs)("span",{children:[a?"Hide":"Show"," Advanced Settings"]}),(0,Ca.jsx)("svg",{className:"w-4 h-4 transition-transform ".concat(a?"rotate-180":""),fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),a&&(0,Ca.jsxs)("div",{className:"space-y-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Optimization Name"}),(0,Ca.jsx)("input",{type:"text",value:u.name,onChange:e=>d(ot(ot({},u),{},{name:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-white"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Objective"}),(0,Ca.jsxs)("select",{value:u.objective,onChange:e=>d(ot(ot({},u),{},{objective:e.target.value})),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-white",children:[(0,Ca.jsx)("option",{value:"minimize_cost",children:"Minimize Cost"}),(0,Ca.jsx)("option",{value:"maximize_renewable",children:"Maximize Renewable %"}),(0,Ca.jsx)("option",{value:"minimize_emissions",children:"Minimize Emissions"})]})]}),(0,Ca.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Time Horizon (years)"}),(0,Ca.jsx)("input",{type:"number",value:u.time_horizon_years,onChange:e=>d(ot(ot({},u),{},{time_horizon_years:parseInt(e.target.value)})),min:"1",max:"50",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-white"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Discount Rate"}),(0,Ca.jsx)("input",{type:"number",step:"0.01",value:u.discount_rate,onChange:e=>d(ot(ot({},u),{},{discount_rate:parseFloat(e.target.value)})),min:"0",max:"1",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-white"})]})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Max Budget ($M)"}),(0,Ca.jsx)("input",{type:"number",step:"1",value:u.max_budget||"",onChange:e=>d(ot(ot({},u),{},{max_budget:e.target.value?parseFloat(e.target.value):void 0})),placeholder:"No limit",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-white"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Min Renewable % (0-100)"}),(0,Ca.jsx)("input",{type:"number",step:"1",value:u.min_renewable_percentage||"",onChange:e=>d(ot(ot({},u),{},{min_renewable_percentage:e.target.value?parseFloat(e.target.value):void 0})),min:"0",max:"100",placeholder:"No minimum",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary-500 dark:bg-gray-700 dark:text-white"})]}),(0,Ca.jsx)("button",{onClick:async()=>{0!==l.length?await e(yl({name:u.name,config:{objective:u.objective,constraints:{max_budget:u.max_budget,min_renewable_percentage:u.min_renewable_percentage},time_horizon_years:u.time_horizon_years,discount_rate:u.discount_rate},project_ids:l})):alert("Please select at least one project")},disabled:r||o||0===l.length,className:"w-full py-3 bg-primary-600 text-white font-semibold rounded-lg hover:bg-primary-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Run Advanced Optimization"})]})]})]})},Ml=()=>{const{currentJob:e,isRunning:t}=et(e=>e.optimization),r=null===e||void 0===e?void 0:e.results;return e||r?t&&!r?(0,Ca.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:(0,Ca.jsxs)("div",{className:"text-center py-12",children:[(0,Ca.jsx)("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-primary-600 mx-auto mb-4"}),(0,Ca.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Optimization Running"}),(0,Ca.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"This may take a few minutes..."}),void 0!==(null===e||void 0===e?void 0:e.progress_percentage)&&(0,Ca.jsxs)("div",{className:"mt-4",children:[(0,Ca.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:(0,Ca.jsx)("div",{className:"bg-primary-600 h-2 rounded-full transition-all duration-500",style:{width:"".concat(e.progress_percentage,"%")}})}),(0,Ca.jsxs)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2",children:[e.progress_percentage,"% complete"]})]})]})}):r?(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,Ca.jsxs)("div",{className:"p-4 bg-gradient-to-r from-green-600 to-emerald-600",children:[(0,Ca.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ca.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center space-x-2",children:[(0,Ca.jsx)("span",{children:"\ud83d\udcca"}),(0,Ca.jsx)("span",{children:"Optimization Results"})]}),(0,Ca.jsx)("span",{className:"px-3 py-1 bg-white/20 text-white text-sm rounded-full",children:"Completed"})]}),e&&(0,Ca.jsx)("p",{className:"text-sm text-white/80 mt-1",children:e.name})]}),(0,Ca.jsxs)("div",{className:"p-6 space-y-6",children:[(0,Ca.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Ca.jsxs)("div",{className:"bg-gradient-to-br from-primary-50 to-primary-100 dark:from-primary-900/20 dark:to-primary-800/20 p-4 rounded-lg border border-primary-200 dark:border-primary-800",children:[(0,Ca.jsx)("div",{className:"text-sm text-primary-600 dark:text-primary-400 font-medium mb-1",children:"Total Cost"}),(0,Ca.jsxs)("div",{className:"text-2xl font-bold text-primary-900 dark:text-primary-100",children:["$",(r.total_cost/1e6).toFixed(1),"M"]})]}),(0,Ca.jsxs)("div",{className:"bg-gradient-to-br from-secondary-50 to-secondary-100 dark:from-secondary-900/20 dark:to-secondary-800/20 p-4 rounded-lg border border-secondary-200 dark:border-secondary-800",children:[(0,Ca.jsx)("div",{className:"text-sm text-secondary-600 dark:text-secondary-400 font-medium mb-1",children:"Total Capacity"}),(0,Ca.jsxs)("div",{className:"text-2xl font-bold text-secondary-900 dark:text-secondary-100",children:[r.total_capacity_mw.toFixed(0)," MW"]})]}),(0,Ca.jsxs)("div",{className:"bg-gradient-to-br from-accent-50 to-accent-100 dark:from-accent-900/20 dark:to-accent-800/20 p-4 rounded-lg border border-accent-200 dark:border-accent-800",children:[(0,Ca.jsx)("div",{className:"text-sm text-accent-600 dark:text-accent-400 font-medium mb-1",children:"Renewable %"}),(0,Ca.jsxs)("div",{className:"text-2xl font-bold text-accent-900 dark:text-accent-100",children:[r.renewable_percentage.toFixed(1),"%"]})]}),(0,Ca.jsxs)("div",{className:"bg-gradient-to-br from-green-50 to-green-100 dark:from-green-900/20 dark:to-green-800/20 p-4 rounded-lg border border-green-200 dark:border-green-800",children:[(0,Ca.jsx)("div",{className:"text-sm text-green-600 dark:text-green-400 font-medium mb-1",children:"LCOE"}),(0,Ca.jsxs)("div",{className:"text-2xl font-bold text-green-900 dark:text-green-100",children:["$",r.lcoe.toFixed(2),"/MWh"]})]})]}),(0,Ca.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,Ca.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[(0,Ca.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Emissions"}),(0,Ca.jsxs)("div",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[(r.emissions_tons_co2/1e3).toFixed(1),"k tons CO2"]})]}),(0,Ca.jsxs)("div",{className:"p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[(0,Ca.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-1",children:"Capacity Factor"}),(0,Ca.jsxs)("div",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:[(100*r.capacity_factor).toFixed(1),"%"]})]})]}),r.optimal_locations&&r.optimal_locations.length>0&&(0,Ca.jsxs)("div",{children:[(0,Ca.jsxs)("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[(0,Ca.jsx)("span",{className:"text-green-500",children:"\ud83d\udccd"}),"Recommended Project Locations",(0,Ca.jsxs)("span",{className:"text-xs bg-green-100 dark:bg-green-900 text-green-700 dark:text-green-300 px-2 py-0.5 rounded-full",children:[r.optimal_locations.length," sites"]})]}),(0,Ca.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.optimal_locations.map((e,t)=>(0,Ca.jsxs)("div",{className:"p-3 bg-gradient-to-r from-green-50 to-emerald-50 dark:from-green-900/20 dark:to-emerald-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[(0,Ca.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,Ca.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Ca.jsx)("span",{className:"text-xl",children:"solar"===e.type?"\ud83c\udf1e":"wind"===e.type?"\ud83c\udf2c\ufe0f":"\ud83d\udd0b"}),(0,Ca.jsxs)("div",{className:"font-medium text-gray-900 dark:text-white capitalize",children:[e.type," Project"]})]}),(0,Ca.jsxs)("div",{className:"text-sm font-bold text-green-600 dark:text-green-400",children:[e.capacity_mw.toFixed(0)," MW"]})]}),(0,Ca.jsxs)("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Capacity Factor:"}),(0,Ca.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.capacity_factor?"".concat((100*e.capacity_factor).toFixed(0),"%"):"N/A"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"LCOE:"}),(0,Ca.jsx)("div",{className:"font-medium text-gray-900 dark:text-white",children:e.lcoe?"$".concat(e.lcoe.toFixed(2),"/MWh"):"N/A"})]})]}),(0,Ca.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400 mt-2 italic",children:e.rationale})]},t))})]}),r.transmission_upgrades&&r.transmission_upgrades.length>0&&(0,Ca.jsxs)("div",{children:[(0,Ca.jsxs)("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3 flex items-center gap-2",children:[(0,Ca.jsx)("span",{className:"text-emerald-500",children:"\u26a1"}),"Recommended Transmission Upgrades",(0,Ca.jsxs)("span",{className:"text-xs bg-emerald-100 dark:bg-emerald-900 text-emerald-700 dark:text-emerald-300 px-2 py-0.5 rounded-full",children:[r.transmission_upgrades.length," corridors"]})]}),(0,Ca.jsx)("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:r.transmission_upgrades.map((e,t)=>(0,Ca.jsxs)("div",{className:"p-3 bg-gradient-to-r from-emerald-50 to-teal-50 dark:from-emerald-900/20 dark:to-teal-900/20 rounded-lg border border-emerald-200 dark:border-emerald-800",children:[(0,Ca.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,Ca.jsxs)("div",{className:"font-medium text-gray-900 dark:text-white text-sm",children:[e.from_node," \u2192 ",e.to_node]}),(0,Ca.jsxs)("div",{className:"text-sm font-bold text-emerald-600 dark:text-emerald-400",children:["+",e.capacity_add_mw.toFixed(0)," MW"]})]}),(0,Ca.jsxs)("div",{className:"text-xs text-gray-600 dark:text-gray-400",children:["Est. Cost: $",(e.estimated_cost/1e6).toFixed(0),"M"]}),(0,Ca.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-500 mt-1 italic",children:e.rationale})]},t))})]}),r.optimal_configurations&&r.optimal_configurations.length>0&&(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white mb-3",children:"Optimal Project Configurations"}),(0,Ca.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:r.optimal_configurations.map((e,t)=>(0,Ca.jsxs)("div",{className:"p-3 bg-gray-50 dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700",children:[(0,Ca.jsxs)("div",{className:"flex justify-between items-start mb-2",children:[(0,Ca.jsxs)("div",{className:"font-medium text-gray-900 dark:text-white",children:["Project ",t+1]}),(0,Ca.jsxs)("div",{className:"text-sm font-semibold text-primary-600 dark:text-primary-400",children:[e.recommended_capacity_mw.toFixed(0)," MW"]})]}),(0,Ca.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Generation:"}),(0,Ca.jsxs)("div",{className:"font-medium text-gray-900 dark:text-white",children:[(e.annual_generation_mwh/1e3).toFixed(0),"k MWh/yr"]})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"CF:"}),(0,Ca.jsxs)("div",{className:"font-medium text-gray-900 dark:text-white",children:[(100*e.capacity_factor).toFixed(1),"%"]})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"NPV:"}),(0,Ca.jsxs)("div",{className:"font-medium text-gray-900 dark:text-white",children:["$",(e.npv/1e6).toFixed(1),"M"]})]})]})]},e.project_id))})]}),(0,Ca.jsxs)("div",{className:"flex space-x-3 pt-4 border-t border-gray-200 dark:border-gray-700",children:[(0,Ca.jsx)("button",{className:"flex-1 px-4 py-2 bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:"Export Results"}),(0,Ca.jsx)("button",{className:"flex-1 px-4 py-2 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:"Save Scenario"})]})]})]}):null:(0,Ca.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6",children:(0,Ca.jsxs)("div",{className:"text-center py-12",children:[(0,Ca.jsx)("div",{className:"text-6xl mb-4",children:"\ud83d\udcca"}),(0,Ca.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"No Results Yet"}),(0,Ca.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Run an optimization to see results here"})]})})},Ol=()=>{var e;const t=$e(),{currentJob:r,isRunning:i}=et(e=>e.optimization),[o,a]=(0,n.useState)(0);if((0,n.useEffect)(()=>{if(!i||!r)return;const e=setInterval(()=>{t(xl(r.id))},2e3);return()=>clearInterval(e)},[i,r,t]),(0,n.useEffect)(()=>{if(!i)return void a(0);const e=Date.now(),t=setInterval(()=>{a(Math.floor((Date.now()-e)/1e3))},1e3);return()=>clearInterval(t)},[i]),!i||!r)return null;return(0,Ca.jsx)("div",{className:"fixed bottom-4 right-4 z-50 max-w-sm",children:(0,Ca.jsx)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-2xl border border-gray-200 dark:border-gray-700 overflow-hidden",children:(0,Ca.jsxs)("div",{className:"p-4",children:[(0,Ca.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,Ca.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ca.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-primary-600"}),(0,Ca.jsx)("span",{className:"font-semibold text-gray-900 dark:text-white",children:"Optimizing..."})]}),(0,Ca.jsx)("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:(e=>{const t=Math.floor(e/60),r=e%60;return"".concat(t,":").concat(r.toString().padStart(2,"0"))})(o)})]}),(0,Ca.jsx)("div",{className:"text-sm text-gray-600 dark:text-gray-400 mb-3",children:r.name}),(0,Ca.jsxs)("div",{className:"space-y-2",children:[(0,Ca.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,Ca.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:"Progress"}),(0,Ca.jsxs)("span",{className:"font-semibold text-primary-600 dark:text-primary-400",children:[(null===(e=r.progress_percentage)||void 0===e?void 0:e.toFixed(0))||0,"%"]})]}),(0,Ca.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden",children:(0,Ca.jsx)("div",{className:"bg-gradient-to-r from-primary-600 to-secondary-600 h-3 rounded-full transition-all duration-500 relative overflow-hidden",style:{width:"".concat(r.progress_percentage||0,"%")},children:(0,Ca.jsx)("div",{className:"absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent animate-shimmer"})})})]}),"running"===r.status&&(0,Ca.jsxs)("div",{className:"mt-3 flex items-center space-x-2 text-sm",children:[(0,Ca.jsxs)("div",{className:"flex space-x-1",children:[(0,Ca.jsx)("div",{className:"w-2 h-2 bg-secondary-600 rounded-full animate-bounce",style:{animationDelay:"0ms"}}),(0,Ca.jsx)("div",{className:"w-2 h-2 bg-secondary-600 rounded-full animate-bounce",style:{animationDelay:"150ms"}}),(0,Ca.jsx)("div",{className:"w-2 h-2 bg-secondary-600 rounded-full animate-bounce",style:{animationDelay:"300ms"}})]}),(0,Ca.jsx)("span",{className:"text-gray-600 dark:text-gray-400",children:"Running optimization engine"})]})]})})})};class Ll extends n.Component{constructor(){super(...arguments),this.state={hasError:!1,error:null,errorInfo:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e,errorInfo:null}}componentDidCatch(e,t){console.error("ErrorBoundary caught an error:",e,t),this.setState({errorInfo:t}),fetch("/api/v1/log-error",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e.message,stack:e.stack,componentStack:t.componentStack,timestamp:(new Date).toISOString()})}).catch(()=>{})}render(){var e,t;return this.state.hasError?(0,Ca.jsx)("div",{className:"min-h-screen bg-red-50 flex items-center justify-center p-8",children:(0,Ca.jsxs)("div",{className:"max-w-2xl w-full bg-white rounded-lg shadow-lg p-6 border-l-4 border-red-500",children:[(0,Ca.jsx)("h1",{className:"text-2xl font-bold text-red-700 mb-4",children:"Something went wrong"}),(0,Ca.jsx)("div",{className:"bg-red-100 rounded p-4 mb-4",children:(0,Ca.jsx)("p",{className:"text-red-800 font-mono text-sm",children:null===(e=this.state.error)||void 0===e?void 0:e.message})}),(null===(t=this.state.error)||void 0===t?void 0:t.stack)&&(0,Ca.jsxs)("details",{className:"mb-4",children:[(0,Ca.jsx)("summary",{className:"cursor-pointer text-gray-600 hover:text-gray-800",children:"Stack trace"}),(0,Ca.jsx)("pre",{className:"mt-2 p-3 bg-gray-100 rounded text-xs overflow-auto max-h-64",children:this.state.error.stack})]}),(0,Ca.jsx)("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition-colors",children:"Reload Page"})]})}):this.props.children}}const Dl=new Set;let Ul=[];const Rl=()=>{Dl.forEach(e=>e([...Ul]))},zl={show:e=>{var t;const r=Math.random().toString(36).substring(2,11),n=null!==(t=e.duration)&&void 0!==t?t:"error"===e.type?1e4:5e3,i=ot(ot({},e),{},{id:r,duration:n});Ul=[...Ul,i],Rl();const o={success:"[SUCCESS]",error:"[ERROR]",warning:"[WARNING]",info:"[INFO]"}[e.type];return console.log("".concat(o," ").concat(e.title),e.message||""),n>0&&setTimeout(()=>{zl.dismiss(r)},n),r},success:(e,t,r)=>zl.show(ot({type:"success",title:e,message:t},r)),error:(e,t,r)=>zl.show(ot({type:"error",title:e,message:t},r)),warning:(e,t,r)=>zl.show(ot({type:"warning",title:e,message:t},r)),info:(e,t,r)=>zl.show(ot({type:"info",title:e,message:t},r)),dismiss:e=>{Ul=Ul.filter(t=>t.id!==e),Rl()},dismissAll:()=>{Ul=[],Rl()}},Nl={success:{bg:"bg-green-50 dark:bg-green-900/20 border-green-200 dark:border-green-800",iconBg:"bg-green-100 dark:bg-green-800",icon:(0,Ca.jsx)("svg",{className:"w-5 h-5 text-green-600 dark:text-green-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})},error:{bg:"bg-red-50 dark:bg-red-900/20 border-red-200 dark:border-red-800",iconBg:"bg-red-100 dark:bg-red-800",icon:(0,Ca.jsx)("svg",{className:"w-5 h-5 text-red-600 dark:text-red-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})},warning:{bg:"bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-800",iconBg:"bg-yellow-100 dark:bg-yellow-800",icon:(0,Ca.jsx)("svg",{className:"w-5 h-5 text-yellow-600 dark:text-yellow-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})},info:{bg:"bg-blue-50 dark:bg-blue-900/20 border-blue-200 dark:border-blue-800",iconBg:"bg-blue-100 dark:bg-blue-800",icon:(0,Ca.jsx)("svg",{className:"w-5 h-5 text-blue-600 dark:text-blue-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}},jl=()=>{const e=(()=>{const[e,t]=(0,n.useState)(Ul);return(0,n.useEffect)(()=>{const e=e=>t(e);return Dl.add(e),()=>{Dl.delete(e)}},[]),e})();return 0===e.length?null:(0,Ca.jsx)("div",{className:"fixed bottom-4 right-4 z-50 space-y-2 max-w-sm w-full sm:max-w-md pointer-events-none",role:"region","aria-label":"Notifications","aria-live":"polite",children:e.map(e=>{const t=Nl[e.type];return(0,Ca.jsx)("div",{className:"pointer-events-auto ".concat(t.bg," border rounded-lg shadow-lg p-4 animate-slide-in"),role:"alert",children:(0,Ca.jsxs)("div",{className:"flex items-start space-x-3",children:[(0,Ca.jsx)("div",{className:"flex-shrink-0 p-1 rounded-full ".concat(t.iconBg),children:t.icon}),(0,Ca.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,Ca.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.title}),e.message&&(0,Ca.jsx)("p",{className:"mt-1 text-sm text-gray-600 dark:text-gray-400",children:e.message}),e.action&&(0,Ca.jsx)("button",{onClick:e.action.onClick,className:"mt-2 text-sm font-medium text-primary-600 dark:text-primary-400 hover:text-primary-700 dark:hover:text-primary-300 focus:outline-none focus:ring-2 focus:ring-primary-500 rounded",children:e.action.label})]}),(0,Ca.jsx)("button",{onClick:()=>zl.dismiss(e.id),className:"flex-shrink-0 p-1 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Dismiss notification",children:(0,Ca.jsx)("svg",{className:"w-4 h-4 text-gray-500 dark:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},e.id)})})},Ql=()=>{const[e,t]=(0,n.useState)(navigator.onLine),[r,i]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{const e=()=>{t(!0),i(!0),setTimeout(()=>i(!1),3e3)},r=()=>{t(!1),i(!1)};return window.addEventListener("online",e),window.addEventListener("offline",r),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",r)}},[]),e&&!r?null:(0,Ca.jsx)("div",{className:"fixed top-4 left-1/2 transform -translate-x-1/2 z-50 px-4 py-2 rounded-full shadow-lg flex items-center space-x-2 transition-all duration-300 animate-slide-in ".concat(e?"bg-green-600 text-white":"bg-red-600 text-white"),role:"status","aria-live":"polite",children:e?(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,Ca.jsx)("span",{className:"text-sm font-medium",children:"Back online"})]}):(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M18.364 5.636a9 9 0 010 12.728m0 0l-2.829-2.829m2.829 2.829L21 21M15.536 8.464a5 5 0 010 7.072m0 0l-2.829-2.829m-4.243 2.829a4.978 4.978 0 01-1.414-2.83m-1.414 5.658a9 9 0 01-2.167-9.238m7.824 2.167a1 1 0 111.414 1.414m-1.414-1.414L3 3m8.293 8.293l1.414 1.414"})}),(0,Ca.jsx)("span",{className:"text-sm font-medium",children:"No internet connection"})]})})},Vl=e=>{let{targetId:t="main-content",label:r="Skip to main content"}=e;return(0,Ca.jsx)("a",{href:"#".concat(t),onClick:e=>{e.preventDefault();const r=document.getElementById(t);r&&(r.focus(),r.scrollIntoView({behavior:"smooth"}))},className:"sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-50 focus:px-4 focus:py-2 focus:bg-primary-600 focus:text-white focus:rounded-lg focus:shadow-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2",children:r})},Hl=e=>{let{isDarkMode:t,onToggleDarkMode:r,leftPanelContent:i,rightPanelContent:o}=e;const[a,s]=(0,n.useState)(!1),[l,c]=(0,n.useState)(null),u=(0,n.useCallback)(e=>{"Escape"===e.key&&(c(null),s(!1))},[]);(0,n.useEffect)(()=>(document.addEventListener("keydown",u),()=>document.removeEventListener("keydown",u)),[u]),(0,n.useEffect)(()=>(document.body.style.overflow=l||a?"hidden":"",()=>{document.body.style.overflow=""}),[l,a]);return(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("header",{className:"lg:hidden bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm z-30 relative",children:(0,Ca.jsxs)("div",{className:"px-4 py-3 flex items-center justify-between",children:[(0,Ca.jsx)("button",{onClick:()=>s(!a),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":a?"Close menu":"Open menu","aria-expanded":a,children:(0,Ca.jsx)("svg",{className:"w-6 h-6 text-gray-700 dark:text-gray-300",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:a?(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"}):(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})}),(0,Ca.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,Ca.jsx)("div",{className:"text-2xl",children:"\ud83c\udf3f"}),(0,Ca.jsx)("span",{className:"text-xl font-bold text-gray-900 dark:text-white",children:"CANOPI"})]}),(0,Ca.jsx)("button",{onClick:r,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":t?"Switch to light mode":"Switch to dark mode",children:t?(0,Ca.jsx)("svg",{className:"w-5 h-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ca.jsx)("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})}):(0,Ca.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ca.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})})]})}),(a||l)&&(0,Ca.jsx)("div",{className:"lg:hidden fixed inset-0 bg-black/50 z-30 transition-opacity",onClick:()=>{c(null),s(!1)},"aria-hidden":"true"}),(0,Ca.jsxs)("div",{className:"lg:hidden fixed top-0 left-0 h-full w-64 bg-white dark:bg-gray-800 z-40 transform transition-transform duration-300 ease-in-out ".concat(a?"translate-x-0":"-translate-x-full"),role:"dialog","aria-modal":"true","aria-label":"Navigation menu",children:[(0,Ca.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between",children:[(0,Ca.jsx)("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Menu"}),(0,Ca.jsx)("button",{onClick:()=>s(!1),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Close menu",children:(0,Ca.jsx)("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,Ca.jsxs)("nav",{className:"p-4 space-y-2",children:[(0,Ca.jsxs)("a",{href:"/",className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300",children:[(0,Ca.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),(0,Ca.jsx)("span",{children:"Dashboard"})]}),(0,Ca.jsxs)("button",{onClick:()=>{s(!1),c("projects")},className:"w-full flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300",children:[(0,Ca.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),(0,Ca.jsx)("span",{children:"Projects"})]}),(0,Ca.jsxs)("button",{onClick:()=>{s(!1),c("optimization")},className:"w-full flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300",children:[(0,Ca.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),(0,Ca.jsx)("span",{children:"Optimization"})]}),(0,Ca.jsxs)("a",{href:"#scenarios",className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300",children:[(0,Ca.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 5a1 1 0 011-1h14a1 1 0 011 1v2a1 1 0 01-1 1H5a1 1 0 01-1-1V5zM4 13a1 1 0 011-1h6a1 1 0 011 1v6a1 1 0 01-1 1H5a1 1 0 01-1-1v-6zM16 13a1 1 0 011-1h2a1 1 0 011 1v6a1 1 0 01-1 1h-2a1 1 0 01-1-1v-6z"})}),(0,Ca.jsx)("span",{children:"Scenarios"})]}),(0,Ca.jsxs)("a",{href:"#reports",className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-700 dark:text-gray-300",children:[(0,Ca.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 17v-2m3 2v-4m3 4v-6m2 10H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,Ca.jsx)("span",{children:"Reports"})]})]})]}),(0,Ca.jsx)("div",{className:"lg:hidden fixed top-0 left-0 h-full w-80 max-w-[calc(100vw-3rem)] bg-white dark:bg-gray-800 z-40 transform transition-transform duration-300 ease-in-out ".concat("projects"===l?"translate-x-0":"-translate-x-full"),role:"dialog","aria-modal":"true","aria-label":"Projects panel",children:(0,Ca.jsxs)("div",{className:"h-full flex flex-col",children:[(0,Ca.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between flex-shrink-0",children:[(0,Ca.jsx)("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Projects"}),(0,Ca.jsx)("button",{onClick:()=>c(null),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Close projects panel",children:(0,Ca.jsx)("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,Ca.jsx)("div",{className:"flex-1 overflow-hidden",children:i})]})}),(0,Ca.jsx)("div",{className:"lg:hidden fixed top-0 right-0 h-full w-96 max-w-[calc(100vw-3rem)] bg-gray-50 dark:bg-gray-900 z-40 transform transition-transform duration-300 ease-in-out ".concat("optimization"===l?"translate-x-0":"translate-x-full"),role:"dialog","aria-modal":"true","aria-label":"Optimization panel",children:(0,Ca.jsxs)("div",{className:"h-full flex flex-col",children:[(0,Ca.jsxs)("div",{className:"p-4 border-b border-gray-200 dark:border-gray-700 flex items-center justify-between flex-shrink-0",children:[(0,Ca.jsx)("span",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Optimization"}),(0,Ca.jsx)("button",{onClick:()=>c(null),className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500","aria-label":"Close optimization panel",children:(0,Ca.jsx)("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),(0,Ca.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:o})]})}),(0,Ca.jsx)("nav",{className:"lg:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 z-30 safe-area-bottom",children:(0,Ca.jsxs)("div",{className:"flex justify-around items-center py-2",children:[(0,Ca.jsxs)("button",{onClick:()=>c("projects"),className:"flex flex-col items-center p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ".concat("projects"===l?"text-primary-600 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),"aria-label":"View projects","aria-pressed":"projects"===l,children:[(0,Ca.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),(0,Ca.jsx)("span",{className:"text-xs mt-1",children:"Projects"})]}),(0,Ca.jsxs)("button",{onClick:()=>c(null),className:"flex flex-col items-center p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ".concat(null===l?"text-primary-600 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),"aria-label":"View map","aria-pressed":null===l,children:[(0,Ca.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})}),(0,Ca.jsx)("span",{className:"text-xs mt-1",children:"Map"})]}),(0,Ca.jsxs)("button",{onClick:()=>c("optimization"),className:"flex flex-col items-center p-2 rounded-lg transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 ".concat("optimization"===l?"text-primary-600 dark:text-primary-400":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white"),"aria-label":"View optimization","aria-pressed":"optimization"===l,children:[(0,Ca.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})}),(0,Ca.jsx)("span",{className:"text-xs mt-1",children:"Optimize"})]})]})})]})},Gl=e=>{let{onShowAbout:t,onStartTour:r,className:n=""}=e;return(0,Ca.jsx)("footer",{className:"bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 px-4 py-2 ".concat(n),role:"contentinfo",children:(0,Ca.jsxs)("div",{className:"flex flex-wrap items-center justify-between gap-2 text-xs text-gray-500 dark:text-gray-400",children:[(0,Ca.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Ca.jsx)("span",{children:"CANOPI v0.1.0"}),(0,Ca.jsx)("span",{className:"hidden sm:inline",children:"|"}),(0,Ca.jsx)("button",{onClick:t,className:"hidden sm:inline hover:text-primary-600 dark:hover:text-primary-400 transition-colors focus:outline-none focus:underline",children:"About"}),(0,Ca.jsx)("button",{onClick:r,className:"hidden sm:inline hover:text-primary-600 dark:hover:text-primary-400 transition-colors focus:outline-none focus:underline",children:"Take Tour"})]}),(0,Ca.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,Ca.jsx)("span",{className:"hidden md:inline",children:"Data: HIFLD, EIA-860, WECC"}),(0,Ca.jsxs)("a",{href:"https://github.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-1 hover:text-primary-600 dark:hover:text-primary-400 transition-colors","aria-label":"View source on GitHub",children:[(0,Ca.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:(0,Ca.jsx)("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})}),(0,Ca.jsx)("span",{children:"GitHub"})]})]})]})})},Kl=e=>{let{isOpen:t,onClose:r}=e;const i=(0,n.useRef)(null),o=(0,n.useRef)(null);return(0,n.useEffect)(()=>{t&&o.current&&o.current.focus()},[t]),(0,n.useEffect)(()=>{const e=e=>{"Escape"===e.key&&t&&r()};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t,r]),(0,n.useEffect)(()=>{if(!t)return;const e=e=>{if("Tab"!==e.key||!i.current)return;const t=i.current.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),r=t[0],n=t[t.length-1];e.shiftKey&&document.activeElement===r?(e.preventDefault(),n.focus()):e.shiftKey||document.activeElement!==n||(e.preventDefault(),r.focus())};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[t]),(0,n.useEffect)(()=>(document.body.style.overflow=t?"hidden":"",()=>{document.body.style.overflow=""}),[t]),t?(0,Ca.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",role:"dialog","aria-modal":"true","aria-labelledby":"about-modal-title",children:[(0,Ca.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm transition-opacity",onClick:r,"aria-hidden":"true"}),(0,Ca.jsxs)("div",{ref:i,className:"relative bg-white dark:bg-gray-800 rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto animate-slide-in",children:[(0,Ca.jsx)("div",{className:"sticky top-0 bg-gradient-to-r from-primary-600 to-secondary-600 p-6 rounded-t-2xl",children:(0,Ca.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ca.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Ca.jsx)("div",{className:"text-4xl",children:"\ud83c\udf3f"}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h2",{id:"about-modal-title",className:"text-2xl font-bold text-white",children:"CANOPI"}),(0,Ca.jsx)("p",{className:"text-sm text-white/80",children:"Energy Planning Platform"})]})]}),(0,Ca.jsx)("button",{ref:o,onClick:r,className:"p-2 rounded-lg hover:bg-white/20 transition-colors focus:outline-none focus:ring-2 focus:ring-white","aria-label":"Close about modal",children:(0,Ca.jsx)("svg",{className:"w-6 h-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})}),(0,Ca.jsxs)("div",{className:"p-6 space-y-6",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"About CANOPI"}),(0,Ca.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"CANOPI (Contingency-Aware Nodal Optimal Power Investments) is an enterprise-grade web platform for integrated capacity expansion planning. It jointly optimizes generation, storage, and transmission investments with n-1 contingency reliability."})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-3",children:"Key Features"}),(0,Ca.jsx)("ul",{className:"space-y-3",children:[{icon:"\ud83c\udf0d",title:"Greenfield Optimization",desc:"Find optimal locations for new renewable projects"},{icon:"\u26a1",title:"Grid Topology Analysis",desc:"Visualize real transmission infrastructure data"},{icon:"\ud83d\udcca",title:"Cost-Benefit Analysis",desc:"Evaluate project economics with detailed metrics"},{icon:"\ud83c\udfaf",title:"Multi-Objective Optimization",desc:"Balance cost, renewables, and emissions"}].map((e,t)=>(0,Ca.jsxs)("li",{className:"flex items-start space-x-3",children:[(0,Ca.jsx)("span",{className:"text-xl",children:e.icon}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("p",{className:"font-medium text-gray-900 dark:text-white",children:e.title}),(0,Ca.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:e.desc})]})]},t))})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:"Data Sources"}),(0,Ca.jsx)("div",{className:"flex flex-wrap gap-2",children:["HIFLD Transmission","EIA-860 Generators","WECC Topology"].map(e=>(0,Ca.jsx)("span",{className:"px-3 py-1 bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-full text-sm",children:e},e))})]}),(0,Ca.jsx)("div",{className:"pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,Ca.jsxs)("div",{className:"flex items-center justify-between text-sm text-gray-500 dark:text-gray-400",children:[(0,Ca.jsx)("span",{children:"Version 0.1.0"}),(0,Ca.jsxs)("a",{href:"https://github.com",target:"_blank",rel:"noopener noreferrer",className:"flex items-center space-x-1 hover:text-primary-600 dark:hover:text-primary-400 transition-colors",children:[(0,Ca.jsx)("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 24 24",children:(0,Ca.jsx)("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})}),(0,Ca.jsx)("span",{children:"View on GitHub"})]})]})})]})]})]}):null},Wl=[{target:'[data-tour="projects"]',title:"Projects Panel",content:"Create and manage your energy projects here. Add solar, wind, storage, or datacenter projects with capacity and location data.",position:"right"},{target:'[data-tour="map"]',title:"Interactive Map",content:"Explore the grid topology and transmission network. Click anywhere on the map to add a new project at that location.",position:"bottom"},{target:'[data-tour="optimization"]',title:"Optimization Panel",content:"Run greenfield optimization to find optimal locations for new projects, or evaluate specific sites with quick optimization.",position:"left"},{target:'[data-tour="layers"]',title:"Map Layers",content:"Toggle different data layers to visualize substations, transmission lines, and optimization results.",position:"left"}],ql=e=>{let{isOpen:t,onClose:r,onComplete:i}=e;const[o,a]=(0,n.useState)(0),[s,l]=(0,n.useState)({top:0,left:0}),[c,u]=(0,n.useState)(!1),d=(0,n.useCallback)(()=>{const e=Wl[o],t=document.querySelector(e.target);if(!t)return void(o<Wl.length-1&&a(o+1));const r=t.getBoundingClientRect(),n=320,i=200,s=16;let c=0,d=0;switch(e.position){case"right":c=r.top+r.height/2-100,d=r.right+s;break;case"left":c=r.top+r.height/2-100,d=r.left-n-s;break;case"bottom":c=r.bottom+s,d=r.left+r.width/2-160;break;default:c=r.top-i-s,d=r.left+r.width/2-160}const h=window.innerWidth-n-s,A=window.innerHeight-i-s;c=Math.max(s,Math.min(c,A)),d=Math.max(s,Math.min(d,h)),l({top:c,left:d}),u(!0),t.classList.add("tour-highlight")},[o]);(0,n.useEffect)(()=>{if(!t)return;document.querySelectorAll(".tour-highlight").forEach(e=>{e.classList.remove("tour-highlight")}),d();const e=()=>d();return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),document.querySelectorAll(".tour-highlight").forEach(e=>{e.classList.remove("tour-highlight")})}},[t,o,d]);const h=()=>{document.querySelectorAll(".tour-highlight").forEach(e=>{e.classList.remove("tour-highlight")}),localStorage.setItem("canopi-tour-completed","true"),i()};if(!t)return null;const A=Wl[o];return(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("div",{className:"fixed inset-0 bg-black/30 z-40 pointer-events-none","aria-hidden":"true"}),(0,Ca.jsxs)("div",{className:"fixed z-50 w-80 bg-white dark:bg-gray-800 rounded-xl shadow-2xl transition-all duration-300 ".concat(c?"opacity-100 scale-100":"opacity-0 scale-95"),style:{top:s.top,left:s.left},role:"dialog","aria-modal":"true","aria-labelledby":"tour-step-title",children:[(0,Ca.jsx)("div",{className:"flex items-center justify-center space-x-2 pt-4 pb-2",children:Wl.map((e,t)=>(0,Ca.jsx)("button",{onClick:()=>{u(!1),setTimeout(()=>a(t),150)},className:"w-2 h-2 rounded-full transition-colors ".concat(t===o?"bg-primary-600 dark:bg-primary-400":"bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500"),"aria-label":"Go to step ".concat(t+1)},t))}),(0,Ca.jsxs)("div",{className:"px-5 pb-5",children:[(0,Ca.jsx)("h3",{id:"tour-step-title",className:"text-lg font-semibold text-gray-900 dark:text-white mb-2",children:A.title}),(0,Ca.jsx)("p",{className:"text-gray-600 dark:text-gray-400 text-sm mb-4",children:A.content}),(0,Ca.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ca.jsx)("button",{onClick:()=>{document.querySelectorAll(".tour-highlight").forEach(e=>{e.classList.remove("tour-highlight")}),localStorage.setItem("canopi-tour-completed","true"),r()},className:"text-sm text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300 transition-colors",children:"Skip tour"}),(0,Ca.jsxs)("div",{className:"flex items-center space-x-2",children:[o>0&&(0,Ca.jsx)("button",{onClick:()=>{o>0&&(u(!1),setTimeout(()=>a(o-1),150))},className:"px-3 py-1.5 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:"Back"}),(0,Ca.jsx)("button",{onClick:()=>{o<Wl.length-1?(u(!1),setTimeout(()=>a(o+1),150)):h()},className:"px-4 py-1.5 text-sm bg-primary-600 text-white rounded-lg hover:bg-primary-700 transition-colors",children:o===Wl.length-1?"Finish":"Next"})]})]})]}),(0,Ca.jsx)("div",{className:"px-5 pb-4",children:(0,Ca.jsxs)("p",{className:"text-xs text-gray-400 dark:text-gray-500",children:["Step ",o+1," of ",Wl.length]})})]})]})},Zl={sm:"h-4 w-4 border-2",md:"h-8 w-8 border-2",lg:"h-12 w-12 border-3",xl:"h-16 w-16 border-4"},Xl={primary:"border-primary-600 border-t-transparent",secondary:"border-secondary-600 border-t-transparent",white:"border-white border-t-transparent",gray:"border-gray-400 border-t-transparent"},Yl=e=>{let{size:t="md",color:r="primary",className:n="",label:i}=e;return(0,Ca.jsxs)("div",{className:"flex flex-col items-center justify-center ".concat(n),role:"status","aria-live":"polite",children:[(0,Ca.jsx)("div",{className:"animate-spin rounded-full ".concat(Zl[t]," ").concat(Xl[r]),"aria-hidden":"true"}),i&&(0,Ca.jsx)("span",{className:"mt-2 text-sm text-gray-600 dark:text-gray-400",children:i}),(0,Ca.jsx)("span",{className:"sr-only",children:i||"Loading..."})]})},Jl={solar:"\u2600",wind:"\ud83c\udf2c",storage:"\ud83d\udd0b",load:"\u26a1"},$l={solar:"#F59E0B",wind:"#3B82F6",storage:"#8B5CF6",load:"#EF4444"},ec=()=>{const e=$e(),{sites:t,selectedSiteId:r,isPlacingMode:n}=et(e=>e.candidateSites);return(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,Ca.jsx)("div",{className:"p-4 bg-gradient-to-r from-indigo-600 to-purple-600",children:(0,Ca.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ca.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center space-x-2",children:[(0,Ca.jsx)("span",{children:"\ud83d\udccd"}),(0,Ca.jsx)("span",{children:"Candidate Sites"})]}),(0,Ca.jsx)("span",{className:"px-2 py-1 bg-white/20 text-white text-sm rounded-full",children:t.length})]})}),(0,Ca.jsxs)("div",{className:"p-4 space-y-4",children:[(0,Ca.jsx)("button",{onClick:()=>{e(Xs(!n))},className:"w-full py-3 rounded-lg font-semibold transition-all flex items-center justify-center space-x-2 ".concat(n?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400 border-2 border-red-500":"bg-gradient-to-r from-indigo-600 to-purple-600 text-white hover:from-indigo-700 hover:to-purple-700"),children:n?(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("span",{children:"\xd7"}),(0,Ca.jsx)("span",{children:"Cancel Placement"})]}):(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("span",{children:"+"}),(0,Ca.jsx)("span",{children:"Add Candidate Site"})]})}),n&&(0,Ca.jsx)("div",{className:"p-3 bg-indigo-50 dark:bg-indigo-900/20 rounded-lg border border-indigo-200 dark:border-indigo-800",children:(0,Ca.jsx)("p",{className:"text-sm text-indigo-700 dark:text-indigo-300",children:"Click on the map to place a new candidate site"})}),(0,Ca.jsx)("div",{className:"space-y-2 max-h-64 overflow-y-auto",children:0===t.length?(0,Ca.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,Ca.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udccd"}),(0,Ca.jsx)("p",{className:"text-sm",children:"No candidate sites yet"}),(0,Ca.jsx)("p",{className:"text-xs mt-1",children:'Click "Add Candidate Site" to start'})]}):t.map(t=>(0,Ca.jsx)("div",{className:"p-3 rounded-lg border transition-all cursor-pointer ".concat(r===t.id?"border-indigo-500 bg-indigo-50 dark:bg-indigo-900/20":"border-gray-200 dark:border-gray-700 hover:border-indigo-300 dark:hover:border-indigo-600"),onClick:()=>e(qs(t.id)),onMouseEnter:()=>e(Zs(t.id)),onMouseLeave:()=>e(Zs(null)),children:(0,Ca.jsxs)("div",{className:"flex items-center justify-between",children:[(0,Ca.jsxs)("div",{className:"flex items-center gap-2",children:[(0,Ca.jsx)("span",{className:"text-xl p-1.5 rounded-full",style:{backgroundColor:$l[t.type]+"20"},children:Jl[t.type]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("div",{className:"font-medium text-gray-900 dark:text-white text-sm",children:t.name}),(0,Ca.jsxs)("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:[t.type," \xb7 ",t.maxCapacityMW," MW"]})]})]}),(0,Ca.jsx)("button",{onClick:r=>{r.stopPropagation(),e(Ws(t.id))},className:"p-1 text-gray-400 hover:text-red-500 transition-colors",title:"Remove site",children:(0,Ca.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})},t.id))}),t.length>0&&(0,Ca.jsx)("button",{onClick:()=>{window.confirm("Remove all candidate sites?")&&e(tl())},className:"w-full py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:"Clear All Sites"})]})]})},tc=()=>{var e;const t=$e(),{scenarioConfig:r}=et(e=>e.candidateSites),n=(e,r)=>{t(Ys({[e]:r}))};return(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,Ca.jsx)("div",{className:"p-4 bg-gradient-to-r from-teal-600 to-cyan-600",children:(0,Ca.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center space-x-2",children:[(0,Ca.jsx)("span",{children:"\u2699\ufe0f"}),(0,Ca.jsx)("span",{children:"Scenario Configuration"})]})}),(0,Ca.jsxs)("div",{className:"p-4 space-y-4",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Scenario Name"}),(0,Ca.jsx)("input",{type:"text",value:r.name,onChange:e=>n("name",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:text-white text-sm",placeholder:"Enter scenario name"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Planning Horizon (years)"}),(0,Ca.jsx)("input",{type:"number",value:r.planningHorizonYears,onChange:e=>n("planningHorizonYears",parseInt(e.target.value)||1),min:"1",max:"50",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:text-white text-sm"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Discount Rate (%)"}),(0,Ca.jsx)("input",{type:"number",value:r.discountRatePercent,onChange:e=>n("discountRatePercent",parseFloat(e.target.value)||0),min:"0",max:"20",step:"0.5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:text-white text-sm"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Carbon Price ($/ton CO2)"}),(0,Ca.jsx)("input",{type:"number",value:r.carbonPriceDollarsPerTon,onChange:e=>n("carbonPriceDollarsPerTon",parseFloat(e.target.value)||0),min:"0",max:"500",step:"5",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:text-white text-sm"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Budget Constraint ($M)",(0,Ca.jsx)("span",{className:"text-gray-400 font-normal ml-1",children:"(optional)"})]}),(0,Ca.jsx)("input",{type:"number",value:null!==(e=r.budgetConstraintMillions)&&void 0!==e?e:"",onChange:e=>n("budgetConstraintMillions",e.target.value?parseFloat(e.target.value):null),min:"0",step:"100",placeholder:"No limit",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:text-white text-sm"})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsxs)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:["Renewable Target: ",r.renewableTargetPercent,"%"]}),(0,Ca.jsx)("input",{type:"range",value:r.renewableTargetPercent,onChange:e=>n("renewableTargetPercent",parseInt(e.target.value)),min:"0",max:"100",step:"5",className:"w-full h-2 bg-gray-200 dark:bg-gray-700 rounded-lg appearance-none cursor-pointer accent-teal-600"}),(0,Ca.jsxs)("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[(0,Ca.jsx)("span",{children:"0%"}),(0,Ca.jsx)("span",{children:"50%"}),(0,Ca.jsx)("span",{children:"100%"})]})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Reliability Standard"}),(0,Ca.jsxs)("select",{value:r.reliabilityStandard,onChange:e=>n("reliabilityStandard",e.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-teal-500 dark:bg-gray-700 dark:text-white text-sm",children:[(0,Ca.jsx)("option",{value:"n-0",children:"N-0 (No contingency)"}),(0,Ca.jsx)("option",{value:"n-1",children:"N-1 (Single contingency)"}),(0,Ca.jsx)("option",{value:"n-2",children:"N-2 (Double contingency)"})]}),(0,Ca.jsxs)("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["n-0"===r.reliabilityStandard&&"System must serve load under normal conditions only","n-1"===r.reliabilityStandard&&"System must serve load with any single element out of service","n-2"===r.reliabilityStandard&&"System must serve load with any two elements out of service"]})]}),(0,Ca.jsx)("button",{onClick:()=>{window.confirm("Reset scenario configuration to defaults?")&&t(Js())},className:"w-full py-2 text-sm text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors border border-gray-300 dark:border-gray-600",children:"Reset to Defaults"}),(0,Ca.jsxs)("div",{className:"p-3 bg-teal-50 dark:bg-teal-900/20 rounded-lg border border-teal-200 dark:border-teal-800",children:[(0,Ca.jsx)("h4",{className:"text-sm font-semibold text-teal-700 dark:text-teal-300 mb-2",children:"Scenario Summary"}),(0,Ca.jsxs)("div",{className:"text-xs text-teal-600 dark:text-teal-400 space-y-1",children:[(0,Ca.jsxs)("p",{children:[(0,Ca.jsx)("strong",{children:r.planningHorizonYears})," year planning horizon"]}),(0,Ca.jsxs)("p",{children:[(0,Ca.jsxs)("strong",{children:[r.discountRatePercent,"%"]})," discount rate"]}),(0,Ca.jsxs)("p",{children:[(0,Ca.jsxs)("strong",{children:["$",r.carbonPriceDollarsPerTon]}),"/ton carbon price"]}),(0,Ca.jsxs)("p",{children:[(0,Ca.jsxs)("strong",{children:[r.renewableTargetPercent,"%"]})," renewable target"]}),(0,Ca.jsxs)("p",{children:[(0,Ca.jsx)("strong",{children:r.reliabilityStandard.toUpperCase()})," reliability"]}),r.budgetConstraintMillions&&(0,Ca.jsxs)("p",{children:[(0,Ca.jsxs)("strong",{children:["$",r.budgetConstraintMillions,"M"]})," budget cap"]})]})]})]})]})},rc={solar:1e6,wind:13e5,storage:8e5,load:0},nc={solar:.25,wind:.35,storage:.15,load:1},ic={solar:0,wind:0,storage:.05,load:.4};async function oc(e,t,r){const n=50;r.onProgress({iteration:0,totalIterations:n,gap:1,status:"running"});for(let o=1;o<=n;o++){await new Promise(e=>setTimeout(e,100));const e=Math.exp(-o/15),t=.05*Math.random(),i=Math.max(.001,e+t);r.onProgress({iteration:o,totalIterations:n,gap:i,status:"running"})}try{const i=function(e,t){const r=e.filter(e=>"load"!==e.type),n=e.filter(e=>"load"===e.type),i=n.reduce((e,t)=>e+t.maxCapacityMW,0)||1e3,o=[];let a=1.2*i,s=0;const l=t.budgetConstraintMillions?1e6*t.budgetConstraintMillions:1/0,c=r.map(e=>{const r=rc[e.type]*e.maxCapacityMW,n=e.maxCapacityMW*nc[e.type]*8760;return{site:e,lcoe:r*(t.discountRatePercent/100)/(1-Math.pow(1+t.discountRatePercent/100,-t.planningHorizonYears))/n,capex:r}});c.sort((e,t)=>e.lcoe-t.lcoe);for(const{site:_,capex:v}of c){if(a<=0)break;s+v>l||(o.push(_),a-=_.maxCapacityMW*nc[_.type],s+=v)}const u={solar:0,wind:0,storage:0,load:0},d={solar:0,wind:0,storage:0,load:0};o.forEach(e=>{u[e.type]+=e.maxCapacityMW,d[e.type]+=rc[e.type]*e.maxCapacityMW});const h=Object.values(u).reduce((e,t)=>e+t,0),A=o.reduce((e,t)=>e+t.maxCapacityMW*nc[t.type],0)/Math.max(h,1),f=h*A*8760,p=o.reduce((e,t)=>e+t.maxCapacityMW*nc[t.type]*8760*ic[t.type],0),m=s*(t.discountRatePercent/100)/(1-Math.pow(1+t.discountRatePercent/100,-t.planningHorizonYears)),g=f>0?m/f:0,y=Object.keys(u).filter(e=>u[e]>0).map(e=>({type:e,capacityMW:u[e],costMillions:d[e]/1e6}));return{selectedCapacityByType:u,totalCost:s,emissions:p,levelizedCost:g,capacityMix:y,selectedSiteIds:o.map(e=>e.id)}}(e,t);r.onProgress({iteration:n,totalIterations:n,gap:.001,status:"complete"}),r.onComplete(i)}catch(i){r.onProgress({iteration:n,totalIterations:n,gap:1,status:"failed"}),r.onError(i instanceof Error?i.message:"Unknown error")}}function ac(e){var t,r,n="";if("string"==typeof e||"number"==typeof e)n+=e;else if("object"==typeof e)if(Array.isArray(e)){var i=e.length;for(t=0;t<i;t++)e[t]&&(r=ac(e[t]))&&(n&&(n+=" "),n+=r)}else for(r in e)e[r]&&(n&&(n+=" "),n+=r);return n}function sc(){for(var e,t,r=0,n="",i=arguments.length;r<i;r++)(e=arguments[r])&&(t=ac(e))&&(n&&(n+=" "),n+=t);return n}var lc=r(7820),cc=r.n(lc),uc=r(7770),dc=r.n(uc);function hc(e){var t=10**(arguments.length>1&&void 0!==arguments[1]?arguments[1]:4),r=Math.round(e*t)/t;return Object.is(r,-0)?0:r}function Ac(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];return e.reduce((e,t,n)=>{var i=r[n-1];return"string"===typeof i?e+i+t:void 0!==i?e+hc(i)+t:e+t},"")}var fc=e=>0===e?0:e>0?1:-1,pc=e=>"number"==typeof e&&e!=+e,mc=e=>"string"===typeof e&&e.indexOf("%")===e.length-1,gc=e=>("number"===typeof e||e instanceof Number)&&!pc(e),yc=e=>gc(e)||"string"===typeof e,_c=0,vc=e=>{var t=++_c;return"".concat(e||"").concat(t)},xc=function(e,t){var r,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(!gc(e)&&"string"!==typeof e)return n;if(mc(e)){if(null==t)return n;var o=e.indexOf("%");r=t*parseFloat(e.slice(0,o))/100}else r=+e;return pc(r)&&(r=n),i&&null!=t&&r>t&&(r=t),r},wc=e=>{if(!Array.isArray(e))return!1;for(var t=e.length,r={},n=0;n<t;n++){if(r[String(e[n])])return!0;r[String(e[n])]=!0}return!1};function bc(e,t,r){return gc(e)&&gc(t)?hc(e+r*(t-e)):t}var Bc=e=>null===e||"undefined"===typeof e,Cc=e=>Bc(e)?e:"".concat(e.charAt(0).toUpperCase()).concat(e.slice(1));function Ec(e){return null!=e}function Sc(){}var Tc=function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];if("undefined"!==typeof console&&console.warn&&(void 0===t&&console.warn("LogUtils requires an error message argument"),!e))if(void 0===t)console.warn("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var o=0;console.warn(t.replace(/%s/g,()=>n[o++]))}},Ic=(e,t,r)=>{var{width:n="100%",height:i="100%",aspect:o,maxHeight:a}=r,s=mc(n)?e:Number(n),l=mc(i)?t:Number(i);return o&&o>0&&(s?l=s/o:l&&(s=l*o),a&&null!=l&&l>a&&(l=a)),{calculatedWidth:s,calculatedHeight:l}},Fc={width:0,height:0,overflow:"visible"},kc={width:0,overflowX:"visible"},Pc={height:0,overflowY:"visible"},Mc={},Oc=e=>{var{width:t,height:r}=e,n=mc(t),i=mc(r);return n&&i?Fc:n?kc:i?Pc:Mc};function Lc(e){return Number.isFinite(e)}function Dc(e){return"number"===typeof e&&e>0&&Number.isFinite(e)}function Uc(){return Uc=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Uc.apply(null,arguments)}function Rc(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function zc(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rc(Object(r),!0).forEach(function(t){Nc(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rc(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Nc(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var jc=(0,n.createContext)({width:-1,height:-1});function Qc(e){var{children:t,width:r,height:i}=e,o=(0,n.useMemo)(()=>({width:r,height:i}),[r,i]);return function(e){return Dc(e.width)&&Dc(e.height)}(o)?n.createElement(jc.Provider,{value:o},t):null}var Vc=()=>(0,n.useContext)(jc),Hc=(0,n.forwardRef)((e,t)=>{var{aspect:r,initialDimension:i={width:-1,height:-1},width:o,height:a,minWidth:s=0,minHeight:l,maxHeight:c,children:u,debounce:d=0,id:h,className:A,onResize:f,style:p={}}=e,m=(0,n.useRef)(null),g=(0,n.useRef)();g.current=f,(0,n.useImperativeHandle)(t,()=>m.current);var[y,_]=(0,n.useState)({containerWidth:i.width,containerHeight:i.height}),v=(0,n.useCallback)((e,t)=>{_(r=>{var n=Math.round(e),i=Math.round(t);return r.containerWidth===n&&r.containerHeight===i?r:{containerWidth:n,containerHeight:i}})},[]);(0,n.useEffect)(()=>{if(null==m.current||"undefined"===typeof ResizeObserver)return Sc;var e=e=>{var t,{width:r,height:n}=e[0].contentRect;v(r,n),null===(t=g.current)||void 0===t||t.call(g,r,n)};d>0&&(e=cc()(e,d,{trailing:!0,leading:!1}));var t=new ResizeObserver(e),{width:r,height:n}=m.current.getBoundingClientRect();return v(r,n),t.observe(m.current),()=>{t.disconnect()}},[v,d]);var{containerWidth:x,containerHeight:w}=y;Tc(!r||r>0,"The aspect(%s) must be greater than zero.",r);var{calculatedWidth:b,calculatedHeight:B}=Ic(x,w,{width:o,height:a,aspect:r,maxHeight:c});return Tc(null!=b&&b>0||null!=B&&B>0,"The width(%s) and height(%s) of chart should be greater than 0,\n       please check the style of container, or the props width(%s) and height(%s),\n       or add a minWidth(%s) or minHeight(%s) or use aspect(%s) to control the\n       height and width.",b,B,o,a,s,l,r),n.createElement("div",{id:h?"".concat(h):void 0,className:sc("recharts-responsive-container",A),style:zc(zc({},p),{},{width:o,height:a,minWidth:s,minHeight:l,maxHeight:c}),ref:m},n.createElement("div",{style:Oc({width:o,height:a})},n.createElement(Qc,{width:b,height:B},u)))}),Gc=(0,n.forwardRef)((e,t)=>{var r=Vc();if(Dc(r.width)&&Dc(r.height))return e.children;var{width:i,height:o}=function(e){var{width:t,height:r,aspect:n}=e,i=t,o=r;return void 0===i&&void 0===o?(i="100%",o="100%"):void 0===i?i=n&&n>0?void 0:"100%":void 0===o&&(o=n&&n>0?void 0:"100%"),{width:i,height:o}}({width:e.width,height:e.height,aspect:e.aspect}),{calculatedWidth:a,calculatedHeight:s}=Ic(void 0,void 0,{width:i,height:o,aspect:e.aspect,maxHeight:e.maxHeight});return gc(a)&&gc(s)?n.createElement(Qc,{width:a,height:s},e.children):n.createElement(Hc,Uc({},e,{width:i,height:o,ref:t}))});function Kc(e,t){if(t){var r=Number.parseInt(t,10);if(!pc(r))return null===e||void 0===e?void 0:e[r]}}var Wc=on({name:"options",initialState:{chartName:"",tooltipPayloadSearcher:void 0,eventEmitter:void 0,defaultTooltipEventType:"axis"},reducers:{createEventEmitter:e=>{null==e.eventEmitter&&(e.eventEmitter=Symbol("rechartsEventEmitter"))}}}),qc=Wc.reducer,{createEventEmitter:Zc}=Wc.actions,Xc=Symbol.for("immer-nothing"),Yc=Symbol.for("immer-draftable"),Jc=Symbol.for("immer-state");function $c(e){throw new Error("[Immer] minified error nr: ".concat(e,". Full error at: https://bit.ly/3cXEKWf"))}var eu=Object.getPrototypeOf;function tu(e){return!!e&&!!e[Jc]}function ru(e){var t;return!!e&&(ou(e)||Array.isArray(e)||!!e[Yc]||!(null===(t=e.constructor)||void 0===t||!t[Yc])||uu(e)||du(e))}var nu=Object.prototype.constructor.toString(),iu=new WeakMap;function ou(e){if(!e||"object"!==typeof e)return!1;const t=Object.getPrototypeOf(e);if(null===t||t===Object.prototype)return!0;const r=Object.hasOwnProperty.call(t,"constructor")&&t.constructor;if(r===Object)return!0;if("function"!==typeof r)return!1;let n=iu.get(r);return void 0===n&&(n=Function.toString.call(r),iu.set(r,n)),n===nu}function au(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===su(e)){(r?Reflect.ownKeys(e):Object.keys(e)).forEach(r=>{t(r,e[r],e)})}else e.forEach((r,n)=>t(n,r,e))}function su(e){const t=e[Jc];return t?t.type_:Array.isArray(e)?1:uu(e)?2:du(e)?3:0}function lu(e,t){return 2===su(e)?e.has(t):Object.prototype.hasOwnProperty.call(e,t)}function cu(e,t,r){const n=su(e);2===n?e.set(t,r):3===n?e.add(r):e[t]=r}function uu(e){return e instanceof Map}function du(e){return e instanceof Set}function hu(e){return e.copy_||e.base_}function Au(e,t){if(uu(e))return new Map(e);if(du(e))return new Set(e);if(Array.isArray(e))return Array.prototype.slice.call(e);const r=ou(e);if(!0===t||"class_only"===t&&!r){const t=Object.getOwnPropertyDescriptors(e);delete t[Jc];let r=Reflect.ownKeys(t);for(let n=0;n<r.length;n++){const i=r[n],o=t[i];!1===o.writable&&(o.writable=!0,o.configurable=!0),(o.get||o.set)&&(t[i]={configurable:!0,writable:!0,enumerable:o.enumerable,value:e[i]})}return Object.create(eu(e),t)}{const t=eu(e);if(null!==t&&r)return ot({},e);const n=Object.create(t);return Object.assign(n,e)}}function fu(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return mu(e)||tu(e)||!ru(e)||(su(e)>1&&Object.defineProperties(e,{set:pu,add:pu,clear:pu,delete:pu}),Object.freeze(e),t&&Object.values(e).forEach(e=>fu(e,!0))),e}var pu={value:function(){$c(2)}};function mu(e){return null===e||"object"!==typeof e||Object.isFrozen(e)}var gu,yu={};function _u(e){const t=yu[e];return t||$c(0),t}function vu(){return gu}function xu(e,t){t&&(_u("Patches"),e.patches_=[],e.inversePatches_=[],e.patchListener_=t)}function wu(e){bu(e),e.drafts_.forEach(Cu),e.drafts_=null}function bu(e){e===gu&&(gu=e.parent_)}function Bu(e){return gu={drafts_:[],parent_:gu,immer_:e,canAutoFreeze_:!0,unfinalizedDrafts_:0}}function Cu(e){const t=e[Jc];0===t.type_||1===t.type_?t.revoke_():t.revoked_=!0}function Eu(e,t){t.unfinalizedDrafts_=t.drafts_.length;const r=t.drafts_[0];return void 0!==e&&e!==r?(r[Jc].modified_&&(wu(t),$c(4)),ru(e)&&(e=Su(t,e),t.parent_||Iu(t,e)),t.patches_&&_u("Patches").generateReplacementPatches_(r[Jc].base_,e,t.patches_,t.inversePatches_)):e=Su(t,r,[]),wu(t),t.patches_&&t.patchListener_(t.patches_,t.inversePatches_),e!==Xc?e:void 0}function Su(e,t,r){if(mu(t))return t;const n=e.immer_.shouldUseStrictIteration(),i=t[Jc];if(!i)return au(t,(n,o)=>Tu(e,i,t,n,o,r),n),t;if(i.scope_!==e)return t;if(!i.modified_)return Iu(e,i.base_,!0),i.base_;if(!i.finalized_){i.finalized_=!0,i.scope_.unfinalizedDrafts_--;const t=i.copy_;let o=t,a=!1;3===i.type_&&(o=new Set(t),t.clear(),a=!0),au(o,(n,o)=>Tu(e,i,t,n,o,r,a),n),Iu(e,t,!1),r&&e.patches_&&_u("Patches").generatePatches_(i,r,e.patches_,e.inversePatches_)}return i.copy_}function Tu(e,t,r,n,i,o,a){if(null==i)return;if("object"!==typeof i&&!a)return;const s=mu(i);if(!s||a){if(tu(i)){const a=Su(e,i,o&&t&&3!==t.type_&&!lu(t.assigned_,n)?o.concat(n):void 0);if(cu(r,n,a),!tu(a))return;e.canAutoFreeze_=!1}else a&&r.add(i);if(ru(i)&&!s){if(!e.immer_.autoFreeze_&&e.unfinalizedDrafts_<1)return;if(t&&t.base_&&t.base_[n]===i&&s)return;Su(e,i),t&&t.scope_.parent_||"symbol"===typeof n||!(uu(r)?r.has(n):Object.prototype.propertyIsEnumerable.call(r,n))||Iu(e,i)}}}function Iu(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];!e.parent_&&e.immer_.autoFreeze_&&e.canAutoFreeze_&&fu(t,r)}var Fu={get(e,t){if(t===Jc)return e;const r=hu(e);if(!lu(r,t))return function(e,t,r){var n;const i=Mu(t,r);return i?"value"in i?i.value:null===(n=i.get)||void 0===n?void 0:n.call(e.draft_):void 0}(e,r,t);const n=r[t];return e.finalized_||!ru(n)?n:n===Pu(e.base_,t)?(Lu(e),e.copy_[t]=Du(n,e)):n},has:(e,t)=>t in hu(e),ownKeys:e=>Reflect.ownKeys(hu(e)),set(e,t,r){const n=Mu(hu(e),t);if(null!==n&&void 0!==n&&n.set)return n.set.call(e.draft_,r),!0;if(!e.modified_){const n=Pu(hu(e),t),a=null===n||void 0===n?void 0:n[Jc];if(a&&a.base_===r)return e.copy_[t]=r,e.assigned_[t]=!1,!0;if(((i=r)===(o=n)?0!==i||1/i===1/o:i!==i&&o!==o)&&(void 0!==r||lu(e.base_,t)))return!0;Lu(e),Ou(e)}var i,o;return e.copy_[t]===r&&(void 0!==r||t in e.copy_)||Number.isNaN(r)&&Number.isNaN(e.copy_[t])||(e.copy_[t]=r,e.assigned_[t]=!0),!0},deleteProperty:(e,t)=>(void 0!==Pu(e.base_,t)||t in e.base_?(e.assigned_[t]=!1,Lu(e),Ou(e)):delete e.assigned_[t],e.copy_&&delete e.copy_[t],!0),getOwnPropertyDescriptor(e,t){const r=hu(e),n=Reflect.getOwnPropertyDescriptor(r,t);return n?{writable:!0,configurable:1!==e.type_||"length"!==t,enumerable:n.enumerable,value:r[t]}:n},defineProperty(){$c(11)},getPrototypeOf:e=>eu(e.base_),setPrototypeOf(){$c(12)}},ku={};function Pu(e,t){const r=e[Jc];return(r?hu(r):e)[t]}function Mu(e,t){if(!(t in e))return;let r=eu(e);for(;r;){const e=Object.getOwnPropertyDescriptor(r,t);if(e)return e;r=eu(r)}}function Ou(e){e.modified_||(e.modified_=!0,e.parent_&&Ou(e.parent_))}function Lu(e){e.copy_||(e.copy_=Au(e.base_,e.scope_.immer_.useStrictShallowCopy_))}au(Fu,(e,t)=>{ku[e]=function(){return arguments[0]=arguments[0][0],t.apply(this,arguments)}}),ku.deleteProperty=function(e,t){return ku.set.call(this,e,t,void 0)},ku.set=function(e,t,r){return Fu.set.call(this,e[0],t,r,e[0])};function Du(e,t){const r=uu(e)?_u("MapSet").proxyMap_(e,t):du(e)?_u("MapSet").proxySet_(e,t):function(e,t){const r=Array.isArray(e),n={type_:r?1:0,scope_:t?t.scope_:vu(),modified_:!1,finalized_:!1,assigned_:{},parent_:t,base_:e,draft_:null,copy_:null,revoke_:null,isManual_:!1};let i=n,o=Fu;r&&(i=[n],o=ku);const{revoke:a,proxy:s}=Proxy.revocable(i,o);return n.draft_=s,n.revoke_=a,s}(e,t);return(t?t.scope_:vu()).drafts_.push(r),r}function Uu(e){if(!ru(e)||mu(e))return e;const t=e[Jc];let r,n=!0;if(t){if(!t.modified_)return t.base_;t.finalized_=!0,r=Au(e,t.scope_.immer_.useStrictShallowCopy_),n=t.scope_.immer_.shouldUseStrictIteration()}else r=Au(e,!0);return au(r,(e,t)=>{cu(r,e,Uu(t))},n),t&&(t.finalized_=!1),r}var Ru=new class{constructor(e){var t=this;this.autoFreeze_=!0,this.useStrictShallowCopy_=!1,this.useStrictIteration_=!0,this.produce=(e,t,r)=>{if("function"===typeof e&&"function"!==typeof t){const r=t;t=e;const n=this;return function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r;for(var i=arguments.length,o=new Array(i>1?i-1:0),a=1;a<i;a++)o[a-1]=arguments[a];return n.produce(e,e=>t.call(this,e,...o))}}let n;if("function"!==typeof t&&$c(6),void 0!==r&&"function"!==typeof r&&$c(7),ru(e)){const i=Bu(this),o=Du(e,void 0);let a=!0;try{n=t(o),a=!1}finally{a?wu(i):bu(i)}return xu(i,r),Eu(n,i)}if(!e||"object"!==typeof e){if(n=t(e),void 0===n&&(n=e),n===Xc&&(n=void 0),this.autoFreeze_&&fu(n,!0),r){const t=[],i=[];_u("Patches").generateReplacementPatches_(e,n,t,i),r(t,i)}return n}$c(1)},this.produceWithPatches=(e,r)=>{if("function"===typeof e)return function(r){for(var n=arguments.length,i=new Array(n>1?n-1:0),o=1;o<n;o++)i[o-1]=arguments[o];return t.produceWithPatches(r,t=>e(t,...i))};let n,i;return[this.produce(e,r,(e,t)=>{n=e,i=t}),n,i]},"boolean"===typeof(null===e||void 0===e?void 0:e.autoFreeze)&&this.setAutoFreeze(e.autoFreeze),"boolean"===typeof(null===e||void 0===e?void 0:e.useStrictShallowCopy)&&this.setUseStrictShallowCopy(e.useStrictShallowCopy),"boolean"===typeof(null===e||void 0===e?void 0:e.useStrictIteration)&&this.setUseStrictIteration(e.useStrictIteration)}createDraft(e){ru(e)||$c(8),tu(e)&&(e=function(e){tu(e)||$c(10);return Uu(e)}(e));const t=Bu(this),r=Du(e,void 0);return r[Jc].isManual_=!0,bu(t),r}finishDraft(e,t){const r=e&&e[Jc];r&&r.isManual_||$c(9);const{scope_:n}=r;return xu(n,t),Eu(void 0,n)}setAutoFreeze(e){this.autoFreeze_=e}setUseStrictShallowCopy(e){this.useStrictShallowCopy_=e}setUseStrictIteration(e){this.useStrictIteration_=e}shouldUseStrictIteration(){return this.useStrictIteration_}applyPatches(e,t){let r;for(r=t.length-1;r>=0;r--){const n=t[r];if(0===n.path.length&&"replace"===n.op){e=n.value;break}}r>-1&&(t=t.slice(r+1));const n=_u("Patches").applyPatches_;return tu(e)?n(e,t):this.produce(e,e=>n(e,t))}};Ru.produce;var zu={active:!1,index:null,dataKey:void 0,graphicalItemId:void 0,coordinate:void 0},Nu=on({name:"tooltip",initialState:{itemInteraction:{click:zu,hover:zu},axisInteraction:{click:zu,hover:zu},keyboardInteraction:zu,syncInteraction:{active:!1,index:null,dataKey:void 0,label:void 0,coordinate:void 0,sourceViewBox:void 0,graphicalItemId:void 0},tooltipItemPayloads:[],settings:{shared:void 0,trigger:"hover",axisId:0,active:!1,defaultIndex:void 0}},reducers:{addTooltipEntrySettings:{reducer(e,t){e.tooltipItemPayloads.push(t.payload)},prepare:zr()},replaceTooltipEntrySettings:{reducer(e,t){var{prev:r,next:n}=t.payload,i=pr(e).tooltipItemPayloads.indexOf(r);i>-1&&(e.tooltipItemPayloads[i]=n)},prepare:zr()},removeTooltipEntrySettings:{reducer(e,t){var r=pr(e).tooltipItemPayloads.indexOf(t.payload);r>-1&&e.tooltipItemPayloads.splice(r,1)},prepare:zr()},setTooltipSettingsState(e,t){e.settings=t.payload},setActiveMouseOverItemIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.itemInteraction.hover.active=!0,e.itemInteraction.hover.index=t.payload.activeIndex,e.itemInteraction.hover.dataKey=t.payload.activeDataKey,e.itemInteraction.hover.graphicalItemId=t.payload.activeGraphicalItemId,e.itemInteraction.hover.coordinate=t.payload.activeCoordinate},mouseLeaveChart(e){e.itemInteraction.hover.active=!1,e.axisInteraction.hover.active=!1},mouseLeaveItem(e){e.itemInteraction.hover.active=!1},setActiveClickItemIndex(e,t){e.syncInteraction.active=!1,e.itemInteraction.click.active=!0,e.keyboardInteraction.active=!1,e.itemInteraction.click.index=t.payload.activeIndex,e.itemInteraction.click.dataKey=t.payload.activeDataKey,e.itemInteraction.click.graphicalItemId=t.payload.activeGraphicalItemId,e.itemInteraction.click.coordinate=t.payload.activeCoordinate},setMouseOverAxisIndex(e,t){e.syncInteraction.active=!1,e.axisInteraction.hover.active=!0,e.keyboardInteraction.active=!1,e.axisInteraction.hover.index=t.payload.activeIndex,e.axisInteraction.hover.dataKey=t.payload.activeDataKey,e.axisInteraction.hover.coordinate=t.payload.activeCoordinate},setMouseClickAxisIndex(e,t){e.syncInteraction.active=!1,e.keyboardInteraction.active=!1,e.axisInteraction.click.active=!0,e.axisInteraction.click.index=t.payload.activeIndex,e.axisInteraction.click.dataKey=t.payload.activeDataKey,e.axisInteraction.click.coordinate=t.payload.activeCoordinate},setSyncInteraction(e,t){e.syncInteraction=t.payload},setKeyboardInteraction(e,t){e.keyboardInteraction.active=t.payload.active,e.keyboardInteraction.index=t.payload.activeIndex,e.keyboardInteraction.coordinate=t.payload.activeCoordinate}}}),{addTooltipEntrySettings:ju,replaceTooltipEntrySettings:Qu,removeTooltipEntrySettings:Vu,setTooltipSettingsState:Hu,setActiveMouseOverItemIndex:Gu,mouseLeaveItem:Ku,mouseLeaveChart:Wu,setActiveClickItemIndex:qu,setMouseOverAxisIndex:Zu,setMouseClickAxisIndex:Xu,setSyncInteraction:Yu,setKeyboardInteraction:Ju}=Nu.actions,$u=Nu.reducer,ed=on({name:"chartData",initialState:{chartData:void 0,computedData:void 0,dataStartIndex:0,dataEndIndex:0},reducers:{setChartData(e,t){if(e.chartData=t.payload,null==t.payload)return e.dataStartIndex=0,void(e.dataEndIndex=0);t.payload.length>0&&e.dataEndIndex!==t.payload.length-1&&(e.dataEndIndex=t.payload.length-1)},setComputedData(e,t){e.computedData=t.payload},setDataStartEndIndexes(e,t){var{startIndex:r,endIndex:n}=t.payload;null!=r&&(e.dataStartIndex=r),null!=n&&(e.dataEndIndex=n)}}}),{setChartData:td,setDataStartEndIndexes:rd,setComputedData:nd}=ed.actions,id=ed.reducer,od=on({name:"chartLayout",initialState:{layoutType:"horizontal",width:0,height:0,margin:{top:5,right:5,bottom:5,left:5},scale:1},reducers:{setLayout(e,t){e.layoutType=t.payload},setChartSize(e,t){e.width=t.payload.width,e.height=t.payload.height},setMargin(e,t){var r,n,i,o;e.margin.top=null!==(r=t.payload.top)&&void 0!==r?r:0,e.margin.right=null!==(n=t.payload.right)&&void 0!==n?n:0,e.margin.bottom=null!==(i=t.payload.bottom)&&void 0!==i?i:0,e.margin.left=null!==(o=t.payload.left)&&void 0!==o?o:0},setScale(e,t){e.scale=t.payload}}}),{setMargin:ad,setLayout:sd,setChartSize:ld,setScale:cd}=od.actions,ud=od.reducer;function dd(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"expected a function, instead received ".concat(typeof e);if("function"!==typeof e)throw new TypeError(t)}var hd=e=>Array.isArray(e)?e:[e];function Ad(e){const t=Array.isArray(e[0])?e[0]:e;return function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"expected all items to be functions, instead received the following types: ";if(!e.every(e=>"function"===typeof e)){const r=e.map(e=>"function"===typeof e?"function ".concat(e.name||"unnamed","()"):typeof e).join(", ");throw new TypeError("".concat(t,"[").concat(r,"]"))}}(t,"createSelector expects all input-selectors to be functions, but received the following types: "),t}Symbol(),Object.getPrototypeOf({});var fd="undefined"!==typeof WeakRef?WeakRef:class{constructor(e){this.value=e}deref(){return this.value}};function pd(){return{s:0,v:void 0,o:null,p:null}}function md(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={s:0,v:void 0,o:null,p:null};const{resultEqualityCheck:n}=t;let i,o=0;function a(){let t=r;const{length:a}=arguments;for(let e=0,r=a;e<r;e++){const r=arguments[e];if("function"===typeof r||"object"===typeof r&&null!==r){let e=t.o;null===e&&(t.o=e=new WeakMap);const n=e.get(r);void 0===n?(t=pd(),e.set(r,t)):t=n}else{let e=t.p;null===e&&(t.p=e=new Map);const n=e.get(r);void 0===n?(t=pd(),e.set(r,t)):t=n}}const s=t;let l;if(1===t.s)l=t.v;else if(l=e.apply(null,arguments),o++,n){var c,u,d;const e=null!==(c=null===(u=i)||void 0===u||null===(d=u.deref)||void 0===d?void 0:d.call(u))&&void 0!==c?c:i;null!=e&&n(e,l)&&(l=e,0!==o&&o--);i="object"===typeof l&&null!==l||"function"===typeof l?new fd(l):l}return s.s=1,s.v=l,l}return a.clearCache=()=>{r={s:0,v:void 0,o:null,p:null},a.resetResultsCount()},a.resultsCount=()=>o,a.resetResultsCount=()=>{o=0},a}function gd(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];const i="function"===typeof e?{memoize:e,memoizeOptions:r}:e,o=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];let n,o=0,a=0,s={},l=t.pop();"object"===typeof l&&(s=l,l=t.pop()),dd(l,"createSelector expects an output function after the inputs, but received: [".concat(typeof l,"]"));const c=ot(ot({},i),s),{memoize:u,memoizeOptions:d=[],argsMemoize:h=md,argsMemoizeOptions:A=[],devModeChecks:f={}}=c,p=hd(d),m=hd(A),g=Ad(t),y=u(function(){return o++,l.apply(null,arguments)},...p);const _=h(function(){a++;const e=function(e,t){const r=[],{length:n}=e;for(let i=0;i<n;i++)r.push(e[i].apply(null,t));return r}(g,arguments);return n=y.apply(null,e),n},...m);return Object.assign(_,{resultFunc:l,memoizedResultFunc:y,dependencies:g,dependencyRecomputations:()=>a,resetDependencyRecomputations:()=>{a=0},lastResult:()=>n,recomputations:()=>o,resetRecomputations:()=>{o=0},memoize:u,argsMemoize:h})};return Object.assign(o,{withTypes:()=>o}),o}var yd=gd(md),_d=Object.assign(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:yd;!function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"expected an object, instead received ".concat(typeof e);if("object"!==typeof e)throw new TypeError(t)}(e,"createStructuredSelector expects first argument to be an object where each property is a selector, instead received a ".concat(typeof e));const r=Object.keys(e),n=t(r.map(t=>e[t]),function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((e,t,n)=>(e[r[n]]=t,e),{})});return n},{withTypes:()=>_d}),vd=r(8443),xd=(0,n.createContext)(null),wd=e=>e,bd=()=>{var e=(0,n.useContext)(xd);return e?e.store.dispatch:wd},Bd=()=>{},Cd=()=>Bd,Ed=(e,t)=>e===t;function Sd(e){var t=(0,n.useContext)(xd);return(0,vd.useSyncExternalStoreWithSelector)(t?t.subscription.addNestedSub:Cd,t?t.store.getState:Bd,t?t.store.getState:Bd,t?e:Bd,Ed)}var Td=r(3821),Id=r.n(Td),Fd=e=>e.legend.settings,kd=yd([e=>e.legend.payload,Fd],(e,t)=>{var{itemSorter:r}=t,n=e.flat(1);return r?Id()(n,r):n});function Pd(e,t){if((i=e.length)>1)for(var r,n,i,o=1,a=e[t[0]],s=a.length;o<i;++o)for(n=a,a=e[t[o]],r=0;r<s;++r)a[r][1]+=a[r][0]=isNaN(n[r][1])?n[r][0]:n[r][1]}Array.prototype.slice;function Md(e){return"object"===typeof e&&"length"in e?e:Array.from(e)}function Od(e){return function(){return e}}function Ld(e){for(var t=e.length,r=new Array(t);--t>=0;)r[t]=t;return r}function Dd(e,t){return e[t]}function Ud(e){const t=[];return t.key=e,t}function Rd(e,t,r){return Array.isArray(e)&&e&&t+r!==0?e.slice(t,r+1):e}function zd(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Nd(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?zd(Object(r),!0).forEach(function(t){jd(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):zd(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function jd(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Qd(e,t,r){return Bc(e)||Bc(t)?r:yc(t)?dc()(e,t,r):"function"===typeof t?t(e):r}var Vd=(e,t)=>"horizontal"===e&&"xAxis"===t||"vertical"===e&&"yAxis"===t||"centric"===e&&"angleAxis"===t||"radial"===e&&"radiusAxis"===t,Hd=(e,t,r,n)=>{if(n)return e.map(e=>e.coordinate);var i,o,a=e.map(e=>(e.coordinate===t&&(i=!0),e.coordinate===r&&(o=!0),e.coordinate));return i||a.push(t),o||a.push(r),a},Gd=(e,t,r)=>{if(!e)return null;var{duplicateDomain:n,type:i,range:o,scale:a,realScaleType:s,isCategorical:l,categoricalDomain:c,tickCount:u,ticks:d,niceTicks:h,axisType:A}=e;if(!a)return null;var f="scaleBand"===s&&a.bandwidth?a.bandwidth()/2:2,p=(t||r)&&"category"===i&&a.bandwidth?a.bandwidth()/f:0;return p="angleAxis"===A&&o&&o.length>=2?2*fc(o[0]-o[1])*p:p,t&&(d||h)?(d||h||[]).map((e,t)=>{var r=n?n.indexOf(e):e;return{coordinate:a(r)+p,value:e,offset:p,index:t}}).filter(e=>!pc(e.coordinate)):l&&c?c.map((e,t)=>({coordinate:a(e)+p,value:e,index:t,offset:p})):a.ticks&&!r&&null!=u?a.ticks(u).map((e,t)=>({coordinate:a(e)+p,value:e,offset:p,index:t})):a.domain().map((e,t)=>({coordinate:a(e)+p,value:n?n[e]:e,index:t,offset:p}))},Kd=1e-4,Wd={sign:e=>{var t,r=e.length;if(!(r<=0)){var n=null===(t=e[0])||void 0===t?void 0:t.length;if(!(null==n||n<=0))for(var i=0;i<n;++i)for(var o=0,a=0,s=0;s<r;++s){var l=e[s],c=null===l||void 0===l?void 0:l[i];if(null!=c){var u=c[1],d=c[0],h=pc(u)?d:u;h>=0?(c[0]=o,c[1]=o+h,o=u):(c[0]=a,c[1]=a+h,a=u)}}}},expand:function(e,t){if((n=e.length)>0){for(var r,n,i,o=0,a=e[0].length;o<a;++o){for(i=r=0;r<n;++r)i+=e[r][o][1]||0;if(i)for(r=0;r<n;++r)e[r][o][1]/=i}Pd(e,t)}},none:Pd,silhouette:function(e,t){if((r=e.length)>0){for(var r,n=0,i=e[t[0]],o=i.length;n<o;++n){for(var a=0,s=0;a<r;++a)s+=e[a][n][1]||0;i[n][1]+=i[n][0]=-s/2}Pd(e,t)}},wiggle:function(e,t){if((i=e.length)>0&&(n=(r=e[t[0]]).length)>0){for(var r,n,i,o=0,a=1;a<n;++a){for(var s=0,l=0,c=0;s<i;++s){for(var u=e[t[s]],d=u[a][1]||0,h=(d-(u[a-1][1]||0))/2,A=0;A<s;++A){var f=e[t[A]];h+=(f[a][1]||0)-(f[a-1][1]||0)}l+=d,c+=h*d}r[a-1][1]+=r[a-1][0]=o,l&&(o-=c/l)}r[a-1][1]+=r[a-1][0]=o,Pd(e,t)}},positive:e=>{var t,r=e.length;if(!(r<=0)){var n=null===(t=e[0])||void 0===t?void 0:t.length;if(!(null==n||n<=0))for(var i=0;i<n;++i)for(var o=0,a=0;a<r;++a){var s=e[a],l=null===s||void 0===s?void 0:s[i];if(null!=l){var c=pc(l[1])?l[0]:l[1];c>=0?(l[0]=o,l[1]=o+c,o=l[1]):(l[0]=0,l[1]=0)}}}}},qd=(e,t,r)=>{var n,i=null!==(n=Wd[r])&&void 0!==n?n:Pd,o=function(){var e=Od([]),t=Ld,r=Pd,n=Dd;function i(i){var o,a,s=Array.from(e.apply(this,arguments),Ud),l=s.length,c=-1;for(const e of i)for(o=0,++c;o<l;++o)(s[o][c]=[0,+n(e,s[o].key,c,i)]).data=e;for(o=0,a=Md(t(s));o<l;++o)s[a[o]].index=o;return r(s,a),s}return i.keys=function(t){return arguments.length?(e="function"===typeof t?t:Od(Array.from(t)),i):e},i.value=function(e){return arguments.length?(n="function"===typeof e?e:Od(+e),i):n},i.order=function(e){return arguments.length?(t=null==e?Ld:"function"===typeof e?e:Od(Array.from(e)),i):t},i.offset=function(e){return arguments.length?(r=null==e?Pd:e,i):r},i}().keys(t).value((e,t)=>Number(Qd(e,t,0))).order(Ld).offset(i),a=o(e);return a.forEach((r,n)=>{r.forEach((r,i)=>{var o=Qd(e[i],t[n],0);Array.isArray(o)&&2===o.length&&gc(o[0])&&gc(o[1])&&(r[0]=o[0],r[1]=o[1])})}),a};var Zd=e=>{var{axis:t,ticks:r,offset:n,bandSize:i,entry:o,index:a}=e;if("category"===t.type)return r[a]?r[a].coordinate+n:null;var s=Qd(o,t.dataKey,t.scale.domain()[a]);return Bc(s)?null:t.scale(s)-i/2+n},Xd=(e,t,r)=>{var n;if(null!=e)return n=Object.keys(e).reduce((n,i)=>{var o=e[i];if(!o)return n;var{stackedData:a}=o,s=a.reduce((e,n)=>{var i=(e=>{var t=e.flat(2).filter(gc);return[Math.min(...t),Math.max(...t)]})(Rd(n,t,r));return Lc(i[0])&&Lc(i[1])?[Math.min(e[0],i[0]),Math.max(e[1],i[1])]:e},[1/0,-1/0]);return[Math.min(s[0],n[0]),Math.max(s[1],n[1])]},[1/0,-1/0]),[n[0]===1/0?0:n[0],n[1]===-1/0?0:n[1]]},Yd=/^dataMin[\s]*-[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,Jd=/^dataMax[\s]*\+[\s]*([0-9]+([.]{1}[0-9]+){0,1})$/,$d=(e,t,r)=>{if(e&&e.scale&&e.scale.bandwidth){var n=e.scale.bandwidth();if(!r||n>0)return n}if(e&&t&&t.length>=2){for(var i=Id()(t,e=>e.coordinate),o=1/0,a=1,s=i.length;a<s;a++){var l=i[a],c=i[a-1];o=Math.min(((null===l||void 0===l?void 0:l.coordinate)||0)-((null===c||void 0===c?void 0:c.coordinate)||0),o)}return o===1/0?0:o}return r?void 0:0};function eh(e){var{tooltipEntrySettings:t,dataKey:r,payload:n,value:i,name:o}=e;return Nd(Nd({},t),{},{dataKey:r,payload:n,value:i,name:o})}function th(e,t){return e?String(e):"string"===typeof t?t:void 0}var rh=e=>e.layout.width,nh=e=>e.layout.height,ih=e=>e.layout.scale,oh=e=>e.layout.margin,ah=yd(e=>e.cartesianAxis.xAxis,e=>Object.values(e)),sh=yd(e=>e.cartesianAxis.yAxis,e=>Object.values(e)),lh="data-recharts-item-index",ch="data-recharts-item-id";function uh(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function dh(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?uh(Object(r),!0).forEach(function(t){hh(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uh(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function hh(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Ah=yd([rh,nh,oh,e=>e.brush.height,function(e){return sh(e).reduce((e,t)=>"left"!==t.orientation||t.mirror||t.hide?e:e+("number"===typeof t.width?t.width:60),0)},function(e){return sh(e).reduce((e,t)=>"right"!==t.orientation||t.mirror||t.hide?e:e+("number"===typeof t.width?t.width:60),0)},function(e){return ah(e).reduce((e,t)=>"top"!==t.orientation||t.mirror||t.hide?e:e+t.height,0)},function(e){return ah(e).reduce((e,t)=>"bottom"!==t.orientation||t.mirror||t.hide?e:e+t.height,0)},Fd,e=>e.legend.size],(e,t,r,n,i,o,a,s,l,c)=>{var u={left:(r.left||0)+i,right:(r.right||0)+o},d=dh(dh({},{top:(r.top||0)+a,bottom:(r.bottom||0)+s}),u),h=d.bottom;d.bottom+=n,d=((e,t,r)=>{if(t&&r){var{width:n,height:i}=r,{align:o,verticalAlign:a,layout:s}=t;if(("vertical"===s||"horizontal"===s&&"middle"===a)&&"center"!==o&&gc(e[o]))return Nd(Nd({},e),{},{[o]:e[o]+(n||0)});if(("horizontal"===s||"vertical"===s&&"center"===o)&&"middle"!==a&&gc(e[a]))return Nd(Nd({},e),{},{[a]:e[a]+(i||0)})}return e})(d,l,c);var A=e-d.left-d.right,f=t-d.top-d.bottom;return dh(dh({brushBottom:h},d),{},{width:Math.max(A,0),height:Math.max(f,0)})}),fh=yd(Ah,e=>({x:e.left,y:e.top,width:e.width,height:e.height})),ph=yd(rh,nh,(e,t)=>({x:0,y:0,width:e,height:t})),mh=(0,n.createContext)(null),gh=()=>null!=(0,n.useContext)(mh),yh=e=>e.brush,_h=yd([yh,Ah,oh],(e,t,r)=>({height:e.height,x:gc(e.x)?e.x:t.left,y:gc(e.y)?e.y:t.top+t.height+t.brushBottom-((null===r||void 0===r?void 0:r.bottom)||0),width:gc(e.width)?e.width:t.width}));function vh(e){if(e)return{x:e.x,y:e.y,upperWidth:"upperWidth"in e?e.upperWidth:e.width,lowerWidth:"lowerWidth"in e?e.lowerWidth:e.width,width:e.width,height:e.height}}var xh=()=>{var e,t=gh(),r=Sd(fh),n=Sd(_h),i=null===(e=Sd(yh))||void 0===e?void 0:e.padding;return t&&n&&i?{width:n.width-i.left-i.right,height:n.height-i.top-i.bottom,x:i.left,y:i.top}:r},wh={top:0,bottom:0,left:0,right:0,width:0,height:0,brushBottom:0},bh=()=>{var e;return null!==(e=Sd(Ah))&&void 0!==e?e:wh},Bh=()=>Sd(rh),Ch=()=>Sd(nh),Eh=e=>e.layout.layoutType,Sh=()=>Sd(Eh),Th=e=>{var t=bd(),r=gh(),{width:i,height:o}=e,a=Vc(),s=i,l=o;return a&&(s=a.width>0?a.width:i,l=a.height>0?a.height:o),(0,n.useEffect)(()=>{!r&&Dc(s)&&Dc(l)&&t(ld({width:s,height:l}))},[t,r,s,l]),null},Ih=r(9859),Fh=r.n(Ih);function kh(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e)}return this}function Ph(e,t){switch(arguments.length){case 0:break;case 1:"function"===typeof e?this.interpolator(e):this.range(e);break;default:this.domain(e),"function"===typeof t?this.interpolator(t):this.range(t)}return this}class Mh extends Map{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Uh;if(super(),Object.defineProperties(this,{_intern:{value:new Map},_key:{value:t}}),null!=e)for(const[r,n]of e)this.set(r,n)}get(e){return super.get(Oh(this,e))}has(e){return super.has(Oh(this,e))}set(e,t){return super.set(Lh(this,e),t)}delete(e){return super.delete(Dh(this,e))}}Set;function Oh(e,t){let{_intern:r,_key:n}=e;const i=n(t);return r.has(i)?r.get(i):t}function Lh(e,t){let{_intern:r,_key:n}=e;const i=n(t);return r.has(i)?r.get(i):(r.set(i,t),t)}function Dh(e,t){let{_intern:r,_key:n}=e;const i=n(t);return r.has(i)&&(t=r.get(i),r.delete(i)),t}function Uh(e){return null!==e&&"object"===typeof e?e.valueOf():e}const Rh=Symbol("implicit");function zh(){var e=new Mh,t=[],r=[],n=Rh;function i(i){let o=e.get(i);if(void 0===o){if(n!==Rh)return n;e.set(i,o=t.push(i)-1)}return r[o%r.length]}return i.domain=function(r){if(!arguments.length)return t.slice();t=[],e=new Mh;for(const n of r)e.has(n)||e.set(n,t.push(n)-1);return i},i.range=function(e){return arguments.length?(r=Array.from(e),i):r.slice()},i.unknown=function(e){return arguments.length?(n=e,i):n},i.copy=function(){return zh(t,r).unknown(n)},kh.apply(i,arguments),i}function Nh(){var e,t,r=zh().unknown(void 0),n=r.domain,i=r.range,o=0,a=1,s=!1,l=0,c=0,u=.5;function d(){var r=n().length,d=a<o,h=d?a:o,A=d?o:a;e=(A-h)/Math.max(1,r-l+2*c),s&&(e=Math.floor(e)),h+=(A-h-e*(r-l))*u,t=e*(1-l),s&&(h=Math.round(h),t=Math.round(t));var f=function(e,t,r){e=+e,t=+t,r=(i=arguments.length)<2?(t=e,e=0,1):i<3?1:+r;for(var n=-1,i=0|Math.max(0,Math.ceil((t-e)/r)),o=new Array(i);++n<i;)o[n]=e+n*r;return o}(r).map(function(t){return h+e*t});return i(d?f.reverse():f)}return delete r.unknown,r.domain=function(e){return arguments.length?(n(e),d()):n()},r.range=function(e){return arguments.length?([o,a]=e,o=+o,a=+a,d()):[o,a]},r.rangeRound=function(e){return[o,a]=e,o=+o,a=+a,s=!0,d()},r.bandwidth=function(){return t},r.step=function(){return e},r.round=function(e){return arguments.length?(s=!!e,d()):s},r.padding=function(e){return arguments.length?(l=Math.min(1,c=+e),d()):l},r.paddingInner=function(e){return arguments.length?(l=Math.min(1,e),d()):l},r.paddingOuter=function(e){return arguments.length?(c=+e,d()):c},r.align=function(e){return arguments.length?(u=Math.max(0,Math.min(1,e)),d()):u},r.copy=function(){return Nh(n(),[o,a]).round(s).paddingInner(l).paddingOuter(c).align(u)},kh.apply(d(),arguments)}function jh(e){var t=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return jh(t())},e}function Qh(){return jh(Nh.apply(null,arguments).paddingInner(1))}const Vh=Math.sqrt(50),Hh=Math.sqrt(10),Gh=Math.sqrt(2);function Kh(e,t,r){const n=(t-e)/Math.max(0,r),i=Math.floor(Math.log10(n)),o=n/Math.pow(10,i),a=o>=Vh?10:o>=Hh?5:o>=Gh?2:1;let s,l,c;return i<0?(c=Math.pow(10,-i)/a,s=Math.round(e*c),l=Math.round(t*c),s/c<e&&++s,l/c>t&&--l,c=-c):(c=Math.pow(10,i)*a,s=Math.round(e/c),l=Math.round(t/c),s*c<e&&++s,l*c>t&&--l),l<s&&.5<=r&&r<2?Kh(e,t,2*r):[s,l,c]}function Wh(e,t,r){if(!((r=+r)>0))return[];if((e=+e)===(t=+t))return[e];const n=t<e,[i,o,a]=n?Kh(t,e,r):Kh(e,t,r);if(!(o>=i))return[];const s=o-i+1,l=new Array(s);if(n)if(a<0)for(let c=0;c<s;++c)l[c]=(o-c)/-a;else for(let c=0;c<s;++c)l[c]=(o-c)*a;else if(a<0)for(let c=0;c<s;++c)l[c]=(i+c)/-a;else for(let c=0;c<s;++c)l[c]=(i+c)*a;return l}function qh(e,t,r){return Kh(e=+e,t=+t,r=+r)[2]}function Zh(e,t,r){r=+r;const n=(t=+t)<(e=+e),i=n?qh(t,e,r):qh(e,t,r);return(n?-1:1)*(i<0?1/-i:i)}function Xh(e,t){return null==e||null==t?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function Yh(e,t){return null==e||null==t?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function Jh(e){let t,r,n;function i(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(i<o){if(0!==t(n,n))return o;do{const t=i+o>>>1;r(e[t],n)<0?i=t+1:o=t}while(i<o)}return i}return 2!==e.length?(t=Xh,r=(t,r)=>Xh(e(t),r),n=(t,r)=>e(t)-r):(t=e===Xh||e===Yh?e:$h,r=e,n=e),{left:i,center:function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const o=i(e,t,r,(arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length)-1);return o>r&&n(e[o-1],t)>-n(e[o],t)?o-1:o},right:function(e,n){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length;if(i<o){if(0!==t(n,n))return o;do{const t=i+o>>>1;r(e[t],n)<=0?i=t+1:o=t}while(i<o)}return i}}}function $h(){return 0}function eA(e){return null===e?NaN:+e}const tA=Jh(Xh),rA=tA.right,nA=(tA.left,Jh(eA).center,rA);function iA(e,t,r){e.prototype=t.prototype=r,r.constructor=e}function oA(e,t){var r=Object.create(e.prototype);for(var n in t)r[n]=t[n];return r}function aA(){}var sA=.7,lA=1/sA,cA="\\s*([+-]?\\d+)\\s*",uA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",dA="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",hA=/^#([0-9a-f]{3,8})$/,AA=new RegExp("^rgb\\(".concat(cA,",").concat(cA,",").concat(cA,"\\)$")),fA=new RegExp("^rgb\\(".concat(dA,",").concat(dA,",").concat(dA,"\\)$")),pA=new RegExp("^rgba\\(".concat(cA,",").concat(cA,",").concat(cA,",").concat(uA,"\\)$")),mA=new RegExp("^rgba\\(".concat(dA,",").concat(dA,",").concat(dA,",").concat(uA,"\\)$")),gA=new RegExp("^hsl\\(".concat(uA,",").concat(dA,",").concat(dA,"\\)$")),yA=new RegExp("^hsla\\(".concat(uA,",").concat(dA,",").concat(dA,",").concat(uA,"\\)$")),_A={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function vA(){return this.rgb().formatHex()}function xA(){return this.rgb().formatRgb()}function wA(e){var t,r;return e=(e+"").trim().toLowerCase(),(t=hA.exec(e))?(r=t[1].length,t=parseInt(t[1],16),6===r?bA(t):3===r?new EA(t>>8&15|t>>4&240,t>>4&15|240&t,(15&t)<<4|15&t,1):8===r?BA(t>>24&255,t>>16&255,t>>8&255,(255&t)/255):4===r?BA(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|240&t,((15&t)<<4|15&t)/255):null):(t=AA.exec(e))?new EA(t[1],t[2],t[3],1):(t=fA.exec(e))?new EA(255*t[1]/100,255*t[2]/100,255*t[3]/100,1):(t=pA.exec(e))?BA(t[1],t[2],t[3],t[4]):(t=mA.exec(e))?BA(255*t[1]/100,255*t[2]/100,255*t[3]/100,t[4]):(t=gA.exec(e))?PA(t[1],t[2]/100,t[3]/100,1):(t=yA.exec(e))?PA(t[1],t[2]/100,t[3]/100,t[4]):_A.hasOwnProperty(e)?bA(_A[e]):"transparent"===e?new EA(NaN,NaN,NaN,0):null}function bA(e){return new EA(e>>16&255,e>>8&255,255&e,1)}function BA(e,t,r,n){return n<=0&&(e=t=r=NaN),new EA(e,t,r,n)}function CA(e,t,r,n){return 1===arguments.length?((i=e)instanceof aA||(i=wA(i)),i?new EA((i=i.rgb()).r,i.g,i.b,i.opacity):new EA):new EA(e,t,r,null==n?1:n);var i}function EA(e,t,r,n){this.r=+e,this.g=+t,this.b=+r,this.opacity=+n}function SA(){return"#".concat(kA(this.r)).concat(kA(this.g)).concat(kA(this.b))}function TA(){const e=IA(this.opacity);return"".concat(1===e?"rgb(":"rgba(").concat(FA(this.r),", ").concat(FA(this.g),", ").concat(FA(this.b)).concat(1===e?")":", ".concat(e,")"))}function IA(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function FA(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function kA(e){return((e=FA(e))<16?"0":"")+e.toString(16)}function PA(e,t,r,n){return n<=0?e=t=r=NaN:r<=0||r>=1?e=t=NaN:t<=0&&(e=NaN),new OA(e,t,r,n)}function MA(e){if(e instanceof OA)return new OA(e.h,e.s,e.l,e.opacity);if(e instanceof aA||(e=wA(e)),!e)return new OA;if(e instanceof OA)return e;var t=(e=e.rgb()).r/255,r=e.g/255,n=e.b/255,i=Math.min(t,r,n),o=Math.max(t,r,n),a=NaN,s=o-i,l=(o+i)/2;return s?(a=t===o?(r-n)/s+6*(r<n):r===o?(n-t)/s+2:(t-r)/s+4,s/=l<.5?o+i:2-o-i,a*=60):s=l>0&&l<1?0:a,new OA(a,s,l,e.opacity)}function OA(e,t,r,n){this.h=+e,this.s=+t,this.l=+r,this.opacity=+n}function LA(e){return(e=(e||0)%360)<0?e+360:e}function DA(e){return Math.max(0,Math.min(1,e||0))}function UA(e,t,r){return 255*(e<60?t+(r-t)*e/60:e<180?r:e<240?t+(r-t)*(240-e)/60:t)}function RA(e,t,r,n,i){var o=e*e,a=o*e;return((1-3*e+3*o-a)*t+(4-6*o+3*a)*r+(1+3*e+3*o-3*a)*n+a*i)/6}iA(aA,wA,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:vA,formatHex:vA,formatHex8:function(){return this.rgb().formatHex8()},formatHsl:function(){return MA(this).formatHsl()},formatRgb:xA,toString:xA}),iA(EA,CA,oA(aA,{brighter(e){return e=null==e?lA:Math.pow(lA,e),new EA(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=null==e?sA:Math.pow(sA,e),new EA(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new EA(FA(this.r),FA(this.g),FA(this.b),IA(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:SA,formatHex:SA,formatHex8:function(){return"#".concat(kA(this.r)).concat(kA(this.g)).concat(kA(this.b)).concat(kA(255*(isNaN(this.opacity)?1:this.opacity)))},formatRgb:TA,toString:TA})),iA(OA,function(e,t,r,n){return 1===arguments.length?MA(e):new OA(e,t,r,null==n?1:n)},oA(aA,{brighter(e){return e=null==e?lA:Math.pow(lA,e),new OA(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=null==e?sA:Math.pow(sA,e),new OA(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+360*(this.h<0),t=isNaN(e)||isNaN(this.s)?0:this.s,r=this.l,n=r+(r<.5?r:1-r)*t,i=2*r-n;return new EA(UA(e>=240?e-240:e+120,i,n),UA(e,i,n),UA(e<120?e+240:e-120,i,n),this.opacity)},clamp(){return new OA(LA(this.h),DA(this.s),DA(this.l),IA(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=IA(this.opacity);return"".concat(1===e?"hsl(":"hsla(").concat(LA(this.h),", ").concat(100*DA(this.s),"%, ").concat(100*DA(this.l),"%").concat(1===e?")":", ".concat(e,")"))}}));const zA=e=>()=>e;function NA(e,t){return function(r){return e+r*t}}function jA(e){return 1===(e=+e)?QA:function(t,r){return r-t?function(e,t,r){return e=Math.pow(e,r),t=Math.pow(t,r)-e,r=1/r,function(n){return Math.pow(e+n*t,r)}}(t,r,e):zA(isNaN(t)?r:t)}}function QA(e,t){var r=t-e;return r?NA(e,r):zA(isNaN(e)?t:e)}const VA=function e(t){var r=jA(t);function n(e,t){var n=r((e=CA(e)).r,(t=CA(t)).r),i=r(e.g,t.g),o=r(e.b,t.b),a=QA(e.opacity,t.opacity);return function(t){return e.r=n(t),e.g=i(t),e.b=o(t),e.opacity=a(t),e+""}}return n.gamma=e,n}(1);function HA(e){return function(t){var r,n,i=t.length,o=new Array(i),a=new Array(i),s=new Array(i);for(r=0;r<i;++r)n=CA(t[r]),o[r]=n.r||0,a[r]=n.g||0,s[r]=n.b||0;return o=e(o),a=e(a),s=e(s),n.opacity=1,function(e){return n.r=o(e),n.g=a(e),n.b=s(e),n+""}}}HA(function(e){var t=e.length-1;return function(r){var n=r<=0?r=0:r>=1?(r=1,t-1):Math.floor(r*t),i=e[n],o=e[n+1],a=n>0?e[n-1]:2*i-o,s=n<t-1?e[n+2]:2*o-i;return RA((r-n/t)*t,a,i,o,s)}}),HA(function(e){var t=e.length;return function(r){var n=Math.floor(((r%=1)<0?++r:r)*t),i=e[(n+t-1)%t],o=e[n%t],a=e[(n+1)%t],s=e[(n+2)%t];return RA((r-n/t)*t,i,o,a,s)}});function GA(e,t){var r,n=t?t.length:0,i=e?Math.min(n,e.length):0,o=new Array(i),a=new Array(n);for(r=0;r<i;++r)o[r]=$A(e[r],t[r]);for(;r<n;++r)a[r]=t[r];return function(e){for(r=0;r<i;++r)a[r]=o[r](e);return a}}function KA(e,t){var r=new Date;return e=+e,t=+t,function(n){return r.setTime(e*(1-n)+t*n),r}}function WA(e,t){return e=+e,t=+t,function(r){return e*(1-r)+t*r}}function qA(e,t){var r,n={},i={};for(r in null!==e&&"object"===typeof e||(e={}),null!==t&&"object"===typeof t||(t={}),t)r in e?n[r]=$A(e[r],t[r]):i[r]=t[r];return function(e){for(r in n)i[r]=n[r](e);return i}}var ZA=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,XA=new RegExp(ZA.source,"g");function YA(e,t){var r,n,i,o=ZA.lastIndex=XA.lastIndex=0,a=-1,s=[],l=[];for(e+="",t+="";(r=ZA.exec(e))&&(n=XA.exec(t));)(i=n.index)>o&&(i=t.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(r=r[0])===(n=n[0])?s[a]?s[a]+=n:s[++a]=n:(s[++a]=null,l.push({i:a,x:WA(r,n)})),o=XA.lastIndex;return o<t.length&&(i=t.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?l[0]?function(e){return function(t){return e(t)+""}}(l[0].x):function(e){return function(){return e}}(t):(t=l.length,function(e){for(var r,n=0;n<t;++n)s[(r=l[n]).i]=r.x(e);return s.join("")})}function JA(e,t){t||(t=[]);var r,n=e?Math.min(t.length,e.length):0,i=t.slice();return function(o){for(r=0;r<n;++r)i[r]=e[r]*(1-o)+t[r]*o;return i}}function $A(e,t){var r,n,i=typeof t;return null==t||"boolean"===i?zA(t):("number"===i?WA:"string"===i?(r=wA(t))?(t=r,VA):YA:t instanceof wA?VA:t instanceof Date?KA:(n=t,!ArrayBuffer.isView(n)||n instanceof DataView?Array.isArray(t)?GA:"function"!==typeof t.valueOf&&"function"!==typeof t.toString||isNaN(t)?qA:WA:JA))(e,t)}function ef(e,t){return e=+e,t=+t,function(r){return Math.round(e*(1-r)+t*r)}}function tf(e){return+e}var rf=[0,1];function nf(e){return e}function of(e,t){return(t-=e=+e)?function(r){return(r-e)/t}:(r=isNaN(t)?NaN:.5,function(){return r});var r}function af(e,t,r){var n=e[0],i=e[1],o=t[0],a=t[1];return i<n?(n=of(i,n),o=r(a,o)):(n=of(n,i),o=r(o,a)),function(e){return o(n(e))}}function sf(e,t,r){var n=Math.min(e.length,t.length)-1,i=new Array(n),o=new Array(n),a=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++a<n;)i[a]=of(e[a],e[a+1]),o[a]=r(t[a],t[a+1]);return function(t){var r=nA(e,t,1,n)-1;return o[r](i[r](t))}}function lf(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function cf(){var e,t,r,n,i,o,a=rf,s=rf,l=$A,c=nf;function u(){var e=Math.min(a.length,s.length);return c!==nf&&(c=function(e,t){var r;return e>t&&(r=e,e=t,t=r),function(r){return Math.max(e,Math.min(t,r))}}(a[0],a[e-1])),n=e>2?sf:af,i=o=null,d}function d(t){return null==t||isNaN(t=+t)?r:(i||(i=n(a.map(e),s,l)))(e(c(t)))}return d.invert=function(r){return c(t((o||(o=n(s,a.map(e),WA)))(r)))},d.domain=function(e){return arguments.length?(a=Array.from(e,tf),u()):a.slice()},d.range=function(e){return arguments.length?(s=Array.from(e),u()):s.slice()},d.rangeRound=function(e){return s=Array.from(e),l=ef,u()},d.clamp=function(e){return arguments.length?(c=!!e||nf,u()):c!==nf},d.interpolate=function(e){return arguments.length?(l=e,u()):l},d.unknown=function(e){return arguments.length?(r=e,d):r},function(r,n){return e=r,t=n,u()}}function uf(){return cf()(nf,nf)}var df,hf=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Af(e){if(!(t=hf.exec(e)))throw new Error("invalid format: "+e);var t;return new ff({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}function ff(e){this.fill=void 0===e.fill?" ":e.fill+"",this.align=void 0===e.align?">":e.align+"",this.sign=void 0===e.sign?"-":e.sign+"",this.symbol=void 0===e.symbol?"":e.symbol+"",this.zero=!!e.zero,this.width=void 0===e.width?void 0:+e.width,this.comma=!!e.comma,this.precision=void 0===e.precision?void 0:+e.precision,this.trim=!!e.trim,this.type=void 0===e.type?"":e.type+""}function pf(e,t){if(!isFinite(e)||0===e)return null;var r=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"),n=e.slice(0,r);return[n.length>1?n[0]+n.slice(2):n,+e.slice(r+1)]}function mf(e){return(e=pf(Math.abs(e)))?e[1]:NaN}function gf(e,t){var r=pf(e,t);if(!r)return e+"";var n=r[0],i=r[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}Af.prototype=ff.prototype,ff.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};const yf={"%":(e,t)=>(100*e).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:function(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)},e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>gf(100*e,t),r:gf,s:function(e,t){var r=pf(e,t);if(!r)return df=void 0,e.toPrecision(t);var n=r[0],i=r[1],o=i-(df=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=n.length;return o===a?n:o>a?n+new Array(o-a+1).join("0"):o>0?n.slice(0,o)+"."+n.slice(o):"0."+new Array(1-o).join("0")+pf(e,Math.max(0,t+o-1))[0]},X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function _f(e){return e}var vf,xf,wf,bf=Array.prototype.map,Bf=["y","z","a","f","p","n","\xb5","m","","k","M","G","T","P","E","Z","Y"];function Cf(e){var t,r,n=void 0===e.grouping||void 0===e.thousands?_f:(t=bf.call(e.grouping,Number),r=e.thousands+"",function(e,n){for(var i=e.length,o=[],a=0,s=t[0],l=0;i>0&&s>0&&(l+s+1>n&&(s=Math.max(1,n-l)),o.push(e.substring(i-=s,i+s)),!((l+=s+1)>n));)s=t[a=(a+1)%t.length];return o.reverse().join(r)}),i=void 0===e.currency?"":e.currency[0]+"",o=void 0===e.currency?"":e.currency[1]+"",a=void 0===e.decimal?".":e.decimal+"",s=void 0===e.numerals?_f:function(e){return function(t){return t.replace(/[0-9]/g,function(t){return e[+t]})}}(bf.call(e.numerals,String)),l=void 0===e.percent?"%":e.percent+"",c=void 0===e.minus?"\u2212":e.minus+"",u=void 0===e.nan?"NaN":e.nan+"";function d(e,t){var r=(e=Af(e)).fill,d=e.align,h=e.sign,A=e.symbol,f=e.zero,p=e.width,m=e.comma,g=e.precision,y=e.trim,_=e.type;"n"===_?(m=!0,_="g"):yf[_]||(void 0===g&&(g=12),y=!0,_="g"),(f||"0"===r&&"="===d)&&(f=!0,r="0",d="=");var v=(t&&void 0!==t.prefix?t.prefix:"")+("$"===A?i:"#"===A&&/[boxX]/.test(_)?"0"+_.toLowerCase():""),x=("$"===A?o:/[%p]/.test(_)?l:"")+(t&&void 0!==t.suffix?t.suffix:""),w=yf[_],b=/[defgprs%]/.test(_);function B(e){var t,i,o,l=v,A=x;if("c"===_)A=w(e)+A,e="";else{var B=(e=+e)<0||1/e<0;if(e=isNaN(e)?u:w(Math.abs(e),g),y&&(e=function(e){e:for(var t,r=e.length,n=1,i=-1;n<r;++n)switch(e[n]){case".":i=t=n;break;case"0":0===i&&(i=n),t=n;break;default:if(!+e[n])break e;i>0&&(i=0)}return i>0?e.slice(0,i)+e.slice(t+1):e}(e)),B&&0===+e&&"+"!==h&&(B=!1),l=(B?"("===h?h:c:"-"===h||"("===h?"":h)+l,A=("s"!==_||isNaN(e)||void 0===df?"":Bf[8+df/3])+A+(B&&"("===h?")":""),b)for(t=-1,i=e.length;++t<i;)if(48>(o=e.charCodeAt(t))||o>57){A=(46===o?a+e.slice(t+1):e.slice(t))+A,e=e.slice(0,t);break}}m&&!f&&(e=n(e,1/0));var C=l.length+e.length+A.length,E=C<p?new Array(p-C+1).join(r):"";switch(m&&f&&(e=n(E+e,E.length?p-A.length:1/0),E=""),d){case"<":e=l+e+A+E;break;case"=":e=l+E+e+A;break;case"^":e=E.slice(0,C=E.length>>1)+l+e+A+E.slice(C);break;default:e=E+l+e+A}return s(e)}return g=void 0===g?6:/[gprs]/.test(_)?Math.max(1,Math.min(21,g)):Math.max(0,Math.min(20,g)),B.toString=function(){return e+""},B}return{format:d,formatPrefix:function(e,t){var r=3*Math.max(-8,Math.min(8,Math.floor(mf(t)/3))),n=Math.pow(10,-r),i=d(((e=Af(e)).type="f",e),{suffix:Bf[8+r/3]});return function(e){return i(n*e)}}}}function Ef(e,t,r,n){var i,o=Zh(e,t,r);switch((n=Af(null==n?",f":n)).type){case"s":var a=Math.max(Math.abs(e),Math.abs(t));return null!=n.precision||isNaN(i=function(e,t){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(mf(t)/3)))-mf(Math.abs(e)))}(o,a))||(n.precision=i),wf(n,a);case"":case"e":case"g":case"p":case"r":null!=n.precision||isNaN(i=function(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,mf(t)-mf(e))+1}(o,Math.max(Math.abs(e),Math.abs(t))))||(n.precision=i-("e"===n.type));break;case"f":case"%":null!=n.precision||isNaN(i=function(e){return Math.max(0,-mf(Math.abs(e)))}(o))||(n.precision=i-2*("%"===n.type))}return xf(n)}function Sf(e){var t=e.domain;return e.ticks=function(e){var r=t();return Wh(r[0],r[r.length-1],null==e?10:e)},e.tickFormat=function(e,r){var n=t();return Ef(n[0],n[n.length-1],null==e?10:e,r)},e.nice=function(r){null==r&&(r=10);var n,i,o=t(),a=0,s=o.length-1,l=o[a],c=o[s],u=10;for(c<l&&(i=l,l=c,c=i,i=a,a=s,s=i);u-- >0;){if((i=qh(l,c,r))===n)return o[a]=l,o[s]=c,t(o);if(i>0)l=Math.floor(l/i)*i,c=Math.ceil(c/i)*i;else{if(!(i<0))break;l=Math.ceil(l*i)/i,c=Math.floor(c*i)/i}n=i}return e},e}function Tf(){var e=uf();return e.copy=function(){return lf(e,Tf())},kh.apply(e,arguments),Sf(e)}function If(e){var t;function r(e){return null==e||isNaN(e=+e)?t:e}return r.invert=r,r.domain=r.range=function(t){return arguments.length?(e=Array.from(t,tf),r):e.slice()},r.unknown=function(e){return arguments.length?(t=e,r):t},r.copy=function(){return If(e).unknown(t)},e=arguments.length?Array.from(e,tf):[0,1],Sf(r)}function Ff(e,t){var r,n=0,i=(e=e.slice()).length-1,o=e[n],a=e[i];return a<o&&(r=n,n=i,i=r,r=o,o=a,a=r),e[n]=t.floor(o),e[i]=t.ceil(a),e}function kf(e){return Math.log(e)}function Pf(e){return Math.exp(e)}function Mf(e){return-Math.log(-e)}function Of(e){return-Math.exp(-e)}function Lf(e){return isFinite(e)?+("1e"+e):e<0?0:e}function Df(e){return(t,r)=>-e(-t,r)}function Uf(e){const t=e(kf,Pf),r=t.domain;let n,i,o=10;function a(){return n=function(e){return e===Math.E?Math.log:10===e&&Math.log10||2===e&&Math.log2||(e=Math.log(e),t=>Math.log(t)/e)}(o),i=function(e){return 10===e?Lf:e===Math.E?Math.exp:t=>Math.pow(e,t)}(o),r()[0]<0?(n=Df(n),i=Df(i),e(Mf,Of)):e(kf,Pf),t}return t.base=function(e){return arguments.length?(o=+e,a()):o},t.domain=function(e){return arguments.length?(r(e),a()):r()},t.ticks=e=>{const t=r();let a=t[0],s=t[t.length-1];const l=s<a;l&&([a,s]=[s,a]);let c,u,d=n(a),h=n(s);const A=null==e?10:+e;let f=[];if(!(o%1)&&h-d<A){if(d=Math.floor(d),h=Math.ceil(h),a>0){for(;d<=h;++d)for(c=1;c<o;++c)if(u=d<0?c/i(-d):c*i(d),!(u<a)){if(u>s)break;f.push(u)}}else for(;d<=h;++d)for(c=o-1;c>=1;--c)if(u=d>0?c/i(-d):c*i(d),!(u<a)){if(u>s)break;f.push(u)}2*f.length<A&&(f=Wh(a,s,A))}else f=Wh(d,h,Math.min(h-d,A)).map(i);return l?f.reverse():f},t.tickFormat=(e,r)=>{if(null==e&&(e=10),null==r&&(r=10===o?"s":","),"function"!==typeof r&&(o%1||null!=(r=Af(r)).precision||(r.trim=!0),r=xf(r)),e===1/0)return r;const a=Math.max(1,o*e/t.ticks().length);return e=>{let t=e/i(Math.round(n(e)));return t*o<o-.5&&(t*=o),t<=a?r(e):""}},t.nice=()=>r(Ff(r(),{floor:e=>i(Math.floor(n(e))),ceil:e=>i(Math.ceil(n(e)))})),t}function Rf(){const e=Uf(cf()).domain([1,10]);return e.copy=()=>lf(e,Rf()).base(e.base()),kh.apply(e,arguments),e}function zf(e){return function(t){return Math.sign(t)*Math.log1p(Math.abs(t/e))}}function Nf(e){return function(t){return Math.sign(t)*Math.expm1(Math.abs(t))*e}}function jf(e){var t=1,r=e(zf(t),Nf(t));return r.constant=function(r){return arguments.length?e(zf(t=+r),Nf(t)):t},Sf(r)}function Qf(){var e=jf(cf());return e.copy=function(){return lf(e,Qf()).constant(e.constant())},kh.apply(e,arguments)}function Vf(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Hf(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function Gf(e){return e<0?-e*e:e*e}function Kf(e){var t=e(nf,nf),r=1;return t.exponent=function(t){return arguments.length?1===(r=+t)?e(nf,nf):.5===r?e(Hf,Gf):e(Vf(r),Vf(1/r)):r},Sf(t)}function Wf(){var e=Kf(cf());return e.copy=function(){return lf(e,Wf()).exponent(e.exponent())},kh.apply(e,arguments),e}function qf(){return Wf.apply(null,arguments).exponent(.5)}function Zf(e){return Math.sign(e)*e*e}function Xf(){var e,t=uf(),r=[0,1],n=!1;function i(r){var i=function(e){return Math.sign(e)*Math.sqrt(Math.abs(e))}(t(r));return isNaN(i)?e:n?Math.round(i):i}return i.invert=function(e){return t.invert(Zf(e))},i.domain=function(e){return arguments.length?(t.domain(e),i):t.domain()},i.range=function(e){return arguments.length?(t.range((r=Array.from(e,tf)).map(Zf)),i):r.slice()},i.rangeRound=function(e){return i.range(e).round(!0)},i.round=function(e){return arguments.length?(n=!!e,i):n},i.clamp=function(e){return arguments.length?(t.clamp(e),i):t.clamp()},i.unknown=function(t){return arguments.length?(e=t,i):e},i.copy=function(){return Xf(t.domain(),r).round(n).clamp(t.clamp()).unknown(e)},kh.apply(i,arguments),Sf(i)}function Yf(e,t){let r;if(void 0===t)for(const n of e)null!=n&&(r<n||void 0===r&&n>=n)&&(r=n);else{let n=-1;for(let i of e)null!=(i=t(i,++n,e))&&(r<i||void 0===r&&i>=i)&&(r=i)}return r}function Jf(e,t){let r;if(void 0===t)for(const n of e)null!=n&&(r>n||void 0===r&&n>=n)&&(r=n);else{let n=-1;for(let i of e)null!=(i=t(i,++n,e))&&(r>i||void 0===r&&i>=i)&&(r=i)}return r}function $f(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xh;if(e===Xh)return ep;if("function"!==typeof e)throw new TypeError("compare is not a function");return(t,r)=>{const n=e(t,r);return n||0===n?n:(0===e(r,r))-(0===e(t,t))}}function ep(e,t){return(null==e||!(e>=e))-(null==t||!(t>=t))||(e<t?-1:e>t?1:0)}function tp(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,i=arguments.length>4?arguments[4]:void 0;if(t=Math.floor(t),r=Math.floor(Math.max(0,r)),n=Math.floor(Math.min(e.length-1,n)),!(r<=t&&t<=n))return e;for(i=void 0===i?ep:$f(i);n>r;){if(n-r>600){const o=n-r+1,a=t-r+1,s=Math.log(o),l=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*l*(o-l)/o)*(a-o/2<0?-1:1);tp(e,t,Math.max(r,Math.floor(t-a*l/o+c)),Math.min(n,Math.floor(t+(o-a)*l/o+c)),i)}const o=e[t];let a=r,s=n;for(rp(e,r,t),i(e[n],o)>0&&rp(e,r,n);a<s;){for(rp(e,a,s),++a,--s;i(e[a],o)<0;)++a;for(;i(e[s],o)>0;)--s}0===i(e[r],o)?rp(e,r,s):(++s,rp(e,s,n)),s<=t&&(r=s+1),t<=s&&(n=s-1)}return e}function rp(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function np(e,t,r){if(e=Float64Array.from(function*(e,t){if(void 0===t)for(let r of e)null!=r&&(r=+r)>=r&&(yield r);else{let r=-1;for(let n of e)null!=(n=t(n,++r,e))&&(n=+n)>=n&&(yield n)}}(e,r)),(n=e.length)&&!isNaN(t=+t)){if(t<=0||n<2)return Jf(e);if(t>=1)return Yf(e);var n,i=(n-1)*t,o=Math.floor(i),a=Yf(tp(e,o).subarray(0,o+1));return a+(Jf(e.subarray(o+1))-a)*(i-o)}}function ip(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:eA;if((n=e.length)&&!isNaN(t=+t)){if(t<=0||n<2)return+r(e[0],0,e);if(t>=1)return+r(e[n-1],n-1,e);var n,i=(n-1)*t,o=Math.floor(i),a=+r(e[o],o,e);return a+(+r(e[o+1],o+1,e)-a)*(i-o)}}function op(){var e,t=[],r=[],n=[];function i(){var e=0,i=Math.max(1,r.length);for(n=new Array(i-1);++e<i;)n[e-1]=ip(t,e/i);return o}function o(t){return null==t||isNaN(t=+t)?e:r[nA(n,t)]}return o.invertExtent=function(e){var i=r.indexOf(e);return i<0?[NaN,NaN]:[i>0?n[i-1]:t[0],i<n.length?n[i]:t[t.length-1]]},o.domain=function(e){if(!arguments.length)return t.slice();t=[];for(let r of e)null==r||isNaN(r=+r)||t.push(r);return t.sort(Xh),i()},o.range=function(e){return arguments.length?(r=Array.from(e),i()):r.slice()},o.unknown=function(t){return arguments.length?(e=t,o):e},o.quantiles=function(){return n.slice()},o.copy=function(){return op().domain(t).range(r).unknown(e)},kh.apply(o,arguments)}function ap(){var e,t=0,r=1,n=1,i=[.5],o=[0,1];function a(t){return null!=t&&t<=t?o[nA(i,t,0,n)]:e}function s(){var e=-1;for(i=new Array(n);++e<n;)i[e]=((e+1)*r-(e-n)*t)/(n+1);return a}return a.domain=function(e){return arguments.length?([t,r]=e,t=+t,r=+r,s()):[t,r]},a.range=function(e){return arguments.length?(n=(o=Array.from(e)).length-1,s()):o.slice()},a.invertExtent=function(e){var a=o.indexOf(e);return a<0?[NaN,NaN]:a<1?[t,i[0]]:a>=n?[i[n-1],r]:[i[a-1],i[a]]},a.unknown=function(t){return arguments.length?(e=t,a):a},a.thresholds=function(){return i.slice()},a.copy=function(){return ap().domain([t,r]).range(o).unknown(e)},kh.apply(Sf(a),arguments)}function sp(){var e,t=[.5],r=[0,1],n=1;function i(i){return null!=i&&i<=i?r[nA(t,i,0,n)]:e}return i.domain=function(e){return arguments.length?(t=Array.from(e),n=Math.min(t.length,r.length-1),i):t.slice()},i.range=function(e){return arguments.length?(r=Array.from(e),n=Math.min(t.length,r.length-1),i):r.slice()},i.invertExtent=function(e){var n=r.indexOf(e);return[t[n-1],t[n]]},i.unknown=function(t){return arguments.length?(e=t,i):e},i.copy=function(){return sp().domain(t).range(r).unknown(e)},kh.apply(i,arguments)}vf=Cf({thousands:",",grouping:[3],currency:["$",""]}),xf=vf.format,wf=vf.formatPrefix;const lp=1e3,cp=6e4,up=36e5,dp=864e5,hp=6048e5,Ap=2592e6,fp=31536e6,pp=new Date,mp=new Date;function gp(e,t,r,n){function i(t){return e(t=0===arguments.length?new Date:new Date(+t)),t}return i.floor=t=>(e(t=new Date(+t)),t),i.ceil=r=>(e(r=new Date(r-1)),t(r,1),e(r),r),i.round=e=>{const t=i(e),r=i.ceil(e);return e-t<r-e?t:r},i.offset=(e,r)=>(t(e=new Date(+e),null==r?1:Math.floor(r)),e),i.range=(r,n,o)=>{const a=[];if(r=i.ceil(r),o=null==o?1:Math.floor(o),!(r<n)||!(o>0))return a;let s;do{a.push(s=new Date(+r)),t(r,o),e(r)}while(s<r&&r<n);return a},i.filter=r=>gp(t=>{if(t>=t)for(;e(t),!r(t);)t.setTime(t-1)},(e,n)=>{if(e>=e)if(n<0)for(;++n<=0;)for(;t(e,-1),!r(e););else for(;--n>=0;)for(;t(e,1),!r(e););}),r&&(i.count=(t,n)=>(pp.setTime(+t),mp.setTime(+n),e(pp),e(mp),Math.floor(r(pp,mp))),i.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?i.filter(n?t=>n(t)%e===0:t=>i.count(0,t)%e===0):i:null)),i}const yp=gp(()=>{},(e,t)=>{e.setTime(+e+t)},(e,t)=>t-e);yp.every=e=>(e=Math.floor(e),isFinite(e)&&e>0?e>1?gp(t=>{t.setTime(Math.floor(t/e)*e)},(t,r)=>{t.setTime(+t+r*e)},(t,r)=>(r-t)/e):yp:null);yp.range;const _p=gp(e=>{e.setTime(e-e.getMilliseconds())},(e,t)=>{e.setTime(+e+t*lp)},(e,t)=>(t-e)/lp,e=>e.getUTCSeconds()),vp=(_p.range,gp(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*lp)},(e,t)=>{e.setTime(+e+t*cp)},(e,t)=>(t-e)/cp,e=>e.getMinutes())),xp=(vp.range,gp(e=>{e.setUTCSeconds(0,0)},(e,t)=>{e.setTime(+e+t*cp)},(e,t)=>(t-e)/cp,e=>e.getUTCMinutes())),wp=(xp.range,gp(e=>{e.setTime(e-e.getMilliseconds()-e.getSeconds()*lp-e.getMinutes()*cp)},(e,t)=>{e.setTime(+e+t*up)},(e,t)=>(t-e)/up,e=>e.getHours())),bp=(wp.range,gp(e=>{e.setUTCMinutes(0,0,0)},(e,t)=>{e.setTime(+e+t*up)},(e,t)=>(t-e)/up,e=>e.getUTCHours())),Bp=(bp.range,gp(e=>e.setHours(0,0,0,0),(e,t)=>e.setDate(e.getDate()+t),(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*cp)/dp,e=>e.getDate()-1)),Cp=(Bp.range,gp(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/dp,e=>e.getUTCDate()-1)),Ep=(Cp.range,gp(e=>{e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+t)},(e,t)=>(t-e)/dp,e=>Math.floor(e/dp)));Ep.range;function Sp(e){return gp(t=>{t.setDate(t.getDate()-(t.getDay()+7-e)%7),t.setHours(0,0,0,0)},(e,t)=>{e.setDate(e.getDate()+7*t)},(e,t)=>(t-e-(t.getTimezoneOffset()-e.getTimezoneOffset())*cp)/hp)}const Tp=Sp(0),Ip=Sp(1),Fp=Sp(2),kp=Sp(3),Pp=Sp(4),Mp=Sp(5),Op=Sp(6);Tp.range,Ip.range,Fp.range,kp.range,Pp.range,Mp.range,Op.range;function Lp(e){return gp(t=>{t.setUTCDate(t.getUTCDate()-(t.getUTCDay()+7-e)%7),t.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCDate(e.getUTCDate()+7*t)},(e,t)=>(t-e)/hp)}const Dp=Lp(0),Up=Lp(1),Rp=Lp(2),zp=Lp(3),Np=Lp(4),jp=Lp(5),Qp=Lp(6),Vp=(Dp.range,Up.range,Rp.range,zp.range,Np.range,jp.range,Qp.range,gp(e=>{e.setDate(1),e.setHours(0,0,0,0)},(e,t)=>{e.setMonth(e.getMonth()+t)},(e,t)=>t.getMonth()-e.getMonth()+12*(t.getFullYear()-e.getFullYear()),e=>e.getMonth())),Hp=(Vp.range,gp(e=>{e.setUTCDate(1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCMonth(e.getUTCMonth()+t)},(e,t)=>t.getUTCMonth()-e.getUTCMonth()+12*(t.getUTCFullYear()-e.getUTCFullYear()),e=>e.getUTCMonth())),Gp=(Hp.range,gp(e=>{e.setMonth(0,1),e.setHours(0,0,0,0)},(e,t)=>{e.setFullYear(e.getFullYear()+t)},(e,t)=>t.getFullYear()-e.getFullYear(),e=>e.getFullYear()));Gp.every=e=>isFinite(e=Math.floor(e))&&e>0?gp(t=>{t.setFullYear(Math.floor(t.getFullYear()/e)*e),t.setMonth(0,1),t.setHours(0,0,0,0)},(t,r)=>{t.setFullYear(t.getFullYear()+r*e)}):null;Gp.range;const Kp=gp(e=>{e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},(e,t)=>{e.setUTCFullYear(e.getUTCFullYear()+t)},(e,t)=>t.getUTCFullYear()-e.getUTCFullYear(),e=>e.getUTCFullYear());Kp.every=e=>isFinite(e=Math.floor(e))&&e>0?gp(t=>{t.setUTCFullYear(Math.floor(t.getUTCFullYear()/e)*e),t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},(t,r)=>{t.setUTCFullYear(t.getUTCFullYear()+r*e)}):null;Kp.range;function Wp(e,t,r,n,i,o){const a=[[_p,1,lp],[_p,5,5e3],[_p,15,15e3],[_p,30,3e4],[o,1,cp],[o,5,3e5],[o,15,9e5],[o,30,18e5],[i,1,up],[i,3,108e5],[i,6,216e5],[i,12,432e5],[n,1,dp],[n,2,1728e5],[r,1,hp],[t,1,Ap],[t,3,7776e6],[e,1,fp]];function s(t,r,n){const i=Math.abs(r-t)/n,o=Jh(e=>{let[,,t]=e;return t}).right(a,i);if(o===a.length)return e.every(Zh(t/fp,r/fp,n));if(0===o)return yp.every(Math.max(Zh(t,r,n),1));const[s,l]=a[i/a[o-1][2]<a[o][2]/i?o-1:o];return s.every(l)}return[function(e,t,r){const n=t<e;n&&([e,t]=[t,e]);const i=r&&"function"===typeof r.range?r:s(e,t,r),o=i?i.range(e,+t+1):[];return n?o.reverse():o},s]}const[qp,Zp]=Wp(Kp,Hp,Dp,Ep,bp,xp),[Xp,Yp]=Wp(Gp,Vp,Tp,Bp,wp,vp);function Jp(e){if(0<=e.y&&e.y<100){var t=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return t.setFullYear(e.y),t}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function $p(e){if(0<=e.y&&e.y<100){var t=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return t.setUTCFullYear(e.y),t}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function em(e,t,r){return{y:e,m:t,d:r,H:0,M:0,S:0,L:0}}var tm,rm,nm,im={"-":"",_:" ",0:"0"},om=/^\s*\d+/,am=/^%/,sm=/[\\^$*+?|[\]().{}]/g;function lm(e,t,r){var n=e<0?"-":"",i=(n?-e:e)+"",o=i.length;return n+(o<r?new Array(r-o+1).join(t)+i:i)}function cm(e){return e.replace(sm,"\\$&")}function um(e){return new RegExp("^(?:"+e.map(cm).join("|")+")","i")}function dm(e){return new Map(e.map((e,t)=>[e.toLowerCase(),t]))}function hm(e,t,r){var n=om.exec(t.slice(r,r+1));return n?(e.w=+n[0],r+n[0].length):-1}function Am(e,t,r){var n=om.exec(t.slice(r,r+1));return n?(e.u=+n[0],r+n[0].length):-1}function fm(e,t,r){var n=om.exec(t.slice(r,r+2));return n?(e.U=+n[0],r+n[0].length):-1}function pm(e,t,r){var n=om.exec(t.slice(r,r+2));return n?(e.V=+n[0],r+n[0].length):-1}function mm(e,t,r){var n=om.exec(t.slice(r,r+2));return n?(e.W=+n[0],r+n[0].length):-1}function gm(e,t,r){var n=om.exec(t.slice(r,r+4));return n?(e.y=+n[0],r+n[0].length):-1}function ym(e,t,r){var n=om.exec(t.slice(r,r+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),r+n[0].length):-1}function _m(e,t,r){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(t.slice(r,r+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),r+n[0].length):-1}function vm(e,t,r){var n=om.exec(t.slice(r,r+1));return n?(e.q=3*n[0]-3,r+n[0].length):-1}function xm(e,t,r){var n=om.exec(t.slice(r,r+2));return n?(e.m=n[0]-1,r+n[0].length):-1}function wm(e,t,r){var n=om.exec(t.slice(r,r+2));return n?(e.d=+n[0],r+n[0].length):-1}function bm(e,t,r){var n=om.exec(t.slice(r,r+3));return n?(e.m=0,e.d=+n[0],r+n[0].length):-1}function Bm(e,t,r){var n=om.exec(t.slice(r,r+2));return n?(e.H=+n[0],r+n[0].length):-1}function Cm(e,t,r){var n=om.exec(t.slice(r,r+2));return n?(e.M=+n[0],r+n[0].length):-1}function Em(e,t,r){var n=om.exec(t.slice(r,r+2));return n?(e.S=+n[0],r+n[0].length):-1}function Sm(e,t,r){var n=om.exec(t.slice(r,r+3));return n?(e.L=+n[0],r+n[0].length):-1}function Tm(e,t,r){var n=om.exec(t.slice(r,r+6));return n?(e.L=Math.floor(n[0]/1e3),r+n[0].length):-1}function Im(e,t,r){var n=am.exec(t.slice(r,r+1));return n?r+n[0].length:-1}function Fm(e,t,r){var n=om.exec(t.slice(r));return n?(e.Q=+n[0],r+n[0].length):-1}function km(e,t,r){var n=om.exec(t.slice(r));return n?(e.s=+n[0],r+n[0].length):-1}function Pm(e,t){return lm(e.getDate(),t,2)}function Mm(e,t){return lm(e.getHours(),t,2)}function Om(e,t){return lm(e.getHours()%12||12,t,2)}function Lm(e,t){return lm(1+Bp.count(Gp(e),e),t,3)}function Dm(e,t){return lm(e.getMilliseconds(),t,3)}function Um(e,t){return Dm(e,t)+"000"}function Rm(e,t){return lm(e.getMonth()+1,t,2)}function zm(e,t){return lm(e.getMinutes(),t,2)}function Nm(e,t){return lm(e.getSeconds(),t,2)}function jm(e){var t=e.getDay();return 0===t?7:t}function Qm(e,t){return lm(Tp.count(Gp(e)-1,e),t,2)}function Vm(e){var t=e.getDay();return t>=4||0===t?Pp(e):Pp.ceil(e)}function Hm(e,t){return e=Vm(e),lm(Pp.count(Gp(e),e)+(4===Gp(e).getDay()),t,2)}function Gm(e){return e.getDay()}function Km(e,t){return lm(Ip.count(Gp(e)-1,e),t,2)}function Wm(e,t){return lm(e.getFullYear()%100,t,2)}function qm(e,t){return lm((e=Vm(e)).getFullYear()%100,t,2)}function Zm(e,t){return lm(e.getFullYear()%1e4,t,4)}function Xm(e,t){var r=e.getDay();return lm((e=r>=4||0===r?Pp(e):Pp.ceil(e)).getFullYear()%1e4,t,4)}function Ym(e){var t=e.getTimezoneOffset();return(t>0?"-":(t*=-1,"+"))+lm(t/60|0,"0",2)+lm(t%60,"0",2)}function Jm(e,t){return lm(e.getUTCDate(),t,2)}function $m(e,t){return lm(e.getUTCHours(),t,2)}function eg(e,t){return lm(e.getUTCHours()%12||12,t,2)}function tg(e,t){return lm(1+Cp.count(Kp(e),e),t,3)}function rg(e,t){return lm(e.getUTCMilliseconds(),t,3)}function ng(e,t){return rg(e,t)+"000"}function ig(e,t){return lm(e.getUTCMonth()+1,t,2)}function og(e,t){return lm(e.getUTCMinutes(),t,2)}function ag(e,t){return lm(e.getUTCSeconds(),t,2)}function sg(e){var t=e.getUTCDay();return 0===t?7:t}function lg(e,t){return lm(Dp.count(Kp(e)-1,e),t,2)}function cg(e){var t=e.getUTCDay();return t>=4||0===t?Np(e):Np.ceil(e)}function ug(e,t){return e=cg(e),lm(Np.count(Kp(e),e)+(4===Kp(e).getUTCDay()),t,2)}function dg(e){return e.getUTCDay()}function hg(e,t){return lm(Up.count(Kp(e)-1,e),t,2)}function Ag(e,t){return lm(e.getUTCFullYear()%100,t,2)}function fg(e,t){return lm((e=cg(e)).getUTCFullYear()%100,t,2)}function pg(e,t){return lm(e.getUTCFullYear()%1e4,t,4)}function mg(e,t){var r=e.getUTCDay();return lm((e=r>=4||0===r?Np(e):Np.ceil(e)).getUTCFullYear()%1e4,t,4)}function gg(){return"+0000"}function yg(){return"%"}function _g(e){return+e}function vg(e){return Math.floor(+e/1e3)}function xg(e){return new Date(e)}function wg(e){return e instanceof Date?+e:+new Date(+e)}function bg(e,t,r,n,i,o,a,s,l,c){var u=uf(),d=u.invert,h=u.domain,A=c(".%L"),f=c(":%S"),p=c("%I:%M"),m=c("%I %p"),g=c("%a %d"),y=c("%b %d"),_=c("%B"),v=c("%Y");function x(e){return(l(e)<e?A:s(e)<e?f:a(e)<e?p:o(e)<e?m:n(e)<e?i(e)<e?g:y:r(e)<e?_:v)(e)}return u.invert=function(e){return new Date(d(e))},u.domain=function(e){return arguments.length?h(Array.from(e,wg)):h().map(xg)},u.ticks=function(t){var r=h();return e(r[0],r[r.length-1],null==t?10:t)},u.tickFormat=function(e,t){return null==t?x:c(t)},u.nice=function(e){var r=h();return e&&"function"===typeof e.range||(e=t(r[0],r[r.length-1],null==e?10:e)),e?h(Ff(r,e)):u},u.copy=function(){return lf(u,bg(e,t,r,n,i,o,a,s,l,c))},u}function Bg(){return kh.apply(bg(Xp,Yp,Gp,Vp,Tp,Bp,wp,vp,_p,rm).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Cg(){return kh.apply(bg(qp,Zp,Kp,Hp,Dp,Cp,bp,xp,_p,nm).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function Eg(){var e,t,r,n,i,o=0,a=1,s=nf,l=!1;function c(t){return null==t||isNaN(t=+t)?i:s(0===r?.5:(t=(n(t)-e)*r,l?Math.max(0,Math.min(1,t)):t))}function u(e){return function(t){var r,n;return arguments.length?([r,n]=t,s=e(r,n),c):[s(0),s(1)]}}return c.domain=function(i){return arguments.length?([o,a]=i,e=n(o=+o),t=n(a=+a),r=e===t?0:1/(t-e),c):[o,a]},c.clamp=function(e){return arguments.length?(l=!!e,c):l},c.interpolator=function(e){return arguments.length?(s=e,c):s},c.range=u($A),c.rangeRound=u(ef),c.unknown=function(e){return arguments.length?(i=e,c):i},function(i){return n=i,e=i(o),t=i(a),r=e===t?0:1/(t-e),c}}function Sg(e,t){return t.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Tg(){var e=Sf(Eg()(nf));return e.copy=function(){return Sg(e,Tg())},Ph.apply(e,arguments)}function Ig(){var e=Uf(Eg()).domain([1,10]);return e.copy=function(){return Sg(e,Ig()).base(e.base())},Ph.apply(e,arguments)}function Fg(){var e=jf(Eg());return e.copy=function(){return Sg(e,Fg()).constant(e.constant())},Ph.apply(e,arguments)}function kg(){var e=Kf(Eg());return e.copy=function(){return Sg(e,kg()).exponent(e.exponent())},Ph.apply(e,arguments)}function Pg(){return kg.apply(null,arguments).exponent(.5)}function Mg(){var e=[],t=nf;function r(r){if(null!=r&&!isNaN(r=+r))return t((nA(e,r,1)-1)/(e.length-1))}return r.domain=function(t){if(!arguments.length)return e.slice();e=[];for(let r of t)null==r||isNaN(r=+r)||e.push(r);return e.sort(Xh),r},r.interpolator=function(e){return arguments.length?(t=e,r):t},r.range=function(){return e.map((r,n)=>t(n/(e.length-1)))},r.quantiles=function(t){return Array.from({length:t+1},(r,n)=>np(e,n/t))},r.copy=function(){return Mg(t).domain(e)},Ph.apply(r,arguments)}function Og(){var e,t,r,n,i,o,a,s=0,l=.5,c=1,u=1,d=nf,h=!1;function A(e){return isNaN(e=+e)?a:(e=.5+((e=+o(e))-t)*(u*e<u*t?n:i),d(h?Math.max(0,Math.min(1,e)):e))}function f(e){return function(t){var r,n,i;return arguments.length?([r,n,i]=t,d=function(e,t){void 0===t&&(t=e,e=$A);for(var r=0,n=t.length-1,i=t[0],o=new Array(n<0?0:n);r<n;)o[r]=e(i,i=t[++r]);return function(e){var t=Math.max(0,Math.min(n-1,Math.floor(e*=n)));return o[t](e-t)}}(e,[r,n,i]),A):[d(0),d(.5),d(1)]}}return A.domain=function(a){return arguments.length?([s,l,c]=a,e=o(s=+s),t=o(l=+l),r=o(c=+c),n=e===t?0:.5/(t-e),i=t===r?0:.5/(r-t),u=t<e?-1:1,A):[s,l,c]},A.clamp=function(e){return arguments.length?(h=!!e,A):h},A.interpolator=function(e){return arguments.length?(d=e,A):d},A.range=f($A),A.rangeRound=f(ef),A.unknown=function(e){return arguments.length?(a=e,A):a},function(a){return o=a,e=a(s),t=a(l),r=a(c),n=e===t?0:.5/(t-e),i=t===r?0:.5/(r-t),u=t<e?-1:1,A}}function Lg(){var e=Sf(Og()(nf));return e.copy=function(){return Sg(e,Lg())},Ph.apply(e,arguments)}function Dg(){var e=Uf(Og()).domain([.1,1,10]);return e.copy=function(){return Sg(e,Dg()).base(e.base())},Ph.apply(e,arguments)}function Ug(){var e=jf(Og());return e.copy=function(){return Sg(e,Ug()).constant(e.constant())},Ph.apply(e,arguments)}function Rg(){var e=Kf(Og());return e.copy=function(){return Sg(e,Rg()).exponent(e.exponent())},Ph.apply(e,arguments)}function zg(){return Rg.apply(null,arguments).exponent(.5)}!function(e){tm=function(e){var t=e.dateTime,r=e.date,n=e.time,i=e.periods,o=e.days,a=e.shortDays,s=e.months,l=e.shortMonths,c=um(i),u=dm(i),d=um(o),h=dm(o),A=um(a),f=dm(a),p=um(s),m=dm(s),g=um(l),y=dm(l),_={a:function(e){return a[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return l[e.getMonth()]},B:function(e){return s[e.getMonth()]},c:null,d:Pm,e:Pm,f:Um,g:qm,G:Xm,H:Mm,I:Om,j:Lm,L:Dm,m:Rm,M:zm,p:function(e){return i[+(e.getHours()>=12)]},q:function(e){return 1+~~(e.getMonth()/3)},Q:_g,s:vg,S:Nm,u:jm,U:Qm,V:Hm,w:Gm,W:Km,x:null,X:null,y:Wm,Y:Zm,Z:Ym,"%":yg},v={a:function(e){return a[e.getUTCDay()]},A:function(e){return o[e.getUTCDay()]},b:function(e){return l[e.getUTCMonth()]},B:function(e){return s[e.getUTCMonth()]},c:null,d:Jm,e:Jm,f:ng,g:fg,G:mg,H:$m,I:eg,j:tg,L:rg,m:ig,M:og,p:function(e){return i[+(e.getUTCHours()>=12)]},q:function(e){return 1+~~(e.getUTCMonth()/3)},Q:_g,s:vg,S:ag,u:sg,U:lg,V:ug,w:dg,W:hg,x:null,X:null,y:Ag,Y:pg,Z:gg,"%":yg},x={a:function(e,t,r){var n=A.exec(t.slice(r));return n?(e.w=f.get(n[0].toLowerCase()),r+n[0].length):-1},A:function(e,t,r){var n=d.exec(t.slice(r));return n?(e.w=h.get(n[0].toLowerCase()),r+n[0].length):-1},b:function(e,t,r){var n=g.exec(t.slice(r));return n?(e.m=y.get(n[0].toLowerCase()),r+n[0].length):-1},B:function(e,t,r){var n=p.exec(t.slice(r));return n?(e.m=m.get(n[0].toLowerCase()),r+n[0].length):-1},c:function(e,r,n){return B(e,t,r,n)},d:wm,e:wm,f:Tm,g:ym,G:gm,H:Bm,I:Bm,j:bm,L:Sm,m:xm,M:Cm,p:function(e,t,r){var n=c.exec(t.slice(r));return n?(e.p=u.get(n[0].toLowerCase()),r+n[0].length):-1},q:vm,Q:Fm,s:km,S:Em,u:Am,U:fm,V:pm,w:hm,W:mm,x:function(e,t,n){return B(e,r,t,n)},X:function(e,t,r){return B(e,n,t,r)},y:ym,Y:gm,Z:_m,"%":Im};function w(e,t){return function(r){var n,i,o,a=[],s=-1,l=0,c=e.length;for(r instanceof Date||(r=new Date(+r));++s<c;)37===e.charCodeAt(s)&&(a.push(e.slice(l,s)),null!=(i=im[n=e.charAt(++s)])?n=e.charAt(++s):i="e"===n?" ":"0",(o=t[n])&&(n=o(r,i)),a.push(n),l=s+1);return a.push(e.slice(l,s)),a.join("")}}function b(e,t){return function(r){var n,i,o=em(1900,void 0,1);if(B(o,e,r+="",0)!=r.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(t&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(i=(n=$p(em(o.y,0,1))).getUTCDay(),n=i>4||0===i?Up.ceil(n):Up(n),n=Cp.offset(n,7*(o.V-1)),o.y=n.getUTCFullYear(),o.m=n.getUTCMonth(),o.d=n.getUTCDate()+(o.w+6)%7):(i=(n=Jp(em(o.y,0,1))).getDay(),n=i>4||0===i?Ip.ceil(n):Ip(n),n=Bp.offset(n,7*(o.V-1)),o.y=n.getFullYear(),o.m=n.getMonth(),o.d=n.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?$p(em(o.y,0,1)).getUTCDay():Jp(em(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,$p(o)):Jp(o)}}function B(e,t,r,n){for(var i,o,a=0,s=t.length,l=r.length;a<s;){if(n>=l)return-1;if(37===(i=t.charCodeAt(a++))){if(i=t.charAt(a++),!(o=x[i in im?t.charAt(a++):i])||(n=o(e,r,n))<0)return-1}else if(i!=r.charCodeAt(n++))return-1}return n}return _.x=w(r,_),_.X=w(n,_),_.c=w(t,_),v.x=w(r,v),v.X=w(n,v),v.c=w(t,v),{format:function(e){var t=w(e+="",_);return t.toString=function(){return e},t},parse:function(e){var t=b(e+="",!1);return t.toString=function(){return e},t},utcFormat:function(e){var t=w(e+="",v);return t.toString=function(){return e},t},utcParse:function(e){var t=b(e+="",!0);return t.toString=function(){return e},t}}}(e),rm=tm.format,tm.parse,nm=tm.utcFormat,tm.utcParse}({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var Ng=e=>e.chartData,jg=yd([Ng],e=>{var t=null!=e.chartData?e.chartData.length-1:0;return{chartData:e.chartData,computedData:e.computedData,dataEndIndex:t,dataStartIndex:0}}),Qg=(e,t,r,n)=>n?jg(e):Ng(e);function Vg(e){if(Array.isArray(e)&&2===e.length){var[t,r]=e;if(Lc(t)&&Lc(r))return!0}return!1}function Hg(e,t,r){return r?e:[Math.min(e[0],t[0]),Math.max(e[1],t[1])]}function Gg(e,t){if(t&&"function"!==typeof e&&Array.isArray(e)&&2===e.length){var r,n,[i,o]=e;if(Lc(i))r=i;else if("function"===typeof i)return;if(Lc(o))n=o;else if("function"===typeof o)return;var a=[r,n];if(Vg(a))return a}}var Kg,Wg=r(8210),qg=r.n(Wg),Zg=e=>e,Xg={"@@functional/placeholder":!0},Yg=e=>e===Xg,Jg=e=>function t(){return 0===arguments.length||1===arguments.length&&Yg(arguments.length<=0?void 0:arguments[0])?t:e(...arguments)},$g=(e,t)=>1===e?t:Jg(function(){for(var r=arguments.length,n=new Array(r),i=0;i<r;i++)n[i]=arguments[i];var o=n.filter(e=>e!==Xg).length;return o>=e?t(...n):$g(e-o,Jg(function(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];var o=n.map(e=>Yg(e)?r.shift():e);return t(...o,...r)}))}),ey=(e,t)=>{for(var r=[],n=e;n<t;++n)r[n-e]=n;return r},ty=$g((Kg=(e,t)=>Array.isArray(t)?t.map(e):Object.keys(t).map(e=>t[e]).map(e)).length,Kg);function ry(e){return 0===e?1:Math.floor(new(qg())(e).abs().log(10).toNumber())+1}function ny(e,t,r){for(var n=new(qg())(e),i=0,o=[];n.lt(t)&&i<1e5;)o.push(n.toNumber()),n=n.add(r),i++;return o}var iy=e=>{var[t,r]=e,[n,i]=[t,r];return t>r&&([n,i]=[r,t]),[n,i]},oy=(e,t,r)=>{if(e.lte(0))return new(qg())(0);var n=ry(e.toNumber()),i=new(qg())(10).pow(n),o=e.div(i),a=1!==n?.05:.1,s=new(qg())(Math.ceil(o.div(a).toNumber())).add(r).mul(a).mul(i);return t?new(qg())(s.toNumber()):new(qg())(Math.ceil(s.toNumber()))},ay=(e,t,r)=>{var n=new(qg())(1),i=new(qg())(e);if(!i.isint()&&r){var o=Math.abs(e);o<1?(n=new(qg())(10).pow(ry(e)-1),i=new(qg())(Math.floor(i.div(n).toNumber())).mul(n)):o>1&&(i=new(qg())(Math.floor(e)))}else 0===e?i=new(qg())(Math.floor((t-1)/2)):r||(i=new(qg())(Math.floor(e)));var a=Math.floor((t-1)/2);return function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(!t.length)return Zg;var n=t.reverse(),i=n[0],o=n.slice(1);return function(){return o.reduce((e,t)=>t(e),i(...arguments))}}(ty(e=>i.add(new(qg())(e-a).mul(n)).toNumber()),ey)(0,t)},sy=function(e,t,r,n){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(!Number.isFinite((t-e)/(r-1)))return{step:new(qg())(0),tickMin:new(qg())(0),tickMax:new(qg())(0)};var o,a=oy(new(qg())(t).sub(e).div(r-1),n,i);o=e<=0&&t>=0?new(qg())(0):(o=new(qg())(e).add(t).div(2)).sub(new(qg())(o).mod(a));var s=Math.ceil(o.sub(e).div(a).toNumber()),l=Math.ceil(new(qg())(t).sub(o).div(a).toNumber()),c=s+l+1;return c>r?sy(e,t,r,n,i+1):(c<r&&(l=t>0?l+(r-c):l,s=t>0?s:s+(r-c)),{step:a,tickMin:o.sub(new(qg())(s).mul(a)),tickMax:o.add(new(qg())(l).mul(a))})},ly=e=>e.rootProps.maxBarSize,cy=e=>e.rootProps.barCategoryGap,uy=e=>e.rootProps.stackOffset,dy=e=>e.rootProps.reverseStackOrder,hy=e=>e.options.chartName,Ay=e=>e.rootProps.syncId,fy=e=>e.rootProps.syncMethod,py=e=>e.options.eventEmitter;function my(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function gy(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?my(Object(r),!0).forEach(function(t){yy(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):my(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yy(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _y=Math.PI/180,vy=e=>180*e/Math.PI,xy=(e,t,r,n)=>({x:e+Math.cos(-_y*n)*r,y:t+Math.sin(-_y*n)*r}),wy=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{top:0,right:0,bottom:0,left:0,width:0,height:0,brushBottom:0};return Math.min(Math.abs(e-(r.left||0)-(r.right||0)),Math.abs(t-(r.top||0)-(r.bottom||0)))/2},by=(e,t)=>{var{x:r,y:n}=e,{cx:i,cy:o}=t,a=((e,t)=>{var{x:r,y:n}=e,{x:i,y:o}=t;return Math.sqrt((r-i)**2+(n-o)**2)})({x:r,y:n},{x:i,y:o});if(a<=0)return{radius:a,angle:0};var s=(r-i)/a,l=Math.acos(s);return n>o&&(l=2*Math.PI-l),{radius:a,angle:vy(l),angleInRadian:l}},By=(e,t)=>{var{startAngle:r,endAngle:n}=t,i=Math.floor(r/360),o=Math.floor(n/360);return e+360*Math.min(i,o)},Cy=(e,t)=>{var{chartX:r,chartY:n}=e,{radius:i,angle:o}=by({x:r,y:n},t),{innerRadius:a,outerRadius:s}=t;if(i<a||i>s)return null;if(0===i)return null;var l,{startAngle:c,endAngle:u}=(e=>{var{startAngle:t,endAngle:r}=e,n=Math.floor(t/360),i=Math.floor(r/360),o=Math.min(n,i);return{startAngle:t-360*o,endAngle:r-360*o}})(t),d=o;if(c<=u){for(;d>u;)d-=360;for(;d<c;)d+=360;l=d>=c&&d<=u}else{for(;d>c;)d-=360;for(;d<u;)d+=360;l=d>=u&&d<=c}return l?gy(gy({},t),{},{radius:i,angle:By(d,t)}):null},Ey={grid:-100,barBackground:-50,area:100,cursorRectangle:200,bar:300,line:400,axis:500,scatter:600,activeBar:1e3,cursorLine:1100,activeDot:1200,label:2e3},Sy=0,Ty="auto",Iy=!0,Fy=!1,ky=!0,Py=0,My="auto",Oy=!0,Ly=5,Dy=(e,t)=>{if(e&&t)return null!==e&&void 0!==e&&e.reversed?[t[1],t[0]]:t},Uy={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!1,dataKey:void 0,domain:void 0,id:Sy,includeHidden:!1,name:void 0,reversed:!1,scale:Ty,tick:Iy,tickCount:void 0,ticks:void 0,type:"category",unit:void 0},Ry={allowDataOverflow:Fy,allowDecimals:!1,allowDuplicatedCategory:ky,dataKey:void 0,domain:void 0,id:Py,includeHidden:!1,name:void 0,reversed:!1,scale:My,tick:Oy,tickCount:Ly,ticks:void 0,type:"number",unit:void 0},zy={allowDataOverflow:!1,allowDecimals:!1,allowDuplicatedCategory:!0,dataKey:void 0,domain:void 0,id:Sy,includeHidden:!1,name:void 0,reversed:!1,scale:Ty,tick:Iy,tickCount:void 0,ticks:void 0,type:"number",unit:void 0},Ny={allowDataOverflow:Fy,allowDecimals:!1,allowDuplicatedCategory:ky,dataKey:void 0,domain:void 0,id:Py,includeHidden:!1,name:void 0,reversed:!1,scale:My,tick:Oy,tickCount:Ly,ticks:void 0,type:"category",unit:void 0},jy=(e,t)=>null!=e.polarAxis.angleAxis[t]?e.polarAxis.angleAxis[t]:"radial"===e.layout.layoutType?zy:Uy,Qy=(e,t)=>null!=e.polarAxis.radiusAxis[t]?e.polarAxis.radiusAxis[t]:"radial"===e.layout.layoutType?Ny:Ry,Vy=e=>e.polarOptions,Hy=yd([rh,nh,Ah],wy),Gy=yd([Vy,Hy],(e,t)=>{if(null!=e)return xc(e.innerRadius,t,0)}),Ky=yd([Vy,Hy],(e,t)=>{if(null!=e)return xc(e.outerRadius,t,.8*t)}),Wy=yd([Vy],e=>{if(null==e)return[0,0];var{startAngle:t,endAngle:r}=e;return[t,r]}),qy=(yd([jy,Wy],Dy),yd([Hy,Gy,Ky],(e,t,r)=>{if(null!=e&&null!=t&&null!=r)return[t,r]})),Zy=(yd([Qy,qy],Dy),yd([Eh,Vy,Gy,Ky,rh,nh],(e,t,r,n,i,o)=>{if(("centric"===e||"radial"===e)&&null!=t&&null!=r&&null!=n){var{cx:a,cy:s,startAngle:l,endAngle:c}=t;return{cx:xc(a,i,i/2),cy:xc(s,o,o/2),innerRadius:r,outerRadius:n,startAngle:l,endAngle:c,clockWise:!1}}})),Xy=(e,t)=>t,Yy=(e,t,r)=>r;function Jy(e){return null===e||void 0===e?void 0:e.id}function $y(e,t,r){var{chartData:n=[]}=t,{allowDuplicatedCategory:i,dataKey:o}=r,a=new Map;return e.forEach(e=>{var t,r=null!==(t=e.data)&&void 0!==t?t:n;if(null!=r&&0!==r.length){var s=Jy(e);r.forEach((t,r)=>{var n,l=null==o||i?r:String(Qd(t,o,null)),c=Qd(t,e.dataKey,0);n=a.has(l)?a.get(l):{},Object.assign(n,{[s]:c}),a.set(l,n)})}}),Array.from(a.values())}function e_(e){return"stackId"in e&&null!=e.stackId&&null!=e.dataKey}var t_=(e,t)=>e===t||null!=e&&null!=t&&(e[0]===t[0]&&e[1]===t[1]);function r_(e,t){return!(!Array.isArray(e)||!Array.isArray(t)||0!==e.length||0!==t.length)||e===t}var n_=e=>{var t=Eh(e);return"horizontal"===t?"xAxis":"vertical"===t?"yAxis":"centric"===t?"angleAxis":"radiusAxis"},i_=e=>e.tooltip.settings.axisId;function o_(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function a_(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o_(Object(r),!0).forEach(function(t){s_(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o_(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function s_(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var l_=[0,"auto"],c_={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:void 0,height:30,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"bottom",padding:{left:0,right:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"category",unit:void 0},u_=(e,t)=>e.cartesianAxis.xAxis[t],d_=(e,t)=>{var r=u_(e,t);return null==r?c_:r},h_={allowDataOverflow:!1,allowDecimals:!0,allowDuplicatedCategory:!0,angle:0,dataKey:void 0,domain:l_,hide:!0,id:0,includeHidden:!1,interval:"preserveEnd",minTickGap:5,mirror:!1,name:void 0,orientation:"left",padding:{top:0,bottom:0},reversed:!1,scale:"auto",tick:!0,tickCount:5,tickFormatter:void 0,ticks:void 0,type:"number",unit:void 0,width:60},A_=(e,t)=>e.cartesianAxis.yAxis[t],f_=(e,t)=>{var r=A_(e,t);return null==r?h_:r},p_={domain:[0,"auto"],includeHidden:!1,reversed:!1,allowDataOverflow:!1,allowDuplicatedCategory:!1,dataKey:void 0,id:0,name:"",range:[64,64],scale:"auto",type:"number",unit:""},m_=(e,t)=>{var r=e.cartesianAxis.zAxis[t];return null==r?p_:r},g_=(e,t,r)=>{switch(t){case"xAxis":return d_(e,r);case"yAxis":return f_(e,r);case"zAxis":return m_(e,r);case"angleAxis":return jy(e,r);case"radiusAxis":return Qy(e,r);default:throw new Error("Unexpected axis type: ".concat(t))}},y_=(e,t,r)=>{switch(t){case"xAxis":return d_(e,r);case"yAxis":return f_(e,r);case"angleAxis":return jy(e,r);case"radiusAxis":return Qy(e,r);default:throw new Error("Unexpected axis type: ".concat(t))}},__=e=>e.graphicalItems.cartesianItems.some(e=>"bar"===e.type)||e.graphicalItems.polarItems.some(e=>"radialBar"===e.type);function v_(e,t){return r=>{switch(e){case"xAxis":return"xAxisId"in r&&r.xAxisId===t;case"yAxis":return"yAxisId"in r&&r.yAxisId===t;case"zAxis":return"zAxisId"in r&&r.zAxisId===t;case"angleAxis":return"angleAxisId"in r&&r.angleAxisId===t;case"radiusAxis":return"radiusAxisId"in r&&r.radiusAxisId===t;default:return!1}}}var x_=e=>e.graphicalItems.cartesianItems,w_=yd([Xy,Yy],v_),b_=(e,t,r)=>e.filter(r).filter(e=>!0===(null===t||void 0===t?void 0:t.includeHidden)||!e.hide),B_=yd([x_,g_,w_],b_,{memoizeOptions:{resultEqualityCheck:r_}}),C_=yd([B_],e=>e.filter(e=>"area"===e.type||"bar"===e.type).filter(e_)),E_=e=>e.filter(e=>!("stackId"in e)||void 0===e.stackId),S_=yd([B_],E_),T_=e=>e.map(e=>e.data).filter(Boolean).flat(1),I_=yd([B_],T_,{memoizeOptions:{resultEqualityCheck:r_}}),F_=(e,t)=>{var{chartData:r=[],dataStartIndex:n,dataEndIndex:i}=t;return e.length>0?e:r.slice(n,i+1)},k_=yd([I_,Qg],F_),P_=(e,t,r)=>null!=(null===t||void 0===t?void 0:t.dataKey)?e.map(e=>({value:Qd(e,t.dataKey)})):r.length>0?r.map(e=>e.dataKey).flatMap(t=>e.map(e=>({value:Qd(e,t)}))):e.map(e=>({value:e})),M_=yd([k_,g_,B_],P_);function O_(e,t){switch(e){case"xAxis":return"x"===t.direction;case"yAxis":return"y"===t.direction;default:return!1}}function L_(e){if(yc(e)||e instanceof Date){var t=Number(e);if(Lc(t))return t}}function D_(e){if(Array.isArray(e)){var t=[L_(e[0]),L_(e[1])];return Vg(t)?t:void 0}var r=L_(e);if(null!=r)return[r,r]}function U_(e){return e.map(L_).filter(Ec)}var R_=e=>{var t=n_(e),r=i_(e);return y_(e,t,r)},z_=yd([R_],e=>null===e||void 0===e?void 0:e.dataKey),N_=yd([C_,Qg,R_],$y),j_=(e,t,r,n)=>{var i=t.reduce((e,t)=>{if(null==t.stackId)return e;var r=e[t.stackId];return null==r&&(r=[]),r.push(t),e[t.stackId]=r,e},{});return Object.fromEntries(Object.entries(i).map(t=>{var[i,o]=t,a=n?[...o].reverse():o,s=a.map(Jy);return[i,{stackedData:qd(e,s,r),graphicalItems:a}]}))},Q_=yd([N_,C_,uy,dy],j_),V_=(e,t,r,n)=>{var{dataStartIndex:i,dataEndIndex:o}=t;if(null==n&&"zAxis"!==r){var a=Xd(e,i,o);if(null==a||0!==a[0]||0!==a[1])return a}},H_=yd([g_],e=>e.allowDataOverflow),G_=e=>{var t;if(null==e||!("domain"in e))return l_;if(null!=e.domain)return e.domain;if("ticks"in e&&null!=e.ticks){if("number"===e.type){var r=U_(e.ticks);return[Math.min(...r),Math.max(...r)]}if("category"===e.type)return e.ticks.map(String)}return null!==(t=null===e||void 0===e?void 0:e.domain)&&void 0!==t?t:l_},K_=yd([g_],G_),W_=yd([K_,H_],Gg),q_=yd([Q_,Ng,Xy,W_],V_,{memoizeOptions:{resultEqualityCheck:t_}}),Z_=e=>e.errorBars,X_=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var n=t.filter(Boolean);if(0!==n.length){var i=n.flat();return[Math.min(...i),Math.max(...i)]}},Y_=(e,t,r,n,i)=>{var o,a;if(r.length>0&&e.forEach(e=>{r.forEach(r=>{var s,l,c=null===(s=n[r.id])||void 0===s?void 0:s.filter(e=>O_(i,e)),u=Qd(e,null!==(l=t.dataKey)&&void 0!==l?l:r.dataKey),d=function(e,t,r){return!r||"number"!==typeof t||pc(t)?[]:r.length?U_(r.flatMap(r=>{var n,i,o=Qd(e,r.dataKey);if(Array.isArray(o)?[n,i]=o:n=i=o,Lc(n)&&Lc(i))return[t-n,t+i]})):[]}(e,u,c);if(d.length>=2){var h=Math.min(...d),A=Math.max(...d);(null==o||h<o)&&(o=h),(null==a||A>a)&&(a=A)}var f=D_(u);null!=f&&(o=null==o?f[0]:Math.min(o,f[0]),a=null==a?f[1]:Math.max(a,f[1]))})}),null!=(null===t||void 0===t?void 0:t.dataKey)&&e.forEach(e=>{var r=D_(Qd(e,t.dataKey));null!=r&&(o=null==o?r[0]:Math.min(o,r[0]),a=null==a?r[1]:Math.max(a,r[1]))}),Lc(o)&&Lc(a))return[o,a]},J_=yd([k_,g_,S_,Z_,Xy],Y_,{memoizeOptions:{resultEqualityCheck:t_}});function $_(e){var{value:t}=e;if(yc(t)||t instanceof Date)return t}var ev=e=>e.referenceElements.dots,tv=(e,t,r)=>e.filter(e=>"extendDomain"===e.ifOverflow).filter(e=>"xAxis"===t?e.xAxisId===r:e.yAxisId===r),rv=yd([ev,Xy,Yy],tv),nv=e=>e.referenceElements.areas,iv=yd([nv,Xy,Yy],tv),ov=e=>e.referenceElements.lines,av=yd([ov,Xy,Yy],tv),sv=(e,t)=>{if(null!=e){var r=U_(e.map(e=>"xAxis"===t?e.x:e.y));if(0!==r.length)return[Math.min(...r),Math.max(...r)]}},lv=yd(rv,Xy,sv),cv=(e,t)=>{if(null!=e){var r=U_(e.flatMap(e=>["xAxis"===t?e.x1:e.y1,"xAxis"===t?e.x2:e.y2]));if(0!==r.length)return[Math.min(...r),Math.max(...r)]}},uv=yd([iv,Xy],cv);var dv=(e,t)=>{if(null!=e){var r=e.flatMap(e=>"xAxis"===t?function(e){var t;if(null!=e.x)return U_([e.x]);var r=null===(t=e.segment)||void 0===t?void 0:t.map(e=>e.x);return null==r||0===r.length?[]:U_(r)}(e):function(e){var t;if(null!=e.y)return U_([e.y]);var r=null===(t=e.segment)||void 0===t?void 0:t.map(e=>e.y);return null==r||0===r.length?[]:U_(r)}(e));if(0!==r.length)return[Math.min(...r),Math.max(...r)]}},hv=yd([av,Xy],dv),Av=yd(lv,hv,uv,(e,t,r)=>X_(e,r,t)),fv=(e,t,r,n,i,o,a,s)=>null!=r?r:function(e,t,r){if(r||null!=t){if("function"===typeof e&&null!=t)try{var n=e(t,r);if(Vg(n))return Hg(n,t,r)}catch(A){}if(Array.isArray(e)&&2===e.length){var i,o,[a,s]=e;if("auto"===a)null!=t&&(i=Math.min(...t));else if(gc(a))i=a;else if("function"===typeof a)try{null!=t&&(i=a(null===t||void 0===t?void 0:t[0]))}catch(f){}else if("string"===typeof a&&Yd.test(a)){var l=Yd.exec(a);if(null==l||null==l[1]||null==t)i=void 0;else{var c=+l[1];i=t[0]-c}}else i=null===t||void 0===t?void 0:t[0];if("auto"===s)null!=t&&(o=Math.max(...t));else if(gc(s))o=s;else if("function"===typeof s)try{null!=t&&(o=s(null===t||void 0===t?void 0:t[1]))}catch(p){}else if("string"===typeof s&&Jd.test(s)){var u=Jd.exec(s);if(null==u||null==u[1]||null==t)o=void 0;else{var d=+u[1];o=t[1]+d}}else o=null===t||void 0===t?void 0:t[1];var h=[i,o];if(Vg(h))return null==t?h:Hg(h,t,r)}}}(t,"vertical"===a&&"xAxis"===s||"horizontal"===a&&"yAxis"===s?X_(n,o,i):X_(o,i),e.allowDataOverflow),pv=yd([g_,K_,W_,q_,J_,Av,Eh,Xy],fv,{memoizeOptions:{resultEqualityCheck:t_}}),mv=[0,1],gv=(e,t,r,n,i,o,a)=>{if(null!=e&&null!=r&&0!==r.length||void 0!==a){var s,{dataKey:l,type:c}=e,u=Vd(t,o);return u&&null==l?Fh()(0,null!==(s=null===r||void 0===r?void 0:r.length)&&void 0!==s?s:0):"category"===c?((e,t,r)=>{var n=e.map($_).filter(e=>null!=e);return r&&(null==t.dataKey||t.allowDuplicatedCategory&&wc(n))?Fh()(0,e.length):t.allowDuplicatedCategory?n:Array.from(new Set(n))})(n,e,u):"expand"===i?mv:a}},yv=yd([g_,Eh,k_,M_,uy,Xy,pv],gv),_v=(e,r,n,i,o)=>{if(null!=e){var{scale:a,type:s}=e;if("auto"===a)return"radial"===r&&"radiusAxis"===o?"band":"radial"===r&&"angleAxis"===o?"linear":"category"===s&&i&&(i.indexOf("LineChart")>=0||i.indexOf("AreaChart")>=0||i.indexOf("ComposedChart")>=0&&!n)?"point":"category"===s?"band":"linear";if("string"===typeof a){var l="scale".concat(Cc(a));return l in t?l:"point"}}},vv=yd([g_,Eh,__,hy,Xy],_v);function xv(e,r,n,i){if(null!=n&&null!=i){if("function"===typeof e.scale)return e.scale.copy().domain(n).range(i);var o=function(e){if(null!=e){if(e in t)return t[e]();var r="scale".concat(Cc(e));return r in t?t[r]():void 0}}(r);if(null!=o){var a=o.domain(n).range(i);return(e=>{var t=e.domain();if(t&&!(t.length<=2)){var r=t.length,n=e.range(),i=Math.min(n[0],n[1])-Kd,o=Math.max(n[0],n[1])+Kd,a=e(t[0]),s=e(t[r-1]);(a<i||a>o||s<i||s>o)&&e.domain([t[0],t[r-1]])}})(a),a}}}var wv=(e,t,r)=>{var n=G_(t);if("auto"===r||"linear"===r)return null!=t&&t.tickCount&&Array.isArray(n)&&("auto"===n[0]||"auto"===n[1])&&Vg(e)?function(e){var[t,r]=e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=Math.max(n,2),[a,s]=iy([t,r]);if(a===-1/0||s===1/0){var l=s===1/0?[a,...ey(0,n-1).map(()=>1/0)]:[...ey(0,n-1).map(()=>-1/0),s];return t>r?l.reverse():l}if(a===s)return ay(a,n,i);var{step:c,tickMin:u,tickMax:d}=sy(a,s,o,i,0),h=ny(u,d.add(new(qg())(.1).mul(c)),c);return t>r?h.reverse():h}(e,t.tickCount,t.allowDecimals):null!=t&&t.tickCount&&"number"===t.type&&Vg(e)?function(e,t){var[r,n]=e,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],[o,a]=iy([r,n]);if(o===-1/0||a===1/0)return[r,n];if(o===a)return[o];var s=Math.max(t,2),l=oy(new(qg())(a).sub(o).div(s-1),i,0),c=[...ny(new(qg())(o),new(qg())(a),l),a];return!1===i&&(c=c.map(e=>Math.round(e))),r>n?c.reverse():c}(e,t.tickCount,t.allowDecimals):void 0},bv=yd([yv,y_,vv],wv),Bv=(e,t,r,n)=>{if("angleAxis"!==n&&"number"===(null===e||void 0===e?void 0:e.type)&&Vg(t)&&Array.isArray(r)&&r.length>0){var i=t[0],o=r[0],a=t[1],s=r[r.length-1];return[Math.min(i,o),Math.max(a,s)]}return t},Cv=yd([g_,yv,bv,Xy],Bv),Ev=yd(M_,g_,(e,t)=>{if(t&&"number"===t.type){var r=1/0,n=Array.from(U_(e.map(e=>e.value))).sort((e,t)=>e-t),i=n[0],o=n[n.length-1];if(null==i||null==o)return 1/0;var a=o-i;if(0===a)return 1/0;for(var s=0;s<n.length-1;s++){var l=n[s],c=n[s+1];if(null!=l&&null!=c){var u=c-l;r=Math.min(r,u)}}return r/a}}),Sv=yd(Ev,Eh,cy,Ah,(e,t,r,n,i)=>i,(e,t,r,n,i)=>{if(!Lc(e))return 0;var o="vertical"===t?n.height:n.width;if("gap"===i)return e*o/2;if("no-gap"===i){var a=xc(r,e*o),s=e*o/2;return s-a-(s-a)/o*a}return 0}),Tv=yd(d_,(e,t,r)=>{var n=d_(e,t);return null==n||"string"!==typeof n.padding?0:Sv(e,"xAxis",t,r,n.padding)},(e,t)=>{var r,n;if(null==e)return{left:0,right:0};var{padding:i}=e;return"string"===typeof i?{left:t,right:t}:{left:(null!==(r=i.left)&&void 0!==r?r:0)+t,right:(null!==(n=i.right)&&void 0!==n?n:0)+t}}),Iv=yd(f_,(e,t,r)=>{var n=f_(e,t);return null==n||"string"!==typeof n.padding?0:Sv(e,"yAxis",t,r,n.padding)},(e,t)=>{var r,n;if(null==e)return{top:0,bottom:0};var{padding:i}=e;return"string"===typeof i?{top:t,bottom:t}:{top:(null!==(r=i.top)&&void 0!==r?r:0)+t,bottom:(null!==(n=i.bottom)&&void 0!==n?n:0)+t}}),Fv=yd([Ah,Tv,_h,yh,(e,t,r)=>r],(e,t,r,n,i)=>{var{padding:o}=n;return i?[o.left,r.width-o.right]:[e.left+t.left,e.left+e.width-t.right]}),kv=yd([Ah,Eh,Iv,_h,yh,(e,t,r)=>r],(e,t,r,n,i,o)=>{var{padding:a}=i;return o?[n.height-a.bottom,a.top]:"horizontal"===t?[e.top+e.height-r.bottom,e.top+r.top]:[e.top+r.top,e.top+e.height-r.bottom]}),Pv=(e,t,r,n)=>{var i;switch(t){case"xAxis":return Fv(e,r,n);case"yAxis":return kv(e,r,n);case"zAxis":return null===(i=m_(e,r))||void 0===i?void 0:i.range;case"angleAxis":return Wy(e);case"radiusAxis":return qy(e,r);default:return}},Mv=yd([g_,Pv],Dy),Ov=yd([g_,vv,Cv,Mv],xv);yd([B_,Z_,Xy],(e,t,r)=>e.flatMap(e=>t[e.id]).filter(Boolean).filter(e=>O_(r,e)));function Lv(e,t){return e.id<t.id?-1:e.id>t.id?1:0}var Dv=(e,t)=>t,Uv=(e,t,r)=>r,Rv=yd(ah,Dv,Uv,(e,t,r)=>e.filter(e=>e.orientation===t).filter(e=>e.mirror===r).sort(Lv)),zv=yd(sh,Dv,Uv,(e,t,r)=>e.filter(e=>e.orientation===t).filter(e=>e.mirror===r).sort(Lv)),Nv=(e,t)=>({width:e.width,height:t.height}),jv=yd(Ah,d_,Nv),Qv=yd(nh,Ah,Rv,Dv,Uv,(e,t,r,n,i)=>{var o,a={};return r.forEach(r=>{var s=Nv(t,r);null==o&&(o=((e,t,r)=>{switch(t){case"top":return e.top;case"bottom":return r-e.bottom;default:return 0}})(t,n,e));var l="top"===n&&!i||"bottom"===n&&i;a[r.id]=o-Number(l)*s.height,o+=(l?-1:1)*s.height}),a}),Vv=yd(rh,Ah,zv,Dv,Uv,(e,t,r,n,i)=>{var o,a={};return r.forEach(r=>{var s=((e,t)=>({width:"number"===typeof t.width?t.width:60,height:e.height}))(t,r);null==o&&(o=((e,t,r)=>{switch(t){case"left":return e.left;case"right":return r-e.right;default:return 0}})(t,n,e));var l="left"===n&&!i||"right"===n&&i;a[r.id]=o-Number(l)*s.width,o+=(l?-1:1)*s.width}),a}),Hv=yd([Ah,d_,(e,t)=>{var r=d_(e,t);if(null!=r)return Qv(e,r.orientation,r.mirror)},(e,t)=>t],(e,t,r,n)=>{if(null!=t){var i=null===r||void 0===r?void 0:r[n];return null==i?{x:e.left,y:0}:{x:e.left,y:i}}}),Gv=yd([Ah,f_,(e,t)=>{var r=f_(e,t);if(null!=r)return Vv(e,r.orientation,r.mirror)},(e,t)=>t],(e,t,r,n)=>{if(null!=t){var i=null===r||void 0===r?void 0:r[n];return null==i?{x:0,y:e.top}:{x:i,y:e.top}}}),Kv=yd(Ah,f_,(e,t)=>({width:"number"===typeof t.width?t.width:60,height:e.height})),Wv=(e,t,r)=>{switch(t){case"xAxis":return jv(e,r).width;case"yAxis":return Kv(e,r).height;default:return}},qv=(e,t,r,n)=>{if(null!=r){var{allowDuplicatedCategory:i,type:o,dataKey:a}=r,s=Vd(e,n),l=t.map(e=>e.value);return a&&s&&"category"===o&&i&&wc(l)?l:void 0}},Zv=yd([Eh,M_,g_,Xy],qv),Xv=(e,t,r,n)=>{if(null!=r&&null!=r.dataKey){var{type:i,scale:o}=r;return!Vd(e,n)||"number"!==i&&"auto"===o?void 0:t.map(e=>e.value)}},Yv=yd([Eh,M_,y_,Xy],Xv),Jv=yd([Eh,(e,t,r)=>{switch(t){case"xAxis":return d_(e,r);case"yAxis":return f_(e,r);default:throw new Error("Unexpected axis type: ".concat(t))}},vv,Ov,Zv,Yv,Pv,bv,Xy],(e,t,r,n,i,o,a,s,l)=>{if(null!=t){var c=Vd(e,l);return{angle:t.angle,interval:t.interval,minTickGap:t.minTickGap,orientation:t.orientation,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit,axisType:l,categoricalDomain:o,duplicateDomain:i,isCategorical:c,niceTicks:s,range:a,realScaleType:r,scale:n}}}),$v=yd([Eh,y_,vv,Ov,bv,Pv,Zv,Yv,Xy],(e,t,r,n,i,o,a,s,l)=>{if(null!=t&&null!=n){var c=Vd(e,l),{type:u,ticks:d,tickCount:h}=t,A="scaleBand"===r&&"function"===typeof n.bandwidth?n.bandwidth()/2:2,f="category"===u&&n.bandwidth?n.bandwidth()/A:0;f="angleAxis"===l&&null!=o&&o.length>=2?2*fc(o[0]-o[1])*f:f;var p=d||i;return p?p.map((e,t)=>{var r=a?a.indexOf(e):e;return{index:t,coordinate:n(r)+f,value:e,offset:f}}).filter(e=>Lc(e.coordinate)):c&&s?s.map((e,t)=>({coordinate:n(e)+f,value:e,index:t,offset:f})).filter(e=>Lc(e.coordinate)):n.ticks?n.ticks(h).map(e=>({coordinate:n(e)+f,value:e,offset:f})):n.domain().map((e,t)=>({coordinate:n(e)+f,value:a?a[e]:e,index:t,offset:f}))}}),ex=yd([Eh,y_,Ov,Pv,Zv,Yv,Xy],(e,t,r,n,i,o,a)=>{if(null!=t&&null!=r&&null!=n&&n[0]!==n[1]){var s=Vd(e,a),{tickCount:l}=t,c=0;return c="angleAxis"===a&&(null===n||void 0===n?void 0:n.length)>=2?2*fc(n[0]-n[1])*c:c,s&&o?o.map((e,t)=>({coordinate:r(e)+c,value:e,index:t,offset:c})):r.ticks?r.ticks(l).map(e=>({coordinate:r(e)+c,value:e,offset:c})):r.domain().map((e,t)=>({coordinate:r(e)+c,value:i?i[e]:e,index:t,offset:c}))}}),tx=yd(g_,Ov,(e,t)=>{if(null!=e&&null!=t)return a_(a_({},e),{},{scale:t})}),rx=yd([g_,vv,yv,Mv],xv),nx=(yd((e,t,r)=>m_(e,r),rx,(e,t)=>{if(null!=e&&null!=t)return a_(a_({},e),{},{scale:t})}),yd([Eh,ah,sh],(e,t,r)=>{switch(e){case"horizontal":return t.some(e=>e.reversed)?"right-to-left":"left-to-right";case"vertical":return r.some(e=>e.reversed)?"bottom-to-top":"top-to-bottom";case"centric":case"radial":return"left-to-right";default:return}})),ix=e=>e.options.defaultTooltipEventType,ox=e=>e.options.validateTooltipEventTypes;function ax(e,t,r){if(null==e)return t;var n=e?"axis":"item";return null==r?t:r.includes(n)?n:t}function sx(e,t){return ax(t,ix(e),ox(e))}var lx=(e,t)=>{var r,n=Number(t);if(!pc(n)&&null!=t)return n>=0?null===e||void 0===e||null===(r=e[n])||void 0===r?void 0:r.value:void 0};function cx(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function ux(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?cx(Object(r),!0).forEach(function(t){dx(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cx(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function dx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var hx=(e,t,r,n)=>{if(null==t)return zu;var i=function(e,t,r){return"axis"===t?"click"===r?e.axisInteraction.click:e.axisInteraction.hover:"click"===r?e.itemInteraction.click:e.itemInteraction.hover}(e,t,r);if(null==i)return zu;if(i.active)return i;if(e.keyboardInteraction.active)return e.keyboardInteraction;if(e.syncInteraction.active&&null!=e.syncInteraction.index)return e.syncInteraction;var o=!0===e.settings.active;if(null!=i.index){if(o)return ux(ux({},i),{},{active:!0})}else if(null!=n)return{active:!0,coordinate:void 0,dataKey:void 0,index:n,graphicalItemId:void 0};return ux(ux({},zu),{},{coordinate:i.coordinate})};function Ax(e,t){var r=function(e){if("number"===typeof e)return Number.isFinite(e)?e:void 0;if(e instanceof Date){var t=e.valueOf();return Number.isFinite(t)?t:void 0}var r=Number(e);return Number.isFinite(r)?r:void 0}(e),n=t[0],i=t[1];if(void 0===r)return!1;var o=Math.min(n,i),a=Math.max(n,i);return r>=o&&r<=a}var fx=(e,t,r,n)=>{var i=null===e||void 0===e?void 0:e.index;if(null==i)return null;var o=Number(i);if(!Lc(o))return i;var a=1/0;t.length>0&&(a=t.length-1);var s=Math.max(0,Math.min(o,a)),l=t[s];return null==l||function(e,t,r){if(null==r||null==t)return!0;var n=Qd(e,t);return null==n||!Vg(r)||Ax(n,r)}(l,r,n)?String(s):null},px=(e,t,r,n,i,o,a,s)=>{if(null!=o&&null!=s){var l=a[0],c=null==l?void 0:s(l.positions,o);if(null!=c)return c;var u=null===i||void 0===i?void 0:i[Number(o)];if(u)return"horizontal"===r?{x:u.coordinate,y:(n.top+t)/2}:{x:(n.left+e)/2,y:u.coordinate}}},mx=(e,t,r,n)=>{if("axis"===t)return e.tooltipItemPayloads;if(0===e.tooltipItemPayloads.length)return[];var i;if(null==(i="hover"===r?e.itemInteraction.hover.graphicalItemId:e.itemInteraction.click.graphicalItemId)&&null!=n){var o=e.tooltipItemPayloads[0];return null!=o?[o]:[]}return e.tooltipItemPayloads.filter(e=>{var t;return(null===(t=e.settings)||void 0===t?void 0:t.graphicalItemId)===i})},gx=e=>e.options.tooltipPayloadSearcher,yx=e=>e.tooltip;function _x(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function vx(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_x(Object(r),!0).forEach(function(t){xx(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_x(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function xx(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var wx=(e,t,r,n,i,o,a)=>{if(null!=t&&null!=o){var{chartData:s,computedData:l,dataStartIndex:c,dataEndIndex:u}=r;return e.reduce((e,r)=>{var d,h,A,{dataDefinedOnItem:f,settings:p}=r,m=function(e,t){return null!=e?e:t}(f,s),g=Array.isArray(m)?Rd(m,c,u):m,y=null!==(d=null===p||void 0===p?void 0:p.dataKey)&&void 0!==d?d:n,_=null===p||void 0===p?void 0:p.nameKey;(h=n&&Array.isArray(g)&&!Array.isArray(g[0])&&"axis"===a?function(e,t,r){if(e&&e.length)return e.find(e=>e&&("function"===typeof t?t(e):dc()(e,t))===r)}(g,n,i):o(g,t,l,_),Array.isArray(h))?h.forEach(t=>{var r=vx(vx({},p),{},{name:t.name,unit:t.unit,color:void 0,fill:void 0});e.push(eh({tooltipEntrySettings:r,dataKey:t.dataKey,payload:t.payload,value:Qd(t.payload,t.dataKey),name:t.name}))}):e.push(eh({tooltipEntrySettings:p,dataKey:y,payload:h,value:Qd(h,y),name:null!==(A=Qd(h,_))&&void 0!==A?A:null===p||void 0===p?void 0:p.name}));return e},[])}},bx=yd([R_,Eh,__,hy,n_],_v),Bx=yd([e=>e.graphicalItems.cartesianItems,e=>e.graphicalItems.polarItems],(e,t)=>[...e,...t]),Cx=yd([n_,i_],v_),Ex=yd([Bx,R_,Cx],b_,{memoizeOptions:{resultEqualityCheck:r_}}),Sx=yd([Ex],e=>e.filter(e_)),Tx=yd([Ex],T_,{memoizeOptions:{resultEqualityCheck:r_}}),Ix=yd([Tx,Ng],F_),Fx=yd([Sx,Ng,R_],$y),kx=yd([Ix,R_,Ex],P_),Px=yd([R_],G_),Mx=yd([R_],e=>e.allowDataOverflow),Ox=yd([Px,Mx],Gg),Lx=yd([Ex],e=>e.filter(e_)),Dx=yd([Fx,Lx,uy,dy],j_),Ux=yd([Dx,Ng,n_,Ox],V_),Rx=yd([Ex],E_),zx=yd([Ix,R_,Rx,Z_,n_],Y_,{memoizeOptions:{resultEqualityCheck:t_}}),Nx=yd([ev,n_,i_],tv),jx=yd([Nx,n_],sv),Qx=yd([nv,n_,i_],tv),Vx=yd([Qx,n_],cv),Hx=yd([ov,n_,i_],tv),Gx=yd([Hx,n_],dv),Kx=yd([jx,Gx,Vx],X_),Wx=yd([R_,Px,Ox,Ux,zx,Kx,Eh,n_],fv),qx=yd([R_,Eh,Ix,kx,uy,n_,Wx],gv),Zx=yd([qx,R_,bx],wv),Xx=yd([R_,qx,Zx,n_],Bv),Yx=e=>{var t=n_(e),r=i_(e);return Pv(e,t,r,!1)},Jx=yd([R_,Yx],Dy),$x=yd([R_,bx,Xx,Jx],xv),ew=yd([Eh,kx,R_,n_],qv),tw=yd([Eh,kx,R_,n_],Xv),rw=yd([Eh,R_,bx,$x,Yx,ew,tw,n_],(e,t,r,n,i,o,a,s)=>{if(t){var{type:l}=t,c=Vd(e,s);if(n){var u="scaleBand"===r&&n.bandwidth?n.bandwidth()/2:2,d="category"===l&&n.bandwidth?n.bandwidth()/u:0;return d="angleAxis"===s&&null!=i&&(null===i||void 0===i?void 0:i.length)>=2?2*fc(i[0]-i[1])*d:d,c&&a?a.map((e,t)=>({coordinate:n(e)+d,value:e,index:t,offset:d})):n.domain().map((e,t)=>({coordinate:n(e)+d,value:o?o[e]:e,index:t,offset:d}))}}}),nw=yd([ix,ox,e=>e.tooltip.settings],(e,t,r)=>ax(r.shared,e,t)),iw=e=>e.tooltip.settings.trigger,ow=e=>e.tooltip.settings.defaultIndex,aw=yd([yx,nw,iw,ow],hx),sw=yd([aw,Ix,z_,qx],fx),lw=yd([rw,sw],lx),cw=yd([aw],e=>{if(e)return e.dataKey}),uw=yd([aw],e=>{if(e)return e.graphicalItemId}),dw=yd([yx,nw,iw,ow],mx),hw=yd([rh,nh,Eh,Ah,rw,ow,dw,gx],px),Aw=yd([aw,hw],(e,t)=>null!==e&&void 0!==e&&e.coordinate?e.coordinate:t),fw=yd([aw],e=>{var t;return null!==(t=null===e||void 0===e?void 0:e.active)&&void 0!==t&&t}),pw=yd([dw,sw,Ng,z_,lw,gx,nw],wx);yd([pw],e=>{if(null!=e){var t=e.map(e=>e.payload).filter(e=>null!=e);return Array.from(new Set(t))}});function mw(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function gw(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?mw(Object(r),!0).forEach(function(t){yw(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):mw(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function yw(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var _w=(e,t,r,n,i)=>{var o,a=null!==(o=null===t||void 0===t?void 0:t.length)&&void 0!==o?o:0;if(a<=1||null==e)return 0;if("angleAxis"===n&&null!=i&&Math.abs(Math.abs(i[1]-i[0])-360)<=1e-6)for(var s=0;s<a;s++){var l,c,u,d,h,A=s>0?null===(l=r[s-1])||void 0===l?void 0:l.coordinate:null===(c=r[a-1])||void 0===c?void 0:c.coordinate,f=null===(u=r[s])||void 0===u?void 0:u.coordinate,p=s>=a-1?null===(d=r[0])||void 0===d?void 0:d.coordinate:null===(h=r[s+1])||void 0===h?void 0:h.coordinate,m=void 0;if(null!=A&&null!=f&&null!=p)if(fc(f-A)!==fc(p-f)){var g=[];if(fc(p-f)===fc(i[1]-i[0])){m=p;var y=f+i[1]-i[0];g[0]=Math.min(y,(y+A)/2),g[1]=Math.max(y,(y+A)/2)}else{m=A;var _=p+i[1]-i[0];g[0]=Math.min(f,(_+f)/2),g[1]=Math.max(f,(_+f)/2)}var v,x=[Math.min(f,(m+f)/2),Math.max(f,(m+f)/2)];if(e>x[0]&&e<=x[1]||e>=g[0]&&e<=g[1])return null===(v=r[s])||void 0===v?void 0:v.index}else{var w,b=Math.min(A,p),B=Math.max(A,p);if(e>(b+f)/2&&e<=(B+f)/2)return null===(w=r[s])||void 0===w?void 0:w.index}}else if(t)for(var C=0;C<a;C++){var E=t[C];if(null!=E){var S=t[C+1],T=t[C-1];if(0===C&&null!=S&&e<=(E.coordinate+S.coordinate)/2)return E.index;if(C===a-1&&null!=T&&e>(E.coordinate+T.coordinate)/2)return E.index;if(C>0&&C<a-1&&null!=T&&null!=S&&e>(E.coordinate+T.coordinate)/2&&e<=(E.coordinate+S.coordinate)/2)return E.index}}return-1},vw=(e,t)=>t,xw=(e,t,r)=>r,ww=(e,t,r,n)=>n,bw=yd(rw,e=>Id()(e,e=>e.coordinate)),Bw=yd([yx,vw,xw,ww],hx),Cw=yd([Bw,Ix,z_,qx],fx),Ew=yd([yx,vw,xw,ww],mx),Sw=yd([rh,nh,Eh,Ah,rw,ww,Ew,gx],px),Tw=yd([Bw,Sw],(e,t)=>{var r;return null!==(r=e.coordinate)&&void 0!==r?r:t}),Iw=yd([rw,Cw],lx),Fw=yd([Ew,Cw,Ng,z_,Iw,gx,vw],wx),kw=yd([Bw,Cw],(e,t)=>({isActive:e.active&&null!=t,activeIndex:t})),Pw=(e,t,r,n,i,o,a)=>{if(e&&n&&i&&o&&r){var s=Cy(e,r);if(s){var l=((e,t)=>"centric"===t?e.angle:e.radius)(s,t),c=_w(l,a,o,n,i),u=((e,t,r,n)=>{var i=t.find(e=>e&&e.index===r);if(i){if("centric"===e){var o=i.coordinate,{radius:a}=n;return gw(gw(gw({},n),xy(n.cx,n.cy,a,o)),{},{angle:o,radius:a})}var s=i.coordinate,{angle:l}=n;return gw(gw(gw({},n),xy(n.cx,n.cy,s,l)),{},{angle:l,radius:s})}return{angle:0,clockWise:!1,cx:0,cy:0,endAngle:0,innerRadius:0,outerRadius:0,radius:0,startAngle:0,x:0,y:0}})(t,o,c,s);return{activeIndex:String(c),activeCoordinate:u}}}},Mw=yd([(e,t)=>t,Eh,Zy,n_,Jx,rw,bw,Ah],(e,t,r,n,i,o,a,s)=>{if(e&&t&&n&&i&&o)return"horizontal"===t||"vertical"===t?((e,t,r,n,i,o,a)=>{if(e&&r&&n&&i&&function(e,t){var{chartX:r,chartY:n}=e;return r>=t.left&&r<=t.left+t.width&&n>=t.top&&n<=t.top+t.height}(e,a)){var s=((e,t)=>"horizontal"===t?e.chartX:"vertical"===t?e.chartY:void 0)(e,t),l=_w(s,o,i,r,n),c=((e,t,r,n)=>{var i=t.find(e=>e&&e.index===r);if(i){if("horizontal"===e)return{x:i.coordinate,y:n.chartY};if("vertical"===e)return{x:n.chartX,y:i.coordinate}}return{x:0,y:0}})(t,i,l,e);return{activeIndex:String(l),activeCoordinate:c}}})(e,t,n,i,o,a,s):Pw(e,t,r,n,i,o,a)}),Ow=e=>{var t=e.currentTarget.getBoundingClientRect(),r=t.width/e.currentTarget.offsetWidth,n=t.height/e.currentTarget.offsetHeight;return{chartX:Math.round((e.clientX-t.left)/r),chartY:Math.round((e.clientY-t.top)/n)}},Lw=Or("mouseClick"),Dw=Un();Dw.startListening({actionCreator:Lw,effect:(e,t)=>{var r=e.payload,n=Mw(t.getState(),Ow(r));null!=(null===n||void 0===n?void 0:n.activeIndex)&&t.dispatch(Xu({activeIndex:n.activeIndex,activeDataKey:void 0,activeCoordinate:n.activeCoordinate}))}});var Uw=Or("mouseMove"),Rw=Un(),zw=null;function Nw(e,t){return t instanceof HTMLElement?"HTMLElement <".concat(t.tagName,' class="').concat(t.className,'">'):t===window?"global.window":"children"===e&&"object"===typeof t&&null!==t?"<<CHILDREN>>":t}function jw(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Qw(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jw(Object(r),!0).forEach(function(t){Vw(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jw(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Vw(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}Rw.startListening({actionCreator:Uw,effect:(e,t)=>{var r=e.payload;null!==zw&&cancelAnimationFrame(zw);var n=Ow(r);zw=requestAnimationFrame(()=>{var e=t.getState();if("axis"===sx(e,e.tooltip.settings.shared)){var r=Mw(e,n);null!=(null===r||void 0===r?void 0:r.activeIndex)?t.dispatch(Zu({activeIndex:r.activeIndex,activeDataKey:void 0,activeCoordinate:r.activeCoordinate})):t.dispatch(Wu())}zw=null})}});var Hw=on({name:"cartesianAxis",initialState:{xAxis:{},yAxis:{},zAxis:{}},reducers:{addXAxis:{reducer(e,t){e.xAxis[t.payload.id]=t.payload},prepare:zr()},replaceXAxis:{reducer(e,t){var{prev:r,next:n}=t.payload;void 0!==e.xAxis[r.id]&&(r.id!==n.id&&delete e.xAxis[r.id],e.xAxis[n.id]=n)},prepare:zr()},removeXAxis:{reducer(e,t){delete e.xAxis[t.payload.id]},prepare:zr()},addYAxis:{reducer(e,t){e.yAxis[t.payload.id]=t.payload},prepare:zr()},replaceYAxis:{reducer(e,t){var{prev:r,next:n}=t.payload;void 0!==e.yAxis[r.id]&&(r.id!==n.id&&delete e.yAxis[r.id],e.yAxis[n.id]=n)},prepare:zr()},removeYAxis:{reducer(e,t){delete e.yAxis[t.payload.id]},prepare:zr()},addZAxis:{reducer(e,t){e.zAxis[t.payload.id]=t.payload},prepare:zr()},replaceZAxis:{reducer(e,t){var{prev:r,next:n}=t.payload;void 0!==e.zAxis[r.id]&&(r.id!==n.id&&delete e.zAxis[r.id],e.zAxis[n.id]=n)},prepare:zr()},removeZAxis:{reducer(e,t){delete e.zAxis[t.payload.id]},prepare:zr()},updateYAxisWidth(e,t){var{id:r,width:n}=t.payload,i=e.yAxis[r];if(i){var o=i.widthHistory||[];if(3===o.length&&o[0]===o[2]&&n===o[1]&&n!==i.width&&Math.abs(n-o[0])<=1)return;var a=[...o,n].slice(-3);e.yAxis[r]=Qw(Qw({},e.yAxis[r]),{},{width:n,widthHistory:a})}}}}),{addXAxis:Gw,replaceXAxis:Kw,removeXAxis:Ww,addYAxis:qw,replaceYAxis:Zw,removeYAxis:Xw,addZAxis:Yw,replaceZAxis:Jw,removeZAxis:$w,updateYAxisWidth:eb}=Hw.actions,tb=Hw.reducer,rb=on({name:"graphicalItems",initialState:{cartesianItems:[],polarItems:[]},reducers:{addCartesianGraphicalItem:{reducer(e,t){e.cartesianItems.push(t.payload)},prepare:zr()},replaceCartesianGraphicalItem:{reducer(e,t){var{prev:r,next:n}=t.payload,i=pr(e).cartesianItems.indexOf(r);i>-1&&(e.cartesianItems[i]=n)},prepare:zr()},removeCartesianGraphicalItem:{reducer(e,t){var r=pr(e).cartesianItems.indexOf(t.payload);r>-1&&e.cartesianItems.splice(r,1)},prepare:zr()},addPolarGraphicalItem:{reducer(e,t){e.polarItems.push(t.payload)},prepare:zr()},removePolarGraphicalItem:{reducer(e,t){var r=pr(e).polarItems.indexOf(t.payload);r>-1&&e.polarItems.splice(r,1)},prepare:zr()}}}),{addCartesianGraphicalItem:nb,replaceCartesianGraphicalItem:ib,removeCartesianGraphicalItem:ob,addPolarGraphicalItem:ab,removePolarGraphicalItem:sb}=rb.actions,lb=rb.reducer,cb=on({name:"referenceElements",initialState:{dots:[],areas:[],lines:[]},reducers:{addDot:(e,t)=>{e.dots.push(t.payload)},removeDot:(e,t)=>{var r=pr(e).dots.findIndex(e=>e===t.payload);-1!==r&&e.dots.splice(r,1)},addArea:(e,t)=>{e.areas.push(t.payload)},removeArea:(e,t)=>{var r=pr(e).areas.findIndex(e=>e===t.payload);-1!==r&&e.areas.splice(r,1)},addLine:(e,t)=>{e.lines.push(t.payload)},removeLine:(e,t)=>{var r=pr(e).lines.findIndex(e=>e===t.payload);-1!==r&&e.lines.splice(r,1)}}}),{addDot:ub,removeDot:db,addArea:hb,removeArea:Ab,addLine:fb,removeLine:pb}=cb.actions,mb=cb.reducer,gb={x:0,y:0,width:0,height:0,padding:{top:0,right:0,bottom:0,left:0}},yb=on({name:"brush",initialState:gb,reducers:{setBrushSettings:(e,t)=>null==t.payload?gb:t.payload}}),{setBrushSettings:_b}=yb.actions,vb=yb.reducer,xb=on({name:"legend",initialState:{settings:{layout:"horizontal",align:"center",verticalAlign:"middle",itemSorter:"value"},size:{width:0,height:0},payload:[]},reducers:{setLegendSize(e,t){e.size.width=t.payload.width,e.size.height=t.payload.height},setLegendSettings(e,t){e.settings.align=t.payload.align,e.settings.layout=t.payload.layout,e.settings.verticalAlign=t.payload.verticalAlign,e.settings.itemSorter=t.payload.itemSorter},addLegendPayload:{reducer(e,t){e.payload.push(t.payload)},prepare:zr()},replaceLegendPayload:{reducer(e,t){var{prev:r,next:n}=t.payload,i=pr(e).payload.indexOf(r);i>-1&&(e.payload[i]=n)},prepare:zr()},removeLegendPayload:{reducer(e,t){var r=pr(e).payload.indexOf(t.payload);r>-1&&e.payload.splice(r,1)},prepare:zr()}}}),{setLegendSize:wb,setLegendSettings:bb,addLegendPayload:Bb,replaceLegendPayload:Cb,removeLegendPayload:Eb}=xb.actions,Sb=xb.reducer,Tb={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,barSize:void 0,className:void 0,maxBarSize:void 0,stackOffset:"none",syncId:void 0,syncMethod:"index",baseValue:void 0,reverseStackOrder:!1},Ib=on({name:"rootProps",initialState:Tb,reducers:{updateOptions:(e,t)=>{var r;e.accessibilityLayer=t.payload.accessibilityLayer,e.barCategoryGap=t.payload.barCategoryGap,e.barGap=null!==(r=t.payload.barGap)&&void 0!==r?r:Tb.barGap,e.barSize=t.payload.barSize,e.maxBarSize=t.payload.maxBarSize,e.stackOffset=t.payload.stackOffset,e.syncId=t.payload.syncId,e.syncMethod=t.payload.syncMethod,e.className=t.payload.className,e.baseValue=t.payload.baseValue,e.reverseStackOrder=t.payload.reverseStackOrder}}}),Fb=Ib.reducer,{updateOptions:kb}=Ib.actions,Pb=on({name:"polarAxis",initialState:{radiusAxis:{},angleAxis:{}},reducers:{addRadiusAxis(e,t){e.radiusAxis[t.payload.id]=t.payload},removeRadiusAxis(e,t){delete e.radiusAxis[t.payload.id]},addAngleAxis(e,t){e.angleAxis[t.payload.id]=t.payload},removeAngleAxis(e,t){delete e.angleAxis[t.payload.id]}}}),{addRadiusAxis:Mb,removeRadiusAxis:Ob,addAngleAxis:Lb,removeAngleAxis:Db}=Pb.actions,Ub=Pb.reducer,Rb=on({name:"polarOptions",initialState:null,reducers:{updatePolarOptions:(e,t)=>t.payload}}),{updatePolarOptions:zb}=Rb.actions,Nb=Rb.reducer,jb=Or("keyDown"),Qb=Or("focus"),Vb=Un();Vb.startListening({actionCreator:jb,effect:(e,t)=>{var r=t.getState();if(!1!==r.rootProps.accessibilityLayer){var{keyboardInteraction:n}=r.tooltip,i=e.payload;if("ArrowRight"===i||"ArrowLeft"===i||"Enter"===i){var o=fx(n,Ix(r),z_(r),qx(r)),a=null==o?-1:Number(o);if(Number.isFinite(a)&&!(a<0)){var s=rw(r);if("Enter"!==i){var l=a+("ArrowRight"===i?1:-1)*("left-to-right"===nx(r)?1:-1);if(!(null==s||l>=s.length||l<0)){var c=Sw(r,"axis","hover",String(l));t.dispatch(Ju({active:!0,activeIndex:l.toString(),activeCoordinate:c}))}}else{var u=Sw(r,"axis","hover",String(n.index));t.dispatch(Ju({active:!n.active,activeIndex:n.index,activeCoordinate:u}))}}}}}}),Vb.startListening({actionCreator:Qb,effect:(e,t)=>{var r=t.getState();if(!1!==r.rootProps.accessibilityLayer){var{keyboardInteraction:n}=r.tooltip;if(!n.active&&null==n.index){var i=Sw(r,"axis","hover",String("0"));t.dispatch(Ju({active:!0,activeIndex:"0",activeCoordinate:i}))}}}});var Hb=Or("externalEvent"),Gb=Un(),Kb=new Map;Gb.startListening({actionCreator:Hb,effect:(e,t)=>{var{handler:r,reactEvent:n}=e.payload;if(null!=r){n.persist();var i=n.type,o=Kb.get(i);void 0!==o&&cancelAnimationFrame(o);var a=requestAnimationFrame(()=>{try{var e=t.getState(),o={activeCoordinate:Aw(e),activeDataKey:cw(e),activeIndex:sw(e),activeLabel:lw(e),activeTooltipIndex:sw(e),isTooltipActive:fw(e)};r(o,n)}finally{Kb.delete(i)}});Kb.set(i,a)}}});var Wb=yd([yx],e=>e.tooltipItemPayloads),qb=yd([Wb,gx,(e,t)=>t,(e,t,r)=>r],(e,t,r,n)=>{var i=e.find(e=>e.settings.graphicalItemId===n);if(null!=i){var{positions:o}=i;if(null!=o)return t(o,r)}}),Zb=Or("touchMove"),Xb=Un();Xb.startListening({actionCreator:Zb,effect:(e,t)=>{var r=e.payload;if(null!=r.touches&&0!==r.touches.length){var n=t.getState(),i=sx(n,n.tooltip.settings.shared);if("axis"===i){var o=r.touches[0];if(null==o)return;var a=Mw(n,Ow({clientX:o.clientX,clientY:o.clientY,currentTarget:r.currentTarget}));null!=(null===a||void 0===a?void 0:a.activeIndex)&&t.dispatch(Zu({activeIndex:a.activeIndex,activeDataKey:void 0,activeCoordinate:a.activeCoordinate}))}else if("item"===i){var s,l=r.touches[0];if(null==document.elementFromPoint||null==l)return;var c=document.elementFromPoint(l.clientX,l.clientY);if(!c||!c.getAttribute)return;var u=c.getAttribute(lh),d=null!==(s=c.getAttribute(ch))&&void 0!==s?s:void 0,h=Ex(n).find(e=>e.id===d);if(null==u||null==h||null==d)return;var{dataKey:A}=h,f=qb(n,u,d);t.dispatch(Gu({activeDataKey:A,activeIndex:u,activeCoordinate:f,activeGraphicalItemId:d}))}}}});var Yb=on({name:"errorBars",initialState:{},reducers:{addErrorBar:(e,t)=>{var{itemId:r,errorBar:n}=t.payload;e[r]||(e[r]=[]),e[r].push(n)},replaceErrorBar:(e,t)=>{var{itemId:r,prev:n,next:i}=t.payload;e[r]&&(e[r]=e[r].map(e=>e.dataKey===n.dataKey&&e.direction===n.direction?i:e))},removeErrorBar:(e,t)=>{var{itemId:r,errorBar:n}=t.payload;e[r]&&(e[r]=e[r].filter(e=>e.dataKey!==n.dataKey||e.direction!==n.direction))}}}),{addErrorBar:Jb,replaceErrorBar:$b,removeErrorBar:eB}=Yb.actions,tB=Yb.reducer,rB=!0,nB=!("undefined"!==typeof window&&window.document&&Boolean(window.document.createElement)&&window.setTimeout);function iB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function oB(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?iB(Object(r),!0).forEach(function(t){aB(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):iB(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function aB(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var sB={zIndexMap:Object.values(Ey).reduce((e,t)=>oB(oB({},e),{},{[t]:{element:void 0,panoramaElement:void 0,consumers:0}}),{})},lB=new Set(Object.values(Ey));var cB=on({name:"zIndex",initialState:sB,reducers:{registerZIndexPortal:{reducer:(e,t)=>{var{zIndex:r}=t.payload;e.zIndexMap[r]?e.zIndexMap[r].consumers+=1:e.zIndexMap[r]={consumers:1,element:void 0,panoramaElement:void 0}},prepare:zr()},unregisterZIndexPortal:{reducer:(e,t)=>{var{zIndex:r}=t.payload;e.zIndexMap[r]&&(e.zIndexMap[r].consumers-=1,e.zIndexMap[r].consumers<=0&&!function(e){return lB.has(e)}(r)&&delete e.zIndexMap[r])},prepare:zr()},registerZIndexPortalElement:{reducer:(e,t)=>{var{zIndex:r,element:n,isPanorama:i}=t.payload;e.zIndexMap[r]?i?e.zIndexMap[r].panoramaElement=n:e.zIndexMap[r].element=n:e.zIndexMap[r]={consumers:0,element:i?void 0:n,panoramaElement:i?n:void 0}},prepare:zr()},unregisterZIndexPortalElement:{reducer:(e,t)=>{var{zIndex:r}=t.payload;e.zIndexMap[r]&&(t.payload.isPanorama?e.zIndexMap[r].panoramaElement=void 0:e.zIndexMap[r].element=void 0)},prepare:zr()}}}),{registerZIndexPortal:uB,unregisterZIndexPortal:dB,registerZIndexPortalElement:hB,unregisterZIndexPortalElement:AB}=cB.actions,fB=Cr({brush:vb,cartesianAxis:tb,chartData:id,errorBars:tB,graphicalItems:lb,layout:ud,legend:Sb,options:qc,polarAxis:Ub,polarOptions:Nb,referenceElements:mb,rootProps:Fb,tooltip:$u,zIndex:cB.reducer});function pB(e){var{preloadedState:t,children:r,reduxStoreName:i}=e,o=gh(),a=(0,n.useRef)(null);if(o)return r;null==a.current&&(a.current=function(e){return Qr({reducer:fB,preloadedState:e,middleware:e=>e({serializableCheck:!1,immutableCheck:!["commonjs","es6","production"].includes("es6")}).concat([Dw.middleware,Rw.middleware,Vb.middleware,Gb.middleware,Xb.middleware]),enhancers:e=>{var t=e;return"function"===typeof e&&(t=e()),t.concat(jr({type:"raf"}))},devTools:rB&&{serialize:{replacer:Nw},name:"recharts-".concat(arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Chart")}})}(t,i));var s=xd;return n.createElement(_,{context:s,store:a.current},r)}var mB=e=>{var{chartData:t}=e,r=bd(),i=gh();return(0,n.useEffect)(()=>i?()=>{}:(r(td(t)),()=>{r(td(void 0))}),[t,r,i]),null},gB=new Set(["axisLine","tickLine","activeBar","activeDot","activeLabel","activeShape","allowEscapeViewBox","background","cursor","dot","label","line","margin","padding","position","shape","style","tick","wrapperStyle","radius"]);function yB(e,t){return null==e&&null==t||("number"===typeof e&&"number"===typeof t?e===t||e!==e&&t!==t:e===t)}function _B(e,t){var r=new Set([...Object.keys(e),...Object.keys(t)]);for(var n of r)if(gB.has(n)){if(null==e[n]&&null==t[n])continue;if(!f(e[n],t[n]))return!1}else if(!yB(e[n],t[n]))return!1;return!0}function vB(e){var{layout:t,margin:r}=e,i=bd(),o=gh();return(0,n.useEffect)(()=>{o||(i(sd(t)),i(ad(r)))},[i,o,t,r]),null}var xB=(0,n.memo)(vB,_B);function wB(e){var t=bd();return(0,n.useEffect)(()=>{t(kb(e))},[t,e]),null}function bB(e){var t=bd();return(0,n.useEffect)(()=>{t(zb(e))},[t,e]),null}var BB=()=>{var e;return null===(e=Sd(e=>e.rootProps.accessibilityLayer))||void 0===e||e},CB=["dangerouslySetInnerHTML","onCopy","onCopyCapture","onCut","onCutCapture","onPaste","onPasteCapture","onCompositionEnd","onCompositionEndCapture","onCompositionStart","onCompositionStartCapture","onCompositionUpdate","onCompositionUpdateCapture","onFocus","onFocusCapture","onBlur","onBlurCapture","onChange","onChangeCapture","onBeforeInput","onBeforeInputCapture","onInput","onInputCapture","onReset","onResetCapture","onSubmit","onSubmitCapture","onInvalid","onInvalidCapture","onLoad","onLoadCapture","onError","onErrorCapture","onKeyDown","onKeyDownCapture","onKeyPress","onKeyPressCapture","onKeyUp","onKeyUpCapture","onAbort","onAbortCapture","onCanPlay","onCanPlayCapture","onCanPlayThrough","onCanPlayThroughCapture","onDurationChange","onDurationChangeCapture","onEmptied","onEmptiedCapture","onEncrypted","onEncryptedCapture","onEnded","onEndedCapture","onLoadedData","onLoadedDataCapture","onLoadedMetadata","onLoadedMetadataCapture","onLoadStart","onLoadStartCapture","onPause","onPauseCapture","onPlay","onPlayCapture","onPlaying","onPlayingCapture","onProgress","onProgressCapture","onRateChange","onRateChangeCapture","onSeeked","onSeekedCapture","onSeeking","onSeekingCapture","onStalled","onStalledCapture","onSuspend","onSuspendCapture","onTimeUpdate","onTimeUpdateCapture","onVolumeChange","onVolumeChangeCapture","onWaiting","onWaitingCapture","onAuxClick","onAuxClickCapture","onClick","onClickCapture","onContextMenu","onContextMenuCapture","onDoubleClick","onDoubleClickCapture","onDrag","onDragCapture","onDragEnd","onDragEndCapture","onDragEnter","onDragEnterCapture","onDragExit","onDragExitCapture","onDragLeave","onDragLeaveCapture","onDragOver","onDragOverCapture","onDragStart","onDragStartCapture","onDrop","onDropCapture","onMouseDown","onMouseDownCapture","onMouseEnter","onMouseLeave","onMouseMove","onMouseMoveCapture","onMouseOut","onMouseOutCapture","onMouseOver","onMouseOverCapture","onMouseUp","onMouseUpCapture","onSelect","onSelectCapture","onTouchCancel","onTouchCancelCapture","onTouchEnd","onTouchEndCapture","onTouchMove","onTouchMoveCapture","onTouchStart","onTouchStartCapture","onPointerDown","onPointerDownCapture","onPointerMove","onPointerMoveCapture","onPointerUp","onPointerUpCapture","onPointerCancel","onPointerCancelCapture","onPointerEnter","onPointerEnterCapture","onPointerLeave","onPointerLeaveCapture","onPointerOver","onPointerOverCapture","onPointerOut","onPointerOutCapture","onGotPointerCapture","onGotPointerCaptureCapture","onLostPointerCapture","onLostPointerCaptureCapture","onScroll","onScrollCapture","onWheel","onWheelCapture","onAnimationStart","onAnimationStartCapture","onAnimationEnd","onAnimationEndCapture","onAnimationIteration","onAnimationIterationCapture","onTransitionEnd","onTransitionEndCapture"];function EB(e){return"string"===typeof e&&CB.includes(e)}var SB=new Set(["aria-activedescendant","aria-atomic","aria-autocomplete","aria-busy","aria-checked","aria-colcount","aria-colindex","aria-colspan","aria-controls","aria-current","aria-describedby","aria-details","aria-disabled","aria-errormessage","aria-expanded","aria-flowto","aria-haspopup","aria-hidden","aria-invalid","aria-keyshortcuts","aria-label","aria-labelledby","aria-level","aria-live","aria-modal","aria-multiline","aria-multiselectable","aria-orientation","aria-owns","aria-placeholder","aria-posinset","aria-pressed","aria-readonly","aria-relevant","aria-required","aria-roledescription","aria-rowcount","aria-rowindex","aria-rowspan","aria-selected","aria-setsize","aria-sort","aria-valuemax","aria-valuemin","aria-valuenow","aria-valuetext","className","color","height","id","lang","max","media","method","min","name","style","target","width","role","tabIndex","accentHeight","accumulate","additive","alignmentBaseline","allowReorder","alphabetic","amplitude","arabicForm","ascent","attributeName","attributeType","autoReverse","azimuth","baseFrequency","baselineShift","baseProfile","bbox","begin","bias","by","calcMode","capHeight","clip","clipPath","clipPathUnits","clipRule","colorInterpolation","colorInterpolationFilters","colorProfile","colorRendering","contentScriptType","contentStyleType","cursor","cx","cy","d","decelerate","descent","diffuseConstant","direction","display","divisor","dominantBaseline","dur","dx","dy","edgeMode","elevation","enableBackground","end","exponent","externalResourcesRequired","fill","fillOpacity","fillRule","filter","filterRes","filterUnits","floodColor","floodOpacity","focusable","fontFamily","fontSize","fontSizeAdjust","fontStretch","fontStyle","fontVariant","fontWeight","format","from","fx","fy","g1","g2","glyphName","glyphOrientationHorizontal","glyphOrientationVertical","glyphRef","gradientTransform","gradientUnits","hanging","horizAdvX","horizOriginX","href","ideographic","imageRendering","in2","in","intercept","k1","k2","k3","k4","k","kernelMatrix","kernelUnitLength","kerning","keyPoints","keySplines","keyTimes","lengthAdjust","letterSpacing","lightingColor","limitingConeAngle","local","markerEnd","markerHeight","markerMid","markerStart","markerUnits","markerWidth","mask","maskContentUnits","maskUnits","mathematical","mode","numOctaves","offset","opacity","operator","order","orient","orientation","origin","overflow","overlinePosition","overlineThickness","paintOrder","panose1","pathLength","patternContentUnits","patternTransform","patternUnits","pointerEvents","pointsAtX","pointsAtY","pointsAtZ","preserveAlpha","preserveAspectRatio","primitiveUnits","r","radius","refX","refY","renderingIntent","repeatCount","repeatDur","requiredExtensions","requiredFeatures","restart","result","rotate","rx","ry","seed","shapeRendering","slope","spacing","specularConstant","specularExponent","speed","spreadMethod","startOffset","stdDeviation","stemh","stemv","stitchTiles","stopColor","stopOpacity","strikethroughPosition","strikethroughThickness","string","stroke","strokeDasharray","strokeDashoffset","strokeLinecap","strokeLinejoin","strokeMiterlimit","strokeOpacity","strokeWidth","surfaceScale","systemLanguage","tableValues","targetX","targetY","textAnchor","textDecoration","textLength","textRendering","to","transform","u1","u2","underlinePosition","underlineThickness","unicode","unicodeBidi","unicodeRange","unitsPerEm","vAlphabetic","values","vectorEffect","version","vertAdvY","vertOriginX","vertOriginY","vHanging","vIdeographic","viewTarget","visibility","vMathematical","widths","wordSpacing","writingMode","x1","x2","x","xChannelSelector","xHeight","xlinkActuate","xlinkArcrole","xlinkHref","xlinkRole","xlinkShow","xlinkTitle","xlinkType","xmlBase","xmlLang","xmlns","xmlnsXlink","xmlSpace","y1","y2","y","yChannelSelector","z","zoomAndPan","ref","key","angle"]);function TB(e){return"string"===typeof e&&SB.has(e)}function IB(e){return"string"===typeof e&&e.startsWith("data-")}function FB(e){if("object"!==typeof e||null===e)return{};var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(TB(r)||IB(r))&&(t[r]=e[r]);return t}function kB(e){return null==e?null:(0,n.isValidElement)(e)&&"object"===typeof e.props&&null!==e.props?FB(e.props):"object"!==typeof e||Array.isArray(e)?null:FB(e)}function PB(e){var t={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(TB(r)||IB(r)||EB(r))&&(t[r]=e[r]);return t}var MB=["children","width","height","viewBox","className","style","title","desc"];function OB(){return OB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},OB.apply(null,arguments)}var LB=(0,n.forwardRef)((e,t)=>{var{children:r,width:i,height:o,viewBox:a,className:s,style:l,title:c,desc:u}=e,d=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,MB),h=a||{width:i,height:o,x:0,y:0},A=sc("recharts-surface",s);return n.createElement("svg",OB({},PB(d),{className:A,width:i,height:o,style:l,viewBox:"".concat(h.x," ").concat(h.y," ").concat(h.width," ").concat(h.height),ref:t}),n.createElement("title",null,c),n.createElement("desc",null,u),r)}),DB=yd(e=>e.zIndex.zIndexMap,(e,t)=>t,(e,t,r)=>r,(e,t,r)=>{if(null!=t){var n=e[t];if(null!=n)return r?n.panoramaElement:n.element}}),UB=yd(e=>e.zIndex.zIndexMap,e=>{var t=Object.keys(e).map(e=>parseInt(e,10)).concat(Object.values(Ey));return Array.from(new Set(t)).sort((e,t)=>e-t)},{memoizeOptions:{resultEqualityCheck:function(e,t){if(e.length===t.length){for(var r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}return!1}}});function RB(e){var{zIndex:t,isPanorama:r}=e,i=(0,n.useRef)(null),o=bd();return(0,n.useLayoutEffect)(()=>(i.current&&o(hB({zIndex:t,element:i.current,isPanorama:r})),()=>{o(AB({zIndex:t,isPanorama:r}))}),[o,t,r]),n.createElement("g",{tabIndex:-1,ref:i})}function zB(e){var{children:t,isPanorama:r}=e,i=Sd(UB);if(!i||0===i.length)return t;var o=i.filter(e=>e<0),a=i.filter(e=>e>0);return n.createElement(n.Fragment,null,o.map(e=>n.createElement(RB,{key:e,zIndex:e,isPanorama:r})),t,a.map(e=>n.createElement(RB,{key:e,zIndex:e,isPanorama:r})))}var NB=["children"];function jB(){return jB=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jB.apply(null,arguments)}var QB={width:"100%",height:"100%",display:"block"},VB=(0,n.forwardRef)((e,t)=>{var r=Bh(),i=Ch(),o=BB();if(!Dc(r)||!Dc(i))return null;var a,s,{children:l,otherAttributes:c,title:u,desc:d}=e;return null!=c&&(a="number"===typeof c.tabIndex?c.tabIndex:o?0:void 0,s="string"===typeof c.role?c.role:o?"application":void 0),n.createElement(LB,jB({},c,{title:u,desc:d,role:s,tabIndex:a,width:r,height:i,style:QB,ref:t}),l)}),HB=e=>{var{children:t}=e,r=Sd(_h);if(!r)return null;var{width:i,height:o,y:a,x:s}=r;return n.createElement(LB,{width:i,height:o,x:s,y:a},t)},GB=(0,n.forwardRef)((e,t)=>{var{children:r}=e,i=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,NB);return gh()?n.createElement(HB,null,n.createElement(zB,{isPanorama:!0},r)):n.createElement(VB,jB({ref:t},i),n.createElement(zB,{isPanorama:!1},r))});var KB=new(r(8499)),WB="recharts.syncEvent.tooltip",qB="recharts.syncEvent.brush";function ZB(e){return e.tooltip.syncInteraction}var XB=["x","y"];function YB(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function JB(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?YB(Object(r),!0).forEach(function(t){$B(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YB(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function $B(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eC(){var e=Sd(Ay),t=Sd(py),r=bd(),i=Sd(fy),o=Sd(rw),a=Sh(),s=xh(),l=Sd(e=>e.rootProps.className);(0,n.useEffect)(()=>{if(null==e)return Sc;var n=(n,l,c)=>{var u;if(t!==c&&e===n)if("index"!==i){if(null!=o){var d;if("function"===typeof i){var h={activeTooltipIndex:null==l.payload.index?void 0:Number(l.payload.index),isTooltipActive:l.payload.active,activeIndex:null==l.payload.index?void 0:Number(l.payload.index),activeLabel:l.payload.label,activeDataKey:l.payload.dataKey,activeCoordinate:l.payload.coordinate},A=i(o,h);d=o[A]}else"value"===i&&(d=o.find(e=>String(e.value)===l.payload.label));var{coordinate:f}=l.payload;if(null!=d&&!1!==l.payload.active&&null!=f&&null!=s){var{x:p,y:m}=f,g=Math.min(p,s.x+s.width),y=Math.min(m,s.y+s.height),_={x:"horizontal"===a?d.coordinate:g,y:"horizontal"===a?y:d.coordinate},v=Yu({active:l.payload.active,coordinate:_,dataKey:l.payload.dataKey,index:String(d.index),label:l.payload.label,sourceViewBox:l.payload.sourceViewBox,graphicalItemId:l.payload.graphicalItemId});r(v)}else r(Yu({active:!1,coordinate:void 0,dataKey:void 0,index:null,label:void 0,sourceViewBox:void 0,graphicalItemId:void 0}))}}else if(s&&null!==l&&void 0!==l&&null!==(u=l.payload)&&void 0!==u&&u.coordinate&&l.payload.sourceViewBox){var x=l.payload.coordinate,{x:w,y:b}=x,B=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(x,XB),{x:C,y:E,width:S,height:T}=l.payload.sourceViewBox,I=JB(JB({},B),{},{x:s.x+(S?(w-C)/S:0)*s.width,y:s.y+(T?(b-E)/T:0)*s.height});r(JB(JB({},l),{},{payload:JB(JB({},l.payload),{},{coordinate:I})}))}else r(l)};return KB.on(WB,n),()=>{KB.off(WB,n)}},[l,r,t,e,i,o,a,s])}function tC(){var e=bd();(0,n.useEffect)(()=>{e(Zc())},[e]),eC(),function(){var e=Sd(Ay),t=Sd(py),r=bd();(0,n.useEffect)(()=>{if(null==e)return Sc;var n=(n,i,o)=>{t!==o&&e===n&&r(rd(i))};return KB.on(qB,n),()=>{KB.off(qB,n)}},[r,t,e])}()}function rC(e,t,r,i,o,a){var s=Sd(r=>((e,t,r)=>{if(null!=t){var n=yx(e);return"axis"===t?"hover"===r?n.axisInteraction.hover.dataKey:n.axisInteraction.click.dataKey:"hover"===r?n.itemInteraction.hover.dataKey:n.itemInteraction.click.dataKey}})(r,e,t)),l=Sd(py),c=Sd(Ay),u=Sd(fy),d=Sd(ZB),h=null===d||void 0===d?void 0:d.active,A=xh();(0,n.useEffect)(()=>{if(!h&&null!=c&&null!=l){var e=Yu({active:a,coordinate:r,dataKey:s,index:o,label:"number"===typeof i?String(i):i,sourceViewBox:A,graphicalItemId:void 0});KB.emit(WB,c,e,l)}},[h,r,s,o,i,l,c,u,a,A])}var nC=(0,n.createContext)(null),iC=(0,n.createContext)(null);function oC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function aC(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?oC(Object(r),!0).forEach(function(t){sC(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):oC(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function sC(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function lC(){return lC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lC.apply(null,arguments)}var cC=()=>(tC(),null);function uC(e){if("number"===typeof e)return e;if("string"===typeof e){var t=parseFloat(e);if(!Number.isNaN(t))return t}return 0}var dC=(0,n.forwardRef)((e,t)=>{var r,i,o=(0,n.useRef)(null),[a,s]=(0,n.useState)({containerWidth:uC(null===(r=e.style)||void 0===r?void 0:r.width),containerHeight:uC(null===(i=e.style)||void 0===i?void 0:i.height)}),l=(0,n.useCallback)((e,t)=>{s(r=>{var n=Math.round(e),i=Math.round(t);return r.containerWidth===n&&r.containerHeight===i?r:{containerWidth:n,containerHeight:i}})},[]),c=(0,n.useCallback)(e=>{if("function"===typeof t&&t(e),null!=e&&"undefined"!==typeof ResizeObserver){var{width:r,height:n}=e.getBoundingClientRect();l(r,n);var i=new ResizeObserver(e=>{var{width:t,height:r}=e[0].contentRect;l(t,r)});i.observe(e),o.current=i}},[t,l]);return(0,n.useEffect)(()=>()=>{var e=o.current;null!=e&&e.disconnect()},[l]),n.createElement(n.Fragment,null,n.createElement(Th,{width:a.containerWidth,height:a.containerHeight}),n.createElement("div",lC({ref:c},e)))}),hC=(0,n.forwardRef)((e,t)=>{var{width:r,height:i}=e,[o,a]=(0,n.useState)({containerWidth:uC(r),containerHeight:uC(i)}),s=(0,n.useCallback)((e,t)=>{a(r=>{var n=Math.round(e),i=Math.round(t);return r.containerWidth===n&&r.containerHeight===i?r:{containerWidth:n,containerHeight:i}})},[]),l=(0,n.useCallback)(e=>{if("function"===typeof t&&t(e),null!=e){var{width:r,height:n}=e.getBoundingClientRect();s(r,n)}},[t,s]);return n.createElement(n.Fragment,null,n.createElement(Th,{width:o.containerWidth,height:o.containerHeight}),n.createElement("div",lC({ref:l},e)))}),AC=(0,n.forwardRef)((e,t)=>{var{width:r,height:i}=e;return n.createElement(n.Fragment,null,n.createElement(Th,{width:r,height:i}),n.createElement("div",lC({ref:t},e)))}),fC=(0,n.forwardRef)((e,t)=>{var{width:r,height:i}=e;return mc(r)||mc(i)?n.createElement(hC,lC({},e,{ref:t})):n.createElement(AC,lC({},e,{ref:t}))});var pC=(0,n.forwardRef)((e,t)=>{var{children:r,className:i,height:o,onClick:a,onContextMenu:s,onDoubleClick:l,onMouseDown:c,onMouseEnter:u,onMouseLeave:d,onMouseMove:h,onMouseUp:A,onTouchEnd:f,onTouchMove:p,onTouchStart:m,style:g,width:y,responsive:_,dispatchTouchEvents:v=!0}=e,x=(0,n.useRef)(null),w=bd(),[b,B]=(0,n.useState)(null),[C,E]=(0,n.useState)(null),S=function(){var e=bd(),[t,r]=(0,n.useState)(null),i=Sd(ih);return(0,n.useEffect)(()=>{if(null!=t){var r=t.getBoundingClientRect().width/t.offsetWidth;Lc(r)&&r!==i&&e(cd(r))}},[t,e,i]),r}(),T=Vc(),I=(null===T||void 0===T?void 0:T.width)>0?T.width:y,F=(null===T||void 0===T?void 0:T.height)>0?T.height:o,k=(0,n.useCallback)(e=>{S(e),"function"===typeof t&&t(e),B(e),E(e),null!=e&&(x.current=e)},[S,t,B,E]),P=(0,n.useCallback)(e=>{w(Lw(e)),w(Hb({handler:a,reactEvent:e}))},[w,a]),M=(0,n.useCallback)(e=>{w(Uw(e)),w(Hb({handler:u,reactEvent:e}))},[w,u]),O=(0,n.useCallback)(e=>{w(Wu()),w(Hb({handler:d,reactEvent:e}))},[w,d]),L=(0,n.useCallback)(e=>{w(Uw(e)),w(Hb({handler:h,reactEvent:e}))},[w,h]),D=(0,n.useCallback)(()=>{w(Qb())},[w]),U=(0,n.useCallback)(e=>{w(jb(e.key))},[w]),R=(0,n.useCallback)(e=>{w(Hb({handler:s,reactEvent:e}))},[w,s]),z=(0,n.useCallback)(e=>{w(Hb({handler:l,reactEvent:e}))},[w,l]),N=(0,n.useCallback)(e=>{w(Hb({handler:c,reactEvent:e}))},[w,c]),j=(0,n.useCallback)(e=>{w(Hb({handler:A,reactEvent:e}))},[w,A]),Q=(0,n.useCallback)(e=>{w(Hb({handler:m,reactEvent:e}))},[w,m]),V=(0,n.useCallback)(e=>{v&&w(Zb(e)),w(Hb({handler:p,reactEvent:e}))},[w,v,p]),H=(0,n.useCallback)(e=>{w(Hb({handler:f,reactEvent:e}))},[w,f]),G=function(e){return!0===e?dC:fC}(_);return n.createElement(nC.Provider,{value:b},n.createElement(iC.Provider,{value:C},n.createElement(G,{width:null!==I&&void 0!==I?I:null===g||void 0===g?void 0:g.width,height:null!==F&&void 0!==F?F:null===g||void 0===g?void 0:g.height,className:sc("recharts-wrapper",i),style:aC({position:"relative",cursor:"default",width:I,height:F},g),onClick:P,onContextMenu:R,onDoubleClick:z,onFocus:D,onKeyDown:U,onMouseDown:N,onMouseEnter:M,onMouseLeave:O,onMouseMove:L,onMouseUp:j,onTouchEnd:H,onTouchMove:V,onTouchStart:Q,ref:k},n.createElement(cC,null),r)))}),mC=yd([Ah],e=>({top:e.top,bottom:e.bottom,left:e.left,right:e.right})),gC=yd([mC,rh,nh],(e,t,r)=>{if(e&&null!=t&&null!=r)return{x:e.left,y:e.top,width:Math.max(0,t-e.left-e.right),height:Math.max(0,r-e.top-e.bottom)}}),yC=()=>Sd(gC),_C=(0,n.createContext)(void 0),vC=e=>{var{children:t}=e,[r]=(0,n.useState)("".concat(vc("recharts"),"-clip")),i=yC();if(null==i)return null;var{x:o,y:a,width:s,height:l}=i;return n.createElement(_C.Provider,{value:r},n.createElement("defs",null,n.createElement("clipPath",{id:r},n.createElement("rect",{x:o,y:a,height:l,width:s}))),t)},xC=["width","height","responsive","children","className","style","compact","title","desc"];var wC=(0,n.forwardRef)((e,t)=>{var{width:r,height:i,responsive:o,children:a,className:s,style:l,compact:c,title:u,desc:d}=e,h=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,xC),A=FB(h);return c?n.createElement(n.Fragment,null,n.createElement(Th,{width:r,height:i}),n.createElement(GB,{otherAttributes:A,title:u,desc:d},a)):n.createElement(pC,{className:s,style:l,width:r,height:i,responsive:null!==o&&void 0!==o&&o,onClick:e.onClick,onMouseLeave:e.onMouseLeave,onMouseEnter:e.onMouseEnter,onMouseMove:e.onMouseMove,onMouseDown:e.onMouseDown,onMouseUp:e.onMouseUp,onContextMenu:e.onContextMenu,onDoubleClick:e.onDoubleClick,onTouchStart:e.onTouchStart,onTouchMove:e.onTouchMove,onTouchEnd:e.onTouchEnd},n.createElement(GB,{otherAttributes:A,title:u,desc:d,ref:t},n.createElement(vC,null,a)))});function bC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function BC(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function CC(e,t){var r=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bC(Object(r),!0).forEach(function(t){BC(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bC(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},e),n=t;return Object.keys(t).reduce((e,t)=>(void 0===e[t]&&void 0!==n[t]&&(e[t]=n[t]),e),r)}var EC=["layout"];function SC(){return SC=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},SC.apply(null,arguments)}var TC={accessibilityLayer:!0,stackOffset:"none",barCategoryGap:"10%",barGap:4,margin:{top:5,right:5,bottom:5,left:5},reverseStackOrder:!1,syncMethod:"index",layout:"radial",responsive:!1,cx:"50%",cy:"50%",innerRadius:0,outerRadius:"80%"},IC=(0,n.forwardRef)(function(e,t){var r,i=CC(e.categoricalChartProps,TC),{layout:o}=i,a=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(i,EC),{chartName:s,defaultTooltipEventType:l,validateTooltipEventTypes:c,tooltipPayloadSearcher:u}=e,d={chartName:s,defaultTooltipEventType:l,validateTooltipEventTypes:c,tooltipPayloadSearcher:u,eventEmitter:void 0};return n.createElement(pB,{preloadedState:{options:d},reduxStoreName:null!==(r=i.id)&&void 0!==r?r:s},n.createElement(mB,{chartData:i.data}),n.createElement(xB,{layout:o,margin:i.margin}),n.createElement(wB,{baseValue:void 0,accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className,reverseStackOrder:i.reverseStackOrder}),n.createElement(bB,{cx:i.cx,cy:i.cy,startAngle:i.startAngle,endAngle:i.endAngle,innerRadius:i.innerRadius,outerRadius:i.outerRadius}),n.createElement(wC,SC({},a,{ref:t})))});function FC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function kC(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?FC(Object(r),!0).forEach(function(t){PC(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):FC(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function PC(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var MC=["item"],OC=kC(kC({},TC),{},{layout:"centric",startAngle:0,endAngle:360}),LC=(0,n.forwardRef)((e,t)=>{var r=CC(e,OC);return n.createElement(IC,{chartName:"PieChart",defaultTooltipEventType:"item",validateTooltipEventTypes:MC,tooltipPayloadSearcher:Kc,categoricalChartProps:r,ref:t})}),DC=e=>e.graphicalItems.polarItems,UC=yd([Xy,Yy],v_),RC=yd([DC,g_,UC],b_),zC=yd([RC],T_),NC=yd([zC,jg],F_),jC=yd([NC,g_,RC],P_),QC=(yd([NC,g_,RC],(e,t,r)=>r.length>0?e.flatMap(e=>r.flatMap(r=>{var n;return{value:Qd(e,null!==(n=t.dataKey)&&void 0!==n?n:r.dataKey),errorDomain:[]}})).filter(Boolean):null!=(null===t||void 0===t?void 0:t.dataKey)?e.map(e=>({value:Qd(e,t.dataKey),errorDomain:[]})):e.map(e=>({value:e,errorDomain:[]}))),()=>{}),VC=yd([NC,g_,RC,Z_,Xy],Y_),HC=yd([g_,K_,W_,QC,VC,QC,Eh,Xy],fv),GC=yd([g_,Eh,NC,jC,uy,Xy,HC],gv),KC=yd([GC,g_,vv],wv);yd([g_,GC,KC,Xy],Bv);function WC(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function qC(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?WC(Object(r),!0).forEach(function(t){ZC(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):WC(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ZC(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var XC=yd([DC,(e,t)=>t],(e,t)=>e.filter(e=>"pie"===e.type).find(e=>e.id===t)),YC=[],JC=(e,t,r)=>0===(null===r||void 0===r?void 0:r.length)?YC:r,$C=yd([jg,XC,JC],(e,t,r)=>{var n,{chartData:i}=e;if(null!=t&&((n=null!=(null===t||void 0===t?void 0:t.data)&&t.data.length>0?t.data:i)&&n.length||null==r||(n=r.map(e=>qC(qC({},t.presentationProps),e.props))),null!=n))return n}),eE=yd([$C,XC,JC],(e,t,r)=>{if(null!=e&&null!=t)return e.map((e,n)=>{var i,o,a=Qd(e,t.nameKey,t.name);return o=null!==r&&void 0!==r&&null!==(i=r[n])&&void 0!==i&&null!==(i=i.props)&&void 0!==i&&i.fill?r[n].props.fill:"object"===typeof e&&null!=e&&"fill"in e?e.fill:t.fill,{value:th(a,t.dataKey),color:o,payload:e,type:t.legendType}})}),tE=yd([$C,XC,JC,Ah],(e,t,r,n)=>{if(null!=t&&null!=e)return function(e){var t,r,n,{pieSettings:i,displayedData:o,cells:a,offset:s}=e,{cornerRadius:l,startAngle:c,endAngle:u,dataKey:d,nameKey:h,tooltipType:A}=i,f=Math.abs(i.minAngle),p=ck(c,u),m=Math.abs(p),g=o.length<=1?0:null!==(t=i.paddingAngle)&&void 0!==t?t:0,y=o.filter(e=>0!==Qd(e,d,0)).length,_=m-y*f-(m>=360?y:y-1)*g,v=o.reduce((e,t)=>{var r=Qd(t,d,0);return e+(gc(r)?r:0)},0);v>0&&(r=o.map((e,t)=>{var r,o=Qd(e,d,0),u=Qd(e,h,t),m=lk(i,s,e),y=(gc(o)?o:0)/v,x=rk(rk({},e),a&&a[t]&&a[t].props),w=(r=t?n.endAngle+fc(p)*g*(0!==o?1:0):c)+fc(p)*((0!==o?f:0)+y*_),b=(r+w)/2,B=(m.innerRadius+m.outerRadius)/2,C=[{name:u,value:o,payload:x,dataKey:d,type:A,graphicalItemId:i.id}],E=xy(m.cx,m.cy,B,b);return n=rk(rk(rk(rk({},i.presentationProps),{},{percent:y,cornerRadius:"string"===typeof l?parseFloat(l):l,name:u,tooltipPayload:C,midAngle:b,middleRadius:B,tooltipPosition:E},x),m),{},{value:o,dataKey:d,startAngle:r,endAngle:w,payload:x,paddingAngle:fc(p)*g})}));return r}({offset:n,pieSettings:t,displayedData:e,cells:r})}),rE=["children","className"];function nE(){return nE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},nE.apply(null,arguments)}var iE,oE,aE,sE,lE,cE,uE,dE,hE,AE,fE,pE,mE,gE,yE=n.forwardRef((e,t)=>{var{children:r,className:i}=e,o=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,rE),a=sc("recharts-layer",i);return n.createElement("g",nE({className:a},PB(o),{ref:t}),r)});function _E(){}function vE(e,t,r){e._context.bezierCurveTo((2*e._x0+e._x1)/3,(2*e._y0+e._y1)/3,(e._x0+2*e._x1)/3,(e._y0+2*e._y1)/3,(e._x0+4*e._x1+t)/6,(e._y0+4*e._y1+r)/6)}function xE(e){this._context=e}function wE(e){this._context=e}function bE(e){this._context=e}xE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){switch(this._point){case 3:vE(this,this._x1,this._y1);case 2:this._context.lineTo(this._x1,this._y1)}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,this._context.lineTo((5*this._x0+this._x1)/6,(5*this._y0+this._y1)/6);default:vE(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},wE.prototype={areaStart:_E,areaEnd:_E,lineStart:function(){this._x0=this._x1=this._x2=this._x3=this._x4=this._y0=this._y1=this._y2=this._y3=this._y4=NaN,this._point=0},lineEnd:function(){switch(this._point){case 1:this._context.moveTo(this._x2,this._y2),this._context.closePath();break;case 2:this._context.moveTo((this._x2+2*this._x3)/3,(this._y2+2*this._y3)/3),this._context.lineTo((this._x3+2*this._x2)/3,(this._y3+2*this._y2)/3),this._context.closePath();break;case 3:this.point(this._x2,this._y2),this.point(this._x3,this._y3),this.point(this._x4,this._y4)}},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._x2=e,this._y2=t;break;case 1:this._point=2,this._x3=e,this._y3=t;break;case 2:this._point=3,this._x4=e,this._y4=t,this._context.moveTo((this._x0+4*this._x1+e)/6,(this._y0+4*this._y1+t)/6);break;default:vE(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}},bE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=NaN,this._point=0},lineEnd:function(){(this._line||0!==this._line&&3===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1;break;case 1:this._point=2;break;case 2:this._point=3;var r=(this._x0+4*this._x1+e)/6,n=(this._y0+4*this._y1+t)/6;this._line?this._context.lineTo(r,n):this._context.moveTo(r,n);break;case 3:this._point=4;default:vE(this,e,t)}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t}};class BE{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t)}this._x0=e,this._y0=t}}function CE(e){this._context=e}function EE(e){this._context=e}function SE(e){return new EE(e)}function TE(e){return e<0?-1:1}function IE(e,t,r){var n=e._x1-e._x0,i=t-e._x1,o=(e._y1-e._y0)/(n||i<0&&-0),a=(r-e._y1)/(i||n<0&&-0),s=(o*i+a*n)/(n+i);return(TE(o)+TE(a))*Math.min(Math.abs(o),Math.abs(a),.5*Math.abs(s))||0}function FE(e,t){var r=e._x1-e._x0;return r?(3*(e._y1-e._y0)/r-t)/2:t}function kE(e,t,r){var n=e._x0,i=e._y0,o=e._x1,a=e._y1,s=(o-n)/3;e._context.bezierCurveTo(n+s,i+s*t,o-s,a-s*r,o,a)}function PE(e){this._context=e}function ME(e){this._context=new OE(e)}function OE(e){this._context=e}function LE(e){this._context=e}function DE(e){var t,r,n=e.length-1,i=new Array(n),o=new Array(n),a=new Array(n);for(i[0]=0,o[0]=2,a[0]=e[0]+2*e[1],t=1;t<n-1;++t)i[t]=1,o[t]=4,a[t]=4*e[t]+2*e[t+1];for(i[n-1]=2,o[n-1]=7,a[n-1]=8*e[n-1]+e[n],t=1;t<n;++t)r=i[t]/o[t-1],o[t]-=r,a[t]-=r*a[t-1];for(i[n-1]=a[n-1]/o[n-1],t=n-2;t>=0;--t)i[t]=(a[t]-i[t+1])/o[t];for(o[n-1]=(e[n]+i[n-1])/2,t=0;t<n-1;++t)o[t]=2*e[t+1]-i[t+1];return[i,o]}function UE(e,t){this._context=e,this._t=t}function RE(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}CE.prototype={areaStart:_E,areaEnd:_E,lineStart:function(){this._point=0},lineEnd:function(){this._point&&this._context.closePath()},point:function(e,t){e=+e,t=+t,this._point?this._context.lineTo(e,t):(this._point=1,this._context.moveTo(e,t))}},EE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._context.lineTo(e,t)}}},PE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x0=this._x1=this._y0=this._y1=this._t0=NaN,this._point=0},lineEnd:function(){switch(this._point){case 2:this._context.lineTo(this._x1,this._y1);break;case 3:kE(this,this._t0,FE(this,this._t0))}(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line=1-this._line},point:function(e,t){var r=NaN;if(t=+t,(e=+e)!==this._x1||t!==this._y1){switch(this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;break;case 2:this._point=3,kE(this,FE(this,r=IE(this,e,t)),r);break;default:kE(this,this._t0,r=IE(this,e,t))}this._x0=this._x1,this._x1=e,this._y0=this._y1,this._y1=t,this._t0=r}}},(ME.prototype=Object.create(PE.prototype)).point=function(e,t){PE.prototype.point.call(this,t,e)},OE.prototype={moveTo:function(e,t){this._context.moveTo(t,e)},closePath:function(){this._context.closePath()},lineTo:function(e,t){this._context.lineTo(t,e)},bezierCurveTo:function(e,t,r,n,i,o){this._context.bezierCurveTo(t,e,n,r,o,i)}},LE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=[],this._y=[]},lineEnd:function(){var e=this._x,t=this._y,r=e.length;if(r)if(this._line?this._context.lineTo(e[0],t[0]):this._context.moveTo(e[0],t[0]),2===r)this._context.lineTo(e[1],t[1]);else for(var n=DE(e),i=DE(t),o=0,a=1;a<r;++o,++a)this._context.bezierCurveTo(n[0][o],i[0][o],n[1][o],i[1][o],e[a],t[a]);(this._line||0!==this._line&&1===r)&&this._context.closePath(),this._line=1-this._line,this._x=this._y=null},point:function(e,t){this._x.push(+e),this._y.push(+t)}},UE.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._x=this._y=NaN,this._point=0},lineEnd:function(){0<this._t&&this._t<1&&2===this._point&&this._context.lineTo(this._x,this._y),(this._line||0!==this._line&&1===this._point)&&this._context.closePath(),this._line>=0&&(this._t=1-this._t,this._line=1-this._line)},point:function(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:if(this._t<=0)this._context.lineTo(this._x,t),this._context.lineTo(e,t);else{var r=this._x*(1-this._t)+e*this._t;this._context.lineTo(r,this._y),this._context.lineTo(r,t)}}this._x=e,this._y=t}};const zE=Math.PI,NE=2*zE,jE=1e-6,QE=NE-jE;function VE(e){this._+=e[0];for(let t=1,r=e.length;t<r;++t)this._+=arguments[t]+e[t]}class HE{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=null==e?VE:function(e){let t=Math.floor(e);if(!(t>=0))throw new Error("invalid digits: ".concat(e));if(t>15)return VE;const r=10**t;return function(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=Math.round(arguments[t]*r)/r+e[t]}}(e)}moveTo(e,t){this._append(iE||(iE=RE(["M",",",""])),this._x0=this._x1=+e,this._y0=this._y1=+t)}closePath(){null!==this._x1&&(this._x1=this._x0,this._y1=this._y0,this._append(oE||(oE=RE(["Z"]))))}lineTo(e,t){this._append(aE||(aE=RE(["L",",",""])),this._x1=+e,this._y1=+t)}quadraticCurveTo(e,t,r,n){this._append(sE||(sE=RE(["Q",",",",",",",""])),+e,+t,this._x1=+r,this._y1=+n)}bezierCurveTo(e,t,r,n,i,o){this._append(lE||(lE=RE(["C",",",",",",",",",",",""])),+e,+t,+r,+n,this._x1=+i,this._y1=+o)}arcTo(e,t,r,n,i){if(e=+e,t=+t,r=+r,n=+n,(i=+i)<0)throw new Error("negative radius: ".concat(i));let o=this._x1,a=this._y1,s=r-e,l=n-t,c=o-e,u=a-t,d=c*c+u*u;if(null===this._x1)this._append(cE||(cE=RE(["M",",",""])),this._x1=e,this._y1=t);else if(d>jE)if(Math.abs(u*s-l*c)>jE&&i){let h=r-o,A=n-a,f=s*s+l*l,p=h*h+A*A,m=Math.sqrt(f),g=Math.sqrt(d),y=i*Math.tan((zE-Math.acos((f+d-p)/(2*m*g)))/2),_=y/g,v=y/m;Math.abs(_-1)>jE&&this._append(dE||(dE=RE(["L",",",""])),e+_*c,t+_*u),this._append(hE||(hE=RE(["A",",",",0,0,",",",",",""])),i,i,+(u*h>c*A),this._x1=e+v*s,this._y1=t+v*l)}else this._append(uE||(uE=RE(["L",",",""])),this._x1=e,this._y1=t);else;}arc(e,t,r,n,i,o){if(e=+e,t=+t,o=!!o,(r=+r)<0)throw new Error("negative radius: ".concat(r));let a=r*Math.cos(n),s=r*Math.sin(n),l=e+a,c=t+s,u=1^o,d=o?n-i:i-n;null===this._x1?this._append(AE||(AE=RE(["M",",",""])),l,c):(Math.abs(this._x1-l)>jE||Math.abs(this._y1-c)>jE)&&this._append(fE||(fE=RE(["L",",",""])),l,c),r&&(d<0&&(d=d%NE+NE),d>QE?this._append(pE||(pE=RE(["A",",",",0,1,",",",",","A",",",",0,1,",",",",",""])),r,r,u,e-a,t-s,r,r,u,this._x1=l,this._y1=c):d>jE&&this._append(mE||(mE=RE(["A",",",",0,",",",",",",",""])),r,r,+(d>=zE),u,this._x1=e+r*Math.cos(i),this._y1=t+r*Math.sin(i)))}rect(e,t,r,n){this._append(gE||(gE=RE(["M",",","h","v","h","Z"])),this._x0=this._x1=+e,this._y0=this._y1=+t,r=+r,+n,-r)}toString(){return this._}}function GE(e){let t=3;return e.digits=function(r){if(!arguments.length)return t;if(null==r)t=null;else{const e=Math.floor(r);if(!(e>=0))throw new RangeError("invalid digits: ".concat(r));t=e}return e},()=>new HE(t)}function KE(e){return e[0]}function WE(e){return e[1]}function qE(e,t){var r=Od(!0),n=null,i=SE,o=null,a=GE(s);function s(s){var l,c,u,d=(s=Md(s)).length,h=!1;for(null==n&&(o=i(u=a())),l=0;l<=d;++l)!(l<d&&r(c=s[l],l,s))===h&&((h=!h)?o.lineStart():o.lineEnd()),h&&o.point(+e(c,l,s),+t(c,l,s));if(u)return o=null,u+""||null}return e="function"===typeof e?e:void 0===e?KE:Od(e),t="function"===typeof t?t:void 0===t?WE:Od(t),s.x=function(t){return arguments.length?(e="function"===typeof t?t:Od(+t),s):e},s.y=function(e){return arguments.length?(t="function"===typeof e?e:Od(+e),s):t},s.defined=function(e){return arguments.length?(r="function"===typeof e?e:Od(!!e),s):r},s.curve=function(e){return arguments.length?(i=e,null!=n&&(o=i(n)),s):i},s.context=function(e){return arguments.length?(null==e?n=o=null:o=i(n=e),s):n},s}function ZE(e,t,r){var n=null,i=Od(!0),o=null,a=SE,s=null,l=GE(c);function c(c){var u,d,h,A,f,p=(c=Md(c)).length,m=!1,g=new Array(p),y=new Array(p);for(null==o&&(s=a(f=l())),u=0;u<=p;++u){if(!(u<p&&i(A=c[u],u,c))===m)if(m=!m)d=u,s.areaStart(),s.lineStart();else{for(s.lineEnd(),s.lineStart(),h=u-1;h>=d;--h)s.point(g[h],y[h]);s.lineEnd(),s.areaEnd()}m&&(g[u]=+e(A,u,c),y[u]=+t(A,u,c),s.point(n?+n(A,u,c):g[u],r?+r(A,u,c):y[u]))}if(f)return s=null,f+""||null}function u(){return qE().defined(i).curve(a).context(o)}return e="function"===typeof e?e:void 0===e?KE:Od(+e),t="function"===typeof t?t:Od(void 0===t?0:+t),r="function"===typeof r?r:void 0===r?WE:Od(+r),c.x=function(t){return arguments.length?(e="function"===typeof t?t:Od(+t),n=null,c):e},c.x0=function(t){return arguments.length?(e="function"===typeof t?t:Od(+t),c):e},c.x1=function(e){return arguments.length?(n=null==e?null:"function"===typeof e?e:Od(+e),c):n},c.y=function(e){return arguments.length?(t="function"===typeof e?e:Od(+e),r=null,c):t},c.y0=function(e){return arguments.length?(t="function"===typeof e?e:Od(+e),c):t},c.y1=function(e){return arguments.length?(r=null==e?null:"function"===typeof e?e:Od(+e),c):r},c.lineX0=c.lineY0=function(){return u().x(e).y(t)},c.lineY1=function(){return u().x(e).y(r)},c.lineX1=function(){return u().x(n).y(t)},c.defined=function(e){return arguments.length?(i="function"===typeof e?e:Od(!!e),c):i},c.curve=function(e){return arguments.length?(a=e,null!=o&&(s=a(o)),c):a},c.context=function(e){return arguments.length?(null==e?o=s=null:s=a(o=e),c):o},c}var XE=e=>"radius"in e&&"startAngle"in e&&"endAngle"in e,YE=(e,t,r)=>{if(null===e||"object"!==typeof e&&"function"!==typeof e)return null;var n=null;return Object.keys(e).forEach(i=>{var o=e[i];EB(i)&&"function"===typeof o&&(n||(n={}),n[i]=((e,t,r)=>n=>(e(t,r,n),null))(o,t,r))}),n};function JE(){return JE=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},JE.apply(null,arguments)}function $E(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function eS(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?$E(Object(r),!0).forEach(function(t){tS(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):$E(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function tS(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var rS={curveBasisClosed:function(e){return new wE(e)},curveBasisOpen:function(e){return new bE(e)},curveBasis:function(e){return new xE(e)},curveBumpX:function(e){return new BE(e,!0)},curveBumpY:function(e){return new BE(e,!1)},curveLinearClosed:function(e){return new CE(e)},curveLinear:SE,curveMonotoneX:function(e){return new PE(e)},curveMonotoneY:function(e){return new ME(e)},curveNatural:function(e){return new LE(e)},curveStep:function(e){return new UE(e,.5)},curveStepAfter:function(e){return new UE(e,1)},curveStepBefore:function(e){return new UE(e,0)}},nS=e=>Lc(e.x)&&Lc(e.y),iS=e=>null!=e.base&&nS(e.base)&&nS(e),oS=e=>e.x,aS=e=>e.y,sS=e=>{var{type:t="linear",points:r=[],baseLine:n,layout:i,connectNulls:o=!1}=e,a=((e,t)=>{if("function"===typeof e)return e;var r="curve".concat(Cc(e));return"curveMonotone"!==r&&"curveBump"!==r||!t?rS[r]||SE:rS["".concat(r).concat("vertical"===t?"Y":"X")]})(t,i),s=o?r.filter(nS):r;if(Array.isArray(n)){var l=r.map((e,t)=>eS(eS({},e),{},{base:n[t]}));return("vertical"===i?ZE().y(aS).x1(oS).x0(e=>e.base.x):ZE().x(oS).y1(aS).y0(e=>e.base.y)).defined(iS).curve(a)(o?l.filter(iS):l)}return("vertical"===i&&gc(n)?ZE().y(aS).x1(oS).x0(n):gc(n)?ZE().x(oS).y1(aS).y0(n):qE().x(oS).y(aS)).defined(nS).curve(a)(s)},lS=e=>{var{className:t,points:r,path:i,pathRef:o}=e,a=Sh();if((!r||!r.length)&&!i)return null;var s={type:e.type,points:e.points,baseLine:e.baseLine,layout:e.layout||a,connectNulls:e.connectNulls},l=r&&r.length?sS(s):i;return n.createElement("path",JE({},FB(e),((e,t)=>{if(!e||"function"===typeof e||"boolean"===typeof e)return null;var r=e;if((0,n.isValidElement)(e)&&(r=e.props),"object"!==typeof r&&"function"!==typeof r)return null;var i={};return Object.keys(r).forEach(e=>{EB(e)&&(i[e]=t||(t=>r[e](r,t)))}),i})(e),{className:sc("recharts-curve",t),d:null===l?void 0:l,ref:o}))};function cS(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function uS(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function dS(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?uS(Object(r),!0).forEach(function(t){hS(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):uS(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function hS(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var AS=dS({},{cacheSize:2e3,enableCache:!0}),fS=new class{constructor(e){cS(this,"cache",new Map),this.maxSize=e}get(e){var t=this.cache.get(e);return void 0!==t&&(this.cache.delete(e),this.cache.set(e,t)),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){var r=this.cache.keys().next().value;null!=r&&this.cache.delete(r)}this.cache.set(e,t)}clear(){this.cache.clear()}size(){return this.cache.size}}(AS.cacheSize),pS={position:"absolute",top:"-20000px",left:0,padding:0,margin:0,border:"none",whiteSpace:"pre"},mS="recharts_measurement_span";var gS=(e,t)=>{try{var r=document.getElementById(mS);r||((r=document.createElement("span")).setAttribute("id",mS),r.setAttribute("aria-hidden","true"),document.body.appendChild(r)),Object.assign(r.style,pS,t),r.textContent="".concat(e);var n=r.getBoundingClientRect();return{width:n.width,height:n.height}}catch(i){return{width:0,height:0}}},yS=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e||null===e||nB)return{width:0,height:0};if(!AS.enableCache)return gS(e,t);var r=function(e,t){var r=t.fontSize||"",n=t.fontFamily||"",i=t.fontWeight||"",o=t.fontStyle||"",a=t.letterSpacing||"",s=t.textTransform||"";return"".concat(e,"|").concat(r,"|").concat(n,"|").concat(i,"|").concat(o,"|").concat(a,"|").concat(s)}(e,t),n=fS.get(r);if(n)return n;var i=gS(e,t);return fS.set(r,i),i};var _S=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([*/])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,vS=/(-?\d+(?:\.\d+)?[a-zA-Z%]*)([+-])(-?\d+(?:\.\d+)?[a-zA-Z%]*)/,xS=/^px|cm|vh|vw|em|rem|%|mm|in|pt|pc|ex|ch|vmin|vmax|Q$/,wS=/(-?\d+(?:\.\d+)?)([a-zA-Z%]+)?/,bS={cm:96/2.54,mm:96/25.4,pt:96/72,pc:16,in:96,Q:96/101.6,px:1},BS=["cm","mm","pt","pc","in","Q","px"];var CS="NaN";class ES{static parse(e){var t,[,r,n]=null!==(t=wS.exec(e))&&void 0!==t?t:[];return null==r?ES.NaN:new ES(parseFloat(r),null!==n&&void 0!==n?n:"")}constructor(e,t){this.num=e,this.unit=t,this.num=e,this.unit=t,pc(e)&&(this.unit=""),""===t||xS.test(t)||(this.num=NaN,this.unit=""),function(e){return BS.includes(e)}(t)&&(this.num=function(e,t){return e*bS[t]}(e,t),this.unit="px")}add(e){return this.unit!==e.unit?new ES(NaN,""):new ES(this.num+e.num,this.unit)}subtract(e){return this.unit!==e.unit?new ES(NaN,""):new ES(this.num-e.num,this.unit)}multiply(e){return""!==this.unit&&""!==e.unit&&this.unit!==e.unit?new ES(NaN,""):new ES(this.num*e.num,this.unit||e.unit)}divide(e){return""!==this.unit&&""!==e.unit&&this.unit!==e.unit?new ES(NaN,""):new ES(this.num/e.num,this.unit||e.unit)}toString(){return"".concat(this.num).concat(this.unit)}isNaN(){return pc(this.num)}}function SS(e){if(null==e||e.includes(CS))return CS;for(var t=e;t.includes("*")||t.includes("/");){var r,[,n,i,o]=null!==(r=_S.exec(t))&&void 0!==r?r:[],a=ES.parse(null!==n&&void 0!==n?n:""),s=ES.parse(null!==o&&void 0!==o?o:""),l="*"===i?a.multiply(s):a.divide(s);if(l.isNaN())return CS;t=t.replace(_S,l.toString())}for(;t.includes("+")||/.-\d+(?:\.\d+)?/.test(t);){var c,[,u,d,h]=null!==(c=vS.exec(t))&&void 0!==c?c:[],A=ES.parse(null!==u&&void 0!==u?u:""),f=ES.parse(null!==h&&void 0!==h?h:""),p="+"===d?A.add(f):A.subtract(f);if(p.isNaN())return CS;t=t.replace(vS,p.toString())}return t}!function(e,t,r){(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r}(ES,"NaN",new ES(NaN,""));var TS=/\(([^()]*)\)/;function IS(e){var t=e.replace(/\s+/g,"");return t=function(e){for(var t,r=e;null!=(t=TS.exec(r));){var[,n]=t;r=r.replace(TS,SS(n))}return r}(t),t=SS(t)}function FS(e){var t=function(e){try{return IS(e)}catch(t){return CS}}(e.slice(5,-1));return t===CS?"":t}var kS=["x","y","lineHeight","capHeight","fill","scaleToFit","textAnchor","verticalAnchor"],PS=["dx","dy","angle","className","breakAll"];function MS(){return MS=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},MS.apply(null,arguments)}function OS(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var LS=/[ \f\n\r\t\v\u2028\u2029]+/,DS=e=>{var{children:t,breakAll:r,style:n}=e;try{var i=[];return Bc(t)||(i=r?t.toString().split(""):t.toString().split(LS)),{wordsWithComputedWidth:i.map(e=>({word:e,width:yS(e,n).width})),spaceWidth:r?0:yS("\xa0",n).width}}catch(o){return null}};function US(e){return"start"===e||"middle"===e||"end"===e||"inherit"===e}var RS=(e,t,r,n)=>e.reduce((e,i)=>{var{word:o,width:a}=i,s=e[e.length-1];if(s&&null!=a&&(null==t||n||s.width+a+r<Number(t)))s.words.push(o),s.width+=a+r;else{var l={words:[o],width:a};e.push(l)}return e},[]),zS=e=>e.reduce((e,t)=>e.width>t.width?e:t),NS=(e,t,r,n,i,o,a,s)=>{var l=e.slice(0,t),c=DS({breakAll:r,style:n,children:l+"\u2026"});if(!c)return[!1,[]];var u=RS(c.wordsWithComputedWidth,o,a,s);return[u.length>i||zS(u).width>Number(o),u]},jS=e=>[{words:Bc(e)?[]:e.toString().split(LS),width:void 0}],QS=e=>{var{width:t,scaleToFit:r,children:n,style:i,breakAll:o,maxLines:a}=e;if((t||r)&&!nB){var s=DS({breakAll:o,children:n,style:i});if(!s)return jS(n);var{wordsWithComputedWidth:l,spaceWidth:c}=s;return((e,t,r,n,i)=>{var{maxLines:o,children:a,style:s,breakAll:l}=e,c=gc(o),u=String(a),d=RS(t,n,r,i);if(!c||i)return d;if(!(d.length>o||zS(d).width>Number(n)))return d;for(var h,A=0,f=u.length-1,p=0;A<=f&&p<=u.length-1;){var m=Math.floor((A+f)/2),g=m-1,[y,_]=NS(u,g,l,s,o,n,r,i),[v]=NS(u,m,l,s,o,n,r,i);if(y||v||(A=m+1),y&&v&&(f=m-1),!y&&v){h=_;break}p++}return h||d})({breakAll:o,children:n,maxLines:a,style:i},l,c,t,Boolean(r))}return jS(n)},VS="#808080",HS={angle:0,breakAll:!1,capHeight:"0.71em",fill:VS,lineHeight:"1em",scaleToFit:!1,textAnchor:"start",verticalAnchor:"end",x:0,y:0},GS=(0,n.forwardRef)((e,t)=>{var r=CC(e,HS),{x:i,y:o,lineHeight:a,capHeight:s,fill:l,scaleToFit:c,textAnchor:u,verticalAnchor:d}=r,h=OS(r,kS),A=(0,n.useMemo)(()=>QS({breakAll:h.breakAll,children:h.children,maxLines:h.maxLines,scaleToFit:c,style:h.style,width:h.width}),[h.breakAll,h.children,h.maxLines,c,h.style,h.width]),{dx:f,dy:p,angle:m,className:g,breakAll:y}=h,_=OS(h,PS);if(!yc(i)||!yc(o)||0===A.length)return null;var v,x=Number(i)+(gc(f)?f:0),w=Number(o)+(gc(p)?p:0);if(!Lc(x)||!Lc(w))return null;switch(d){case"start":v=FS("calc(".concat(s,")"));break;case"middle":v=FS("calc(".concat((A.length-1)/2," * -").concat(a," + (").concat(s," / 2))"));break;default:v=FS("calc(".concat(A.length-1," * -").concat(a,")"))}var b=[];if(c){var B=A[0].width,{width:C}=h;b.push("scale(".concat(gc(C)&&gc(B)?C/B:1,")"))}return m&&b.push("rotate(".concat(m,", ").concat(x,", ").concat(w,")")),b.length&&(_.transform=b.join(" ")),n.createElement("text",MS({},PB(_),{ref:t,x:x,y:w,className:sc("recharts-text",g),textAnchor:u,fill:l.includes("url")?VS:l}),A.map((e,t)=>{var r=e.words.join(y?"":" ");return n.createElement("tspan",{x:x,dy:0===t?v:a,key:"".concat(r,"-").concat(t)},r)}))});GS.displayName="Text";var KS=e=>null;KS.displayName="Cell";var WS=r(2086),qS=e=>"string"===typeof e?e:e?e.displayName||e.name||"Component":"",ZS=null,XS=null,YS=e=>{if(e===ZS&&Array.isArray(XS))return XS;var t=[];return n.Children.forEach(e,e=>{Bc(e)||((0,WS.isFragment)(e)?t=t.concat(YS(e.props.children)):t.push(e))}),XS=t,ZS=e,t};function JS(e,t){var r=[],n=[];return n=Array.isArray(t)?t.map(e=>qS(e)):[qS(t)],YS(e).forEach(e=>{var t=dc()(e,"type.displayName")||dc()(e,"type.name");t&&-1!==n.indexOf(t)&&r.push(e)}),r}var $S=r(9397),eT=r.n($S);function tT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function rT(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tT(Object(r),!0).forEach(function(t){nT(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tT(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function nT(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var iT=(e,t,r)=>e.map(e=>{return"".concat((n=e,n.replace(/([A-Z])/g,e=>"-".concat(e.toLowerCase())))," ").concat(t,"ms ").concat(r);var n}).join(","),oT=(e,t)=>Object.keys(t).reduce((r,n)=>rT(rT({},r),{},{[n]:e(n,t[n])}),{});function aT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function sT(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?aT(Object(r),!0).forEach(function(t){lT(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):aT(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function lT(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var cT=(e,t,r)=>e+(t-e)*r,uT=e=>{var{from:t,to:r}=e;return t!==r},dT=(e,t,r)=>{var n=oT((t,r)=>{if(uT(r)){var[n,i]=e(r.from,r.to,r.velocity);return sT(sT({},r),{},{from:n,velocity:i})}return r},t);return r<1?oT((e,t)=>uT(t)&&null!=n[e]?sT(sT({},t),{},{velocity:cT(t.velocity,n[e].velocity,r),from:cT(t.from,n[e].from,r)}):t,t):dT(e,n,r-1)};function hT(e,t,r,n,i,o){var a,s=n.reduce((r,n)=>sT(sT({},r),{},{[n]:{from:e[n],velocity:0,to:t[n]}}),{}),l=null,c=n=>{a||(a=n);var u=(n-a)/r.dt;s=dT(r,s,u),i(sT(sT(sT({},e),t),oT((e,t)=>t.from,s))),a=n,Object.values(s).filter(uT).length&&(l=o.setTimeout(c))};return()=>(l=o.setTimeout(c),()=>{var e;null===(e=l)||void 0===e||e()})}const AT=(e,t,r,n,i,o)=>{var a,s,l=(a=e,s=t,[Object.keys(a),Object.keys(s)].reduce((e,t)=>e.filter(e=>t.includes(e))));return null==r?()=>(i(sT(sT({},e),t)),()=>{}):!0===r.isStepper?hT(e,t,r,l,i,o):function(e,t,r,n,i,o,a){var s,l=null,c=i.reduce((r,n)=>{var i=e[n],o=t[n];return null==i||null==o?r:sT(sT({},r),{},{[n]:[i,o]})},{}),u=i=>{s||(s=i);var d=(i-s)/n,h=oT((e,t)=>cT(...t,r(d)),c);if(o(sT(sT(sT({},e),t),h)),d<1)l=a.setTimeout(u);else{var A=oT((e,t)=>cT(...t,r(1)),c);o(sT(sT(sT({},e),t),A))}};return()=>(l=a.setTimeout(u),()=>{var e;null===(e=l)||void 0===e||e()})}(e,t,r,n,l,i,o)};var fT=1e-4,pT=(e,t)=>[0,3*e,3*t-6*e,3*e-3*t+1],mT=(e,t)=>e.map((e,r)=>e*t**r).reduce((e,t)=>e+t),gT=(e,t)=>r=>{var n=pT(e,t);return mT(n,r)},yT=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(1===t.length)switch(t[0]){case"linear":return[0,0,1,1];case"ease":return[.25,.1,.25,1];case"ease-in":return[.42,0,1,1];case"ease-out":return[.42,0,.58,1];case"ease-in-out":return[0,0,.58,1];default:var n=(e=>{var t,r=e.split("(");if(2!==r.length||"cubic-bezier"!==r[0])return null;var n=null===(t=r[1])||void 0===t||null===(t=t.split(")")[0])||void 0===t?void 0:t.split(",");if(null==n||4!==n.length)return null;var i=n.map(e=>parseFloat(e));return[i[0],i[1],i[2],i[3]]})(t[0]);if(n)return n}return 4===t.length?t:[0,0,1,1]},_T=(e,t,r,n)=>{var i,o,a=gT(e,r),s=gT(t,n),l=(i=e,o=r,e=>{var t=[...pT(i,o).map((e,t)=>e*t).slice(1),0];return mT(t,e)}),c=e=>e>1?1:e<0?0:e,u=e=>{for(var t=e>1?1:e,r=t,n=0;n<8;++n){var i=a(r)-t,o=l(r);if(Math.abs(i-t)<fT||o<fT)return s(r);r=c(r-i/o)}return s(r)};return u.isStepper=!1,u},vT=function(){return _T(...yT(...arguments))},xT=e=>{if("string"===typeof e)switch(e){case"ease":case"ease-in-out":case"ease-out":case"ease-in":case"linear":return vT(e);case"spring":return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{stiff:t=100,damping:r=8,dt:n=17}=e,i=(e,i,o)=>{var a=o+(-(e-i)*t-o*r)*n/1e3,s=o*n/1e3+e;return Math.abs(s-i)<fT&&Math.abs(a)<fT?[i,0]:[s,a]};return i.isStepper=!0,i.dt=n,i}();default:if("cubic-bezier"===e.split("(")[0])return vT(e)}return"function"===typeof e?e:null};class wT{setTimeout(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=performance.now(),n=null,i=o=>{o-r>=t?e(o):"function"===typeof requestAnimationFrame&&(n=requestAnimationFrame(i))};return n=requestAnimationFrame(i),()=>{null!=n&&cancelAnimationFrame(n)}}}function bT(){return function(e){var t=()=>null,r=!1,n=null,i=o=>{if(!r){if(Array.isArray(o)){if(!o.length)return;var a=o,[s,...l]=a;return"number"===typeof s?void(n=e.setTimeout(i.bind(null,l),s)):(i(s),void(n=e.setTimeout(i.bind(null,l))))}"string"===typeof o&&t(o),"object"===typeof o&&t(o),"function"===typeof o&&o()}};return{stop:()=>{r=!0},start:e=>{r=!1,n&&(n(),n=null),i(e)},subscribe:e=>(t=e,()=>{t=()=>null}),getTimeoutController:()=>e}}(new wT)}var BT=(0,n.createContext)(bT);var CT={begin:0,duration:1e3,easing:"ease",isActive:!0,canBegin:!0,onAnimationEnd:()=>{},onAnimationStart:()=>{}},ET={t:0},ST={t:1};function TT(e){var t=CC(e,CT),{isActive:r,canBegin:i,duration:o,easing:a,begin:s,onAnimationEnd:l,onAnimationStart:c,children:u}=t,d="auto"===r?!nB:r,h=function(e,t){var r=(0,n.useContext)(BT);return(0,n.useMemo)(()=>null!==t&&void 0!==t?t:r(e),[e,t,r])}(t.animationId,t.animationManager),[A,f]=(0,n.useState)(d?ET:ST),p=(0,n.useRef)(null);return(0,n.useEffect)(()=>{d||f(ST)},[d]),(0,n.useEffect)(()=>{if(!d||!i)return Sc;var e=AT(ET,ST,xT(a),o,f,h.getTimeoutController());return h.start([c,s,()=>{p.current=e()},o,l]),()=>{h.stop(),p.current&&p.current(),l()}},[d,i,o,a,s,c,l,h]),u(A.t)}function IT(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"animation-",r=(0,n.useRef)(vc(t)),i=(0,n.useRef)(e);return i.current!==e&&(r.current=vc(t),i.current=e),r.current}var FT,kT,PT,MT,OT,LT,DT,UT,RT,zT,NT=["radius"],jT=["radius"];function QT(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function VT(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?QT(Object(r),!0).forEach(function(t){HT(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):QT(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function HT(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function GT(){return GT=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},GT.apply(null,arguments)}function KT(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function WT(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var qT,ZT,XT,YT,JT,$T=(e,t,r,n,i)=>{var o,a=hc(r),s=hc(n),l=Math.min(Math.abs(a)/2,Math.abs(s)/2),c=s>=0?1:-1,u=a>=0?1:-1,d=s>=0&&a>=0||s<0&&a<0?1:0;if(l>0&&i instanceof Array){for(var h=[0,0,0,0],A=0;A<4;A++)h[A]=i[A]>l?l:i[A];o=Ac(FT||(FT=WT(["M",",",""])),e,t+c*h[0]),h[0]>0&&(o+=Ac(kT||(kT=WT(["A ",",",",0,0,",",",",",""])),h[0],h[0],d,e+u*h[0],t)),o+=Ac(PT||(PT=WT(["L ",",",""])),e+r-u*h[1],t),h[1]>0&&(o+=Ac(MT||(MT=WT(["A ",",",",0,0,",",\n        ",",",""])),h[1],h[1],d,e+r,t+c*h[1])),o+=Ac(OT||(OT=WT(["L ",",",""])),e+r,t+n-c*h[2]),h[2]>0&&(o+=Ac(LT||(LT=WT(["A ",",",",0,0,",",\n        ",",",""])),h[2],h[2],d,e+r-u*h[2],t+n)),o+=Ac(DT||(DT=WT(["L ",",",""])),e+u*h[3],t+n),h[3]>0&&(o+=Ac(UT||(UT=WT(["A ",",",",0,0,",",\n        ",",",""])),h[3],h[3],d,e,t+n-c*h[3])),o+="Z"}else if(l>0&&i===+i&&i>0){var f=Math.min(l,i);o=Ac(RT||(RT=WT(["M ",",","\n            A ",",",",0,0,",",",",","\n            L ",",","\n            A ",",",",0,0,",",",",","\n            L ",",","\n            A ",",",",0,0,",",",",","\n            L ",",","\n            A ",",",",0,0,",",",","," Z"])),e,t+c*f,f,f,d,e+u*f,t,e+r-u*f,t,f,f,d,e+r,t+c*f,e+r,t+n-c*f,f,f,d,e+r-u*f,t+n,e+u*f,t+n,f,f,d,e,t+n-c*f)}else o=Ac(zT||(zT=WT(["M ",","," h "," v "," h "," Z"])),e,t,r,n,-r);return o},eI={x:0,y:0,width:0,height:0,radius:0,isAnimationActive:!1,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},tI=e=>{var t=CC(e,eI),r=(0,n.useRef)(null),[i,o]=(0,n.useState)(-1);(0,n.useEffect)(()=>{if(r.current&&r.current.getTotalLength)try{var e=r.current.getTotalLength();e&&o(e)}catch(t){}},[]);var{x:a,y:s,width:l,height:c,radius:u,className:d}=t,{animationEasing:h,animationDuration:A,animationBegin:f,isAnimationActive:p,isUpdateAnimationActive:m}=t,g=(0,n.useRef)(l),y=(0,n.useRef)(c),_=(0,n.useRef)(a),v=(0,n.useRef)(s),x=IT((0,n.useMemo)(()=>({x:a,y:s,width:l,height:c,radius:u}),[a,s,l,c,u]),"rectangle-");if(a!==+a||s!==+s||l!==+l||c!==+c||0===l||0===c)return null;var w=sc("recharts-rectangle",d);if(!m){var b=PB(t),{radius:B}=b,C=KT(b,NT);return n.createElement("path",GT({},C,{x:hc(a),y:hc(s),width:hc(l),height:hc(c),radius:"number"===typeof u?u:void 0,className:w,d:$T(a,s,l,c,u)}))}var E=g.current,S=y.current,T=_.current,I=v.current,F="0px ".concat(-1===i?1:i,"px"),k="".concat(i,"px 0px"),P=iT(["strokeDasharray"],A,"string"===typeof h?h:eI.animationEasing);return n.createElement(TT,{animationId:x,key:x,canBegin:i>0,duration:A,easing:h,isActive:m,begin:f},e=>{var i,o=bc(E,l,e),d=bc(S,c,e),h=bc(T,a,e),A=bc(I,s,e);r.current&&(g.current=o,y.current=d,_.current=h,v.current=A),i=p?e>0?{transition:P,strokeDasharray:k}:{strokeDasharray:F}:{strokeDasharray:k};var f=PB(t),{radius:m}=f,x=KT(f,jT);return n.createElement("path",GT({},x,{radius:"number"===typeof u?u:void 0,className:w,d:$T(h,A,o,d,u),ref:r,style:VT(VT({},i),t.style)}))})};function rI(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function nI(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rI(Object(r),!0).forEach(function(t){iI(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rI(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function iI(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oI(){return oI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oI.apply(null,arguments)}function aI(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var sI,lI,cI,uI,dI,hI,AI,fI=(e,t,r,n,i)=>{var o,a=r-n;return o=Ac(qT||(qT=aI(["M ",",",""])),e,t),o+=Ac(ZT||(ZT=aI(["L ",",",""])),e+r,t),o+=Ac(XT||(XT=aI(["L ",",",""])),e+r-a/2,t+i),o+=Ac(YT||(YT=aI(["L ",",",""])),e+r-a/2-n,t+i),o+=Ac(JT||(JT=aI(["L ",","," Z"])),e,t)},pI={x:0,y:0,upperWidth:0,lowerWidth:0,height:0,isUpdateAnimationActive:!1,animationBegin:0,animationDuration:1500,animationEasing:"ease"},mI=e=>{var t=CC(e,pI),{x:r,y:i,upperWidth:o,lowerWidth:a,height:s,className:l}=t,{animationEasing:c,animationDuration:u,animationBegin:d,isUpdateAnimationActive:h}=t,A=(0,n.useRef)(null),[f,p]=(0,n.useState)(-1),m=(0,n.useRef)(o),g=(0,n.useRef)(a),y=(0,n.useRef)(s),_=(0,n.useRef)(r),v=(0,n.useRef)(i),x=IT(e,"trapezoid-");if((0,n.useEffect)(()=>{if(A.current&&A.current.getTotalLength)try{var e=A.current.getTotalLength();e&&p(e)}catch(t){}},[]),r!==+r||i!==+i||o!==+o||a!==+a||s!==+s||0===o&&0===a||0===s)return null;var w=sc("recharts-trapezoid",l);if(!h)return n.createElement("g",null,n.createElement("path",oI({},PB(t),{className:w,d:fI(r,i,o,a,s)})));var b=m.current,B=g.current,C=y.current,E=_.current,S=v.current,T="0px ".concat(-1===f?1:f,"px"),I="".concat(f,"px 0px"),F=iT(["strokeDasharray"],u,c);return n.createElement(TT,{animationId:x,key:x,canBegin:f>0,duration:u,easing:c,isActive:h,begin:d},e=>{var l=bc(b,o,e),c=bc(B,a,e),u=bc(C,s,e),d=bc(E,r,e),h=bc(S,i,e);A.current&&(m.current=l,g.current=c,y.current=u,_.current=d,v.current=h);var f=e>0?{transition:F,strokeDasharray:I}:{strokeDasharray:T};return n.createElement("path",oI({},PB(t),{className:w,d:fI(d,h,l,c,u),ref:A,style:nI(nI({},f),t.style)}))})};function gI(){return gI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gI.apply(null,arguments)}function yI(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var _I=e=>{var{cx:t,cy:r,radius:n,angle:i,sign:o,isExternal:a,cornerRadius:s,cornerIsExternal:l}=e,c=s*(a?1:-1)+n,u=Math.asin(s/c)/_y,d=l?i:i+o*u,h=l?i-o*u:i;return{center:xy(t,r,c,d),circleTangency:xy(t,r,n,d),lineTangency:xy(t,r,c*Math.cos(u*_y),h),theta:u}},vI=e=>{var{cx:t,cy:r,innerRadius:n,outerRadius:i,startAngle:o,endAngle:a}=e,s=((e,t)=>fc(t-e)*Math.min(Math.abs(t-e),359.999))(o,a),l=o+s,c=xy(t,r,i,o),u=xy(t,r,i,l),d=Ac(sI||(sI=yI(["M ",",","\n    A ",",",",0,\n    ",",",",\n    ",",","\n  "])),c.x,c.y,i,i,+(Math.abs(s)>180),+(o>l),u.x,u.y);if(n>0){var h=xy(t,r,n,o),A=xy(t,r,n,l);d+=Ac(lI||(lI=yI(["L ",",","\n            A ",",",",0,\n            ",",",",\n            ",","," Z"])),A.x,A.y,n,n,+(Math.abs(s)>180),+(o<=l),h.x,h.y)}else d+=Ac(cI||(cI=yI(["L ",","," Z"])),t,r);return d},xI={cx:0,cy:0,innerRadius:0,outerRadius:0,startAngle:0,endAngle:0,cornerRadius:0,forceCornerRadius:!1,cornerIsExternal:!1},wI=e=>{var t=CC(e,xI),{cx:r,cy:i,innerRadius:o,outerRadius:a,cornerRadius:s,forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:d,className:h}=t;if(a<o||u===d)return null;var A,f=sc("recharts-sector",h),p=a-o,m=xc(s,p,0,!0);return A=m>0&&Math.abs(u-d)<360?(e=>{var{cx:t,cy:r,innerRadius:n,outerRadius:i,cornerRadius:o,forceCornerRadius:a,cornerIsExternal:s,startAngle:l,endAngle:c}=e,u=fc(c-l),{circleTangency:d,lineTangency:h,theta:A}=_I({cx:t,cy:r,radius:i,angle:l,sign:u,cornerRadius:o,cornerIsExternal:s}),{circleTangency:f,lineTangency:p,theta:m}=_I({cx:t,cy:r,radius:i,angle:c,sign:-u,cornerRadius:o,cornerIsExternal:s}),g=s?Math.abs(l-c):Math.abs(l-c)-A-m;if(g<0)return a?Ac(uI||(uI=yI(["M ",",","\n        a",",",",0,0,1,",",0\n        a",",",",0,0,1,",",0\n      "])),h.x,h.y,o,o,2*o,o,o,2*-o):vI({cx:t,cy:r,innerRadius:n,outerRadius:i,startAngle:l,endAngle:c});var y=Ac(dI||(dI=yI(["M ",",","\n    A",",",",0,0,",",",",","\n    A",",",",0,",",",",",",","\n    A",",",",0,0,",",",",","\n  "])),h.x,h.y,o,o,+(u<0),d.x,d.y,i,i,+(g>180),+(u<0),f.x,f.y,o,o,+(u<0),p.x,p.y);if(n>0){var{circleTangency:_,lineTangency:v,theta:x}=_I({cx:t,cy:r,radius:n,angle:l,sign:u,isExternal:!0,cornerRadius:o,cornerIsExternal:s}),{circleTangency:w,lineTangency:b,theta:B}=_I({cx:t,cy:r,radius:n,angle:c,sign:-u,isExternal:!0,cornerRadius:o,cornerIsExternal:s}),C=s?Math.abs(l-c):Math.abs(l-c)-x-B;if(C<0&&0===o)return"".concat(y,"L").concat(t,",").concat(r,"Z");y+=Ac(hI||(hI=yI(["L",",","\n      A",",",",0,0,",",",",","\n      A",",",",0,",",",",",",","\n      A",",",",0,0,",",",",","Z"])),b.x,b.y,o,o,+(u<0),w.x,w.y,n,n,+(C>180),+(u>0),_.x,_.y,o,o,+(u<0),v.x,v.y)}else y+=Ac(AI||(AI=yI(["L",",","Z"])),t,r);return y})({cx:r,cy:i,innerRadius:o,outerRadius:a,cornerRadius:Math.min(m,p/2),forceCornerRadius:l,cornerIsExternal:c,startAngle:u,endAngle:d}):vI({cx:r,cy:i,innerRadius:o,outerRadius:a,startAngle:u,endAngle:d}),n.createElement("path",gI({},PB(t),{className:f,d:A}))};Math.abs,Math.atan2;const bI=Math.cos,BI=(Math.max,Math.min,Math.sin),CI=Math.sqrt,EI=Math.PI,SI=2*EI;const TI={draw(e,t){const r=CI(t/EI);e.moveTo(r,0),e.arc(0,0,r,0,SI)}},II={draw(e,t){const r=CI(t/5)/2;e.moveTo(-3*r,-r),e.lineTo(-r,-r),e.lineTo(-r,-3*r),e.lineTo(r,-3*r),e.lineTo(r,-r),e.lineTo(3*r,-r),e.lineTo(3*r,r),e.lineTo(r,r),e.lineTo(r,3*r),e.lineTo(-r,3*r),e.lineTo(-r,r),e.lineTo(-3*r,r),e.closePath()}},FI=CI(1/3),kI=2*FI,PI={draw(e,t){const r=CI(t/kI),n=r*FI;e.moveTo(0,-r),e.lineTo(n,0),e.lineTo(0,r),e.lineTo(-n,0),e.closePath()}},MI={draw(e,t){const r=CI(t),n=-r/2;e.rect(n,n,r,r)}},OI=BI(EI/10)/BI(7*EI/10),LI=BI(SI/10)*OI,DI=-bI(SI/10)*OI,UI={draw(e,t){const r=CI(.8908130915292852*t),n=LI*r,i=DI*r;e.moveTo(0,-r),e.lineTo(n,i);for(let o=1;o<5;++o){const t=SI*o/5,a=bI(t),s=BI(t);e.lineTo(s*r,-a*r),e.lineTo(a*n-s*i,s*n+a*i)}e.closePath()}},RI=CI(3),zI={draw(e,t){const r=-CI(t/(3*RI));e.moveTo(0,2*r),e.lineTo(-RI*r,-r),e.lineTo(RI*r,-r),e.closePath()}},NI=-.5,jI=CI(3)/2,QI=1/CI(12),VI=3*(QI/2+1),HI={draw(e,t){const r=CI(t/VI),n=r/2,i=r*QI,o=n,a=r*QI+r,s=-o,l=a;e.moveTo(n,i),e.lineTo(o,a),e.lineTo(s,l),e.lineTo(NI*n-jI*i,jI*n+NI*i),e.lineTo(NI*o-jI*a,jI*o+NI*a),e.lineTo(NI*s-jI*l,jI*s+NI*l),e.lineTo(NI*n+jI*i,NI*i-jI*n),e.lineTo(NI*o+jI*a,NI*a-jI*o),e.lineTo(NI*s+jI*l,NI*l-jI*s),e.closePath()}};CI(3),CI(3);var GI=["type","size","sizeType"];function KI(){return KI=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},KI.apply(null,arguments)}function WI(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function qI(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?WI(Object(r),!0).forEach(function(t){ZI(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):WI(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function ZI(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var XI={symbolCircle:TI,symbolCross:II,symbolDiamond:PI,symbolSquare:MI,symbolStar:UI,symbolTriangle:zI,symbolWye:HI},YI=Math.PI/180,JI=e=>{var{type:t="circle",size:r=64,sizeType:i="area"}=e,o=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,GI),a=qI(qI({},o),{},{type:t,size:r,sizeType:i}),s="circle";"string"===typeof t&&(s=t);var{className:l,cx:c,cy:u}=a,d=PB(a);return gc(c)&&gc(u)&&gc(r)?n.createElement("path",KI({},d,{className:sc("recharts-symbols",l),transform:"translate(".concat(c,", ").concat(u,")"),d:(()=>{var e=(e=>{var t="symbol".concat(Cc(e));return XI[t]||TI})(s),t=function(e,t){let r=null,n=GE(i);function i(){let i;if(r||(r=i=n()),e.apply(this,arguments).draw(r,+t.apply(this,arguments)),i)return r=null,i+""||null}return e="function"===typeof e?e:Od(e||TI),t="function"===typeof t?t:Od(void 0===t?64:+t),i.type=function(t){return arguments.length?(e="function"===typeof t?t:Od(t),i):e},i.size=function(e){return arguments.length?(t="function"===typeof e?e:Od(+e),i):t},i.context=function(e){return arguments.length?(r=null==e?null:e,i):r},i}().type(e).size(((e,t,r)=>{if("area"===t)return e;switch(r){case"cross":return 5*e*e/9;case"diamond":return.5*e*e/Math.sqrt(3);case"square":return e*e;case"star":var n=18*YI;return 1.25*e*e*(Math.tan(n)-Math.tan(2*n)*Math.tan(n)**2);case"triangle":return Math.sqrt(3)*e*e/4;case"wye":return(21-10*Math.sqrt(3))*e*e/8;default:return Math.PI*e*e/4}})(r,i,s)),n=t();if(null!==n)return n})()})):null};JI.registerSymbol=(e,t)=>{XI["symbol".concat(Cc(e))]=t};var $I=["option","shapeType","activeClassName"];function eF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function tF(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?eF(Object(r),!0).forEach(function(t){rF(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):eF(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function rF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function nF(e){var{shapeType:t,elementProps:r}=e;switch(t){case"rectangle":return n.createElement(tI,r);case"trapezoid":return n.createElement(mI,r);case"sector":return n.createElement(wI,r);case"symbols":if(function(e){return"symbols"===e}(t))return n.createElement(JI,r);break;case"curve":return n.createElement(lS,r);default:return null}}function iF(e){var t,{option:r,shapeType:i,activeClassName:o="recharts-active-shape"}=e,a=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,$I);if((0,n.isValidElement)(r))t=(0,n.cloneElement)(r,tF(tF({},a),function(e){return(0,n.isValidElement)(e)?e.props:e}(r)));else if("function"===typeof r)t=r(a,a.index);else if(eT()(r)&&"boolean"!==typeof r){var s=function(e,t){return tF(tF({},t),e)}(r,a);t=n.createElement(nF,{shapeType:i,elementProps:s})}else{var l=a;t=n.createElement(nF,{shapeType:i,elementProps:l})}return a.isActive?n.createElement(yE,{className:o},t):t}var oF,aF=(e,t,r)=>{var n=bd();return(i,o)=>a=>{null===e||void 0===e||e(i,o,a),n(Gu({activeIndex:String(o),activeDataKey:t,activeCoordinate:i.tooltipPosition,activeGraphicalItemId:r}))}},sF=e=>{var t=bd();return(r,n)=>i=>{null===e||void 0===e||e(r,n,i),t(Ku())}},lF=(e,t,r)=>{var n=bd();return(i,o)=>a=>{null===e||void 0===e||e(i,o,a),n(qu({activeIndex:String(o),activeDataKey:t,activeCoordinate:i.tooltipPosition,activeGraphicalItemId:r}))}};function cF(e){var{tooltipEntrySettings:t}=e,r=bd(),i=gh(),o=(0,n.useRef)(null);return(0,n.useLayoutEffect)(()=>{i||(null===o.current?r(ju(t)):o.current!==t&&r(Qu({prev:o.current,next:t})),o.current=t)},[t,r,i]),(0,n.useLayoutEffect)(()=>()=>{o.current&&(r(Vu(o.current)),o.current=null)},[r]),null}function uF(e){var{legendPayload:t}=e,r=bd(),i=gh(),o=(0,n.useRef)(null);return(0,n.useLayoutEffect)(()=>{i||(null===o.current?r(Bb(t)):o.current!==t&&r(Cb({prev:o.current,next:t})),o.current=t)},[r,i,t]),(0,n.useLayoutEffect)(()=>()=>{o.current&&(r(Eb(o.current)),o.current=null)},[r]),null}function dF(e){var{legendPayload:t}=e,r=bd(),i=Sd(Eh),o=(0,n.useRef)(null);return(0,n.useLayoutEffect)(()=>{"centric"!==i&&"radial"!==i||(null===o.current?r(Bb(t)):o.current!==t&&r(Cb({prev:o.current,next:t})),o.current=t)},[r,i,t]),(0,n.useLayoutEffect)(()=>()=>{o.current&&(r(Eb(o.current)),o.current=null)},[r]),null}var hF=null!==(oF=i["useId".toString()])&&void 0!==oF?oF:()=>{var[e]=n.useState(()=>vc("uid-"));return e};var AF=(0,n.createContext)(void 0),fF=e=>{var{id:t,type:r,children:i}=e,o=function(e,t){var r=hF();return t||(e?"".concat(e,"-").concat(r):r)}("recharts-".concat(r),t);return n.createElement(AF.Provider,{value:o},i(o))};var pF=e=>{var t=bd(),r=(0,n.useRef)(null);return(0,n.useLayoutEffect)(()=>{null===r.current?t(nb(e)):r.current!==e&&t(ib({prev:r.current,next:e})),r.current=e},[t,e]),(0,n.useLayoutEffect)(()=>()=>{r.current&&(t(ob(r.current)),r.current=null)},[t]),null},mF=(0,n.memo)(pF);function gF(e){var t=bd();return(0,n.useLayoutEffect)(()=>(t(ab(e)),()=>{t(sb(e))}),[t,e]),null}var yF=r(356),_F=r.n(yF);function vF(e){var{zIndex:t,children:r}=e,i=void 0!==Sh()&&void 0!==t&&0!==t,o=gh(),a=bd();(0,n.useLayoutEffect)(()=>i?(a(uB({zIndex:t})),()=>{a(dB({zIndex:t}))}):Sc,[a,t,i]);var s=Sd(e=>DB(e,t,o));return i?s?(0,F.createPortal)(r,s):null:r}var xF=["labelRef"],wF=["content"];function bF(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function BF(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function CF(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?BF(Object(r),!0).forEach(function(t){EF(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):BF(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function EF(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function SF(){return SF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},SF.apply(null,arguments)}var TF=(0,n.createContext)(null),IF=e=>{var{x:t,y:r,upperWidth:i,lowerWidth:o,width:a,height:s,children:l}=e,c=(0,n.useMemo)(()=>({x:t,y:r,upperWidth:i,lowerWidth:o,width:a,height:s}),[t,r,i,o,a,s]);return n.createElement(TF.Provider,{value:c},l)},FF=()=>{var e=(0,n.useContext)(TF),t=xh();return e||vh(t)},kF=(0,n.createContext)(null),PF=()=>{var e=(0,n.useContext)(kF),t=Sd(Zy);return e||t},MF=e=>null!=e&&"function"===typeof e,OF=(e,t,r,i,o)=>{var a,s,{offset:l,className:c}=e,{cx:u,cy:d,innerRadius:h,outerRadius:A,startAngle:f,endAngle:p,clockWise:m}=o,g=(h+A)/2,y=((e,t)=>fc(t-e)*Math.min(Math.abs(t-e),360))(f,p),_=y>=0?1:-1;switch(t){case"insideStart":a=f+_*l,s=m;break;case"insideEnd":a=p-_*l,s=!m;break;case"end":a=p+_*l,s=m;break;default:throw new Error("Unsupported position ".concat(t))}s=y<=0?s:!s;var v=xy(u,d,g,a),x=xy(u,d,g,a+359*(s?1:-1)),w="M".concat(v.x,",").concat(v.y,"\n    A").concat(g,",").concat(g,",0,1,").concat(s?0:1,",\n    ").concat(x.x,",").concat(x.y),b=Bc(e.id)?vc("recharts-radial-line-"):e.id;return n.createElement("text",SF({},i,{dominantBaseline:"central",className:sc("recharts-radial-bar-label",c)}),n.createElement("defs",null,n.createElement("path",{id:b,d:w})),n.createElement("textPath",{xlinkHref:"#".concat(b)},r))},LF=e=>"cx"in e&&gc(e.cx),DF={angle:0,offset:5,zIndex:Ey.label,position:"middle",textBreakAll:!1};function UF(e){var t,r,i,o=CC(e,DF),{viewBox:a,position:s,value:l,children:c,content:u,className:d="",textBreakAll:h,labelRef:A}=o,f=PF(),p=FF();if(!(t=null==a?"center"===s?p:null!==f&&void 0!==f?f:p:LF(a)?a:vh(a))||Bc(l)&&Bc(c)&&!(0,n.isValidElement)(u)&&"function"!==typeof u)return null;var m=CF(CF({},o),{},{viewBox:t});if((0,n.isValidElement)(u)){var{labelRef:g}=m,y=bF(m,xF);return(0,n.cloneElement)(u,y)}if("function"===typeof u){var{content:_}=m,v=bF(m,wF);if(r=(0,n.createElement)(u,v),(0,n.isValidElement)(r))return r}else r=(e=>{var{value:t,formatter:r}=e,n=Bc(e.children)?t:e.children;return"function"===typeof r?r(n):n})(o);var x=PB(o);if(LF(t)){if("insideStart"===s||"insideEnd"===s||"end"===s)return OF(o,s,r,x,t);i=((e,t,r)=>{var{cx:n,cy:i,innerRadius:o,outerRadius:a,startAngle:s,endAngle:l}=e,c=(s+l)/2;if("outside"===r){var{x:u,y:d}=xy(n,i,a+t,c);return{x:u,y:d,textAnchor:u>=n?"start":"end",verticalAnchor:"middle"}}if("center"===r)return{x:n,y:i,textAnchor:"middle",verticalAnchor:"middle"};if("centerTop"===r)return{x:n,y:i,textAnchor:"middle",verticalAnchor:"start"};if("centerBottom"===r)return{x:n,y:i,textAnchor:"middle",verticalAnchor:"end"};var h=(o+a)/2,{x:A,y:f}=xy(n,i,h,c);return{x:A,y:f,textAnchor:"middle",verticalAnchor:"middle"}})(t,o.offset,o.position)}else i=((e,t)=>{var r,{parentViewBox:n,offset:i,position:o}=e;null==n||LF(n)||(r=n);var{x:a,y:s,upperWidth:l,lowerWidth:c,height:u}=t,d=a,h=a+(l-c)/2,A=(d+h)/2,f=(l+c)/2,p=d+l/2,m=u>=0?1:-1,g=m*i,y=m>0?"end":"start",_=m>0?"start":"end",v=l>=0?1:-1,x=v*i,w=v>0?"end":"start",b=v>0?"start":"end";if("top"===o)return CF(CF({},{x:d+l/2,y:s-g,textAnchor:"middle",verticalAnchor:y}),r?{height:Math.max(s-r.y,0),width:l}:{});if("bottom"===o)return CF(CF({},{x:h+c/2,y:s+u+g,textAnchor:"middle",verticalAnchor:_}),r?{height:Math.max(r.y+r.height-(s+u),0),width:c}:{});if("left"===o){var B={x:A-x,y:s+u/2,textAnchor:w,verticalAnchor:"middle"};return CF(CF({},B),r?{width:Math.max(B.x-r.x,0),height:u}:{})}if("right"===o){var C={x:A+f+x,y:s+u/2,textAnchor:b,verticalAnchor:"middle"};return CF(CF({},C),r?{width:Math.max(r.x+r.width-C.x,0),height:u}:{})}var E=r?{width:f,height:u}:{};return"insideLeft"===o?CF({x:A+x,y:s+u/2,textAnchor:b,verticalAnchor:"middle"},E):"insideRight"===o?CF({x:A+f-x,y:s+u/2,textAnchor:w,verticalAnchor:"middle"},E):"insideTop"===o?CF({x:d+l/2,y:s+g,textAnchor:"middle",verticalAnchor:_},E):"insideBottom"===o?CF({x:h+c/2,y:s+u-g,textAnchor:"middle",verticalAnchor:y},E):"insideTopLeft"===o?CF({x:d+x,y:s+g,textAnchor:b,verticalAnchor:_},E):"insideTopRight"===o?CF({x:d+l-x,y:s+g,textAnchor:w,verticalAnchor:_},E):"insideBottomLeft"===o?CF({x:h+x,y:s+u-g,textAnchor:b,verticalAnchor:y},E):"insideBottomRight"===o?CF({x:h+c-x,y:s+u-g,textAnchor:w,verticalAnchor:y},E):o&&"object"===typeof o&&(gc(o.x)||mc(o.x))&&(gc(o.y)||mc(o.y))?CF({x:a+xc(o.x,f),y:s+xc(o.y,u),textAnchor:"end",verticalAnchor:"end"},E):CF({x:p,y:s+u/2,textAnchor:"middle",verticalAnchor:"middle"},E)})(o,t);return n.createElement(vF,{zIndex:o.zIndex},n.createElement(GS,SF({ref:A,className:sc("recharts-label",d)},x,i,{textAnchor:US(x.textAnchor)?x.textAnchor:i.textAnchor,breakAll:h}),r))}UF.displayName="Label";var RF=(e,t,r)=>{if(!e)return null;var i={viewBox:t,labelRef:r};return!0===e?n.createElement(UF,SF({key:"label-implicit"},i)):yc(e)?n.createElement(UF,SF({key:"label-implicit",value:e},i)):(0,n.isValidElement)(e)?e.type===UF?(0,n.cloneElement)(e,CF({key:"label-implicit"},i)):n.createElement(UF,SF({key:"label-implicit",content:e},i)):MF(e)?n.createElement(UF,SF({key:"label-implicit",content:e},i)):e&&"object"===typeof e?n.createElement(UF,SF({},e,{key:"label-implicit"},i)):null};function zF(e){var{label:t,labelRef:r}=e,n=FF();return RF(t,n,r)||null}var NF=["valueAccessor"],jF=["dataKey","clockWise","id","textBreakAll","zIndex"];function QF(){return QF=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},QF.apply(null,arguments)}function VF(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var HF=e=>Array.isArray(e.value)?_F()(e.value):e.value,GF=(0,n.createContext)(void 0),KF=GF.Provider,WF=(0,n.createContext)(void 0),qF=WF.Provider;function ZF(e){var{valueAccessor:t=HF}=e,r=VF(e,NF),{dataKey:i,clockWise:o,id:a,textBreakAll:s,zIndex:l}=r,c=VF(r,jF),u=(0,n.useContext)(GF),d=(0,n.useContext)(WF),h=u||d;return h&&h.length?n.createElement(vF,{zIndex:null!==l&&void 0!==l?l:Ey.label},n.createElement(yE,{className:"recharts-label-list"},h.map((e,o)=>{var l,u=Bc(i)?t(e,o):Qd(e&&e.payload,i),d=Bc(a)?{}:{id:"".concat(a,"-").concat(o)};return n.createElement(UF,QF({key:"label-".concat(o)},PB(e),c,d,{fill:null!==(l=r.fill)&&void 0!==l?l:e.fill,parentViewBox:e.parentViewBox,value:u,textBreakAll:s,viewBox:e.viewBox,index:o,zIndex:0}))}))):null}function XF(e){var{label:t}=e;return t?!0===t?n.createElement(ZF,{key:"labelList-implicit"}):n.isValidElement(t)||MF(t)?n.createElement(ZF,{key:"labelList-implicit",content:t}):"object"===typeof t?n.createElement(ZF,QF({key:"labelList-implicit"},t,{type:String(t.type)})):null:null}ZF.displayName="LabelList";var YF=["key"],JF=["onMouseEnter","onClick","onMouseLeave"],$F=["id"],ek=["id"];function tk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function rk(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tk(Object(r),!0).forEach(function(t){nk(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tk(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function nk(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ik(){return ik=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},ik.apply(null,arguments)}function ok(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function ak(e){var t=(0,n.useMemo)(()=>JS(e.children,KS),[e.children]),r=Sd(r=>eE(r,e.id,t));return null==r?null:n.createElement(dF,{legendPayload:r})}var sk=n.memo(e=>{var{dataKey:t,nameKey:r,sectors:i,stroke:o,strokeWidth:a,fill:s,name:l,hide:c,tooltipType:u,id:d}=e,h={dataDefinedOnItem:i.map(e=>e.tooltipPayload),positions:i.map(e=>e.tooltipPosition),settings:{stroke:o,strokeWidth:a,fill:s,dataKey:t,nameKey:r,name:th(l,t),hide:c,type:u,color:s,unit:"",graphicalItemId:d}};return n.createElement(cF,{tooltipEntrySettings:h})}),lk=(e,t,r)=>{var{top:n,left:i,width:o,height:a}=t,s=wy(o,a),l=i+xc(e.cx,o,o/2),c=n+xc(e.cy,a,a/2),u=xc(e.innerRadius,s,0),d=((e,t,r)=>xc("function"===typeof t?t(e):t,r,.8*r))(r,e.outerRadius,s);return{cx:l,cy:c,innerRadius:u,outerRadius:d,maxRadius:e.maxRadius||Math.sqrt(o*o+a*a)/2}},ck=(e,t)=>fc(t-e)*Math.min(Math.abs(t-e),360);function uk(e){var{sectors:t,props:r,showLabels:i}=e,{label:o,labelLine:a,dataKey:s}=r;if(!i||!o||!t)return null;var l=FB(r),c=kB(o),u=kB(a),d="object"===typeof o&&"offsetRadius"in o&&"number"===typeof o.offsetRadius&&o.offsetRadius||20,h=t.map((e,t)=>{var r,i,h=(e.startAngle+e.endAngle)/2,A=xy(e.cx,e.cy,e.outerRadius+d,h),f=rk(rk(rk(rk({},l),e),{},{stroke:"none"},c),{},{index:t,textAnchor:(r=A.x,i=e.cx,r>i?"start":r<i?"end":"middle")},A),p=rk(rk(rk(rk({},l),e),{},{fill:"none",stroke:e.fill},u),{},{index:t,points:[xy(e.cx,e.cy,e.outerRadius,h),A],key:"line"});return n.createElement(vF,{zIndex:Ey.label,key:"label-".concat(e.startAngle,"-").concat(e.endAngle,"-").concat(e.midAngle,"-").concat(t)},n.createElement(yE,null,a&&((e,t)=>{if(n.isValidElement(e))return n.cloneElement(e,t);if("function"===typeof e)return e(t);var r=sc("recharts-pie-label-line","boolean"!==typeof e?e.className:""),{key:i}=t,o=ok(t,YF);return n.createElement(lS,ik({},o,{type:"linear",className:r}))})(a,p),((e,t,r)=>{if(n.isValidElement(e))return n.cloneElement(e,t);var i=r;if("function"===typeof e&&(i=e(t),n.isValidElement(i)))return i;var o,a=sc("recharts-pie-label-text",(o=e)&&"object"===typeof o&&"className"in o&&"string"===typeof o.className?o.className:"");return n.createElement(GS,ik({},t,{alignmentBaseline:"middle",className:a}),i)})(o,f,Qd(e,s))))});return n.createElement(yE,{className:"recharts-pie-labels"},h)}function dk(e){var{sectors:t,props:r,showLabels:i}=e,{label:o}=r;return"object"===typeof o&&null!=o&&"position"in o?n.createElement(XF,{label:o}):n.createElement(uk,{sectors:t,props:r,showLabels:i})}function hk(e){var{sectors:t,activeShape:r,inactiveShape:i,allOtherPieProps:o,shape:a,id:s}=e,l=Sd(sw),c=Sd(cw),u=Sd(uw),{onMouseEnter:d,onClick:h,onMouseLeave:A}=o,f=ok(o,JF),p=aF(d,o.dataKey,s),m=sF(A),g=lF(h,o.dataKey,s);return null==t||0===t.length?null:n.createElement(n.Fragment,null,t.map((e,d)=>{if(0===(null===e||void 0===e?void 0:e.startAngle)&&0===(null===e||void 0===e?void 0:e.endAngle)&&1!==t.length)return null;var h=null==u||u===s,A=String(d)===l&&(null==c||o.dataKey===c)&&h,y=r&&A?r:l?i:null,_=rk(rk({},e),{},{stroke:e.stroke,tabIndex:-1,[lh]:d,[ch]:s});return n.createElement(yE,ik({key:"sector-".concat(null===e||void 0===e?void 0:e.startAngle,"-").concat(null===e||void 0===e?void 0:e.endAngle,"-").concat(e.midAngle,"-").concat(d),tabIndex:-1,className:"recharts-pie-sector"},YE(f,e,d),{onMouseEnter:p(e,d),onMouseLeave:m(e,d),onClick:g(e,d)}),n.createElement(iF,ik({option:null!==a&&void 0!==a?a:y,index:d,shapeType:"sector",isActive:A},_)))}))}function Ak(e){var{showLabels:t,sectors:r,children:i}=e,o=(0,n.useMemo)(()=>t&&r?r.map(e=>({value:e.value,payload:e.payload,clockWise:!1,parentViewBox:void 0,viewBox:{cx:e.cx,cy:e.cy,innerRadius:e.innerRadius,outerRadius:e.outerRadius,startAngle:e.startAngle,endAngle:e.endAngle,clockWise:!1},fill:e.fill})):[],[r,t]);return n.createElement(qF,{value:t?o:void 0},i)}function fk(e){var{props:t,previousSectorsRef:r,id:i}=e,{sectors:o,isAnimationActive:a,animationBegin:s,animationDuration:l,animationEasing:c,activeShape:u,inactiveShape:d,onAnimationStart:h,onAnimationEnd:A}=t,f=IT(t,"recharts-pie-"),p=r.current,[m,g]=(0,n.useState)(!1),y=(0,n.useCallback)(()=>{"function"===typeof A&&A(),g(!1)},[A]),_=(0,n.useCallback)(()=>{"function"===typeof h&&h(),g(!0)},[h]);return n.createElement(Ak,{showLabels:!m,sectors:o},n.createElement(TT,{animationId:f,begin:s,duration:l,isActive:a,easing:c,onAnimationStart:_,onAnimationEnd:y,key:f},e=>{var a=[],s=o&&o[0],l=null===s||void 0===s?void 0:s.startAngle;return null===o||void 0===o||o.forEach((t,r)=>{var n=p&&p[r],i=r>0?dc()(t,"paddingAngle",0):0;if(n){var o=bc(n.endAngle-n.startAngle,t.endAngle-t.startAngle,e),s=rk(rk({},t),{},{startAngle:l+i,endAngle:l+o+i});a.push(s),l=s.endAngle}else{var{endAngle:c,startAngle:u}=t,d=bc(0,c-u,e),h=rk(rk({},t),{},{startAngle:l+i,endAngle:l+d+i});a.push(h),l=h.endAngle}}),r.current=a,n.createElement(yE,null,n.createElement(hk,{sectors:a,activeShape:u,inactiveShape:d,allOtherPieProps:t,shape:t.shape,id:i}))}),n.createElement(dk,{showLabels:!m,sectors:o,props:t}),t.children)}var pk={animationBegin:400,animationDuration:1500,animationEasing:"ease",cx:"50%",cy:"50%",dataKey:"value",endAngle:360,fill:"#808080",hide:!1,innerRadius:0,isAnimationActive:"auto",label:!1,labelLine:!0,legendType:"rect",minAngle:0,nameKey:"name",outerRadius:"80%",paddingAngle:0,rootTabIndex:0,startAngle:0,stroke:"#fff",zIndex:Ey.area};function mk(e){var{id:t}=e,r=ok(e,$F),{hide:i,className:o,rootTabIndex:a}=e,s=(0,n.useMemo)(()=>JS(e.children,KS),[e.children]),l=Sd(e=>tE(e,t,s)),c=(0,n.useRef)(null),u=sc("recharts-pie",o);return i||null==l?(c.current=null,n.createElement(yE,{tabIndex:a,className:u})):n.createElement(vF,{zIndex:e.zIndex},n.createElement(sk,{dataKey:e.dataKey,nameKey:e.nameKey,sectors:l,stroke:e.stroke,strokeWidth:e.strokeWidth,fill:e.fill,name:e.name,hide:e.hide,tooltipType:e.tooltipType,id:t}),n.createElement(yE,{tabIndex:a,className:u},n.createElement(fk,{props:rk(rk({},r),{},{sectors:l}),previousSectorsRef:c,id:t})))}function gk(e){var t=CC(e,pk),{id:r}=t,i=ok(t,ek),o=FB(i);return n.createElement(fF,{id:r,type:"pie"},e=>n.createElement(n.Fragment,null,n.createElement(gF,{type:"pie",id:e,data:i.data,dataKey:i.dataKey,hide:i.hide,angleAxisId:0,radiusAxisId:0,name:i.name,nameKey:i.nameKey,tooltipType:i.tooltipType,legendType:i.legendType,fill:i.fill,cx:i.cx,cy:i.cy,startAngle:i.startAngle,endAngle:i.endAngle,paddingAngle:i.paddingAngle,minAngle:i.minAngle,innerRadius:i.innerRadius,outerRadius:i.outerRadius,cornerRadius:i.cornerRadius,presentationProps:o,maxRadius:t.maxRadius}),n.createElement(ak,ik({},i,{id:e})),n.createElement(mk,ik({},i,{id:e}))))}function yk(){return yk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},yk.apply(null,arguments)}function _k(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function vk(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?_k(Object(r),!0).forEach(function(t){xk(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):_k(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function xk(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function wk(e){return Array.isArray(e)&&yc(e[0])&&yc(e[1])?e.join(" ~ "):e}gk.displayName="Pie";var bk=e=>{var{separator:t=" : ",contentStyle:r={},itemStyle:i={},labelStyle:o={},payload:a,formatter:s,itemSorter:l,wrapperClassName:c,labelClassName:u,label:d,labelFormatter:h,accessibilityLayer:A=!1}=e,f=vk({margin:0,padding:10,backgroundColor:"#fff",border:"1px solid #ccc",whiteSpace:"nowrap"},r),p=vk({margin:0},o),m=!Bc(d),g=m?d:"",y=sc("recharts-default-tooltip",c),_=sc("recharts-tooltip-label",u);m&&h&&void 0!==a&&null!==a&&(g=h(d,a));var v=A?{role:"status","aria-live":"assertive"}:{};return n.createElement("div",yk({className:y,style:f},v),n.createElement("p",{className:_,style:p},n.isValidElement(g)?g:"".concat(g)),(()=>{if(a&&a.length){var e=(l?Id()(a,l):a).map((e,r)=>{if("none"===e.type)return null;var o=e.formatter||s||wk,{value:l,name:c}=e,u=l,d=c;if(o){var h=o(l,c,e,r,a);if(Array.isArray(h))[u,d]=h;else{if(null==h)return null;u=h}}var A=vk({display:"block",paddingTop:4,paddingBottom:4,color:e.color||"#000"},i);return n.createElement("li",{className:"recharts-tooltip-item",key:"tooltip-item-".concat(r),style:A},yc(d)?n.createElement("span",{className:"recharts-tooltip-item-name"},d):null,yc(d)?n.createElement("span",{className:"recharts-tooltip-item-separator"},t):null,n.createElement("span",{className:"recharts-tooltip-item-value"},u),n.createElement("span",{className:"recharts-tooltip-item-unit"},e.unit||""))});return n.createElement("ul",{className:"recharts-tooltip-item-list",style:{padding:0,margin:0}},e)}return null})())},Bk="recharts-tooltip-wrapper",Ck={visibility:"hidden"};function Ek(e){var{coordinate:t,translateX:r,translateY:n}=e;return sc(Bk,{["".concat(Bk,"-right")]:gc(r)&&t&&gc(t.x)&&r>=t.x,["".concat(Bk,"-left")]:gc(r)&&t&&gc(t.x)&&r<t.x,["".concat(Bk,"-bottom")]:gc(n)&&t&&gc(t.y)&&n>=t.y,["".concat(Bk,"-top")]:gc(n)&&t&&gc(t.y)&&n<t.y})}function Sk(e){var{allowEscapeViewBox:t,coordinate:r,key:n,offsetTopLeft:i,position:o,reverseDirection:a,tooltipDimension:s,viewBox:l,viewBoxDimension:c}=e;if(o&&gc(o[n]))return o[n];var u=r[n]-s-(i>0?i:0),d=r[n]+i;if(t[n])return a[n]?u:d;var h=l[n];return null==h?0:a[n]?u<h?Math.max(d,h):Math.max(u,h):null==c?0:d+s>h+c?Math.max(u,h):Math.max(d,h)}function Tk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Ik(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Tk(Object(r),!0).forEach(function(t){Fk(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Tk(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Fk(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class kk extends n.PureComponent{constructor(){super(...arguments),Fk(this,"state",{dismissed:!1,dismissedAtCoordinate:{x:0,y:0}}),Fk(this,"handleKeyDown",e=>{var t,r,n,i;"Escape"===e.key&&this.setState({dismissed:!0,dismissedAtCoordinate:{x:null!==(t=null===(r=this.props.coordinate)||void 0===r?void 0:r.x)&&void 0!==t?t:0,y:null!==(n=null===(i=this.props.coordinate)||void 0===i?void 0:i.y)&&void 0!==n?n:0}})})}componentDidMount(){document.addEventListener("keydown",this.handleKeyDown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeyDown)}componentDidUpdate(){var e,t;this.state.dismissed&&((null===(e=this.props.coordinate)||void 0===e?void 0:e.x)===this.state.dismissedAtCoordinate.x&&(null===(t=this.props.coordinate)||void 0===t?void 0:t.y)===this.state.dismissedAtCoordinate.y||(this.state.dismissed=!1))}render(){var{active:e,allowEscapeViewBox:t,animationDuration:r,animationEasing:i,children:o,coordinate:a,hasPayload:s,isAnimationActive:l,offset:c,position:u,reverseDirection:d,useTranslate3d:h,viewBox:A,wrapperStyle:f,lastBoundingBox:p,innerRef:m,hasPortalFromProps:g}=this.props,{cssClasses:y,cssProperties:_}=function(e){var t,r,n,{allowEscapeViewBox:i,coordinate:o,offsetTopLeft:a,position:s,reverseDirection:l,tooltipBox:c,useTranslate3d:u,viewBox:d}=e;return t=c.height>0&&c.width>0&&o?function(e){var{translateX:t,translateY:r,useTranslate3d:n}=e;return{transform:n?"translate3d(".concat(t,"px, ").concat(r,"px, 0)"):"translate(".concat(t,"px, ").concat(r,"px)")}}({translateX:r=Sk({allowEscapeViewBox:i,coordinate:o,key:"x",offsetTopLeft:a,position:s,reverseDirection:l,tooltipDimension:c.width,viewBox:d,viewBoxDimension:d.width}),translateY:n=Sk({allowEscapeViewBox:i,coordinate:o,key:"y",offsetTopLeft:a,position:s,reverseDirection:l,tooltipDimension:c.height,viewBox:d,viewBoxDimension:d.height}),useTranslate3d:u}):Ck,{cssProperties:t,cssClasses:Ek({translateX:r,translateY:n,coordinate:o})}}({allowEscapeViewBox:t,coordinate:a,offsetTopLeft:c,position:u,reverseDirection:d,tooltipBox:{height:p.height,width:p.width},useTranslate3d:h,viewBox:A}),v=g?{}:Ik(Ik({transition:l&&e?"transform ".concat(r,"ms ").concat(i):void 0},_),{},{pointerEvents:"none",visibility:!this.state.dismissed&&e&&s?"visible":"hidden",position:"absolute",top:0,left:0}),x=Ik(Ik({},v),{},{visibility:!this.state.dismissed&&e&&s?"visible":"hidden"},f);return n.createElement("div",{xmlns:"http://www.w3.org/1999/xhtml",tabIndex:-1,className:y,style:x,ref:m},o)}}var Pk=r(4332),Mk=r.n(Pk);function Ok(e,t,r){return!0===t?Mk()(e,r):"function"===typeof t?Mk()(e,t):e}function Lk(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],[t,r]=(0,n.useState)({height:0,left:0,top:0,width:0}),i=(0,n.useCallback)(e=>{if(null!=e){var n=e.getBoundingClientRect(),i={height:n.height,left:n.left,top:n.top,width:n.width};(Math.abs(i.height-t.height)>1||Math.abs(i.left-t.left)>1||Math.abs(i.top-t.top)>1||Math.abs(i.width-t.width)>1)&&r({height:i.height,left:i.left,top:i.top,width:i.width})}},[t.width,t.height,t.top,t.left,...e]);return[t,i]}var Dk=["x","y","top","left","width","height","className"];function Uk(){return Uk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},Uk.apply(null,arguments)}function Rk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function zk(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Nk=(e,t,r,n,i,o)=>"M".concat(e,",").concat(i,"v").concat(n,"M").concat(o,",").concat(t,"h").concat(r),jk=e=>{var{x:t=0,y:r=0,top:i=0,left:o=0,width:a=0,height:s=0,className:l}=e,c=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,Dk),u=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Rk(Object(r),!0).forEach(function(t){zk(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Rk(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({x:t,y:r,top:i,left:o,width:a,height:s},c);return gc(t)&&gc(r)&&gc(a)&&gc(s)&&gc(i)&&gc(o)?n.createElement("path",Uk({},PB(u),{className:sc("recharts-cross",l),d:Nk(t,r,a,s,i,o)})):null};function Qk(e){var{cx:t,cy:r,radius:n,startAngle:i,endAngle:o}=e;return{points:[xy(t,r,n,i),xy(t,r,n,o)],cx:t,cy:r,radius:n,startAngle:i,endAngle:o}}function Vk(e,t,r){if("horizontal"===e)return[{x:t.x,y:r.top},{x:t.x,y:r.top+r.height}];if("vertical"===e)return[{x:r.left,y:t.y},{x:r.left+r.width,y:t.y}];if(XE(t)){if("centric"===e){var{cx:n,cy:i,innerRadius:o,outerRadius:a,angle:s}=t,l=xy(n,i,o,s),c=xy(n,i,a,s);return[{x:l.x,y:l.y},{x:c.x,y:c.y}]}return Qk(t)}}function Hk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Gk(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Hk(Object(r),!0).forEach(function(t){Kk(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Hk(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Kk(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var Wk=()=>{var e=Sd(R_),t=Sd(rw),r=Sd($x);return $d(e&&r?Gk(Gk({},e),{},{scale:r}):void 0,t)};function qk(){return qk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},qk.apply(null,arguments)}function Zk(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function Xk(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Zk(Object(r),!0).forEach(function(t){Yk(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Zk(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function Yk(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Jk(e){var{cursor:t,cursorComp:r,cursorProps:i}=e;return(0,n.isValidElement)(t)?(0,n.cloneElement)(t,i):(0,n.createElement)(r,i)}function $k(e){var t,r,i,o,{coordinate:a,payload:s,index:l,offset:c,tooltipAxisBandSize:u,layout:d,cursor:h,tooltipEventType:A,chartName:f}=e,p=a,m=s,g=l;if(!h||!p||"ScatterChart"!==f&&"axis"!==A)return null;if("ScatterChart"===f)r=p,i=jk,o=Ey.cursorLine;else if("BarChart"===f)r=function(e,t,r,n){var i=n/2;return{stroke:"none",fill:"#ccc",x:"horizontal"===e?t.x-i:r.left+.5,y:"horizontal"===e?r.top+.5:t.y-i,width:"horizontal"===e?n:r.width-1,height:"horizontal"===e?r.height-1:n}}(d,p,c,u),i=tI,o=Ey.cursorRectangle;else if("radial"===d&&XE(p)){var{cx:y,cy:_,radius:v,startAngle:x,endAngle:w}=Qk(p);r={cx:y,cy:_,startAngle:x,endAngle:w,innerRadius:v,outerRadius:v},i=wI,o=Ey.cursorLine}else r={points:Vk(d,p,c)},i=lS,o=Ey.cursorLine;var b="object"===typeof h&&"className"in h?h.className:void 0,B=Xk(Xk(Xk(Xk({stroke:"#ccc",pointerEvents:"none"},c),r),kB(h)),{},{payload:m,payloadIndex:g,className:sc("recharts-tooltip-cursor",b)});return n.createElement(vF,{zIndex:null!==(t=e.zIndex)&&void 0!==t?t:o},n.createElement(Jk,{cursor:h,cursorComp:i,cursorProps:B}))}function eP(e){var t=Wk(),r=bh(),i=Sh(),o=Sd(hy);return null==t||null==r||null==i||null==o?null:n.createElement($k,qk({},e,{offset:r,layout:i,tooltipAxisBandSize:t,chartName:o}))}function tP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function rP(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?tP(Object(r),!0).forEach(function(t){nP(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):tP(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function nP(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function iP(e){return e.dataKey}var oP=[],aP={allowEscapeViewBox:{x:!1,y:!1},animationDuration:400,animationEasing:"ease",axisId:0,contentStyle:{},cursor:!0,filterNull:!0,includeHidden:!1,isAnimationActive:"auto",itemSorter:"name",itemStyle:{},labelStyle:{},offset:10,reverseDirection:{x:!1,y:!1},separator:" : ",trigger:"hover",useTranslate3d:!1,wrapperStyle:{}};function sP(e){var t,r,i=CC(e,aP),{active:o,allowEscapeViewBox:a,animationDuration:s,animationEasing:l,content:c,filterNull:u,isAnimationActive:d,offset:h,payloadUniqBy:A,position:f,reverseDirection:p,useTranslate3d:m,wrapperStyle:g,cursor:y,shared:_,trigger:v,defaultIndex:x,portal:w,axisId:b}=i,B=bd(),C="number"===typeof x?String(x):x;(0,n.useEffect)(()=>{B(Hu({shared:_,trigger:v,axisId:b,active:o,defaultIndex:C}))},[B,_,v,b,o,C]);var E=xh(),S=BB(),T=function(e){return Sd(t=>sx(t,e))}(_),{activeIndex:I,isActive:k}=null!==(t=Sd(e=>kw(e,T,v,C)))&&void 0!==t?t:{},P=Sd(e=>Fw(e,T,v,C)),M=Sd(e=>Iw(e,T,v,C)),O=Sd(e=>Tw(e,T,v,C)),L=P,D=(0,n.useContext)(nC),U=null!==(r=null!==o&&void 0!==o?o:k)&&void 0!==r&&r,[R,z]=Lk([L,U]),N="axis"===T?M:void 0;rC(T,v,O,N,I,U);var j=null!==w&&void 0!==w?w:D;if(null==j||null==E||null==T)return null;var Q=null!==L&&void 0!==L?L:oP;U||(Q=oP),u&&Q.length&&(Q=Ok(Q.filter(e=>null!=e.value&&(!0!==e.hide||i.includeHidden)),A,iP));var V=Q.length>0,H=n.createElement(kk,{allowEscapeViewBox:a,animationDuration:s,animationEasing:l,isAnimationActive:d,active:U,coordinate:O,hasPayload:V,offset:h,position:f,reverseDirection:p,useTranslate3d:m,viewBox:E,wrapperStyle:g,lastBoundingBox:R,innerRef:z,hasPortalFromProps:Boolean(w)},function(e,t){return n.isValidElement(e)?n.cloneElement(e,t):"function"===typeof e?n.createElement(e,t):n.createElement(bk,t)}(c,rP(rP({},i),{},{payload:Q,label:N,active:U,activeIndex:I,coordinate:O,accessibilityLayer:S})));return n.createElement(n.Fragment,null,(0,F.createPortal)(H,j),U&&n.createElement(eP,{cursor:y,tooltipEventType:T,coordinate:O,payload:Q,index:I}))}function lP(){return lP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},lP.apply(null,arguments)}function cP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function uP(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var dP=32,hP={align:"center",iconSize:14,inactiveColor:"#ccc",layout:"horizontal",verticalAlign:"middle"};function AP(e){var t,{data:r,iconType:i,inactiveColor:o}=e,a=16,s=dP/6,l=dP/3,c=r.inactive?o:r.color,u=null!==i&&void 0!==i?i:r.type;if("none"===u)return null;if("plainline"===u)return n.createElement("line",{strokeWidth:4,fill:"none",stroke:c,strokeDasharray:null===(t=r.payload)||void 0===t?void 0:t.strokeDasharray,x1:0,y1:a,x2:dP,y2:a,className:"recharts-legend-icon"});if("line"===u)return n.createElement("path",{strokeWidth:4,fill:"none",stroke:c,d:"M0,".concat(a,"h").concat(l,"\n            A").concat(s,",").concat(s,",0,1,1,").concat(2*l,",").concat(a,"\n            H").concat(dP,"M").concat(2*l,",").concat(a,"\n            A").concat(s,",").concat(s,",0,1,1,").concat(l,",").concat(a),className:"recharts-legend-icon"});if("rect"===u)return n.createElement("path",{stroke:"none",fill:c,d:"M0,".concat(4,"h").concat(dP,"v").concat(24,"h").concat(-32,"z"),className:"recharts-legend-icon"});if(n.isValidElement(r.legendIcon)){var d=function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?cP(Object(r),!0).forEach(function(t){uP(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):cP(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}({},r);return delete d.legendIcon,n.cloneElement(r.legendIcon,d)}return n.createElement(JI,{fill:c,cx:a,cy:a,size:dP,sizeType:"diameter",type:u})}function fP(e){var{payload:t,iconSize:r,layout:i,formatter:o,inactiveColor:a,iconType:s}=e,l={x:0,y:0,width:dP,height:dP},c={display:"horizontal"===i?"inline-block":"block",marginRight:10},u={display:"inline-block",verticalAlign:"middle",marginRight:4};return t.map((t,i)=>{var d=t.formatter||o,h=sc({"recharts-legend-item":!0,["legend-item-".concat(i)]:!0,inactive:t.inactive});if("none"===t.type)return null;var A=t.inactive?a:t.color,f=d?d(t.value,t,i):t.value;return n.createElement("li",lP({className:h,style:c,key:"legend-item-".concat(i)},YE(e,t,i)),n.createElement(LB,{width:r,height:r,viewBox:l,style:u,"aria-label":"".concat(f," legend icon")},n.createElement(AP,{data:t,iconType:s,inactiveColor:a})),n.createElement("span",{className:"recharts-legend-item-text",style:{color:A}},f))})}var pP=e=>{var t=CC(e,hP),{payload:r,layout:i,align:o}=t;if(!r||!r.length)return null;var a={padding:0,margin:0,textAlign:"horizontal"===i?o:"left"};return n.createElement("ul",{className:"recharts-default-legend",style:a},n.createElement(fP,lP({},t,{payload:r})))};var mP=["contextPayload"];function gP(){return gP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},gP.apply(null,arguments)}function yP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function _P(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?yP(Object(r),!0).forEach(function(t){vP(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):yP(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function vP(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function xP(e){return e.value}function wP(e){var{contextPayload:t}=e,r=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,mP),i=Ok(t,e.payloadUniqBy,xP),o=_P(_P({},r),{},{payload:i});return n.isValidElement(e.content)?n.cloneElement(e.content,o):"function"===typeof e.content?n.createElement(e.content,o):n.createElement(pP,o)}function bP(e){var t=bd();return(0,n.useEffect)(()=>{t(bb(e))},[t,e]),null}function BP(e){var t=bd();return(0,n.useEffect)(()=>(t(wb(e)),()=>{t(wb({width:0,height:0}))}),[t,e]),null}var CP={align:"center",iconSize:14,itemSorter:"value",layout:"horizontal",verticalAlign:"bottom"};function EP(e){var t=CC(e,CP),r=Sd(kd),i=(0,n.useContext)(iC),o=Sd(e=>e.layout.margin),{width:a,height:s,wrapperStyle:l,portal:c}=t,[u,d]=Lk([r]),h=Bh(),A=Ch();if(null==h||null==A)return null;var f=h-((null===o||void 0===o?void 0:o.left)||0)-((null===o||void 0===o?void 0:o.right)||0),p=function(e,t,r,n){return"vertical"===e&&gc(t)?{height:t}:"horizontal"===e?{width:r||n}:null}(t.layout,s,a,f),m=c?l:_P(_P({position:"absolute",width:(null===p||void 0===p?void 0:p.width)||a||"auto",height:(null===p||void 0===p?void 0:p.height)||s||"auto"},function(e,t,r,n,i,o){var a,s,{layout:l,align:c,verticalAlign:u}=t;return e&&(void 0!==e.left&&null!==e.left||void 0!==e.right&&null!==e.right)||(a="center"===c&&"vertical"===l?{left:((n||0)-o.width)/2}:"right"===c?{right:r&&r.right||0}:{left:r&&r.left||0}),e&&(void 0!==e.top&&null!==e.top||void 0!==e.bottom&&null!==e.bottom)||(s="middle"===u?{top:((i||0)-o.height)/2}:"bottom"===u?{bottom:r&&r.bottom||0}:{top:r&&r.top||0}),_P(_P({},a),s)}(l,t,o,h,A,u)),l),g=null!==c&&void 0!==c?c:i;if(null==g||null==r)return null;var y=n.createElement("div",{className:"recharts-legend-wrapper",style:m,ref:d},n.createElement(bP,{layout:t.layout,align:t.align,verticalAlign:t.verticalAlign,itemSorter:t.itemSorter}),!c&&n.createElement(BP,{width:u.width,height:u.height}),n.createElement(wP,gP({},t,p,{margin:o,chartWidth:h,chartHeight:A,contextPayload:r})));return(0,F.createPortal)(y,g)}function SP(){return SP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},SP.apply(null,arguments)}EP.displayName="Legend";var TP={accessibilityLayer:!0,barCategoryGap:"10%",barGap:4,layout:"horizontal",margin:{top:5,right:5,bottom:5,left:5},responsive:!1,reverseStackOrder:!1,stackOffset:"none",syncMethod:"index"},IP=(0,n.forwardRef)(function(e,t){var r,i=CC(e.categoricalChartProps,TP),{chartName:o,defaultTooltipEventType:a,validateTooltipEventTypes:s,tooltipPayloadSearcher:l,categoricalChartProps:c}=e,u={chartName:o,defaultTooltipEventType:a,validateTooltipEventTypes:s,tooltipPayloadSearcher:l,eventEmitter:void 0};return n.createElement(pB,{preloadedState:{options:u},reduxStoreName:null!==(r=c.id)&&void 0!==r?r:o},n.createElement(mB,{chartData:c.data}),n.createElement(xB,{layout:i.layout,margin:i.margin}),n.createElement(wB,{baseValue:i.baseValue,accessibilityLayer:i.accessibilityLayer,barCategoryGap:i.barCategoryGap,maxBarSize:i.maxBarSize,stackOffset:i.stackOffset,barGap:i.barGap,barSize:i.barSize,syncId:i.syncId,syncMethod:i.syncMethod,className:i.className,reverseStackOrder:i.reverseStackOrder}),n.createElement(wC,SP({},i,{ref:t})))}),FP=["axis","item"],kP=(0,n.forwardRef)((e,t)=>n.createElement(IP,{chartName:"BarChart",defaultTooltipEventType:"axis",validateTooltipEventTypes:FP,tooltipPayloadSearcher:Kc,categoricalChartProps:e,ref:t}));function PP(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}class MP{static create(e){return new MP(e)}constructor(e){this.scale=e}get domain(){return this.scale.domain}get range(){return this.scale.range}get rangeMin(){return this.range()[0]}get rangeMax(){return this.range()[1]}get bandwidth(){return this.scale.bandwidth}apply(e){var{bandAware:t,position:r}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(void 0!==e){if(r)switch(r){case"start":default:return this.scale(e);case"middle":var n=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+n;case"end":var i=this.bandwidth?this.bandwidth():0;return this.scale(e)+i}if(t){var o=this.bandwidth?this.bandwidth()/2:0;return this.scale(e)+o}return this.scale(e)}}isInRange(e){var t=this.range(),r=t[0],n=t[t.length-1];return r<=n?e>=r&&e<=n:e>=n&&e<=r}}PP(MP,"EPS",1e-4);function OP(e,t){if(t<1)return[];if(1===t)return e;for(var r=[],n=0;n<e.length;n+=t){var i=e[n];void 0!==i&&r.push(i)}return r}function LP(e,t,r){return function(e){var{width:t,height:r}=e,n=function(e){return(e%180+180)%180}(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0),i=n*Math.PI/180,o=Math.atan(r/t),a=i>o&&i<Math.PI-o?r/Math.sin(i):t/Math.cos(i);return Math.abs(a)}({width:e.width+t.width,height:e.height+t.height},r)}function DP(e,t,r,n,i){if(e*t<e*n||e*t>e*i)return!1;var o=r();return e*(t-e*o/2-n)>=0&&e*(t+e*o/2-i)<=0}function UP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function RP(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?UP(Object(r),!0).forEach(function(t){zP(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):UP(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function zP(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function NP(e,t,r){var n,{tick:i,ticks:o,viewBox:a,minTickGap:s,orientation:l,interval:c,tickFormatter:u,unit:d,angle:h}=e;if(!o||!o.length||!i)return[];if(gc(c)||nB)return null!==(n=function(e,t){return OP(e,t+1)}(o,gc(c)?c:0))&&void 0!==n?n:[];var A=[],f="top"===l||"bottom"===l?"width":"height",p=d&&"width"===f?yS(d,{fontSize:t,letterSpacing:r}):{width:0,height:0},m=(e,n)=>{var i="function"===typeof u?u(e.value,n):e.value;return"width"===f?LP(yS(i,{fontSize:t,letterSpacing:r}),p,h):yS(i,{fontSize:t,letterSpacing:r})[f]},g=o.length>=2?fc(o[1].coordinate-o[0].coordinate):1,y=function(e,t,r){var n="width"===r,{x:i,y:o,width:a,height:s}=e;return 1===t?{start:n?i:o,end:n?i+a:o+s}:{start:n?i+a:o+s,end:n?i:o}}(a,g,f);return"equidistantPreserveStart"===c?function(e,t,r,n,i){for(var o,a=(n||[]).slice(),{start:s,end:l}=t,c=0,u=1,d=s,h=function(){var t=null===n||void 0===n?void 0:n[c];if(void 0===t)return{v:OP(n,u)};var o,a=c,h=()=>(void 0===o&&(o=r(t,a)),o),A=t.coordinate,f=0===c||DP(e,A,h,d,l);f||(c=0,d=s,u+=1),f&&(d=A+e*(h()/2+i),c+=u)};u<=a.length;)if(o=h())return o.v;return[]}(g,y,m,o,s):"equidistantPreserveEnd"===c?function(e,t,r,n,i){var o=(n||[]).slice().length;if(0===o)return[];for(var{start:a,end:s}=t,l=1;l<=o;l++){for(var c=(o-1)%l,u=a,d=!0,h=function(){var t,o=n[A],a=A,l=()=>(void 0===t&&(t=r(o,a)),t),h=o.coordinate,f=A===c||DP(e,h,l,u,s);if(!f)return d=!1,1;f&&(u=h+e*(l()/2+i))},A=c;A<o&&!h();A+=l);if(d){for(var f=[],p=c;p<o;p+=l)f.push(n[p]);return f}}return[]}(g,y,m,o,s):(A="preserveStart"===c||"preserveStartEnd"===c?function(e,t,r,n,i,o){var a=(n||[]).slice(),s=a.length,{start:l,end:c}=t;if(o){var u=n[s-1],d=r(u,s-1),h=e*(u.coordinate+e*d/2-c);a[s-1]=u=RP(RP({},u),{},{tickCoord:h>0?u.coordinate-h*e:u.coordinate}),null!=u.tickCoord&&DP(e,u.tickCoord,()=>d,l,c)&&(c=u.tickCoord-e*(d/2+i),a[s-1]=RP(RP({},u),{},{isShow:!0}))}for(var A=o?s-1:s,f=function(t){var n,o=a[t],s=()=>(void 0===n&&(n=r(o,t)),n);if(0===t){var u=e*(o.coordinate-e*s()/2-l);a[t]=o=RP(RP({},o),{},{tickCoord:u<0?o.coordinate-u*e:o.coordinate})}else a[t]=o=RP(RP({},o),{},{tickCoord:o.coordinate});null!=o.tickCoord&&DP(e,o.tickCoord,s,l,c)&&(l=o.tickCoord+e*(s()/2+i),a[t]=RP(RP({},o),{},{isShow:!0}))},p=0;p<A;p++)f(p);return a}(g,y,m,o,s,"preserveStartEnd"===c):function(e,t,r,n,i){for(var o=(n||[]).slice(),a=o.length,{start:s}=t,{end:l}=t,c=function(t){var n,c=o[t],u=()=>(void 0===n&&(n=r(c,t)),n);if(t===a-1){var d=e*(c.coordinate+e*u()/2-l);o[t]=c=RP(RP({},c),{},{tickCoord:d>0?c.coordinate-d*e:c.coordinate})}else o[t]=c=RP(RP({},c),{},{tickCoord:c.coordinate});null!=c.tickCoord&&DP(e,c.tickCoord,u,s,l)&&(l=c.tickCoord-e*(u()/2+i),o[t]=RP(RP({},c),{},{isShow:!0}))},u=a-1;u>=0;u--)c(u);return o}(g,y,m,o,s),A.filter(e=>e.isShow))}var jP=["axisLine","width","height","className","hide","ticks","axisType"];function QP(){return QP=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},QP.apply(null,arguments)}function VP(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function HP(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?VP(Object(r),!0).forEach(function(t){GP(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):VP(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function GP(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var KP={x:0,y:0,width:0,height:0,viewBox:{x:0,y:0,width:0,height:0},orientation:"bottom",ticks:[],stroke:"#666",tickLine:!0,axisLine:!0,tick:!0,mirror:!1,minTickGap:5,tickSize:6,tickMargin:2,interval:"preserveEnd",zIndex:Ey.axis};function WP(e){var{x:t,y:r,width:i,height:o,orientation:a,mirror:s,axisLine:l,otherSvgProps:c}=e;if(!l)return null;var u=HP(HP(HP({},c),FB(l)),{},{fill:"none"});if("top"===a||"bottom"===a){var d=+("top"===a&&!s||"bottom"===a&&s);u=HP(HP({},u),{},{x1:t,y1:r+d*o,x2:t+i,y2:r+d*o})}else{var h=+("left"===a&&!s||"right"===a&&s);u=HP(HP({},u),{},{x1:t+h*i,y1:r,x2:t+h*i,y2:r+o})}return n.createElement("line",QP({},u,{className:sc("recharts-cartesian-axis-line",dc()(l,"className"))}))}function qP(e){var t,{option:r,tickProps:i,value:o}=e,a=sc(i.className,"recharts-cartesian-axis-tick-value");if(n.isValidElement(r))t=n.cloneElement(r,HP(HP({},i),{},{className:a}));else if("function"===typeof r)t=r(HP(HP({},i),{},{className:a}));else{var s="recharts-cartesian-axis-tick-value";"boolean"!==typeof r&&(s=sc(s,null===r||void 0===r?void 0:r.className)),t=n.createElement(GS,QP({},i,{className:s}),o)}return t}var ZP=(0,n.forwardRef)((e,t)=>{var{ticks:r=[],tick:i,tickLine:o,stroke:a,tickFormatter:s,unit:l,padding:c,tickTextProps:u,orientation:d,mirror:h,x:A,y:f,width:p,height:m,tickSize:g,tickMargin:y,fontSize:_,letterSpacing:v,getTicksConfig:x,events:w,axisType:b}=e,B=NP(HP(HP({},x),{},{ticks:r}),_,v),C=function(e,t){switch(e){case"left":return t?"start":"end";case"right":return t?"end":"start";default:return"middle"}}(d,h),E=function(e,t){switch(e){case"left":case"right":return"middle";case"top":return t?"start":"end";default:return t?"end":"start"}}(d,h),S=FB(x),T=kB(i),I={};"object"===typeof o&&(I=o);var F=HP(HP({},S),{},{fill:"none"},I),k=B.map(e=>HP({entry:e},function(e,t,r,n,i,o,a,s,l){var c,u,d,h,A,f,p=s?-1:1,m=e.tickSize||a,g=gc(e.tickCoord)?e.tickCoord:e.coordinate;switch(o){case"top":c=u=e.coordinate,f=(d=(h=r+ +!s*i)-p*m)-p*l,A=g;break;case"left":d=h=e.coordinate,A=(c=(u=t+ +!s*n)-p*m)-p*l,f=g;break;case"right":d=h=e.coordinate,A=(c=(u=t+ +s*n)+p*m)+p*l,f=g;break;default:c=u=e.coordinate,f=(d=(h=r+ +s*i)+p*m)+p*l,A=g}return{line:{x1:c,y1:d,x2:u,y2:h},tick:{x:A,y:f}}}(e,A,f,p,m,d,g,h,y))),P=k.map(e=>{var{entry:t,line:r}=e;return n.createElement(yE,{className:"recharts-cartesian-axis-tick",key:"tick-".concat(t.value,"-").concat(t.coordinate,"-").concat(t.tickCoord)},o&&n.createElement("line",QP({},F,r,{className:sc("recharts-cartesian-axis-tick-line",dc()(o,"className"))})))}),M=k.map((e,t)=>{var{entry:r,tick:o}=e,d=HP(HP(HP(HP({textAnchor:C,verticalAnchor:E},S),{},{stroke:"none",fill:a},T),o),{},{index:t,payload:r,visibleTicksCount:B.length,tickFormatter:s,padding:c},u);return n.createElement(yE,QP({className:"recharts-cartesian-axis-tick-label",key:"tick-label-".concat(r.value,"-").concat(r.coordinate,"-").concat(r.tickCoord)},YE(w,r,t)),i&&n.createElement(qP,{option:i,tickProps:d,value:"".concat("function"===typeof s?s(r.value,t):r.value).concat(l||"")}))});return n.createElement("g",{className:"recharts-cartesian-axis-ticks recharts-".concat(b,"-ticks")},M.length>0&&n.createElement(vF,{zIndex:Ey.label},n.createElement("g",{className:"recharts-cartesian-axis-tick-labels recharts-".concat(b,"-tick-labels"),ref:t},M)),P.length>0&&n.createElement("g",{className:"recharts-cartesian-axis-tick-lines recharts-".concat(b,"-tick-lines")},P))}),XP=(0,n.forwardRef)((e,t)=>{var{axisLine:r,width:i,height:o,className:a,hide:s,ticks:l,axisType:c}=e,u=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,jP),[d,h]=(0,n.useState)(""),[A,f]=(0,n.useState)(""),p=(0,n.useRef)(null);(0,n.useImperativeHandle)(t,()=>({getCalculatedWidth:()=>{var t;return(e=>{var{ticks:t,label:r,labelGapWithTick:n=5,tickSize:i=0,tickMargin:o=0}=e,a=0;if(t){Array.from(t).forEach(e=>{if(e){var t=e.getBoundingClientRect();t.width>a&&(a=t.width)}});var s=r?r.getBoundingClientRect().width:0,l=a+(i+o)+s+(r?n:0);return Math.round(l)}return 0})({ticks:p.current,label:null===(t=e.labelRef)||void 0===t?void 0:t.current,labelGapWithTick:5,tickSize:e.tickSize,tickMargin:e.tickMargin})}}));var m=(0,n.useCallback)(e=>{if(e){var t=e.getElementsByClassName("recharts-cartesian-axis-tick-value");p.current=t;var r=t[0];if(r){var n=window.getComputedStyle(r),i=n.fontSize,o=n.letterSpacing;i===d&&o===A||(h(i),f(o))}}},[d,A]);return s||null!=i&&i<=0||null!=o&&o<=0?null:n.createElement(vF,{zIndex:e.zIndex},n.createElement(yE,{className:sc("recharts-cartesian-axis",a)},n.createElement(WP,{x:e.x,y:e.y,width:i,height:o,orientation:e.orientation,mirror:e.mirror,axisLine:r,otherSvgProps:FB(e)}),n.createElement(ZP,{ref:m,axisType:c,events:u,fontSize:d,getTicksConfig:e,height:e.height,letterSpacing:A,mirror:e.mirror,orientation:e.orientation,padding:e.padding,stroke:e.stroke,tick:e.tick,tickFormatter:e.tickFormatter,tickLine:e.tickLine,tickMargin:e.tickMargin,tickSize:e.tickSize,tickTextProps:e.tickTextProps,ticks:l,unit:e.unit,width:e.width,x:e.x,y:e.y}),n.createElement(IF,{x:e.x,y:e.y,width:e.width,height:e.height,lowerWidth:e.width,upperWidth:e.width},n.createElement(zF,{label:e.label,labelRef:e.labelRef}),e.children)))}),YP=n.forwardRef((e,t)=>{var r=CC(e,KP);return n.createElement(XP,QP({},r,{ref:t}))});YP.displayName="CartesianAxis";var JP=["x1","y1","x2","y2","key"],$P=["offset"],eM=["xAxisId","yAxisId"],tM=["xAxisId","yAxisId"];function rM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function nM(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?rM(Object(r),!0).forEach(function(t){iM(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):rM(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function iM(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function oM(){return oM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},oM.apply(null,arguments)}function aM(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var sM=e=>{var{fill:t}=e;if(!t||"none"===t)return null;var{fillOpacity:r,x:i,y:o,width:a,height:s,ry:l}=e;return n.createElement("rect",{x:i,y:o,ry:l,width:a,height:s,stroke:"none",fill:t,fillOpacity:r,className:"recharts-cartesian-grid-bg"})};function lM(e){var t,{option:r,lineItemProps:i}=e;if(n.isValidElement(r))t=n.cloneElement(r,i);else if("function"===typeof r)t=r(i);else{var o,{x1:a,y1:s,x2:l,y2:c,key:u}=i,d=null!==(o=FB(aM(i,JP)))&&void 0!==o?o:{},{offset:h}=d,A=aM(d,$P);t=n.createElement("line",oM({},A,{x1:a,y1:s,x2:l,y2:c,fill:"none",key:u}))}return t}function cM(e){var{x:t,width:r,horizontal:i=!0,horizontalPoints:o}=e;if(!i||!o||!o.length)return null;var{xAxisId:a,yAxisId:s}=e,l=aM(e,eM),c=o.map((e,o)=>{var a=nM(nM({},l),{},{x1:t,y1:e,x2:t+r,y2:e,key:"line-".concat(o),index:o});return n.createElement(lM,{key:"line-".concat(o),option:i,lineItemProps:a})});return n.createElement("g",{className:"recharts-cartesian-grid-horizontal"},c)}function uM(e){var{y:t,height:r,vertical:i=!0,verticalPoints:o}=e;if(!i||!o||!o.length)return null;var{xAxisId:a,yAxisId:s}=e,l=aM(e,tM),c=o.map((e,o)=>{var a=nM(nM({},l),{},{x1:e,y1:t,x2:e,y2:t+r,key:"line-".concat(o),index:o});return n.createElement(lM,{option:i,lineItemProps:a,key:"line-".concat(o)})});return n.createElement("g",{className:"recharts-cartesian-grid-vertical"},c)}function dM(e){var{horizontalFill:t,fillOpacity:r,x:i,y:o,width:a,height:s,horizontalPoints:l,horizontal:c=!0}=e;if(!c||!t||!t.length||null==l)return null;var u=l.map(e=>Math.round(e+o-o)).sort((e,t)=>e-t);o!==u[0]&&u.unshift(0);var d=u.map((e,l)=>{var c=!u[l+1]?o+s-e:u[l+1]-e;if(c<=0)return null;var d=l%t.length;return n.createElement("rect",{key:"react-".concat(l),y:e,x:i,height:c,width:a,stroke:"none",fill:t[d],fillOpacity:r,className:"recharts-cartesian-grid-bg"})});return n.createElement("g",{className:"recharts-cartesian-gridstripes-horizontal"},d)}function hM(e){var{vertical:t=!0,verticalFill:r,fillOpacity:i,x:o,y:a,width:s,height:l,verticalPoints:c}=e;if(!t||!r||!r.length)return null;var u=c.map(e=>Math.round(e+o-o)).sort((e,t)=>e-t);o!==u[0]&&u.unshift(0);var d=u.map((e,t)=>{var c=!u[t+1]?o+s-e:u[t+1]-e;if(c<=0)return null;var d=t%r.length;return n.createElement("rect",{key:"react-".concat(t),x:e,y:a,width:c,height:l,stroke:"none",fill:r[d],fillOpacity:i,className:"recharts-cartesian-grid-bg"})});return n.createElement("g",{className:"recharts-cartesian-gridstripes-vertical"},d)}var AM=(e,t)=>{var{xAxis:r,width:n,height:i,offset:o}=e;return Hd(NP(nM(nM(nM({},KP),r),{},{ticks:Gd(r,!0),viewBox:{x:0,y:0,width:n,height:i}})),o.left,o.left+o.width,t)},fM=(e,t)=>{var{yAxis:r,width:n,height:i,offset:o}=e;return Hd(NP(nM(nM(nM({},KP),r),{},{ticks:Gd(r,!0),viewBox:{x:0,y:0,width:n,height:i}})),o.top,o.top+o.height,t)},pM={horizontal:!0,vertical:!0,horizontalPoints:[],verticalPoints:[],stroke:"#ccc",fill:"none",verticalFill:[],horizontalFill:[],xAxisId:0,yAxisId:0,syncWithTicks:!1,zIndex:Ey.grid};function mM(e){var t=Bh(),r=Ch(),i=bh(),o=nM(nM({},CC(e,pM)),{},{x:gc(e.x)?e.x:i.left,y:gc(e.y)?e.y:i.top,width:gc(e.width)?e.width:i.width,height:gc(e.height)?e.height:i.height}),{xAxisId:a,yAxisId:s,x:l,y:c,width:u,height:d,syncWithTicks:h,horizontalValues:A,verticalValues:f}=o,p=gh(),m=Sd(e=>Jv(e,"xAxis",a,p)),g=Sd(e=>Jv(e,"yAxis",s,p));if(!Dc(u)||!Dc(d)||!gc(l)||!gc(c))return null;var y=o.verticalCoordinatesGenerator||AM,_=o.horizontalCoordinatesGenerator||fM,{horizontalPoints:v,verticalPoints:x}=o;if((!v||!v.length)&&"function"===typeof _){var w=A&&A.length,b=_({yAxis:g?nM(nM({},g),{},{ticks:w?A:g.ticks}):void 0,width:null!==t&&void 0!==t?t:u,height:null!==r&&void 0!==r?r:d,offset:i},!!w||h);Tc(Array.isArray(b),"horizontalCoordinatesGenerator should return Array but instead it returned [".concat(typeof b,"]")),Array.isArray(b)&&(v=b)}if((!x||!x.length)&&"function"===typeof y){var B=f&&f.length,C=y({xAxis:m?nM(nM({},m),{},{ticks:B?f:m.ticks}):void 0,width:null!==t&&void 0!==t?t:u,height:null!==r&&void 0!==r?r:d,offset:i},!!B||h);Tc(Array.isArray(C),"verticalCoordinatesGenerator should return Array but instead it returned [".concat(typeof C,"]")),Array.isArray(C)&&(x=C)}return n.createElement(vF,{zIndex:o.zIndex},n.createElement("g",{className:"recharts-cartesian-grid"},n.createElement(sM,{fill:o.fill,fillOpacity:o.fillOpacity,x:o.x,y:o.y,width:o.width,height:o.height,ry:o.ry}),n.createElement(dM,oM({},o,{horizontalPoints:v})),n.createElement(hM,oM({},o,{verticalPoints:x})),n.createElement(cM,oM({},o,{offset:i,horizontalPoints:v,xAxis:m,yAxis:g})),n.createElement(uM,oM({},o,{offset:i,verticalPoints:x,xAxis:m,yAxis:g}))))}mM.displayName="CartesianGrid";var gM=["domain","range"],yM=["domain","range"];function _M(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function vM(e,t){return e===t||!(!Array.isArray(e)||2!==e.length||!Array.isArray(t)||2!==t.length)&&(e[0]===t[0]&&e[1]===t[1])}function xM(e,t){if(e===t)return!0;var{domain:r,range:n}=e,i=_M(e,gM),{domain:o,range:a}=t,s=_M(t,yM);return!!vM(r,o)&&(!!vM(n,a)&&_B(i,s))}var wM=["dangerouslySetInnerHTML","ticks","scale"],bM=["id","scale"];function BM(){return BM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},BM.apply(null,arguments)}function CM(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function EM(e){var t=bd(),r=(0,n.useRef)(null);return(0,n.useLayoutEffect)(()=>{null===r.current?t(Gw(e)):r.current!==e&&t(Kw({prev:r.current,next:e})),r.current=e},[e,t]),(0,n.useLayoutEffect)(()=>()=>{r.current&&(t(Ww(r.current)),r.current=null)},[t]),null}var SM=e=>{var{xAxisId:t,className:r}=e,i=Sd(ph),o=gh(),a="xAxis",s=Sd(e=>$v(e,a,t,o)),l=Sd(e=>jv(e,t)),c=Sd(e=>Hv(e,t)),u=Sd(e=>u_(e,t));if(null==l||null==c||null==u)return null;var{dangerouslySetInnerHTML:d,ticks:h,scale:A}=e,f=CM(e,wM),{id:p,scale:m}=u,g=CM(u,bM);return n.createElement(YP,BM({},f,g,{x:c.x,y:c.y,width:l.width,height:l.height,className:sc("recharts-".concat(a," ").concat(a),r),viewBox:i,ticks:s,axisType:a}))},TM={allowDataOverflow:c_.allowDataOverflow,allowDecimals:c_.allowDecimals,allowDuplicatedCategory:c_.allowDuplicatedCategory,angle:c_.angle,axisLine:KP.axisLine,height:c_.height,hide:!1,includeHidden:c_.includeHidden,interval:c_.interval,minTickGap:c_.minTickGap,mirror:c_.mirror,orientation:c_.orientation,padding:c_.padding,reversed:c_.reversed,scale:c_.scale,tick:c_.tick,tickCount:c_.tickCount,tickLine:KP.tickLine,tickSize:KP.tickSize,type:c_.type,xAxisId:0},IM=e=>{var t=CC(e,TM);return n.createElement(n.Fragment,null,n.createElement(EM,{allowDataOverflow:t.allowDataOverflow,allowDecimals:t.allowDecimals,allowDuplicatedCategory:t.allowDuplicatedCategory,angle:t.angle,dataKey:t.dataKey,domain:t.domain,height:t.height,hide:t.hide,id:t.xAxisId,includeHidden:t.includeHidden,interval:t.interval,minTickGap:t.minTickGap,mirror:t.mirror,name:t.name,orientation:t.orientation,padding:t.padding,reversed:t.reversed,scale:t.scale,tick:t.tick,tickCount:t.tickCount,tickFormatter:t.tickFormatter,ticks:t.ticks,type:t.type,unit:t.unit}),n.createElement(SM,t))},FM=n.memo(IM,xM);FM.displayName="XAxis";var kM=["dangerouslySetInnerHTML","ticks","scale"],PM=["id","scale"];function MM(){return MM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},MM.apply(null,arguments)}function OM(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function LM(e){var t=bd(),r=(0,n.useRef)(null);return(0,n.useLayoutEffect)(()=>{null===r.current?t(qw(e)):r.current!==e&&t(Zw({prev:r.current,next:e})),r.current=e},[e,t]),(0,n.useLayoutEffect)(()=>()=>{r.current&&(t(Xw(r.current)),r.current=null)},[t]),null}var DM=e=>{var{yAxisId:t,className:r,width:i,label:o}=e,a=(0,n.useRef)(null),s=(0,n.useRef)(null),l=Sd(ph),c=gh(),u=bd(),d="yAxis",h=Sd(e=>Kv(e,t)),A=Sd(e=>Gv(e,t)),f=Sd(e=>$v(e,d,t,c)),p=Sd(e=>A_(e,t));if((0,n.useLayoutEffect)(()=>{if("auto"===i&&h&&!MF(o)&&!(0,n.isValidElement)(o)&&null!=p){var e=a.current;if(e){var r=e.getCalculatedWidth();Math.round(h.width)!==Math.round(r)&&u(eb({id:t,width:r}))}}},[f,h,u,o,t,i,p]),null==h||null==A||null==p)return null;var{dangerouslySetInnerHTML:m,ticks:g,scale:y}=e,_=OM(e,kM),{id:v,scale:x}=p,w=OM(p,PM);return n.createElement(YP,MM({},_,w,{ref:a,labelRef:s,x:A.x,y:A.y,tickTextProps:"auto"===i?{width:void 0}:{width:i},width:h.width,height:h.height,className:sc("recharts-".concat(d," ").concat(d),r),viewBox:l,ticks:f,axisType:d}))},UM={allowDataOverflow:h_.allowDataOverflow,allowDecimals:h_.allowDecimals,allowDuplicatedCategory:h_.allowDuplicatedCategory,angle:h_.angle,axisLine:KP.axisLine,hide:!1,includeHidden:h_.includeHidden,interval:h_.interval,minTickGap:h_.minTickGap,mirror:h_.mirror,orientation:h_.orientation,padding:h_.padding,reversed:h_.reversed,scale:h_.scale,tick:h_.tick,tickCount:h_.tickCount,tickLine:KP.tickLine,tickSize:KP.tickSize,type:h_.type,width:h_.width,yAxisId:0},RM=e=>{var t=CC(e,UM);return n.createElement(n.Fragment,null,n.createElement(LM,{interval:t.interval,id:t.yAxisId,scale:t.scale,type:t.type,domain:t.domain,allowDataOverflow:t.allowDataOverflow,dataKey:t.dataKey,allowDuplicatedCategory:t.allowDuplicatedCategory,allowDecimals:t.allowDecimals,tickCount:t.tickCount,padding:t.padding,includeHidden:t.includeHidden,reversed:t.reversed,ticks:t.ticks,width:t.width,orientation:t.orientation,mirror:t.mirror,hide:t.hide,unit:t.unit,name:t.name,angle:t.angle,minTickGap:t.minTickGap,tick:t.tick,tickFormatter:t.tickFormatter}),n.createElement(DM,t))},zM=n.memo(RM,xM);zM.displayName="YAxis";var NM="Invariant failed";function jM(){return jM=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},jM.apply(null,arguments)}function QM(e){return n.createElement(iF,jM({shapeType:"rectangle",activeClassName:"recharts-active-bar"},e))}var VM=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return(r,n)=>{if(gc(e))return e;var i=gc(r)||Bc(r);return i?e(r,n):(i||function(e){if(!e)throw new Error(NM)}(!1,"minPointSize callback function received a value with type of ".concat(typeof r,". Currently only numbers or null/undefined are supported.")),t)}},HM=["children"];var GM={data:[],xAxisId:"xAxis-0",yAxisId:"yAxis-0",dataPointFormatter:()=>({x:0,y:0,value:0}),errorBarOffset:0},KM=(0,n.createContext)(GM);function WM(e){var{children:t}=e,r=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,HM);return n.createElement(KM.Provider,{value:r},t)}function qM(e,t){var r,n,i=Sd(t=>d_(t,e)),o=Sd(e=>f_(e,t)),a=null!==(r=null===i||void 0===i?void 0:i.allowDataOverflow)&&void 0!==r?r:c_.allowDataOverflow,s=null!==(n=null===o||void 0===o?void 0:o.allowDataOverflow)&&void 0!==n?n:h_.allowDataOverflow;return{needClip:a||s,needClipX:a,needClipY:s}}function ZM(e){var{xAxisId:t,yAxisId:r,clipPathId:i}=e,o=yC(),{needClipX:a,needClipY:s,needClip:l}=qM(t,r);if(!l||!o)return null;var{x:c,y:u,width:d,height:h}=o;return n.createElement("clipPath",{id:"clipPath-".concat(i)},n.createElement("rect",{x:a?c:c-d/2,y:s?u:u-h/2,width:a?d:2*d,height:s?h:2*h}))}var XM=(e,t,r)=>{var n=null!==r&&void 0!==r?r:e;if(!Bc(n))return xc(n,t,0)};function YM(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function JM(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?YM(Object(r),!0).forEach(function(t){$M(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):YM(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function $M(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function eO(e,t){var r,n;return null!==(r=null===(n=e.graphicalItems.cartesianItems.find(e=>e.id===t))||void 0===n?void 0:n.xAxisId)&&void 0!==r?r:0}function tO(e,t){var r,n;return null!==(r=null===(n=e.graphicalItems.cartesianItems.find(e=>e.id===t))||void 0===n?void 0:n.yAxisId)&&void 0!==r?r:0}var rO=yd([x_,(e,t)=>t],(e,t)=>e.filter(e=>"bar"===e.type).find(e=>e.id===t)),nO=yd([rO],e=>null===e||void 0===e?void 0:e.maxBarSize),iO=yd([Eh,x_,eO,tO,(e,t,r)=>r],(e,t,r,n,i)=>t.filter(t=>"horizontal"===e?t.xAxisId===r:t.yAxisId===n).filter(e=>e.isPanorama===i).filter(e=>!1===e.hide).filter(e=>"bar"===e.type)),oO=yd([iO,e=>e.rootProps.barSize,(e,t)=>{var r=Eh(e),n=eO(e,t),i=tO(e,t);if(null!=n&&null!=i)return"horizontal"===r?Wv(e,"xAxis",n):Wv(e,"yAxis",i)}],(e,t,r)=>{var n=e.filter(e_),i=e.filter(e=>null==e.stackId),o=n.reduce((e,t)=>(e[t.stackId]||(e[t.stackId]=[]),e[t.stackId].push(t),e),{}),a=Object.entries(o).map(e=>{var[n,i]=e;return{stackId:n,dataKeys:i.map(e=>e.dataKey),barSize:XM(t,r,i[0].barSize)}});return[...a,...i.map(e=>({stackId:void 0,dataKeys:[e.dataKey].filter(e=>null!=e),barSize:XM(t,r,e.barSize)}))]}),aO=(e,t,r)=>{var n,i,o=Eh(e),a=eO(e,t),s=tO(e,t);if(null!=a&&null!=s)return"horizontal"===o?(n=tx(e,"xAxis",a,r),i=ex(e,"xAxis",a,r)):(n=tx(e,"yAxis",s,r),i=ex(e,"yAxis",s,r)),$d(n,i)},sO=yd([oO,ly,e=>e.rootProps.barGap,cy,(e,t,r)=>{var n,i,o=rO(e,t);if(null!=o){var a=eO(e,t),s=tO(e,t);if(null!=a&&null!=s){var l,c,u=Eh(e),d=ly(e),{maxBarSize:h}=o,A=Bc(h)?d:h;return"horizontal"===u?(l=tx(e,"xAxis",a,r),c=ex(e,"xAxis",a,r)):(l=tx(e,"yAxis",s,r),c=ex(e,"yAxis",s,r)),null!==(n=null!==(i=$d(l,c,!0))&&void 0!==i?i:A)&&void 0!==n?n:0}}},aO,nO],(e,t,r,n,i,o,a)=>{var s=Bc(a)?t:a,l=function(e,t,r,n,i){var o=n.length;if(!(o<1)){var a,s=xc(e,r,0,!0),l=[];if(Lc(n[0].barSize)){var c=!1,u=r/o,d=n.reduce((e,t)=>e+(t.barSize||0),0);(d+=(o-1)*s)>=r&&(d-=(o-1)*s,s=0),d>=r&&u>0&&(c=!0,d=o*(u*=.9));var h={offset:((r-d)/2|0)-s,size:0};a=n.reduce((e,t)=>{var r,n=[...e,{stackId:t.stackId,dataKeys:t.dataKeys,position:{offset:h.offset+h.size+s,size:c?u:null!==(r=t.barSize)&&void 0!==r?r:0}}];return h=n[n.length-1].position,n},l)}else{var A=xc(t,r,0,!0);r-2*A-(o-1)*s<=0&&(s=0);var f=(r-2*A-(o-1)*s)/o;f>1&&(f>>=0);var p=Lc(i)?Math.min(f,i):f;a=n.reduce((e,t,r)=>[...e,{stackId:t.stackId,dataKeys:t.dataKeys,position:{offset:A+(f+s)*r+(f-p)/2,size:p}}],l)}return a}}(r,n,i!==o?i:o,e,s);return i!==o&&null!=l&&(l=l.map(e=>JM(JM({},e),{},{position:JM(JM({},e.position),{},{offset:e.position.offset-i/2})}))),l}),lO=yd([sO,rO],(e,t)=>{if(null!=e&&null!=t){var r=e.find(e=>e.stackId===t.stackId&&null!=t.dataKey&&e.dataKeys.includes(t.dataKey));if(null!=r)return r.position}}),cO=yd([(e,t,r)=>{var n=Eh(e),i=eO(e,t),o=tO(e,t);if(null!=i&&null!=o)return"horizontal"===n?Q_(e,"yAxis",o,r):Q_(e,"xAxis",i,r)},rO],(e,t)=>{var r=Jy(t);if(e&&null!=r&&null!=t){var{stackId:n}=t;if(null!=n){var i=e[n];if(i){var{stackedData:o}=i;if(o)return o.find(e=>e.key===r)}}}}),uO=yd([Ah,ph,(e,t,r)=>{var n=eO(e,t);if(null!=n)return tx(e,"xAxis",n,r)},(e,t,r)=>{var n=tO(e,t);if(null!=n)return tx(e,"yAxis",n,r)},(e,t,r)=>{var n=eO(e,t);if(null!=n)return ex(e,"xAxis",n,r)},(e,t,r)=>{var n=tO(e,t);if(null!=n)return ex(e,"yAxis",n,r)},lO,Eh,(e,t,r)=>r?jg(e):Ng(e),aO,cO,rO,(e,t,r,n)=>n],(e,t,r,n,i,o,a,s,l,c,u,d,h)=>{var{chartData:A,dataStartIndex:f,dataEndIndex:p}=l;if(null!=d&&null!=a&&null!=t&&("horizontal"===s||"vertical"===s)&&null!=r&&null!=n&&null!=i&&null!=o&&null!=c){var m,{data:g}=d;if(null!=(m=null!=g&&g.length>0?g:null===A||void 0===A?void 0:A.slice(f,p+1)))return function(e){var{layout:t,barSettings:{dataKey:r,minPointSize:n},pos:i,bandSize:o,xAxis:a,yAxis:s,xAxisTicks:l,yAxisTicks:c,stackedData:u,displayedData:d,offset:h,cells:A,parentViewBox:f,dataStartIndex:p}=e,m="horizontal"===t?s:a,g=u?m.scale.domain():null,y=(e=>{var{numericAxis:t}=e,r=t.scale.domain();if("number"===t.type){var n=Math.min(r[0],r[1]),i=Math.max(r[0],r[1]);return n<=0&&i>=0?0:i<0?i:n}return r[0]})({numericAxis:m}),_=m.scale(y);return d.map((e,d)=>{var m,v,x,w,b,B;if(u){var C=u[d+p];if(null==C)return null;m=((e,t)=>{if(!t||2!==t.length||!gc(t[0])||!gc(t[1]))return e;var r=Math.min(t[0],t[1]),n=Math.max(t[0],t[1]),i=[e[0],e[1]];return(!gc(e[0])||e[0]<r)&&(i[0]=r),(!gc(e[1])||e[1]>n)&&(i[1]=n),i[0]>n&&(i[0]=n),i[1]<r&&(i[1]=r),i})(C,g)}else m=Qd(e,r),Array.isArray(m)||(m=[y,m]);var E=VM(n,LO)(m[1],d);if("horizontal"===t){var S,[T,I]=[s.scale(m[0]),s.scale(m[1])];v=Zd({axis:a,ticks:l,bandSize:o,offset:i.offset,entry:e,index:d}),x=null!==(S=null!==I&&void 0!==I?I:T)&&void 0!==S?S:void 0,w=i.size;var F=T-I;if(b=pc(F)?0:F,B={x:v,y:h.top,width:w,height:h.height},Math.abs(E)>0&&Math.abs(b)<Math.abs(E)){var k=fc(b||E)*(Math.abs(E)-Math.abs(b));x-=k,b+=k}}else{var[P,M]=[a.scale(m[0]),a.scale(m[1])];if(v=P,x=Zd({axis:s,ticks:c,bandSize:o,offset:i.offset,entry:e,index:d}),w=M-P,b=i.size,B={x:h.left,y:x,width:h.width,height:b},Math.abs(E)>0&&Math.abs(w)<Math.abs(E))w+=fc(w||E)*(Math.abs(E)-Math.abs(w))}return null==v||null==x||null==w||null==b?null:bO(bO({},e),{},{stackedBarStart:_,x:v,y:x,width:w,height:b,value:u?m:m[1],payload:e,background:B,tooltipPosition:{x:v+w/2,y:x+b/2},parentViewBox:f},A&&A[d]&&A[d].props)}).filter(Boolean)}({layout:s,barSettings:d,pos:a,parentViewBox:t,bandSize:c,xAxis:r,yAxis:n,xAxisTicks:i,yAxisTicks:o,stackedData:u,displayedData:m,offset:e,cells:h,dataStartIndex:f})}});var dO=["index"];function hO(){return hO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},hO.apply(null,arguments)}var AO=(0,n.createContext)(void 0),fO=e=>{var t,r=(0,n.useContext)(AO);return null!=r?r.stackId:null!=e?null==(t=e)?void 0:String(t):void 0},pO=(e,t)=>"recharts-bar-stack-clip-path-".concat(e,"-").concat(t),mO=e=>{var{index:t}=e,r=function(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}(e,dO),i=(e=>{var t=(0,n.useContext)(AO);if(null!=t){var{stackId:r}=t;return"url(#".concat(pO(r,e),")")}})(t);return n.createElement(yE,hO({className:"recharts-bar-stack-layer",clipPath:i},r))},gO=["onMouseEnter","onMouseLeave","onClick"],yO=["value","background","tooltipPosition"],_O=["id"],vO=["onMouseEnter","onClick","onMouseLeave"];function xO(){return xO=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)({}).hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},xO.apply(null,arguments)}function wO(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function bO(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?wO(Object(r),!0).forEach(function(t){BO(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):wO(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function BO(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function CO(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)r=o[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var EO=e=>{var{dataKey:t,name:r,fill:n,legendType:i,hide:o}=e;return[{inactive:o,dataKey:t,type:i,color:n,value:th(r,t),payload:e}]},SO=n.memo(e=>{var{dataKey:t,stroke:r,strokeWidth:i,fill:o,name:a,hide:s,unit:l,tooltipType:c,id:u}=e,d={dataDefinedOnItem:void 0,positions:void 0,settings:{stroke:r,strokeWidth:i,fill:o,dataKey:t,nameKey:void 0,name:th(a,t),hide:s,type:c,color:o,unit:l,graphicalItemId:u}};return n.createElement(cF,{tooltipEntrySettings:d})});function TO(e){var t=Sd(sw),{data:r,dataKey:i,background:o,allOtherBarProps:a}=e,{onMouseEnter:s,onMouseLeave:l,onClick:c}=a,u=CO(a,gO),d=aF(s,i,a.id),h=sF(l),A=lF(c,i,a.id);if(!o||null==r)return null;var f,p,m=kB(o);return n.createElement(vF,{zIndex:(f=o,p=Ey.barBackground,f&&"object"===typeof f&&"zIndex"in f&&"number"===typeof f.zIndex&&Lc(f.zIndex)?f.zIndex:p)},r.map((e,r)=>{var{value:a,background:s,tooltipPosition:l}=e,c=CO(e,yO);if(!s)return null;var f=d(e,r),p=h(e,r),g=A(e,r),y=bO(bO(bO(bO(bO({option:o,isActive:String(r)===t},c),{},{fill:"#eee"},s),m),YE(u,e,r)),{},{onMouseEnter:f,onMouseLeave:p,onClick:g,dataKey:i,index:r,className:"recharts-bar-background-rectangle"});return n.createElement(QM,xO({key:"background-bar-".concat(r)},y))}))}function IO(e){var{showLabels:t,children:r,rects:i}=e,o=null===i||void 0===i?void 0:i.map(e=>{var t={x:e.x,y:e.y,width:e.width,lowerWidth:e.width,upperWidth:e.width,height:e.height};return bO(bO({},t),{},{value:e.value,payload:e.payload,parentViewBox:e.parentViewBox,viewBox:t,fill:e.fill})});return n.createElement(KF,{value:t?o:void 0},r)}function FO(e){var{shape:t,activeBar:r,baseProps:i,entry:o,index:a,dataKey:s}=e,l=Sd(sw),c=Sd(cw),u=r&&String(a)===l&&(null==c||s===c),d=u?r:t;return u?n.createElement(vF,{zIndex:Ey.activeBar},n.createElement(QM,xO({},i,{name:String(i.name)},o,{isActive:u,option:d,index:a,dataKey:s}))):n.createElement(QM,xO({},i,{name:String(i.name)},o,{isActive:u,option:d,index:a,dataKey:s}))}function kO(e){var{shape:t,baseProps:r,entry:i,index:o,dataKey:a}=e;return n.createElement(QM,xO({},r,{name:String(r.name)},i,{isActive:!1,option:t,index:o,dataKey:a}))}function PO(e){var t,{data:r,props:i}=e,o=null!==(t=FB(i))&&void 0!==t?t:{},{id:a}=o,s=CO(o,_O),{shape:l,dataKey:c,activeBar:u}=i,{onMouseEnter:d,onClick:h,onMouseLeave:A}=i,f=CO(i,vO),p=aF(d,c,a),m=sF(A),g=lF(h,c,a);return r?n.createElement(n.Fragment,null,r.map((e,t)=>n.createElement(mO,xO({index:t,key:"rectangle-".concat(null===e||void 0===e?void 0:e.x,"-").concat(null===e||void 0===e?void 0:e.y,"-").concat(null===e||void 0===e?void 0:e.value,"-").concat(t),className:"recharts-bar-rectangle"},YE(f,e,t),{onMouseEnter:p(e,t),onMouseLeave:m(e,t),onClick:g(e,t)}),u?n.createElement(FO,{shape:l,activeBar:u,baseProps:s,entry:e,index:t,dataKey:c}):n.createElement(kO,{shape:l,baseProps:s,entry:e,index:t,dataKey:c})))):null}function MO(e){var{props:t,previousRectanglesRef:r}=e,{data:i,layout:o,isAnimationActive:a,animationBegin:s,animationDuration:l,animationEasing:c,onAnimationEnd:u,onAnimationStart:d}=t,h=r.current,A=IT(t,"recharts-bar-"),[f,p]=(0,n.useState)(!1),m=!f,g=(0,n.useCallback)(()=>{"function"===typeof u&&u(),p(!1)},[u]),y=(0,n.useCallback)(()=>{"function"===typeof d&&d(),p(!0)},[d]);return n.createElement(IO,{showLabels:m,rects:i},n.createElement(TT,{animationId:A,begin:s,duration:l,isActive:a,easing:c,onAnimationEnd:g,onAnimationStart:y,key:A},e=>{var a=1===e?i:null===i||void 0===i?void 0:i.map((t,r)=>{var n=h&&h[r];if(n)return bO(bO({},t),{},{x:bc(n.x,t.x,e),y:bc(n.y,t.y,e),width:bc(n.width,t.width,e),height:bc(n.height,t.height,e)});if("horizontal"===o){var i=bc(0,t.height,e),a=bc(t.stackedBarStart,t.y,e);return bO(bO({},t),{},{y:a,height:i})}var s=bc(0,t.width,e),l=bc(t.stackedBarStart,t.x,e);return bO(bO({},t),{},{width:s,x:l})});return e>0&&(r.current=null!==a&&void 0!==a?a:null),null==a?null:n.createElement(yE,null,n.createElement(PO,{props:t,data:a}))}),n.createElement(XF,{label:t.label}),t.children)}function OO(e){var t=(0,n.useRef)(null);return n.createElement(MO,{previousRectanglesRef:t,props:e})}var LO=0,DO=(e,t)=>{var r=Array.isArray(e.value)?e.value[1]:e.value;return{x:e.x,y:e.y,value:r,errorVal:Qd(e,t)}};class UO extends n.PureComponent{render(){var{hide:e,data:t,dataKey:r,className:i,xAxisId:o,yAxisId:a,needClip:s,background:l,id:c}=this.props;if(e||null==t)return null;var u=sc("recharts-bar",i),d=c;return n.createElement(yE,{className:u,id:c},s&&n.createElement("defs",null,n.createElement(ZM,{clipPathId:d,xAxisId:o,yAxisId:a})),n.createElement(yE,{className:"recharts-bar-rectangles",clipPath:s?"url(#clipPath-".concat(d,")"):void 0},n.createElement(TO,{data:t,dataKey:r,background:l,allOtherBarProps:this.props}),n.createElement(OO,this.props)))}}var RO={activeBar:!1,animationBegin:0,animationDuration:400,animationEasing:"ease",background:!1,hide:!1,isAnimationActive:"auto",label:!1,legendType:"rect",minPointSize:LO,xAxisId:0,yAxisId:0,zIndex:Ey.bar};function zO(e){var t,{xAxisId:r,yAxisId:i,hide:o,legendType:a,minPointSize:s,activeBar:l,animationBegin:c,animationDuration:u,animationEasing:d,isAnimationActive:h}=e,{needClip:A}=qM(r,i),f=Sh(),p=gh(),m=JS(e.children,KS),g=Sd(t=>uO(t,e.id,p,m));if("vertical"!==f&&"horizontal"!==f)return null;var y=null===g||void 0===g?void 0:g[0];return t=null==y||null==y.height||null==y.width?0:"vertical"===f?y.height/2:y.width/2,n.createElement(WM,{xAxisId:r,yAxisId:i,data:g,dataPointFormatter:DO,errorBarOffset:t},n.createElement(UO,xO({},e,{layout:f,needClip:A,data:g,xAxisId:r,yAxisId:i,hide:o,legendType:a,minPointSize:s,activeBar:l,animationBegin:c,animationDuration:u,animationEasing:d,isAnimationActive:h})))}function NO(e){var t=CC(e,RO),r=fO(t.stackId),i=gh();return n.createElement(fF,{id:t.id,type:"bar"},e=>n.createElement(n.Fragment,null,n.createElement(uF,{legendPayload:EO(t)}),n.createElement(SO,{dataKey:t.dataKey,stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,name:t.name,hide:t.hide,unit:t.unit,tooltipType:t.tooltipType,id:e}),n.createElement(mF,{type:"bar",id:e,data:void 0,xAxisId:t.xAxisId,yAxisId:t.yAxisId,zAxisId:0,dataKey:t.dataKey,stackId:r,hide:t.hide,barSize:t.barSize,minPointSize:t.minPointSize,maxBarSize:t.maxBarSize,isPanorama:i}),n.createElement(vF,{zIndex:t.zIndex},n.createElement(zO,xO({},t,{id:e})))))}var jO=n.memo(NO,_B);jO.displayName="Bar";const QO={solar:"#F59E0B",wind:"#3B82F6",storage:"#8B5CF6",load:"#EF4444"},VO={solar:"Solar",wind:"Wind",storage:"Storage",load:"Load"},HO=e=>{let{result:t}=e;const r=t.capacityMix.map(e=>({name:VO[e.type],value:e.capacityMW,color:QO[e.type]})),n=t.capacityMix.map(e=>({name:VO[e.type],capacity:e.capacityMW,cost:e.costMillions,fill:QO[e.type]})),i=e=>{let{active:t,payload:r,label:n}=e;return t&&r&&r.length?(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[(0,Ca.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:n}),r.map((e,t)=>(0,Ca.jsxs)("p",{className:"text-sm",style:{color:e.color},children:[e.name,": ",e.value.toFixed(1),"capacity"===e.name?" MW":" $M"]},t))]}):null},o=e=>{let{active:r,payload:n}=e;if(r&&n&&n.length){const e=n[0];return(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 p-3 rounded-lg shadow-lg border border-gray-200 dark:border-gray-700",children:[(0,Ca.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),(0,Ca.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[e.value.toFixed(0)," MW (",(e.value/t.capacityMix.reduce((e,t)=>e+t.capacityMW,0)*100).toFixed(1),"%)"]})]})}return null};return 0===t.capacityMix.length?(0,Ca.jsx)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:(0,Ca.jsx)("p",{children:"No capacity selected in optimization"})}):(0,Ca.jsxs)("div",{className:"space-y-6",children:[(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Capacity Mix"}),(0,Ca.jsx)("div",{className:"h-48",children:(0,Ca.jsx)(Gc,{width:"100%",height:"100%",children:(0,Ca.jsxs)(LC,{children:[(0,Ca.jsx)(gk,{data:r,cx:"50%",cy:"50%",innerRadius:40,outerRadius:70,paddingAngle:2,dataKey:"value",children:r.map((e,t)=>(0,Ca.jsx)(KS,{fill:e.color},"cell-".concat(t)))}),(0,Ca.jsx)(sP,{content:(0,Ca.jsx)(o,{})}),(0,Ca.jsx)(EP,{formatter:e=>(0,Ca.jsx)("span",{className:"text-xs text-gray-700 dark:text-gray-300",children:e})})]})})})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Cost Breakdown by Technology"}),(0,Ca.jsx)("div",{className:"h-48",children:(0,Ca.jsx)(Gc,{width:"100%",height:"100%",children:(0,Ca.jsxs)(kP,{data:n,layout:"vertical",children:[(0,Ca.jsx)(mM,{strokeDasharray:"3 3",stroke:"#374151"}),(0,Ca.jsx)(FM,{type:"number",tick:{fill:"#9CA3AF",fontSize:10},tickFormatter:e=>"$".concat(e,"M")}),(0,Ca.jsx)(zM,{dataKey:"name",type:"category",tick:{fill:"#9CA3AF",fontSize:10},width:60}),(0,Ca.jsx)(sP,{content:(0,Ca.jsx)(i,{})}),(0,Ca.jsx)(jO,{dataKey:"cost",name:"Cost ($M)",radius:[0,4,4,0],children:n.map((e,t)=>(0,Ca.jsx)(KS,{fill:e.fill},"cell-".concat(t)))})]})})})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3",children:"Installed Capacity by Technology"}),(0,Ca.jsx)("div",{className:"h-48",children:(0,Ca.jsx)(Gc,{width:"100%",height:"100%",children:(0,Ca.jsxs)(kP,{data:n,children:[(0,Ca.jsx)(mM,{strokeDasharray:"3 3",stroke:"#374151"}),(0,Ca.jsx)(FM,{dataKey:"name",tick:{fill:"#9CA3AF",fontSize:10}}),(0,Ca.jsx)(zM,{tick:{fill:"#9CA3AF",fontSize:10},tickFormatter:e=>"".concat(e," MW")}),(0,Ca.jsx)(sP,{content:(0,Ca.jsx)(i,{})}),(0,Ca.jsx)(jO,{dataKey:"capacity",name:"Capacity (MW)",radius:[4,4,0,0],children:n.map((e,t)=>(0,Ca.jsx)(KS,{fill:e.fill},"cell-".concat(t)))})]})})})]})]})},GO=()=>{const e=$e(),{sites:t,scenarioConfig:r,optimizationProgress:i,optimizationResult:o}=et(e=>e.candidateSites),[a,s]=(0,n.useState)([]),l="running"===i.status,c="complete"===i.status,u=i.iteration/i.totalIterations*100;return(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,Ca.jsx)("div",{className:"p-4 bg-gradient-to-r from-orange-600 to-red-600",children:(0,Ca.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center space-x-2",children:[(0,Ca.jsx)("span",{children:"\ud83d\udcca"}),(0,Ca.jsx)("span",{children:"Optimization & Results"})]})}),(0,Ca.jsxs)("div",{className:"p-4 space-y-4",children:[a.length>0&&(0,Ca.jsxs)("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[(0,Ca.jsx)("h4",{className:"text-sm font-semibold text-red-700 dark:text-red-300 mb-1",children:"Validation Errors"}),(0,Ca.jsx)("ul",{className:"text-xs text-red-600 dark:text-red-400 list-disc list-inside",children:a.map((e,t)=>(0,Ca.jsx)("li",{children:e},t))})]}),(0,Ca.jsx)("button",{onClick:async()=>{const n=function(e){const t=[];return e.name&&""!==e.name.trim()||t.push("Scenario name is required"),(e.planningHorizonYears<1||e.planningHorizonYears>50)&&t.push("Planning horizon must be between 1 and 50 years"),(e.discountRatePercent<0||e.discountRatePercent>20)&&t.push("Discount rate must be between 0% and 20%"),e.carbonPriceDollarsPerTon<0&&t.push("Carbon price cannot be negative"),(e.renewableTargetPercent<0||e.renewableTargetPercent>100)&&t.push("Renewable target must be between 0% and 100%"),t}(r),i=function(e){const t=[];return 0===e.length&&t.push("At least one candidate site is required"),e.forEach(e=>{e.maxCapacityMW<=0&&t.push('Site "'.concat(e.name,'" must have positive capacity'))}),t}(t),o=[...n,...i];o.length>0?s(o):(s([]),e(el(null)),await oc(t,r,{onProgress:t=>{e($s(t))},onComplete:t=>{e(el(t))},onError:e=>{s([e])}}))},disabled:l||0===t.length,className:"w-full py-3 rounded-lg font-semibold transition-all flex items-center justify-center space-x-2 ".concat(l?"bg-gray-400 cursor-not-allowed":0===t.length?"bg-gray-300 dark:bg-gray-700 cursor-not-allowed text-gray-500":"bg-gradient-to-r from-orange-600 to-red-600 text-white hover:from-orange-700 hover:to-red-700"),children:l?(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),(0,Ca.jsx)("span",{children:"Running Optimization..."})]}):(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("span",{children:"\ud83d\ude80"}),(0,Ca.jsx)("span",{children:"Run Optimization"})]})}),0===t.length&&(0,Ca.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"Add candidate sites to enable optimization"}),l&&(0,Ca.jsxs)("div",{className:"space-y-2",children:[(0,Ca.jsxs)("div",{className:"flex justify-between text-sm text-gray-600 dark:text-gray-400",children:[(0,Ca.jsxs)("span",{children:["Iteration ",i.iteration,"/",i.totalIterations]}),(0,Ca.jsxs)("span",{children:["Gap: ",(100*i.gap).toFixed(2),"%"]})]}),(0,Ca.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3",children:(0,Ca.jsx)("div",{className:"bg-gradient-to-r from-orange-500 to-red-500 h-3 rounded-full transition-all duration-200",style:{width:"".concat(u,"%")}})}),(0,Ca.jsxs)("div",{className:"text-center text-xs text-gray-500 dark:text-gray-400",children:[u.toFixed(0),"% complete"]})]}),c&&o&&(0,Ca.jsxs)("div",{className:"space-y-4",children:[(0,Ca.jsxs)("div",{className:"flex items-center gap-2 text-green-600 dark:text-green-400",children:[(0,Ca.jsx)("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,Ca.jsx)("span",{className:"font-semibold",children:"Optimization Complete"})]}),(0,Ca.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,Ca.jsxs)("div",{className:"p-3 bg-orange-50 dark:bg-orange-900/20 rounded-lg border border-orange-200 dark:border-orange-800",children:[(0,Ca.jsx)("div",{className:"text-xs text-orange-600 dark:text-orange-400 mb-1",children:"Total Cost"}),(0,Ca.jsx)("div",{className:"text-lg font-bold text-orange-900 dark:text-orange-100",children:al(o.totalCost)})]}),(0,Ca.jsxs)("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,Ca.jsx)("div",{className:"text-xs text-blue-600 dark:text-blue-400 mb-1",children:"Total Capacity"}),(0,Ca.jsxs)("div",{className:"text-lg font-bold text-blue-900 dark:text-blue-100",children:[Object.values(o.selectedCapacityByType).reduce((e,t)=>e+t,0).toFixed(0)," ","MW"]})]}),(0,Ca.jsxs)("div",{className:"p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[(0,Ca.jsx)("div",{className:"text-xs text-green-600 dark:text-green-400 mb-1",children:"LCOE"}),(0,Ca.jsxs)("div",{className:"text-lg font-bold text-green-900 dark:text-green-100",children:["$",o.levelizedCost.toFixed(2),"/MWh"]})]}),(0,Ca.jsxs)("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/20 rounded-lg border border-purple-200 dark:border-purple-800",children:[(0,Ca.jsx)("div",{className:"text-xs text-purple-600 dark:text-purple-400 mb-1",children:"Emissions"}),(0,Ca.jsxs)("div",{className:"text-lg font-bold text-purple-900 dark:text-purple-100",children:[(o.emissions/1e3).toFixed(1),"k tons"]})]})]}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsxs)("h4",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:["Selected Sites (",o.selectedSiteIds.length,")"]}),(0,Ca.jsx)("div",{className:"flex flex-wrap gap-1",children:t.filter(e=>o.selectedSiteIds.includes(e.id)).map(e=>(0,Ca.jsx)("span",{className:"px-2 py-1 bg-gray-100 dark:bg-gray-700 text-xs rounded-full text-gray-700 dark:text-gray-300",children:e.name},e.id))})]}),(0,Ca.jsx)(HO,{result:o})]}),"idle"===i.status&&!o&&(0,Ca.jsxs)("div",{className:"text-center py-8 text-gray-500 dark:text-gray-400",children:[(0,Ca.jsx)("div",{className:"text-4xl mb-2",children:"\ud83d\udcc8"}),(0,Ca.jsx)("p",{className:"text-sm",children:"Run optimization to see results"})]}),"failed"===i.status&&(0,Ca.jsxs)("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800 text-center",children:[(0,Ca.jsx)("div",{className:"text-2xl mb-2",children:"\u274c"}),(0,Ca.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:"Optimization failed. Please try again."})]})]})]})};var KO=r(5239),WO=r.n(KO);const qO=()=>{const{sites:e,scenarioConfig:t,optimizationResult:r}=et(e=>e.candidateSites),[i,o]=(0,n.useState)("idle"),[a,s]=(0,n.useState)("idle"),l=e.length>0;return(0,Ca.jsxs)("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[(0,Ca.jsx)("div",{className:"p-4 bg-gradient-to-r from-slate-600 to-gray-700",children:(0,Ca.jsxs)("h2",{className:"text-xl font-bold text-white flex items-center space-x-2",children:[(0,Ca.jsx)("span",{children:"\ud83d\udce4"}),(0,Ca.jsx)("span",{children:"Export & Share"})]})}),(0,Ca.jsxs)("div",{className:"p-4 space-y-3",children:[(0,Ca.jsxs)("button",{onClick:()=>{!function(e,t,r){const n={scenario:e,sites:t,result:r,exportedAt:(new Date).toISOString()},i=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),o=URL.createObjectURL(i),a=document.createElement("a");a.href=o,a.download="canopi-".concat(e.name.replace(/\s+/g,"-").toLowerCase(),"-").concat(Date.now(),".json"),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(o)}(t,e,r)},disabled:!l,className:"w-full py-2.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 text-sm",children:[(0,Ca.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),(0,Ca.jsx)("span",{children:"Export to JSON"})]}),(0,Ca.jsxs)("button",{onClick:()=>{!function(e,t,r){var n;const i=[];i.push("CANOPI Optimization Results"),i.push("Scenario Name,".concat(e.name)),i.push("Exported At,".concat((new Date).toISOString())),i.push(""),i.push("Scenario Configuration"),i.push("Parameter,Value"),i.push("Planning Horizon (years),".concat(e.planningHorizonYears)),i.push("Discount Rate (%),".concat(e.discountRatePercent)),i.push("Carbon Price ($/ton),".concat(e.carbonPriceDollarsPerTon)),i.push("Budget Constraint ($M),".concat(null!==(n=e.budgetConstraintMillions)&&void 0!==n?n:"No limit")),i.push("Renewable Target (%),".concat(e.renewableTargetPercent)),i.push("Reliability Standard,".concat(e.reliabilityStandard)),i.push(""),i.push("Candidate Sites"),i.push("ID,Name,Type,Latitude,Longitude,Max Capacity (MW),Selected"),t.forEach(e=>{const t=null!==r&&void 0!==r&&r.selectedSiteIds.includes(e.id)?"Yes":"No";i.push("".concat(e.id,",").concat(e.name,",").concat(e.type,",").concat(e.coordinates.latitude,",").concat(e.coordinates.longitude,",").concat(e.maxCapacityMW,",").concat(t))}),i.push(""),r&&(i.push("Optimization Results"),i.push("Metric,Value"),i.push("Total Cost ($),".concat(r.totalCost)),i.push("LCOE ($/MWh),".concat(r.levelizedCost.toFixed(2))),i.push("Total Emissions (tons CO2),".concat(r.emissions.toFixed(0))),i.push(""),i.push("Capacity by Technology"),i.push("Technology,Capacity (MW),Cost ($M)"),r.capacityMix.forEach(e=>{i.push("".concat(e.type,",").concat(e.capacityMW,",").concat(e.costMillions.toFixed(2)))}));const o=i.join("\n"),a=new Blob([o],{type:"text/csv;charset=utf-8;"}),s=URL.createObjectURL(a),l=document.createElement("a");l.href=s,l.download="canopi-".concat(e.name.replace(/\s+/g,"-").toLowerCase(),"-").concat(Date.now(),".csv"),document.body.appendChild(l),l.click(),document.body.removeChild(l),URL.revokeObjectURL(s)}(t,e,r)},disabled:!l,className:"w-full py-2.5 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center space-x-2 text-sm",children:[(0,Ca.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,Ca.jsx)("span",{children:"Export to CSV"})]}),(0,Ca.jsx)("button",{onClick:async()=>{const r=function(e,t){const r={s:{n:e.name,h:e.planningHorizonYears,d:e.discountRatePercent,c:e.carbonPriceDollarsPerTon,b:e.budgetConstraintMillions,r:e.renewableTargetPercent,l:e.reliabilityStandard},p:t.map(e=>({n:e.name,t:e.type,a:e.coordinates.latitude,o:e.coordinates.longitude,m:e.maxCapacityMW}))},n=btoa(JSON.stringify(r)),i=window.location.origin+window.location.pathname;return"".concat(i,"?scenario=").concat(n)}(t,e),n=await async function(e){try{return await navigator.clipboard.writeText(e),!0}catch(JO){const r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.left="-9999px",document.body.appendChild(r),r.select();const n=document.execCommand("copy");return document.body.removeChild(r),n}}(r);o(n?"copied":"error"),setTimeout(()=>o("idle"),2e3)},disabled:!l,className:"w-full py-2.5 rounded-lg transition-colors flex items-center justify-center space-x-2 text-sm ".concat("copied"===i?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"error"===i?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed"),children:"copied"===i?(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,Ca.jsx)("span",{children:"Link Copied!"})]}):"error"===i?(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,Ca.jsx)("span",{children:"Copy Failed"})]}):(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),(0,Ca.jsx)("span",{children:"Copy Shareable Link"})]})}),(0,Ca.jsx)("button",{onClick:async()=>{s("capturing");try{var e;const t=null===(e=document.querySelector(".mapboxgl-map"))||void 0===e?void 0:e.parentElement;if(!t)throw new Error("Map container not found");await async function(e){try{const t=await WO()(e,{useCORS:!0,allowTaint:!0,backgroundColor:null}),r=document.createElement("a");r.download="canopi-map-".concat(Date.now(),".png"),r.href=t.toDataURL("image/png"),document.body.appendChild(r),r.click(),document.body.removeChild(r)}catch(JO){throw console.error("Failed to take screenshot:",JO),new Error("Failed to capture map screenshot")}}(t),s("idle")}catch(JO){s("error"),setTimeout(()=>s("idle"),2e3)}},disabled:"capturing"===a,className:"w-full py-2.5 rounded-lg transition-colors flex items-center justify-center space-x-2 text-sm ".concat("capturing"===a?"bg-gray-400 cursor-not-allowed":"error"===a?"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400":"bg-orange-600 text-white hover:bg-orange-700"),children:"capturing"===a?(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),(0,Ca.jsx)("span",{children:"Capturing..."})]}):"error"===a?(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),(0,Ca.jsx)("span",{children:"Screenshot Failed"})]}):(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsxs)("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:[(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})]}),(0,Ca.jsx)("span",{children:"Screenshot Map"})]})}),!l&&(0,Ca.jsx)("p",{className:"text-xs text-gray-500 dark:text-gray-400 text-center",children:"Add candidate sites to enable export features"}),l&&(0,Ca.jsxs)("div",{className:"p-2 bg-gray-50 dark:bg-gray-900 rounded-lg text-xs text-gray-500 dark:text-gray-400",children:[(0,Ca.jsxs)("p",{className:"mb-1",children:[(0,Ca.jsx)("strong",{children:"JSON:"})," Full data for import/backup"]}),(0,Ca.jsxs)("p",{className:"mb-1",children:[(0,Ca.jsx)("strong",{children:"CSV:"})," Spreadsheet-compatible format"]}),(0,Ca.jsxs)("p",{className:"mb-1",children:[(0,Ca.jsx)("strong",{children:"Link:"})," Share scenario via URL"]}),(0,Ca.jsxs)("p",{children:[(0,Ca.jsx)("strong",{children:"Screenshot:"})," Save map as image"]})]})]})]})};const ZO=function(){const e=$e(),[t,r]=(0,n.useState)(()=>{const e=localStorage.getItem("canopi-dark-mode");return null!==e?"true"===e:window.matchMedia("(prefers-color-scheme: dark)").matches}),[i,o]=(0,n.useState)(!1),[a,s]=(0,n.useState)(null),[l,c]=(0,n.useState)(!1),{isTourOpen:u,startTour:d,closeTour:h,completeTour:A}=(()=>{const[e,t]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{if(!localStorage.getItem("canopi-tour-completed")){const e=setTimeout(()=>t(!0),2e3);return()=>clearTimeout(e)}return()=>{}},[]),{isTourOpen:e,startTour:()=>t(!0),closeTour:()=>t(!1),completeTour:()=>{t(!1),localStorage.setItem("canopi-tour-completed","true")},resetTour:()=>{localStorage.removeItem("canopi-tour-completed"),t(!0)}}})();(0,n.useEffect)(()=>{e(Ua())},[e]),(0,n.useEffect)(()=>{const t=function(){const e=new URLSearchParams(window.location.search).get("scenario");if(!e)return null;try{const t=JSON.parse(atob(e));return{scenario:{name:t.s.n,planningHorizonYears:t.s.h,discountRatePercent:t.s.d,carbonPriceDollarsPerTon:t.s.c,budgetConstraintMillions:t.s.b,renewableTargetPercent:t.s.r,reliabilityStandard:t.s.l},sites:t.p.map(e=>({name:e.n,type:e.t,coordinates:{latitude:e.a,longitude:e.o},maxCapacityMW:e.m}))}}catch(JO){return console.error("Failed to parse scenario from URL:",JO),null}}();t&&(e(Ys(t.scenario)),t.sites.forEach(t=>{e(Hs(t))}),window.history.replaceState({},"",window.location.pathname))},[e]),(0,n.useEffect)(()=>{t?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),localStorage.setItem("canopi-dark-mode",String(t))},[t]),(0,n.useEffect)(()=>{const e=window.matchMedia("(prefers-color-scheme: dark)"),t=e=>{null===localStorage.getItem("canopi-dark-mode")&&r(e.matches)};return e.addEventListener("change",t),()=>e.removeEventListener("change",t)},[]),(0,n.useEffect)(()=>{const e=e=>{const{longitude:t,latitude:r}=e.detail;s({longitude:t,latitude:r}),o(!0)};return window.addEventListener("mapClick",e),()=>window.removeEventListener("mapClick",e)},[]);const f=(0,n.useCallback)(()=>{r(e=>!e)},[]),p=(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)(pl,{}),(0,Ca.jsx)("div",{className:"p-4",children:(0,Ca.jsx)(ec,{})})]}),m=(0,Ca.jsxs)(Ca.Fragment,{children:[(0,Ca.jsx)(tc,{}),(0,Ca.jsx)(GO,{}),(0,Ca.jsx)(qO,{}),(0,Ca.jsxs)("div",{className:"border-t border-gray-200 dark:border-gray-700 pt-4 mt-4",children:[(0,Ca.jsx)("h3",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mb-2 px-1",children:"Legacy Panels"}),(0,Ca.jsx)(Pl,{}),(0,Ca.jsx)(Ml,{})]})]});return(0,Ca.jsx)(Ll,{children:(0,Ca.jsx)(qe,{children:(0,Ca.jsxs)("div",{className:"h-screen flex flex-col bg-gray-100 dark:bg-gray-900",children:[(0,Ca.jsx)(Vl,{}),(0,Ca.jsx)(Ql,{}),(0,Ca.jsx)(Hl,{isDarkMode:t,onToggleDarkMode:f,leftPanelContent:p,rightPanelContent:m}),(0,Ca.jsx)("header",{className:"hidden lg:block bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 shadow-sm z-20",children:(0,Ca.jsxs)("div",{className:"px-6 py-4 flex items-center justify-between",children:[(0,Ca.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,Ca.jsx)("div",{className:"text-3xl","aria-hidden":"true",children:"\ud83c\udf3f"}),(0,Ca.jsxs)("div",{children:[(0,Ca.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"CANOPI"}),(0,Ca.jsx)("p",{className:"text-xs text-gray-600 dark:text-gray-400",children:"Energy Planning Platform"})]})]}),(0,Ca.jsxs)("nav",{className:"flex items-center space-x-6","aria-label":"Main navigation",children:[(0,Ca.jsx)("a",{href:"/",className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded","aria-current":"page",children:"Dashboard"}),(0,Ca.jsx)("a",{href:"#scenarios",className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded",children:"Scenarios"}),(0,Ca.jsx)("a",{href:"#reports",className:"text-sm font-medium text-gray-700 dark:text-gray-300 hover:text-primary-600 dark:hover:text-primary-400 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 rounded",children:"Reports"}),(0,Ca.jsx)("button",{onClick:d,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500",title:"Take a tour","aria-label":"Start guided tour",children:(0,Ca.jsx)("svg",{className:"w-5 h-5 text-gray-600 dark:text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,Ca.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),(0,Ca.jsx)("button",{onClick:f,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500",title:t?"Switch to Light Mode":"Switch to Dark Mode","aria-label":t?"Switch to light mode":"Switch to dark mode",children:t?(0,Ca.jsx)("svg",{className:"w-5 h-5 text-yellow-500",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ca.jsx)("path",{fillRule:"evenodd",d:"M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z",clipRule:"evenodd"})}):(0,Ca.jsx)("svg",{className:"w-5 h-5 text-gray-700",fill:"currentColor",viewBox:"0 0 20 20",children:(0,Ca.jsx)("path",{d:"M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"})})}),(0,Ca.jsx)("div",{className:"flex items-center space-x-2 pl-4 border-l border-gray-300 dark:border-gray-600",children:(0,Ca.jsx)("button",{className:"w-8 h-8 bg-primary-600 rounded-full flex items-center justify-center text-white font-semibold hover:bg-primary-700 transition-colors focus:outline-none focus:ring-2 focus:ring-primary-500 focus:ring-offset-2","aria-label":"User menu",children:"U"})})]})]})}),(0,Ca.jsxs)("main",{id:"main-content",className:"flex-1 flex overflow-hidden pb-16 lg:pb-0",tabIndex:-1,children:[(0,Ca.jsx)("aside",{className:"hidden lg:flex w-80 border-r border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 flex-col overflow-hidden","data-tour":"projects","aria-label":"Projects panel",children:p}),(0,Ca.jsx)("div",{className:"flex-1 relative","data-tour":"map",children:(0,Ca.jsx)(n.Suspense,{fallback:(0,Ca.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100 dark:bg-gray-900",children:(0,Ca.jsx)(Yl,{size:"lg",label:"Loading map..."})}),children:(0,Ca.jsxs)(Ge,{children:[(0,Ca.jsx)(Ve,{path:"/",element:(0,Ca.jsx)(ul,{})}),(0,Ca.jsx)(Ve,{path:"*",element:(0,Ca.jsx)(Qe,{to:"/",replace:!0})})]})})}),(0,Ca.jsx)("aside",{className:"hidden lg:flex w-96 border-l border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900 flex-col overflow-hidden","data-tour":"optimization","aria-label":"Optimization panel",children:(0,Ca.jsx)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:m})})]}),(0,Ca.jsx)(Gl,{onShowAbout:()=>c(!0),onStartTour:d,className:"hidden lg:block"}),(0,Ca.jsx)(Ol,{}),(0,Ca.jsx)(jl,{}),i&&(0,Ca.jsx)(fl,{onClose:()=>{o(!1),s(null)},initialCoordinates:a||void 0}),(0,Ca.jsx)(Kl,{isOpen:l,onClose:()=>c(!1)}),(0,Ca.jsx)(ql,{isOpen:u,onClose:h,onComplete:A})]})})})},XO=Qr({reducer:{projects:Za,optimization:kl,map:$n,candidateSites:nl},middleware:e=>e({serializableCheck:{ignoredActions:["map/setMapInstance"],ignoredActionPaths:["payload.mapInstance"],ignoredPaths:["map.mapInstance"]}})}),YO=e=>{e&&e instanceof Function&&r.e(488).then(r.bind(r,2488)).then(t=>{let{getCLS:r,getFID:n,getFCP:i,getLCP:o,getTTFB:a}=t;r(e),n(e),i(e),o(e),a(e)})};o.createRoot(document.getElementById("root")).render((0,Ca.jsx)(n.StrictMode,{children:(0,Ca.jsx)(_,{store:XO,children:(0,Ca.jsx)(ZO,{})})})),YO()})()})();
//# sourceMappingURL=main.f19eedbf.js.map